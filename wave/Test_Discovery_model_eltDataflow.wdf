["{\"nodes\":{\"Join_Line_Item_Product\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"PriceBook.Product2Id\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"Product\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Family\",\"Name\"]},\"sources\":[\"Join_Line_Item_PriceBook\",\"Extract_Product\"]},\"Append_Tasks_Events\":{\"action\":\"append\",\"parameters\":{\"enableDisjointedSchemaMerge\":true},\"sources\":[\"Extract_Task\",\"Compute_Event_IsClosed\"]},\"Extract_Opportunity\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"AccountId\"},{\"name\":\"OwnerId\"},{\"name\":\"Name\"},{\"name\":\"StageName\"},{\"name\":\"LeadSource\"},{\"name\":\"IsWon\"},{\"name\":\"Type\"},{\"name\":\"IsClosed\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"CreatedDate\",\"name\":\"CreatedDate\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"CloseDate\",\"name\":\"CloseDate\"},{\"name\":\"Amount\"},{\"name\":\"HasOpportunityLineItem\"},{\"name\":\"RecordTypeId\"}],\"object\":\"Opportunity\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Extract_Task\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Status\"},{\"name\":\"IsClosed\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"CreatedDate\",\"name\":\"CreatedDate\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"ActivityDate\",\"name\":\"ActivityDate\"},{\"name\":\"Subject\"},{\"name\":\"WhatId\"},{\"name\":\"AccountId\"},{\"name\":\"TaskSubtype\"}],\"object\":\"Task\"}},\"Compute_Fields_For_Tasks\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"Count\",\"name\":\"Count\",\"precision\":16,\"saqlExpression\":\"1\",\"scale\":0,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Append_Tasks_Events\"]},\"Extract_Product\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Family\"},{\"name\":\"Name\"},{\"name\":\"Id\"}],\"object\":\"Product2\"}},\"Join_RecordType_Opportunity\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"RecordTypeId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"RecordType\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Name\"]},\"sources\":[\"Extract_Opportunity\",\"Extract_RecordTypes\"]},\"Join_Opportunity_Activities\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"Id\"],\"operation\":\"LookupMultiValue\",\"relationship\":\"CompletedActivities\",\"rightKey\":[\"WhatId\"],\"rightSelect\":[\"Count\"]},\"sources\":[\"Join_Account_Opportunity\",\"Filter_Closed_Tasks\"]},\"Add_Fields_to_OpportunityHistory\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"defaultValue\":\"\\\"1\\\"\",\"name\":\"Stage_isUpdated\",\"saqlExpression\":\"case when 'StageName' == 'StageNamePrev' then \\\"0\\\" else \\\"1\\\" end\",\"type\":\"Text\"},{\"defaultValue\":\"\\\"1\\\"\",\"name\":\"CloseDate_isUpdated\",\"saqlExpression\":\"case when 'CloseDatePrev' == 'CloseDate' then \\\"0\\\" else \\\"1\\\" end\",\"type\":\"Text\"},{\"defaultValue\":\"\\\"1\\\"\",\"name\":\"Amount_isUpdated\",\"saqlExpression\":\"case when 'AmountPrev' == 'Amount' then \\\"0\\\" else \\\"1\\\" end\",\"type\":\"Text\"},{\"name\":\"Amount_isIncreased\",\"precision\":8,\"saqlExpression\":\"case when 'AmountPrev' < 'Amount' then 1 else 0 end\",\"scale\":0,\"type\":\"Numeric\"},{\"name\":\"Amount_isDecreased\",\"precision\":8,\"saqlExpression\":\"case when 'AmountPrev' > 'Amount' then 1 else 0 end\",\"scale\":0,\"type\":\"Numeric\"},{\"label\":\"IsLastUpdate\",\"name\":\"IsLastUpdate\",\"saqlExpression\":\"case when 'ValidToDate' == \\\"3000-01-01T00:00:00.000Z\\\" then \\\"1\\\" else \\\"0\\\" end\",\"type\":\"Text\"},{\"name\":\"IsPushed\",\"precision\":8,\"saqlExpression\":\"case when ('CloseDatePrev_sec_epoch' > 0) && ('CloseDatePrev' < 'CloseDate') then 1 else 0 end\",\"scale\":0,\"type\":\"Numeric\"},{\"name\":\"IsPulled\",\"precision\":8,\"saqlExpression\":\"case when ('CloseDatePrev_sec_epoch' > 0) && ('CloseDatePrev' > 'CloseDate') then 1 else 0 end\",\"scale\":0,\"type\":\"Numeric\"},{\"label\":\"Duration\",\"name\":\"Duration\",\"precision\":18,\"saqlExpression\":\"case when 'ValidToDate' == \\\"3000-01-01T00:00:00.000Z\\\" then     date_diff(\\\"second\\\",toDate(ValidFromDate_sec_epoch), now())     else     date_diff(\\\"second\\\",toDate(ValidFromDate_sec_epoch), toDate(ValidToDate_sec_epoch))     end\",\"scale\":0,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_Historical_Trending_Fields\"]},\"Calculate Owner Tenure\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"Owner Tenure\",\"name\":\"OwnerTenure\",\"precision\":8,\"saqlExpression\":\"daysBetween(toDate(CreatedDate_sec_epoch), now())\",\"scale\":0,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Extract_User\"]},\"Join_Opportunity_Owner\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"OwnerId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"Owner\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Name\",\"OwnerTenure\",\"Role.Name\",\"CreatedDate\"]},\"sources\":[\"Compute_Fields_For_Opportunity\",\"Join_UserRole_User\"]},\"Extract_User\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Username\"},{\"name\":\"Name\"},{\"name\":\"FirstName\"},{\"name\":\"LastName\"},{\"name\":\"UserRoleId\"},{\"name\":\"UserType\"},{\"name\":\"IsActive\"},{\"name\":\"FullPhotoUrl\"},{\"name\":\"SmallPhotoUrl\"},{\"defaultValue\":\"N/A\",\"name\":\"ManagerId\"},{\"name\":\"CreatedDate\"}],\"object\":\"User\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Compute_Fields_For_Opportunity\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"Count\",\"name\":\"Count\",\"precision\":16,\"saqlExpression\":\"1\",\"scale\":0,\"type\":\"Numeric\"},{\"label\":\"Age\",\"name\":\"Age\",\"precision\":18,\"saqlExpression\":\"case    when IsClosed == \\\"false\\\"     then daysBetween(toDate(CreatedDate_sec_epoch), now())     else daysBetween(toDate(CreatedDate_sec_epoch),toDate(CloseDate_sec_epoch))     end\",\"scale\":0,\"type\":\"Numeric\"},{\"label\":\"Days Since Close\",\"name\":\"DaysSinceClose\",\"precision\":18,\"saqlExpression\":\"daysBetween(toDate(CloseDate_sec_epoch), now()) \",\"scale\":0,\"type\":\"Numeric\"},{\"label\":\"Account Tenure\",\"name\":\"AccountTenure\",\"precision\":16,\"saqlExpression\":\"daysBetween(toDate(FirstDealDate_sec_epoch), toDate(CreatedDate_sec_epoch) )\",\"scale\":0,\"type\":\"Numeric\"},{\"defaultValue\":\"0\",\"label\":\"DaysSinceLastWonDeal\",\"name\":\"DaysSinceLastWonDeal\",\"precision\":16,\"saqlExpression\":\"daysBetween(toDate(LastWonDealDate), toDate(CreatedDate_sec_epoch) )\",\"scale\":0,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Compute Account Based Metrics\"]},\"Join_UserRole_User\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"UserRoleId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"Role\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Name\"]},\"sources\":[\"Calculate Owner Tenure\",\"Extract_UserRole\"]},\"Compute_Event_IsClosed\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"IsClosed\",\"name\":\"IsClosed\",\"saqlExpression\":\"case when daysBetween(toDate(ActivityDate_sec_epoch), now()) >= 0 then \\\"true\\\" else \\\"false\\\" end\",\"type\":\"Text\"}],\"mergeWithSource\":true},\"sources\":[\"Extract_Event\"]},\"Extract_Opportunity_Line_Item\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"TotalPrice\"},{\"name\":\"PricebookEntryId\"},{\"name\":\"OpportunityId\"}],\"object\":\"OpportunityLineItem\"}},\"Join_Opportunity_History\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"Id\"],\"operation\":\"LookupMultiValue\",\"relationship\":\"History\",\"rightKey\":[\"OpportunityId\"],\"rightSelect\":[\"IsPushed\",\"Amount_isDecreased\",\"Amount_isIncreased\"]},\"sources\":[\"Join_Opportunity_Activities\",\"Add_Fields_to_OpportunityHistory\"]},\"Compute Account Based Metrics\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"expression\":{\"default\":\"0\",\"saqlExpression\":\"case when previous('IsWon') == \\\"true\\\" && previous('IsClosed') == \\\"true\\\" then previous('CountOfWonDeals') + 1 else previous('CountOfWonDeals') end\",\"type\":\"Numeric\",\"scale\":0},\"label\":\"# Won Opportunities on Account\",\"name\":\"CountOfWonDeals\"},{\"expression\":{\"default\":\"0\",\"saqlExpression\":\"case when previous('IsWon') == \\\"false\\\" && previous('IsClosed') == \\\"true\\\" then previous('CountOfLostDeals') + 1 else previous('CountOfLostDeals') end\",\"type\":\"Numeric\",\"scale\":0},\"label\":\"# Lost Opportunities on Account\",\"name\":\"CountOfLostDeals\"},{\"expression\":{\"default\":\"0\",\"saqlExpression\":\"case when previous('IsClosed') == \\\"true\\\" && previous('IsWon') == \\\"true\\\" then previous('CloseDate_sec_epoch') else previous('LastWonDealDate') end\",\"type\":\"Numeric\",\"scale\":0},\"label\":\"LastWonDealDate\",\"name\":\"LastWonDealDate\"},{\"expression\":{\"offset\":\"first()\",\"sourceField\":\"CreatedDate\"},\"label\":\"FirstDealDate\",\"name\":\"FirstDealDate\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"CreatedDate\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Join_RecordType_Opportunity\"]},\"Filter_Closed_Tasks\":{\"action\":\"filter\",\"parameters\":{\"saqlFilter\":\"'IsClosed'==\\\"true\\\"\"},\"sources\":[\"Compute_Fields_For_Tasks\"]},\"Relative_Find_Top_Product\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"expression\":{\"saqlExpression\":\"case when previous('TotalPrice') is null then \\\"true\\\" else \\\"false\\\" end\",\"type\":\"Text\"},\"label\":\"IsTopProduct\",\"name\":\"IsTopProduct\"}],\"orderBy\":[{\"direction\":\"desc\",\"name\":\"TotalPrice\"}],\"partitionBy\":[\"OpportunityId\"]},\"sources\":[\"Join_Line_Item_Product\"]},\"Filter_Final_Dataset\":{\"action\":\"filter\",\"parameters\":{\"saqlFilter\":\"'Age' > 0 && 'DaysSinceClose' <= 10000\"},\"sources\":[\"Join_Opportunity_Top_Product\"]},\"Filter_Top_Product\":{\"action\":\"filter\",\"parameters\":{\"saqlFilter\":\"'IsTopProduct'==\\\"true\\\"\"},\"sources\":[\"Relative_Find_Top_Product\"]},\"Compute_Historical_Trending_Fields\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"description\":\"Opportunity Created Date\",\"expression\":{\"offset\":\"first()\",\"sourceField\":\"CreatedDate\",\"default\":\"current()\"},\"label\":\"OpportunityCreatedDate\",\"name\":\"OpportunityCreatedDate\"},{\"description\":\"ValidToDate\",\"expression\":{\"offset\":\"next()\",\"sourceField\":\"CreatedDate\",\"default\":\"3000-01-01T00:00:00.000Z\"},\"label\":\"ValidToDate\",\"name\":\"ValidToDate\"},{\"description\":\"ValidFromDate\",\"expression\":{\"offset\":\"current()\",\"sourceField\":\"CreatedDate\",\"default\":\"current()\"},\"label\":\"ValidFromDate\",\"name\":\"ValidFromDate\"},{\"description\":\"AmountPrev\",\"expression\":{\"offset\":\"previous()\",\"sourceField\":\"Amount\",\"default\":\"0\"},\"label\":\"AmountPrev\",\"name\":\"AmountPrev\"},{\"description\":\"Previous Stage Name\",\"expression\":{\"offset\":\"previous()\",\"sourceField\":\"StageName\"},\"label\":\"Prev Stage Name\",\"name\":\"StageNamePrev\"},{\"description\":\"Previous Close Date\",\"expression\":{\"offset\":\"previous()\",\"sourceField\":\"CloseDate\",\"default\":\"1970-01-01\"},\"label\":\"Prev Close Date\",\"name\":\"CloseDatePrev\"},{\"description\":\"Previous Created Date\",\"expression\":{\"offset\":\"previous()\",\"sourceField\":\"CreatedDate\"},\"label\":\"Prev CreatedDate\",\"name\":\"CreatedDatePrev\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"Unique_Sort_Key\"}],\"partitionBy\":[\"OpportunityId\"]},\"sources\":[\"Add_Unique_Sort_Key_to_OpportunityHistory\"]},\"Extract_RecordTypes\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Name\"},{\"name\":\"Id\"}],\"object\":\"RecordType\"}},\"Extract_Account\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Name\"},{\"name\":\"OwnerId\"},{\"name\":\"NumberOfEmployees\"},{\"name\":\"AnnualRevenue\"},{\"name\":\"AccountSource\"},{\"name\":\"Type\"},{\"name\":\"Industry\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"name\":\"CreatedDate\"}],\"object\":\"Account\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Extract_PriceBookEntry\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Product2Id\"}],\"object\":\"PricebookEntry\"}},\"Extract_OpportunityHistory\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"description\":\"Amount\",\"label\":\"Amount\",\"name\":\"Amount\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"CloseDate\",\"name\":\"CloseDate\"},{\"name\":\"CreatedById\"},{\"description\":\"Opportunity Created Date\",\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"format\":\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\",\"label\":\"CreatedDate\",\"name\":\"CreatedDate\"},{\"name\":\"Id\"},{\"name\":\"IsDeleted\"},{\"name\":\"OpportunityId\"},{\"name\":\"StageName\"}],\"object\":\"OpportunityHistory\"}},\"Add_Unique_Sort_Key_to_OpportunityHistory\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"defaultValue\":\"'CreatedDate'\",\"name\":\"Unique_Sort_Key\",\"saqlExpression\":\"'CreatedDate' + \\\"-\\\" +  'Id'\",\"type\":\"Text\"}],\"mergeWithSource\":true},\"sources\":[\"Extract_OpportunityHistory\"]},\"Extract_UserRole\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Name\"},{\"name\":\"DeveloperName\"},{\"name\":\"ParentRoleId\"}],\"object\":\"UserRole\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Join_Opportunity_Top_Product\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"Id\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"TopProduct\",\"rightKey\":[\"OpportunityId\"],\"rightSelect\":[\"Product.Family\",\"Product.Name\"]},\"sources\":[\"Join_Opportunity_History\",\"Filter_Top_Product\"]},\"Join_Account_Opportunity\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"AccountId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"Account\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"AccountSource\",\"AnnualRevenue\",\"Industry\",\"NumberOfEmployees\",\"Type\"]},\"sources\":[\"Join_Opportunity_Owner\",\"Extract_Account\"]},\"Extract_Event\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"OwnerId\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"CreatedDate\",\"name\":\"CreatedDate\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"name\":\"LastModifiedDate\"},{\"firstDayOfWeek\":0,\"fiscalMonthOffset\":0,\"label\":\"ActivityDate\",\"name\":\"ActivityDate\"},{\"name\":\"Subject\"},{\"name\":\"DurationInMinutes\"},{\"name\":\"EventSubtype\"},{\"name\":\"WhatId\"},{\"name\":\"AccountId\"}],\"object\":\"Event\"}},\"Join_Line_Item_PriceBook\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"PricebookEntryId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"PriceBook\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Product2Id\"]},\"sources\":[\"Extract_Opportunity_Line_Item\",\"Extract_PriceBookEntry\"]},\"Register_Opportunity\":{\"action\":\"register\",\"parameters\":{\"label\":\"Opportunity Training Dataset\",\"name\":\"Opportunities\"},\"sources\":[\"Filter_Final_Dataset\"]}}}",null]