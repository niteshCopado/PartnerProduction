{"version":3,"sources":["app.js","labels_en.js","org.local.js","Utils/CacheManager.js","Utils/DateUtils.js","Utils/IdToValueCache.js","Utils/MathOperations.js","Utils/NumberUtils.js","Utils/RecordJobManager.js","ajax/ajax.js","assets/assets.5.js","assets/assets.routes.js","common/Util.js","common/common.js","contracts/contracts.routes.js","docgen/docgen.routes.js","favorites/favorites.5.js","favorites/favorites.routes.js","logging/AppLogger.js","perfMetrics/MetricsService.js","products/products.5.js","products/products.routes.js","quoteLogger/Publisher.js","quoteLogger/QuoteLogger.js","quoteLogger/Subscriber.js","quoteLogger/Utils.js","quoteLogger/WindowChannel.js","quoteLogger/main.js","quotes/QuoteContext.js","quotes/quotes.5.js","quotes/quotes.routes.js","subscriptions/subscriptions.5.js","subscriptions/subscriptions.routes.js","Utils/DAOs/BaseDAO.js","Utils/DAOs/DAOHelperMethods.js","Utils/DAOs/ProductDAO.js","Utils/DAOs/WhereClauseSplitter.js","Utils/Services/FieldMetadataService.js","Utils/Services/ServicesManager.js","common/behaviors/DeviceBehavior.js","common/behaviors/EventBehavior.js","common/behaviors/LookupBehavior.js","common/behaviors/SFInlineEditBehavior.js","common/behaviors/SFTableRowBehavior.js","common/behaviors/TemplatizationBehavior.js","common/core/AppContext.js","common/core/Events.js","common/core/History.js","common/core/Navigator.js","common/core/Page.js","common/formatter/Formatter.js","common/forms/DateParser.js","common/forms/DependentPicklistBuilder.js","common/forms/Locale.js","common/forms/NumberFormatter.js","common/forms/NumberParser.js","common/oauth/OAuth.js","common/oauth/oauth.local.js","common/relationship/RelationshipFieldManager.js","common/rules/QuoteRuleExecutor.js","common/rules/RuleEvaluator.js","common/rules/RuleExecutor.js","common/signal/AbstractFocusSignaler.js","common/signal/RowFocusSignaler.js","docgen/sb-docgen-preview/DocgenPreview.js","favorites/sb-favorite-lookup/FavoriteLookup.js","favorites/sb-favorite-share-dialog/FavoriteShareDialog.js","products/localization/LocalizeFields.js","quotes/column-sizing-dao/ColumnSizingDao.js","quotes/consumption-rate-validator/ConsumptionRateValidator.js","quotes/models/AssetQuantityValidator.js","quotes/models/ClientCache.js","quotes/models/ClientModels.js","quotes/models/Constants.js","quotes/models/CustomActionModel.js","quotes/models/DataHandlerBehavior.js","quotes/models/DiscountTierModel.js","quotes/models/DiscountTiersValidator.js","quotes/models/DragDropModel.js","quotes/models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/JSQCNotifier.js","quotes/models/LineModel.js","quotes/models/MDQSegmentHelper.js","quotes/models/QuoteMessenger.js","quotes/models/QuoteModel.js","quotes/models/SafeClientCache.js","quotes/models/SortLinesHandler.js","quotes/models/UiNotifier.js","quotes/precaching/IdConverter.js","quotes/precaching/JSQCPrecacheWorker.js","quotes/precaching/JSQCPrecacheWorkerManager.js","quotes/precaching/PrecacheRestClient.js","quotes/sb-le-custom-action-services/LECustomActionServices.js","quotes/sb-line-sort/QuoteLineSort.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/tables/QLESegmentedTableBehavior.js","quotes/tables/QLEStandardTableBehavior.js","quotes/tables/SFAbstractTable.js","quotes/tables/SFTableHeaderBehavior.js","quotes/ui-data-manager/UIDataManager.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","common/aggregate/quote-aggregator/QuoteAggregator.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","common/core/sb-i18n/I18n.js","common/core/sb-loading-spinner/LoadingSpinner.js","common/core/sb-page-container/PageContainer.js","common/core/sb-page-header/PageHeader.js","common/core/sb-router/Router.js","common/core/sb-toast/Toast.js","common/core/sf-loading-spinner/LoadingSpinner.js","common/data/cache/Cache.js","common/data/client/ConnectionClient.js","common/data/client/RemoteClient.js","common/data/client/RemoteSession.js","common/data/client/RestClient.js","common/data/client/ServiceClient.js","common/data/format/DataBuilder.js","common/data/format/ErrorFormatter.js","common/data/format/JsonFormatter.js","common/data/minimize/QuoteMinimizer.js","common/data/parse/JsonParser.js","common/data/sb-async-service/AsyncService.js","common/data/sb-describe/Describe.js","common/data/sb-service/Service.js","common/filter/searcher/Searcher.js","common/forms/sb-checkbox/Checkbox.js","common/forms/sb-date-range/DateRange.js","common/forms/sb-datepicker/Datepicker.js","common/forms/sb-discount/Discount.js","common/forms/sb-dual-list-box/DualListBox.js","common/forms/sb-field/Field.js","common/forms/sb-input/Input.js","common/forms/sb-lookup/Lookup.js","common/forms/sb-lookup-dialog/LookupDialog.js","common/forms/sb-multi-lookup/MultiLookup.js","common/forms/sb-pagination/Pagination.js","common/forms/sb-rte/RichTextEditor.js","common/forms/sb-search-bar/SearchBar.js","common/forms/sb-search-bar-dialog/SearchBarDialog.js","common/forms/sb-select/Select.js","common/forms/sb-textarea/Textarea.js","common/forms/sb-typeahead/Typeahead.js","common/layout/data/RecordGrouper.js","common/layout/fields/FieldHider.js","common/layout/fields/FieldSetHandler.js","common/layout/sb-actions/Actions.js","common/layout/sb-badge/Badge.js","common/layout/sb-dialog/Dialog.js","common/layout/sb-div/Div.js","common/layout/sb-field-item/FieldItem.js","common/layout/sb-field-table/FieldTable.js","common/layout/sb-filter-item/FilterItem.js","common/layout/sb-filter-layout/FilterLayout.js","common/layout/sb-group/Group.js","common/layout/sb-html/Html.js","common/layout/sb-lookup-layout/LookupLayout.js","common/layout/sb-popup/Popup.js","common/layout/sb-row-drawer/RowDrawer.js","common/layout/sb-side-panel/SidePanel.js","common/layout/sb-swipe-container/SwipeContainer.js","common/layout/sb-table-cell/TableCell.js","common/layout/sb-table-cell-select/TableCellSelect.js","common/layout/sb-table-header/TableHeader.js","common/layout/sb-table-row/TableRow.js","common/layout/sb-tabs/Tabs.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/RowFieldSelector.js","common/layout/tables/TableClassBuilder.js","common/rules/operators/OpContains.js","common/rules/operators/OpEndsWith.js","common/rules/operators/OpEquals.js","common/rules/operators/OpGreaterThan.js","common/rules/operators/OpGreaterThanEquals.js","common/rules/operators/OpLessThan.js","common/rules/operators/OpLessThanEquals.js","common/rules/operators/OpNotEquals.js","common/rules/operators/OpStartsWith.js","common/rules/operators/OperatorsUtils.js","common/services/sb-field-md/FieldMetadata.js","common/services/sb-job-checker/JobChecker.js","common/services/sb-line-editor-read/LineEditorReader.js","common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js","common/services/sb-search-model-load/SearchModelLoader.js","common/services/sb-search-model-select/SearchModelSelector.js","products/config/message/ProductMessenger.js","products/config/search/ConfiguratorSearch.js","products/config/viewmodel/ProductViewModel.js","products/resources/optionConstraints/OptionConstraintsHandler.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","products/resources/reconfigure/ProductReconfigurer.js","products/resources/rules/RuleProcessor.js","products/resources/sb-product-alert/ProductAlert.js","products/resources/tree/ConfigTree.js","quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js","quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js","quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js","quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js","quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js","quotes/dialogs/sb-pricing-guidance-dialog/PricingGuidanceDialog.js","quotes/layout/sb-cse-table-cell/CSETableCell.js","quotes/layout/sb-custom-action/CustomAction.js","quotes/layout/sb-ds-table-cell/DSTableCell.js","quotes/layout/sb-ds-tiers/DSTiers.js","quotes/layout/sb-field-set-table/FieldSetTable.js","quotes/layout/sb-field-set-table-item/FieldSetTableItem.js","quotes/layout/sb-le-drawer/LEDrawer.js","quotes/layout/sb-le-footer/LEFooter.js","quotes/layout/sb-le-group/LEGroup.js","quotes/layout/sb-le-group-layout/LEGroupLayout.js","quotes/layout/sb-le-list/LEList.js","quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js","quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js","quotes/layout/sb-le-list-row/LEListRow.js","quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js","quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js","quotes/layout/sb-le-summary-row/LESummaryRow.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/layout/sb-le-table-cell/LETableCell.js","quotes/layout/sb-le-table-cell/Localizer.js","quotes/layout/sb-le-table-cell/QuoteLineUpgradeHandler.js","quotes/layout/sb-le-table-cell/Swiper.js","quotes/layout/sb-le-table-header/LETableHeader.js","quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js","quotes/layout/sb-le-table-row/LETableRow.js","quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js","quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js","quotes/layout/sf-le-table-header/SFLETableHeader.js","quotes/layout/sf-le-table-row/ControllingField.js","quotes/layout/sf-le-table-row/DesktopDelegate.js","quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js","quotes/layout/sf-le-table-row/MobileDelegate.js","quotes/layout/sf-le-table-row/NonDiscountableControllingField.js","quotes/layout/sf-le-table-row/PriceEditableControllingField.js","quotes/layout/sf-le-table-row/PricingMethodControllingField.js","quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js","quotes/layout/sf-le-table-row/QLEDesktopDelegate.js","quotes/layout/sf-le-table-row/SFLETableRow.js","quotes/layout/sf-le-table-row/SubscriptionTypeControllingField.js","quotes/layout/sf-line-actions/SFLineActions.js","quotes/layout/sf-line-warning/SFLineWarning.js","quotes/layout/sf-preview-panel/PreviewPanel.js","quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js","quotes/layout/sf-table-header/SFTableHeader.js","quotes/layout/template-generator/LETableHeaderTemplateGenerator.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/ListItemTemplateGenerator.js","quotes/layout/template-generator/MobileLETemplateGenerator.js","quotes/layout/template-generator/TableHeaderTemplateGenerator.js","quotes/layout/template-generator/TableRowTemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/layout/ubp-rate-row/UBPDesktopDelegate.js","quotes/layout/ubp-rate-row/UBPRateRow.js","quotes/md/sb-le-field-md/LEFieldMD.js","quotes/pages/sb-line-editor/LineEditor.js","quotes/pages/sf-ubp-editor/UBPEditor.js","quotes/precaching/PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/MetadataSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/OptionSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/PriceRuleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/PricingGuidanceSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/ProductSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/RelatedRecordSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/UbpSequenceRunner.js","quotes/tables/sf-segmented-table/SFSegmentedTable.js","quotes/tables/sf-standard-table/SFStandardTable.js","quotes/tables/ubp-rate-table/UBPRateTable.js","assets/selection/routes/sb-asset-lookup/AssetLookup.js","assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js","common/forms/sb-checkbox/factory/CheckboxFactory.js","common/forms/sb-datepicker/factory/DatePickerFactory.js","common/forms/sb-discount/factory/DiscountFactory.js","common/forms/sb-field/factory/FieldFactory.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-field/factory/NumericFieldFactory.js","common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/TextFieldFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-lookup/factory/LookupFactory.js","common/forms/sb-lookup/map/LookupNameMapper.js","common/forms/sb-lookup/query/LookupQueryBuilder.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/forms/sb-rte/factory/RichTextEditorFactory.js","common/forms/sb-rte/imageDialog/RTEImageDialog.js","common/forms/sb-select/factory/SelectFactory.js","common/forms/sb-textarea/factory/TextareaFactory.js","contracts/selection/routes/sb-contract-lookup/ContractLookup.js","contracts/selection/routes/sf-contract-lookup-table/ContractLookupTable.js","products/config/actions/sb-custom-actions/CustomActions.js","products/config/attribute/sb-attribute-item/AttributeItem.js","products/config/attribute/sb-attribute-table/AttributeTable.js","products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js","products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js","products/config/feature/sb-product-feature/ProductFeature.js","products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js","products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js","products/config/feature/sb-product-feature-list/ProductFeatureList.js","products/config/option/sb-option-cell/OptionCell.js","products/config/option/sb-option-drawer/OptionDrawer.js","products/config/option/sb-product-option-table/ProductOptionTable.js","products/config/routes/sb-dynamic-lookup/DynamicLookup.js","products/config/routes/sb-option-lookup/OptionLookup.js","products/config/routes/sb-product-config/ProductConfig.js","products/resources/model/nestedOptions/NestedOptionsModel.js","products/selection/filter/sb-suggester/Suggester.js","products/selection/routes/sb-product-lookup/ProductLookup.js","quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js","quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js","quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js","subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js","products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js","products/config/routes/services/sb-pc-option-save/OptionSaver.js","products/config/routes/services/sb-pc-product-load/ProductLoader.js","products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js"],"names":["docgen","quotes","assets","contracts","subscriptions","products","favorites","AppContext","I18n","Router","pageContainer","dbName","settingsObj","urls","r","PREFIX","ROUTES","allRoutes","Promise","all","init","App","_initIntlLocale","intl","locale","url","res","rej","xhr","XMLHttpRequest","getURL","open","onerror","e","Error","ontimeout","onload","responseText","data","JSON","parse","addLocaleData","Intl","__addLocaleData","spinner","document","getElementById","errorToast","label","messages","show","statusText","send","LABELS","Apply","Asset Selection","Cancel","Clear Fields","Filter","Select","None","searchText","lookupQueryError","FieldSetWarning","numResults","Save","Background color","Block quote","Bold","Bullet list","Clear formatting","Decrease indent","Edit Description","Font family","Font size","Header size","Unsupported HTML tags detected","Increase indent","Insert or edit image","Insert or edit link","Italic","Numbered list","Redo","Strikethrough","Subscript","Superscript","Align left","Center","Align right","Text color","Underline","Undo","Constrain proportions","Dimensions","Insert image","Source","Search Products","Product Search","Select All","Popup","Add Products","Delete","Favorite Lookup","Select & Add More","Share","Share Favorites","Attributes","Options","showAvailableUpgrades","No visible options in feature","Features","Add Options","Add","Configure Products","Configuration Attribute Error","Configuration Error","Maximum Quantity Error","Add to Cart","Categories","Description","Go","My Favorites","Price","Product Code","Product Name","Start Over","Alert","Continue","Return to Quote","Contract Selection","Select Contract","Active Contracts","Evergreen Contracts","Skip","Favorites","Guided Selling","Product Filter","Product Selection","Suggest","Available Groups","Clone To Groups","Select Groups","Selected Groups","Custom Segments","Discount Schedule Editor","Update","Add to Favorites","Favorite Name","Choose Price Book","Details","Total","Quote Total","Add To Favorite","Click to edit description","emptyLinesMsg","mobileEmptyLinesMsg","Remove From Favorites","Segmented Products","Standard Products","Subtotal","invalidPricebookEntry","missingOpportunityLineItem","pesterPSLAssignment","Edit Quote","emptyGroupedQuoteMsg","emptyQuoteMsg","fullScreenMode","Reset_Column_Widths","Accept Recommendation","Explanation","Floor","Norm","Pricing Guidance","PricingGuidanceNotAvailable","Target","Back to Quote","There_are_unsaved_changes_in_one_or_more_of_your_categories","Leave_page_without_updating","Consumption Schedule","Never Mind","msg_cannot_delete_group","msg_confirm_group_delete","msg_confirm_remove_favorite","msg_confirm_remove_group_from_favorites","msg_missing_pricebook_id","Consumption Schedule Name","Items_Sorted_by","Search Consumption Schedule Name","There are no rates that match your search criteria","Your_search_term_must_have_2_or_more_characters","Subscription Selection","Quick Save and Continue","settings","developerPrefix","isMultiCurrencyOrg","calculateImmediately","language","defaultCurrency","currencySymbol","currencyDecimalScale","fullName","userName","userId","device","isOAuth","additionalLookupSearchTypes","oik","maxLookupSearchFields","isJSProductRulesEnabled","hasQuoteSelectionProductRules","isBundleCollapsible","isPricingGuidanceEnabled","defaultBundleSetting","isColumnResizingEnabled","isManualEditsForUBPEnabled","CacheManager","logger","trace","this","_caches","Map","require","getLogger","prototype","getCache","name","cacheClass","debug","window","process","mainModule","filename","endsWith","_createCacheInstance","cache","get","set","cacheName","warn","_typeof","flushCaches","resetCaches","forEach","value","clear","CACHE_MANAGER_KEY","Symbol","for","globalRef","global","self","globalSymbols","Object","getOwnPropertySymbols","indexOf","_cacheManager","freeze","module","exports","cacheManager","toApexDate","date","toISOString","replace","RegExp","toApexDateTime","dateTime","dateIso","slice","length","toUTCDateString","timezone","getTimezoneOffset","Date","setMinutes","getMinutes","parseInt","toLocaleDateString","distinguishDateFromDateTime","dateString","dateRegex","dateTimeRegex","test","monthsBetween","startDate","endDate","result","getUTCFullYear","getUTCMonth","monthsBetweenRoundPartialUp","getTime","addMonths","daysBetween","msDiff","Math","round","numMonths","currentMonth","setUTCMonth","trueMonth","setUTCDate","addDays","numDays","getUTCDate","daysBetweenIgnoringLeapYearDays","numLeapDays","getNumberOfLeapDays","year","startYear","endYear","i","leapDay","containsLeapDay","numberOfMonthsInFixedMdqDimension","dimType","toLowerCase","countDaysInMonth","month","getDate","isEndOfMonth","moveToEndOfMonth","IdToValueCache","_classCallCheck","_len","arguments","args","Array","_key","_innerMap","key","has","val","callback","entries","values","delete","keys","iterator","size","correctionFactor","reduce","prev","next","x","parts","toFixed","toString","split","pow","multiplier","Infinity","correctedValue","corrFactor","reduceArray","arr","func","previousValue","currentValue","index","array","liberate","Function","bind","call","MathOperations","add","isArray","apply","accum","curr","currI","O","sub","first","mul","div","setScale","num","scale","exp","multiply","subtract","divide","RecordJobManager","conn","prefix","_conn","serviceRouterPrefix","_serviceRouterUrl","_setJobStatusProvider","_setJobsStatusProvider","updateJobStatus","recordId","jobType","jobStatus","jobDetails","targetId","context","saver","model","stringify","apexRestCallStartTime","now","info","apex","post","then","apexRestCallEndTime","catch","err","reject","message","updateJobsStatus","recordIds","SB","ajax","System","register","_export","_context","setters","execute","/lookup","comp","mod","/upgrade","immutableSet","response","undefined","concat","_toConsumableArray","recordSet","record","item","start","deleteCount","items","path","pathRec","depth","oldSub","newSub","isNaN","mergeRec","oldVal","newVal","map","nv","ind","field","dateObj","substring","fields","attributes","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","done","return","ids","models","idSet","Set","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","val1","val2","obj","n","width","z","join","d","Util","pad","getUTCHours","getUTCMinutes","getUTCSeconds","ctxComponent","object","strProp","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","prop","notifyPath","fieldValue","filterValue","operator","startsWith","includes","text","elem","additionalOffset","setTimeout","rightBound","getBoundingClientRect","left","innerWidth","style","offsetLeft","frame","createElement","body","appendChild","contentWindow","parentNode","removeChild","Polymer","holdTimer","Gestures","deps","flow","end","emits","mouseup","up","touchend","changedTouches","clearTimeout","mousedown","down","touchstart","preventer","fire","findOriginalTarget","clientX","y","clientY","sourceEvent","/preview","_favoritesSbFavoriteLookupFavoriteLookupJs","_favoritesSbFavoriteShareDialogFavoriteShareDialogJs","ServiceClient","AppLogger","client","LOG_TYPE","LOAD_QLE","RESIZE_COLUMN","RESET_COLUMN","PRICING_GUIDANCE","eventType","payload","Visualforce","logLines","code","recordId_qtqle","osName_qtqle","_getOSType","deviceModel_qtqle","_getDeviceModel","browserName_qtqle","_getBrowserType","eventType_qtqle","payload_qtqle","requestPost","console","error","mask","org","userAgent","navigator","MetricsService","salesforceBaseUrl","msg","canGatherMetrics","_isNotStarted","_init","_queueIdleCallback","log","actionName","additionalInfo","sb","internal","sptNum","id","_getUniqueId","actions","_buildTransportAction","metrics","_externalLogMetrics","assign","actionDefs","pageStartTime","ts","_getTime","ns","sptTime","idleRetries","idleStart","idleTime","_populateTransportAction","entityId","perfNow","_getPageStartTime","visibilityStateEnd","visibilityState","bootstrap","visibilityStateStart","performance","timing","p","pt","additionalMetrics","readyStart","fetchStart","navigationStart","lookupDomainTime","domainLookupEnd","domainLookupStart","connectTime","connectEnd","connectStart","requestTime","responseEnd","requestStart","initDomTreeTime","domInteractive","domReadyTime","domComplete","loadEventTime","loadEventEnd","loadEventStart","loadTime","unloadEventTime","unloadEventEnd","unloadEventStart","appCacheTime","redirectTime","redirectEnd","redirectStart","toJSON","getEntries","resource","summaryRequest","_summarizeResourcePerfInfo","push","lastIdleEndTime","currentPage","ept","bpt","spt","page","app","appName","appType","location","href","entity","_calcAndDisplayMetrics","_logMetrics","initiatorType","duration","startTime","dns","tcp","ttfb","responseStart","transfer","transferSize","encodedBodySize","decodedBodySize","transportAction","requestIdleCallback","_idle","eptTime","bptTime","transports","allResources","getEntriesByType","_step$value","_slicedToArray","filter","marks","transport","_canDisplayMetrics","metricsChangedEvent","CustomEvent","detail","dispatchEvent","apiHost","m","exec","retry","withCredentials","onreadystatechange","readyState","DONE","status","getAllResponseHeaders","hostname","_normalizeApiHost","host","protocol","defaultAttrs","pkgVersion","apiVersion","version","logName","logLevel","logAttrs","attrsId","resources","bootstrapEPT","allRequests","formData","FormData","append","URL","URLSearchParams","search","_getRandomInt","min","max","floor","random","_productsConfigAttributeSbAttributeItemAttributeItemJs","_productsConfigAttributeSbAttributeTableAttributeTableJs","_productsConfigBundlesSbProductBundlesLayoutProductBundlesLayoutJs","_productsConfigBundlesSbProductBundlesFilterItemProductBundlesFilterItemJs","_productsConfigFeatureSbProductFeatureProductFeatureJs","_productsConfigFeatureSbProductFeatureLayoutProductFeatureLayoutJs","_productsConfigFeatureSbProductFeatureCategoryListProductFeatureCategoryListJs","_productsConfigFeatureSbProductFeatureListProductFeatureListJs","_productsConfigOptionSbProductOptionTableProductOptionTableJs","_productsConfigOptionSbOptionCellOptionCellJs","_productsConfigOptionSbOptionDrawerOptionDrawerJs","_productsConfigRoutesServicesSbPcProductLoadProductLoaderJs","_productsConfigRoutesServicesSbPcOptionSaveOptionSaverJs","_productsConfigRoutesServicesSbProductRulesInvokeProductRulesInvokerJs","_productsConfigRoutesServicesSbPcOptionConfigureOptionConfiguratorJs","_productsConfigActionsSbCustomActionsCustomActionsJs","_productsLocalizationLocalizeFieldsJs","_productsResourcesSbProductAlertProductAlertJs","/dl","/ol","/pc","/search","Utils","Publisher","tag","channel","isValidChannel","msgQueue","_publishOnceReady","shutdown","_this","isReady","Subscriber","WindowChannel","QuoteLogger","subChannel","pubChannel","subscriber","TAG","publisher","isSubscriber","isPublisher","callbacks","SYN","type","TYPE_SYN","ACK","TYPE_ACK","logEvent","instance","makeLogFromArgs","timestamp","_publish","appender","inst","subscribe","_receiveLog","_waitForWindow","loc","splice","publish","_this2","source","markReady","cb","isActive","addListener","_receiveMessage","CHANNEL_INTERFACE","bools","acc","reduceAnd","funName","logData","win","active","ready","readyCallbacks","listeners","_receive","readyCallback","addEventListener","closed","origin","_getTargetOrigin","postMessage","removeEventListener","messageEvent","_isValidSourceOrigin","sourceOrigin","constants","ADDITIONAL_DISCOUNT_FIELD","MARKUP_FIELD","LIST_PRICE_FIELD","PRODUCT_NAME_FIELD","NET_TOTAL_FIELD","SUBSCRIPTION_SCOPE_FIELD","fieldEditability","FIELDS","UBP_FIELDS","ConsumptionRateFields","_arr","UpperBound","LowerBound","_i","f","QuoteContext","_quotesPagesSbLineEditorLineEditorJs","_quotesPagesSfUbpEditorUBPEditorJs","_quotesSbLeCustomActionServicesLECustomActionServicesJs","_quotesMdSbLeFieldMdLEFieldMDJs","_quotesLayoutSbLeGroupLEGroupJs","_quotesLayoutSfPreviewPanelPreviewPanelJs","_quotesTablesSfStandardTableSFStandardTableJs","_quotesTablesSfSegmentedTableSFSegmentedTableJs","_quotesTablesUbpRateTableUBPRateTableJs","_quotesLayoutSfSegmentedCellTooltipSFSegmentedCellTooltipJs","_quotesLayoutSbSegmentedLineDetailsSegmentedLineDetailsJs","_quotesLayoutSbSegmentedDetailRowSegmentedDetailRowJs","_quotesLayoutSfTableHeaderSFTableHeaderJs","_quotesLayoutSfLeTableHeaderSFLETableHeaderJs","_quotesLayoutSfLeTableRowSFLETableRowJs","_quotesLayoutSfLineActionsSFLineActionsJs","_quotesLayoutSfLineWarningSFLineWarningJs","_quotesLayoutSbLeTableCellLETableCellJs","_quotesLayoutSbDsTableCellDSTableCellJs","_quotesLayoutSbDsTiersDSTiersJs","_quotesLayoutSbLeTableHeaderLETableHeaderJs","_quotesLayoutSbLeTableHeaderCellLETableHeaderCellJs","_quotesLayoutSbLeFooterLEFooterJs","_quotesLayoutSbLeGroupLayoutLEGroupLayoutJs","_quotesLayoutSbLeListLEListJs","_quotesLayoutSbLeListRowLEListRowJs","_quotesLayoutSbLeListGroupHeaderRowLEListGroupHeaderRowJs","_quotesLayoutSbLeListGroupFooterRowLEListGroupFooterRowJs","_quotesLayoutSbLeListStandardLineRowLEListStandardLineRowJs","_quotesLayoutSbLeListSegmentedLineRowLEListSegmentedLineRowJs","_quotesLayoutSbFieldSetTableItemFieldSetTableItemJs","_quotesLayoutSbFieldSetTableFieldSetTableJs","_quotesLayoutSbLeDrawerLEDrawerJs","_quotesLayoutSbLineEditorTabsSbQuoteTabsQuoteTabsJs","_quotesLayoutSbLineEditorTabsSbGroupTabsGroupTabsJs","_quotesLayoutSbCustomActionCustomActionJs","_quotesLayoutSbLeSummaryRowLESummaryRowJs","_quotesLayoutSbLeSummaryRowSbLeSummaryCellLESummaryCellJs","_quotesLayoutUbpRateRowUBPRateRowJs","_quotesDialogsSbFavoriteDialogFavoriteDialogJs","_quotesDialogsSbPricingGuidanceDialogPricingGuidanceDialogJs","_quotesDialogsSbCloneToGroupDialogCloneToGroupDialogJs","_quotesDialogsSbCustomSegmentDialogCustomSegmentDialogJs","_quotesLayoutSbCseTableCellCSETableCellJs","_quotesDialogsSbPricebookDialogPricebookDialogJs","_quotesModelsDragDropModelJs","_quotesDialogsSbDiscountScheduleDialogDiscountScheduleDialogJs","_quotesUsageBasedPricingDaoUsageBasedPricingDaoJs","_quotesConsumptionRateValidatorConsumptionRateValidatorJs","/le","BaseDAO","labels","_labels","_QUERY_LENGTH_LIMIT","_WHERE_CLAUSE_LENGTH_LIMIT","_logger","jsLogger","WhereClauseSplitter","query","BaseSubqueryDescriptor","selectedFields","totalQueryLength","selectClause","uniqueSelectedFields","charsUntilLimitReached","maxWhereLength","objectType","fullWhereClause","subqueryDescriptor","orderbyArray","selectDescriptor","_constructSelectClauseAndCalculateRemainingLength","whereSplitDescriptor","splitWhereClause","partialWhereClauses","clauses","queryPromises","specificityPreserved","partialWhereClause","sobject","select","where","addSubqueriesToQuery","orderby","autoFetch","maxFetch","Number","POSITIVE_INFINITY","queryResultsArrays","_reconcileQueryResultsWithWhereClauses","_simplifyAndRethrowQueryError","fullMsg","msgLines","firstLineEmpty","thirdLineIsCaratAndWhitespace","fourthLineFitsPattern","fifthLineFitsPattern","matches","errTemplate","msg_missing_perm","queryResultArrays","whereClauseDescriptors","results","queryResults","Id","_ret","idx","currentCombinedResults","currentKeyLists","splitKeyLists","keysByDepth","splitKeysMappedByMaxDepth","_loop","newCombinedResults","newKeyLists","keysToSeek","primaryIndexesBySplitKey","combinationInfoByPrimaryIndex","keyList","listIdx","splitKey","secondaryIdxs","primaryIndex","combInfo","primaryIdx","primaryResults","secondaryResults","combinedResults","resultList","tmpIdSet","resultLists","v","properlyPrefixFields","fieldList","ProductSubqueryDescriptor","opts","_possibleConstructorReturn","__proto__","getPrototypeOf","_opts","_salesCloudPrefix","_includeCosts","_includePriceEntries","_includeDimensions","_includeBlockPrices","_filteredPricebooks","_filteredCurrencyCodes","_includeOptionsByOptionalSKU","_mappableOptionFields","_initialized","ProductDAO","services","_this3","_prefix","_services","_cache","DAOHelperMethods","PRODUCT_FIELDS","PRICEBOOK_ENTRY_FIELDS","COST_FIELDS","OPTION_FIELDS","DIMENSION_FIELDS","BLOCKPRICE_FIELDS","includeJSQCSubqueries","pricebookIds","existingFilters","currencyCodes","resolve","initPromises","lineType","optionType","fieldMetadataService","getSharedMappableFieldNames","relationship","whereArray","orderByArray","include","pricebookString","currencyCodeString","costFields","_addSubquery","optionFields","dimensionFields","priceEntryFields","allowInactivePrices","blockPriceFields","overageRateFieldName","_this4","_logMessage","getSharedMappableFieldNamesStartTime","_mappableFields","subqueryInfo","_this5","uniqueIds","loadProductsStartTime","initStartTime","_getProductsByIds","errHeader","errorHeader","outerCacheKey","_getHashKey","extraFields","productsRequiringQuery","cachedResultsForSubquery","_queryAndCacheProducts","productIds","cacheKey","_this6","productFields","whereClause","_constructAndPerformQuery","precachedResults","product","jsarSettings","salesCloudPrefix","msg_amendrenew_err_loading_products","calcSettings","referencedFieldMap","jsqcSettings","devPrefix","getLabelByKey","jsqcLabels","DAO","SubqueryDescriptor","_overallSpecificityPreserved","_nextNodeKey","_semiJoinRegex","_semiJoinMap","_semiJoinCounter","_semiJoinReplacementFormat","_unescapedDateRegex","_unescapedDateMap","_unescapedDateCounter","_unescapedDateReplacementFormat","_nestedLookupRegex","_nestedLookupMap","_nestedLookupCounter","_nestedLookupReplacementFormat","maxLength","fakeQueryString","_makeWhereClauseParsable","fullAst","whereAst","_recursivelySetLengthOnAstNodes","preserveOverallSpecificity","_recursivelySetMinLengthOnAstNodes","minLength","splitWhereAsts","_recursivelySplitUntilTargetSizeReached","splitWhereClauses","splitKeyMaxDepthMap","splitWhereAst","_restoreUnparsableCharacters","splitNodeKeys","nodeKey","_resetModificationInformation","_storeAndReplaceNestedLookups","_storeAndReplaceUnescapedDates","_storeAndReplaceSemiJoins","modifiedWhereClause","mapList","_step2$value","replacementString","original","replacementFindingRegex","matchesByIndex","match","semiJoinLengthsByStartIndex","whereClauseIterator","iter","stringDelimiterArray","parenBalance","capturingSemiJoin","semiJoinLength","semiJoinStartIndex","matchesProcessed","shift","unshift","sliceStartPoint","_step3$value","len","semiJoin","semiJoinReplacement","_storeAndReplaceUnparsableSubstrings","regex","replacementFormat","storedValueMap","storedValueCounter","whereIterator","matchCounter","unparsableValue","replacementValue","ast","leftLength","rightLength","right","operatorLength","valueNode","column","table","prospectiveReplacementKey","paren","effectiveMinimumSize","lengths","subAst","performDefaultSplit","minLeftOrLength","minRightOrLength","largerMin","targetSize","partialLists","currentPartialListSize","currentPartialListIndex","splitListExpressions","copiedListExpression","leftTargetLength","rightTargetLength","splitLeftAsts","splitRightAsts","leftSideSplitSufficient","rightSideSplitSufficient","fullLeftSplit","combinedAnds","copiedAnd","targetOrSize","splitLeftSide","splitRightSide","splitOrs","or","subTree","inherentInLength","splitLists","splitIns","splitNodeKey","list","copiedIn","FieldMetadataService","fmsSettings","_serviceCloudPrefix","serviceCloudPrefix","_userId","inBrowser","globalCache","srcType","destType","srcPromise","getMappableFields","destPromise","arrs","sharedFields","srcFields","fieldArray","destFields","fieldMap","srcFieldCount","srcField","destField","_fieldsAreCompatible","reason","objType","_getObjectDescribe","objDescribe","mappableFieldSummary","_sweepDescribeForMappableFields","header","msg_could_not_retrieve_mappable_fields","cachedApiNamesByGenericName","existentFieldsMap","unknownFields","objDesc","fieldCount","fieldDesc","indexOfMatchingUnknownField","findIndex","matchingUnknownField","el","nonexistentField","fieldName","fieldDescribe","find","noSuchFieldMessage","msg_no_such_field","msgHeader","msg_could_not_retrieve_field_describe","updateable","msg_could_not_retrieve_crud","jsForceStartTime","describe","sobjectData","mfArray","mfMap","_isFieldMappable","custom","lcName","referenceTo","ServicesManager","scSettings","deviceClasses","currentTime","totalComponents","totalTime","deviceNodes","dom","root","querySelectorAll","getDeviceClasses","deviceClass","toggleClass","deviceNode","hasInitialized","userSettings","isPhone","isTablet","time","tagName","DeviceBehavior","CommonBehaviors","_eventBehaviorInitialized","events","_eventBehaviorListeners","boundFunction","EventBehavior","handleProductsLoadServerResponse","handleHideSearchFilterIfNoSearchColumnsDisplayed","bindFilterEnterCallBacks","removeFilter","LookupBehavior","Formatter","DateParser","NumberParser","TemplateGenerator","SFAbstractTable","container","isEdit","isEditOnFocus","suppressCalculateImmediately","classList","contains","getAttribute","metadata","_getFieldMetadataForInlineEdit","extraTypeInfo","toggleInlineEditForDeviceDelegate","_discardPendingEdit","committed","_pendingEdit","eventDetail","parsedValue","_parseFieldData","commitInlineEdit","handleControllingPicklistAndFields","fireCalculateImmediately","_getRecord","detailValue","i18n","parseTime","writeElem","className","_createEditField","horizontalBound","parentElement","editField","_getEditField","templateData","attachTo","templateInstance","hydrateTemplate","html","newValue","originalValues","_getOriginalRecord","checkIsDirty","_isEditable","classNames","DIRTY","isDirty","remove","from","toggle","recordValues","querySelector","_enableDirtyClass","forceLoad","_pencilLoaded","editableCells","cellsArr","cell","pencilSpan","EDIT_ICON","RIGHT","CENTER","readElem","insertBefore","firstChild","dataIndex","evt","findCell","getCellClass","_getFieldMetadata","toggleInlineEdit","_applyFocus","isMobile","RenderStatus","afterNextRender","commitPendingEdit","_deviceDelegate","_updateEditableField","SFInlineEditBehavior","getContentNode","cells","children","hook_onHovered","hook_onUnhovered","handled","tableComp","getTableComponent","isEditable","EDITABLE","isBoolean","BOOLEAN","isFocused","HAS_FOCUS","isEditing","EDIT_MODE","applyCellFocus","setEditOnFocus","paths","findEditIcon","hook_onTap","pathElem","tagname","toUpperCase","$$","event","clazz","SFTableRowBehavior","templateHTML","template","innerHTML","isTemplatizeWithRootDivNode","templatize","stamp","templateNode","content","_populateContent","uiData","hydrateTemplateFromNode","cloneNode","postPopulateContent","secondaryTemplateInstance","observer","String","TemplatizationBehavior","getLabels","user","ui","common","core","l","replaceWildcards","buildUserAndOrgFromSettings","import","ret","userAndOrgSettingsSet","lang","fullname","username","inCommunity","hasQuoteEditPermission","scPrefix","scDeveloperPrefix","isServiceCloudEnabled","quantityScale","orgUrl","orgInstanceUrl","siteUrl","isUI3Enabled","isCompactModeEnabled","ua","editorModel","bundleKeptTogether","largeQuoteExperienceEnabled","isProductHierarchyVisualized","deviceContext","isDesktop","properties","Events","AUTO_LAUNCH_POPUP","BUILD_LAYOUT","CLEAR_PRODUCT_FILTER","CLOSE_GROUP_PANEL","CLOSE_LOOKUP_DIALOG","COL_WIDTHS_CHANGED","DELETE_GROUPS","DESELECT_CHECKBOX","GROUP_ADDED","GROUP_DELETED","GROUP_PANEL_CREATED","GROUP_PANEL_TOGGLED","GROUP_TOGGLED","IRON_LIST_RESIZED","LINE_SPLICE_COMPLETE","NAVIGATION_CHANGED","OPEN_LOOKUP_DIALOG","OPEN_RTE_DIALOG","OPEN_SEARCH_BAR_DIALOG","PAGE_RESIZED","PANEL_CLOSED","QUOTE_SAVED","REFRESH_LINE_ACTIONS","REFRESH_TABLE","RENDER_NEW_TAB","RESET_ON_ACTION","RESET_COL_SIZES","ROWS_RENUMBERED","SCHEDULE_ACTION","SORT_LINES_REQUIRED","TOGGLE_OPTIONAL_CLICKED","TOGGLE_PANEL_CLICKED","UPDATE_IRON_LIST","VIEWPORT_CHANGED","UBP_ROW_REFRESH","TOGGLE_QUICKSAVE","COL_SIZE_ERR","GENERIC_ERROR","MDQ_LINE_DELETED","stack","forceTrackHistory","current","_trackHistory","_parsePath","pop","currentPath","nextPath","forceHistoryPath","startIndex","History","fireEvent","queryParams","pathParams","newWin","component","_getLocation","hash","_nav","defaultQueryParams","defaultPathParams","popPath","u","pLen","pKeys","kLen","encodeURIComponent","Navigator","PageContainer","nav","Base","extend","ctx","viewport","getViewport","Page","NumberFormatter","Html","getUnitAndDisplayValue","updateUnitIfAmountInactive","rawData","fieldMetadata","dataType","formatter","isDiscountField","isMarkupField","format","formatDiscountField","formatTime","formatReferenceField","sanitizeHtmlText","calculatedFormula","containsMarkup","formatPicklistData","picklistValues","pickListValue","findPickListValue","_pickListValuesMap","plValue","numFormatter","_getUnitAndDisplayVal","displayValue","units","unit","selectedUnit","unitLabel","relationshipName","Name","stripTime","dateTimeFormatSimple","getLocaleData","formats","dateFormats","yMd","separator","dateTimeElements","dateIdx","monthIdx","yearIdx","dateStr","isValidYearFunction","_isValidYear","invalid","elements","day","monthEnd","UTC","DependentPicklistBuilder","controlledPicklist","controllingValue","options","validOptions","option","_testBit","atob","validFor","_getControllingValueIndex","controllingField","controllingOptions","controllingValueIndex","byteToCheck","bit","charCodeAt","COMMA_DECIMAL_LOCALES","Locale","editable","appContext","allowUnits","minimumFractionDigits","maximumFractionDigits","_setCurrencyFormatOptions","_setPercentFormatOptions","isCommaDecimal","useGrouping","isNil","formattedValue","currency","CurrencyIsoCode","currencyDisplay","isCommaDecimalLocale","numberStr","strict","applyScale","removeUnusualSeparators","removeNonDecimalCommas","removeDecimalSepartors","replaceCommaDecimalWithPeriod","number","parseFloat","NaN","OAUTH_KEY","OAUTH_SECRET","PRIVATE_API_SECRET","OAUTH_PROXY_URL","OAUTH_LOGIN_URL","OAuth","tokens","oauth2","clientId","clientSecret","_getNoOAuthClientKeyMessage","storeTokens","jsforce","browser","Client","_storeTokens","params","localStorage","setItem","refresh_token","removeTokens","_removeTokens","removeItem","getTokens","_getTokens","refreshToken","getItem","isLoggedIn","connection","cookie","OAuth2","_refresAccessToken","port","redirectUri","proxyUrl","loginUrl","login","once","accessToken","_transport","httpRequest","method","headers","SalesforceProxy-Endpoint","tokenServiceUrl","Content-Type","statusCode","error_description","thenCall","instanceUrl","userInfo","_getParameterByName","instance_url","access_token","issued_at","decodeURIComponent","LookupNameMapper","RelationshipFieldManager","getValueCallback","setValueCallback","_validateConstructorInputs","getRelationship","relationshipField","getRelationshipField","nameField","_getLookupName","display","tableName","buildRelationship","getNameField","relationshipTable","TypeError","idField","RuleExecutor","RuleEvaluator","QuoteRuleExecutor","quote","rules","errorStrings","requiredProductIds","lineItemsById","lineItems","line","PRODUCT","ruleEvaluator","rule","isRuleSatisfied","ACTIONS","records","action","_conditionallyAddToResponseObject","responseType","TYPE","_productAdded","productId","OperatorsUtils","_setConstants","_setAliasedFieldsMap","ERROR_CONDITIONS","TESTED_VARIABLE","CONDITIONS_MET","TESTED_OBJECT","TESTED_FIELD","FILTER_VALUE","FILTER_TYPE","OPERATOR","aliasedFieldsMap","Quote","Group Line Items","_hasActions","_hasErrorConditions","conditionsMet","condition","testedVariable","testedObject","conditionDetails","packageConditionDetails","evaluateCondition","evaluateCollection","lineItemGroups","_throwError","msg_jspr_err_summary_variable_used","msg_jspr_err_no_tested_object","_canReturnImmediately","op","getInstance","errorMsg","msg_jspr_err_invalid_operator","collection","collectionResult","target","testedValue","_getValue","evaluate","testedField","aliasedField","msg_jspr_err_no_tested_field","totalSize","actionType","AbstractFocusSignaler","element","focusEvents","blurEvents","signalName","unregister","fireFocusSignal","_fireSignal","fireBlurSignal","focusEvent","blurEvent","focused","_fireSignals","lastSignaler","_getLastSignaler","_setLastSignaler","_toggleDisabled","_isDisabled","fireSignal","targets","getSignalTargets","signaler","last","disabled","RowFieldSelector","RowFocusSignaler","row","groupId","cellName","rowId","rowIndex","rowIndexAttribute","ironList","groupIds","constructor","group","selector","selectNextEditableField","selectPreviousEditableField","selectFirstEditableField","selectLastEditableField","signal","rowName","selectFirstEditableFieldInFirstRow","rowNum","selectLastEditableFieldInLastRow","templates","title","is","DocgenPreview","clearReferencesToIds","QuoteLineAggregator","DataBuilder","formatError","Constants","lineEditorModel","favoriteModel","selectedFavorites","errors","notify","qId","aId","groupKey","Boolean","_isMobileViewport","$","le","md","_setMetaData","fm","_setSelected","addFavorite","partialVO","_recombinePartialQuoteWithFullQuote","_toggleSelected","addMore","jspr","selected","shareFavorites","groups","users","build","_handleOneFavoriteSelected","_handleAllFavoritesSelected","partialQuote","originalLines","segmentTemplatesByDimensionTypeByGroupKey","emptyGroupKeys","cols","colsDisplay","desc","primaryMobileCols","fieldLabels","favorite","bool","rows","tbody","toDelete","favoriteIds","deleteFavorite","save","FAVORITE_ID_FIELD","shareFavorite","dialog","largeQuoteThreshold","largeQuoteMessage","customLabels","msg_large_quote_sent_without_lines","_minimizeQuoteVO","addQuote","largeQuote","smallQuote","qla","getSegmentTemplatesByDimensionTypeForGroupKey","getKeysOfEmptyGroups","onSelect","validations","errors-changed","FavoriteLookup","favdUsers","favdGroups","favoriteCallback","_favoriteCallbackFunction","iconMap","User","Group","onCancel","searchValue","multilookup","updateTable","service","uid","menuItemLabels","_parseResults","numGroups","numUsers","j","selectedIdsByItems","k","numItems","_clearFavdLists","FavoriteShareDialog","LocalizeFields","searchModel","localizedProducts","localizationByFieldByProductId","localizedFields","Product2Id","localizedValue","getLocalizedValue","Product2","localized","localizedFeatureName","untranslatedRecord","localizationByFieldName","localizedOptionField","_appendPrefix","features","feature","localizedFieldName","put","columnResizeResponse","resp","logType","testState","isSuccessful","maskCustomerData","errorMessage","ensureNonNullValueValidations","scheduleId","rate","consumptionRateFields","errorList","errorPayload","rateId","_extends","msg_missing_rate_field","ProcessingOrder","individualRatesWithPriceErrors","msg_rate_price_not_a_number","msg_rate_price_is_negative","ratePrice","isWholeNumber","integerFromString","individualRatesWithBoundValidations","lowerBound","upperBound","msg_bound_fields_must_be_positive","msg_lower_bound_greater_than_upper_bound","sortByProcessingOrder","rateA","rateB","validateDuplicateProcessingOrder","lowerOrderRate","higherOrderRate","lowerProcessingOrder","processingOrder","msg_duplicate_rate_processing_order","validateLowerRateNullUpperBound","currRate","isLastRate","msg_lesser_rate_has_null_upper_bound","validateGapsAndOverlapsBetweenRates","upperBoundOfLowerRate","difference","msg_gaps_between_rates_bounds","msg_overlap_between_rates_bounds","ConsumptionRateValidator","orderedRates","sort","nextRateIndex","nextRate","AssetQuantityValidator","quoteModel","quoteType","TYPE_FIELD","_validateAssetQuantityChangeForRenewal","_validateAssetQuantityChangeForAmendment","errMsgs","renewal","RENEWAL_CHECKBOX","existing","EXISTING_FIELD","priorQty","PRIOR_QUANTITY_FIELD","currentQty","QUANTITY_FIELD","newErrMsg","NUMBER_FIELD","negativeQtyLines","linesWithTooManyUpgrades","linesWithTooFewUpgrades","UPGRADED_ASSET_FIELD","CARRYOVER_LINE_FIELD","upgradedQty","UPGRADED_QUANTITY","ALLOW_ASSET_REFUND_FIELD","qty","existingProduct","carryoverLine","getLineActualQty","lineNumbers","substr","lastIndexOf","prodName","getObserverNode","observers","pathGet","pathSet","__clientCache","notifyRec","obsNode","callNext","UBPClientState","quoteLineOrProdId","lineKey","queryLimit","categoryIndex","searchKeyword","requestCount","QuoteLineRelated","categoryIds","ubpFields","Category","rateCount","rateCardFields","sortField","sortOrder","FieldMetadata","TYPES","RootState","spinnerMessage","localizable","required","spinnerStatus","showSpinnerMessage","CONSTANTS","QUOTE","QUOTE_LINE","QUOTE_LINE_GROUP","LAST_MODIFIED_DATE_FIELD","ACCOUNT_FIELD","ACCOUNT_ID_FIELD","ACTION_FIELD","ADDITIONAL_DISCOUNT_AMOUNT_FIELD","ADDITIONAL_DISCOUNT_RATE_FIELD","ADDITIONAL_QUANTITY_FIELD","BATCH_QUANTITY","BUNDLE_FIELD","BUNDLED_FIELD","BUNDLED_QUANTITY_FIELD","CLASS_FIELD","COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD","COMPONENT_LIST_TOTAL_FIELD","COMPONENT_SUBSCRIPTION_SCOPE_FIELD","COMPONENT_VISIBILITY_FIELD","CONDITIONS_MET_FIELD","CONSUMPTION_RATE_OVERRIDE","COST_EDITABLE_FIELD","CUSTOM_ACTION_CONDITIONS_FIELD","CUSTOMER_AMOUNT_FIELD","CUSTOMER_PRICE_FIELD","DEFAULT_SUBSCRIPTION_TERM_FIELD","DEFAULT_FIELD","DESCRIPTION_FIELD","DIMENSION_ID_FIELD","DIMENSION_FIELD","DISCOUNT_AMOUNT_FIELD","DISCOUNT_SCHEDULE_FIELD","DISCOUNT_SCHEDULE_TYPE_FIELD","DISCOUNT_TIER_FIELD","DISCOUNT_TIERS_FIELD","DISCOUNT_UNIT_FIELD","DISTRIBUTOR_DISCOUNT_FIELD","EFFECTIVE_END_DATE_FIELD","EFFECTIVE_QUANTITY","END_DATE_FIELD","EVENT_HANDLER_NAME_FIELD","FIELD_FIELD","FILTER_VALUE_FIELD","GROUP_LINE_ITEMS_FIELD","ICON_CLASS_FIELD","LABEL_FIELD","LOCATION_FIELD","LONG_TEXT_AREA_FIELD","LOWER_BOUND_FIELD","MARKUP_AMOUNT_FIELD","MARKUP_RATE_FIELD","NET_AMOUNT_FIELD","NET_PRICE_FIELD","NON_DISCOUNTABLE_FIELD","NON_PARTNER_DISCOUNTABLE_FIELD","OPERATOR_FIELD","OPPORTUNITY_FIELD","OPPORTUNITY_ID_FIELD","OPTION_LEVEL_FIELD","OPTION_TYPE_FIELD","OPTIONAL_FIELD","ORIGINAL_QUOTE_LINE_FIELD","ORIGINAL_SCHEDULE_FIELD","OVERRIDE_BEHAVIOR_FIELD","PAGE_FIELD","PARENT_CUSTOM_ACTION_FIELD","PARTNER_DISCOUNT_FIELD","PARTNER_PRICE_FIELD","PRICE_EDITABLE_FIELD","PRICEBOOK_ID_FIELD","PRICEBOOK_LOOKUP_ID_FIELD","PRICING_GUIDANCE_FIELD","PRICING_METHOD_EDITABLE_FIELD","PRICING_METHOD_FIELD","PRIMARY_FIELD","PRICE_SCALE_FIELD","BRAND_BUTTON_FIELD","PRODUCT_CODE_FIELD","PRORATE_MULTIPLIER_FIELD","QUOTE_PROCESS_FIELD","QUOTE_PROCESS_ID_FIELD","REGULAR_PRICE_FIELD","RENEWED_ASSET_ID_FIELD","RENEWED_ASSET_RELATIONSHIP_FIELD","RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD","REQUIRED_BY_FIELD","RICH_TEXT_AREA_FIELD","SEGMENT_INDEX_FIELD","SEGMENT_KEY_FIELD","SEGMENT_LABEL_FIELD","SOLUTION_GROUP_ID_FIELD","SOURCE_FIELD","SPECIAL_PRICE_FIELD","START_DATE_FIELD","SUBSCRIBED_ASSET_IDS_FIELD","SUBSCRIPTION_BASE_FIELD","SUBSCRIPTION_PRICING_FIELD","SUBSCRIPTION_TERM_FIELD","TARGET_CUSTOMER_AMOUNT","SUBSCRIPTION_TYPE_FIELD","TARGET_OBJECT_FIELD","TEXT_FIELD","TEXT_AREA_FIELD","UNIT_COST_FIELD","UPGRADE_CONVERSION_RATE","UPGRADED_SUBSCRIPTION_FIELD","UPGRADED_CONTRACT_LINE","UPLIFT_FIELD","UPPER_BOUND_FIELD","URL_TARGET_FIELD","URL_FIELD","RETURN_URL_FIELD","USE_PRICE_FOR_AMOUNT_FIELD","USER_DEFINED_FIELD","UNOPENED_FIELD","HAS_CONSUMPTION_SCHEDULE","CUSTOM_VALUE","PANEL_ADDED_INDEX","PERCENT_OF_TOTAL","TYPE_STANDARD","TYPE_YEARLY_DIMENSION","TYPE_QUARTERLY_DIMENSION","TYPE_MONTHLY_DIMENSION","TYPE_SINGLE_DIMENSION","TYPE_CUSTOM_DIMENSION","STANDARD_LINE","SEGMENTED_LINE","GROUP_HEADER","GROUP_FOOTER","PRICING_GUIDANCE_TARGET","PRICING_GUIDANCE_FLOOR","PRICING_GUIDANCE_NORM","PRICING_GUIDANCE_EXPLANATION","QUANTITY_FIELDS","UNIT_PRICE_FIELDS","ConsumptionSchedule","ConsumptionScheduleId","FIELD_SET_METADATA","Default","FieldSet","ObjectType","COLUMN_METADATA","FieldColumnSize","FieldName","FieldSetMetadata","FieldSetMasterDetail","LineModel","CustomActionModel","customAction","customActionModelsByParentId","renderLocation","icon","class","caClass","eventHandlerName","isSeparator","primary","urlTarget","_customActionsConditionsMet","hasParent","isAmendment","configurable","lineVO","productHasDimensions","segmented","bundle","dsField","isDiscountScheduleIdExcluded","isUsageBasedPricingEnabled","quoteLinePricingGuidance","isDeleted","grouped","toggleOptionalShown","allOptional","renewSubscriptionsButtonRendered","isAmendmentOrChangeQuote","upgradeAssetsButtonRendered","multiLineDeleteEnabled","meetAllConditions","conditions","productVO","arithmeticOperatorConversion","quoteVO","isHidden","isDefault","observeProp","cmp","_ignoreFns","hasOwnProperty","observe","_recordIds","observing","__data__","_detach","DataHandlerBehavior","propData","twoWay","propObserver","_createPropertyObserver","idObserver","idProperty","_addObserverEffect","parenInd","idFunction","fnName","_addComplexObserverEffect","attached","detached","DiscountTierModel","discountTierRecord","discountScheduleRecord","discountSchedule","hidden","tiers","DiscountTiersValidator","schedule","unitPriceScale","priceScale","lastTier","lastUpperBound","discountUnit","discount","formatLabel","msg_missing_lower_bound_tier","msg_unequal_lower_upper_bounds_tier","msg_upper_greater_tier","tier","discountFormatted","msg_missing_discount_amount_tier_currency","msg_missing_discount_amount_tier","msg_missing_discount_tier","_addTopBorderClass","node","topBorderHighlightClass","_addBottomBorderClass","bottomBorderHighlightClass","DragDropModel","keepBundle","draggable","validTargets","dragFunc","trackFunc","dropFunc","ghostXOffset","ghostYOffset","keepBundleTogether","sourceElement","hoverOver","placeHolderComp","ghostField","targetClass","dropBefore","usePlaceholder","highlightTargetPosition","highlightableElements","enableHighLight","lineEditor","linesByParentKey","linesByParentItemKey","standardLinesByParentKey","standardLinesByParentItemKey","segmentedLinesByParentKey","segmentedLinesByParentItemKey","ghost","handleDrag","handleTrack","handleDrop","_bootstrapMetricsService","removeTopBottomBorderClass","isComponent","lineModel","ifLineElementsShareParent","eL1","eL2","parentItemKey","ifLineElementsAreParentChild","dragging","metricsService","mouseX","mouseY","stopPropagation","preventDefault","_pauseEvent","state","abs","dx","dy","startTransaction","localTarget","sourceBox","sourceWidth","sourceHeight","height","_appendGhostImage","_moveGhost","hoverOverComp","hover","_showGhost","_hideGhost","debounce","previousHoverOverComp","_removePlaceholder","_removeHighlightHover","_usePlaceholder","_highlightHover","toggleAttribute","removeAttribute","_removeGhost","ghostElement","_clonePolymerElement","loadingSpinner","gX","gY","top","visibility","_ifParentIsValidTarget","localName","domHost","_findTableRowValidTarget","drag","dimensionType","groupModel","phLoc","navItems","hoverElement","ref","_getPreviousLineSibling","_getNextLineSibling","_helpGetLineSibling","locator","row_locator","nodeName","rootNode","_findParentCustomElement","classArr","boundBox","midHeight","deepCloneNode","setAttribute","create","backgroundColor","targetHost","nextElementSibling","hasAttribute","previousElementSibling","clonedElement","rowComp","tds","getElementsByClassName","QuoteModel","EditorModel","_observers","fieldsetMap","_createFieldsetMap","columnMetadata","fieldNameSet","fieldSetNames","fieldsMap","quoteLineObjectName","excludedDiscountScheduleIds","_convertExcludedDiscountScheduleIdsToObject","summarized","summaries","createQuoteModel","standardPrimaryMobileCols","segmentedPrimaryMobileCols","segmentedDetailsPrimaryMobileCols","_isToggleOptionalShown","customActionsByLocation","customActionsByLocationMobile","groupMobileMenuButtonAction","_updateCustomActions","_initCustomActions","customActions","quoteCustomActions","lineCustomActions","Line","styleQuoteAndGroupActionButtons","communityPrefix","_getCommunityPrefix","isMultiGroupViewEnabled","multiGroupViewEnabled","_verifyAdditionalDiscountUnitOptions","styleActionButtons","lastCustomAction","additionalDiscountUnitOptions","pathname","quoteRecord","controllerFieldName","controllerName","standardLineItemDrawerFieldNames","productHierarchyVisualized","accumulator","actionsColumnPlacement","fieldsetList","_createFieldsetList","fieldset","containsOptional_Field","lineFieldNames","multiSegmentLineFieldNames","defaultCustomActions","validLocations","customActionsByParentId","addGroupCustomActionModel","addToLocation","customActionModel","default","parentId","childCustomActions","solutionGroupsEnabled","solutionGroups","addGroupChildren","sgL","solutionGroupAction","loopThroughActionsByLocation","FieldSetHandler","setDiscountValue","getSubchange","setThenNotify","toFieldName","GroupModel","groupVO","standardLines","segmentedLines","dimensions","dimensionsMap","segmentedLinesByDimension","segmentedLinesBySegmentKey","segmentedLineKeysBySegmentKey","standardSubscriptionScopeEditable","segmentedSubscriptionScopeEditable","groupObjectName","multiSegmentColumnTotals","netMultiSegmentTotal","hasVisibleStandardLines","hasVisibleSegmentedLines","standardLineFieldNames","_setStandardLineFieldNames","groupFieldNames","_getFieldSetNames","_setDrawerFields","lineModelsByKey","_addSegmentedLine","_addStandardLine","segments","addToLinesByParentItemKey","visible","indexByGroupKey","parentGroupKey","indexByLineKey","subscriptionScopeEditable","lineRecord","segmentKey","segmentLabel","dimension","multiSegmentKeys","segmentedLineKey","segmentsByLabel","firstSegment","setDimensionProperties","addToSegmentsArray","addToSegmentsByLabel","indexBySegmentKey","dim","colWidths","colWidth","stdMap","mdqMap","groupSelected","newLineVO","clone","bundleCollapsed","bundleVisible","scUpgradedContractLineField","nextKey","_updateColWidths","cloneLine","cloneSegmentKey","lineSegmentKey","multiSegmentRowTotals","clonedSegment","multiSegmentColumns","localizedMultiSegmentColumns","Standard","s","removedLine","canDeleteLines","lines","every","fieldSetHandler","fieldSet","getByViewport","fieldSetName","_getFields","drawerFields","standardLineDrawerFieldNames","optional","_callChildren","subchange","groupMD","_lineType","lt","favIds","rowType","JSQCNotifier","lineEditorComponent","propertyNameSet","pathNameSet","pathsToNotify","originalPathValues","pathsToSet","groupModels","lineGroups","modelVO","previous","groupIndex","lineIndex","notifySpecificPath","parentQuote","segmentIndex","dimensionsLength","columns","columnKeys","columnsLength","lineItemDrawerIconClass","_getLineItemDrawerIconClass","expandedIconClass","_getExpansionClass","isVisibleInLineEditor","hasParentLine","setItemClassMap","cellClasses","discountScheduleId","expanded","hasStandardLineItemDrawer","editability","getFieldMD","quantityEditable","listPriceEditable","discountable","discountEditable","nonPartnerDiscountable","partnerDiscountEditable","upliftable","unitCostEditable","pricingMethodCustom","pricingMethodDisabled","bundled","pricingMethodCost","descriptionLocked","PACKAGE_PRODUCT_CODE_FIELD","PRORATED_LIST_PRICE_FIELD","subscription","isMDQ","isCustomDimension","fieldVisibility","componentVisibility","isRenewal","renewedAssetsHiddenWhenEditing","itemClassMap","isFieldRendered","drawerField","dynamic","productPullIns","hasConfiguration","hasConfigurationAttributes","renewalQuotesWithoutAssetsAllowed","legacySupport","productQuantityEditable","costEditable","dynamicSubscription","nonDiscountable","componentDiscountedByPackage","rootPackage","reconfigurationDisabled","configurationType","configurationEvent","pricingMethodList","_hasStandardLineItemDrawer","asset","layout","segmentsLength","getField","updateCustomSegments","MDQSegmentHelper","groupModelsByKey","MONTHLY_DIM","YEARLY_DIM","QUARTERLY_DIM","LINES_GROUPED_FIELD","FIRST_SEGMENT_END_DATE_FIELD","_segmentsChanged","_hasMultiSegmentLines","_adjustSegments","lineCount","term","_calculateSubscriptionTerm","_calculateSegmentDeltasAndModifySegments","startDateFieldValue","endDateFieldValue","subscriptionTermValue","firstSegEndDateFieldValue","firstSegEndDate","subscriptionTermUnitIsDay","firstSegPlusOneDay","setDate","segmentDeltasBySegmentKey","_calculateSegmentDeltas","_modifySegmentsBasedOnDelta","termIsDay","segmentCountsBySegmentKey","lineSegKey","currentSegCount","mapSegmentCountsBySegmentKeys","trueSegmentCount","termStartDate","quoteEndDate","ceil","determineDesiredNumberOfSegments","segKey","deltaMap","delta","lastSegment","_getLastSegmentFromQuote","noDelta","amendmentLine","lastSegStartDateFieldValue","lastSegEndDateFieldValue","lastSegStartDate","lastSegEndDate","newSegmentVO","_createNewSegment","processQuoteLines","_removeSegment","lineItem","maxIndex","sourceSegment","offset","whitespace","segmentToRemove","deletedLineIds","QuoteMessenger","targetRecord","readFromCache","updateCache","groupsByKey","selectedLinesByKey","isPrimary","quoteTypes","RENEWAL","AMENDMENT","isChangeQuote","CHANGE_ORDER","hasConsumptionSchedules","groupRecord","lineVOs","nextGroupKey","_setBundleExpansionStates","shouldNotify","quoteMD","deepRenumber","renumberStandardIndexes","renumberSegmentedIndexes","invisibleIdx","numOfGroups","numOfDimensions","numOfLines","numOfSegments","toggleOptional","resetDiscounts","notifyUi","isFieldVisible","isBundle","cachedValue","_hideTree","parentLine","quoteObjectName","_ref","flattenedRows","localizeContent","ClientCache","_getFieldTypeMD","fieldType","_getFieldMD","fieldTypeMD","_typeCheck","fieldMD","_requiredCheck","actualVal","ignore","SortLinesHandler","lineSortField","a","b","lineSortValue","aSecondary","bSecondary","modelObservers","unregisterMap","modelAttr","lastInd","convertTo18","part1","convertToDigit","part2","part3","seg","CONVERSION_TABLE","string","replaceWithBinary","str","reverse","reverseString","00000","00001","00010","00011","00100","00101","00110","00111","01000","01001","01010","01011","01100","01101","01110","01111","10000","10001","10010","10011","10100","10101","10110","10111","11000","11001","11010","11011","11100","11101","11110","11111","importScripts","Connection","sessionId","load","provider","read","mdType","setOptions","apexFactory","precacheSequence","runnerConstructor","sequence","PriceRuleSequence","MetadataSequence","OptionSequence","DiscountAndAccountSequence","ProductSequence","RelatedRecordSequence","UbpSequence","PricingGuidanceSequence","getRunnerConstructor","failure","close","argumentList","resultPoster","accountId","lookupFieldMap","referencedFields","getArgumentList","executeSequence","JSQCPrecacheWorkerManager","filePath","vfSessionId","_spoolWorkers","priceRuleWorker","_createWorker","priceRuleContext","_createWorkerContext","metadataWorker","metadataContext","discountWorker","discountContext","relatedRecordWorker","quoteLookups","groupLookups","lineLookups","allLineLookups","nonstandardLineLookups","fieldPrefix","relatedRecordContext","productWorker","productContext","optionWorker","optionContext","ubpWorker","ubpContext","pricingGuidanceWorker","pricingGuidanceContext","extrasMap","baseContext","wrkr","Worker","precachingFn","_precache","successful","JSQCPrecacher","precacheValue","restClient","proxy","endpoint","request","patch","restProxy","getEndpoint","ConnectionClient","JsonFormatter","getPrunedRecord","getOnce","UIDataManager","del","overrideRecValues","pseudoServiceModel","lineFilterFn","serviceModel","_usesClientCalculator","sortLines","_reorderLineItems","_reorderGroups","essentialLines","allLines","isLargeQuote","QuoteDAO","_saveLargeQuote","formatterOptions","cleanRootProperty","cleanPathFromRoot","keepIfDirtyWhenParentContains","keepIfDirtyWhiteList","enableLQTValidations","productRuleValidator","quoteLineGroups","vo","quoteLines","getConnection","saveQuote","upsertBulk","_bulkService","insertBulk","deleteBulk","oppSync","QuoteOpportunitySynchronizer","promiseArray","updateOpportunityProducts","_checkIfRecordJobFailed","_setRecordJob","_handleLargeQuoteSaveResponse","createError","showSpinner","stk","getRecordJobStatus","sta","stacktrace","setJobStatus","recordsCopy","executeBatch","saverResponse","_reloadEditor","_getDomHost","sbLineEditorRead","update","sortRequired","updateAfterJSQC","notifier","_executeServiceAction","favName","noLines","noEssentialKeys","keysToKeep","getComponentKeys","linesToKeep","updateQuote","favoriteResponse","updatedQuote","originalQuote","originalLineCount","originalGroups","originalGroupCount","_removeFavoritesFromQuote","unfavoriteResponse","favIdSet","favFieldName","favs","favId","_updateQuote","_executeCustomURLAction","onSave","modelType","parsedURL","_parseURL","_handlePopup","_navigateToURL","calculateResponse","jobId","_onJobChecker","guidedMessages","handleProductRuleAlertModal","navigateToReturnUrl","returnUrl","sobjectId","inFullScreenMode","exitFullScreenMode","parent","acknowledgement","_isLightningExperience","_getViewport","sforce","one","navigateToSObject","_closeSubTab","Sfdc","Url","getUrlParameters","_areUrlParamsValid","isdtp","getEnclosingTabId","closeTab","destampGroups","_clearAppliedUbpChanges","quoteEditorModelResponse","productAlertModal","displayContinueButton","enable","toggleGroupResponse","destroyTabs","rightSideButton","_extendSolutionGroupRecord","buildQuoteTabs","quoteHasNoLines","popupResponse","onQuickSave","reload","popup","messenger","targetModel","splitValues","objectName","isRedirect","navigateToURL","updateQuoteRequired","doneCallback","calculateGetCacheArray","_jsqcCalculate","calculationRequired","sortLineItems","_createEditorModel","updateUIAfterCalculate","alertModal","cancelCB","alerts","calculateService","background","saveService","_save","quickSaveService","clearCache","selectedGroupKey","returnGroupKeyAfterQuickSave","_navigateToLookup","keysToDelete","_retrieveKeysOfSelected","_deleteLines","renumber","onFlagCalculate","keyToDelete","_resetOnActionSignal","_addGroup","_groupQuote","_ungroupQuote","defaultName","lbl_default_group_name","defaultNameDefined","_createGroupRecord","thePrefix","deletedGroupIds","largeQuoteMsg","lineOmissionMsg","targetKey","keptLines","resegmentResponse","firstSegmentKey","segCount","combinedLineList","firstSegmentLine","transformedLine","_transformLineToNonSegmentedLine","finalLineList","lookingForParent","includeSiblingSegments","deletedLineIndexes","relatedKeysToDelete","_getAllRelatedKeys","_getLineOrProdId","parentGroup","newFavIdList","fId","updatedLineList","segmentedLineModel","renumberIndexes","actualQuantity","getActualQuantity","toggleOptionalBoolean","_cloneGroup","newGroup","linesInOtherGroupKey","allStandardLinesMap","originalLine","_getRootPackage","_cloneLine","canDelete","confirm","_deleteGroup","_removeGroup","removeGroup","parentItemKeys","_quoteModel$quoteVO$d","newLines","newlineItemGroups","ligroup","newlineGroups","lgroup","flush","ignoreCache","_openDialog","_openPricingGuidanceDialog","_executeQuotelessServiceAction","currentLineVO","currentLineVORecord","targetDiscountPercentage","calculate","productKey","currentProductId","discountKey","additionalDiscountAmountKey","quoteKey","lineItemsRecord","pricingGuidanceAction","selectedGroups","indexes","_clearSelectedCheckbox","emitter","_this7","cloneToGroupDialog","caPlugin","lineKeys","_getOriginalLineKeys","callPlugin","clonedLines","_getClonedLineKeys","methodName","_this8","JSQC","qc","connectionPromiseArray","connections","setConnection","setCustomerOnlyConnection","onCallCAPlugin","successQuote","errMessage","standard","components","segmentedSummaryLines","segmentedSummaryLine","_this9","clonedSegmentedLines","Year","Quarter","Month","Custom","_addParentAndAllChildLineItems","cloneSegmentedLine","standardLinesLength","clonedLine","_addClonedLines","segmentedLinesToSplice","segmentedLinesLength","lastSegmentedLineKey","segmentedLineModelToSplice","_addClonedSegmentedLines","appliedChanges","clonedLineKey","deepClone","_cloneUpdatedRates","usesClientCalculator","displayedLookupMap","getDisplayedLookupNames","updateSegments","initServices","onCalc","lineFields","groupFields","quoteFields","job","jobchecker","useSpinner","backgroundCalculatePending","saveServiceAfterBackgroundCalc","_mergeUbpEdits","invalidQtyMessages","validateAssetQuantityChanges","usesBackgroundCalculator","_this10","fieldPath","merged","ubpChanges","rates","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_loop2","_iterator4","_this11","lookupName","customActionId","gmLength","removable","_this12","thisLine","childLines","childKeys","grandChildKeys","segment","standardSubScope","segmentedSubScope","oldGroupModel","defaultQuoteProcessId","dialogName","favDialog","favoritedLine","groupLines","favoritedGroup","pricingGuidanceDialog","fieldLabelsMap","pricingGuidanceArray","quoteLineFields","isPricingRecommendationAvailable","isPricingGuidanceAvailable","pricingGuidanceRecord","isMobileDevice","quoteLineObjectArray","pricingGuidanceFieldMetadata","targetPrice","targetDisplayValue","formatFieldData","pushPricingGuidanceValueToArray","normPrice","normDisplayValue","floorPrice","floorDisplayValue","reasoning","prepareSingleLineData","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","isViewed","currentProduct","displayText","displayName","sb-favorite-saved","sb-clone-to-group-selected","job-completed","sb-accept-pricing-guidance","LECustomActionServices","sortLinesAscByKey","sortLinesAscByField","A","lookupNameField","sortByField","B","isABundled","isBBundled","Localizer","updateFieldFormat","sortLinesDescByField","isBundled","byOrder","startingNumbers","lowestVisibleNumber","lowestInvisibleNumber","lineNumber","getStartingNumbers","depthFirstTraversal","tree","makeLineItemsTree","reorderLineNumbers","fieldFactory","referenceDetails","selectOptions","refDisplay","refDisplayName","refTable","referenceTable","computeRefTable","refObjects","controllerValue","SFComponentFactory","drawerState","_setColumnWidths","_ironListResize","multiSegmentLineSummaryFieldNames","getDimensionColWidths","_setSubtotalColumnWidth","leftOffset","columnWidths","labelColWidth","fieldNames","totalColWidth","columnName","_onTrack","currencyMd","_getPriceScale","lineEditorSubtotalsField","_getNetTotalFieldMd","showSubtotal","subtotalField","order","lineModels","updateSizeForItem","_transient_","oldValue","columnNames","computed","QLESegmentedTableBehavior","_onSortLinesByHeader","actionsOnTheLeft","_setFieldNames","postBuildRowRefresh","notifyResize","lastColWidth","subtotalColWidth","drawerFieldNames","subtotalMd","_getSubtotal","subtotal","removeCellFocus","focusedCell","dragDrop","dragElement","dd","dragKeys","dragStandardIndexes","dragMdqIndexesByDim","dragLineModels","dragGroupModel","_getBundleWithChildren","lm","_getLineIndexFromKey","dragTargetElementIndex","updateTableRowHoverOverObject","indexesToRemove","keyArray","_getStandardLineIndexFromKey","_prepareUIData","_onUpdateSizeForItem","_updatePrimaryMobileColumns","keyCode","shiftKey","signalFirstEditableTargetFirstRow","getRowComponentName","signalLastEditableTargetLastRow","visibleLines","dropElement","dropElementBefore","dropLeGroup","dragLeGroup","dropKey","dropIndex","dropGroupModel","indH","_updateStandardSubscriptionScopeEditable","_removeLinesByIndex","getOwnerRoot","dropGroupId","groupContainer","segmentType","addSegmentedLineToExistingTab","addSegmentedLineToEmptyTable","mdqLm","removeSegmentedLine","postDrop","changeRecord","_groupHasStandardProducts","_showSubtotal","tabIndex","QLEStandardTableBehavior","findAdjacentRow","cur","isUp","isLQE","curTag","adjParent","child","adj","getCellMetadata","findParentRow","LETemplateGenerator","MobileLETemplateGenerator","IGNORED_ELEMENT_KEYS","INPUT","TEXTAREA","SELECT","segmentedColumns","isSecondary","relatedTarget","relatedEventHandlerName","suppCalImm","isSameTable","activeElement","_onEnterKeyPress","_onSpaceBarPress","_onEscapePress","_moveCellFocus","_routeKeyEvent","_toggleInlineEditIfFocused","_editOnFocus","parentRow","onKeyDown","_isCellFocusedAndInteractive","blur","TAPPABLE","keepEditableFocus","_toggleTappableCell","toggleCellClass","_isMobile","focus","direction","isIgnored","newParentRow","nextCell","parentEl","adjRow","_rowHasParentDiv","getCellRowIndex","getCellByIndex","focusableChildren","isLeft","cellClass","cellHeaderElem","indicator","_currentHeaderSource","_currentHeaderCell","_currentCellWidth","maxWidth","_mouseXStartPos","_currOffset","transform","_changeVisibilityOnColAdjBars","_onResize","_stopResize","tableHeader","mousePosition","currOffset","cellsWidth","tableHeaderElem","currentHeaderCell","fieldsWidth","fieldDiv","findElementForEvent","showTooltip","getTooltipContent","headerCell","tooltipCmp","position","animationDelay","fitToVisibleBounds","textContent","onTap_hook","cbContainer","toggleSelection","minWidth","headerElem","adjBar","lastSortedByField","resetHeaderCellStyles","updateSortColumnHeaderStyles","_getNewByOrder","_fireSortClickedEvent","_resetHeaderCellState","arrow","newSortCell","_getHeaderCell","SFTableHeaderBehavior","ui_original_record","recordUI","prepareFieldData","computeCellClass","prepareSegmentedLineData","prepareSelectionCheckbox","prepareWarningIcon","prepareBundleCaret","_cellClasses","_caretContent","CHEVRON_RIGHT_CONTENT","CHEVRON_DOWN_CONTENT","_isFocusable","_selectionCB","DISABLED","validPricebookEntryExists","hasLineWarning","opportunityLineItemExists","lineWarningKey","lineWarningMsg","isSubscriptionScopeField","isListPriceField","originalRecord","defaultValue","isCurrency","isQuantity","productQuantityScale","segmentData","_expansionIcon","DOWN_ICON","RIGHT_ICON","HIDE_CHECKBOX","computeProductHierarchyCss","modelClasses","modelClass","isProductNameField","isNetTotalField","INDENT","TOP_LEVEL","OPTION","_changeCount","diff","getCategoryId","_get3","categoryNameToId","qlId","loader","pathMutate","Cache","handleRequestSync","normalizer","handleRequest","normalized","getLoadRatesContext","offSet","_get2","sortOrders","currencyCode","normalizeUbp","rateFieldsMd","editableObj","scaleObj","scaleMd","_defineProperty","updatable","_context$sortOrders$","ratesCurrencyScale","categories","category","_ref2","nameSpace","qlFieldsMD","qlFieldMD","quoteLineDesc","descFieldMD","related","resultSet","categoryName","normalizeRates","_ref3","_ref4","_ref3$resultSet","totalCount","categoryId","oldRates","normalizeRateCardSummary","_ref5","_ref6","shouldLoadRateFieldsMd","ubpLabels","shouldLoadLabels","loadCategories","_get","loadFunction","oldRecord","newRecord","QuoteAggregator","clientQuote","serverQuote","requiredKeys","linesRequiringInjection","linesBelongingAtEnd","serverLineCount","existingLineKey","resultLines","_quote","_linesByKey","_constants","_getPriorBundledQuantity","upgradedAssetIdField","upgradedAssetId","existingField","productIdField","customKey","yearlyKey","monthlyKey","quarterlyKey","customSegs","monthlySegs","yearlySegs","quarterlySegs","dimensionIdField","dimensionField","typeField","segmentKeyField","groupKeySet","prior","parentPrior","_isCarryoverLine","_getCarryoverQuantity","_optionTypeIsComponent","carryoverQuantity","parentItem","sourceLineKey","sourceLine","AssetUpgradeQuantityCalculator","upgradeHandler","upgrade","isSourceLine","getLine","_getUpgrade","_getSource","setSourceAndUpgrade","_setAutomaticQuantity","getSourceOrUpgrade","didUserChangeSourceQuantity","upgradeRatio","_getUpgradeRatio","getSourceIdField","getUpgradeConversionRateField","sourceCurrentQty","getSourceCurrentQuantityField","upgradeCurrentQty","getUpgradeCurrentQuantityField","sourceRate","upgradeRate","sourceQtyAfterUpdate","upgradeQtyAfterUpdate","sourcePriorQty","getSourcePriorQuantity","invalidQuantity","validQuantity","didSourceQuantityChange","didUpgradeQuantityChange","isSelected","setUpdatedQuantity","sourceIdField","upgradeConversionRateField","sourceId","upgradeSourcesBySourceProductId","rationalizeDate","dateFormatCache","numberFormatCache","localeData","localize","isDate","stringKey","DateTimeFormat","NumberFormat","_getFormat","timeZone","_additionalCurrencyFormat","toLocaleTimeString","hour","minute","formattedCurrency","xxxIndex","containsDash","additionalContent","_replaceCharacters","trim","charCode","replacementVal","fromCharCode","regExp","previousState","toggleSpinner","LoadingSpinner","mqXS","matchMedia","mqSOnly","mqMOnly","mqLOnly","mqXL","activeSpinners","route","_buildViewport","xs","xl","XS","S","M","L","XL","only","bpS","bpM","bpL","_setupViewportListeners","sender","_updateContent","originalErr","view","go","_viewportChanged","updateStyles","router","domId","getContainer","showMenu","menuClosed","hideFullTitle","searchbar","debugMode","showLookupDialog","mode","_setupMetricsServiceListeners","fullTitle","innerText","opacity","_closeMenu","buttons","rootTarget","PageHeader","changeMenu","lookup","invoker","rte","metricsData","sticker","allowAutoLaunchPopup","navigationChanged","openLookupDialog","closeLookupDialog","openRteDialog","openSearchDialog","viewportChanged","targetElement","openClass","toggler","rect","currentTarget","bs","bottom","routes","private_router","PATH_PARAM_REGEX","autoHash","readOnly","modules","modulePaths","paramNames","paramMap","on","paramsLen","routeHandler","pos","qsParams","queryString","ov","same","dispatch","hasMessages","messagesModel","repeatHandlers","errorMsgs","msgs","successMsgs","warningMsgs","infoMsgs","messagesSplit","decodeHTML","removeRepeatedMessages","repeat","isMessageRepeated","toggleRepeatClass","msg1","msg2","ll","removeAnimationListeners","addAnimationListeners","handler","removeRepeatClass","Toast","showMessage","createEvent","initEvent","RemoteSession","getRemoteConnection","RestClient","JsonParser","RemoteClient","VF_MAX_INPUT","_remoteConnection","_restClient","reader","_remote","_isPayloadTooLarge","_model","sObject","soql","input","_getAction","startServiceRequest","remoting","Manager","invokeAction","_callback","escape","timeout","_getPrefix","stopServiceRequest","_parse","_getApex","_getEndpoint","_resolve","_reject","fileType","fileId","fileContentsField","oauth","_getConnection","_adjustErrorMessage","fullNames","streamFileContents","pretty","omitRelationships","addObject","omitNull","int","topLine","_replacer","cleanObj","keepDirtyParent","whiteListKey","QuoteMinimizer","groupkey","stripLinesThreshold","stripLinesMessage","hasRelatedLines","existingProductIds","getExistingProductIdsFromLines","_getNecessaryLineKeys","sentLines","relevantKeys","configuration","lineItemKey","_addLineKeyWithRecursiveCallOnChildrenAndSource","rootLine","rootIsParent","rootIsUpgrade","isChildOfRoot","isSourceOfRoot","strObj","_reviver","cacheId","cachePath","cachedOriginalRecordPath","cloneRecordIfNoCache","cachePathLength","cachedRecord","keyNumber","handleServiceResponse","handleAsyncResponse","AsyncService","isAsyncResponse","pollAsyncJob","setResponse","parseAsyncResponse","swapCache","entry","slot","asyncModel","objects","ordered","_describe","waiting","objectFields","allFields","controlledFields","mdFields","controlledField","controllingFieldName","controllingPicklist","promises","Describe","mdItems","transient","promise","_returnPromiseIfCachedResponse","_response","_returnCachedPromise","_read","_load","_md","_streamFileContents","_spinner","cachedPromise","cachedResponse","_createError","errorCode","escapedValidations","validationsArray","Service","Searcher","searchFilterData","targetObjectName","hasCustomSearchFilters","targetFieldName","searchFilterModel","searchFilters","isLookupType","queryLookupFilterName","stringValue","handleDynamicSearchFilters","dynamicSearchFilters","responses","searchFilter","loadCustomSearchFilterValues","loadStandardSearchFilterValues","searchModelFilters","filterData","isBlank","filters","numFilters","filterValues","_id","searchValues","getFilterContext","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","FieldHider","focusOnAttached","applyFocus","hide","checkbox","applyTo","Checkbox","DateRange","selectedDate","range","dateParser","weeks","weekDays","calendars","gregory","days","short","months","long","monthName","newDate","oldDate","initialized","dateFormatted","_selectedDateChanged","updateVariables","getLocaleDate","suppressImmediateCalculation","ensureProperYearInSelectedAndShowCalendar","haveEnsured","_showCalendar","years","isIE","yearsCreated","_createOptionElements","yearSelection","selectedOptions","optionEl","updateCalendar","datepicker","datePicker","dateContainer","_clickHandler","some","hideCalendar","updateYearPicklist","increment","firstDay","getUTCDay","week","dayIdx","noblur","dateInput","emptyDate","parsedDate","hasSelectedDate","invalidInput","selectDay","validateInput","escaped","updateDate","showCalendar","highlight","setSelectionRange","Datepicker","convertDiscountValue","registerComponent","property","unitChanged","numberParser","checkThenSetDiscountValue","deferBlur","tabBlur","discountUnits","convertDiscountValueThenUpdate","blurred","tabBlurred","blurDiscount","isInput","renderReadOnly","resetToOriginal","directBlur","tabBlurEvent","_blur","unitValue","selectUnit","selectedIndex","_runConverter","_getUnitAndDisplayVal2","Discount","availableTitle","chosenTitle","chosenOptions","availableOptions","_clearSelected","available","availableOptionsSelected","chosen","chosenOptionsSelected","valueSet","DualListBox","KEY_READ_ONLY","KEY_DOWN_READ_ONLY","BLUR_READ_ONLY","HIDE_FIELD","REF_DISPLAY","editing","_wasEverEditable","link","objAndRefObjects","objKey","refObjectsKey","originalFormattedValue","hideFormattedValue","preventNumericAlignment","factoryData","handleRowFocusSignal","handleFieldEditSignal","_tapHandler","linkOrEdit","passive","_createObj","isInternalObject","setObjAndRefObjects","render","rendered","isReadOnly","updateTemplateData","_toggleEditing","_unrender","_render","ff","createBaseElement","onChange","onKeyupReadOnly","onKeyDownReadOnly","keepNewValue","onBlurReadOnly","childNodes","originalValue","_setOriginalFormattedValue","formField","getFormField","originalValueChanged","getFormattedValue","addFormattedDirtyClass","_onChange","getEventTarget","isNumericType","fireCustomChangeEvents","fireControllingSelectChangeEvent","bubbles","isRenderReadOnly","signalNextPreviousEditableTarget","setPreviouslyFormattedValue","previouslyFormatted","isLookup","enableSignals","addFormattedValueClasses","numeric","setFormattedDetails","getSelectOptions","formatted","segmentedAlignment","isBool","isEmpty","me","disable","toggleRowFocus","lastVisibleIndex","toggleScrollListener","scrollListenerDetached","edit","ownerDocument","valueChanged","disabledChanged","clickEdit","isRichText","_nodes","invertValueIfInlineBoolean","signalRowFocus","ex","returnTrueIfEverEditable","isFormulaHtml","htmlFormatted","calculated","booleanValue","sanitizeAndSetInnerHTML","controllerSelectHandler","sameRecord","equals","buildSelectOptions","_selectOptions","clearInvalidValue","getValue","clearValueIfNotAnOption","clearValue","setValue","Field","inputType","showClear","hideClearIfEmpty","_hideClearIfEmpty","fireChangeOnBlur","changeOnNextBlur","fireChangeEvent","Input","LookupQueryBuilder","limit","labelName","selectedLabel","lookupCallback","lookupResultsCallback","hideInputAndShowPill","hideCancelIcon","inDialog","blurDisabled","focusDisabled","tableLabel","placeholder","showSearchIcon","mobile","fieldFullName","hasFilter","controllingFields","currentRecordFilters","dialogMetadata","setTableLabel","typeahead","handleEnterPressed","setCurrentRecordFilters","labelPlural","customCallback","queryLookupResults","q","apiVersionString","__md__","clearAfterSelection","noFocusAfterSelection","tableParts","searchLabel","handleSearchResults","setLabel","_setLabel","setSelectedItem","getLabel","selectedItem","setHideInputAndShowPill","_handleSelectedItemChanged","handleSelectedItemChanged","fireLookupValueChanged","applySearchValue","querySearchResults","forceSuggest","labelsByValue","_getLabelValueKey","getDefaultLabelFromRecord","setOriginalSelected","suggest","deletePill","previousBlurDisabled","attributeMD","referencedFieldValue","buildSearchText","handleMobileEvents","_clearAndSave","clearAndSave","_applySearchValue","initCurrentRecordFilters","lookupFieldTable","currentRecordFiltersKeys","Lookup","TableClassBuilder","LAYOUT_FIELD_SET","SEARCH_FIELD_SET","ALLOWED_SEARCH_TYPES","DEFAULT_SEARCH_TYPES","fieldLabel","openSpinner","recordSpinner","hideCancel","layoutFields","searchFields","lookupSearchTypes","maxSearchFields","fieldSetPrefix","cancel","setValues","processListFields","updateLookup","setResultsHeightHandler","setResultsHeight","assignParentResizable","stopResizeNotificationsFor","dialogOpened","hasList","labelValue","itemLabel","syncSelection","deferredClose","dialogClosed","reset","clearSelected","destroyGroup","fs","getSelectedLabelValueById","getMetadata","fieldSets","searchFieldsNotInLayout","getCpqLookupSearchFields","names","processCPQLayoutFields","initMobileMetadata","getCpqLookupLayoutFields","warnUserAboutCPQLayoutFieldSet","omittedNameField","getNameFieldIfOmittedFrom","initSearchFieldsAndReturnOnesNotInLayout","fieldTypeByName","fieldTypeObjByName","fieldTypeByLabel","fieldsOfTypeLookup","headerClassMap","rowClassMap","additionalSearchFields","sanitizeAdditionalSearchFields","sanitizedAdditionalSearchFields","searchField","warnUserAboutSanitizedCPQSearchFieldSet","plus","getResults","overflow","isMobileWithSpotlight","mobileSpotlight","offsetBottom","documentElement","clientHeight","offsetTop","scrollHeight","dataTableHeight","datatable","marginLeft","getCpqLookupFields","forSearch","validCPQFieldSet","df","displayedFields","displayedField","sanitizedSearchFields","setSelected","saveAndDeferredClose","LookupDialog","iconName","selectedItems","customCallBack","_animateDuplicate","_addItem","_appendMobileClasses","pills","selectedContainer","dataValue","lookupContainer","resultsTable","MultiLookup","pageIndex","pageSize","firePageEvent","setNumberOfPages","numPages","setPageWindow","pageWindow","setNextDisabled","nextDisabled","previousDisabled","pageNum","Pagination","RichTextEditor","searchedValue","searchService","actionId","searchResultCallback","showResetButton","searcher","handleItemSelected","showAllResults","itemsCallback","typeAheadCallback","localizer","isSearchValid","reposition","realign","getSearchResultRow","enabled","serviceCallout","mostRecentResults","parseResults","getFilterContextFromSearcher","getSearchContext","buildContext","localizeSearchModel","productRecord","reg","inner","second","DisplayName","SearchBar","attachSearchProperties","attachSearchEvents","updateSearchResults","displayResults","SearchBarDialog","isRequired","noneLabel","multiSelect","_multiple","_options","buildOptions","noneSelected","_getValues","getValues","textarea","Textarea","wildCards","debounceDelay","itemsList","delimiter","savedLabelValue","invalidLabel","hasLabel","optionIndex","revertOnEscape","calculateListPosition","showListNoSuggestion","showListOnFocus","hideInput","showLeftSearchIcon","disjointLabel","_directInputFocus","_directInputBlur","isAttached","setStyles","itemsChanged","updateItemsList","selectedItemChanged","getSelectedItemValue","originalSelected","numOfOptions","numOfLabels","valueAttr","updateItem","hideList","forceSuggestOnFocus","clearSelection","focusOrBlurAfterSelection","searchLabels","highlighted","numOfItems","cloneItem","showItem","noBlur","selectAdjacentItem","showList","preventBlur","focusing","_showListOnFocus","force","Typeahead","RecordGrouper","groupField","groupedRecordFields","recordPath","itemProperties","itemPropertiesByGroup","groupProperties","groupCountPath","groupFieldType","groupFieldTypePath","NOT_GROUPED_NAME","orderdGroups","itemsByGroup","notGrouped","groupedItems","groupie","grouper","_setProperties","_sortItemsByGroup","orderedGroups","groupItem","propertiesKey","types","desktop","tablet","phone","desktopFields","tabletFields","phoneFields","_getPhoneFieldSet","_getTabletFieldSet","_getDesktopFieldSet","rowActions","addedManually","disabledData","onTapFunction","shouldDisable","invisible","iconTitle","configured","configurationRequired","Actions","_updateTarget","_setVisibility","_target","updatePosition","targetRect","thisRect","ownerRoot","Badge","modal","hideHeader","appendedClass","cancelText","Type","closeDialog","hideCloseIcon","hideCancelButton","mobileDropDown","tapDialog","ignoreMaskTap","observeNodes","mobileButtons","dropDownButton","footer","numChildren","dropDownMenu","onCloseDialog","dateContainerBoundingClientRect","contentBoundingClientRect","datepicker-opened","Dialog","Div","_setFieldData","helpText","inlineHelpText","_dataChanged","rfm","hasRelationship","getRelationshipName","FieldItem","numColumns","generateColumns","column1Group","column2Group","column3Group","numFields","columnOneWidth","columnTwoWidth","columnThreeWidth","setColumns","firstColumn","secondColumn","thirdColumn","FieldTable","reflectToAttribute","handleKeyPress","handleLabelChange","itemType","setMd","dataChanged","_displayChanged","filterItem","FilterItem","FilterLayout","filterPath","filterKey","filterDelegator","groupItems","serviceLoader","enterCallback","translationCallback","serviceCallback","sendQuoteRecord","resultLimit","searchContext","mdResponse","handleEnterKeyPressed","searchModelReady","searchModelInitialized","eval","setVisibleDynamicSearchFilters","visibleFields","setSearchFilterFields","getSearchTable","buildFields","setFilterValueMap","groupKeys","fieldsByObject","skipDefaults","setDefaultFilterValues","panel","applyFocusToItem","noSpinner","builderModel","buildSearchModel","delegator","updatedSearchFilters","getGroupKey","duplicateFilter","searchTable","getAdditionalProperties","getFieldSet","quiet","groupClass","itemClass","groupDisplay","primaryItems","numPrimary","includePrimaryInSecondary","pathPrefix","focusIndex","itemEditableMap","noDataPropagation","oldMap","newMap","g","_item$classList","_item$classList2","dataKeys","buildGroup","initInternalGroupAndPrimaryItems","_group","_updateItemValues","_updateColumnWidths","_itemClassMapChanged","_updateItemClasses","buildItems","addedNodes","bindElementEvents","columnWidth","props","_primaryItems","_normalizeWithTemplateGroup","secondary","doc","classes","_createColumnWidthStyleHtml","numElements","updateFocusIndex","propagateValueToParent","childToParentExtension","propagateFromParentToChildOverride","_propagateFromParentToChild","handlePrimaryEvents","primaryEventsResistered","itemField","toggleEditable","editableMap","dateRowRect","offsetParent","dateContainerRect","offsetWidth","DEFAULT_WIDTH","DEFAULT_HEIGHT","useImage","checkboxBase64","padding","handleDefaultSizeIfImage","imageNoWidth","imageNoHeight","_tabindex","tabindex","sanitizeHtml","allowedTags","defaults","allowedAttributes","img","span","li","em","sup","strong","parser","decodeEntities","ImageCellSizer","selectedRows","hasTotalCount","maxSelectAll","selectionIdDataPath","parentAttributesPath","additionalFields","groupByField","groupByFieldType","_primaryMobileColumns","rowsByGrouper","viewResultsIndexById","viewResultsIds","headerSelectionDisabled","headerSelectionTooltip","mobileRowDetails","keyPressed","lastClickedIndex","noResultsMessage","_hasViewResults","_setupKeyPressListeners","handleAllRowsSelected","handleOneRowSelected","handleMetaDataResponse","expandMobileRow","selectMobileRow","expandRowEventHandler","scrollTarget","_viewResults","initRecordKeysFieldLabelsAndTypeMap","deSelectAll","fieldMetadataInitialized","setFieldMetadata","metadataFields","recordKeys","fieldLabelMap","mdMap","labelTypeMap","itemTypeMap","labelWidths","currencyIsoCode","isMobileViewport","imageWidth","getImageWidth","selectAllClicked","toggleRowSelections","processed","_isValidViewResultId","viewResults","viewResult","selectOneRow","getSelection","removeAllRanges","handleRangeSelection","autoSelectGroupRows","rowData","_selectedChangeByParent","UnitPrice","setViewResults","getViewResults","hasGroupedField","_resetMobileDetails","viewResultIndex","_indexViewResult","expandedGroupState","groupName","_setMobileExpandDetails","_setMobileSelectedDetails","expandDetails","_setMobileDetails","selectedDetails","virtualIndex","_computeVidx","_physicalCount","details","groupStartIndex","newState","_expandRow","scrollToIndex","_notifySplice","_scrollPosition","firstVisibleIndex","_adjustScrollAfterExpandRow","_updateScrollerSize","_getMaxResultsToSelectAll","_getMobileDetails","includePath","expandDisabled","_enabledExpand","_findRowIndex","numKeys","IronScrollTargetBehavior","LookupLayout","responseMessage","closePopup","autoLaunched","redirectOnCancelOrClose","_open","_initRpc","_sendMessage","_handleAutoLaunch","_close","_getRedirectDetails","redirectDetails","rpc","destroy","redirect","featureOptionIds","dynamicOptions","easyXDM","Rpc","remote","local","outgoing","getRequest","incoming","getResponse","received","_logReceivedMessage","auto","richTextFields","highlightOnFocus","listMode","columnGroups","_highlightOnFocus","columnsForSignaler","signalOnFocus","RowDrawer","renderHeader","arrows","sideText","isOpen","SidePanel","expanded-changed","disableSwipe","preventSwipe","isRequiredRowNotSelected","groupExpanded","swipeHeader","swipeMenu","swipeItems","swipeItemWidth","variant","_preventSwipe","mutations","_findSwipeHeaderAndMenu","nodeType","Node","TEXT_NODE","COMMENT_NODE","_initSwipeHeader","swipeHeaderStyle","listen","setScrollDirection","swipeContainer","_animate","_closeMenuWhenTapped","swipeItem","allNodesOfSwipeMenu","swipeMenuItems","shadowRoot","currentNode","_isValidSwipeMenuItem","swipeItemsLen","speed","transition","_setSwipeItemStyles","swipeItemStyle","webkitBackfaceVisibility","borderRadius","_initSwipeMenu","track","_trackMove","blah","cho","getComputedStyle","distance","toPrecision","dist","fav","SwipeContainer","buildCell","setDisabled","setHidden","setRecordId","setSuffix","setFieldMetadataFromModel","suffix","fullWidthItem","TableCell","isRadio","_attached","_setDisabled","_setHidden","TableCellSelect","selectable","selectionType","selectionDisabled","selectionTooltip","headerActions","hideHiddenSelectable","buildLabels","counter","col","setSelectable","registeredDataChangedHandler","registerSelectionChangedHandler","selection","selectionChangedHandler","selectionData","hideSelection","TableHeader","row-swiped","routeSource","requiresModel","constrained","parentIdDataPath","repeatPrimaryMobileCols","grouperExpanded","ignoreViewportChange","editFirstWhenSelected","rowSwiped","selectionClass","leftClass","highlightRowOnFocus","deferGrouping","selectionOnLoad","forceColumnWidths","mobileExpandedDetails","mobileSelectedDetails","disableSelectionTabFocus","disableAllFields","hasTogglePlaceholder","hasToggle","togglePlaceholder","buildRow","setPrimaryMobileColumnsIfMobileViewport","setFullWidthIfGroupRow","_cloneColumnWidths","changed","editFirst","fireSetSelectionEvent","disableAllTableFields","itemToEdit","bundleId","defaultHidden","hasDeleteAction","selectionContainer","_broadcastGroupSelected","_broadcastMobileSelected","_groupSelected","tableRow","expandPath","internalExpand","mobileSelected","setGrouper","isGrouper","rowDiv","setGrouperToggle","_toggleGroupHandler","toggleGroupEventHandler","setGrouperClasses","optionDrawerExpanded","_isGrouperRow","_configurationRequired","added","firstColumnWidth","TableRow","tabs","pageComponent","pageData","commonData","selectedTabIndex","selectedPageIndex","tabsClass","usePagination","paginationClass","tabLimit","overflowTab","overflowTabClass","overflowTabMenuClass","menuMaskClass","bindingData","hideTabs","contentContainerClass","tabContainerClass","pageElements","overflowTabMenuDisabled","overflowTabMenuLabelDisabled","_enforceValidTabSelected","_buildTabs","paperTabs","pages","_initTemplateData","_buildPages","templateBindData","_bind","tab","CaseMap","camelToDashCase","attr","appendBindData","requiresTemplateBindData","selectedTab","changeTab","_changeTab","tabLength","_ensureOverflowTabMenuDisabled","_ensureOverflowSelection","_displayOverflowTabName","getElementsByTagName","overflowTabMenu","overflowTabMenuLabel","overflowTabIndex","_getTabIndexByLabel","overflowMenuItems","isMenuItemSelected","selectedPage","isInteger","_deselectPreviouslySelectedTab","iconId","iconSpan","closeMenu","firedEventName","tabToDisplay","pagination","tabClassName","hideIcon","overflowIconSpan","_handleSelectedChanged","fireTabSelected","_handleOverFlow","dashKey","dashBind","hasVisibleContent","_disabled","_changeToNextEnabledTabQueued","_changeToNextEnabledTab","nextEnabledPageIndex","_getNextEnabledPageIndex","ii","Tabs","TableLayoutBuilder","parentElWidth","hasSelection","hasStandardDrawer","columnConstants","fieldsetName","newColumnMdSizesMap","isResetAction","availableWidth","_getAvailableWidth","totalWidth","totalColsWidth","numOfCols","widthPerCol","imageCols","fieldsLeft","_buildLayoutWithColumnSizing","_getMultiplier","numberOfColsDivisor","totalAdjustedWidth","adjustedWidth","knownColumnSizes","colData","_getStaticColsWidth","labelMultiplier","_getImageWidth","hasInvalidWidth","_warnInvalidWidthParameter","imageFunctionStartIndex","_getImageFunctionStart","imageFunctionEndIndex","_getImageFunctionEnd","_getWidthFromImageFunctionArgs","headerWidth","formula","numOpenParenthesis","numClosedParenthesis","_selectEditableFields","_selectNextEditableField","_selectPreviousEditableField","currentIndex","targetIndex","_selectFirstEditableNextRow","_selectLastEditablePreviousRow","nextRow","_selectRowByIndex","nextRowSelector","previousRow","previousRowSelector","_selectTableRowByIndex","firstRow","lastRow","firstLastClassSuffix","typeByColumnMap","allColumnClasses","useColumnsIndexAsKey","classMap","_appendTypeClass","_appendFirstAndLastColumnClasses","_appendAllColumnClasses","_addWidthStyles","prevNumeric","isNumeric","_isNumericType","_isBooleanType","_appendClass","firstInnerClass","lastInnerClass","secondInnerClass","columnClass","typeAndWidth","_setWidthStyle","classToAppend","existingClass","OpContains","opType","testValue","fStr","tStr","OpEndsWith","OpEquals","testValueCache","fieldValueCache","valueOf","lowerCaseTest","lowerCaseField","valueFor","valueType","otherValue","OpGreaterThan","fieldTime","testTime","OpGreaterThanEquals","OpLessThan","gte","OpLessThanEquals","gt","OpNotEquals","OpStartsWith","OP_EQ","OP_NEQ","OP_LT","OP_LTE","OP_GT","OP_GTE","OP_SW","OP_EW","OP_CONT","doNotFixObjectName","fieldSplit","buildFieldList","asyncNumList","firstStatusTime","lastStatusTime","_setLoadingSpinner","_checkStatus","_useSpinner","_setJobStatus","Status","_isFinished","_isFailure","ExtendedStatus","cancelAsync","_getStatusMessages","asyncNum","async","_ping","convertedStatus","_convertJobStatus","Queued","Holding","Aborted","waitTime","JobChecker","loadModel","quoteId","loadingModel","modelRequest","quoteDAO","loadEditorModel","loadNewModel","_update","hardReload","trimmedQuoteId","cachedModel","_retryUpdateLater","_setIsLastReadQuoteUnopened","startingPolling","pageLoaded","_clearedLineEditor","isLastReadQuoteUnopened","startedPolling","LineEditorReader","linesAddedByRules","addLines","builder","targetGroupKey","reduceQuote","revertQuote","ProductRulesQuoteLineAdder","lineAggregationMethod","processId","dataModel","aggregator","aggregatedData","SearchModelLoader","stripQuoteLines","selectedProducts","selectedProductList","quoteProcess","useCache","invokeSaver","selectionArray","SearchModelSelector","ProductViewModel","ProductMessenger","extender","_initializeProduct","optionFieldSets","defaultOptionPaths","additionalOptionPaths","configuredProductId","lineItemId","configurationAttributes","_createConfigAttributesMap","optionConfigurations","_createFeatureOptionsMap","configurationData","_appendReadOnlyProperties","clones","_cloneProduct","_extendResponseQuote","_extendResponseProduct","_extendResponseProducts","optionNotifications","_getResponseOptionPaths","config","_getMatchingQuoteLine","featuresMap","featureName","changedExternally","optionSelectionMethod","_mixInUnselectedOptionsToAdd","_pushOptionConfigurations","featureOptions","isClick","_createPseudoOptionConfiguration","Quantity","optionConfiguration","pseudoOptionConfig","optionId","ProductCode","ProductName","featureId","addedOptions","addedOption","responseQuote","_sanitizeObject","responseProduct","_extendResponseConfigurationData","_extendResponseConfigurationAttributes","_extendResponseOptionConfigurations","responseConfigurationData","externalConfigurationData","responseConfigurationAttributes","responseOptionConfigurations","parentProductKey","fieldSetFields","responseOptionConfigurationsByOptionId","featureOptionConfigurations","_createDynamicOption","sourceOptions","sourceOption","_extendResponseOptionConfiguration","sourceData","optionFeature","_setOptionDataForClickFeature","_setOptionDataForNonClickFeature","_extendQuantityAndConfigurationDataToOption","opt","_createOptionConfigurationFromOption","_extendConfigurationDataToOption","additionalOptionPath","responseProducts","_resetFeatureOptionConfiguration","_buildProductKey","_enableSaveToLineEditor","responseOptionPaths","ConfiguratorSearch","fieldTypes","featureInput","showOptions","numOptions","hasFilterValues","hiddenByRule","configAttributes","configAttributesByFeatureId","isUpgrade","filtered","filterField","optionValue","checkNumber","checkMultiPicklist","checkDefault","untranslated","numberValue","multiFilterValues","multiOptionValues","fv","featureLookupId","optionsById","optionIndexById","optionsByFeatureId","featuresWithOptionsOrConfigAttr","featureIdsWithOptionsOrConfigAttr","featureIdsWithSelectionMethodAdd","featureIdsWithSelectionMethodClick","featureIdsWIthSelectionMethodDynamic","configurationAttributeValueMap","configurationAttributeModelMap","configurationAttributeTargetFieldMap","configurationAttributeApplyToOptionMap","attributeValueMap","productRulesActions","originalDataByOptionIds","optionDataByOptionIds","featureIdByOptionId","productOptionConfigurationsMap","initializeProduct","isOptionLookupViewModel","dummy","getFeature","isClickFeature","maxOptions","attribute","optionLayout","featureCategoryLabels","featuresWithoutCategory","tabFeaturesMap","featureCategories","featureCategory","appliedImmediately","getOption","localizeProduct","configurationEntered","featureLabel","initConfigAttributesById","initConfigurationAttributeMap","initOptionInfo","buildOptionConfigurationMap","getOptionSelectionMethod","initFeatureOptionConfigurations","addFeaturesWithOptionsOrConfigAttr","configuredOption","visibleSelected","isAddFeature","setOptionDisabledData","quantityLabel","minQuantityLabel","recordSelected","recordRequired","unitPrice","productName","setConfigurationAttributesToOptions","removed","mappedFeaturelessOptions","createOtherOptionsFeature","virtualFeatureTitle","recordHasQuantity","attributeSet","attributeItemIdsByOptionId","hasAttributeItems","addAttributeItems","addToOptionByFeatureId","discountAmount","discountRate","quantity","addOptionButtonLabel","addOptionDialogTitle","instructionsText","attributeItems","attributeItemById","drawerIconClass","duplicate","displayRadio","notInitialized","unsortedOptionConfigs","optUnitPrice","listPrice","isDynamicFeature","initOptionActions","initReconfiguredOption","sortAndAddOptionConfigs","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_syncOptionConfigurations","isNotClick","createOptionAction","addOptionConfigurationAction","mobileDisabled","numAttributes","featureless","configData","configurationAttributeReferencedFieldValue","configurationAttributeValue","myId","autoSelect","shownValues","hiddenValues","applyToProductOptions","configsArray","cloneOptionAndSyncConfiguration","syncOptionToConfigData","setPropertiesWithConfig","requiredOptionAdded","clonedOption","getProductOptionConfigurationData","isTranslated","optionData","dynamicOptionKey","containsUpgrades","unsorted","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","optionConfig","o","_iterator8","constraintsByConstrained","optionConstraintsByConstrained","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","createConstraintHoverMessage","constraint","Requires","Excludes","constraintMessage","ungroupedConstraints","ungrouped","connector","constrainingOption","statement","groupedOption","constraining","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","requirement","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_step11","_iterator11","exclusion","_getPreviouslyConfiguredBundle","getFeatureByOptionId","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_step12","_iterator12","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_step13","_iterator13","OptionConstraintsHandler","setOptionConstraints","constraints","constraintType","constrainedOption","constraintGroup","byConstraining","byConstrained","constrainingByConstrained","constrainedId","constrainingId","setByConstraining","setByConstrained","optionConstraints","changedOptionId","addedOrSelected","disabledState","optionIsConstrained","hasGroupConstraints","constraintObj","isConstrainedByUngrouped","isConstrainedByGrouped","getUnaffectedDisabledState","requiredConditionMet","excludedConstrained","requiredConstrained","associatedOption","associatedType","constrainedByDependency","constrainedByExclusion","constrainedWithinGroup","len2","priorOptionExists","optId","isDependency","hasUngroupedConstraints","hasGroupedConstraints","c","setConstrainedForGroups","setConstrainedForUngrouped","OptionUpgradeHandler","priorBundledQuantity","sourceOp","upgradeOp","upgradeOption","sourceProductIds","didUserChangeSourceOption","NestedOptionsModel","nestedOptionModel","buildOptionConfiguration","_addSelectedDataToOption","optionConfigs","segmentedMap","isSegmented","buildStrippedOptionData","productConfiguration","newConfiguration","isDynamicOption","ProductReconfigurer","RuleProcessor","validationMessages","optionDataByOptionIdAndIndex","initValidationMessages","initProductRulesActions","initDescendantTree","initOptionDataByOptionIdAndIndex","configuredProducts","onLoad","selectedOptionIds","disabledOptionIds","hiddenOptionIds","deselectOptions","hideOptions","enableOptions","disableOptions","serverOption","assignProductRules","optionNotInPricebook","handleProductActions","positiveAction","negativeAction","rulesProcessed","selectedByRule","indices","parentInfo","childInfo","handleDescendantRules","changedByProductActions","continueCB","_onCancel","ProductAlert","ConfigTree","idProperties","buildSubtree","_buildNode","getChildren","currentLevel","_buildId","_findOnLevel","nodeId","availableGroupTitle","chosenGroupTitle","_getSelectedGroups","isContainerHighlighted","CloneToGroupDialog","dataLineModels","deletedLineKeys","headerSelected","targetRowElement","segmentRows","onTrack","lineModelByStartDate","currentLineModel","newLineModel","startDates","_buildDialog","_combinePartialQuoteWithFullQuote","resetData","fullQuote","lineSetsBySegmentKey","linesByKey","_sentMDQKeys","linesSharingKey","combinedList","errorResponse","_onAddByIndex","toggleMenu","segmentGroup","newRows","click","_onDeleteLineData","_resetProperties","_validateCustomSegmentLabels","_validateCustomSegmentDates","hasInvalidSegmentDates","msg_invalid_custom_segment_dates","hasInvalidSegmentLabels","msg_invalid_custom_segment_labels","hasNonConsecutiveDates","msg_nonsequential_custom_segment_dates","hasOverlappingSegments","msg_overlapping_custom_segment_dates","updateSegmentMap","_getCustomSegmentUpdates","_createQuoteWithoutUnaffectedLines","updatedLineKeys","endDates","segmentLabels","UpdateCustomSegmentsService","necessaryLineKeys","necessaryLineIds","sentMDQKeys","necessaryLines","_buildFieldsMD","_toggleAllCheckBoxes","_buildRowData","_buildHeaderActions","quoteLineMD","fieldsMD","fieldsLength","rightAction","addAction","lbl_add_segment","deleteAction","lbl_delete_custom_segments","dataMap","lineModelsLength","_updateData","updates","customSegmentLabels","segmentStartDate","segmentEndDate","segStartDate","segEndDate","hasInvalidDateFormat","prevSegment","dayAfterEndDate","getFullYear","getMonth","allowsNonConsecutiveCustomSegments","sb-cancel-custom-segment","add-tapped","delete-tapped","CustomSegmentDialog","dialogTapped","discountUnitField","_calculateDiscountAmounts","discountTiers","buildRowData","_handleDialogTap","_handleDialogMouseEvents","loadDiscountScheduleService","overrideBehaviorField","savedTiers","usePriceForAmountField","_setDSFields","showRevertBtn","originalScheduleField","tierModels","buildTiers","buildFieldData","_createActions","_toggleEditableClasses","_buildTabData","newScheduleId","discountScheduleResponse","discountScheduleField","changedRecord","discountTierRecords","_retrieveRecords","previousLowerBound","lowerBoundField","fieldTableData","fieldsArray","discountScheduleModalFieldNames","tierField","priceLabel","lbl_price","prefixedFieldsByFields","discountAmountField","prefixedFieldsArray","_isFieldShown","numberField","_retrieveSchedule","_createBlankTierRecord","tierModel","_createRowActions","_renumberLines","_selectCheckboxes","_processForSaving","userDefinedField","quoteLineField","discountScheduleJSON","tiersJSON","ignoreValidate","discountScheduleUpdaterService","discountScheduleClonerService","dialogOverlapping","hiddenTiers","_sortTiers","visibleTiers","_updateActions","_createTiers","validate","tiersField","discountRateField","quantityField","specialPriceField","upperBoundField","errorsArray","rowNumber","currentQuantity","userDefined","lastPositionIndex","lowestBound","highestBound","_retrieveVisibleRecords","disabledDiscountTier","specialPrice","lowerBoundList","tiersByLowerBound","sortedTiers","msg_identical_lower_bounds","isoCodes","currencyIsoCodes","isoCode","_createMultiCurrencyRecord","_toggleDialogClasses","applyClasses","sbDialog","fieldsEditable","AccountId","tId","dsPriceScaleField","_handleIconAction","DiscountScheduleDialog","favoriteKeys","numGroupLines","FavoriteDialog","pricebooks","selectedPricebook","pricebookLoaderService","success","pricebookSaverService","PricebookDialog","headerValues","lineItemValues","propertyName","PricingGuidanceDialog","tableCols","quoteLineFieldsMD","CSETableCell","actionHidden","button","groupAction","horizontalAlign","horizontalOffset","verticalOffset","hasMenu","_hasMenu","_getLabel","_toggleButton","_setButtonClassAndLabel","toggleQuickSaveButton","CustomAction","handleOriginalValues","DSTableCell","_deleteGroups","DSTiers","quoteFieldNames","_visibilityChanged","_editabilityChanged","setHiddenFromPSPClass","FieldSetTable","datepickerHeight","offsetHeight","datepickerWidth","windowHeight","innerHeight","windowWidth","distanceFromBottom","distanceFromRight","editabilityMap","_valueChanged","_updateLookupDisplayValue","addRelationshipName","_updateOriginalValue","toggleEditing","sb-field-on-change-field","FieldSetTableItem","_isRichTextField","LEDrawer","quoteTotal","quoteTotalMd","_setTotalWidth","showQuoteTotal","labelClass","lineEditorTotalsField","_setQuoteTotal","total","totalsField","applyAdditionalDiscountLast","customerTotal","netTotal","colWidthsChanged","LEFooter","descriptionMd","groupLevelTabs","favorited","groupHasSegmentedProducts","_updateTableProperties","_updatePageData","_getTabs","_setIsButton","buildGroupTabs","containerClass","isButton","groupHasStandardProducts","_groupHasSegmentedProducts","groupedAndHasNoLineItems","_groupHasLineItems","groupHasBothProducts","_groupHasBothProducts","_setGroupDescription","groupMDQTabs","localizedDimensionNames","iconClass","iconEvent","groupModelKey","_getDescriptionMd","description","groupObjMd","lineEditorGroupSubtotalsField","namesForGroupLayout","_renderTabs","tabName","sourceIndex","upgradeIndex","sourceLineVO","upgradeLineVO","_notifyQuantityChanged","index1","index2","invalidQuantityCheck","validQuantityCheck","internalUpdate","removeDimensionProperties","dragLineModel","dragKey","dragIndex","_updateMDQTableRowHoverOverObject","_updateSegmentedSubscriptionScopeEditable","segmentedKey","dragTable","dropTable","renderNewTab","cseDialog-tapped","segmented-changed","upgrade-asset-quantity-changed","LEGroup","saveColumnObjects","resetColumnSizes","STANDARD_DIM","noHeader","layoutLink","layoutWidth","layoutLeft","lastSelectedGroup","_resize","buildLayout","splicedRecords","indexSplices","addedCount","addedIndex","addedKey","observersAttached","_attachObservers","resizedField","colWidthKey","columnSizes","shouldBeDefault","cachedData","closePanel","openPanel","drawerPanel","mainPanel","paddingLeft","navTo","isFullScreenToggleEvent","_groupModelsAreChanged","multiDeleteEnabled","hasLines","colConstants","_getMaxTableWidth","_calculateGroupWidth","clientWidth","tableLayoutBuilder","_getQuoteStandardFields","getTotalWidth","_hasSegmentedProduct","multiSegmentFieldNames","_getQuoteSegmentedFields","groupLayout","_getGroupStandardFields","getLeftOffset","_updateMaxWidth","_getSegmentedFieldNames","subsScope","_getStandardFields","fieldSetKey","_updateFieldSetName","multiSegmentSummaryFieldNames","colNames","summaryFields","_observeNodes","removedNodes","processNewGroups","processRemovedGroups","toggleSelectedAndScroll","unobserveNodes","groupElement","_scrollIntoView","scrollIntoView","scrollTop","prevGroupKey","currentGroupKey","sbDroppableSidePanelGroups","_findSidePanelGroupValidTarget","groupPanelCreated","groupAdded","groupDeleted","pageResized","resetToDefault","resizeColumnsOnLineItemDelete","side-toggle-clicked","sf-col-size-adjusted","sf-reset-col-sizes","LEGroupLayout","LEList","LEListGroupFooterRow","isStandard","_setSubtotal","getFields","standardLineColumnWidths","LEListGroupHeaderRow","factoryMap","wrapper","targetName","currentEl","targetEl","LEListRow","LEListSegmentedLineRow","LEListStandardLineRow","_colWidthsChanged","LESummaryRow","getUnproratedDiscount","price","rawDiscount","modifier","targetCustomerAmount","targetCustomerTotal","getEffectiveQuantity","amountDiscountProrated","priorQuantity","isAdditionalDiscountField","getLineVOProperty","defaultAdditionalDiscountUnit","markupUnitOptions","defaultMarkupUnit","previousDisplayValue","nullifyAll","unproratedDiscount","amountMultiplier","changeAdditionalDiscountUnit","cost","markup","changeMarkupUnit","nextActiveUnitValue","QuoteLineUpgradeHandler","ICON","OVERRIDDEN","fieldClass","detailsOnHover","renderTooltip","scopeSubtree","wasModelIsChangedCalledBeforeAttached","_modelIsChanged","quoteLineUpgradeHandler","getSourceLineVO","getUpgradeLineVO","_quantityChanged","assetUpgradeQuantityCalculator","overrideEditable","_setEditable","_setFieldMD","_setFieldClassAndFieldContent","dependentPicklist","_showDetails","_dataOrValueChanged","userChangedLookupValue","_updateRelationshipName","_editableChanged","_isSegmentedDrawer","_togglePreventNumericAlignment","_toggleSegmentedAlignment","overrideValue","setQuantitiesByRatio","getIndexes","lineModelKeys","lineModelKeysLength","_getLineModel","tap","LETableCell","productLocalization","productFieldLocalization","sourceOrUpgradeLineVO","_findLineWithTargetAssetId","groupCount","seekExistingLine","targetAssetId","key2","didUserChangeSourceLine","Swiper","primaryCells","swiping","leTableRow","classFollows","pcLength","fieldClasses","_buildRows","fieldsRenderedAsNumber","displayDrawerIcon","expansionIconClass","deselectCheckbox","LETableHeader","showSortableHeader","overflowTrue","headerNode","bundlesVisualized","newSort","_getKeyByValue","LETableHeaderCell","field-updated","mobileCols","isDesktopAndHasNoActionsOnTheLeft","isDesktopAndHasActionsOnTheLeft","mdqFields","showCheckbox","_buildRow","totalsByColumns","displayDrawerIconCell","opportunityWarning","invalidEntryWarning","widths","lineTypeClass","_selectedChanged","_handleFieldValueChanged","enableEditableFields","toggleLineExpansion","_handleFieldEditability","_toggleSelection","mobileDrawerOpened","LETableRow","firstIndex","lastIndex","segmentNumber","_pathRefersToMySegmentRecord","pathList","segmentModel","detailFieldNames","segmentRecord","_setGroup","_initializeFieldVisibility","referencedSegmentVO","referencedKey","referencedIndex","referencedLabel","mySegmentKey","mySegmentIndex","mySegmentLabel","SegmentedDetailRow","change","rte-value-changed","_adjustDetailFieldHeights","fieldNodeList","fieldElems","cellElem","detailFieldNamesWithLabel","fieldNamesColWidth","SegmentedLineDetails","mouseover","shadyRoot","bundleCaret","_toggleBundleExpansion","drawerContainer","_toggleStandardDrawers","segmentedDrawerContainer","_toggleSegmentedDrawers","currentlyExpanded","_restampField","checked","_toggleDrawers","CHEVRON_RIGHT_ICON","CHEVRON_DOWN_ICON","closeIcon","expandIcon","lineModelIconAttr","newIconClass","Templatizer","SFLETableHeader","controllingFieldValue","ControllingField","DeviceDelegate","isRichTextArea","_createWritableElement","_formatNewValue","_toggleDirtyClass","SELECTION","toggleCheckbox","_getEditorModel","discountComp","setDiscardPendingEdit","DesktopDelegate","toggledEditable","_getEditableFieldValues","_getControlledFields","tableCell","cellClassList","_handleEditableCellsHover","_shouldClearFieldValue","_clearFieldValue","controlledFieldValue","_getControlledFieldValue","_updateFieldValue","EditabilityControllingField","expansionDisabled","toggleExpanded","swipeCont","spanElem","secondaryContainer","_loadSecondaryFields","EXPANDED","secondaryRowTemplate","_instance","MobileDelegate","NonDiscountableControllingField","PriceEditableControllingField","PricingMethodControllingField","PricingMethodEditableControllingField","mouseout","QLEDesktopDelegate","SubscriptionTypeControllingField","selected-date-changed","lookup-value-changed","initListeners","devices","updateTemplate","_resetPencilLoaded","_refreshDirtyIndicators","_loadLineWarning","hasChildNodes","uiDatum","_handleChangeControllingField","controllerField","depFields","getDependentFields","_getFieldValue","newOptions","_updateDependentPicklist","getControllingFields","getFieldName","updateControlledFields","updatedMetadata","metadataToUse","_handleSegmentedCellHover","containerEditable","onTap","hasDrawerFields","toggleDrawer","toggleBundleExpansion","onRowSwiped","grandParentElem","_calculateImmediately","_getLineNumber","expansionChanged","isCollapsed","getFieldMetadata","unlisten","_isDragAndDropEnabled","fieldContainer","tooltipBody","originalModel","contentChild","discountConstants","_isAdditionalDiscountUpdated","getFieldComponent","SFLETableRow","showInfoIcon","_actionHandler","handleAction","dsModalBtn","eventFunc","_timeout","_modelChanged","SFLineActions","SFLineWarning","ListItemTemplateGenerator","templateOptions","additionalUIData","labelsMap","generate","datum","PreviewPanel","segmentedModel","_getSegmentedLine","_prepareLineData","generateSegmentedTooltipFieldSetTemplate","prepareLineData","SFSegmentedCellTooltip","TableHeaderTemplateGenerator","SFTableHeader","LETableHeaderTemplateGenerator","allowColumnResizing","hasSelectionColumn","isMultiLineDeleteEnabled","hasItemNumberColumn","_getDrawerColumnTemplate","fieldMd","buildRowSegmentFieldSet","fieldSetTemplate","actionsTemplate","generateActionsTemplate","itemNumTemplate","generateItemNumberTemplate","checkboxTemplate","generateCheckboxTemplate","drawerCellTemplate","generateDrawerCellTemplate","addLineActionsToTemplate","LEFT_ALIGNED","RIGHT_ALIGNED","useNetTotal","generateInnerCheckboxTemplate","collapsibleCls","isAriaButton","_getAttributes","generateInnerFieldTemplate","_getMetadata","colIndex","src","getLeadingColumns","generateSelectionColumn","generateItemNumberColumn","getColumnWidths","widthUnit","getColumnWidthUnit","colAdjBar","generateColAdjBar","colAlignment","getColumnAlignment","sortableCls","sortArrow","isSortable","beforeFieldTemplate","getBeforeFieldTemplate","getTrailingColumns","generateColumnIndicator","columnWidthUnit","TableRowTemplateGenerator","getAttributes","CLASS_NAMES","SECONDARY","generateRow","getColWidths","generateInnerFieldSetTemplate","getColumnClass","getPrimaryClass","focusable","getFieldLabel","generateProductCell","UBPDesktopDelegate","getDataFromCache","getDataFromCacheAsync","loadRateCardSummary","unsavedUbpChanges","inlineEditChanges","inlineEditedCategories","rateRecord","rateField","_displayPreviewTooltip","_previewPanel","_rateCardPreview","rateCardPreview","rateCardData","dirtyFields","schedules","changes","_mapToMasterUbpChanges","overrideData","deepEquals","_updateUiData","unsavedRate","_computeUnsavedEditForRate","_formatUiData","formattedData","formattedDatum","unsavedEdits","scheduleOverrides","_getInlineEditChangesForRate","isUbpFieldInlineEditable","mutation","shouldRemove","catId","catRates","_refreshRow","UBPRateRow","unitPriceFields","quantityFields","objName","LEFieldMD","merge","loadUbp","quoteLevelTabs","mdObjects","getFromService","customActionName","_doesUserHavePermissionForAction","diagnosticToolEnabled","_openDiagnosticTool","needsInit","_cacheProductRuleFields","enableLQTSelectionRules","cmd","customActionServices","_updateFieldLabelsMap","_handleGroupCustomActions","_getGroupModels","hasQuoteFieldSet","_executeCmd","isCoTermPrompted","_navigateToContractLookupPage","_executeDefaultCustomAction","_handleMissingPricebook","_loadProductRules","_redirectToLineEditor","executeProductRules","quoteTotalDisplayed","quoteDetailsIconClass","groupKeyInUrl","_isSubtitleCombined","serviceName","serviceComponent","subtitleCombined","isExpanded","groupCustomActions","userType","pricebookDialog","localizedDimensions","localizedSegments","setPageLoaded","quoteActions","_executeCustomAction","allDefaultCustomActions","_getValidDefaultCustomAction","namesForQuoteLayout","buildUngroupedSegmentedTabs","ungroupedMDQTabs","quoteMDQTabs","groupedQuoteHasNoGroups","ungroupedQuoteHasNoLines","recombineFn","updateInner","beginPrecaching","setLogger","_setError","ruleExecutor","jsprLabels","ruleResponse","handleLinesAddedByProductRules","quoteLineAdder","fieldNamesByObjectNames","_removeDuplicateLineFieldsInDrawer","numOfFields","ln","_notifyPSLAssignment","removeDuplicates","primarySet","lineFieldNamesPhone","lineFieldNamesTablet","restoreCache","notifyPSLAssignment","notification","cseDialog","segmentsArray","quoteDetailsHidden","toggleQuoteDetails","_toggleFullscreen","enterFullScreenMode","elm","requestFullScreen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","cancelFullScreen","msExitFullScreen","mozCancelFullScreen","webkitCancelFullScreen","standardPrimaryMobileColsLength","segmentedPrimaryMobileColsLength","isMobileRendered","isDesktopRendered","serviceType","quoteChanges","copyChanges","originalObj","objChanges","updatedLine","originalGroup","updatedGroup","pathArr","ubpContainer","qleContainer","showUbpEditor","loadFieldEditability","qlEditorContainer","ubpEditorContainer","ubpEditor","_toggleEditors","trunc","_loadUbp","getPreviousRoute","newData","cacheHit","toolWindow","initPublisher","setInstance","_onError","le-action-tapped","cseMobile-tapped","cse-tapped","change-ghost","renumber-lines","validate-quantity-changed","field-change-validated","calculate-immediately","rte-saved","calculate-cache-get","toggle-ubp-editor","toggle-page-loaded","LineEditor","loadRates","successMsg","selected-page-changed","sb-cancel-backToQuote","quoteLine","ubpRateTable","clearSearch","confirmationDialog","discardUnappliedChanges","_closeConfirmationDialog","_loadRates","UBPEditor","runnerFactory","scheduleMap","volumeDiscountField","termDiscountField","productField","vId","cId","costScheduleId","extractScheduleMapFromQuote","overrides","account","objectPrefix","groupType","linePricingGuidanceType","typeName","determineMetadataFullNames","mdResults","requiredIds","uniquenessMap","getOptionIdsFromLines","requiredFields","ruleRecords","svContext","svIds","condIdCollector","condRecord","filterVarField","testedVarField","actionIdCollector","sourceVarField","recordPrefix","condRelationship","actionRelationship","getSummaryVariableIds","loadSummaryVariables","svRecords","targetObjectField","constraintField","aggregateField","assetFields","subscriptionFields","svId","svRec","loadAssetsAndSubscriptions","assetAndSubRecs","pricingGuidanceIds","pricingGuidanceIdSet","pgId","pricingGuidanceId","extractPricingGuidanceIds","getProductIdsFromLines","pricebookFilter","currencyFilter","sweepModelsForLookupIds","lookupFields","targetType","aliasTargetType","getAliasTargetType","convertedId","queryInfo","referencedIds","lineItemsToLoad","isManualEditEnabled","jsqcPlugin","_settings$ubpReferenc","ubpReferencedFieldMap","_settings$ubpReferenc2","ConsumptionRate","_settings$ubpReferenc3","consumptionScheduleFields","requiredConsumptionRateFieldsSet","_getRequiredConsumptionRateFields","requiredConsumptionScheduleFieldsSet","_getRequiredConsumptionScheduleFields","hasConsumptionField","lineIdSet","transactionIds","scheduleFields","createCalloutContext","transactionIdsToSObjects","ConsumptionSchedules","resultsToPost","ConsumptionRates","consumptionRates","performLoadAndFormatResults","depthFirstLineItemsTreeSort","rowTemplate","originalFieldValues","_resetHeaderTemplate","getTemplateGenerator","generateRowNode","_getFieldsForTemplate","_getAllFields","isCurrentDimension","spliceChanges","linkPaths","headerColumnNames","netMultiSegmentTotalField","headerTemplateGenerator","headerTemplate","generateHeaderNode","groupPanelToggled","groupToggled","_openLookupDialog","_closeLookupDialog","_resetOnAction","postLineSplice","sortLinesRequired","SFSegmentedTable","removeTableRowBorderClass","_toggleBundleLines","_resizeIronList","_prepareTemplates","includeHeader","includePrimaryMobileCols","_hasNumberField","_preserveNumberValues","_innerToggleBundleLines","collapsedContent","clearOriginalFieldValues","onRowsRenumbered","SFStandardTable","UNSORTABLE_FIELDS","clientCacheSearchInput","userSearchInput","rateIds","totalRateCount","hasInlineEditChanges","table-header-sort-clicked","rate-row-rendered","toggle-tooltip","iron-resize","inline-edit-commit","tooltip","_previousRenderLength","threshold","clearTriggers","checkScrollThresholds","oldScroll","_resetScrollPosition","sourceField","_ref$detail","headerOptions","_getWidthParameters","_getFieldsFromMetadata","_calcColumnWidths","metadatum","searchtext","_search","_shouldDisableSearch","searchRateInput","updateHeaderState","setSort","_getSortLabel","currentField","appliedEdits","appliedChangeKey","consumptionSchedules","unsavedChanges","returnObject","cs","consumptionRate","_updateAfterCalculate","_getUnsavedUbpChanges","savedScheduleAndRates","_getSavedSchedulesAndRates","newValues","sch","applied","mergedRates","normalizeAndMergeUnsavedChanges","_validateRates","_overrideConflictingInlineEdits","msg_changes_applied","needRefresh","scheduleAndRatesForQuoteLineOrProduct","usageBasedPricingDAO","getFromCache","filteredSchedulesByCategory","cr","inlineEditedRates","IronResizableBehavior","UBPRateTable","preLoadObjects","qo","smLoadService","primaryMobileColumn","resultFieldNames","drawer","togglePanel","refocus","closeDrawer","af","focusFirstField","lookupLayout","navigateToAssetUpgradeRoute","pIds","runService","runSearcher","clearFields","assetLookupObjects","AssetLookup","upgrades","upgradeSourceMap","upgradeTargetMap","assetHeaderSelectable","initializeServiceSpinners","initializeProperties","handleUpgradeSelected","handleAddProductResponse","handleLineEditorModelResponse","handleSelectionResponse","addProducts","smSelectService","getSelectedUpgrades","renderUpgrades","upgradeSelected","availableUpgrades","upgradeTarget","setUpgradeTargetMap","upgradeResults","upgradeProduct2Id","navigateToLineEditor","selectedUpgrades","getUpgrades","addProductsArray","upgradeTargetId","upgradeSourceId","targetProduct","sourceProduct","ifRadioSelectedClearOtherRadioSelections","sourceProductId","handleConfigurableProducts","configProductIds","getConfigProductIds","pId","getSelectedProducts","assetUpgradeObjects","availableUpgrade","sourceProductIndex","AssetUpgrade","FormField","addAttribute","setFormattedValue","formattedDate","simpleFieldFactory","inputFactory","environment","newMobileDatePicker","hasStart","hasEnd","readOnlyKeyEvent","readOnlyBlurEvent","changeEvent","newDateRangePicker","newDatePicker","newFormattedDate","getDiscountUnit","pattern","numberFormatter","readOnlyKeyDownEvent","checkboxFactory","datePickerFactory","numericFieldFactory","lookupFactory","selectFactory","textFieldFactory","FRONT_BINDING","0","1","2","BACK_BINDING","binding","variable","readOnlyKeyHandler","readOnlyKeyDownHandler","readOnlyBlurHandler","changeHandler","hiddenField","_html","_formattedValue","_defaultValue","_readOnlyKeyEvent","_readOnlyKeyDownEvent","_readOnlyBlurEvent","_changeEvent","_numeric","discountFactory","inputClass","formattedValueWithUnits","textareaFactory","richTextEditorFactory","toHTML","newInput","extractReferenceDisplay","refObj","refType","nameProp","extractRefDisplay","relationshipRec","filteredLookupInfo","newLookup","setInnerText","addEvent","newReferenceLink","NAME_MAP","Contract","Case","lookupFieldFullName","resultsLimit","currentRecordFields","currentRecord","applyMruOptimization","selectAllFields","searchAdditionalFields","searchCriteria","noWildcardSearchValue","scope","getScope","scopeClause","getSelectClause","getWhereClause","orderByClause","currentRecordField","omitField","getBindValue","searchValueLength","isDateType","_buildFields","whereConditions","dateSearchValue","numberSearchValue","fieldKey","relationships","lookupField","FONTS","DELTA","Quill","sizeStyle","fontStyle","alignStyle","directionStyle","Inline","Parchment","BlockEmbed","Block","whitelist","SFDCTags","blotName","Divider","HeaderLowercase","DescriptionList","Abbr","Bdo","domNode","Table","_value","caption","colgroup","tr","td","colSpan","rowSpan","AnchorBlot","CiteBlot","Attributor","Style","IndentAttributor","indentStyle","Scope","BLOCK","TextDecorationStyle","tooltipTextMap","imageDialogOpened","currentSelection","saving","rte-image-saved","rte-image-closed","rte-open-image-dialog","_encapsulateStyle","sheets","head","_getTooltipMap","indentText","quill","isOutdent","currFormat","getFormat","currIndent","indent","indentNum","targetIndentNum","toolbar","handlers","image","Event","clipboard","matchVisual","keyboard","bindings","outdent","outdent backspace","theme","quillInstance","history","undo","redo","rteContainer","_initialize","updateContents","retain","insert","imageDialog","setContentToQuill","configureWarningMessage","setText","dangerouslyPasteHTML","editor","ops","deltaLength","formatHtml","removeEncoding","_stripDivTag","bold","italic","underline","strike","fontSize","headerSize","fontFamily","alignLeft","center","alignRight","textColor","subscript","superscript","numberedList","bulletList","decreaseIndent","increaseIndent","blockQuote","clearFormatting","RichTextEditorDialog","newRichTextEditor","originalWidth","originalHeight","widthDim","heightDim","imageSrc","isChecked","Image","_updateImageSizes","widthDimInput","heightDimInput","imgWidth","imgHeight","_conversion","oppositeValue","RTEImageDialog","useNoneLabel","restrictedPicklist","precision","newSelectList","newTextarea","ContractLookupTable","EVERGREEN","NON_EVERGREEN","contract-selected","contractsByType","contractLookupObjects","contractTabs","selectedContractId","selectedEvergreenContractId","selectedAssetIds","setAndPrefetchObject","setPropertyFromUrl","setSkipActionClass","handleContractModelLoadResponse","handleContractModelSaveResponse","handleContractModelLoadRequest","accId","skipAction","skip","skipActionClass","contractModelLoadService","evergreenField","contract","buildContractsTabs","contractType","contractModelSaveService","tabsInfo","buildModel","EndDate","dataBuilder","navigateToDetailPage","objectId","isLightningExperience","ContractLookup","selection-changed","activeContractFieldSets","contractObject","handleContractLoadResponse","setFieldSet","selectedId","API_FIELD_NAME_MAP","isClassic","productIndex","firstItem","remainingItems","customActionsExist","moreThanOneCustomActionsExist","buttonsCollapsed","urlKey","labelKey","actionKey","brandButtonKey","labelUrlMap","checkCustomActionsConditionsMet","brandButtonClass","targetItem","handleURLAction","applyRules","handlePopup","handleNav","conditionsKey","operatorKey","filterValueKey","targetObjectKey","_checkPackagedCustomActionConditionMet","targetObject","CustomActions","setRequired","isValidValue","attributeField","targetField","setAttributeMD","getPicklistValues","setTargetField","defaultValues","attributeFieldMD","attributeItem","AttributeItem","addedClass","showTable","optionFieldMetadata","setMD","_setReferencedData","getMD","attributeFields","attributeModelData","flsFeatureAttributes","targetAttribute","columnOrder","featureAttributesByFieldName","featureAttributeIds","featureAttribute","_prepareColumns","prepareColumns","_prepareColumns2","normalizeData","createFeatureAttributesByFieldName","featureAttributes","bundleAttributes","bundleAttribute","overridePropagateFromParentToChild","captureCallBack","setFromChildToParentExtension","attributeId","_getTargetFieldNameFromModel","referencedField","attributeData","attributeID","AttributeTable","ProductBundlesFilterItem","setToSections","hasSelected","hasMultipleBundles","searchValuesByFilter","searchFieldMD","searchFilterTypeMap","configSearch","resize","handleResize","handlePanelSlide","handlePanelEvents","handleMD","applyFilters","numBundles","getProductId","toggleTransition","configuredProductIndex","sfSidebar","_setBundleContainerWidth","selectBundle","navWidth","buildPanelIfMultipleBundesAndNotMobile","panelWidth","isDrawerOpen","bundleContainer","_transition","underscorePrefix","removeAllSelected","navItem","_updateProductFromPopupResponse","numConfiguredProducts","ProductBundlesLayout","tabNames","hasConfigAttributes","hasTopConfigAttributes","hasBottomConfigAttributes","mobileHasConfigAttributes","hasOptions","mobileHasOptions","hasOptionsAndConfigAttributes","mobileHasOptionsAndConfigAttributes","hasInstructions","mobileHasInstructions","hasSelectedOptions","featureIndex","hasUpgradeOptions","mobileRendering","mobileExpanded","getHasUpgradeOptions","setFeatureAndOptionSelectionMethod","setOptionsDetails","setFieldSetHandler","renderFeatureInDesktopOrMobileView","initSelectedOptions","handleDeleteOptions","handleOptionChangedByRule","buildTabs","optionsTab","attributesTab","isClickSelection","configurationFieldSet","initFieldSet","setFieldSetFromViewport","_hasTopOrBottomConfigAttributes","additionalInstructions","getOptionsByFeatureId","containsFeature","expand","ProductFeature","categoryNamesOrFeatures","hasCategories","checkAtLeastOneFeatureHasCategory","setCategoryNamesOrFeatures","getTabFeaturesMap","ProductFeatureCategoryList","vp","hasFeaturelessConfigAttributes","isMobileAndHasConfigAttributes","isSectionLayout","isPaginationRequired","tabsForFeatureLayout","tabsForTabsAndWizardLayout","optionConstraintsHandler","disabledStateMap","listenersAttached","featurelessConfigAttributes","getOptionLayout","buildFeatureLayoutTabs","handleOptionSelectionChanged","buildTabsAndWizardLayoutTabs","featuresTab","featureKeys","handleOptionConstraints","hasSameOptionAdded","disabledStateChanges","handleProductRulesResponse","setOptionsDisabledByRules","setOptionsHiddenByRules","setOptionsSelectedByRules","optionIds","ruleAction","optionSystemOrRequired","shouldBeConstrained","optionShouldBeDisabled","handleFeatureVisibility","pvm","hideFeature","checkFeatureHasVisibleOptions","_setOptionData","_bindResponseChangesToUI","_setConfigAttributes","dynamicOption","_getDynamicOption","_extendDataToOption","syncConfigurationAttributesToProduct","autoSelectAttributes","_createConstraintsHoverMessages","createConstraintsHoverMessages","setSelectedForConstraints","constrainedArrays","getConstrainingByConstrained","constrainedArray","ProductFeatureLayout","initLazyTabRendering","handleTabSelected","initFeatures","filterFeatures","_filterFeatures","_filterQueuedForNextRender","allFeaturesHidden","numFeatures","_filterFeatureByIndex","_parentHandleContentFiltered","visibleContent","contentFilteredHandler","setOptionVisibility","_hideFeature","hasRequiredConfigAttributes","hasVisibleOptions","allOptionsHiddenByRule","hasAnyConfigAttr","selectionMethod","maxOptionsMet","renderComponent","renderingComponent","setFeatureOptionsAsRendered","ProductFeatureList","optionDrawer","isDisabled","initQuantityCell","initUnitPriceCell","initCell","getFieldRecordValue","fieldDetails","hasDimension","mdqWarningIcon","getQuantityEditable","attachQuantityChangeCallback","getPriceEditable","quoteLineHasField","setDisplayIfRelationshipItem","attachValueChangedCallback","getBundleId","composedPath","syncValueChangeWithOptionConfiguration","optionCell","OptionCell","setFieldNamesAndRichTextFields","OptionDrawer","showAddOptionsButton","primaryMobileCol","showUpgradeOptions","upgradeOptionButtonText","attributeItemFields","productHasAttributeSet","displayStyle","handleSelectionChanged","handleMetadataChanged","handleDeleteOption","handleConfigureOption","_selectionChanged","_handleOptionUpgrades","setOptionSelected","getOptionIndex","_displayAvailableRowActions","changedOption","priceRule","actionsHidden","fieldMetaData","initFieldMetadata","fieldSetMd","attributeItemMd","optionUpgradeHandler","getSourceOption","getUpgradeOption","sourceOptionIndex","upgradeOptionIndex","_notifyQuantityChange","setMetadataRequest","mdFieldSet","setAttributeItemMetaData","mdItem","addMetaDataProperties","addAdditionalMetaDataProperties","initOptions","_optionsExternallyChanged","_renderChangedRows","isFeatureOptionless","_setHeaderActions","_addSelectedOption","deleteOption","_step6$value","setOptionsDisabledData","optionShouldChange","changeOptionDisabled","_collections","deleteMultiple","copy","sameOptionAdded","showOrHideAddOptionsButton","sameOption","_step8$value","optionalSKU","filterOptions","optionCount","configuredOptions","setUnaddedOptionsRulesActions","setDisplayedOptionsRulesActions","h","fireOptionChangedByRule","priceActions","_getPriceActions","priceAction","_calculateUnitPrice","unitPriceField","getPrefix","upgradeOptions","setHasUpgradeOptions","_showUpgradeOptionIfSelectionMethodAdd","ProductOptionTable","redirectUrl","defaultFilters","handleDrawerClosed","handleOptionConfiguratorResponse","_createQueryParams","exceededNumber","validateMaximumOptionsNotExceeded","productLoader","oId","productIdx","optionConfigure","headerSubtitle","convertProductsToOptions","setCurrentProductModel","layoutFieldSet","productFieldSets","buildDelegator","filtersLoaded","valueObject","getStringValue","panelHeader","pf","clearfilter","lastSubmit","orderedSelectedProductIds","id1","id2","orderedSelectedProducts","selectedProductId","valueField","optionsSelected","DynamicLookup","topLevelBundle","currentProductModel","_handleLineEditorModelResponse","_handleProductLoadResponse","_handleOptionSelection","_validateMaximumOptionsNotExceeded","_addSelected","_selectAndAdd","_routeToConfig","_resetPage","lineEditorRead","productLoad","optionTable","displayDelete","_fireSelectionStatesForOtherFeatures","_toggleOptionSelection","_handleOptionConstraints","deselectOptionsOnOptionLookup","previouslySelected","optionLookupObjects","OptionLookup","ConfigurationError","CONFIGURATION_ERROR","productSelectionModel","headerTitle","isMobileAndHasMultipleBundles","preventPreLoadObjects","handleProductLoadResponse","handleOptionSaveResponse","handleProductRulesInvokerResponse","handleCustomActionsCollapsed","handleOnAddOptionClick","handleBundlePanelClick","handleChangeEvents","handleApplyEditRulesAction","handleBundleNameChange","handleExternalConfiguration","handleConfigureOptionEvent","optionSave","productRulesInvoke","returnToQuote","handleProductConfigurationInitializer","productAlerts","setOptionConfigurationDetails","loadedModelIsReconfigure","reconfigure","addAttributeSetFromServerProductVO","prod","getConfiguredOptionsFromPath","multipleBundlesView","getProductIndex","SearchFilters","filterMap","bundles","checkForExternalConfiguration","_handleExternalDynamicOptionsResponse","ruleProcessor","getValidationMessages","removeClonedConfiguration","swapConfiguration","afterSaveNavigate","getLastFromPath","popFromPathAndGetNextSKU","createPathParams","createQueryParams","_processProductRulesInvokerResponse","configuredProductKey","_setHiddenAndDisabledOptionIds","getProductRulesActions","getOptionDataByOptionIdAndIndex","changeAllActions","navToBundle","handleChangeEvent","removeAddedOption","getProductById","handleApplyImmediatelyProductRules","_handleExternalDynamicOptions","thirdPartyConfigurator","isReconfigure","hasInitializedProductConfiguration","c_product","o_config","configurationAttributesValid","configuredProduct","prepareProductForServer","addedProducts","getConfiguredProductsToSave","getSelectedProductsToSave","Configuration_Attribute_Error","getConfigurationAttributeMissingFeaturesMessage","back","productsToSave","configuredProductsById","productToSave","selectedProduct","externalKey","externalURL","externalConfiguratorUrl","visitedExternal","redirectAfterOptionsAdded","handleDynamicOptionsAdded","eventContext","Maximum_Quantity_Error","isAppliedImmediately","upgradeAssetId","applyImmediatelyContext","prepareProductForNestedConfigure","nested","addToPath","stagedOption","nestedProduct","hasDynamicFeature","msg_has_no_options_config","descendLevel","configure","getCurrentConfiguration","applyImmediately","minimalProduct","selectedAndRemovedOptions","getSelectedAndRemovedOptions","skipValidations","removedOptions","missingConfigurationError","msg_options_missing_config","setUpgradedAssetId","buildOptionForLineEditor","getAllProductIds","requiredConfigAttributes","productConfigAttributes","requiredProductConfigAttributes","productConfigAttribute","requiredConfigurations","getRequiredConfigurationAttributes","missingAttributes","productConfigData","productRequiredConfigAttributes","requiredConfigurationAttributeValid","requiredAttributeMissingValue","featuresWithRequiredMissingAttributes","attrs","getFeatureNameFromId","featureNames","feat","toggleSearch","getExistingConfiguration","featureOptionalSKUs","buildDynamicConfigurations","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_step14","_iterator14","configuratorObjects","ProductConfig","configTree","_setConfiguredOptionsObject","CONFIG_TAG","SAVE_TAG","_getParentConfiguration","clonedConfiguration","_setAndReturnConfiguration","_setAndGetConfiguration","_getTagForSave","_removeDeselectedOptions","_addSelectedOptions","_sortOptionConfigurations","_setConfigured","_removeSubtree","parentTag","optionTag","_getConfiguration","serverConfiguration","saveConfiguration","getSaveConfiguration","_removePreviousConfigurations","_addToConfigTree","saveConfig","configPath","configsToAdd","level","getFromPath","existingConfigs","configToAdd","searchPath","_createPath","sku","optionInfo","_buildPathString","_addConfigsToConfigurationObject","nestedConfig","existingObj","_findInConfiguration","_updateSubtree","_appendSubtree","staged","_propagateRuleData","_propagateAttributes","_mergeNestedConfigurations","_updateThenGetSubtree","productConfigurationData","_cloneConfiguration","existingConfig","_addIndexProperty","doNotAdjustIndices","childIndex","_getChildIndexAndAdjustIndices","_removeConfiguration","childId","_alterIndexPropertyAndNodeId","prevId","includeLast","alteredPath","step","_step4$value","orderedOptions","sortedConfigs","_step5$value","previousConfig","Suggester","filterContext","gsfields","inputs","processInputValues","evaluateProcessInputConditions","numPass","masterProcessInputValue","Ids","PANELS","modalActive","hasQuoteProcess","selectionSaver","setPanelDisplay","openSearchFilterByDefault","toggleFilter","panelSuggester","suggester","panelGroupItems","setSpinnerMessage","handleClearSelected","handleSelectButtonClickedServerResponseAndNavigation","handleLabelChanged","clearFilterFields","resetSearchBar","attachSearchBarEventListeners","selectionReader","runOnLoad","runSuggester","inputField","quoteProcessId","getQuoteProcessId","guidedOnly","searchFiltersTabShown","onLoadSearchModel","productResultsGroupFieldName","_removeInactiveQuoteProcessInputs","handleTransientCache","groupProcessId","searchBarResultsChanged","searchBarItemSelected","searchBarResetClicked","searchBarNilSearchInvoked","handleNonConfigurableProducts","navigateToSelf","activeInputs","processInput","updateSearchFilterData","visiblePanel","isVisible","modalGroup","gs","cleargs","saveCache","_addAggregateDataIfThresholdExceeded","getOrderedSelectedProducts","mdqTemplatesByDimensionType","orderedSelectedProductId","actionIdQueryString","plSelectMore","toggleResetButton","hasSearchFilterValues","lookupObjects","ProductLookup","LESummaryCell","isGroupFieldPage","isSegmentedLinesPage","isStandardLinesPage","pageType","GroupTabs","isQuoteFieldPage","isGroupsPage","segmentedCompName","segmentedTabs","tabHeight","layoutHeight","QuoteTabs","usesClientAmendRenew","existingLines","sf","JSARSettings","JSARServices","JSARLineGenManager","orgPrefix","amendRenewSettings","constructFromJsarSettings","lineGenManager","subIds","renewSubscriptionsToQuote","amendSubscriptionsToQuote","subscriptionLookupObjects","SubscriptionLookup","optionConfiguratorResponse","serverProduct","inheritedConfigurationAttributes","inheritedConfigurationData","OptionConfigurator","psmResponse","qa","reconcileServerQuoteWithUIQuote","topLevelSave","warningCallback","minimizer","getRequiredKeys","nestedConfigurationSave","priorBundledQuantityByLineKey","mapPriorBundledQuantityByLineKey","OptionSaver","productLoadModel","relevantLines","_getLinesRelevantToParentKey","relevantLineKeys","addKeysRelevantTo","ProductLoader","configResponse","ProductRulesInvoker"],"mappings":"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","file":"sb_app_js.js","sourcesContent":["import * as docgen from 'docgen/docgen.routes.js';\nimport * as quotes from 'quotes/quotes.routes.js';\nimport * as assets from 'assets/assets.routes.js';\nimport * as contracts from 'contracts/contracts.routes.js';\nimport * as subscriptions from 'subscriptions/subscriptions.routes.js';\nimport * as products from 'products/products.routes.js';\nimport * as favorites from 'favorites/favorites.routes.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\nimport {Router} from 'common/core/sb-router/Router.js';\n\n// import the \"bootstrap\" modules from all feature folders\n// they are here just so we don't have to explicitly call System.import() on individual modules.\nimport 'common/common.js';\nimport 'quotes/quotes.js';\nimport 'products/products.js';\nimport 'favorites/favorites.js';\nimport 'assets/assets.js';\nimport 'subscriptions/subscriptions.js';\n\nexport class App {\n\tstatic init( pageContainer, dbName, /*Obj*/ settingsObj, urls ) {\n\n\t\tlet r = {};\n\t\tr[docgen.PREFIX] = docgen.ROUTES;\n\t\tr[quotes.PREFIX] = quotes.ROUTES;\n\t\tr[products.PREFIX] = products.ROUTES;\n\t\tr[favorites.PREFIX] = favorites.ROUTES;\n\t\tr[assets.PREFIX] = assets.ROUTES;\n\t\tr[contracts.PREFIX] = contracts.ROUTES;\n\t\tr[subscriptions.PREFIX] = subscriptions.ROUTES;\n\n\t\t// initialize app with all URL routes\n\t\tpageContainer.allRoutes = r;\n\n\t\treturn Promise.all([\n\t\t\tAppContext.init( settingsObj ),\n\t\t\t// Db.adapter.open( dbName || 'sbcpq' ),\n\t\t\tApp._initIntlLocale( urls.intl, settingsObj.locale )\n\t\t]);\n\t}\n\n\t/**\n\t * Load the CLDR data for the user's locale.  We can't pre-load all locales - too many/too much data in memory.\n\t * We need this data for the Intl polyfill as well as other internal needs.\n\t *\n\t * @param url {String} the base url to the cldr data file (staticresource or bower)\n\t * @param locale {String} the user's locale (e.g. en-US)\n\t * @return {Promise} resolves with the json object when loaded\n\t */\n\tstatic _initIntlLocale( url, locale ) {\n\n\t\treturn new Promise( function( res, rej ) {\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\tlet id = null;\n\t\t\tlet getURL = url + '/locale-data/json/' + locale + '.json';\n\t\t\txhr.open( 'GET', getURL );\n\n\t\t\txhr.onerror = function(e) {\n\t\t\t\trej( new Error( 'Cannot get locale data: ' + e ) );\n\t\t\t}\n\n\t\t\txhr.ontimeout = function(e) {\n\t\t\t\trej( new Error( 'Timeout for locale data' ) );\n\t\t\t}\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif( xhr.responseText ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet data = JSON.parse( xhr.responseText );\n\t\t\t\t\t\tI18n.addLocaleData( data );  // save for other components to use, e.g. DatePicker\n\t\t\t\t\t\tif( Intl && Intl.__addLocaleData ) {\n\t\t\t\t\t\t\tIntl.__addLocaleData( JSON.parse( xhr.responseText ) );  // have to parse again as Intl polyfill changes source locale object when added\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres( data );\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\tvar spinner = document.getElementById(\"spinner\");\n\t\t\t\t\t\tvar errorToast = document.getElementById(\"errorToast\");\n\t\t\t\t\t\tvar label = \"There was an error parsing the \" + locale + \" locale. Use a different locale or contact your Salesforce admin.\"\n\t\t\t\t\t\terrorToast.messages = [label];\n\t\t\t\t\t\tspinner.show = false;\n\t\t\t\t\t\trej( new Error( 'Cannot parse locale data' ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar spinner = document.getElementById(\"spinner\");\n\t\t\t\t\tvar errorToast = document.getElementById(\"errorToast\");\n\t\t\t\t\tvar label = \"The \" + locale + \" locale isn't supported. Use a different locale or contact your Salesforce admin.\"\n\t\t\t\t\terrorToast.messages = [label];\n\t\t\t\t\tspinner.show = false;\n\t\t\t\t\trej( new Error( 'Cannot understand locale data: ' + xhr.statusText ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\txhr.send();\n\t\t});\n\t}\n}\n","// THIS FILE IS GENERATED.  DO NOT EDIT!!!!\nexport const LABELS = {\"Apply\":\"Apply\",\"Asset Selection\":\"Asset Selection\",\"Cancel\":\"Cancel\",\"Clear Fields\":\"Clear Fields\",\"Filter\":\"Filter\",\"Select\":\"Select\",\"None\":\"None\",\"searchText\":\"Search {0}\",\"lookupQueryError\":\"Can't perform lookup due to field encryption or a querying error\",\"FieldSetWarning\":\"Create a Field Set with the label of CPQ_Lookup in {0} object setup to determine which fields are displayed in this CPQ list view popup.\",\"numResults\":\"{0} Results\",\"Save\":\"Save\",\"Background color\":\"Background color\",\"Block quote\":\"Block quote\",\"Bold\":\"Bold\",\"Bullet list\":\"Bullet list\",\"Clear formatting\":\"Clear formatting\",\"Decrease indent\":\"Decrease indent\",\"Edit Description\":\"Edit Description\",\"Font family\":\"Font family\",\"Font size\":\"Font size\",\"Header size\":\"Header size\",\"Unsupported HTML tags detected\":\"Unsupported HTML tags detected, saving may cause original formatting to be altered or lost. If you wish to preserve original formatting, cancel out of the Rich-Text Editor.\",\"Increase indent\":\"Increase indent\",\"Insert or edit image\":\"Insert or edit image\",\"Insert or edit link\":\"Insert or edit link\",\"Italic\":\"Italic\",\"Numbered list\":\"Numbered list\",\"Redo\":\"Redo\",\"Strikethrough\":\"Strikethrough\",\"Subscript\":\"Subscript\",\"Superscript\":\"Superscript\",\"Align left\":\"Align left\",\"Center\":\"Center\",\"Align right\":\"Align right\",\"Text color\":\"Text color\",\"Underline\":\"Underline\",\"Undo\":\"Undo\",\"Constrain proportions\":\"Constrain proportions\",\"Dimensions\":\"Dimensions\",\"Insert image\":\"Insert image\",\"Source\":\"Source\",\"Search Products\":\"Search Products\",\"Product Search\":\"Product Search\",\"Select All\":\"Reduce search results to fewer than {0} to enable select all\",\"Popup\":\"Popup\",\"Add Products\":\"Add Products\",\"Delete\":\"Delete\",\"Favorite Lookup\":\"Favorite Lookup\",\"Select & Add More\":\"Select & Add More\",\"Share\":\"Share\",\"Share Favorites\":\"Share Favorites\",\"Attributes\":\"Attributes\",\"Options\":\"Options\",\"showAvailableUpgrades\":\"This feature has products available for upgrade, click the Show Available Upgrades button at the bottom of the feature to select upgrade options.\",\"No visible options in feature\":\"No visible options in feature '{0}'\",\"Features\":\"Features\",\"Add Options\":\"Add Options\",\"Add\":\"Add\",\"Configure Products\":\"Configure Products\",\"Configuration Attribute Error\":\"Please review required configuration attributes\",\"Configuration Error\":\"Some or all options require further configuration. Look for configuration icon next to options that must be configured.\",\"Maximum Quantity Error\":\"Exceeded maximum quantity available. Value has been reduced to {0}\",\"Add to Cart\":\"Add to Cart\",\"Categories\":\"Categories\",\"Description\":\"Description\",\"Go\":\"Go\",\"My Favorites\":\"My Favorites\",\"Price\":\"Price\",\"Product Code\":\"Product Code\",\"Product Name\":\"Product Name\",\"Start Over\":\"Start Over\",\"Alert\":\"Alert\",\"Continue\":\"Continue\",\"Return to Quote\":\"The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it.\",\"Contract Selection\":\"Active Contract Selection\",\"Select Contract\":\"Select Contract\",\"Active Contracts\":\"Active Contracts\",\"Evergreen Contracts\":\"Evergreen Contracts\",\"Skip\":\"Skip\",\"Favorites\":\"Favorites\",\"Guided Selling\":\"Guided Selling\",\"Product Filter\":\"Product Filter\",\"Product Selection\":\"Product Selection\",\"Suggest\":\"Suggest\",\"Available Groups\":\"Available Groups\",\"Clone To Groups\":\"Clone To Group(s)\",\"Select Groups\":\"Select one or more group(s)\",\"Selected Groups\":\"Selected Groups\",\"Custom Segments\":\"Custom Segments\",\"Discount Schedule Editor\":\"Discount Schedule Editor\",\"Update\":\"Update\",\"Add to Favorites\":\"Add to Favorites\",\"Favorite Name\":\"Favorite Name\",\"Choose Price Book\":\"Choose Price Book\",\"Details\":\"Details\",\"Total\":\"Total\",\"Quote Total\":\"Quote Total\",\"Add To Favorite\":\"Add To Favorite\",\"Click to edit description\":\"Click to edit description.\",\"emptyLinesMsg\":\"This group has no line items. Click on Add Products button or drag lines from other groups.\",\"mobileEmptyLinesMsg\":\"This group has no line items. Click on Add Products button to add a product.\",\"Remove From Favorites\":\"Remove From Favorites\",\"Segmented Products\":\"Segmented Products\",\"Standard Products\":\"Standard Products\",\"Subtotal\":\"Subtotal\",\"invalidPricebookEntry\":\"There is not a valid price book entry for this line item.\",\"missingOpportunityLineItem\":\"This product will not sync to the opportunity because a valid pricebook entry does not exist.\",\"pesterPSLAssignment\":\"As of Winter ’21, Salesforce CPQ requires permission set licenses instead of managed package licenses. Contact your Salesforce CPQ admin about upgrading.\",\"Edit Quote\":\"Edit Quote\",\"emptyGroupedQuoteMsg\":\"This quote has no line items. Click on Add Group button to select products.\",\"emptyQuoteMsg\":\"This quote has no line items. Click on Add Products button to select products.\",\"fullScreenMode\":\"Toggle Full Screen Mode\",\"Reset_Column_Widths\":\"Reset Column Widths\",\"Accept Recommendation\":\"Accept Recommendation\",\"Explanation\":\"Explanation\",\"Floor\":\"Floor\",\"Norm\":\"Norm\",\"Pricing Guidance\":\"Pricing Guidance\",\"PricingGuidanceNotAvailable\":\"Can't load pricing guidance for this record. Contact your Salesforce admin.\",\"Target\":\"Target\",\"Back to Quote\":\"Back to Quote\",\"There_are_unsaved_changes_in_one_or_more_of_your_categories\":\"There are unsaved changes in one or more of your categories.  We're just making sure you want to go back to the quote without updating.\",\"Leave_page_without_updating\":\"Leave page without updating?\",\"Consumption Schedule\":\"Consumption Schedule\",\"Never Mind\":\"Never Mind\",\"msg_cannot_delete_group\":\"You cannot delete this Group as it contains Quote Lines being amended.\",\"msg_confirm_group_delete\":\"All lines will also be deleted. Are you sure you want to delete this group?\",\"msg_confirm_remove_favorite\":\"Are you sure you want to remove favorite?\",\"msg_confirm_remove_group_from_favorites\":\"All lines will be removed from favorites. Are you sure you want to remove this group from favorites?\",\"msg_missing_pricebook_id\":\"A PriceBook Id is missing. Please contact your administrator to resolve the issue.\",\"Consumption Schedule Name\":\"Consumption Schedule Name\",\"Items_Sorted_by\":\"{0} Items - Sorted by {1}\",\"Search Consumption Schedule Name\":\"Search Consumption Schedule Name\",\"There are no rates that match your search criteria\":\"There are no rates that match your search criteria\",\"Your_search_term_must_have_2_or_more_characters\":\"Your search term must have 2 or more characters, excluding *, ?, (), or ' '\",\"Subscription Selection\":\"Subscription Selection\",\"Quick Save and Continue\":\"Quick Save and Continue\"};","export const settings = {developerPrefix:'SBQQ',isMultiCurrencyOrg:false,calculateImmediately:false,locale:'en-US',language:'en',defaultCurrency:'USD',currencySymbol:'',currencyDecimalScale:2,fullName:'Admin User',userName:'admin-user@steelbrick.com',userId:'0XXX1',device:'',isOAuth:true,additionalLookupSearchTypes:[],oik:'',maxLookupSearchFields:1,isJSProductRulesEnabled:true,hasQuoteSelectionProductRules:true,isBundleCollapsible:true,isPricingGuidanceEnabled:true,defaultBundleSetting:'Expanded',isColumnResizingEnabled:false,isManualEditsForUBPEnabled:true}","'use strict';\n\nvar logger = require('js-logger').logger.getLogger();\n\n/**\n * Cache manager. Manage caches in a centralized way.\n *\n * This suppose to be a singleton, so get instance of cache manager like:\n * var cacheManager = require('CacheManager').instance;\n *\n * Get your cache by name. If cache not exist, it will create one\n * var cache = cacheManager('myCache');\n *\n * Flush all caches (Only available in nodejs environment)\n * cacheManager.flushCaches();\n */\nfunction CacheManager() {\n\tlogger.trace('Creating new instance of cache manager');\n\tthis._caches = new Map();\n}\n\n/**\n * Get cache by name.\n *\n * If cache not exist with the name yet, it will be created one. Otherwise, existing\n * cache will be returned.\n *\n * Cache will be created as instance of <tt>Map</tt> unless customize cache class provided.\n *\n * @param name cache name\n * @param cacheClass optional, cache class. Must have default constructor\n * @returns {V}\n */\nCacheManager.prototype.getCache = function (name, cacheClass) {\n\tlogger.debug('Getting cache by name:', name);\n\t// In order to prevent cache staleness, we need to detect when we're in a scenario where the cache become stale, i.e.\n\t// detect scenarios in which the cache persist for longer than a single transaction.\n\t//\n\t// The only such scenario is when code is executing in the main server thread on a Heroku Node server. All other\n\t// scenarios are either in in the browser, a child process that expires after a single transaction, or a one-off dyno\n\t// that expires after a single transaction.\n\t//\n\t// To detect whether we're in that scenario, we verify that we're in Node and not the browser by checking whether window\n\t// is defined. Then we check whether the main module that launched the process is server.js, which is the top-level module\n\t// for the main Node process.\n\tlet inMainNodeProcess = typeof window === 'undefined'\n\t\t&& (process && process.mainModule && process.mainModule.filename && process.mainModule.filename.endsWith('server.js'));\n\tif (inMainNodeProcess) {\n\t\t// When we detect that we're in the main process, we always want to instantiate a new cache in order to prevent staleness.\n\t\t// A consequence of this change is that if we attempt to change the JSQC (which is the only thing that can run in\n\t\t// the main process at this time) to use a DAO backed by the CacheManager, we must make sure that the JSQC never\n\t\t// instantiates more than one instance of that DAO during a single transaction, otherwise the cache will be lost\n\t\t// and performance will suffer.\n\t\tlogger.trace('Cache with name ', name, ' requested in main process. Returning new instance.');\n\t\treturn this._createCacheInstance(name, cacheClass);\n\t} else {\n\t\tlet cache = this._caches.get(name);\n\t\tif (!cache) {\n\t\t\tlogger.trace('Cache with name:', name, 'not exist yet.');\n\t\t\tcache = this._createCacheInstance(name, cacheClass);\n\t\t\tthis._caches.set(name, cache);\n\t\t} else {\n\t\t\tlogger.trace('Find cache for name:', name);\n\t\t}\n\t\treturn cache;\n\t}\n};\n\n/**\n * Instantiates a new cache of the specified type, or a map if no type is specified.\n * @param {String} cacheName - The name of the desired cache. Used solely for logging.\n * @param {function} [cacheClass] - An optional constructor for the object to be used as the cache.\n * @returns {*} Either an instance of cacheClass or a Map.\n * @private\n */\nCacheManager.prototype._createCacheInstance = function(cacheName, cacheClass) {\n\tlet cache;\n\tif (cacheClass) {\n\t\tlogger.trace('Cache class defined');\n\t\tif (typeof cacheClass === 'function') {\n\t\t\tlogger.trace('Creating new cache by customized class for name:', cacheName);\n\t\t\tcache = new cacheClass();\n\t\t} else {\n\t\t\tlogger.warn('Cache class defined, but is not a function.', typeof cacheClass);\n\t\t\tthrow new Error('Customize cache class type wrong.');\n\t\t}\n\t} else {\n\t\tlogger.trace('Creating new cache as Map for name:', cacheName);\n\t\tcache = new Map();\n\t}\n\tif (typeof cache !== 'undefined') {\n\t\treturn cache;\n\t} else {\n\t\tlogger.warn('Cache undefined, something wrong.');\n\t\tthrow new Error('Create cache get undefined.');\n\t}\n};\n\n/**\n * Flush caches. This operation only available in nodejs environment, will do nothing\n * in browser.\n * This operation will call clear on all caches to make sure other objects that holding same\n * cache still refer to same cache.\n * Also because cache could hold by other objects, this operation will not remove cache for\n * names\n *\n * @param resetCaches pass <tt>true</tt> if want to reset cache manager. Use with caution, objects\n * that already get cache may still holding old cache.\n */\nCacheManager.prototype.flushCaches = function (resetCaches) {\n\tlogger.debug('Flushing all caches');\n\t// Since cache could be hold outside, we cannot just create new cache map.\n\t// That will leave other objects holding old cache.\n\tthis._caches.forEach(function(value) {\n\t\tif (value && typeof value.clear === 'function') {\n\t\t\tvalue.clear();\n\t\t}\n\t});\n\tif (resetCaches) {\n\t\tlogger.trace('Rest cache');\n\t\tthis._caches.clear();\n\t}\n};\n\n/**\n * We want make sure CacheManager is singleton within whole process.\n * No matter how many times it been imported, where it get imported.\n * So we use Symbol to calculate unique key and use global to hold\n * single instance of CacheManager.\n *\n * We also export this single instance only.\n */\nconst CACHE_MANAGER_KEY = Symbol.for('client.Utils.CacheManager');\n\nconst globalRef = typeof global !== 'undefined' ?\n\tglobal :\n\ttypeof self !== 'undefined' ?\n\t\tself :\n\t\ttypeof window != 'undefined' ?\n\t\t\twindow :\n\t\t\t{};\n\nvar globalSymbols = Object.getOwnPropertySymbols(globalRef);\nvar hasCacheManager = (globalSymbols.indexOf(CACHE_MANAGER_KEY) > -1);\n\nif (!hasCacheManager) {\n\tlet _cacheManager = new CacheManager();\n\tObject.freeze(_cacheManager);\n\tglobalRef[CACHE_MANAGER_KEY] = _cacheManager;\n}\n\nmodule.exports = {cacheManager: globalRef[CACHE_MANAGER_KEY]};\n","/**\n * Created by jfeingold on 5/4/15.\n */\n\nmodule.exports.toApexDate = toApexDate;\nmodule.exports.toApexDateTime = toApexDateTime;\nmodule.exports.toUTCDateString = toUTCDateString;\nmodule.exports.monthsBetween = monthsBetween;\nmodule.exports.monthsBetweenRoundPartialUp = monthsBetweenRoundPartialUp;\nmodule.exports.daysBetween = daysBetween;\nmodule.exports.daysBetweenIgnoringLeapYearDays = daysBetweenIgnoringLeapYearDays;\nmodule.exports.distinguishDateFromDateTime = distinguishDateFromDateTime;\nmodule.exports.addMonths = addMonths;\nmodule.exports.addDays = addDays;\nmodule.exports.numberOfMonthsInFixedMdqDimension = numberOfMonthsInFixedMdqDimension;\nmodule.exports.countDaysInMonth = countDaysInMonth;\nmodule.exports.isEndOfMonth = isEndOfMonth;\nmodule.exports.moveToEndOfMonth = moveToEndOfMonth;\nmodule.exports.containsLeapDay = containsLeapDay;\n\n/**\n * Takes a JS Date object and turns it into a string of the type 'YYYY-MM-DD', which is what Apex is expecting.\n * @param {Date} date The date to be stringified\n * @returns {string}\n */\nfunction toApexDate(/*Date*/ date) {\n\t// Get the ISO formatted date string.\n\t// This will be formatted: YYYY-MM-DDTHH:mm:ss.sssZ\n\tvar dateIso = date.toISOString();\n\n\t// Replace everything after the T with an empty string\n\treturn dateIso.replace(new RegExp('[Tt].*'), \"\");\n}\n\n/**\n * Takes a JS Date object and turns it into a string of the format 'YYYY-MM-DDTHH:mm:ss.sss+0000', which is what Apex\n * expects a date-time to look like\n * @param {Date} dateTime The datetime to be stringified\n * @returns {string}\n */\nfunction toApexDateTime(dateTime) {\n\t// Get the ISO formatted date string.\n\t// This will be formatted YYYY-MM;DDTHH:mm:ss.sssZ\n\tvar dateIso = dateTime.toISOString();\n\n\t// Replace the 'Z' at the end with '+0000'\n\treturn dateIso.slice(0, dateIso.length - 1) + \"+0000\";\n}\n\n/**\n * Takes a JS Date object and turns it into a string based on the locale (but based on UTC Time), used primarily when Dates are converted to Text by formulas.\n * @param {Date} date The date to be stringified\n * @returns {string} formatted date that has been converted to a string\n */\nfunction toUTCDateString(date) {\n\t// Gets the timezone offset so that the date is converted to UTC time\n\tvar timezone = date.getTimezoneOffset();\n\treturn new Date(date.setMinutes(date.getMinutes() + parseInt(timezone))).toLocaleDateString();\n}\n\n/**\n * Tests if the provided string represents a Date, DateTime, or neither\n * @param {String} dateString A string that may or may not represent a date or datetime\n * @returns {String} 'date',' datetime', or 'none', if the string format resembles an Apex Date,DateTime, or neither respectively\n */\nfunction distinguishDateFromDateTime(dateString) {\n\tvar dateRegex = new RegExp('\\\\d{4}-\\\\d{2}-\\\\d{2}');\n\tvar dateTimeRegex = new RegExp('\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}.\\\\d{3}(Z|(\\\\+\\\\d{4}))');\n\tif (dateRegex.test(dateString) && dateString.length == 10) {\n\t\treturn 'date';\n\t} else if (dateTimeRegex.test(dateString) && (dateString.length == 24 || dateString.length == 28)) {\n\t\treturn 'datetime';\n\t}\n\treturn 'none';\n}\n\n/**\n * Returns the difference in months between the two dates, ignoring day. i.e. all days in a given month are\n * equally far from all days in any other given month.\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {number} Positive when startDate is before endDate, 0 if same month, else negative.\n */\nfunction monthsBetween(/*Date*/ startDate, /*Date*/ endDate) {\n\t// If the start date is actually after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate  > endDate) {\n\t\treturn -1 * monthsBetween(endDate, startDate);\n\t}\n\tlet result = 0;\n\t// Add the difference in years * 12\n\tresult += ((endDate.getUTCFullYear() - startDate.getUTCFullYear()) * 12);\n\t// Add the difference in months. Note: If startDate was later in the year than endDate, this value will be\n\t// subtracted.\n\tresult += (endDate.getUTCMonth() - startDate.getUTCMonth());\n\treturn result;\n}\n\n/**\n * Returns the number of months between two dates, with partial months being rounded up.\n * E.g. 2016-09-15, 2017-09-20 => 13\n * but  2016-09-15, 2017-09-10 => 12\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {number}\n */\nfunction monthsBetweenRoundPartialUp(startDate, endDate) {\n\t// If the start date is actually after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate > endDate) {\n\t\treturn -1 * monthsBetweenRoundPartialUp(endDate, startDate);\n\t}\n\t// Get the number of calendar months between the two dates\n\tlet result = monthsBetween(startDate, endDate);\n\t// Create new reference so startDate is preserved\n\tlet date = new Date(startDate.getTime());\n\t// Add that many months to the start date\n\taddMonths(date, result);\n\t// If the adjusted start date is before the end date, then it means that there's a partial month left over that needs\n\t// to be rounded up.\n\tif (date < endDate) {\n\t\tresult += 1;\n\t}\n\treturn result;\n}\n\n/**\n * Returns the number of days between two dates.\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {Integer} Positive when startDate is before endDate, else negative\n */\nfunction daysBetween(startDate, endDate) {\n\t// If the start date is after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate > endDate) {\n\t\treturn -1 * daysBetween(endDate, startDate);\n\t}\n\t// Get the difference in Unix time\n\tconst msDiff = endDate.getTime() - startDate.getTime();\n\tconst dayInUnix = 86400000;\n\t// return the difference divided by the number of ms in a day.\n\treturn Math.round(msDiff / dayInUnix);\n}\n\n/**\n * Adds the specified number of months to a Date. Handles the situation where May 31 + 1 month = June 30 NOT July 1.\n * @param {Date} startDate\n * @param {Integer} numMonths\n * @returns {Date} Date after months have been added\n */\nfunction addMonths(startDate, numMonths) {\n\tconst currentMonth = startDate.getUTCMonth();\n\tstartDate.setUTCMonth(startDate.getUTCMonth() + numMonths);\n\tlet trueMonth = currentMonth + numMonths;\n\t// Handles situation where currentMonth is Jan ( index = 0 ) and need to go back one month to Dec\n\t// Dec is index 11, not -1, so we add 12 to get the correct index in this case\n\ttrueMonth = trueMonth < 0 ? trueMonth + 12 : trueMonth;\n\t// Check if we've overflowed into the next month. If so, set date to the last day of the previous month.\n\tif (startDate.getUTCMonth() !== (trueMonth % 12)) {\n\t\tstartDate.setUTCDate(0);\n\t}\n\treturn startDate;\n}\n\nfunction addDays(/*Date*/ startDate, /*number*/ numDays) {\n\tstartDate.setUTCDate(startDate.getUTCDate() + numDays);\n\treturn startDate;\n}\n\n/**\n * Returns the number of days between two dates minus the extra days added from leap years\n * @param startDate\n * @param endDate\n * @returns {Integer} Positive when startDate is before endDate, else negative\n */\nfunction daysBetweenIgnoringLeapYearDays(/* Date */ startDate, /* Date */ endDate) {\n\tconst numLeapDays = getNumberOfLeapDays(startDate, endDate);\n\treturn daysBetween(startDate, endDate) - numLeapDays;\n}\n\n/**\n * calculate the number of leap days between two dates\n */\nfunction getNumberOfLeapDays(/* Date */ startDate, /* Date */ endDate) {\n\tlet numLeapDays = 0;\n\tconst startYear = startDate.getUTCFullYear();\n\tconst endYear = endDate.getUTCFullYear();\n\tfor (let i = startYear; i <= endYear; i++) {\n\t\tif (!isLeapYear(i)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst leapDay = new Date(i, 1, 29);\n\t\tif (startDate < leapDay && endDate > leapDay) {\n\t\t\tnumLeapDays++;\n\t\t}\n\t}\n\n\treturn numLeapDays;\n}\n\n/**\n * determine if there is a leap day between two dates\n */\nfunction containsLeapDay(/* Date */ startDate, /* Date */ endDate) {\n\treturn getNumberOfLeapDays(startDate, endDate) > 0;\n}\n\n/**\n * Evaluates whether or not the given date falls within a leap year using the three following Gregorian calendar rules\n * @param {Integer} year\n * @returns {Boolean}\n */\nfunction isLeapYear(year) {\n\treturn (year % 100 === 0) ? (year % 400 === 0) : (year % 4 === 0);\n}\n\n/**\n * When given a string that corresponds to a fixed-length MDQ dimension type, returns the number of months in a term of that type.\n * For invalid or variable-length dimension types, returns null.\n * @param {String} dimType - An MDQ dimension type. e.g. 'Year', 'Month', 'Quarter'.\n * @returns {number|null}\n */\nfunction numberOfMonthsInFixedMdqDimension(dimType) {\n\t// If the dimension type provided was null, return null because there's just nothing else we could do that would\n\t// be useful.\n\tif (!dimType) {\n\t\treturn null;\n\t}\n\t// Otherwise, we just need a relatively simple mapping of dimension type to number.\n\tswitch (dimType.toLowerCase()) {\n\t\tcase 'year':\n\t\t\treturn 12;\n\t\tcase 'quarter':\n\t\t\treturn 3;\n\t\tcase 'month':\n\t\t\treturn 1;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n/**\n * When given a 0-indexed month and a four-digit year, returns the number of days in that month.\n * @param {number} month - An integer between 0 and 11, because months are 0-indexed in JS.\n * @param {number} year - The year to use for purposes of leap year determination.\n * @returns {number}\n */\nfunction countDaysInMonth(month, year) {\n\treturn new Date(year, month + 1, 0).getDate();\n}\n\n/**\n * When given a Date object, returns true if that Date is the last day of its month.\n * @param {Date} date\n * @returns {boolean}\n */\nfunction isEndOfMonth(date) {\n\tconst day = date.getUTCDate();\n\tconst month = date.getUTCMonth();\n\tconst year = date.getUTCFullYear();\n\n\treturn day === countDaysInMonth(month, year);\n}\n\n/**\n * When given a date object, it moves the date to the end of the month\n * @param date\n * @return {*}\n */\nfunction moveToEndOfMonth(date) {\n\tconst month = date.getUTCMonth();\n\tconst year = date.getUTCFullYear();\n\n\tdate.setUTCDate(countDaysInMonth(month, year));\n\treturn date;\n}","/**\n * Created by jfeingold on 6/6/17.\n *\n * Extension of Map, used to map IDs to values. This is important because SFDC SObject IDs can be either 15 or 18 characters\n * long, so we want to make sure that they're always cached as 15-character strings.\n */\n\n'use strict';\n\nclass IdToValueCache {\n\tconstructor(...args) {\n\t\tthis._innerMap = new Map(args);\n\t}\n\n\t/**\n\t * Returns a boolean indicating whether the map contains the 15-character truncation of this ID.\n\t * @param {String} key - A 15- or 18-character SObject ID\n\t * @returns {boolean}\n\t */\n\thas(key) {\n\t\treturn this._innerMap.has(key != null ? key.slice(0, 15) : key);\n\t}\n\n\t/**\n\t * Returns the value mapped to the 15-character truncation of the provided SObject ID.\n\t * @param {String} key - A 15- or 18-character SObject ID\n\t * @returns {*}\n\t */\n\tget(key) {\n\t\treturn this._innerMap.get(key != null ? key.slice(0, 15) : key);\n\t}\n\n\t/**\n\t * Maps the provided value to the 15-character truncation of the provided SObject ID.\n\t * @param {String} key - A 15- or 18-character SObject ID\n\t * @param {*} val - Any value to be mapped.\n\t */\n\tset(key, val) {\n\t\treturn this._innerMap.set(key != null ? key.slice(0, 15) : key, val);\n\t}\n\n\tforEach(callback) {\n\t\treturn this._innerMap.forEach(callback);\n\t}\n\n\t/**\n\t * A simple wrapper around the inner map's .entries() method.\n\t * @returns {Iterator.<*>}\n\t */\n\tentries() {\n\t\treturn this._innerMap.entries();\n\t}\n\n\t/**\n\t * A simple wrapper around the inner map's .values() method.\n\t * @returns {Iterator.<V>}\n\t */\n\tvalues() {\n\t\treturn this._innerMap.values();\n\t}\n\n\t/**\n\t * A simple wrapper around the inner map's .clear() method.\n\t */\n\tclear() {\n\t\treturn this._innerMap.clear();\n\t}\n\n\t/**\n\t * Deletes the 15-character truncation of the provided SObject ID from the inner map.\n\t * @param {String} key - A 15- or 18-character SObject ID.\n\t * @returns {boolean}\n\t */\n\tdelete(key) {\n\t\treturn this._innerMap.delete(key != null ? key.slice(0, 15) : key);\n\t}\n\n\t/**\n\t * A wrapper around the inner map's .keys() method.\n\t * @returns {Iterator.<K>}\n\t */\n\tkeys() {\n\t\treturn this._innerMap.keys();\n\t}\n\n\t/**\n\t * A wrapper around the inner map's .size property.\n\t * @returns {number}\n\t */\n\tget size() {\n\t\treturn this._innerMap.size;\n\t}\n\n\t/**\n\t * Defines an iterator that delegates to the inner map, allowing the use of for-of loops.\n\t * @returns {Iterator.<*>}\n\t */\n\t[Symbol.iterator]() {\n\t\treturn this._innerMap.entries();\n\t}\n}\n\nmodule.exports = IdToValueCache;","'use strict';\n\nconst liberate = Function.prototype.bind.bind(Function.prototype.call),\n\treduce   = liberate(Array.prototype.reduce);\n\n// Computes the multiplier necessary to make x >= 1,\n// effectively eliminating miscalculations caused by\n// finite precision.\n\nfunction multiplier(x) {\n\tx = x == null ? 0 : x;\n\tconst converted = x.toFixed && x < 1e-6 ? x.toFixed(15).replace(/(\\..*?)(0+)$/, \"$1\") : x.toString()\n\tconst parts     = converted.split('.');\n\n\tif (parts.length < 2) {\n\t\treturn 1;\n\t}\n\n\treturn Math.pow(10, parts[1].length);\n}\n\n// Given a variable number of arguments, returns the maximum\n// multiplier that must be used to normalize an operation involving\n// all of them.\n\nfunction correctionFactor() {\n\treturn reduce(arguments, function (prev, next) {\n\t\tnext = multiplier(next);\n\n\t\treturn prev > next ? prev : next;\n\t}, -Infinity);\n}\n\n// Returns the \"corrected\" integer value of a\n// floating point multiplication operation\n\nfunction correctedValue(val, corrFactor) {\n\treturn (val * corrFactor).toFixed(0) - 0;\n}\n\n// If an array is passed as the first argument to the\n// mathematical operation functions, reduce the array\n// using the passed in mathematical function\n\nfunction reduceArray(arr, func) {\n\treturn arr.reduce(function (previousValue, currentValue, index, array) {\n\t\treturn func(previousValue, currentValue);\n\t});\n}\n\n// Math Operations -- Only supports math operations for two inputs\nconst MathOperations = {\n\tadd: function () {\n\t\tif (Array.isArray(arguments[0])) {\n\t\t\treturn reduceArray(arguments[0], MathOperations.add);\n\t\t}\n\n\t\tconst corrFactor = correctionFactor.apply(null, arguments);\n\n\t\tfunction cback(accum, curr, currI, O) {\n\t\t\treturn accum + correctedValue(curr, corrFactor);\n\t\t}\n\n\t\treturn reduce(arguments, cback, 0) / corrFactor;\n\t},\n\n\tsub: function () {\n\t\tif (Array.isArray(arguments[0])) {\n\t\t\treturn reduceArray(arguments[0], MathOperations.sub);\n\t\t}\n\n\t\tconst corrFactor = correctionFactor.apply(null, arguments),\n\t\t\tfirst      = arguments[0];\n\n\t\tfunction cback(accum, curr, currI, O) {\n\t\t\treturn accum - correctedValue(curr, corrFactor);\n\t\t}\n\n\t\tdelete arguments[0];\n\n\t\treturn reduce(arguments, cback, correctedValue(first, corrFactor)) / corrFactor;\n\t},\n\n\tmul: function () {\n\t\tif (Array.isArray(arguments[0])) {\n\t\t\treturn reduceArray(arguments[0], MathOperations.mul);\n\t\t}\n\n\t\tfunction cback(accum, curr, currI, O) {\n\t\t\tconst corrFactor = correctionFactor(accum, curr);\n\n\t\t\treturn correctedValue(accum, corrFactor) * correctedValue(curr, corrFactor) / (corrFactor * corrFactor);\n\t\t}\n\n\t\treturn reduce(arguments, cback, 1);\n\t},\n\n\tdiv: function () {\n\t\tif (Array.isArray(arguments[0])) {\n\t\t\treturn reduceArray(arguments[0], MathOperations.div);\n\t\t}\n\n\t\tfunction cback(accum, curr, currI, O) {\n\t\t\tconst corrFactor = correctionFactor(accum, curr);\n\n\t\t\treturn correctedValue(accum, corrFactor) / correctedValue(curr, corrFactor);\n\t\t}\n\n\t\treturn reduce(arguments, cback);\n\t}\n};\n\nMathOperations['subtract'] = MathOperations['sub'];\nMathOperations['multiply'] = MathOperations['mul'];\nMathOperations['divide']   = MathOperations['div'];\n\nmodule.exports = MathOperations;","/**\n * Created by Josh Feingold on 5/12/15.\n */\nconst MathOperations = require('./MathOperations.js');\n\nmodule.exports.setScale = setScale;\nmodule.exports.add = MathOperations.add;\nmodule.exports.subtract = MathOperations.subtract;\nmodule.exports.multiply = MathOperations.multiply;\nmodule.exports.divide = MathOperations.divide;\n\n/**\n * Rounds a number to the given scale, rounding up at 5.\n * i.e. setScale(55.55, 1) = 55.6\n * @param {number} num The number to be rounded\n * @param {number} scale The number of digits that should be kept after the decimal point\n * @returns {number} Num, rounded to 'scale'-many decimals.\n */\nfunction setScale(num, scale) {\n\tconst exp = Math.pow(10, scale);\n\tnum = MathOperations.multiply(num, exp);\t\n\tlet res = Math.round(+(num).toFixed(scale));\t\n\tres /= exp;\t\n\treturn res;\n}","/**\n * Created by jfeingold on 7/25/17.\n *\n * A manager class for interfacing the the RecordJob__c system in Apex.\n */\n\nlet logger = require('js-logger').logger.getLogger();\n\nfunction RecordJobManager(conn, prefix) {\n\tthis._conn = conn;\n\tlet serviceRouterPrefix = (prefix && (prefix.indexOf('_') > 0)) ? '/' + prefix.slice(0, prefix.indexOf('_')) : '';\n\tthis._serviceRouterUrl = serviceRouterPrefix + '/ServiceRouter';\n\tif(conn.oik) // add the internal token to the URL if provided in the connection\n\t\tthis._serviceRouterUrl += '?oik=' + conn.oik;\n\tthis._setJobStatusProvider = 'JobCheckerServiceProvider.SetJobStatus';\n\tthis._setJobsStatusProvider = 'JobCheckerServiceProvider.SetJobsStatus';\n}\n\n/**\n * Uses the Apex REST ServiceRouter system to update the status of the RecordJob__c identified by the Record ID and Job Type.\n * @param {String} recordId - The ID of an SObject associated with a RecordJob__c. NOTE: This is NOT the ID of a RecordJob__c record.\n * @param {String} jobType - The type of the Job in question.\n * @param {String} jobStatus - The status of the job in question.\n * @param {String} jobDetails - Extra details about the job status.\n * @param {*} attachmentDetails - An attachment for the record job.\n * @returns {Promise.<String>}\n */\nRecordJobManager.prototype.updateJobStatus = function(recordId, jobType, jobStatus, jobDetails, targetId) {\n\tlet context = {\n\t\tsaver: this._setJobStatusProvider,\n\t\tmodel: JSON.stringify({\n\t\t\trecordId: recordId,\n\t\t\tjobType: jobType,\n\t\t\tjobStatus: jobStatus,\n\t\t\tjobDetails: jobDetails || '',\n\t\t\ttargetId: targetId || null\n\t\t})\n\t};\n\n\tlet apexRestCallStartTime = Date.now();\n\tlogger.info(jobType + ' RecordJobManager.js: Start apex rest call to update job status.');\n\treturn this._conn.apex.post(this._serviceRouterUrl, context)\n\t\t.then(function() {\n\t\t\tlet apexRestCallEndTime = Date.now();\n\t\t\tlogger.info(jobType + ' RecordJobManager.js: Apex rest call to update job status took ' + (apexRestCallEndTime - apexRestCallStartTime) + ' ms.');\n\t\t\treturn;\n\t\t})\n\t\t.catch(function(err) {\n\t\t\treturn Promise.reject('Error occurred while updating RecordJob__c Status: ' + (err.message || err));\n\t\t});\n};\n\n/**\n * Uses the Apex REST ServiceRouter system to update the statuses of all RecordJob__c records identified by the\n * Record IDs and Job Type.\n * @param {Array.<String>} recordIds - An array of SObject IDs associated with RecordJob__c instances. NOTE: These are\n * NOT the IDs of RecordJob__c instances themselves.\n * @param {String} jobType - The type of the Jobs in question.\n * @param {String} jobStatus - The status to which the jobs should be updated.\n * @param {String} jobDetails - Any further details about the jobs in question.\n * @returns {Promise.<String>}\n */\nRecordJobManager.prototype.updateJobsStatus = function(recordIds, jobType, jobStatus, jobDetails) {\n\tlet context = {\n\t\tsaver: this._setJobsStatusProvider,\n\t\tmodel: JSON.stringify({\n\t\t\trecordIds: recordIds,\n\t\t\tjobType: jobType,\n\t\t\tjobStatus: jobStatus,\n\t\t\tjobDetails: jobDetails\n\t\t})\n\t};\n\treturn this._conn.apex.post(this._serviceRouterUrl, context)\n\t\t.catch(function(err) {\n\t\t\treturn Promise.reject('Error occurred while updating RecordJob__c Status: ' + (err.message || err));\n\t\t});\n};\n\nmodule.exports = RecordJobManager;","if (typeof window !== 'undefined' && window) {\n\twindow.SB = window.SB || {};\n\twindow.SB.ajax = require(\"./../calc/Utils/ApexUtils.js\");\n}","\"use strict\";\n\nSystem.register(\"assets/assets.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhc3NldHMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/asset';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-asset-lookup', mod: 'assets/selection/routes/sb-asset-lookup/AssetLookup.js'},\n\t'/upgrade': {comp: 'sb-asset-upgrade', mod: 'assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js'}\n};\n","/**\n * Converts a value to a string that can be used as a field name.\n * @param {*} value - The value to convert to field name.\n * @returns {String} - the resultant field name.\n */\nexport function toFieldName(value) {\n\tconst strVal = !/^[0-9]/.test(value) ? value : ('_' + value);\n\treturn strVal.replace(/\\W/g, '');\n}\n\n/**\n * Performs immutable array pushes.\n * @param {Array} arr - The array to perform the push on.\n * @param {*} item - The item to push onto the array\n * @returns {Array} - The resultant array.\n */\nexport function immutablePush(arr, item) {\n\treturn [ ...arr, item ];\n}\n\n/**\n * Performs immutable array splices.\n * @param {Array} arr - The array to perform the splice on.\n * @param {number} start - The index to perform the splice on.\n * @param {number} deleteCount - The amount of entries to be deleted\n * @param {...*} items - The items to insert into the array\n * @returns {Array} - The resultant array.\n */\nexport function immutableSplice(arr, start, deleteCount, ...items) {\n\treturn [ ...arr.slice(0, start), ...items, ...arr.slice(start + deleteCount) ];\n}\n\n/**\n * Immutably sets a value to an index in an array.\n * @param {Array} arr - The array to place the value.\n * @param {number} index - The index to place the value.\n * @param {*} value - The value to place in the array.\n * @returns {Array} - The resultant array.\n */\nexport function immutableSet(arr, index, value) {\n\tconst response = arr === undefined ? [] : [ ...arr ];\n\tresponse[index] = value;\n\treturn response;\n}\n\n/**\n * Immutably sets a value to a record field.\n * @param {object} record - The record to place the value.\n * @param {string} field - The field to set to the value.\n * @param {*} value - The value to place in the record.\n * @returns {object} - The resultant record.\n */\nexport function recordSet(record, key, value) {\n\tconst response = { ...record };\n\tresponse[key] = value;\n\treturn response;\n}\n\n/**\n * Immutably sets a value to a record field.\n * @param {object} record - The record to place the value.\n * @param {string} field - The field to set to the value.\n * @param {*} value - The value to place in the record.\n * @returns {object} - The resultant record.\n */\nexport function recordDelete(record, key) {\n\tconst response = { ...record };\n\tdelete response[key];\n\treturn response;\n}\n\n/**\n * Gets a value from a path in the data structure.  Eg: foo[bar].baz[0]\n * @param {*} data - The data structure to get the value from.\n * @param {string[]} path - The path to the required data.\n * @returns {*} - The requested data.\n */\nexport function pathGet(data, path) {\n\tfor (let i = 0; i < path.length && data; i ++) {\n\t\tdata = data[path[i]];\n\t}\n\treturn data;\n}\n\n/**\n * Immutably sets a value to a path in the data structure.\n * @param {*} data - The data structure to set the value to.\n * @param {string[]} path - The path to set the value to.\n * @param {*} value - The value to place in the data.\n * @returns {*} - The resultant data.\n */\nexport function pathSet(data, path, value) {\n\tconst pathRec = (data, path, value, depth) => {\n\t\tif (depth >= path.length) {\n\t\t\treturn value;\n\t\t}\n\t\tconst oldSub = data ? data[path[depth]] : undefined;\n\t\tlet newSub = pathRec(oldSub, path, value, depth + 1);\n\t\treturn oldSub === newSub ? data\n\t\t\t: isNaN(path[depth]) ? recordSet(data, path[depth], newSub)\n\t\t\t: immutableSet(data, path[depth], newSub);\n\t}\n\treturn pathRec(data, path, value, 0);\n}\n\n/**\n * Mutably sets a value to a path in the data structure.\n * @param {*} data - The data structure to set the value to.\n * @param {string[]} path - The path to set the value to.\n * @param {*} value - The value to place in the data.\n */\nexport function pathMutate(data, path, value) {\n\tfor (let i = 0; i < path.length - 1; i ++) {\n\t\tif (!data[path[i]]) {\n\t\t\tdata[path[i]] = isNaN(path[i]) ? { } : [ ];\n\t\t}\n\t\tdata = data[path[i]];\n\t}\n\tdata[path[path.length - 1]] = value;\n}\n\n/**\n * Merge record with existing record in cache.\n * @param {Object} oldVal - Existing record in cache\n * @param {Object} newVal - Record that needs to merge into existing record in cache\n * @returns {Object} Record after merge.\n */\nexport function mergeRec(oldVal, newVal) {\n\tif (oldVal) {\n\t\tif (Array.isArray(newVal)) {\n\t\t\treturn newVal.map((nv, ind) => mergeRec(oldVal[ind], nv));\n\t\t} else if (newVal && typeof newVal === 'object') {\n\t\t\tconst response = {...oldVal};\n\t\t\tfor (let field in newVal) {\n\t\t\t\tresponse[field] = mergeRec(oldVal[field], newVal[field]);\n\t\t\t}\n\t\t\treturn response;\n\t\t}\n\t}\n\treturn newVal === undefined ? oldVal : newVal;\n}\n\n/**\n * Takes a value that can have many different forms and returns a date.\n * @param {*} value - Some representation of a date.\n * @returns {*} - The resultant date.\n */\nexport function rationalizeDate(value) {\n\tlet dateObj = value ? new Date(value) : new Date();\n\t// Safari is very picky about it's formats\n\tif (isNaN(dateObj) && typeof value === 'string') {\n\t\tdateObj = new Date(value.substring(0, value.length - 2) + ':00');\n\t}\n\treturn dateObj;\n}\n\n/**\n * Creates a record with minimal size by only only adding fields that are in both the record and the fields.\n * @param {object} record - The record containing fields that the response can have.\n * @param {Array} fields - The list of fields that the response can have.\n * @returns {object} - The pruned record.\n */\nexport function getPrunedRecord(record, fields) {\n\tconst response = { attributes: record.attributes };\n\tfor (let field of fields) {\n\t\tif (record[field] !== undefined) {\n\t\t\tresponse[field] = record[field];\n\t\t}\n\t}\n\treturn response;\n}\n\n/**\n * Handles the common case of managing references to deleted records by clearing out the reference field\n * @param {string[]} ids - The ids of the deleted record\n * @param {string} field - the name of the reference field\n * @param {object[]} models - The model objects that contains the records with the reference\n */\nexport function clearReferencesToIds(ids, field, models) {\n\tconst idSet = new Set(ids);\n\tfor (let model of models) {\n\t\tif (idSet.has(model.record[field]))\n\t\t\tmodel.record[field] = null;\n\t}\n}\n\n/**\n * A collection of javascript utility functions\n */\nexport class Util {\n\t\n\t/**\n\t * Compare two given values and return true when they strictly equal each other\n\t * for objects, compare the JSON stringified value\n\t * @param val1\n\t * @param val2\n\t */\n\tstatic deepEquals(val1, val2) {\n\t\tif (typeof val1 === 'object' && typeof val2 === 'object') {\n\t\t\treturn JSON.stringify(val1) === JSON.stringify(val2);\n\t\t} else {\n\t\t\treturn val1 === val2;\n\t\t}\n\t}\n\n\t/**\n\t * Use JSON APIs to deep clone a given object\n\t * @param obj\n\t * @returns {*}\n\t */\n\tstatic deepClone(obj) {\n\t\tif (obj === undefined || obj === null) {\n\t\t\treturn obj;\n\t\t}\n\t\treturn JSON.parse(JSON.stringify(obj));\n\t}\n\t\n\t/**\n\t * Pad a number with left zeros\n\t * @param  {Integer} n     the numeric value\n\t * @param  {Integer} width the number of zeros to pad\n\t * @param  {String} z     the pad character, defaults to '0'\n\t * @return {String}       the padded number\n\t */\n\tstatic pad( n, width, z ) {\n\t\tz = z || '0';\n\t\tn = n + '';\n\t\treturn n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n\t}\n\n\t/**\n\t * Returns an \"ISO date string\" in RFC 3339 format\n\t * @param  {Number|Date} d the number of milliseconds from epoch or Date object\n\t * @return {String}   the RFC 3339 date string\n\t */\n\tstatic toIsoDate(d) {\n\t\td = typeof d === 'number' ? new Date(d) : d;\n\t\treturn d.getUTCFullYear() + '-'\n\t\t\t\t+ Util.pad( d.getUTCMonth()+1, 2 ) + '-'\n\t\t\t\t+ Util.pad( d.getUTCDate(), 2 ) + 'T'\n\t\t\t\t+ Util.pad( d.getUTCHours(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCMinutes(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCSeconds(), 2 ) + 'Z'\n\t}\n\n\tstatic notifyTopObjects(ctxComponent, object, strProp) {\n\t\tfor (let prop of Object.keys(object)) {\n\t\t\tctxComponent.notifyPath(strProp + '.' + prop, object[prop]);\n\t\t}\n\t}\n\n\tstatic arithmeticOperatorConversion(fieldValue, filterValue, operator) {\n\t\t// Get unexpected behavior when fieldValue vs. filterValue is null and the other is undefined.\n\t\t// Treat them as interchangeable.\n\t\tif ((fieldValue === null && filterValue === undefined) ||\n\t\t\t(fieldValue === undefined && filterValue === null)) {\n\t\t\tfilterValue = fieldValue;\n\t\t}\n\t\tif(typeof fieldValue === 'boolean') {\n\t\t\tif (filterValue.toLowerCase() === 'true') {\n\t\t\t\tfilterValue = true;\n\t\t\t} else if (filterValue.toLowerCase() === 'false') {\n\t\t\t\tfilterValue = false;\n\t\t\t}\n\t\t}\n\n\t\tswitch (operator) {\n\t\t\tcase 'equals':\n\t\t\t\tlet val = (fieldValue === filterValue);\n\t\t\t\treturn val;\n\t\t\tcase 'not equals':\n\t\t\t\treturn fieldValue != filterValue;\n\t\t\tcase 'less than':\n\t\t\t\treturn fieldValue < filterValue;\n\t\t\tcase 'less or equals':\n\t\t\t\treturn fieldValue <= filterValue;\n\t\t\tcase 'greater than':\n\t\t\t\treturn fieldValue > filterValue;\n\t\t\tcase 'greater or equals':\n\t\t\t\treturn fieldValue >= filterValue;\n\t\t\tcase 'starts with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().startsWith(filterValue.toLowerCase());\n\t\t\tcase 'ends with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().endsWith(filterValue.toLowerCase());\n\t\t\tcase 'contains':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().includes(filterValue.toLowerCase());\n\t\t}\n\t}\n\n\t/**\n\t * Modify text to convert newline/carriage return to line breaks in HTML\n\t * @param  {String}       text Ex: product description or twin fields of data type text area\n\t * @return {String}       text with line breaks\n\t * Linux uses \\n for a new-line, Windows \\r\\n and old Macs \\r.\n\t */\n\tstatic toHTML(text) {\n\t\tif (text != null) {\n\t\t\ttext = text.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n\t\t}\n\t\treturn text;\n\t}\n\n\t/**\n\t * Move an element to the left so that it doesn't extend beyond the viewport (W-6995030)\n\t * @param elem The element to be moved, it needs to be placed on the DOM before this can be invoked\n\t * @param additionalOffset Extra offset if necessary\n\t */\n\tstatic horizontalBound(elem, additionalOffset = 0) {\n\t\tsetTimeout(() => {\n\t\t\tconst rightBound = elem.getBoundingClientRect().left + elem.getBoundingClientRect().width;\n\t\t\tif (rightBound > window.innerWidth) {\n\t\t\t\telem.style.left = (elem.offsetLeft - (rightBound - window.innerWidth) - additionalOffset) + 'px';\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * SF Aloha UI creates its own Map object in the global namespace and it is anywhere near standards compliant\n * This is a stupid hack that checks for their dumb implemenation and gets the real Map class if needed.\n */\nUtil.Map = Map;\nif( !Map || !Map.prototype.get || !Map.prototype.set ) {\n\tlet frame = document.createElement( 'iframe' );\n\tdocument.body.appendChild( frame );\n\tUtil.Map = frame.contentWindow.Map;\n\tframe.parentNode.removeChild( frame );\n}","// import common behaviors first\nimport 'common/behaviors/DeviceBehavior.js';\nimport 'common/behaviors/EventBehavior.js';\nimport 'common/behaviors/LookupBehavior.js';\n\n// these imports are rather dumb.  they are here just so we don't have to explicitly call System.import() on them.\nimport 'common/core/sb-i18n/I18n.js';\nimport 'common/core/sb-loading-spinner/LoadingSpinner.js'\nimport 'common/core/sf-loading-spinner/LoadingSpinner.js'\nimport 'common/core/sb-page-container/PageContainer.js';\nimport 'common/core/sb-toast/Toast.js';\nimport 'common/core/sb-page-header/PageHeader.js';\nimport 'common/data/sb-service/Service.js';\nimport 'common/data/sb-async-service/AsyncService.js';\nimport 'common/filter/searcher/Searcher.js';\nimport 'common/forms/sb-field/Field.js';\nimport 'common/forms/sb-typeahead/Typeahead.js';\nimport 'common/forms/sb-lookup/Lookup.js';\nimport 'common/forms/sb-lookup-dialog/LookupDialog.js';\nimport 'common/forms/sb-datepicker/Datepicker.js';\nimport 'common/forms/sb-date-range/DateRange.js';\nimport 'common/forms/sb-discount/Discount.js';\nimport 'common/forms/sb-pagination/Pagination.js';\nimport 'common/forms/sb-rte/dialog/RichTextEditorDialog.js';\nimport 'common/forms/sb-rte/imageDialog/RTEImageDialog.js';\nimport 'common/forms/sb-rte/RichTextEditor.js';\nimport 'common/forms/sb-search-bar/SearchBar.js';\nimport 'common/forms/sb-search-bar-dialog/SearchBarDialog.js';\nimport 'common/layout/sb-actions/Actions.js';\nimport 'common/forms/sb-input/Input.js';\nimport 'common/forms/sb-select/Select.js';\nimport 'common/forms/sb-textarea/Textarea.js';\nimport 'common/forms/sb-checkbox/Checkbox.js';\nimport 'common/forms/sb-multi-lookup/MultiLookup.js';\nimport 'common/forms/sb-dual-list-box/DualListBox.js';\nimport 'common/layout/sb-div/Div.js';\nimport 'common/layout/sb-field-item/FieldItem.js';\nimport 'common/layout/sb-field-table/FieldTable.js';\nimport 'common/layout/sb-group/Group.js';\nimport 'common/layout/sb-side-panel/SidePanel.js';\nimport 'common/layout/sb-swipe-container/SwipeContainer.js';\nimport 'common/layout/sb-table-cell/TableCell.js';\nimport 'common/layout/sb-table-cell-select/TableCellSelect.js';\nimport 'common/layout/sb-table-header/TableHeader.js';\nimport 'common/layout/sb-table-row/TableRow.js';\nimport 'common/layout/sb-tabs/Tabs.js';\nimport 'common/layout/sb-badge/Badge.js';\nimport 'common/layout/sb-dialog/Dialog.js';\nimport 'common/layout/sb-popup/Popup.js';\nimport 'common/layout/sb-lookup-layout/LookupLayout.js';\nimport 'common/layout/sb-filter-layout/FilterLayout.js';\nimport 'common/layout/sb-filter-item/FilterItem.js';\nimport 'common/layout/sb-row-drawer/RowDrawer.js';\nimport 'common/services/sb-line-editor-read/LineEditorReader.js';\nimport 'common/services/sb-job-checker/JobChecker.js';\nimport 'common/services/sb-field-md/FieldMetadata.js'\nimport 'common/services/sb-search-model-load/SearchModelLoader.js'\nimport 'common/services/sb-search-model-select/SearchModelSelector.js'\nimport 'common/data/sb-describe/Describe.js';\nimport 'common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js'\n\n// amount of time needed to trigger a \"on-hold\" event\nlet HOLD_THRESHOLD = 1000;\n\n// Register a custom \"hold\" event.  Polymer doesn't natively support this.\nif( Polymer ) {\n\tlet holdTimer = null;\n\n\tPolymer.Gestures.register({\n\t\tname: 'hold',\n\t\tdeps: ['mousedown', 'mouseup', 'touchstart', 'touchend'],\n\t\tflow: {\n\t\t\tstart: ['mousedown', 'touchstart'],\n\t\t\tend: ['mouseup', 'touchend']\n\t\t},\n\t\temits: ['hold'],\n\t\tmouseup: function(e) {\n\t\t\treturn this.up(e);\n\t\t},\n\t\ttouchend: function(e) {\n\t\t\treturn this.up(e.changedTouches[0], e);\n\t\t},\n\t\tup: function(e) {\n\t\t\tclearTimeout( holdTimer );\n\t\t\treturn false;\n\t\t},\n\t\tmousedown: function(e) {\n\t\t\treturn this.down(e);\n\t\t},\n\t\ttouchstart: function(e) {\n\t\t\treturn this.down(e.changedTouches[0], e);\n\t\t},\n\t\tdown: function(e, preventer) {\n\t\t\tholdTimer = setTimeout( function() {\n\t\t\t\tPolymer.Gestures.fire( Polymer.Gestures.findOriginalTarget(e), 'hold', {\n\t\t\t\t\tx: e.clientX,\n\t\t\t\t\ty: e.clientY,\n\t\t\t\t\tsourceEvent: e,\n\t\t\t\t\tpreventer: preventer\n\t\t\t\t});\n\t\t\t}, HOLD_THRESHOLD );\n\t\t\treturn false;\n\t\t}\n\t});\n}\n","export const PREFIX = '/contract';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-contract-lookup', mod: 'contracts/selection/routes/sb-contract-lookup/ContractLookup.js'}\n};\n","export const PREFIX = '/docgen';\nexport const ROUTES = {\n\t'/preview': { comp: 'sb-docgen-preview', mod: 'docgen/sb-docgen-preview/DocgenPreview.js' }\n}\n","'use strict';\n\nSystem.register('favorites/favorites.js', ['favorites/sb-favorite-lookup/FavoriteLookup.js', 'favorites/sb-favorite-share-dialog/FavoriteShareDialog.js'], function (_export, _context) {\n  return {\n    setters: [function (_favoritesSbFavoriteLookupFavoriteLookupJs) {}, function (_favoritesSbFavoriteShareDialogFavoriteShareDialogJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJmYXZvcml0ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/favorite';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-favorite-lookup', mod: 'favorites/sb-favorite-lookup/FavoriteLookup.js'},\n};\n","/**\n * Copyright, 1999-2020, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst API_END_POINT = '/connect/proxy/app-analytics-logging';\n\n/**\n * Client for app-analytics-logging connect API\n * See QuoteLineEditorLogRecord.java for detail of the log record type\n *\n * @author kzheng\n * @since 226\n */\n\n// Log event type enum that will be logged to eventType_qtqle field. Define a unique type for each new event\nexport const LOG_TYPE = {\n    LOAD_QLE: 'loadQLE',\n    RESIZE_COLUMN: 'resizeColumn',\n    RESET_COLUMN: 'resetColumn',\n\tPRICING_GUIDANCE: 'pricingGuidance'\n}\n\nexport class AppLogger {\n\n    constructor() {\n        this.client = new ServiceClient();\n    }\n\n    /**\n     * Log the given information to app analytics logging\n     * @param recordId the contextual record for which the event is related\n     * @param eventType type of event being logged\n     * @param payload Extra payload information in JSON format\n     */\n    log(recordId, eventType, payload) {\n        // skip localhost mode\n        if (typeof Visualforce === 'undefined') {\n            return;\n        }\n        // the backend expects a string so a json object needs to be stringified\n        if (payload && typeof payload === 'object') {\n        \tpayload = JSON.stringify(payload);\n\t\t}\n        try {\n            const body = {\"logLines\":[{\"code\":\"qtqle\",\"data\":{\n                        'recordId_qtqle': recordId,\n                        'osName_qtqle': this._getOSType(),\n                        'deviceModel_qtqle': this._getDeviceModel(),\n                        'browserName_qtqle': this._getBrowserType(),\n                        'eventType_qtqle': eventType,\n                        'payload_qtqle': payload\n                    }}]};\n            this.client.requestPost(API_END_POINT, body);\n        } catch (err) {\n            console.error('Error invoking AppLogger.log', err);\n        }\n    }\n\n\t/**\n\t * Mask customer data value unless it begins with org prefix (SBQQ)\n\t * Use this to log metadata that may contain custom object/field names etc.\n\t * @param value\n\t * @param mask\n\t * @returns {string}\n\t */\n    maskCustomerData(value, mask = '*****') {\n\t\treturn (!value || value.startsWith(AppContext.org.prefix)) ? value : mask;\n\t}\n\n\t/**\n\t * Retrieve device type from userAgent string. We currently only recognize iPad, iPhone, Android and desktop devices\n\t * @returns {string}\n\t * @private\n\t */\n\t_getDeviceModel() {\n        const userAgent = window.navigator.userAgent;\n        if (userAgent.indexOf('iPad') > -1) {\n            return 'iPad';\n        } else if (userAgent.indexOf('Android') > -1) {\n            return 'Android';\n        } else if (userAgent.indexOf('iPhone') > -1) {\n            return 'iPhone';\n        } else {\n            return 'desktop';\n        }\n    }\n\n\t/**\n\t * Return browser type: Chrome, Safari, Firefox or Edge\n\t * @returns {*}\n\t * @private\n\t */\n\t_getBrowserType() {\n        const userAgent = window.navigator.userAgent;\n        if (userAgent.indexOf('Edg') > -1) {\n        \treturn 'Edge'\n\t\t} else if (userAgent.indexOf('Chrome') > -1) {\n            return 'Chrome';\n        } else if (userAgent.indexOf('Safari') > -1) {\n            return 'Safari';\n        } else if (userAgent.indexOf('Firefox') > -1) {\n            return 'Firefox';\n        }\n        return null;\n    }\n\n    /**\n     * Return operating system type: Windows, iOS, Mac, Android or Linux\n     * @returns {string|null}\n     * @private\n     */\n    _getOSType() {\n\t    const userAgent = window.navigator.userAgent;\n        if (userAgent.indexOf('Win') > -1) {\n            return 'Windows';\n        } else if (userAgent.indexOf('like Mac') > -1) {\n            return 'iOS';\n        } else if (userAgent.indexOf('Mac') > -1) {\n            return 'Macintosh';\n        } else if (userAgent.indexOf('Android') > -1) {\n            return 'Android';\n        } else if (userAgent.indexOf('Linux') > -1) {\n            return 'Linux';\n        }\n        return null;\n    }\n}","const CORE_LOG_NAME = \"cpqEPT\";\nconst CORE_LOG_ENDPOINT = \"/_ui/common/request/servlet/CPQLoggingServlet\";\nconst METRICSSERVICE_VERSION = \"1.0\";\nexport const IDLE_RETRIES = 2; // Wait extra cycles before declaring the transaction end\nconst API_VERSION = 48; //TODO: Remove hardcoded API version\n\nexport class MetricsService {\n\n\t/**\n\t * Constructor\n\t * @param salesforceBaseUrl salesforce CORE endpoint\n\t */\n\tconstructor(salesforceBaseUrl = null) {\n\t\tthis.salesforceBaseUrl = salesforceBaseUrl;\n\t}\n\n\t/**\n\t * Call this to start the EPT MetricsService (e.g. page loads, page actions, etc)\n\t */\n\tstartTransaction(msg) {\n\t\tif (this.canGatherMetrics() && this._isNotStarted()) {\n\t\t\tthis._init();\n\t\t\t// ensure this MetricsService is called when the window becomes idle\n\t\t\tthis._queueIdleCallback();\n\t\t\tconsole.log(msg || 'CPQ Performance Metrics Service: started ept');\n\t\t}\n\t}\n\n\t/**\n\t * Indicates a service request has been queued\n\t */\n\tstartServiceRequest(actionName, additionalInfo) {\n\t\tif (this._isNotStarted())\n\t\t\treturn null;\n\n\t\t// tracks number of service requests pending\n\t\twindow.sb.MetricsService.internal.sptNum += 1;\n\n\t\tlet id = this._getUniqueId();\n\t\tif (actionName === undefined) {\n\t\t\tactionName = '';\n\t\t}\n\n\t\tif (additionalInfo !== undefined) {\n\t\t\tactionName = actionName + '/' + additionalInfo;\n\t\t}\n\t\twindow.sb.MetricsService.internal.actions.set(id, this._buildTransportAction(actionName));\n\n\t\tconsole.log('CPQ Performance Metrics Service: started service call');\n\t\treturn id;\n\t}\n\n\t/**\n\t * Adds external metrics to be included in the log\n\t * @param metrics {Object} external metrics to be included in the log\n\t */\n\taddExternalLogMetrics(metrics) {\n\t\tif(!metrics) metrics = {};\n\t\tif(!this._externalLogMetrics) this._externalLogMetrics = {};\n\t\tObject.assign(this._externalLogMetrics, metrics);\n\t}\n\n\t_buildTransportAction(actionName) {\n\t\treturn {\n\t\t\t\"context\": {\n\t\t\t\t\"actionDefs\": [\n\t\t\t\t\tactionName\n\t\t\t\t],\n\t\t\t},\n\t\t\t\"pageStartTime\": Date.now(),\n\t\t\t\"ts\": this._getTime(),\n\t\t\t\"name\": \"request\",\n\t\t\t\"ns\": \"transport\"\n\t\t};\n\t}\n\n\t/**\n\t * Indicate a service response has been resolved\n\t * @param sptTime the total time the service took on the server\n\t */\n\tstopServiceRequest(id, sptTime = 0) {\n\t\tif (this._isNotStarted())\n\t\t\treturn;\n\n\t\twindow.sb.MetricsService.internal.sptNum -= 1;\n\t\t// Allow for more time in idle between server requests\n\t\twindow.sb.MetricsService.internal.idleRetries = IDLE_RETRIES;\n\n\t\tif (window.sb.MetricsService.internal.idleStart > 0) {\n\t\t\twindow.sb.MetricsService.internal.idleTime += (this._getTime() - window.sb.MetricsService.internal.idleStart);\n\t\t\twindow.sb.MetricsService.internal.idleStart = 0;\n\t\t}\n\t\tthis._populateTransportAction(id);\n\t\twindow.sb.MetricsService.internal.sptTime += sptTime;\n\t\tconsole.log('CPQ Performance Metrics Service: ended service call', sptTime);\n\t}\n\n\t_init(entityId = null) {\n\t\tlet now = Date.now();\n\t\tlet perfNow = this._getTime();\n\t\tvar pageStartTime = this._getPageStartTime();\n\t\twindow.sb.visibilityStateEnd = document.visibilityState;\n\t\t// Save a MetricsService object to be used as an array to save state for later calls.\n\t\twindow.sb = window.sb || {};\n\t\tif (window.sb != null && window.sb.MetricsService == null) {\n\t\t\twindow.sb.MetricsService = {};\n            // The first time init is called it will save the bootstrap info which denotes the app load time\n            window.sb.MetricsService.bootstrap = {\n                \"id\" : \"qtc:bootstrap\",\n            };\n            window.sb.MetricsService.bootstrap[\"bootstrapEPT\"] = perfNow;\n            window.sb.MetricsService.bootstrap[\"pageStartTime\"] = pageStartTime;\n            window.sb.MetricsService.bootstrap[\"visibilityStateStart\"] = window.sb.visibilityStateStart;\n            window.sb.MetricsService.bootstrap[\"visibilityStateEnd\"] = window.sb.visibilityStateEnd;\n            var allReq = [];\n            if (window.performance && performance.timing) {\n                var p  = window.performance;\n                var pt = p.timing;\n                var additionalMetrics = {\n\n                        // Time consumed preparing the new page\n                        \"readyStart\"      : pt.fetchStart - pt.navigationStart,\n\n                        // DNS query time\n                        \"lookupDomainTime\": pt.domainLookupEnd - pt.domainLookupStart,\n\n                        // TCP connection time\n                        \"connectTime\"     : pt.connectEnd - pt.connectStart,\n\n                        // Time spent during the request\n                        \"requestTime\"     : pt.responseEnd - pt.requestStart,\n\n                        // Request to completion of the DOM loading\n                        \"initDomTreeTime\" : pt.domInteractive - pt.responseEnd,\n\n                         // Time spent constructing the DOM tree\n                        \"domReadyTime\"    : pt.domComplete - pt.domInteractive,\n\n                        // Load event time\n                        \"loadEventTime\"   : pt.loadEventEnd - pt.loadEventStart,\n\n                        // Total time from start to load\n                        \"loadTime\"        : pt.loadEventEnd - pt.fetchStart,\n\n                        // Time spent unloading documents\n                        \"unloadEventTime\" : pt.unloadEventEnd - pt.unloadEventStart,\n\n                        // AppCache\n                        \"appCacheTime\"    : pt.domainLookupStart - pt.fetchStart,\n\n                        // Time spent during redirection\n                        \"redirectTime\"    : pt.redirectEnd - pt.redirectStart\n                    };\n\n                window.sb.MetricsService.bootstrap[\"timing\"] = Object.assign(pt.toJSON(), additionalMetrics);\n\n            \twindow.sb.MetricsService.bootstrap[\"allRequests\"] = [];\n              \tp.getEntries().forEach(function (resource) {\n                    \tvar summaryRequest = this._summarizeResourcePerfInfo(resource);\n                    \twindow.sb.MetricsService.bootstrap[\"allRequests\"].push(summaryRequest);\n            \t}, this);           \t\n            }\n\t\t} else {\n\t\t\t//After first time,bootstrap object needs to be empty.\n\t\t\twindow.sb.MetricsService.bootstrap = {};\n\t\t}\n\n\t\t// initialize the window.sb MetricsService object\n\n\t\twindow.sb.MetricsService.internal = {\n\t\t\tlastIdleEndTime : perfNow,\n\t\t\tsptNum : 0,\n\t\t\tidleStart : 0,\n\t\t\tidleTime : 0,\n\t\t\tsptTime: 0,\n\t\t\tidleRetries : IDLE_RETRIES,\n\t\t\tactions : new Map()\n\t\t};\n\n\t\twindow.sb.MetricsService.currentPage = {\n\t\t\t\"ept\": undefined,\n\t\t\t\"bpt\": undefined,\n\t\t\t\"spt\": undefined,\n\t\t\t\"pageStartTime\": now, // Time after app.init, which is where startTransaction gets called\n\t\t\t\"ts\": perfNow, // ts since the beginning of the page load\n\t\t\t\"page\": {\n\t\t\t\t\"attributes\": {\n\t\t\t\t\t\"app\": {\n\t\t\t\t\t\t\"appName\": \"SteelBrick\",\n\t\t\t\t\t\t\"appType\": \"Standard\"\n\t\t\t\t\t},\n\t\t\t\t\t\"url\": window.location.href\n\t\t\t\t},\n\t\t\t\t\"entity\": entityId\n\t\t\t},\n\t\t}\n\t}\n\n\t_idle() {\n\t\tif (this._isNotStarted())\n\t\t\treturn;\n\n\t\tif (window.sb.MetricsService.internal.sptNum === 0) {\n\t\t\tif (window.sb.MetricsService.internal.idleRetries !== 0) {\n\t\t\t\t// wait some idle cycles before declaring the request is finished to allow\n\t\t\t\t// time between server requests.\n\t\t\t\tif (window.sb.MetricsService.internal.idleRetries == IDLE_RETRIES) {\n\t\t\t\t\twindow.sb.MetricsService.internal.lastIdleEndTime = this._getTime();\n\t\t\t\t}\n\t\t\t\twindow.sb.MetricsService.internal.idleRetries--;\n\t\t\t} else {\n\t\t\t\tthis._calcAndDisplayMetrics();\n\t\t\t\tthis._logMetrics();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// if new idle is starting, capture the start time\n\t\tif (window.sb.MetricsService.internal.idleStart === 0)\n\t\t\twindow.sb.MetricsService.internal.idleStart = this._getTime();\n\n\t\t// we are idle, but have pending service request, so queue another idle callback\n\t\tthis._queueIdleCallback();\n\t}\n\n\t_summarizeResourcePerfInfo(r) {\n\t\treturn {\n\t\t\t\"name\"            : r.name,\n\t\t\t\"initiatorType\"   : r.initiatorType,\n\t\t    \"duration\"        : parseInt(r.responseEnd - r.startTime, 10),\n\t\t    \"startTime\"       : parseInt(r.startTime, 10),\n\t\t    \"fetchStart\"      : parseInt(r.fetchStart, 10),\n\t\t    \"requestStart\"    : parseInt(r.requestStart, 10),\n\t\t    \"dns\"             : parseInt(r.domainLookupEnd - r.domainLookupStart, 10),\n\t\t    \"tcp\"             : parseInt(r.connectEnd - r.connectStart, 10),\n\t\t    \"ttfb\"            : parseInt(r.responseStart - r.startTime, 10),\n\t\t    \"transfer\"        : parseInt(r.responseEnd - r.responseStart, 10),\n\t\t\t\"transferSize\"    : parseInt(r.transferSize, 10),\n\t\t    \"encodedBodySize\" : parseInt(r.encodedBodySize, 10),\n\t\t    \"decodedBodySize\" : parseInt(r.decodedBodySize, 10)       \n\t    };\n\t}\n\n\t_populateTransportAction(id) {\n\t\tif (!id) return;\n\t\tlet transportAction = window.sb.MetricsService.internal.actions.get(id);\n\t\tif (transportAction) {\n\t\t\ttransportAction.duration = parseInt(this._getTime() - transportAction.ts);\n\t\t}\n\t}\n\n\t_queueIdleCallback() {\n\t\tif (this.canGatherMetrics()) {\n\t\t\twindow.requestIdleCallback(this._idle.bind(this));\n\t\t}\n\t}\n\n\t_calcAndDisplayMetrics() {\n\t\tlet eptTime = window.sb.MetricsService.internal.lastIdleEndTime - window.sb.MetricsService.currentPage.ts;\n\t\tlet bptTime = eptTime - window.sb.MetricsService.internal.idleTime;\n\t\tlet sptTime = window.sb.MetricsService.internal.sptTime;\n\t\tvar transports = [];\n\t\tvar allResources = null;\n\t\tif (window.performance && window.performance.getEntriesByType) {\n\t\t\tallResources = window.performance.getEntriesByType(\"resource\");\n\t\t}\n\n\t\tfor (var [key, value] of window.sb.MetricsService.internal.actions) {\n\t\t\tif (allResources != null) {\n\t\t\t\tvar resource = allResources.filter(function (res) {\n\t\t\t\t\treturn (res.startTime >= value.ts) && (res.startTime <= (value.ts + value.duration));\n\t\t\t\t})[0];\n\t\t\t\tif (resource != null) {\n\t\t\t\t\tvalue.resource = resource;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttransports.push(value);\n\t\t}\n\t\twindow.sb.MetricsService.internal = null;\n\t\twindow.sb.MetricsService.currentPage.ept = eptTime;\n\t\twindow.sb.MetricsService.currentPage.bpt = bptTime;\n\t\twindow.sb.MetricsService.currentPage.spt = sptTime;\n\t\twindow.sb.MetricsService.currentPage.marks = {\n\t\t\t\"transport\": transports\n\t\t}\n\t\tconsole.log('CPQ Performance Metrics Service: ', window.sb.MetricsService.bootstrap, window.sb.MetricsService.currentPage);\n\n\t\t// Display the stickers only if debug mode is on\n\t\tif (this._canDisplayMetrics()) {\n\t\t\tlet metricsChangedEvent = new CustomEvent('metrics-changed', {\n\t\t\t\t'detail': window.sb.MetricsService.currentPage,\n\t\t\t\t'bootstrap': window.sb.MetricsService.bootstrap\n\t\t\t});\n\t\t\tdocument.dispatchEvent(metricsChangedEvent);\n\t\t}\n\t}\n\n\t_normalizeApiHost(apiHost) {\n\t\tvar m = /([a-zA-Z0-9_-]+)\\.(vpod\\.visual\\.t\\.force|visual\\.force|salesforce)\\.com$/.exec(apiHost);\n\t\tif (m) {\n\t\t\tif (m[2] == \"vpod.visual.t.force\") {\n\t\t\t\tapiHost = m[1] + \".vpod.t.force.com\";\n\t\t\t} else {\n\t\t\t\tapiHost = m[1] + \".salesforce.com\";\n\t\t\t}\n\t\t}\n\t\treturn apiHost;\n\t}\n\n\t_logMetrics(retry = false) {\n\n\t\t// We are only interested in logging transactions with at least 150ms\n\t\t// This will eliminate the noise cased by random clicks on the page\n\t\tif (window.sb.MetricsService.currentPage.ept < 150) {\n\t\t\treturn;\n\t\t}\n\n\t\t// QLE is build on visual force so the hostname will be different than the servlet endpoint\n\t\tif (!this.salesforceBaseUrl) {\n\t\t\treturn;\n\t\t}\n\t\tvar url = this.salesforceBaseUrl + CORE_LOG_ENDPOINT;\n\n\t\t// Core logging require a valid session id (hence passing the cookie)\n\t\t// Also adding the Origin header in the query to handle CORS\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.withCredentials = true;\n\t\txhr.open(\"POST\", url, true);\n\n\t\t// Log the results of the call when done\n\t\tvar self = this;\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState == XMLHttpRequest.DONE) {\n\t\t\t\tif (xhr.status == 200) {\n\t\t\t\t\tconsole.log(\"CPQ Performance Metrics service Successfully logged\");\n\t\t\t\t} else {\n\t\t\t\t\tif (retry) {\n\t\t\t\t\tconsole.log(\"Error while logging CPQ Performance Metrics Service:\");\n\t\t\t\t\tconsole.log(xhr.getAllResponseHeaders());\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Temporary \"fix\" until W-6086785 gets resolved.\n\t\t\t\t\t// If My Domain is not set and instanceless URL update is not activated, the salesforceBaseUrl is\n\t\t\t\t\t// wrong and it will cause a CORS issue. In that case, we can build the salesforceBaseUrl ourself.\n\t\t\t\t\tconsole.log(\"Logging failed, trying on different endpoint..\");\n\t\t\t\t\tvar hostname = self._normalizeApiHost(location.host);\n\t\t\t\t\tvar url = location.protocol + \"//\" + hostname;\n\t\t\t\t\tself.salesforceBaseUrl = url;\n\t\t\t\t\tself._logMetrics(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar defaultAttrs = {\n\t\t\t\"pkgVersion\": window.sb.pkgVersion,\n\t\t\t\"apiVersion\": API_VERSION,\n\t\t\t\"url\": window.sb.MetricsService.currentPage.page.attributes.url,\n\t\t\t\"pageStartTime\": window.sb.MetricsService.currentPage.pageStartTime,\n\t\t\t\"version\": METRICSSERVICE_VERSION\n\t\t};\n\n\t\t// add external log metrics if provided\n\t\tif(this._externalLogMetrics)\n\t\t\tObject.assign(defaultAttrs, this._externalLogMetrics);\n\n\t\t// Build the JSON expected by the servlet\n\t\tvar logLines = [\n\t\t\t{\n\t\t\t\t\"logName\": CORE_LOG_NAME,\n\t\t\t\t\"logLevel\": \"INFO\",\n\t\t\t\t\"logAttrs\": {\n\t\t\t\t\t\"attrsId\": \"cpq:page\",\n\t\t\t\t\t\"ept\": window.sb.MetricsService.currentPage.ept,\n\t\t\t\t\t\"bpt\": window.sb.MetricsService.currentPage.bpt,\n\t\t\t\t\t\"spt\": window.sb.MetricsService.currentPage.spt,\n\t\t\t\t\t\"resources\": window.sb.MetricsService.currentPage.marks\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tObject.assign(logLines[0].logAttrs, defaultAttrs);\n\n\t\tif (Object.keys(window.sb.MetricsService.bootstrap).length !== 0) {\n\t\t\tlogLines.push({\n\t\t\t\t\"logName\": CORE_LOG_NAME,\n\t\t\t\t\"logLevel\": \"INFO\",\n\t\t\t\t\"logAttrs\": {\n\t\t\t\t\t\"attrsId\": window.sb.MetricsService.bootstrap.id,\n\t\t\t\t\t\"bootstrapEPT\": window.sb.MetricsService.bootstrap.bootstrapEPT,\n\t\t\t\t\t\"visibilityStateStart\": window.sb.MetricsService.bootstrap.visibilityStateStart,\n\t\t\t\t\t\"visibilityStateEnd\": window.sb.MetricsService.bootstrap.visibilityStateEnd,\n\t\t\t\t\t\"resources\": window.sb.MetricsService.bootstrap.allRequests,\n\t\t\t\t\t\"timing\": window.sb.MetricsService.bootstrap.timing\n\t\t\t\t}\n\t\t\t});\n\t\t\tObject.assign(logLines[1].logAttrs, defaultAttrs);\n\t\t}\n\n\t\t// Send the data\n\t\tvar formData = new FormData();\n\t\tformData.append(\"logLines\", JSON.stringify(logLines));\n\t\txhr.send(formData);\n\t}\n\n\t_canDisplayMetrics() {\n\t\t// If I can't gather the metrics and can't display them\n\t\tif (!this.canGatherMetrics()) {\n\t\t\treturn false;\n\t\t}\n\t\t// Display the stickers only if eptVisible flag is set in the UI\n\t\tvar url = new URL(window.location.href);\n\t\tvar searchParams = new URLSearchParams(url.search);\n\t\tvar eptVisible = searchParams.get('eptVisible');\n\t\treturn (eptVisible == true);\n\t}\n\n\tcanGatherMetrics() {\n\t\t// uses an experimental API to track when the window is Idle, only supported in Chrome and FF\n\t\treturn (typeof window.requestIdleCallback === 'function');\n\t}\n\n\t_isNotStarted() {\n\t\treturn window.sb == null || window.sb.MetricsService == null || window.sb.MetricsService.internal == null ||\n\t\t\twindow.sb.MetricsService.internal.sptNum == null;\n\t}\n\n\t_getTime() {\n\t\tif (window.performance) {\n\t\t\treturn window.performance.now();\n\t\t} else {\n\t\t\treturn Date.now();\n\t\t}\n\t}\n\n\t _getPageStartTime() {\n        //Get the page firstByte timestamp from either performance API or a mark in the page\n        var p = window.performance;\n        var pst;\n        if (p && p.timing && p.timing.navigationStart) {\n            pst = p.timing.navigationStart;\n        } else {\n            pst = window[\"pageStartTime\"];\n        }\n        return pst;\n    }\n\n\t_getUniqueId() {\n\t\treturn this._getRandomInt(1, 10000);\n\t}\n\n\t_getRandomInt(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n}\n","'use strict';\n\nSystem.register('products/products.js', ['products/config/attribute/sb-attribute-item/AttributeItem.js', 'products/config/attribute/sb-attribute-table/AttributeTable.js', 'products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js', 'products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js', 'products/config/feature/sb-product-feature/ProductFeature.js', 'products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js', 'products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js', 'products/config/feature/sb-product-feature-list/ProductFeatureList.js', 'products/config/option/sb-product-option-table/ProductOptionTable.js', 'products/config/option/sb-option-cell/OptionCell.js', 'products/config/option/sb-option-drawer/OptionDrawer.js', 'products/config/routes/services/sb-pc-product-load/ProductLoader.js', 'products/config/routes/services/sb-pc-option-save/OptionSaver.js', 'products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js', 'products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js', 'products/config/actions/sb-custom-actions/CustomActions.js', 'products/localization/LocalizeFields.js', 'products/resources/sb-product-alert/ProductAlert.js'], function (_export, _context) {\n  return {\n    setters: [function (_productsConfigAttributeSbAttributeItemAttributeItemJs) {}, function (_productsConfigAttributeSbAttributeTableAttributeTableJs) {}, function (_productsConfigBundlesSbProductBundlesLayoutProductBundlesLayoutJs) {}, function (_productsConfigBundlesSbProductBundlesFilterItemProductBundlesFilterItemJs) {}, function (_productsConfigFeatureSbProductFeatureProductFeatureJs) {}, function (_productsConfigFeatureSbProductFeatureLayoutProductFeatureLayoutJs) {}, function (_productsConfigFeatureSbProductFeatureCategoryListProductFeatureCategoryListJs) {}, function (_productsConfigFeatureSbProductFeatureListProductFeatureListJs) {}, function (_productsConfigOptionSbProductOptionTableProductOptionTableJs) {}, function (_productsConfigOptionSbOptionCellOptionCellJs) {}, function (_productsConfigOptionSbOptionDrawerOptionDrawerJs) {}, function (_productsConfigRoutesServicesSbPcProductLoadProductLoaderJs) {}, function (_productsConfigRoutesServicesSbPcOptionSaveOptionSaverJs) {}, function (_productsConfigRoutesServicesSbProductRulesInvokeProductRulesInvokerJs) {}, function (_productsConfigRoutesServicesSbPcOptionConfigureOptionConfiguratorJs) {}, function (_productsConfigActionsSbCustomActionsCustomActionsJs) {}, function (_productsLocalizationLocalizeFieldsJs) {}, function (_productsResourcesSbProductAlertProductAlertJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcm9kdWN0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbXX0=","export const PREFIX = '/product';\nexport const ROUTES = {\n\t'/dl': {comp: 'sb-dynamic-lookup', mod: 'products/config/routes/sb-dynamic-lookup/DynamicLookup.js'},\n\t'/lookup': {comp: 'sb-product-lookup', mod: 'products/selection/routes/sb-product-lookup/ProductLookup.js'},\n\t'/ol': {comp: 'sb-option-lookup', mod: 'products/config/routes/sb-option-lookup/OptionLookup.js'},\n\t'/pc': {comp: 'sb-product-config', mod: 'products/config/routes/sb-product-config/ProductConfig.js'},\n\t'/search': {comp: 'sb-product-search', mod: 'products/prototype/sb-product-search/ProductSearch.js'}\n};\n","import * as Utils from './Utils.js';\n\n/**\n * Interface for publishing messages to a channel.\n * Any channel that this class wraps must meet the required interface (CHANNEL_INTERFACE),\n * which has methods init, isActive, isReady, addListener, removeListener, send, and shutdown.\n */\nexport default class Publisher {\n\t/**\n\t * Creates a new publisher using the tag and channel provided.\n\t * @param {string} tag A tag unique to the user of this object\n\t * @param {Object} channel The communication channel to subscribe to\n\t * @constructor\n\t */\n\tconstructor(tag, channel) {\n\t\tif (!tag || !Utils.isValidChannel(channel)) {\n\t\t\tthrow 'Publisher: Constructor requires 2 valid arguments (tag, channel)';\n\t\t}\n\n\t\tthis.tag = tag;\n\t\tthis.channel = channel;\n\t\tthis.msgQueue = [];\n\t}\n\n\t/**\n\t * Initializes the publisher. Must be called in order to send messages.\n\t */\n\tinit() {\n\t\tthis.channel.init(this._publishOnceReady.bind(this));\n\t}\n\n\t/**\n\t * Publish the given message to the channel once it's ready.\n\t * If the channel is not ready yet, this method will buffer requests until it is.\n\t * @param {Object} message The message to publish\n\t */\n\tpublish(message) {\n\t\tif (!message) {\n\t\t\tconsole.error('Publisher: publish() must be called with a valid message object argument');\n\t\t\treturn;\n\t\t}\n\n\t\t// Set tag on this message\n\t\tconst msg = Object.assign({}, message);\n\t\tmsg.tag = this.tag;\n\n\t\t// Queue message, then attempt to publish\n\t\tthis.msgQueue.push(msg);\n\t\tthis._publishOnceReady();\n\t}\n\n\t/**\n\t * Shuts down the publisher and cleans up.\n\t */\n\tshutdown() {\n\t\tthis.msgQueue = [];\n\t\tthis.channel.shutdown();\n\t}\n\n\t/**\n\t * Only publishes messages if the channel is ready.\n\t * Otherwise it waits until the next time it's called.\n\t * @private\n\t */\n\t_publishOnceReady() {\n\t\tif (!this.channel.isReady()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If channel is ready, publish all outstanding messages\n\t\tthis.msgQueue.forEach(msg => this.channel.send(msg));\n\t\tthis.msgQueue = [];\n\t}\n}\n","import Subscriber from './Subscriber.js';\nimport Publisher from './Publisher.js';\nimport * as Utils from './Utils.js';\nimport WindowChannel from './WindowChannel.js';\n\nconst TAG = 'QuoteLogger';\n\n// Window-specific constants\nconst TYPE_SYN = '__SYN__';\nconst TYPE_ACK = '__ACK__';\nconst SYN = { tag: TAG, type: TYPE_SYN };\nconst ACK = { tag: TAG, type: TYPE_ACK };\nconst TIMEOUT = 100;\n\n/**\n * QuoteLogger to use with QLE Diagnostic Tool.\n * Allows easy creation, publishing, and subscribing of logs to transfer information from UI to tool.\n */\nexport default class QuoteLogger {\n\t// STATIC FUNCTIONS\n\t/**\n\t * Returns a new appender to be used with log4js.\n\t * @returns {function} Function that takes the log4js logEvent as input\n\t */\n\tstatic appender() {\n\t\treturn logEvent => {\n\t\t\tif (this.instance) {\n\t\t\t\tlet log = Utils.makeLogFromArgs(logEvent.data);\n\t\t\t\tlog.timestamp = logEvent.startTime;\n\t\t\t\tthis.instance._publish(log);\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Identical to appender().\n\t * @returns {function} See appender()\n\t */\n\tstatic configure() {\n\t\treturn this.appender();\n\t}\n\n\t/**\n\t * Sets the QuoteLogger instance to send log4js logs to.\n\t * Only necessary if using log4js (if not, use instance standalone).\n\t * @param {QuoteLogger} inst The instance to use\n\t */\n\tstatic setInstance(inst) {\n\t\tif (this.instance) {\n\t\t\tthis.instance.shutdown();\n\t\t}\n\n\t\tthis.instance = inst;\n\t}\n\n\t/**\n\t * Creates a new QuoteLogger instance to be used as publisher or subscriber.\n\t * See appender() and setInstance() for information about log4js compatability.\n\t * @param {Object} subChannel The channel to use for subscribing\n\t * @param {Object} pubChannel The channel to use for publishing\n\t * @constructor\n\t */\n\tconstructor(subChannel, pubChannel) {\n\t\tthis.subChannel = subChannel;\n\t\tthis.pubChannel = pubChannel;\n\t\tthis.subscriber = subChannel ? new Subscriber(TAG, subChannel) : null;\n\t\tthis.publisher = pubChannel ? new Publisher(TAG, pubChannel) : null;\n\t\tthis.isSubscriber = false;\n\t\tthis.isPublisher = false;\n\t\tthis.callbacks = [];\n\t}\n\n\t// PUBLISHER FUNCTIONS\n\t/**\n\t * Initializes a QuoteLogger to be used as a publisher.\n\t */\n\tinitPublisher() {\n\t\tif (!this.publisher) {\n\t\t\tconsole.error('QuoteLogger: pubChannel is required in order to initPublisher()');\n\t\t\treturn;\n\t\t}\n\n\t\t// Execute WINDOW ONLY setup\n\t\tif (this.pubChannel instanceof WindowChannel) {\n\t\t\tif (!this.subscriber) {\n\t\t\t\tconsole.error('QuoteLogger: subChannel is required in order to initPublisher() when using WindowChannel');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.subscriber.init();\n\t\t\tthis.publisher.init();\n\t\t\tthis.subscriber.subscribe(this._receiveLog.bind(this));\n\t\t\tthis._waitForWindow();\n\t\t}\n\t\telse {\n\t\t\tthis.publisher.init();\n\t\t}\n\n\t\tthis.isPublisher = true;\n\t}\n\n\t/**\n\t * Publish a single log.\n\t * This function can either take a single object argument with 'type' set or it will interperet the arguments\n\t * as a list of strings.\n\t */\n\tpublish() {\n\t\tlet log = Utils.makeLogFromArgs.apply(null, arguments);\n\t\tlog.timestamp = (new Date()).toString();\n\t\tthis._publish(log);\n\t}\n\n\t// SUBSCRIBER FUNCTIONS\n\t/**\n\t * Initializes a QuoteLogger to be used as a subscriber.\n\t */\n\tinitSubscriber() {\n\t\tif (!this.subscriber) {\n\t\t\tconsole.error('QuoteLogger: subChannel is required in order to initSubscriber()');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isSubscriber = true;\n\t\tthis.subscriber.init();\n\t\tthis.subscriber.subscribe(this._receiveLog.bind(this));\n\t}\n\n\t/**\n\t * Subscribe for messages by passing in a callback function.\n\t * The function will be called with two parameters: the log received, and this logger\n\t * @param {Function} callback The callback to execute on log received\n\t */\n\tsubscribe(callback) {\n\t\tif (!this.isSubscriber) {\n\t\t\tconsole.error('QuoteLogger: initSubscriber() must be called prior to any subscribing methods');\n\t\t\treturn;\n\t\t}\n\t\tif (typeof callback !== 'function') {\n\t\t\tconsole.error('QuoteLogger: subscribe() must be called with a valid function');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.push(callback);\n\t}\n\n\t/**\n\t * Unsubscribe a callback. The parameter must have been previously subscribed.\n\t * @param {Function} callback A previously subscribed callback\n\t */\n\tunsubscribe(callback) {\n\t\tif (!this.isSubscriber) {\n\t\t\tconsole.error('QuoteLogger: initSubscriber() must be called prior to any subscribing methods');\n\t\t\treturn;\n\t\t}\n\t\tconst loc = this.callbacks.indexOf(callback);\n\t\tif (loc < 0) {\n\t\t\tconsole.error('QuoteLogger: unsubscribe() must be called with a function previously set using subscribe()');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.splice(loc, 1);\n\t}\n\n\t/**\n\t * Shutdown this instance and unset all references so this memory can be reclaimed.\n\t */\n\tshutdown() {\n\t\tif (this.subscriber) {\n\t\t\tthis.subscriber.shutdown();\n\t\t}\n\t\tif (this.publisher) {\n\t\t\tthis.publisher.shutdown();\n\t\t}\n\n\t\tthis.isSubscriber = false;\n\t\tthis.isPublisher = false;\n\t\tthis.callbacks = [];\n\t}\n\n\t/**\n\t * Publishes a single log.\n\t * @param {Object} log A log to publish. Must have 'type' property\n\t * @private\n\t */\n\t_publish(log) {\n\t\tif (!this.isPublisher) {\n\t\t\tconsole.error('QuoteLogger: initPublisher() must be called prior to any publishing methods');\n\t\t\treturn;\n\t\t}\n\t\tif (!log.type) {\n\t\t\tconsole.error('QuoteLogger: publish() argument missing \"type\" property');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.publisher.publish(log);\n\t}\n\n\t_receiveLog(log) {\n\t\tif (!log) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Window-specific check for internal logs\n\t\tif (this.subChannel instanceof WindowChannel) {\n\t\t\t// On SYN, send back ACK to source\n\t\t\tif (log.type === TYPE_SYN) {\n\t\t\t\tconst sourceChannel = new WindowChannel(log.source);\n\t\t\t\tsourceChannel.send(ACK);\n\t\t\t}\n\t\t\t// On ACK, mark pubChannel as ready\n\t\t\telse if (log.type === TYPE_ACK && this.isPublisher) {\n\t\t\t\tthis.pubChannel.markReady();\n\t\t\t}\n\t\t\tdelete log.source;\n\t\t}\n\n\t\tthis.callbacks.forEach(cb => cb(log, this));\n\t}\n\n\t/**\n\t * Window-specific\n\t * Waits until the pubChannel is ready, and keeps pinging until it is.\n\t * @private\n\t */\n\t_waitForWindow() {\n\t\tif (!this.pubChannel.isActive() || this.pubChannel.isReady()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If active, but not yet ready, ping and wait\n\t\tthis.pubChannel.send(SYN);\n\t\tsetTimeout(this._waitForWindow.bind(this), TIMEOUT);\n\t}\n}\n","import * as Utils from './Utils.js';\n\n/**\n * Interface for subscribing to a channel for incoming messages.\n * Any channel that this class wraps must meet the required interface (CHANNEL_INTERFACE),\n * which has methods init, isActive, isReady, addListener, removeListener, send, and shutdown.\n */\nexport default class Subscriber {\n\t/**\n\t * Creates a new subscriber using the tag and channel provided.\n\t * @param {string} tag A tag unique to the user of this object\n\t * @param {Object} channel The communication channel to subscribe to\n\t * @constructor\n\t */\n\tconstructor(tag, channel) {\n\t\tif (!tag || !Utils.isValidChannel(channel)) {\n\t\t\tthrow 'Subscriber: Constructor requires 2 valid arguments (tag, channel)';\n\t\t}\n\n\t\tthis.tag = tag;\n\t\tthis.channel = channel;\n\t\tthis.callbacks = [];\n\t}\n\n\t/**\n\t * Initializes the subscriber. Must be called in order to receive messages.\n\t */\n\tinit() {\n\t\tthis.channel.init();\n\t\tthis.channel.addListener(this._receiveMessage.bind(this));\n\t}\n\n\t/**\n\t * Subscribe callback to be called when messages are received.\n\t * Callback should have signature: callback(message), where each message\n\t * has the { tag } property.\n\t * @param {function} callback The callback to subscribe\n\t */\n\tsubscribe(callback) {\n\t\tif (typeof callback !== 'function') {\n\t\t\tconsole.error('Subscriber: subscribe() must be called with a valid function');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.push(callback);\n\t}\n\n\t/**\n\t * Unsubscribes a previously subscribed callback.\n\t * Must be called with the same reference as the one used to subscribe.\n\t * @param {function} callback The callback to unsubscribe\n\t */\n\tunsubscribe(callback) {\n\t\tconst loc = this.callbacks.indexOf(callback);\n\t\tif (loc < 0) {\n\t\t\tconsole.error('Subscriber: unsubscribe() must be called with a function previously set using subscribe()');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.splice(loc, 1);\n\t}\n\n\t/**\n\t * Shuts down the subscriber and cleans up.\n\t */\n\tshutdown() {\n\t\tthis.callbacks = [];\n\t\tthis.channel.shutdown();\n\t}\n\n\t/**\n\t * Callback when message is received, to clean and check input before passing\n\t * to user defined callbacks.\n\t * @param {Object} message The message received\n\t * @private\n\t */\n\t_receiveMessage(message) {\n\t\t// Ignore messages with missing tag or that don't have our tag\n\t\tif (!message || message.tag !== this.tag) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.forEach(cb => cb(message));\n\t}\n}\n","const CHANNEL_INTERFACE = ['init', 'isActive', 'isReady', 'addListener', 'removeListener', 'send', 'shutdown'];\nconst TYPE_TEXT = 'text';\n\n/**\n * Checks if the given channel is valid by detecting the presence of interface functions.\n * This is so that no inheritance needs to be done to create a new channel type.\n * @param {Object} channel The channel to test\n * @returns {boolean} True if valid, false otherwise\n */\nexport function isValidChannel(channel) {\n\tif (!channel) {\n\t\treturn false;\n\t}\n\n\tconst matches = CHANNEL_INTERFACE.map(funName => typeof channel[funName] === 'function');\n\treturn reduceAnd(matches);\n}\n\n/**\n * Makes a log object from generic arguments.\n * If not in any expected format, evaluates as a variable list of strings.\n * @param {Array|Object|string} logData First argument which may be interpreted as array or object\n * @returns {Object} The created log\n */\nexport function makeLogFromArgs(logData) {\n\tif (!Array.isArray(logData)) {\n\t\tlogData = Array.prototype.slice.call(arguments);\n\t}\n\n\tlet log = logData[0];\n\tif (!log || typeof log !== 'object') {\n\t\tlog = {\n\t\t\ttype: TYPE_TEXT,\n\t\t\tdata: logData.join(' ')\n\t\t};\n\t}\n\n\treturn log;\n}\n\n/**\n * Reduces an array of bools using &&.\n * @returns {boolean} True if all true, false otherwise\n */\nfunction reduceAnd(bools) {\n\treturn bools.reduce((acc, val) => acc && val, true);\n}\n","/**\n * A wrapper for a window to be used with Subscriber/Publisher classes to send messages.\n */\nexport default class WindowChannel {\n\t/**\n\t * Creates a new channel based off a window object.\n\t * @param {Window} win The window to use for communication (pub/sub/both)\n\t * @constructor\n\t */\n\tconstructor(win) {\n\t\tif (typeof win === 'undefined' || !win) {\n\t\t\tthrow 'WindowChannel: Constructor requires a valid window argument';\n\t\t}\n\n\t\t// Generate id to discern separate instances of WindowChannel\n\t\tthis.win = win;\n\t\tthis.id = Math.random().toString();\n\n\t\tthis.active = false;\n\t\tthis.ready = false;\n\t\tthis.readyCallbacks = [];\n\n\t\t// Bind this._receive so it can be added and removed as a listener easily\n\t\tthis.listeners = [];\n\t\tthis._receive = this._receive.bind(this);\n\t}\n\n\t/**\n\t * Initialize this WindowChannel to be used for all communications.\n\t * This method needs to be called before receiving or publishing any messages.\n\t * @param {function} readyCallback Callback to notify once the channel is ready\n\t */\n\tinit(readyCallback) {\n\t\t// If readyCallback is supplied, then we verify it\n\t\tif (readyCallback) {\n\t\t\tif (typeof readyCallback !== 'function') {\n\t\t\t\tconsole.error('WindowChannel: init() must be undefined or called with a valid function');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If ready, call immediately. Otherwise, add to list of callbacks\n\t\t\tif (this.isReady()) {\n\t\t\t\treadyCallback();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.readyCallbacks.push(readyCallback);\n\t\t\t}\n\t\t}\n\n\t\t// Already initialized\n\t\tif (this.active) {\n\t\t\treturn;\n\t\t}\n\t\tthis.active = true;\n\t\ttry {\n\t\t\tthis.win.addEventListener('message', this._receive);\n\t\t}\n\t\tcatch (e) {}\n\t}\n\n\t/**\n\t * Returns true if the channel is active and able to be used.\n\t * @returns {boolean} True if channel is active\n\t */\n\tisActive() {\n\t\treturn this.active && !this.win.closed;\n\t}\n\n\t/**\n\t * Returns true if the channel is ready to send messages.\n\t * @returns {boolean} True if ready\n\t */\n\tisReady() {\n\t\treturn this.isActive() && this.ready;\n\t}\n\n\t/**\n\t * Mark this window as ready to send messages. Must be called from external source,\n\t * since messages (e.g. ready messages) must pass through separate windows.\n\t * This method is not part of the channel interface, and is window-specific.\n\t */\n\tmarkReady() {\n\t\tthis.ready = true;\n\t\tthis.readyCallbacks.forEach(cb => cb());\n\t\tthis.readyCallbacks = [];\n\t}\n\n\t/**\n\t * Adds a callback to listen for received messages.\n\t * Should have the following signature: callback(message)\n\t * @param {function} callback The callback to add\n\t */\n\taddListener(callback) {\n\t\tif (typeof callback !== 'function') {\n\t\t\tconsole.error('WindowChannel: addListener() must be called with a valid function');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.listeners.push(callback);\n\t}\n\n\t/**\n\t * Removes a previously set listener, that must be exactly the same as the one added.\n\t * @param {function} callback The listener to remove\n\t */\n\tremoveListener(callback) {\n\t\tconst loc = this.listeners.indexOf(callback);\n\t\tif (loc < 0) {\n\t\t\tconsole.error('WindowChannel: removeListener() must be called with a function previously set using addListener()');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.listeners.splice(loc, 1);\n\t}\n\n\t/**\n\t * Sends a message through the channel.\n\t * @param {Object} message The message to send\n\t */\n\tsend(message) {\n\t\tif (!message) {\n\t\t\tconsole.error('WindowChannel: send() must be called with a valid message object');\n\t\t\treturn;\n\t\t}\n\n\t\tconst msg = Object.assign({}, message);\n\t\tconst origin = this._getTargetOrigin();\n\n\t\t// Add our id to end of tag to identify ourselves\n\t\tmsg.tag += '__' + this.id;\n\t\tthis.win.postMessage(JSON.stringify(msg), origin);\n\t}\n\n\t/**\n\t * Shuts down this channel and cleans up.\n\t */\n\tshutdown() {\n\t\tthis.active = false;\n\t\tthis.ready = false;\n\t\tthis.readyCallbacks = [];\n\t\tthis.listeners = [];\n\t\ttry {\n\t\t\tthis.win.removeEventListener('message', this._receive);\n\t\t}\n\t\tcatch (e) {}\n\t}\n\n\t/**\n\t * Callback when message is received (run before user defined listener).\n\t * First checks origin and syn/ack, since its window specific.\n\t * @param {MessageEvent} messageEvent The event given by window callback\n\t * @private\n\t */\n\t_receive(messageEvent) {\n\t\t// Make sure message is valid and from secure source\n\t\tif (!this._isValidSourceOrigin(messageEvent.origin)) {\n\t\t\tconsole.warn(`WindowChannel: Received message from unknown source origin (${messageEvent.origin})!`);\n\t\t\treturn;\n\t\t}\n\t\tif (!messageEvent || !messageEvent.data) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If tag ends with our id, then we sent the message, so ignore\n\t\tconst message = JSON.parse(messageEvent.data);\n\t\tif (!message.tag || message.tag.endsWith(this.id)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Revert tag to user-defined tag\n\t\tmessage.source = messageEvent.source;\n\t\tmessage.tag = message.tag.replace(/__[0-9.]+$/, '');\n\t\tthis.listeners.forEach(cb => cb(message));\n\t}\n\n\t/**\n\t * Gets the target origin to use for WindowChannel.\n\t * Should target the current org, and work in Aloha or Lightning.\n\t * @returns {string} The target origin\n\t * @private\n\t */\n\t_getTargetOrigin() {\n\t\t// TODO Specify origin so log goes to a trusted target, and within same org\n\t\t// Should work across Aloha-Lightning\n\t\t// return this.win.origin // Doesn't work\n\t\treturn '*';\n\t}\n\n\t/**\n\t * Checks if the given source origin is valid for WindowChannel.\n\t * We should only allow messages from known sources (aka the org), and can be from either\n\t * Aloha or Lightning url.\n\t * @param {string} sourceOrigin The origin to check for validity\n\t * @returns {boolean} True if the source is trusted\n\t * @private\n\t */\n\t_isValidSourceOrigin(sourceOrigin) {\n\t\t// TODO Verify origin to check if log is from trusted source, and within same org\n\t\t// Should work across Aloha-Lightning\n\t\t// return sourceOrigin === this.win.origin // Doesn't work\n\t\treturn true;\n\t}\n}\n","import QuoteLogger from './QuoteLogger.js';\nimport WindowChannel from './WindowChannel.js';\n\n// Add QuoteLogger to window object so it can be exported as a standalone script\nif (typeof window !== 'undefined' && window) {\n\twindow.sb = window.sb || {};\n\twindow.sb.QuoteLogger = QuoteLogger;\n\twindow.sb.WindowChannel = WindowChannel;\n}\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n *\n * Quote level context\n *\n * @author kzheng\n * @since 212\n *\n */\n\nlet constants = null;\n\nexport class QuoteContext {\n\n\t/**\n\t * @returns Quote relevant constants, see quotes/models/Constants.js\n\t */\n\tstatic get constants() {\n\t\treturn constants;\n\t}\n\n\tstatic set constants(value) {\n\t\tconstants = value;\n\t}\n\n\t/**\n\t * Check if a field is a discount field by matching it against the ADDITIONAL DISCOUNT FIELD name\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isDiscountField(field) {\n\t\treturn field === constants.ADDITIONAL_DISCOUNT_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is a markup field\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isMarkupField(field) {\n\t\treturn field === constants.MARKUP_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is list price\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isListPriceField(field) {\n\t\treturn field === constants.LIST_PRICE_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is product name\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isProductNameField(field) {\n\t\treturn field === constants.PRODUCT_NAME_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is net total field\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isNetTotalField(field) {\n\t\treturn field === constants.NET_TOTAL_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is subscription scope field\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isSubscriptionScopeField(field) {\n\t\treturn field === constants.SUBSCRIPTION_SCOPE_FIELD;\n\t}\n\n\t/**\n\t * Check if a given UBP field is inline editable\n\t * @param field\n\t * @param fieldEditability map of field's editability\n\t */\n\tstatic isUbpFieldInlineEditable(field, fieldEditability) {\n\t\tconst FIELDS = constants.UBP_FIELDS.ConsumptionRateFields;\n\t\tfor (const f of [FIELDS.UpperBound, FIELDS.LowerBound, FIELDS.Price]) {\n\t\t\tif (f === field) {\n\t\t\t\treturn fieldEditability != null && fieldEditability[field];\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}","'use strict';\n\nSystem.register('quotes/quotes.js', ['quotes/pages/sb-line-editor/LineEditor.js', 'quotes/pages/sf-ubp-editor/UBPEditor.js', 'quotes/sb-le-custom-action-services/LECustomActionServices.js', 'quotes/md/sb-le-field-md/LEFieldMD.js', 'quotes/layout/sb-le-group/LEGroup.js', 'quotes/layout/sf-preview-panel/PreviewPanel.js', 'quotes/tables/sf-standard-table/SFStandardTable.js', 'quotes/tables/sf-segmented-table/SFSegmentedTable.js', 'quotes/tables/ubp-rate-table/UBPRateTable.js', 'quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js', 'quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js', 'quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js', 'quotes/layout/sf-table-header/SFTableHeader.js', 'quotes/layout/sf-le-table-header/SFLETableHeader.js', 'quotes/layout/sf-le-table-row/SFLETableRow.js', 'quotes/layout/sf-line-actions/SFLineActions.js', 'quotes/layout/sf-line-warning/SFLineWarning.js', 'quotes/layout/sb-le-table-cell/LETableCell.js', 'quotes/layout/sb-ds-table-cell/DSTableCell.js', 'quotes/layout/sb-ds-tiers/DSTiers.js', 'quotes/layout/sb-le-table-header/LETableHeader.js', 'quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js', 'quotes/layout/sb-le-footer/LEFooter.js', 'quotes/layout/sb-le-group-layout/LEGroupLayout.js', 'quotes/layout/sb-le-list/LEList.js', 'quotes/layout/sb-le-list-row/LEListRow.js', 'quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js', 'quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js', 'quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js', 'quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js', 'quotes/layout/sb-field-set-table-item/FieldSetTableItem.js', 'quotes/layout/sb-field-set-table/FieldSetTable.js', 'quotes/layout/sb-le-drawer/LEDrawer.js', 'quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js', 'quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js', 'quotes/layout/sb-custom-action/CustomAction.js', 'quotes/layout/sb-le-summary-row/LESummaryRow.js', 'quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js', 'quotes/layout/ubp-rate-row/UBPRateRow.js', 'quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js', 'quotes/dialogs/sb-pricing-guidance-dialog/PricingGuidanceDialog.js', 'quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js', 'quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js', 'quotes/layout/sb-cse-table-cell/CSETableCell.js', 'quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js', 'quotes/models/DragDropModel.js', 'quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js', 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js', 'quotes/consumption-rate-validator/ConsumptionRateValidator.js'], function (_export, _context) {\n  return {\n    setters: [function (_quotesPagesSbLineEditorLineEditorJs) {}, function (_quotesPagesSfUbpEditorUBPEditorJs) {}, function (_quotesSbLeCustomActionServicesLECustomActionServicesJs) {}, function (_quotesMdSbLeFieldMdLEFieldMDJs) {}, function (_quotesLayoutSbLeGroupLEGroupJs) {}, function (_quotesLayoutSfPreviewPanelPreviewPanelJs) {}, function (_quotesTablesSfStandardTableSFStandardTableJs) {}, function (_quotesTablesSfSegmentedTableSFSegmentedTableJs) {}, function (_quotesTablesUbpRateTableUBPRateTableJs) {}, function (_quotesLayoutSfSegmentedCellTooltipSFSegmentedCellTooltipJs) {}, function (_quotesLayoutSbSegmentedLineDetailsSegmentedLineDetailsJs) {}, function (_quotesLayoutSbSegmentedDetailRowSegmentedDetailRowJs) {}, function (_quotesLayoutSfTableHeaderSFTableHeaderJs) {}, function (_quotesLayoutSfLeTableHeaderSFLETableHeaderJs) {}, function (_quotesLayoutSfLeTableRowSFLETableRowJs) {}, function (_quotesLayoutSfLineActionsSFLineActionsJs) {}, function (_quotesLayoutSfLineWarningSFLineWarningJs) {}, function (_quotesLayoutSbLeTableCellLETableCellJs) {}, function (_quotesLayoutSbDsTableCellDSTableCellJs) {}, function (_quotesLayoutSbDsTiersDSTiersJs) {}, function (_quotesLayoutSbLeTableHeaderLETableHeaderJs) {}, function (_quotesLayoutSbLeTableHeaderCellLETableHeaderCellJs) {}, function (_quotesLayoutSbLeFooterLEFooterJs) {}, function (_quotesLayoutSbLeGroupLayoutLEGroupLayoutJs) {}, function (_quotesLayoutSbLeListLEListJs) {}, function (_quotesLayoutSbLeListRowLEListRowJs) {}, function (_quotesLayoutSbLeListGroupHeaderRowLEListGroupHeaderRowJs) {}, function (_quotesLayoutSbLeListGroupFooterRowLEListGroupFooterRowJs) {}, function (_quotesLayoutSbLeListStandardLineRowLEListStandardLineRowJs) {}, function (_quotesLayoutSbLeListSegmentedLineRowLEListSegmentedLineRowJs) {}, function (_quotesLayoutSbFieldSetTableItemFieldSetTableItemJs) {}, function (_quotesLayoutSbFieldSetTableFieldSetTableJs) {}, function (_quotesLayoutSbLeDrawerLEDrawerJs) {}, function (_quotesLayoutSbLineEditorTabsSbQuoteTabsQuoteTabsJs) {}, function (_quotesLayoutSbLineEditorTabsSbGroupTabsGroupTabsJs) {}, function (_quotesLayoutSbCustomActionCustomActionJs) {}, function (_quotesLayoutSbLeSummaryRowLESummaryRowJs) {}, function (_quotesLayoutSbLeSummaryRowSbLeSummaryCellLESummaryCellJs) {}, function (_quotesLayoutUbpRateRowUBPRateRowJs) {}, function (_quotesDialogsSbFavoriteDialogFavoriteDialogJs) {}, function (_quotesDialogsSbPricingGuidanceDialogPricingGuidanceDialogJs) {}, function (_quotesDialogsSbCloneToGroupDialogCloneToGroupDialogJs) {}, function (_quotesDialogsSbCustomSegmentDialogCustomSegmentDialogJs) {}, function (_quotesLayoutSbCseTableCellCSETableCellJs) {}, function (_quotesDialogsSbPricebookDialogPricebookDialogJs) {}, function (_quotesModelsDragDropModelJs) {}, function (_quotesDialogsSbDiscountScheduleDialogDiscountScheduleDialogJs) {}, function (_quotesUsageBasedPricingDaoUsageBasedPricingDaoJs) {}, function (_quotesConsumptionRateValidatorConsumptionRateValidatorJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJxdW90ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/quote';\nexport const ROUTES = {\n\t'/le': { comp: 'sb-line-editor', mod: 'quotes/pages/sb-line-editor/LineEditor.js' }\n}\n","\"use strict\";\n\nSystem.register(\"subscriptions/subscriptions.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzdWJzY3JpcHRpb25zLmpzIiwic291cmNlc0NvbnRlbnQiOltdfQ==","export const PREFIX = '/subscription';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-subscription-lookup', mod: 'subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js'}\n};","/**\n * Created by jfeingold on 8/11/17.\n *\n * Contains definitions for the base classes of all SubqueryDescriptors and all DAOs.\n */\nlet jsLogger = require('js-logger').logger.getLogger('JSAR Perf');\nlet WhereClauseSplitter = require('./WhereClauseSplitter.js');\n\nclass BaseSubqueryDescriptor {\n\t/**\n\t * Classes that extend BaseSubqueryDescriptor require an implementation of addSubqueriesToQuery() in order to\n\t * construct a query that includes the described subqueries.\n\t * @abstract\n\t * @param query\n\t */\n\taddSubqueriesToQuery(query) {\n\t\tthrow Error('Error: BaseSubqueryDescriptor.addSubqueriesToQuery() should be overridden by child classes and never invoked directly.');\n\t}\n}\n\n\n\nclass BaseDAO {\n\tconstructor(conn, labels) {\n\t\tthis._conn = conn;\n\t\tthis._labels = labels;\n\t\t// The length limit on query strings is 20,000 characters. However, SFDC does some rearranging of queries under\n\t\t// the hood, which can increase their length. Additionally, we might be dealing with subqueries whose lengths\n\t\t// can't be as easily determined. As such, we'll use 15,000 as our limit to leave a bit of leeway in case we need it.\n\t\tthis._QUERY_LENGTH_LIMIT = 15000;\n\t\t// The limit on how long a WHERE clause can be in SOQL is 4,000 characters. Again, to leave wiggle room, we'll\n\t\t// use 3,800 as our internal limit.\n\t\tthis._WHERE_CLAUSE_LENGTH_LIMIT = 3800;\n\t\tthis._logger = jsLogger;\n\t}\n\n\t_logMessage(msg) {\n\t\tthis._logger.info(msg);\n\t}\n\n\t_logWarning(msg) {\n\t\tthis._logger.warn(msg);\n\t}\n\n\t_constructSelectClauseAndCalculateRemainingLength(selectedFields) {\n\t\t// Before we do anything, make sure that every field in the selectedFields list is unique.\n\t\tlet uniqueSelectedFields = [...new Set(selectedFields)];\n\n\t\tlet totalQueryLength = 0;\n\t\tlet selectClause = uniqueSelectedFields.join(', ');\n\t\ttotalQueryLength += selectClause.length;\n\t\tlet charsUntilLimitReached = this._QUERY_LENGTH_LIMIT - totalQueryLength;\n\t\tif (charsUntilLimitReached < 18) {\n\t\t\tthrow Error('SELECT clause length exceeded safe threshold of 15,000 characters.');\n\t\t}\n\t\t// Calculate how long our WHERE clauses can potentially be.\n\t\tlet maxLengthForWhereClause = charsUntilLimitReached < this._WHERE_CLAUSE_LENGTH_LIMIT ? charsUntilLimitReached : this._WHERE_CLAUSE_LENGTH_LIMIT;\n\t\treturn {\n\t\t\tselectClause: selectClause,\n\t\t\tmaxWhereLength: maxLengthForWhereClause\n\t\t};\n\t}\n\n\t/**\n\t * Method common to all DAOs, accepts information about a query to be performed, and then constructs and performs\n\t * that query. If the WHERE clause exceeds the permitted length, it is implicitly split into multiple queries, and\n\t * the results are recombined.\n\t * @param {String} objectType - A Salesforce SObject Type.\n\t * @param {Array.<String>} selectedFields - An array of fields that should be queried on this SObject.\n\t * @param {String} fullWhereClause - A SOQL WHERE clause, e.g., \"Name = 'QL-00023'\".\n\t * @param {BaseSubqueryDescriptor} [subqueryDescriptor] - A class describing information about the subqueries to be\n\t * included in this query.\n\t * @param {Array.<String>} [orderbyArray] - A length-2 array where the first entry is a field's API name, and the second is 'ASC' or 'DESC'.\n\t * @returns {Promise.<Array.<JSON>|String>}\n\t * @protected\n\t */\n\t_constructAndPerformQuery(objectType, selectedFields, fullWhereClause, subqueryDescriptor, orderbyArray) {\n\t\t// First, create our SELECT clause.\n\t\tlet selectDescriptor = this._constructSelectClauseAndCalculateRemainingLength(selectedFields);\n\t\tlet selectClause = selectDescriptor.selectClause;\n\t\t// Next, create our WHERE clause array, and check whether we've preserved the query's result set.\n\t\tlet whereSplitDescriptor = new WhereClauseSplitter().splitWhereClause(fullWhereClause, selectDescriptor.maxWhereLength);\n\t\tlet partialWhereClauses = whereSplitDescriptor.clauses;\n\t\tlet querySpecificityPreserved = whereSplitDescriptor.specificityPreserved;\n\n\t\t// Now we generate our queries and wait for them to resolve.\n\t\tlet queryPromises = [];\n\n\t\tpartialWhereClauses.forEach((partialWhereClause) => {\n\t\t\tlet query = this._conn.sobject(objectType)\n\t\t\t\t.select(selectClause)\n\t\t\t\t.where(partialWhereClause);\n\t\t\t// If there's a subquery, add that to the query.\n\t\t\tif (subqueryDescriptor) {\n\t\t\t\tsubqueryDescriptor.addSubqueriesToQuery(query);\n\t\t\t}\n\t\t\t// If there's an Order By array, apply that too.\n\t\t\tif (orderbyArray) {\n\t\t\t\tquery.orderby(orderbyArray[0], orderbyArray[1]);\n\t\t\t}\n\t\t\t// Execute the query and add it to the promise array.\n\t\t\t// By default, JSForce queries only return a maximum of 2,000 records. Passing this object into .execute()\n\t\t\t// lets us override that limit. AutoFetch indicates that we want to be able to return more than 2,000 records,\n\t\t\t// and setting MaxFetch to infinity lets us return infinite records instead of the implicit limit of 10,000.\n\t\t\tqueryPromises.push(query.execute({autoFetch: true, maxFetch: Number.POSITIVE_INFINITY}));\n\t\t});\n\n\t\treturn Promise.all(queryPromises)\n\t\t\t.then((queryResultsArrays) => {\n\t\t\t\treturn this._reconcileQueryResultsWithWhereClauses(queryResultsArrays, whereSplitDescriptor);\n\t\t\t}, (err) => {\n\t\t\t\treturn this._simplifyAndRethrowQueryError(err);\n\t\t\t});\n\t}\n\n\t/**\n\t * If a query failed, it's probably because of some really weird and arcane reason, and the error messages provided\n\t * by the API aren't particularly clear on what exactly went wrong or how to fix it. So this message accepts an error\n\t * that was thrown by the query callout, then tries to determine what ultimately went wrong so it can convert the\n\t * original error message into something a little cleaner.\n\t * @param {Error|String} err - An Error object, or perhaps just its message.\n\t * @throws Always throws an exception. If it can't simplify the given message, it just rethrows it unchanged.\n\t * @private\n\t */\n\t_simplifyAndRethrowQueryError(err) {\n\t\t// If a query fails, chances are it's because of a permissions error or a typo in field names. These\n\t\t// errors tend to be multiple lines long and unhelpful, so we'll intercept errors that match the pattern\n\t\t// and condense them down into a more concise and informative message.\n\t\tlet fullMsg = err.message || err;\n\n\t\t// Errors of this type tend to fit several criteria:\n\t\t// 1. They're five lines long, separated by newline characters (\\n). The first line is just a newline character.\n\t\t// 2. The second line is an excerpt from the failed query, and the third line is a carat (^) offset by a\n\t\t//    number of spaces so it hangs underneath the offending field name.\n\t\t// 3. The fourth starts with 'ERROR at'.\n\t\t// 4. The fifth line starts with \"No such column 'FIELDNAME' on entity 'OBJECTNAME', ...\" then continues\n\t\t//    at length about WSDLs and describe calls.\n\t\t//\n\t\t// First, we'll see if the error matches these criteria. Break it out into individual lines, make sure\n\t\t// there are five lines, then check that they match the pattern.\n\t\tlet msgLines = fullMsg.split('\\n');\n\t\tif (msgLines.length === 5) {\n\t\t\t// .split('\\n') will yield an empty string in the first position if the string starts with \\n.\n\t\t\tlet firstLineEmpty = msgLines[0] === '';\n\t\t\t// We'll use a regular expression that matches a string starting with zero or more whitespace characters\n\t\t\t// and ending with a single carat to see whether the third line matches our pattern.\n\t\t\tlet thirdLineIsCaratAndWhitespace = /^\\s*\\^$/g.test(msgLines[2]);\n\t\t\tlet fourthLineFitsPattern = msgLines[3].startsWith('ERROR at Row');\n\t\t\tlet fifthLineFitsPattern = msgLines[4].startsWith('No such column \\'');\n\t\t\tif (firstLineEmpty && thirdLineIsCaratAndWhitespace && fourthLineFitsPattern && fifthLineFitsPattern) {\n\t\t\t\t// If the error message matches the pattern, then we'll want to pull the field and object names\n\t\t\t\t// from the final line.\n\t\t\t\tlet extractor = /No such column '(\\w+)' on entity '(\\w+)'./g;\n\n\t\t\t\tlet matches = extractor.exec(msgLines[4]);\n\t\t\t\tif (matches && matches[1] && matches[2]) {\n\t\t\t\t\tlet errTemplate = this._labels.msg_missing_perm;\n\t\t\t\t\tthrow new Error(errTemplate.replace('{0}', matches[1]).replace('{1}', matches[2]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// If we weren't able to extract an error, so just return what we have.\n\t\tthrow new Error(fullMsg);\n\t}\n\n\t_reconcileQueryResultsWithWhereClauses(queryResultArrays, whereClauseDescriptors) {\n\t\t/// If our queries preserved the specificity of the original query, then we should just make sure we don't\n\t\t// include the same record multiple times.\n\t\tif (whereClauseDescriptors.specificityPreserved) {\n\t\t\tlet results = [];\n\t\t\tlet idSet = new Set();\n\t\t\tqueryResultArrays.forEach((queryResults) => {\n\t\t\t\tqueryResults.forEach((record) => {\n\t\t\t\t\tif (!idSet.has(record.Id)) {\n\t\t\t\t\t\tresults.push(record);\n\t\t\t\t\t\tidSet.add(record.Id);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t\treturn results;\n\t\t} else {\n\t\t\t// If our queries didn't preserve the specificity of the original query, we need to do some logic to figure\n\t\t\t// out which records we actually want.\n\t\t\tlet idx = 0;\n\t\t\t// At the start, our final result set should just be the initial result set, since we'll be combining the lists\n\t\t\t// gradually as we go.\n\t\t\tlet currentCombinedResults = queryResultArrays;\n\t\t\tlet currentKeyLists = whereClauseDescriptors.splitKeyLists;\n\t\t\tlet keysByDepth = whereClauseDescriptors.splitKeysMappedByMaxDepth;\n\t\t\t// Our methodology here is to iterate over all depths in ascending order. At each depth, we'll create new\n\t\t\t// versions of the combinedQueryResults array and the keyLists array to represent the combinations we\n\t\t\t// performed at this depth.\n\t\t\twhile (idx < keysByDepth.size) {\n\t\t\t\tlet newCombinedResults = [];\n\t\t\t\tlet newKeyLists = [];\n\t\t\t\t// We want to find all of the keys whose max depth is found at this index.\n\t\t\t\tlet keysToSeek = keysByDepth.get(idx);\n\n\t\t\t\t// We're going to iterate over the current version of the key lists to populate the following maps.\n\t\t\t\t// The first is a map from each key we intend to combine to the 'primary' index of that key.\n\t\t\t\tlet primaryIndexesBySplitKey = new Map();\n\t\t\t\t// The second maps from primary indexes of combined keys to objects with a splitKey property containing the key\n\t\t\t\t// and a secondaryIdxs property containing all the other indexes with which the primary index combines.\n\t\t\t\t// It maps indexes with keys we're not combining yet to null.\n\t\t\t\tlet combinationInfoByPrimaryIndex = new Map();\n\t\t\t\tcurrentKeyLists.forEach((keyList, listIdx) => {\n\t\t\t\t\t// We want the key at the start of the list, since that's the next combination we'll have to do.\n\t\t\t\t\tlet splitKey = keyList[0];\n\t\t\t\t\t// If the key is one we're looking for, and we don't have a primary index yet, this is the primary index.\n\t\t\t\t\tif (keysToSeek.has(splitKey) && !primaryIndexesBySplitKey.has(splitKey)) {\n\t\t\t\t\t\tprimaryIndexesBySplitKey.set(splitKey, listIdx);\n\t\t\t\t\t\tcombinationInfoByPrimaryIndex.set(listIdx, {splitKey: splitKey, secondaryIdxs: []});\n\t\t\t\t\t} else if (keysToSeek.has(splitKey)) {\n\t\t\t\t\t\t// If the key's one we're looking for, but we have a primary key already, add the secondary key.\n\t\t\t\t\t\tlet primaryIndex = primaryIndexesBySplitKey.get(splitKey);\n\t\t\t\t\t\tcombinationInfoByPrimaryIndex.get(primaryIndex).secondaryIdxs.push(listIdx);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Otherwise, it's not one we care about, so we map null.\n\t\t\t\t\t\tcombinationInfoByPrimaryIndex.set(listIdx, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Now that we've fully populated the maps, we can use them to perform this round of combination on the\n\t\t\t\t// query results and their associated key lists.\n\t\t\t\tcombinationInfoByPrimaryIndex.forEach((combInfo, primaryIdx) => {\n\t\t\t\t\t// If there's no combination information, just add the results and key list directly to the new versions.\n\t\t\t\t\tif (combInfo == null) {\n\t\t\t\t\t\tnewCombinedResults.push(currentCombinedResults[primaryIdx]);\n\t\t\t\t\t\tnewKeyLists.push(currentKeyLists[primaryIdx]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet splitKey = combInfo.splitKey;\n\t\t\t\t\t\tlet primaryResults = currentCombinedResults[primaryIdx];\n\t\t\t\t\t\tlet secondaryResults = combInfo.secondaryIdxs.map((idx) => {return currentCombinedResults[idx];});\n\t\t\t\t\t\tlet idSet = new Set();\n\t\t\t\t\t\tlet combinedResults = [];\n\t\t\t\t\t\tif (splitKey.startsWith(\"AND\")) {\n\t\t\t\t\t\t\t// If the key is an \"AND\" key, we need to keep only the intersection of the primary and secondary\n\t\t\t\t\t\t\t// result lists, i.e. only the records that appear in both.\n\t\t\t\t\t\t\t// So we iterate over all of the secondary lists to get IDs common to those lists,\n\t\t\t\t\t\t\t// then we iterate over the primary list and take only records with those IDs.\n\t\t\t\t\t\t\tsecondaryResults.forEach((resultList, i) => {\n\t\t\t\t\t\t\t\tlet tmpIdSet = new Set();\n\t\t\t\t\t\t\t\tresultList.forEach((record) => {\n\t\t\t\t\t\t\t\t\t// Check if i is 0, because otherwise we'll completely ignore the first list.\n\t\t\t\t\t\t\t\t\tif (idSet.has(record.Id) || i === 0) {\n\t\t\t\t\t\t\t\t\t\ttmpIdSet.add(record.Id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tidSet = tmpIdSet;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tprimaryResults.forEach((record) => {\n\t\t\t\t\t\t\t\tif (idSet.has(record.Id)) {\n\t\t\t\t\t\t\t\t\tcombinedResults.push(record);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If the key is an \"OR\" or \"IN\" key, we need to keep the union of the result lists, i.e.\n\t\t\t\t\t\t\t// keep all records from all lists.\n\t\t\t\t\t\t\t// So we iterate over all the lists, and add every record to the results unless we've already\n\t\t\t\t\t\t\t// added it.\n\t\t\t\t\t\t\tlet resultLists = [primaryResults, ...secondaryResults];\n\t\t\t\t\t\t\tresultLists.forEach((resultList) => {\n\t\t\t\t\t\t\t\tresultList.forEach((record) => {\n\t\t\t\t\t\t\t\t\tif (!idSet.has(record.Id)) {\n\t\t\t\t\t\t\t\t\t\tcombinedResults.push(record);\n\t\t\t\t\t\t\t\t\t\tidSet.add(record.Id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnewCombinedResults.push(combinedResults);\n\t\t\t\t\t\t// Remove the first split key from the list, since it's been handled now.\n\t\t\t\t\t\tnewKeyLists.push(currentKeyLists[primaryIdx].slice(1));\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t\t\tcurrentCombinedResults = newCombinedResults;\n\t\t\t\tcurrentKeyLists = newKeyLists;\n\t\t\t\t// Increment the index and repeat.\n\t\t\t\tidx += 1;\n\t\t\t}\n\t\t\treturn currentCombinedResults[0];\n\t\t}\n\t}\n}\n\n\nmodule.exports.BaseSubqueryDescriptor = BaseSubqueryDescriptor;\nmodule.exports.BaseDAO = BaseDAO;","/**\n * Created by jfeingold on 6/7/17.\n *\n * A series of helper methods commonly used by DAOs.\n */\n\n'use strict'\n\n/**\n * Applies the provided prefix to all custom fields in the provided list.\n * e.g. 'StartDate__c' will be prefixed, but 'StartDate' will not.\n * @param {String} prefix - The package prefix for the given set of fields. Either an empty string or the appropriate org prefix.\n * @param {Array.<String>} fieldList - A list of unprefixed API field names.\n * @returns {Array.<String>}\n */\nmodule.exports.properlyPrefixFields = function(prefix, fieldList) {\n\t// For every field in the list, if it ends in '__c', it's a custom field and should be prefixed. Otherwise it's\n\t// standard and shouldn't be prefixed.\n\treturn fieldList.map((field) => {return field.endsWith('__c') ? prefix + field : field;});\n};","/**\n * Created by jfeingold on 6/2/17.\n *\n * Exports classes necessary to load product records and their related records. Currently, will only be used for amendments\n * and renewals, and as such only capable of including the Costs__r and PricebookEntries related records.\n * However, it's written such that it can be easily extended to include whatever other related records could be needed in the future\n * if we want to use it more broadly.\n */\n\n'use strict';\n\nlet IdToValueCache = require('../IdToValueCache.js');\nlet DAOHelperMethods = require('./DAOHelperMethods.js');\nlet BaseDAO = require('./BaseDAO.js').BaseDAO;\nlet BaseSubqueryDescriptor = require('./BaseDAO.js').BaseSubqueryDescriptor;\nlet jsLogger = require('js-logger').logger.getLogger('JSAR Perf');\nlet cacheManager = require('../CacheManager.js').cacheManager;\n\n/**\n * The unprefixed API names of all fields on the Product2 record that must be queried.\n * @type {Array.<String>}\n */\nlet PRODUCT_FIELDS = [\n\t// These fields are needed for JSAR.\n\t'Id',\n\t'BatchQuantity__c',\n\t'PriceEditable__c',\n\t'CostEditable__c',\n\t'PricingMethodEditable__c',\n\t'PricingMethod__c',\n\t'NonDiscountable__c',\n\t'NonPartnerDiscountable__c',\n\t'CompoundDiscountRate__c',\n\t'HasConfigurationAttributes__c',\n\t'ReconfigurationDisabled__c',\n\t'DescriptionLocked__c',\n\t'ConfigurationType__c',\n\t'ConfigurationEvent__c',\n\t'QuantityEditable__c',\n\t'QuantityScale__c',\n\t'AssetAmendmentBehavior__c',\n\t'Optional__c',\n\t'Hidden__c',\n\t'Taxable__c',\n\t'SubscriptionPricing__c',\n\t'SubscriptionPercent__c',\n\t'SubscriptionTerm__c',\n\t'SubscriptionBase__c',\n\t'SubscriptionCategory__c',\n\t'TaxCode__c',\n\t'SubscriptionTarget__c',\n\t'ExcludeFromOpportunity__c',\n\t'SubscriptionType__c',\n\t'DynamicPricingConstraint__c',\n\t// These fields are needed for JSQC.\n\t'BlockPricingField__c',\n\t'IncludeInMaintenance__c',\n\t'ExcludeFromMaintenance__c',\n\t'CostSchedule__c',\n\t'TermDiscountLevel__c'\n];\n\n/**\n * Unprefixed API names for all fields on the PricebookEntry object that must be queried.\n * @type {Array.<String>}\n */\nlet PRICEBOOK_ENTRY_FIELDS = [\n\t'Id',\n\t'Pricebook2Id',\n\t'UnitPrice',\n\t'IsActive'\n];\n\n/**\n * Unprefixed API names for all fields on the Cost__c object that must be queried.\n * @type {Array.<String>}\n */\nlet COST_FIELDS = [\n\t'UnitCost__c',\n\t'Active__c',\n\t'Product__c'\n];\n\n/**\n * Unprefixed API names for all fields on the ProductOption__c object that must be queried.\n * @type {string[]}\n */\nlet OPTION_FIELDS = [\n\t'Id',\n\t'UnitPrice__c'\n];\n\n/**\n * Unprefixed API names for all fields on the Dimension__c object that must be queried.\n * @type {string[]}\n */\nlet DIMENSION_FIELDS = [\n\t'Id',\n\t'Type__c',\n\t'PriceBook__c',\n\t'UnitPrice__c'\n];\n\nlet BLOCKPRICE_FIELDS = [\n\t'Id',\n\t'PriceBook2__c',\n\t'LowerBound__c',\n\t'UpperBound__c',\n\t'Price__c'\n];\n\nconst CACHE_NAME = 'ProductCache';\n\n/**\n * Allows for a standardized description of subqueries on the Product record.\n * @class\n */\nclass ProductSubqueryDescriptor extends BaseSubqueryDescriptor {\n\tconstructor(opts) {\n\t\tsuper();\n\t\tthis._opts = opts;\n\t\tthis._salesCloudPrefix = this._opts.prefix;\n\t\tthis._includeCosts = false;\n\t\tthis._includePriceEntries = false;\n\t\tthis._includeDimensions = false;\n\t\tthis._includeBlockPrices = false;\n\t\tthis._filteredPricebooks = null;\n\t\tthis._filteredCurrencyCodes = null;\n\t\tthis._includeOptionsByOptionalSKU = false;\n\t\tthis._mappableOptionFields = null;\n\t\tthis._initialized = false;\n\t}\n\n\t/**\n\t * Indicates that the subquery descriptor should represent all subqueries required for JS Amend/Renew.\n\t */\n\tincludeJSARSubqueries() {\n\t\t// Since JSAR also invokes JSQC, we'll also want to include the JSQC subqueries.\n\t\tthis.includeJSQCSubqueries();\n\t\t// In addition, we'll also want Costs, Price Entries, Dimensions, and Options.\n\t\tthis._includeCosts = true;\n\t\tthis._includePriceEntries = true;\n\t\tthis._includeDimensions = true;\n\t\tthis._includeOptionsByOptionalSKU = true;\n\t}\n\n\t/**\n\t * Indicates that the subquery descriptor should represent all subqueries required for JS Quote Calculation.\n\t */\n\tincludeJSQCSubqueries() {\n\t\t// The JSQC requires that the block prices of each product be loaded.\n\t\tthis._includeBlockPrices = true;\n\t}\n\n\t/**\n\t * Adds the provided Pricebook IDs to the list used to filter records in subqueries.\n\t * @param {Array.<String>} pricebookIds - An array of strings corresponding to IDs of Pricebook records.\n\t */\n\taddPricebookFilters(pricebookIds) {\n\t\tlet existingFilters = this._filteredPricebooks || [];\n\t\tthis._filteredPricebooks = existingFilters.concat(pricebookIds);\n\t}\n\n\t/**\n\t * Adds the provided currency codes to the list used to filter records in subqueries. Only meaningful in MultiCurrency orgs.\n\t * @param {Array.<String>} currencyCodes - An array of CurrencyIsoCode strings, e.g. 'USD', 'EUR'.\n\t */\n\taddCurrencyFilters(currencyCodes) {\n\t\tlet existingFilters = this._filteredCurrencyCodes || [];\n\t\tthis._filteredCurrencyCodes = existingFilters.concat(currencyCodes);\n\t}\n\n\t/**\n\t * Performs any asynchronous initialization that needs to occur before this subquery descriptor can actually be used\n\t * in a query. More specifically, loads mappable fields.\n\t * @param {Object} services - A bundle of services.\n\t * @param {Object} services.fieldMetadataService - An instance of FieldMetadataService that can identify twin fields.\n\t * @returns {Promise} Resolves when the initialization is completed.\n\t */\n\tinit(services) {\n\t\t// If we're already initialized, no need to do anything.\n\t\tif (this._initialized) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\t// Otherwise, do the last bits of prep that are needed in order to make a query.\n\t\tlet initPromises = [];\n\t\tlet lineType = this._salesCloudPrefix + 'QuoteLine__c';\n\t\t// If we're including Product Options, we'll also need to determine which mappable fields need to be copied from\n\t\t// the Product Option to the Quote Line.\n\t\tif (this._includeOptionsByOptionalSKU) {\n\t\t\tlet optionType = this._salesCloudPrefix + 'ProductOption__c';\n\t\t\tinitPromises.push(services.fieldMetadataService.getSharedMappableFieldNames(optionType, lineType)\n\t\t\t\t.then((fields) => {\n\t\t\t\t\tthis._mappableOptionFields = fields;\n\t\t\t\t}));\n\t\t}\n\n\t\treturn Promise.all(initPromises)\n\t\t\t.then(() => {\n\t\t\t\tthis._initialized = true;\n\t\t\t});\n\t}\n\n\t/**\n\t * Inner method used for adding a single subquery to the provided query.\n\t * @param {Object} query - A JSForce Query object.\n\t * @param {String} relationship - The name of the Relationship to be queried.\n\t * @param {String[]} fields - The API names of the fields to query.\n\t * @param {String[]} [whereArray] - An array of strings to be ANDed together into a WHERE clause.\n\t * @param {String[]} [orderByArray] - An array used to create an ORDER BY clause.\n\t * @private\n\t */\n\t_addSubquery(query, relationship, fields, whereArray, orderByArray) {\n\t\tquery = query.include(relationship)\n\t\t\t.select(fields.join(', '));\n\t\t// If there's an ORDER BY clause, add that.\n\t\tif (orderByArray && orderByArray.length === 2) {\n\t\t\tquery = query.orderby(orderByArray[0], orderByArray[1]);\n\t\t}\n\t\t// If there's a where clause, add that.\n\t\tif (whereArray && whereArray.length > 0) {\n\t\t\tquery = query.where(whereArray.join(' AND '))\n\t\t}\n\t\tquery = query.end();\n\t}\n\n\t/**\n\t * Adds the subqueries represented by this object to the given SOQL query.\n\t * @param {Object} query - A JSForce Query object.\n\t * @override\n\t */\n\taddSubqueriesToQuery(query) {\n\t\t// Create the strings we'll use for filtered subqueries.\n\t\t// If we're calling this method on an uninitialized descriptor, we need to throw an error.\n\t\tif (!this._initialized) {\n\t\t\t// It's okay for the error message to be arcane and hardcoded, since this should never ever be seen by a customer.\n\t\t\tthrow new Error('Cannot call \\'addSubqueriesToQuery()\\' on an uninitialized ProductSubqueryDescriptor.');\n\t\t}\n\t\tlet pricebookString =\n\t\t\tthis._filteredPricebooks && this._filteredPricebooks.length > 0\n\t\t\t\t? \"'\" + this._filteredPricebooks.join(\"', '\") + \"'\"\n\t\t\t\t: null;\n\t\tlet currencyCodeString =\n\t\t\tthis._filteredCurrencyCodes && this._filteredCurrencyCodes.length > 0\n\t\t\t\t? \"'\" + this._filteredCurrencyCodes.join(\"', '\") + \"'\"\n\t\t\t\t: null;\n\n\t\t// Add the subqueries that aren't filtered.\n\t\tif (this._includeCosts) {\n\t\t\t// Costs are either included or they're not. We don't do filtering related to them. So just get the fields\n\t\t\t// and add them as a child query.\n\t\t\tlet costFields = DAOHelperMethods.properlyPrefixFields(this._salesCloudPrefix, COST_FIELDS);\n\t\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\t\tcostFields.push('CurrencyIsoCode');\n\t\t\t}\n\t\t\tthis._addSubquery(query, this._salesCloudPrefix + 'Costs__r', costFields);\n\t\t}\n\n\t\t// Add filtered subqueries.\n\t\tif (this._includeOptionsByOptionalSKU) {\n\t\t\tlet optionFields = DAOHelperMethods.properlyPrefixFields(this._salesCloudPrefix, OPTION_FIELDS);\n\t\t\toptionFields = optionFields.concat(this._mappableOptionFields || []);\n\t\t\tlet whereArray = [];\n\t\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\t\toptionFields.push('CurrencyIsoCode');\n\t\t\t\t// Product Options are only filtered by currency code, so only create a WHERE clause if multi-currency.\n\t\t\t\tif (currencyCodeString) {\n\t\t\t\t\twhereArray.push(`CurrencyIsoCode IN (${currencyCodeString})`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._addSubquery(query, this._salesCloudPrefix + 'OptionalFor__r', optionFields, whereArray);\n\t\t}\n\n\t\tif (this._includeDimensions) {\n\t\t\t// Get the fields for the SELECT clause of the Dimension subquery.\n\t\t\tlet dimensionFields = DAOHelperMethods.properlyPrefixFields(this._salesCloudPrefix, DIMENSION_FIELDS);\n\t\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\t\tdimensionFields.push('CurrencyIsoCode');\n\t\t\t}\n\n\t\t\t// Create the WHERE clause.\n\t\t\tlet whereArray = [];\n\t\t\t// If there are any filtered pricebooks, we only want dimensions with those pricebooks or a null pricebook field.\n\t\t\tif (pricebookString) {\n\t\t\t\twhereArray.push(`(${this._salesCloudPrefix}PriceBook__c IN (${pricebookString}) OR ${this._salesCloudPrefix}PriceBook__c = null)`);\n\t\t\t}\n\n\t\t\t// If there are any filtered currencies and we're in a multi-currency org, add those to the where clause too.\n\t\t\tif (currencyCodeString && this._opts.isMultiCurrencyOrg) {\n\t\t\t\twhereArray.push(`CurrencyIsoCode IN (${currencyCodeString})`);\n\t\t\t}\n\n\t\t\tthis._addSubquery(query, this._salesCloudPrefix + 'Dimensions__r', dimensionFields, whereArray);\n\t\t}\n\n\t\tif (this._includePriceEntries) {\n\t\t\t// Get the fields for the SELECT clause of our PricebookEntry related query.\n\t\t\tlet priceEntryFields = DAOHelperMethods.properlyPrefixFields(this._salesCloudPrefix, PRICEBOOK_ENTRY_FIELDS);\n\t\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\t\tpriceEntryFields.push('CurrencyIsoCode');\n\t\t\t}\n\t\t\t// Create our WHERE clause.\n\t\t\tlet whereArray = [];\n\n\t\t\t// If there are any filtered pricebooks, we only want entries that use that pricebook.\n\t\t\tif (pricebookString) {\n\t\t\t\twhereArray.push(`Pricebook2Id IN (${pricebookString})`);\n\t\t\t}\n\n\t\t\t// If there are any filtered currencies and we're in a multi-currency org, add those to the where clause too.\n\t\t\tif (currencyCodeString && this._opts.isMultiCurrencyOrg) {\n\t\t\t\twhereArray.push(`CurrencyIsoCode IN (${currencyCodeString})`);\n\t\t\t}\n\n\t\t\t// They can also be filtered by which ones are active, if the Package-Level Setting for InactivePricesUsed__c\n\t\t\t// is enabled.\n\t\t\tif (!this._opts.allowInactivePrices) {\n\t\t\t\twhereArray.push('IsActive = true');\n\t\t\t}\n\n\t\t\tthis._addSubquery(query, 'PricebookEntries', priceEntryFields, whereArray);\n\t\t}\n\n\t\tif (this._includeBlockPrices) {\n\t\t\t// Get the fields for the SELECT clause of the Block PRice subquery.\n\t\t\tlet blockPriceFields = DAOHelperMethods.properlyPrefixFields(this._salesCloudPrefix, BLOCKPRICE_FIELDS);\n\t\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\t\tblockPriceFields.push('CurrencyIsoCode');\n\t\t\t}\n\t\t\tif (this._opts.overageRateFieldName) {\n\t\t\t\tblockPriceFields.push(this._opts.overageRateFieldName);\n\t\t\t}\n\n\t\t\t// Create the WHERE clause.\n\t\t\tlet whereArray = [];\n\t\t\t// If there are any filtered pricebooks, we only want block prices with those pricebooks or a null pricebook field.\n\t\t\tif (pricebookString) {\n\t\t\t\twhereArray.push(`(${this._salesCloudPrefix}PriceBook2__c IN (${pricebookString}) OR ${this._salesCloudPrefix}PriceBook2__c = null)`);\n\t\t\t}\n\n\t\t\t// If there are any filtered currencies and we're in a multi-currency org, add those to the where clause too.\n\t\t\tif (currencyCodeString && this._opts.isMultiCurrencyOrg) {\n\t\t\t\twhereArray.push(`CurrencyIsoCode IN (${currencyCodeString})`);\n\t\t\t}\n\t\t\t\n\t\t\tlet orderByArray = [this._salesCloudPrefix + 'LowerBound__c', 'ASC'];\n\n\t\t\tthis._addSubquery(query, this._salesCloudPrefix + 'BlockPrices__r', blockPriceFields, whereArray, orderByArray);\n\t\t}\n\t}\n\n\t/**\n\t * Converts this descriptor into a String that can be used as a hash key for the ProductDAO.\n\t * @returns {string}\n\t * @private\n\t */\n\t_getHashKey() {\n\t\t// TODO: This system is suboptimal, and it will be difficult to use such a key for more intelligent cache inspection.\n\t\t// Consider redesigning this altogether.\n\t\treturn \"COSTS?\" + (this._includeCosts ? 'YES' : 'NO')\n\t\t\t+ \"_DIMENSIONS?\" + (this._includeDimensions ? 'YES' : 'NO')\n\t\t\t+ \"_PRICEENTRIES?\" + (this._includePriceEntries ? 'YES' : 'NO')\n\t\t\t+ \"_BLOCKPRICES?\" + (this._includeBlockPrices ? 'YES' : 'NO')\n\t\t\t+ \"__PRICEBOOKIDS:\" + (this._filteredPricebooks && this._filteredPricebooks.length > 0 ? JSON.stringify(this._filteredPricebooks) : 'NONE')\n\t\t\t+ \"__CURRENCYCODES:\" + (this._filteredCurrencyCodes && this._filteredCurrencyCodes.length > 0 ? JSON.stringify(this._filteredCurrencyCodes) : 'NONE');\n\t}\n}\n\nclass ProductDAO extends BaseDAO {\n\tconstructor(conn, services, opts) {\n\t\tsuper(conn, opts.labels);\n\t\tthis._opts = opts;\n\t\tthis._prefix = opts.prefix;\n\t\tthis._services = services;\n\t\t/**\n\t\t * This will be a nested Map.\n\t\t * The outer keys will be the result of calling ._getHashKey() on a ProductSubqueryDescriptor plus the stringified\n\t\t * array of extra fields to query.\n\t\t * The inner keys will be Ids of products that have been queried with the described subquery and extra fields.\n\t\t * It's not perfect, since we don't do any checks to see whether cached subqueries are supersets of new ones,\n\t\t * but it will at least guarantee that we never fetch the same product with the exact same subquery more than once.\n\t\t * @type {Map.<String,IdToValueCache>}\n\t\t * @private\n\t\t */\n\t\tthis._cache = cacheManager.getCache(CACHE_NAME);\n\t\tthis._initialized = false;\n\t\tthis._logger = jsLogger;\n\t}\n\n\t_logMessage(msg) {\n\t\tthis._logger.info(msg);\n\t}\n\n\t/**\n\t * Performs any asynchronous initialization required for this DAO. Specifically, loads mappable fields.\n\t * @returns {Promise}\n\t * @private\n\t */\n\t_init() {\n\t\tif (this._initialized) {\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet lineType = this._prefix + 'QuoteLine__c';\n\t\t\tthis._logMessage('ProductDAO.js: Initialization. SessionId=' + this._opts.userId);\n\t\t\tlet getSharedMappableFieldNamesStartTime = Date.now();\n\t\t\treturn this._services.fieldMetadataService.getSharedMappableFieldNames('Product2', lineType)\n\t\t\t\t.then((fields) => {\n\t\t\t\t\tthis._logMessage('ProductDAO.js: Getting shared mappable fields names took ' + (Date.now() - getSharedMappableFieldNamesStartTime) + ' ms. SessionId=' + this._opts.userId);\n\t\t\t\t\tthis._mappableFields = fields;\n\t\t\t\t\tthis._initialized = true;\n\t\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Returns a mapping from IDs to Product records for all provided IDs, with the inclusion of the related records described\n\t * by the subquery descriptor.\n\t * @param {Array.<String>} ids - A list of Product2 Ids.\n\t * @param {ProductSubqueryDescriptor} [subqueryInfo] - Describes the related records that should be included.\n\t * If null or undefined, no related records will be included.\n\t * @returns {Promise.<Map.<String,JSON>>}\n\t */\n\tloadProductsByIds(ids, subqueryInfo) {\n\t\t// Because the ID list given to us may have duplicates, we should remove those duplicates. Do that by converting\n\t\t// the array to a set, and then back to an array.\n\t\tlet uniqueIds = [];\n\t\tnew Set(ids).forEach((id) => {\n\t\t\tuniqueIds.push(id);\n\t\t});\n\t\tthis._logMessage('ProductDAO.js: Initialization. SessionId=' + this._opts.userId);\n\t\tlet loadProductsStartTime;\n\t\tlet initStartTime = Date.now();\n\t\t// Step 1: Initialize the DAO and subquery descriptor if necessary. This will mostly involve identifying mappable fields.\n\t\tlet initPromises = [];\n\t\tinitPromises.push(this._init());\n\t\tif (subqueryInfo) {\n\t\t\tinitPromises.push(subqueryInfo.init(this._services));\n\t\t}\n\t\treturn Promise.all(initPromises)\n\t\t\t.then(() => {\n\t\t\t\tthis._logMessage('ProductDAO.js: Initialization took ' + (Date.now() - initStartTime) + ' ms. SessionId=' + this._opts.userId);\n\t\t\t\tthis._logMessage('ProductDAO.js: Get products by Ids. SessionId=' + this._opts.userId);\n\t\t\t\tloadProductsStartTime = Date.now();\n\t\t\t\treturn this._getProductsByIds(uniqueIds, subqueryInfo);\n\t\t\t})\n\t\t\t.then((products) => {\n\t\t\t\tthis._logMessage('ProductDAO.js: Getting products by ids took ' + (Date.now() - loadProductsStartTime) + ' ms. SessionId=' + this._opts.userId);\n\t\t\t\treturn products;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\t// If an error occurred anywhere in the loading process, we want to catch the possibly-unfriendly error\n\t\t\t\t// message and replace it with something better.\n\t\t\t\tlet errHeader = this._opts.errorHeader;\n\t\t\t\treturn Promise.reject(errHeader + (err.message || err));\n\t\t\t});\n\t}\n\n\t/**\n\t * Checks the cache for the described combination of product IDs and subqueries. If any IDs are missing, invokes\n\t * a callout to retrieve them.\n\t * @param {Array.<String>} ids - A list of Product2 Ids.\n\t * @param {ProductSubqueryDescriptor} [subqueryInfo] - Describes which related records to include.\n\t * If null or omitted, no related records will be included.\n\t * @returns {Promise.<IdToValueCache>}\n\t * @private\n\t */\n\t_getProductsByIds(ids, subqueryInfo) {\n\t\t// First, transform the query descriptor into the first half of the key for the cache. If no descriptor was provided, then\n\t\t// we use 'default', which will store product records without any related records at all.\n\t\tlet outerCacheKeySubqueryPortion = subqueryInfo ? subqueryInfo._getHashKey() : 'default';\n\t\t// Then, transform the array of extra fields we've been instructed to query into the second half of the key for the cache.\n\t\t// This code relies on the implicit assumption that a JSARSettings and the JSQCSettings it contains have the same\n\t\t// underlying referenced field map. When that assumption is correct (which should be always), the product queries\n\t\t// in JSAR and JSQC will have the same cache keys, short-circuiting expensive callouts.\n\t\tlet outerCacheKeyExtraFieldsPortion = JSON.stringify(this._opts.extraFields || []);\n\t\t// Combine the two halves of our cache key into a whole, separated by an excessive number of underscores to promote\n\t\t// readability should the need arise.\n\t\tlet outerCacheKey = outerCacheKeySubqueryPortion + '____' + outerCacheKeyExtraFieldsPortion;\n\n\t\t// Then, check if there's a mapping for results of that subquery combination.\n\t\tlet productsRequiringQuery = [];\n\t\tlet cachedResultsForSubquery = this._cache.get(outerCacheKey);\n\t\tif (!cachedResultsForSubquery) {\n\t\t\t// If there are no cached results, then we insert a map and mark all product IDs as needing to be queried.\n\t\t\tthis._cache.set(outerCacheKey, new IdToValueCache());\n\t\t\tproductsRequiringQuery = ids;\n\t\t} else {\n\t\t\t// If there are results, then we only need to query products that don't have an entry in those results.\n\t\t\tproductsRequiringQuery = ids.filter((id) => {return !cachedResultsForSubquery.has(id);});\n\t\t}\n\n\t\t// If there are any missing Ids, we need to query them. Otherwise, we can immediately move to the next step.\n\t\tif (productsRequiringQuery.length > 0) {\n\t\t\treturn this._queryAndCacheProducts(productsRequiringQuery, subqueryInfo, outerCacheKey);\n\t\t} else {\n\t\t\treturn Promise.resolve(cachedResultsForSubquery);\n\t\t}\n\t}\n\n\t/**\n\t * Performs a query for the provided product Ids with the described relationships, and caches the results.\n\t * @param {Array.<String>} productIds - A set of product IDs\n\t * @param {ProductSubqueryDescriptor} subqueryDescriptor - A descriptor for related records to include.\n\t * @param {String} cacheKey - The key by which the results should be cached.\n\t * @returns {Promise.<IdToValueCache>}\n\t * @private\n\t */\n\t_queryAndCacheProducts(productIds, subqueryDescriptor, cacheKey) {\n\t\t// Step 1: Identify all of the Product fields we'll need to query, including mappable fields.\n\t\tlet productFields = DAOHelperMethods.properlyPrefixFields(this._prefix, PRODUCT_FIELDS);\n\t\tif (this._opts.isMultiCurrencyOrg) {\n\t\t\tproductFields.push('CurrencyIsoCode');\n\t\t}\n\t\tproductFields = productFields.concat(this._opts.extraFields || []);\n\t\tproductFields = productFields.concat(this._mappableFields);\n\t\tlet whereClause = \"Id IN ('\" + productIds.join(\"', '\") + \"')\";\n\t\t// Step 2: Delegate the construction and execution of the query to method inherited from BaseDAO.\n\t\treturn this._constructAndPerformQuery('Product2', productFields, whereClause, subqueryDescriptor)\n\t\t\t.then((products) => {\n\t\t\t\t// Step 3: Cache the products by ID and return the whole cache entry.\n\t\t\t\tlet precachedResults = this._cache.get(cacheKey);\n\t\t\t\tproducts.forEach((product) => {\n\t\t\t\t\tprecachedResults.set(product.Id, product);\n\t\t\t\t});\n\t\t\t\treturn precachedResults;\n\t\t\t});\n\t}\n\n\t/**\n\t * Uses a JSARSettings instance to derive an options object that can be provided to the ProductDAO constructor.\n\t * @param {JSARSettings} jsarSettings\n\t * @returns {{prefix, userId, isMultiCurrencyOrg, errorHeader: string, labels, allowInactivePrices: *, extraFields}}\n\t * @static\n\t */\n\tstatic constructOptsFromJsarSettings(jsarSettings) {\n\t\treturn {\n\t\t\tprefix: jsarSettings.salesCloudPrefix,\n\t\t\tuserId: jsarSettings.userId,\n\t\t\tisMultiCurrencyOrg: jsarSettings.isMultiCurrencyOrg,\n\t\t\terrorHeader: jsarSettings.labels.msg_amendrenew_err_loading_products,\n\t\t\tlabels: jsarSettings.labels,\n\t\t\tallowInactivePrices: jsarSettings.calcSettings.allowInactivePrices,\n\t\t\toverageRateFieldName: jsarSettings.calcSettings.overageRateFieldName,\n\t\t\textraFields: jsarSettings.calcSettings.referencedFieldMap['Product2'] || []\n\t\t};\n\t}\n\n\t/**\n\t * Uses a JSQC SettingsModel instance to derive an options object that can be provided to the ProductDAO constructor.\n\t * @param {SettingsModel} jsqcSettings\n\t * @returns {{prefix, userId, isMultiCurrencyOrg, errorHeader: String|*, labels, allowInactivePrices: *, extraFields}}\n\t * @static\n\t */\n\tstatic constructOptsFromJsqcSettings(jsqcSettings) {\n\t\treturn {\n\t\t\tprefix: jsqcSettings.devPrefix,\n\t\t\tuserId: jsqcSettings.userId,\n\t\t\tisMultiCurrencyOrg: jsqcSettings.isMultiCurrencyOrg,\n\t\t\terrorHeader: jsqcSettings.getLabelByKey('msg_amendrenew_err_loading_products'),\n\t\t\tallowInactivePrices: jsqcSettings.allowInactivePrices,\n\t\t\toverageRateFieldName: jsqcSettings.overageRateFieldName,\n\t\t\textraFields: jsqcSettings.referencedFieldMap['Product2'] || [],\n\t\t\tlabels: jsqcSettings.jsqcLabels\n\t\t};\n\t}\n}\n\nmodule.exports.DAO = ProductDAO;\nmodule.exports.SubqueryDescriptor = ProductSubqueryDescriptor;","/**\n * Created by jfeingold on 10/10/17.\n *\n * Util class that can accept any WHERE clause and break it out into queries such that all queries are below a specified\n * length, and (if possible) the partial queries have a combined result set exactly equal to the original WHERE clause.\n */\nlet parse = require(\"node-sqlparser\").parse;\nlet stringify = require(\"node-sqlparser\").stringify;\n\nclass WhereClauseSplitter {\n\tconstructor() {\n\t\tthis._overallSpecificityPreserved = true;\n\t\tthis._nextNodeKey = 0;\n\t\tthis._semiJoinRegex = /\\s+IN\\s+\\(\\s*SELECT\\s+.*?FROM/ig;\n\t\tthis._semiJoinMap = new Map();\n\t\tthis._semiJoinCounter = 0;\n\t\tthis._semiJoinReplacementFormat = \"'____SEMI-JOIN_%____'\";\n\t\tthis._unescapedDateRegex = /\\d{4}-\\d{2}-\\d{2}(?:(?:T\\d{2}:\\d{2}:\\d{2})(?:Z|[\\+\\-]\\d{2}:\\d{2}))?/gi;\n\t\tthis._unescapedDateMap = new Map();\n\t\tthis._unescapedDateCounter = 0;\n\t\tthis._unescapedDateReplacementFormat = \"'____UNESCAPED_DATE_%____'\";\n\t\tthis._nestedLookupRegex = /\\w+\\.\\w+\\.\\w+(?:\\.\\w+)*/gi;\n\t\tthis._nestedLookupMap = new Map();\n\t\tthis._nestedLookupCounter = 0;\n\t\tthis._nestedLookupReplacementFormat = \"'____NESTED_LOOKUP_%____'\";\n\t}\n\n\t/**\n\t * Resets the internal properties that are used to track how the provided WHERE clause has been modified to make\n\t * it parsable by the node-sqlparser library.\n\t * @private\n\t */\n\t_resetModificationInformation() {\n\t\tthis._overallSpecificityPreserved = true;\n\t\tthis._nextNodeKey = 0;\n\t\tthis._semiJoinMap = new Map();\n\t\tthis._semiJoinCounter = 0;\n\t\tthis._unescapedDateMap = new Map();\n\t\tthis._unescapedDateCounter = 0;\n\t\tthis._nestedLookupMap = new Map();\n\t\tthis._nestedLookupCounter = 0;\n\t}\n\n\t/**\n\t * When provided a SOQL WHERE clause, attempts to split the clause into multiple WHERE clauses that are all shorter\n\t * than the specified maximum length, preserving the query's specificity if at all possible.\n\t * @param {String} whereClause - A SOQL WHERE Clause.\n\t * @param {number} maxLength - The maximum permitted size for a WHERE clause.\n\t * @returns {{clauses: Array, specificityPreserved: boolean}}\n\t */\n\tsplitWhereClause(whereClause, maxLength) {\n\t\tlet results = {\n\t\t\tclauses: [],\n\t\t\tspecificityPreserved: true\n\t\t};\n\t\tlet whereLength = whereClause.length;\n\t\tif (whereLength <= maxLength) {\n\t\t\t// If the WHERE clause is already small enough to fit in a single query, we don't need to do anything.\n\t\t\tresults.clauses.push(whereClause);\n\t\t\treturn results;\n\t\t}\n\t\t// If the WHERE clause is too big, it needs to be split into multiple queries.\n\t\t// However, before that's possible, we need to send the WHERE clause through some methods to make sure it's parsable.\n\t\t// For example, semi-joins must be stripped out, and Dates and DateTimes must be wrapped in quotes.\n\t\tlet treatedWhereClause = this._makeWhereClauseParsable(whereClause);\n\t\t// Now, we want to construct a fake SQL statement using our WHERE clause so the parser can accept it.\n\t\tlet fakeQueryString = 'SELECT * FROM SomeTable WHERE ' + treatedWhereClause;\n\t\tlet fullAst;\n\t\ttry {\n\t\t\tfullAst = parse(fakeQueryString);\n\t\t} catch (e) {\n\t\t\t// If the parse failed, it'll probably give some really cryptic error. If nothing else, we should intercept\n\t\t\t// that error and prefix it with something informative.\n\t\t\tthrow Error('Failed to parse WHERE clause: ' + (e.message || e));\n\t\t}\n\t\t// Then we pull the WHERE clause off of the AST.\n\t\tlet whereAst = fullAst.where;\n\t\t// We need to give each Node a Length property representing how large it is, and a MinLength property representing\n\t\t// how small we can get its effective length if we split as aggressively as possible.\n\t\tthis._recursivelySetLengthOnAstNodes(whereAst);\n\t\t// Initially, we want to forbid splitting of ANDs, because it changes the overall results of the query.\n\t\t// The set of records satisfying (X OR Y) is the union of the sets of records that satisfy X and Y separately,\n\t\t// allowing us to split ORs and INs (which are essentially simplified ORs) with impunity.\n\t\t// But the set of records satisfying (X AND Y) is the *intersection* of the sets of records that satisfy X and Y\n\t\t// separately, meaning that if we split an AND, we have to check the results after the query returns to filter out\n\t\t// the records we actually want.\n\n\t\t// First, we want to see if we can split the query to the necessary size without reducing the overall specificity\n\t\t// of the query. In practice, this means avoiding doing a hard split on AND expressions.\n\t\t// e.g., you can split ((X OR Y) AND Z) into (X AND Z) and (Y AND Z) because the union of all of those results\n\t\t// is going to be the same as the original results.\n\t\tlet preserveOverallSpecificity = true;\n\t\tthis._recursivelySetMinLengthOnAstNodes(whereAst, preserveOverallSpecificity);\n\t\tif (whereAst.minLength > maxLength) {\n\t\t\tpreserveOverallSpecificity = false;\n\t\t\t// If we couldn't get the query small enough while preserving specificity, then we need to see if we can\n\t\t\t// do so by ignoring specificity. In practice,this means that we're allowing ourselves to do a hard split on\n\t\t\t// AND expressions. e.g., we can split (X AND Y) the same way we'd split (X OR Y).\n\t\t\tthis._recursivelySetMinLengthOnAstNodes(whereAst, preserveOverallSpecificity);\n\t\t\tif (whereAst.minLength > maxLength) {\n\t\t\t\t// If the WHERE clause *still* can't be sufficiently shrunk, even by ignoring specificity, then\n\t\t\t\t// we're screwed, and should throw an error explaining the problem.\n\t\t\t\tthrow Error('WHERE clause cannot be shrunk below maximum acceptable length of ' + maxLength + '. WHERE CLAUSE: ' + whereClause);\n\t\t\t}\n\t\t}\n\t\tlet splitWhereAsts = this._recursivelySplitUntilTargetSizeReached(whereAst, maxLength, preserveOverallSpecificity);\n\t\tlet splitWhereClauses = [];\n\t\tlet splitKeyLists = [];\n\t\tlet splitKeyMaxDepthMap = new Map();\n\t\tsplitWhereAsts.forEach((splitWhereAst) => {\n\t\t\tfullAst.where = splitWhereAst;\n\t\t\t// We turn the AST back into a String, and then ignore the first 30 characters, which will be our fake SELECT\n\t\t\t// clause.\n\t\t\tlet splitWhereClause = stringify(fullAst).slice(30);\n\t\t\tsplitWhereClauses.push(this._restoreUnparsableCharacters(splitWhereClause));\n\n\t\t\t// If we didn't preserve the query's specificity, we should pull all of the key lists into a list of lists,\n\t\t\t// and we should figure out the maximum depth at which each key appears so we can properly recombine the\n\t\t\t// results.\n\t\t\tif (!this._overallSpecificityPreserved) {\n\t\t\t\t// Add this WHERE clause's key list to the list of lists.\n\t\t\t\tsplitKeyLists.push(splitWhereAst.splitNodeKeys);\n\t\t\t\t// For each of the keys in the list, if this key's depth is the deepest we've seen it at, mark that as\n\t\t\t\t// the max depth.\n\t\t\t\tsplitWhereAst.splitNodeKeys.forEach((nodeKey, index) => {\n\t\t\t\t\tif (!splitKeyMaxDepthMap.has(nodeKey) || splitKeyMaxDepthMap.get(nodeKey) < index) {\n\t\t\t\t\t\tsplitKeyMaxDepthMap.set(nodeKey, index);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t// Lastly, if we're not preserving specificity, we'll have created this giant mapping of keys to their maximum\n\t\t// depth. However, in order to make it easier to iterate over depths and check the keys, we're going to turn\n\t\t// the map inside out and map from depths to the keys with those depths.\n\t\tlet splitKeysMappedByMaxDepth = new Map();\n\t\tif (!this._overallSpecificityPreserved) {\n\t\t\tsplitKeyMaxDepthMap.forEach((value, key) => {\n\t\t\t\tif (!splitKeysMappedByMaxDepth.has(value)) {\n\t\t\t\t\tsplitKeysMappedByMaxDepth.set(value, new Set());\n\t\t\t\t}\n\t\t\t\tsplitKeysMappedByMaxDepth.get(value).add(key);\n\t\t\t});\n\t\t}\n\t\tresults.clauses = splitWhereClauses;\n\t\tresults.specificityPreserved = this._overallSpecificityPreserved;\n\t\tresults.splitKeyLists = splitKeyLists;\n\t\tresults.splitKeysMappedByMaxDepth = splitKeysMappedByMaxDepth;\n\t\treturn results;\n\t}\n\n\t/**\n\t * Performs some slight modifications to the provided WHERE clause to make it compatible with the parser library.\n\t * @param {String} whereClause - A SOQL WHERE clause.\n\t * @returns {String} The provided WHERE clause, except modified to make it compatible with the parser.\n\t * @private\n\t */\n\t_makeWhereClauseParsable(whereClause) {\n\t\tthis._resetModificationInformation();\n\t\treturn this._storeAndReplaceNestedLookups(\n\t\t\tthis._storeAndReplaceUnescapedDates(\n\t\t\t\tthis._storeAndReplaceSemiJoins(whereClause)\n\t\t\t)\n\t\t);\n\t}\n\n\t/**\n\t * Accepts a modified WHERE clause and reverts all of the modifications to turn it back into a SOQL-compatible expression.\n\t * @param {String} whereClause - A modified SOQL WHERE clause.\n\t * @returns {String} The same clause, converted back into SOQL-friendly syntax.\n\t * @private\n\t */\n\t_restoreUnparsableCharacters(whereClause) {\n\t\tlet modifiedWhereClause = whereClause;\n\t\tlet mapList = [this._unescapedDateMap, this._nestedLookupMap, this._semiJoinMap];\n\t\tfor (let map of mapList) {\n\t\t\tfor (let [replacementString, original] of map) {\n\t\t\t\tlet replacementFindingRegex = new RegExp(replacementString, 'g');\n\t\t\t\tmodifiedWhereClause = modifiedWhereClause.replace(replacementFindingRegex, original);\n\t\t\t}\n\t\t}\n\t\treturn modifiedWhereClause;\n\t}\n\n\t/**\n\t * Replaces Semi-Joins (i.e., Id IN (SELECT SomeField__c FROM QuoteLine__c WHERE ...)) with a string of the format\n\t * \"'____SEMI-JOIN_#____'\", and maps that replacement string to the original value so it can be reverted later.\n\t * @param {String} whereClause - A SOQL WHERE clause that may or may not contain Semi-Joins.\n\t * @returns {String} The same clause, but with all Semi-Joins removed.\n\t * @private\n\t */\n\t_storeAndReplaceSemiJoins(whereClause) {\n\t\tlet matchesByIndex = new Map();\n\t\tlet match;\n\t\t// Find everything in the WHERE clause that looks like it might be a semi-join, and store it in our match map.\n\t\twhile ((match = this._semiJoinRegex.exec(whereClause)) !== null) {\n\t\t\tmatchesByIndex.set(match.index, match);\n\t\t}\n\n\t\t// If there aren't any potential semi-joins, then the WHERE clause can be returned as-is.\n\t\tif (matchesByIndex.size === 0) {\n\t\t\treturn whereClause;\n\t\t}\n\n\t\t// We only want to replace semi-joins that are outside of strings. Additionally, the only way to be sure we capture\n\t\t// the entire semi-join is to start at the beginning of the SELECT statement and capture everything until the\n\t\t// parentheses are balanced. In order to track string scope and parenthesis balancing, we'll need to iterate over\n\t\t// the entire WHERE clause manually.\n\t\tlet semiJoinLengthsByStartIndex = new Map();\n\t\tlet whereClauseIterator = whereClause[Symbol.iterator]();\n\t\tlet idx = 0;\n\t\tlet iter;\n\t\tlet stringDelimiterArray = [];\n\t\tlet parenBalance;\n\t\tlet capturingSemiJoin = false;\n\t\tlet semiJoinLength;\n\t\tlet semiJoinStartIndex;\n\t\t// Declare a variable to count the number of matches we've processed, so we can exit the loop early once we've\n\t\t// processed everything.\n\t\tlet matchesProcessed = 0;\n\t\twhile (!(iter = whereClauseIterator.next()).done) {\n\t\t\tif (matchesByIndex.has(idx)) {\n\t\t\t\t// If something that looks like a Semi-Join starts here, make sure we're not in a string, or in another semi-join.\n\t\t\t\tif (!capturingSemiJoin && stringDelimiterArray.length === 0) {\n\t\t\t\t\t// If we're not in a string or a semi-join, begin capturing this semi-join.\n\t\t\t\t\tcapturingSemiJoin = true;\n\t\t\t\t\tparenBalance = 0;\n\t\t\t\t}\n\t\t\t\t// Increment the match counter.\n\t\t\t\tmatchesProcessed++;\n\t\t\t} else if (stringDelimiterArray.length > 0 && iter.value === stringDelimiterArray[0]) {\n\t\t\t\t// If we're inside a string and we encounter a matching delimiter, we've reached the end of the string,\n\t\t\t\t// and we can stop looking for that delimiter.\n\t\t\t\tstringDelimiterArray.shift();\n\t\t\t} else if (iter.value === '\"' || iter.value === \"'\") {\n\t\t\t\t// Otherwise, if we encounter a string delimiter, it's the start of a new string, so we add it to the\n\t\t\t\t// delimiter array.\n\t\t\t\tstringDelimiterArray.unshift(iter.value);\n\t\t\t} else if (stringDelimiterArray.length === 0 && capturingSemiJoin) {\n\t\t\t\t// If we're outside of a string and inside a semi-join, we're looking to make sure that the parentheses\n\t\t\t\t// are balanced.\n\t\t\t\tif (iter.value === '(') {\n\t\t\t\t\t// An open-paren causes us to increment the balance by 1. Furthermore, if we're incrementing the balance\n\t\t\t\t\t// from 0 to 1, this is the open-paren immediately before the semi-join, so we note that the semi-join starts\n\t\t\t\t\t// with the next character and set the length to -1 so we can safely increment it to 0.\n\t\t\t\t\t// e.g., the regex matches '... IN (SELECT * FROM...', So we'll set the capturing flag to true when we\n\t\t\t\t\t// reach the 'I', but won't actually start capturing until we reach the '(', and the first captured\n\t\t\t\t\t// character will be the 'S'.\n\t\t\t\t\tif (parenBalance++ === 0) {\n\t\t\t\t\t\tsemiJoinStartIndex = idx + 1;\n\t\t\t\t\t\tsemiJoinLength = -1;\n\t\t\t\t\t}\n\t\t\t\t} else if (iter.value === ')') {\n\t\t\t\t\t// A close-paren causes us to decrement the balance by 1. Furthermore, if we're decrementing the balance\n\t\t\t\t\t// from 1 to 0, this is the close-paren that ends the semi-join, so we map the current length to the\n\t\t\t\t\t// the starting index and stop capturing.\n\t\t\t\t\tif (--parenBalance === 0) {\n\t\t\t\t\t\tsemiJoinLengthsByStartIndex.set(semiJoinStartIndex, semiJoinLength);\n\t\t\t\t\t\tcapturingSemiJoin = false;\n\t\t\t\t\t\t// If we've processed all of the matches, we're done.\n\t\t\t\t\t\tif (matchesProcessed === matchesByIndex.size) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If we're capturing a semi-join and our parenthesis balance is positive, increment the length of the semi-join.\n\t\t\tif (capturingSemiJoin && parenBalance > 0) {\n\t\t\t\tsemiJoinLength++;\n\t\t\t}\n\t\t\t// Always increment our index.\n\t\t\tidx++;\n\t\t}\n\n\t\t// If there aren't any semi-joins that need to be replaced, don't do anything.\n\t\tif (semiJoinLengthsByStartIndex.size === 0) {\n\t\t\treturn whereClause;\n\t\t}\n\n\t\t// Now that we have information about every single semi-join that must be replaced, we must go through and do that.\n\t\tlet modifiedWhereClause = '';\n\t\tlet sliceStartPoint = 0;\n\t\tfor (let [idx, len] of semiJoinLengthsByStartIndex.entries()) {\n\t\t\tmodifiedWhereClause += whereClause.slice(sliceStartPoint, idx);\n\t\t\tlet semiJoin = whereClause.slice(idx, idx + len);\n\t\t\tlet semiJoinReplacement = this._semiJoinReplacementFormat.replace('%', ++this._semiJoinCounter);\n\t\t\tmodifiedWhereClause += semiJoinReplacement;\n\t\t\tthis._semiJoinMap.set(semiJoinReplacement, semiJoin);\n\t\t\tsliceStartPoint = idx + len;\n\t\t}\n\t\t// After adding all the replacements, we can't forget about the rest of the string.\n\t\tmodifiedWhereClause += whereClause.slice(sliceStartPoint);\n\t\treturn modifiedWhereClause;\n\t}\n\n\t/**\n\t * Replaces all Dates/DateTimes that are not already wrapped in a String with a replacement string of the format\n\t * \"'____UNESCAPED_DATE_#____'\", and maps the original to that value so it can be reverted later.\n\t * e.g., WHERE CreatedDate > 2015-02-21 becomes WHERE CreatedDate > '____UNESCAPED_DATE_1____',\n\t * but WHERE MyDateStringField__c = '2015-02-21' is unchanged.\n\t * @param {String} whereClause - A WHERE clause that may or may not contain unescaped dates.\n\t * @returns {String} The same WHERE clause, with all unescaped dates removed.\n\t * @private\n\t */\n\t_storeAndReplaceUnescapedDates(whereClause) {\n\t\treturn this._storeAndReplaceUnparsableSubstrings(whereClause, this._unescapedDateRegex,\n\t\t\tthis._unescapedDateReplacementFormat, this._unescapedDateMap, this._unescapedDateCounter\n\t\t);\n\t}\n\n\t/**\n\t * Replaces all Nested Lookups (e.g. Quote__r.Opportunity2__r.Id) not already wrapped in a string with a replacement.\n\t * @param {String} whereClause - A SOQL WHERE clause that may or may not contain nested lookups.\n\t * @returns {String} The same WHERE clause with all nested lookups replaced.\n\t * @private\n\t */\n\t_storeAndReplaceNestedLookups(whereClause) {\n\t\treturn this._storeAndReplaceUnparsableSubstrings(whereClause, this._nestedLookupRegex,\n\t\t\tthis._nestedLookupReplacementFormat, this._nestedLookupMap, this._nestedLookupCounter\n\t\t);\n\t}\n\n\t/**\n\t * A generic method for performing simple searches and replacements of strings in a WHERE clause.\n\t * @param {String} whereClause - A SOQL WHERE clause.\n\t * @param {RegExp} regex - A Regular Expression used to match unparsable text.\n\t * @param {String} replacementFormat - A String indicating a template for the replacement strings.\n\t * @param {Map} storedValueMap - An accumulator into which replacement strings will be inserted, mapping to the strings they replace.\n\t * Populated as a side-effect.\n\t * @param {number} storedValueCounter - An accumulator that is incremented as a side-effect every time a value is inserted into storedValueMap.\n\t * @returns {String} The WHERE clause with all matching substrings replaced.\n\t * @private\n\t */\n\t_storeAndReplaceUnparsableSubstrings(whereClause, regex, replacementFormat, storedValueMap, storedValueCounter) {\n\t\tlet matchesByIndex = new Map();\n\t\tlet match;\n\t\t// Find every value that might be an unparsable value, and put it into our match map.\n\t\twhile ((match = regex.exec(whereClause)) !== null) {\n\t\t\tmatchesByIndex.set(match.index, match);\n\t\t}\n\n\t\t// If there aren't any unparsable values in the WHERE clause, return it as is.\n\t\tif (matchesByIndex.size === 0) {\n\t\t\treturn whereClause;\n\t\t}\n\n\t\t// We only want to wrap unparsable values that aren't already part of a string. The only way to know for certain is to\n\t\t// iterate over the WHERE clause and track string scope.\n\t\tlet whereIterator = whereClause[Symbol.iterator]();\n\t\tlet idx = 0;\n\t\tlet stringDelimiterArray = [];\n\t\tlet sliceStartPoint = 0;\n\t\tlet modifiedWhereClause = \"\";\n\t\tlet iter;\n\t\t// Declare a variable to hold the number of matches we've dealt with, so we can skip to the end once we've seen\n\t\t// all of them.\n\t\tlet matchCounter = 0;\n\t\twhile (!(iter = whereIterator.next()).done) {\n\t\t\t// If this Index is the start of one of our Matches, we need to check whether we're currently inside a String.\n\t\t\tif (matchesByIndex.has(idx)) {\n\t\t\t\t// If the delimiter array is empty, we're not in a string, and must process the value properly.\n\t\t\t\tif (stringDelimiterArray.length === 0) {\n\t\t\t\t\tlet match = matchesByIndex.get(idx);\n\t\t\t\t\t// Create the replacement value and use it as a key for the original value.\n\t\t\t\t\tlet unparsableValue = match[0];\n\t\t\t\t\tlet replacementValue = replacementFormat.replace('%', ++storedValueCounter);\n\t\t\t\t\tstoredValueMap.set(replacementValue, unparsableValue);\n\t\t\t\t\t// Continue building out the modified WHERE clause and add the replacement value.\n\t\t\t\t\tmodifiedWhereClause += whereClause.slice(sliceStartPoint, idx) + replacementValue;\n\t\t\t\t\t// Reset the slice start point so the next slice starts after the end of the unparsable value.\n\t\t\t\t\tsliceStartPoint = idx + unparsableValue.length;\n\t\t\t\t}\n\t\t\t\tif (++matchCounter === matchesByIndex.size) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (stringDelimiterArray.length > 0 && iter.value === stringDelimiterArray[0]) {\n\t\t\t\t// If we're inside a string and we encountered a matching delimiter, we're at the end of that string\n\t\t\t\t// and can stop looking for that delimiter.\n\t\t\t\tstringDelimiterArray.shift();\n\t\t\t} else if (iter.value === '\"' || iter.value === \"'\") {\n\t\t\t\t// Otherwise, if the character is a string delimiter, it's the start of a string, so we add it to the\n\t\t\t\t// delimiter array.\n\t\t\t\tstringDelimiterArray.unshift(iter.value);\n\t\t\t}\n\t\t\t// Increment the index.\n\t\t\tidx++;\n\t\t}\n\t\t// After we're finished iterating, add everything after the final slice starting point to the modified string.\n\t\tmodifiedWhereClause += whereClause.slice(sliceStartPoint);\n\t\treturn modifiedWhereClause;\n\t}\n\n\t/**\n\t * Given an Abstract Syntax Tree that represents a WHERE clause, recursively populates a .length property on every single\n\t * node, which represents the length of the substring into which the AST will be flattened. Returns the length.\n\t * @param {Object} ast - A node in an Abstract Syntax Tree that represents a WHERE clause.\n\t * @param {String} ast.type - A string indicating what type of node this represents.\n\t * @returns {number} The node's .length property.\n\t * @private\n\t */\n\t_recursivelySetLengthOnAstNodes(ast) {\n\t\tlet length = 0;\n\t\t// Always give each node a Key.\n\t\tast.nodeKey = this._nextNodeKey++;\n\t\tast.splitNodeKeys = [];\n\t\tswitch (ast.type) {\n\t\t\tcase \"binary_expr\":\n\t\t\t\t// The length of a Binary Expression Node (e.g. x OR y, x AND y, x IN y) is the sum of the lengths of each side\n\t\t\t\t// plus the length of the operator itself, plus 2 to account for spacing.\n\t\t\t\tlet leftLength = this._recursivelySetLengthOnAstNodes(ast.left);\n\t\t\t\tlet rightLength = this._recursivelySetLengthOnAstNodes(ast.right);\n\t\t\t\tlet operatorLength = ast.operator.length;\n\t\t\t\tlength = leftLength + rightLength + operatorLength + 2;\n\t\t\t\tbreak;\n\t\t\tcase \"expr_list\":\n\t\t\t\t// The length of an Expression List Node (e.g. x IN (a, b, c)) is the sum of the lengths of each entry,\n\t\t\t\t// plus 2 for the wrapping parentheses, plus an additional 2 per comma and space to link each node.\n\t\t\t\t// Initialize the length to -2 so that we can treat the first node the same as the other nodes.\n\t\t\t\tlength = -2;\n\t\t\t\tast.value.forEach((valueNode) => {\n\t\t\t\t\tthis._recursivelySetLengthOnAstNodes(valueNode);\n\t\t\t\t\tlength += valueNode.length + 2;\n\t\t\t\t});\n\t\t\t\tlength += 2;\n\t\t\t\tbreak;\n\t\t\tcase \"column_ref\":\n\t\t\t\t// The length of a Column Reference Node (e.g. ProductName__c, Quote__r.NetAmount__c) depends on whether\n\t\t\t\t// it's a lookup.\n\t\t\t\t// We always include the column, as that's a field name.\n\t\t\t\tlength = ast.column.length;\n\t\t\t\t// If there's also a table property, then this is a lookup, and we need to include the table property's\n\t\t\t\t// length, plus 1 for the period between them.\n\t\t\t\tif (ast.table.length > 0) {\n\t\t\t\t\tlength += ast.table.length + 1;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"string\":\n\t\t\t\t// A String node might be an actual string, but it could also be a string that replaces a non-parsable\n\t\t\t\t// value.\n\t\t\t\tlet prospectiveReplacementKey = \"'\" + ast.value + \"'\";\n\t\t\t\tif (this._semiJoinMap.has(prospectiveReplacementKey)) {\n\t\t\t\t\t// The length of a Semi-Join replacement is the length of the Semi-Join it replaces.\n\t\t\t\t\tlength = this._semiJoinMap.get(prospectiveReplacementKey).length;\n\t\t\t\t} else if (this._unescapedDateMap.has(prospectiveReplacementKey)) {\n\t\t\t\t\t// The length of a Date/DateTime replacement is the length of the Date/DateTime it replaces.\n\t\t\t\t\tlength = this._unescapedDateMap.get(prospectiveReplacementKey).length;\n\t\t\t\t} else if (this._nestedLookupMap.has(prospectiveReplacementKey)) {\n\t\t\t\t\t// The length of a Nested Lookup replacement is the length of the string it replaces.\n\t\t\t\t\tlength = this._nestedLookupMap.get(prospectiveReplacementKey).length;\n\t\t\t\t} else {\n\t\t\t\t\t// The length of an actual string is the string's length, plus 2 to account for the open/close quotes.\n\t\t\t\t\tlength = ast.value.length + 2;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"number\":\n\t\t\t\t// The length of a Number Node is the length of the number it represents.\n\t\t\t\tlength = ast.value.toString().length;\n\t\t\t\tbreak;\n\t\t\tcase \"bool\":\n\t\t\t\t// The length of a Boolean Node is the length of the string representing its value.\n\t\t\t\t// 'true' is 4 characters, while 'false' is 5.\n\t\t\t\tlength = ast.value ? 4 : 5;\n\t\t\t\tbreak;\n\t\t\tcase \"null\":\n\t\t\t\t// The length of a null value is the length of the string 'null', i.e. 4\n\t\t\t\tlength = 4;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow Error('Unexpected node type ' + ast.type);\n\t\t}\n\t\tif (ast.paren === true) {\n\t\t\tlength += 2;\n\t\t}\n\t\tast.length = length;\n\t\treturn length;\n\t}\n\n\t/**\n\t * Given an Abstract Syntax Tree whose length nodes have been defined, recursively calculates the minimum possible length\n\t * for this node, i.e. the largest length of the set of nodes created should this node be maximally split.\n\t * @param {Object} ast - A Node in an AST.\n\t * @param {String} ast.type - Indicates what type of node is represented.\n\t * @param {number} ast.length - Indicates the length of the represented string.\n\t * @param {boolean} preserveOverallSpecificity - If false, all possible splits are considered, even those that make\n\t * the query less selective.\n\t * @returns {number} The node's newly-set .minLength property.\n\t * @private\n\t */\n\t_recursivelySetMinLengthOnAstNodes(ast, preserveOverallSpecificity) {\n\t\t// How small we can shrink the AST depends on the type of the AST node.\n\t\tlet effectiveMinimumSize;\n\t\tswitch (ast.type) {\n\t\t\tcase 'expr_list':\n\t\t\t\t// An Expression List cannot be made shorter than the length of the longest element in the list, plus\n\t\t\t\t// 2 for the wrapping parenthesis.\n\t\t\t\tlet lengths = ast.value.map((subAst) => {return this._recursivelySetMinLengthOnAstNodes(subAst, preserveOverallSpecificity) + 2;});\n\t\t\t\teffectiveMinimumSize = Math.max.apply(this, lengths);\n\t\t\t\tbreak;\n\t\t\tcase 'binary_expr':\n\t\t\t\t// The minimum possible size for a Binary Expression depends on what that expression is.\n\t\t\t\tlet performDefaultSplit = true;\n\t\t\t\tswitch (ast.operator) {\n\t\t\t\t\tcase 'AND':\n\t\t\t\t\t\t// If we're trying to preserve the specificity of the query as a whole, then we should process\n\t\t\t\t\t\t// ANDs the way we process all non-OR binary expressions. If we don't care about changing the\n\t\t\t\t\t\t// specificity of the query, we can process ANDs just like ORs.\n\t\t\t\t\t\tif (preserveOverallSpecificity) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tcase 'OR':\n\t\t\t\t\t\t// An OR expression's minimum length is the larger minimum length between the sides.\n\t\t\t\t\t\tlet minLeftOrLength = this._recursivelySetMinLengthOnAstNodes(ast.left, preserveOverallSpecificity);\n\t\t\t\t\t\tlet minRightOrLength = this._recursivelySetMinLengthOnAstNodes(ast.right, preserveOverallSpecificity);\n\t\t\t\t\t\tlet largerMin = Math.max(minLeftOrLength, minRightOrLength);\n\t\t\t\t\t\t// If this OR is wrapped in parentheses, then we don't want to lose those parentheses during a split,\n\t\t\t\t\t\t// so we need to take them into account in the length.\n\t\t\t\t\t\tif (ast.paren) {\n\t\t\t\t\t\t\tlargerMin += 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\teffectiveMinimumSize = largerMin;\n\t\t\t\t\t\tperformDefaultSplit = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Other Binary Expressions cannot be made smaller than the sums of the minimum length of each\n\t\t\t\t// side, plus the inherent length of the expression itself.\n\t\t\t\tif (!performDefaultSplit) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlet inherentLength = ast.length - (ast.left.length + ast.right.length);\n\t\t\t\tlet minLeftLength = this._recursivelySetMinLengthOnAstNodes(ast.left, preserveOverallSpecificity);\n\t\t\t\tlet minRightLength = this._recursivelySetMinLengthOnAstNodes(ast.right, preserveOverallSpecificity);\n\t\t\t\teffectiveMinimumSize = inherentLength + minLeftLength + minRightLength;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t// All other nodes cannot be split below their true size.\n\t\t\t\teffectiveMinimumSize = ast.length;\n\t\t}\n\t\tast.minLength = effectiveMinimumSize;\n\t\treturn effectiveMinimumSize;\n\t}\n\n\t/**\n\t * Given a node in an Abstract Syntax tree, returns an array of Nodes representing a split of the given node, such\n\t * that no returned node's length property exceeds the targetSize.\n\t * @param {Object} ast - An AST node\n\t * @param {number} targetSize - The maximum size for a returned node.\n\t * @param {boolean} preserveOverallSpecificity - If true, the combined result sets of the returned nodes will be\n\t * exactly equal to the result set of the original node. If false, the returned nodes may represent a less selective\n\t * query than the original node.\n\t * @returns {Array.<Object>}\n\t * @private\n\t */\n\t_recursivelySplitUntilTargetSizeReached(ast, targetSize, preserveOverallSpecificity) {\n\t\t// First, check whether we actually even need to split this node.\n\t\tif (ast.length <= targetSize) {\n\t\t\treturn [ast];\n\t\t}\n\t\t// After determining that a split is necessary, the specifics of the split depend on the type of node.\n\t\tswitch (ast.type) {\n\t\t\tcase 'expr_list':\n\t\t\t\t// To split an Expression List, we create additional lists containing subsets of the original list.\n\t\t\t\tlet partialLists = [[]];\n\t\t\t\t// Each entry in the partial list must be separated by a comma and a space. To let us treat the first\n\t\t\t\t// entry like the rest, we'll start the size at -2 so the non-existent comma and space don't count.\n\t\t\t\tlet currentPartialListSize = -2;\n\t\t\t\tlet currentPartialListIndex = 0;\n\t\t\t\tast.value.forEach((valueNode) => {\n\t\t\t\t\tif (valueNode.length + 2 + currentPartialListSize > targetSize) {\n\t\t\t\t\t\t// If the current value node can't fit in the current partial list, start a new partial list.\n\t\t\t\t\t\tpartialLists.push([valueNode]);\n\t\t\t\t\t\tcurrentPartialListIndex++;\n\t\t\t\t\t\tcurrentPartialListSize = valueNode.length;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the current value node fits in the current partial list, add it to that list.\n\t\t\t\t\t\tpartialLists[currentPartialListIndex].push(valueNode);\n\t\t\t\t\t\t// Add an extra +2 to account for the ', '.\n\t\t\t\t\t\tcurrentPartialListSize += valueNode.length + 2;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// After all of the nodes have been divided into lists, create enough IN expressions to hold them.\n\t\t\t\tlet splitListExpressions = [];\n\t\t\t\tfor (let i = 0; i < partialLists.length; i++) {\n\t\t\t\t\tlet copiedListExpression = JSON.parse(JSON.stringify(ast));\n\t\t\t\t\tcopiedListExpression.value = partialLists[i];\n\t\t\t\t\tsplitListExpressions.push(copiedListExpression);\n\t\t\t\t}\n\t\t\t\treturn splitListExpressions;\n\t\t\tcase 'binary_expr':\n\t\t\t\t// How we handle Binary Expressions depends on the type of Expression.\n\t\t\t\tswitch (ast.operator) {\n\t\t\t\t\tcase 'AND':\n\t\t\t\t\t\tif (preserveOverallSpecificity) {\n\t\t\t\t\t\t\t// To split an AND without reducing specificity, we split one or both sides of the AND, then\n\t\t\t\t\t\t\t// recombine them into multiple ANDs that are equivalent to the original.\n\t\t\t\t\t\t\t// e.g., \"(A OR B) AND (C OR D)\" is equivalent to the combined results of\n\t\t\t\t\t\t\t// \"A AND C\", \"A AND D\", \"B AND C\", and \"B AND D\".\n\t\t\t\t\t\t\tlet leftTargetLength;\n\t\t\t\t\t\t\tlet rightTargetLength;\n\t\t\t\t\t\t\tlet splitLeftAsts;\n\t\t\t\t\t\t\tlet splitRightAsts;\n\t\t\t\t\t\t\t// We determine the splits somewhat naively, but given that this is a variant of the Bin-Packing\n\t\t\t\t\t\t\t// problem, and therefore NP-Hard, we shouldn't lose any sleep over it.\n\n\t\t\t\t\t\t\t// First, check if we can get below the desired length by splitting just one of the sides.\n\t\t\t\t\t\t\tlet leftSideSplitSufficient = targetSize > ast.length - ast.left.length + ast.left.minLength;\n\t\t\t\t\t\t\tlet rightSideSplitSufficient = targetSize > ast.length - ast.right.length + ast.right.minLength;\n\n\t\t\t\t\t\t\tif (leftSideSplitSufficient) {\n\t\t\t\t\t\t\t\t// If splitting just the left side is sufficient, do that.\n\t\t\t\t\t\t\t\t// Our goal is to get the left side smaller than the difference between the target size\n\t\t\t\t\t\t\t\t// and the rest of the expression. We know this is doable because the left side's minimum\n\t\t\t\t\t\t\t\t// length is smaller than that number.\n\t\t\t\t\t\t\t\t// i.e. the inequality in leftSideSplitSufficient can be rearranged as\n\t\t\t\t\t\t\t\t// targetSize - (ast.length - ast.left.length) > ast.left.minLength.\n\t\t\t\t\t\t\t\tleftTargetLength = targetSize - (ast.length - ast.left.length);\n\t\t\t\t\t\t\t\tsplitLeftAsts = this._recursivelySplitUntilTargetSizeReached(ast.left, leftTargetLength, preserveOverallSpecificity);\n\t\t\t\t\t\t\t\tsplitRightAsts = [ast.right];\n\t\t\t\t\t\t\t} else if (rightSideSplitSufficient) {\n\t\t\t\t\t\t\t\t// Otherwise, if splitting just the right side is sufficient, do that.\n\t\t\t\t\t\t\t\t// The logic is the inverse of the above if-branch.\n\t\t\t\t\t\t\t\trightTargetLength = targetSize - (ast.length - ast.right.length);\n\t\t\t\t\t\t\t\tsplitLeftAsts = [ast.left];\n\t\t\t\t\t\t\t\tsplitRightAsts = this._recursivelySplitUntilTargetSizeReached(ast.right, rightTargetLength, preserveOverallSpecificity);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Otherwise, we know we need to split both sides, and must decide how to allocate that split.\n\t\t\t\t\t\t\t\t// We can trivially prove by contradiction that the minimum length of at least one side\n\t\t\t\t\t\t\t\t// must be less than half of the target length. So we'll identify that side, and split\n\t\t\t\t\t\t\t\t// that side to the minLength. The other side is split to the larger of its minLength\n\t\t\t\t\t\t\t\t// and half of the target length.\n\t\t\t\t\t\t\t\t// It's a bit naive, but it's guaranteed to split both sides such that the sum is less\n\t\t\t\t\t\t\t\t// than the target length.\n\t\t\t\t\t\t\t\tlet fullLeftSplit = ast.left.minLength < targetSize / 2;\n\t\t\t\t\t\t\t\tleftTargetLength = fullLeftSplit ? ast.left.minLength : Math.max(ast.left.minLength, targetSize / 2);\n\t\t\t\t\t\t\t\trightTargetLength = fullLeftSplit ? Math.max(ast.right.minLength, targetSize / 2) : ast.right.minLength;\n\t\t\t\t\t\t\t\tsplitLeftAsts = this._recursivelySplitUntilTargetSizeReached(ast.left, leftTargetLength, preserveOverallSpecificity);\n\t\t\t\t\t\t\t\tsplitRightAsts = this._recursivelySplitUntilTargetSizeReached(ast.right, rightTargetLength, preserveOverallSpecificity);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Now that we've split each side, we need to recombine them into a number of AND expressions\n\t\t\t\t\t\t\t// equal to the product of the lengths of the lists.\n\t\t\t\t\t\t\tlet combinedAnds = [];\n\t\t\t\t\t\t\tsplitLeftAsts.forEach((left) => {\n\t\t\t\t\t\t\t\tsplitRightAsts.forEach((right) => {\n\t\t\t\t\t\t\t\t\tlet copiedAnd = JSON.parse(JSON.stringify(ast));\n\t\t\t\t\t\t\t\t\tcopiedAnd.left = left;\n\t\t\t\t\t\t\t\t\tcopiedAnd.right = right;\n\t\t\t\t\t\t\t\t\tcombinedAnds.push(copiedAnd);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn combinedAnds;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If we're ignoring specificity, then ANDs split just like ORs, but we need to flag that we've\n\t\t\t\t\t\t// changed the overall specificity of the query.\n\t\t\t\t\t\tthis._overallSpecificityPreserved = false;\n\t\t\t\t\tcase 'OR':\n\t\t\t\t\t\t// To split an OR expression, return an Array containing the results of splitting each side until\n\t\t\t\t\t\t// it's in the target range.\n\t\t\t\t\t\t// If the OR clause is wrapped in parentheses, we'll want to keep those. As such, our target length\n\t\t\t\t\t\t// is decreased by two to account for that.\n\t\t\t\t\t\tlet targetOrSize = ast.paren ? targetSize - 2 : targetSize;\n\t\t\t\t\t\tlet splitLeftSide = this._recursivelySplitUntilTargetSizeReached(ast.left, targetOrSize, preserveOverallSpecificity);\n\t\t\t\t\t\tlet splitRightSide = this._recursivelySplitUntilTargetSizeReached(ast.right, targetOrSize, preserveOverallSpecificity);\n\t\t\t\t\t\tlet splitOrs = [...splitLeftSide, ...splitRightSide];\n\t\t\t\t\t\t// If the parent OR isn't wrapped in parentheses, we're good. But if it is, we need to wrap the\n\t\t\t\t\t\t// sub expressions in parentheses in order to avoid accidentally changing the query.\n\t\t\t\t\t\tif (ast.paren) {\n\t\t\t\t\t\t\tsplitOrs.forEach((or) => {\n\t\t\t\t\t\t\t\tor.paren = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!preserveOverallSpecificity) {\n\t\t\t\t\t\t\tsplitOrs.forEach((subTree) => {\n\t\t\t\t\t\t\t\tsubTree.splitNodeKeys.push(ast.operator + '_' + ast.nodeKey);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn splitOrs;\n\t\t\t\t\tcase 'IN':\n\t\t\t\t\t\t// To split an IN expression, first identify the target length for the expression list on the right side.\n\t\t\t\t\t\t// The right side needs to be made small enough to be less than the target size even accounting for\n\t\t\t\t\t\t// the inherent size of an IN expression.\n\t\t\t\t\t\tlet inherentInLength = ast.length - ast.right.length;\n\t\t\t\t\t\tlet splitLists = this._recursivelySplitUntilTargetSizeReached(ast.right, targetSize - inherentInLength, preserveOverallSpecificity);\n\t\t\t\t\t\tlet splitIns = [];\n\t\t\t\t\t\tlet splitNodeKey = preserveOverallSpecificity ? undefined : (ast.operator + '_' + ast.nodeKey);\n\t\t\t\t\t\tast.splitNodeKeys.push(splitNodeKey);\n\t\t\t\t\t\tsplitLists.forEach((list) => {\n\t\t\t\t\t\t\tlet copiedIn = JSON.parse(JSON.stringify(ast));\n\t\t\t\t\t\t\tcopiedIn.right = list;\n\t\t\t\t\t\t\tsplitIns.push(copiedIn);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn splitIns;\n\t\t\t\t}\n\t\t\t// No other Binary Expressions can be split, and as such they should fall through to the Default.\n\t\t\tdefault:\n\t\t\t\t// Any AST that is unsplittable should return a singleton array containing only itself.\n\t\t\t\treturn [ast];\n\t\t}\n\t}\n}\n\nmodule.exports = WhereClauseSplitter;\n/*\n let basicClause = \"Id = 'eighteenCharId0001'\";\n let basicOr = \"Id = 'eighteenCharId0002' OR Name = 'This is my name'\";\n let basicAnd = \"Id = 'eighteenCharId0003' AND Name = 'This is my name'\";\n let basicIn = \"Color IN ('red', 'green', 'blue', 'pink')\";\n\n let nullTest = \"CreatedDate__c != null OR CreatedDate__c = '2015-03-21'\";\n\n let softSplittableAnd = \"(Id = 'eighteenCharId0004' OR Name = 'this is my name') AND Color IN ('red', 'green', 'blue', 'pink')\";\n let simpleParenOr = \"A = true OR (B = true OR C = true OR D = true)\";\n let complexParenOr = \"A = true OR ((B = true OR C = true) OR ((D = true OR (E = true OR F = true)) OR G = true) OR H = true)\";\n\n let replaceUnescapedDate = \"CreatedDate__c < 2015-02-21 OR Id = 'eighteenCharId0005'\";\n let keepEscapedDate = \"CreatedDate__c < '2015-02-21' OR Id = 'eighteenCharId0005'\";\n\n let nestedLookup = \"Quote__r.Opportunity2__r.Name = 'PINK' OR Id = 'eighteenCharId0006'\";\n let deeplyNestedLookup = \"Quote__r.Opportunity2__r.Account__r.Beep__r.Boop__r.Field__c = 'PINK' OR Quote__r.Opportunity2__r.Account__r.Beep__r.Boop__r.OtherField__c = 'BLUE'\";\n\n let simpleSemiJoin = \"Id IN (SELECT Quote__c FROM QuoteLine__c WHERE Name = 'blue') OR Id = 'eighteenCharId0007'\";\n let escapedSemiJoin = \"Contents__c IN ('Id IN (SELECT ') OR Id = 'eighteenCharId0008'\";\n\n let sampleRootIdQuery =\n \"(SBQQ__Contract__r.SBQQ__PreserveBundleStructure__c = true \" +\n \"AND SBQQ__Contract__c = 'Id000015134' \" +\n \"AND (SBQQ__RootId__c IN ('eighteenCharId0009', 'eighteenCharId0010', 'eighteenCharId0011') \" +\n \"OR SBQQ__RevisedSubscription__r.SBQQ__RootId__c IN ('eighteenCharId0009', 'eighteenCharId0010', 'eighteenCharId0011')))\" +\n \" OR \" +\n \"(SBQQ__Contract__r.SBQQ__PreserveBundleStructure__c = true AND SBQQ__Contract__c = 'Id000015135' \" +\n \"AND (SBQQ__RootId__c IN ('eighteenCharId0012', 'eighteenCharId0013', 'eighteenCharId0014') OR SBQQ__RevisedSubscription__r.SBQQ__RootId__c IN ('eighteenCharId0012', 'eighteenCharId0013', 'eighteenCharId0014')))\";\n\n let splitter = new WhereClauseSplitter();\n\n console.log(JSON.stringify(splitter.splitWhereClause(basicClause, 50)));\n try {\n console.log(JSON.stringify(splitter.splitWhereClause(basicClause, 20)));\n } catch (e) {\n console.log('could not split basic clause below 25');\n }\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(basicOr, 60)));\n console.log(JSON.stringify(splitter.splitWhereClause(basicOr, 50)));\n try {\n console.log(JSON.stringify(splitter.splitWhereClause(basicOr, 20)));\n } catch (e) {\n console.log('could not split basic or below 25');\n }\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(basicAnd, 60)));\n console.log(JSON.stringify(splitter.splitWhereClause(basicAnd, 50)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(basicIn, 50)));\n console.log(JSON.stringify(splitter.splitWhereClause(basicIn, 30)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(softSplittableAnd, 105)));\n console.log(JSON.stringify(splitter.splitWhereClause(softSplittableAnd, 80)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(simpleParenOr, 50)));\n console.log(JSON.stringify(splitter.splitWhereClause(simpleParenOr, 45)));\n console.log(JSON.stringify(splitter.splitWhereClause(simpleParenOr, 30)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(complexParenOr, 50)));\n console.log(JSON.stringify(splitter.splitWhereClause(complexParenOr, 95)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(replaceUnescapedDate, 50)));\n console.log(JSON.stringify(splitter.splitWhereClause(keepEscapedDate, 50)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(nestedLookup, 60)));\n console.log(JSON.stringify(splitter.splitWhereClause(deeplyNestedLookup, 90)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(simpleSemiJoin, 80)));\n console.log(JSON.stringify(splitter.splitWhereClause(escapedSemiJoin, 60)));\n console.log('===');\n\n console.log(JSON.stringify(splitter.splitWhereClause(sampleRootIdQuery, 200)));\n\n console.log(JSON.stringify(splitter.splitWhereClause(nullTest, 30)));\n*/","/**\n * Created by jfeingold on 5/10/17.\n */\n'use strict'\n\nvar globalCache = new Map();\nlet jsLogger = require('js-logger').logger.getLogger('JSAR Perf');\n\nclass FieldMetadataService {\n\t/**\n\t *\n\t * @param {Connection} conn A JSForce connection object\n\t * @param {Object} fmsSettings An object storing the settings for amending/renewals.\n\t * @param {String} fmsSettings.salesCloudPrefix - The prefix used by fields in the Salesforce CPQ Sales Cloud package.\n\t * @param {String} fmsSettings.serviceCloudPrefix - The prefix used by fields in the Salesforce CPQ Service Cloud package.\n\t * @param {String} fmsSettings.userId - The ID of the current user. Used for logging purposes.\n\t * @param {Object} fmsSettings.labels - A mapping from the API names of labels to their text.\n\t * @constructor\n\t */\n\tconstructor(conn, fmsSettings) {\n\t\tthis._conn = conn;\n\t\tthis._salesCloudPrefix = fmsSettings.salesCloudPrefix ? fmsSettings.salesCloudPrefix.toLowerCase() : \"\";\n\t\tthis._serviceCloudPrefix = fmsSettings.serviceCloudPrefix ? fmsSettings.serviceCloudPrefix.toLowerCase() : '';\n\t\tthis._userId = fmsSettings.userId;\n\t\tthis._labels = fmsSettings.labels;\n\t\tlet inBrowser = typeof window !== 'undefined';\n\t\t// If we're in the browser, we want to reuse the global cache to increase performance. But if we're in Heroku,\n\t\t// we need to get a fresh cache with every transaction, so we instantiate a new map.\n\t\tthis._cache = inBrowser ? globalCache : new Map();\n\t\tthis._logger = jsLogger;\n\t}\n\n\t_logMessage(msg) {\n\t\tthis._logger.info(msg);\n\t}\n\n\t/**\n\t * Identifies all of the fields that can map from the source object to the target object.\n\t * @param {String} srcType An SObject type from which fields should map.\n\t * @param {String} destType An SObject type to which fields should map.\n\t * @returns {Promise} Resolves to an array of field names.\n\t */\n\tgetSharedMappableFieldNames(srcType, destType) {\n\t\t// First, check if we already have a cached response for this pairing.\n\t\tlet cacheKey = srcType + ':' + destType;\n\t\tif (this._cache.has(cacheKey)) {\n\t\t\treturn Promise.resolve(this._cache.get(cacheKey));\n\t\t}\n\t\tlet srcPromise = this.getMappableFields(srcType);\n\t\tlet destPromise = this.getMappableFields(destType);\n\n\t\tthis._logMessage('FieldMetadataService.js: Get mappable fields. SessionId=' + this._userId);\n\t\tlet getMappableFields = Date.now();\n\t\treturn Promise.all([srcPromise, destPromise])\n\t\t\t.then((arrs) => {\n\t\t\t\tthis._logMessage('FieldMetadataService.js: Getting mappable fields took ' + (Date.now() - getMappableFields) + ' ms. SessionId=' + this._userId);\n\t\t\t\tlet sharedFields = [];\n\t\t\t\tlet srcFields = arrs[0].fieldArray;\n\t\t\t\tlet destFields = arrs[1].fieldMap;\n\t\t\t\tlet srcFieldCount = srcFields.length;\n\t\t\t\tfor (let i = 0; i < srcFieldCount; i++) {\n\t\t\t\t\tlet srcField = srcFields[i];\n\t\t\t\t\tlet destField = destFields.get(srcField.name);\n\t\t\t\t\t// If a field with the same name exists on the destination object, and they're compatible for mapping,\n\t\t\t\t\t// add the name to the list.\n\t\t\t\t\tif (destField && this._fieldsAreCompatible(srcField, destField)) {\n\t\t\t\t\t\tsharedFields.push(destField.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._cache.set(cacheKey, sharedFields);\n\t\t\t\treturn sharedFields;\n\t\t\t}, (reason) => {\n\t\t\t\t// If either of the promises rejected, throw an error.\n\t\t\t\tthrow new Error(reason);\n\t\t\t});\n\t}\n\n\t/**\n\t * Resolves to an object that summarizes information about the mappable fields on the provided SObject type.\n\t * @param {String} objType - The API name for some SObject type.\n\t * @returns {Promise<{fieldMap: Map.<String,JSON>, fieldArray: JSON[]}>}\n\t */\n\tgetMappableFields(objType) {\n\t\t// First, check if we already have a cached list of the mappable fields.\n\t\tif (this._cache.has('mappableFields') && this._cache.get('mappableFields')[objType]) {\n\t\t\treturn Promise.resolve(this._cache.get('mappableFields')[objType]);\n\t\t} else {\n\t\t\t// If there's no cached field list, we need to check if there's even a cached value to store such a list.\n\t\t\t// If not, we need to create one.\n\t\t\tif (!this._cache.has('mappableFields')) {\n\t\t\t\tthis._cache.set('mappableFields', {});\n\t\t\t}\n\t\t}\n\t\treturn this._getObjectDescribe(objType)\n\t\t\t.then((objDescribe) => {\n\t\t\t\tlet mappableFieldSummary = this._sweepDescribeForMappableFields(objDescribe);\n\t\t\t\tthis._cache.get('mappableFields')[objType] = mappableFieldSummary;\n\t\t\t\treturn mappableFieldSummary;\n\t\t\t}, (err) => {\n\t\t\t\t// It's possible that the error we received is arcane or unclear. So we prefix it with a clear and\n\t\t\t\t// informative header.\n\t\t\t\tlet header = this._labels.msg_could_not_retrieve_mappable_fields\n\t\t\t\t\t.replace('{0}', objType);\n\t\t\t\treturn Promise.reject(header + (err.message || err));\n\t\t\t});\n\t}\n\n\tcheckExistenceOfFields(objType, fieldArray) {\n\t\t// We cache the values in the form of an object whose keys are the names used to reference a field, and whose\n\t\t// values are the API names of those fields where they exist, or false where they don't.\n\t\t// Start with an empty object by default.\n\t\tlet cachedApiNamesByGenericName = {};\n\t\tif (this._cache.has('fieldExistence') && this._cache.get('fieldExistence')[objType]) {\n\t\t\t// If there's already a cached value for field-existence checks on this SObject, we can use that instead\n\t\t\t// of an empty object.\n\t\t\tcachedApiNamesByGenericName = this._cache.get('fieldExistence')[objType];\n\t\t} else if (!this._cache.has('fieldExistence')) {\n\t\t\t// If there's no cached object for storing field existence information, create one.\n\t\t\tthis._cache.set('fieldExistence', {});\n\t\t}\n\n\t\t// Now, check each field to see whether we already know if it exists.\n\t\tlet existentFieldsMap = {};\n\t\tlet unknownFields = [];\n\t\tfieldArray.forEach((field) => {\n\t\t\tif (cachedApiNamesByGenericName[field]) {\n\t\t\t\texistentFieldsMap[field] = cachedApiNamesByGenericName[field];\n\t\t\t} else if (cachedApiNamesByGenericName[field] === undefined) {\n\t\t\t\tunknownFields.push(field);\n\t\t\t}\n\t\t});\n\n\t\t// If the unknown fieldlist is empty, we can just return the array of existent fields.\n\t\tif (unknownFields.length === 0) {\n\t\t\treturn Promise.resolve(existentFieldsMap);\n\t\t} else {\n\t\t\t// If not, we need to actually check the describe to see which fields exist.\n\t\t\treturn this._getObjectDescribe(objType)\n\t\t\t\t.then((objDesc) => {\n\t\t\t\t\t// For all of the fields on the describe, we check if the field ends with one of the unknown field names.\n\t\t\t\t\t// We have to do that because of prefixing. It's possible that a magic field has a prefix we're unaware of.\n\t\t\t\t\tlet fieldCount = objDesc.fields.length;\n\t\t\t\t\tfor (let i = 0; i < fieldCount; i++) {\n\t\t\t\t\t\tlet fieldDesc = objDesc.fields[i];\n\t\t\t\t\t\tlet indexOfMatchingUnknownField = unknownFields.findIndex((f) => {return fieldDesc.name.endsWith(f);});\n\t\t\t\t\t\tif (indexOfMatchingUnknownField !== -1) {\n\t\t\t\t\t\t\tlet matchingUnknownField = unknownFields[indexOfMatchingUnknownField];\n\t\t\t\t\t\t\t// If we found a matching field, we add it to the cache and the map we'll be returning.\n\t\t\t\t\t\t\tcachedApiNamesByGenericName[matchingUnknownField] = fieldDesc.name;\n\t\t\t\t\t\t\texistentFieldsMap[matchingUnknownField] = fieldDesc.name;\n\t\t\t\t\t\t\t// We also want to remove the found field from the array of unknown fields to prevent it being\n\t\t\t\t\t\t\t// matched again.\n\t\t\t\t\t\t\tunknownFields = unknownFields.filter((el, index) => {return index !== indexOfMatchingUnknownField});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// At this point, we know that any fields still in the unknown field array are definitely not\n\t\t\t\t\t// real fields, so we can mark them as nonexistent.\n\t\t\t\t\tunknownFields.forEach((nonexistentField) => {\n\t\t\t\t\t\tcachedApiNamesByGenericName[nonexistentField] = false;\n\t\t\t\t\t});\n\t\t\t\t\t// Now we recache the field existence object and return the result.\n\t\t\t\t\tthis._cache.get('fieldExistence')[objType] = cachedApiNamesByGenericName;\n\t\t\t\t\treturn existentFieldsMap;\n\t\t\t\t})\n\t\t}\n\t}\n\n\tgetFieldDescribe(objType, fieldName) {\n\t\t// First, check whether there's a cached result for this specific field.\n\t\tif (this._cache.has('fieldDescribe') && this._cache.get('fieldDescribe')[objType + fieldName]) {\n\t\t\t// If there's already a cached describe result, resolve to it.\n\t\t\treturn Promise.resolve(this._cache.get('fieldDescribe')[objType + fieldName]);\n\t\t} else if (!this._cache.has('fieldDescribe')) {\n\t\t\t// If there's not a cache value for storing field describe results, then create such a value.\n\t\t\tthis._cache.set('fieldDescribe', {});\n\t\t}\n\t\treturn this._getObjectDescribe(objType)\n\t\t\t.then((objDescribe) => {\n\t\t\t\tlet fieldDescribe = objDescribe.fields.find((field) => {return field.name === fieldName});\n\t\t\t\tif (fieldDescribe) {\n\t\t\t\t\tthis._cache.get('fieldDescribe')[objType + fieldName] = fieldDescribe;\n\t\t\t\t\treturn fieldDescribe;\n\t\t\t\t} else {\n\t\t\t\t\tlet noSuchFieldMessage = this._labels.msg_no_such_field\n\t\t\t\t\t\t.replace('{0}', fieldName)\n\t\t\t\t\t\t.replace('{1}', objType);\n\t\t\t\t\treturn Promise.reject(noSuchFieldMessage);\n\t\t\t\t}\n\t\t\t}, (err) => {\n\t\t\t\t// It's possible the error we received was arcane or unclear. So be sure to prefix it with a clear and\n\t\t\t\t// informative header.\n\t\t\t\tlet msgHeader = this._labels.msg_could_not_retrieve_field_describe\n\t\t\t\t\t.replace('{0}', objType)\n\t\t\t\t\t.replace('{1}', fieldName);\n\t\t\t\treturn Promise.reject(msgHeader + (err.message || err));\n\t\t\t})\n\t}\n\n\t/**\n\t * Returns whether the object is updateable\n\t * @param {String} objType - Name of Object to check\n\t * @returns {Promise}\n\t */\n\tisObjectUpdateable(objType) {\n\t\tif(!this._cache.has('objectPermissions')) {\n\t\t\tthis._cache.set('objectPermissions', {});\n\t\t}\n\t\tif(!this._cache.get('objectPermissions')[objType]) {\n\t\t\tthis._cache.get('objectPermissions')[objType] = {};\n\t\t} else if(this._cache.get('objectPermissions')[objType].updateable != 'undefined') {\n\t\t\treturn Promise.resolve(this._cache.get('objectPermissions')[objType].updateable);\n\t\t}\n\n\t\treturn this._getObjectDescribe(objType)\n\t\t\t.then((objDescribe) => {\n\t\t\t\tthis._cache.get('objectPermissions')[objType].updateable = objDescribe.updateable;\n\t\t\t\treturn objDescribe.updateable;\n\t\t\t}, (err) => {\n\t\t\t\t// It's possible the error message we received was arcane or unclear. So be sure to prefix it with a\n\t\t\t\t// clear and informative header.\n\t\t\t\tlet msgHeader = this._labels.msg_could_not_retrieve_crud.replace('{0}', objType);\n\t\t\t\treturn Promise.reject(msgHeader + (err.message || err));\n\t\t\t})\n\t}\n\n\t_getObjectDescribe(objType) {\n\t\tif (this._cache.has(objType)) {\n\t\t\treturn Promise.resolve(this._cache.get(objType));\n\t\t} else {\n\t\t\tlet jsForceStartTime = Date.now();\n\t\t\tthis._logMessage('FieldMetadataService.js: JSForce call for object describe on ' + objType + '. SessionId=' + this._userId);\n\t\t\treturn this._conn.sobject(objType)\n\t\t\t\t.describe()\n\t\t\t\t.then((res) => {\n\t\t\t\t\tthis._logMessage('FieldMetadataService.js: JSForce call for object describe on ' + objType + ' took ' + (Date.now() - jsForceStartTime) + ' ms. SessionId=' + this._userId);\n\t\t\t\t\tthis._cache.set(objType, res);\n\t\t\t\t\treturn res;\n\t\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * Identifies all mappable fields in the provided SObject Describe results, and returns them both in an array\n\t * and mapped by their API name.\n\t * @param {Object} sobjectData - The Describe results for a particular SObject type.\n\t * @returns {{fieldArray: Array.<JSON>, fieldMap: Map.<String,JSON>}}\n\t * @private\n\t */\n\t_sweepDescribeForMappableFields(sobjectData) {\n\t\tlet fields = sobjectData.fields;\n\t\tlet mfArray = [];\n\t\tlet mfMap = new Map();\n\t\tlet fieldCount = fields.length;\n\t\tfor (let i = 0; i < fieldCount; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tif (this._isFieldMappable(field)) {\n\t\t\t\tmfArray.push(field);\n\t\t\t\tmfMap.set(field.name, field);\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\t'fieldArray': mfArray,\n\t\t\t'fieldMap': mfMap\n\t\t};\n\t}\n\n\t/**\n\t * Analyzes the provided field describe result to determine whether the field is mappable.\n\t * @param {Object} field - Field Describe Result for a Salesforce Custom Field.\n\t * @returns {boolean} True if the field is mappable. False otherwise.\n\t * @private\n\t */\n\t_isFieldMappable(field) {\n\t\t// Only custom fields can be mappable.\n\t\tif (!field.custom) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet lcName = field.name.toLowerCase();\n\n\t\t// If either prefix is non-null and the field's name starts with the prefix, then it's only mappable if its true\n\t\t// name starts with sbcustom. That's a workaround to allow prefixed developer orgs to simulate mappable fields.\n\t\tif (this._salesCloudPrefix !== '' && lcName.startsWith(this._salesCloudPrefix)) {\n\t\t\treturn lcName.startsWith(this._salesCloudPrefix + 'sbcustom');\n\t\t} else if (this._serviceCloudPrefix !== '' && lcName.startsWith(this._serviceCloudPrefix)) {\n\t\t\treturn lcName.startsWith(this._serviceCloudPrefix + 'sbcustom');\n\t\t} else if (this._salesCloudPrefix === '' && this._serviceCloudPrefix === '') {\n\t\t\t// If both prefixes are null, then the field is only mappable if its name starts with sbcustom. Again, this\n\t\t\t// is a workaround to allow non-prefixed compiled orgs to simulate mappable fields.\n\t\t\treturn lcName.startsWith('sbcustom');\n\t\t} else {\n\t\t\t// Otherwise, the field is mappable.\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Analyzes the Describe Results for two mappable fields, and determines whether the source field can viably map to the target\n\t * field.\n\t * @param {Object} srcField - The Describe Results for a known mappable field.\n\t * @param {Object} destField - The Describe Results for a different known mappable field.\n\t * @returns {boolean} True if the source field can be mapped to the destination field.\n\t * @private\n\t */\n\t_fieldsAreCompatible(srcField, destField) {\n\t\t// If the destination field cannot be written to, then it's obviously not a compatible mapping.\n\t\tif (!destField.updateable) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If the fields are of different types, then they can't map.\n\t\tif (srcField.type !== destField.type) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If the fields are references, they can map if and only if they reference the same type.\n\t\tif (srcField.type.toLowerCase() === 'reference') {\n\t\t\treturn srcField.referenceTo[0] === destField.referenceTo[0];\n\t\t}\n\n\t\t// If none of the above apply, then the fields are mappable.\n\t\treturn true;\n\t}\n}\n\nmodule.exports = FieldMetadataService;","/**\n * Created by jfeingold on 10/5/17.\n */\nlet FieldMetadataService = require('./FieldMetadataService.js');\n\nclass ServicesManager {\n\t/**\n\t * Initializes a service object with required services initialized. Invoking this constructor directly is discouraged,\n\t * in favor of using a constructor method.\n\t * @param {object} conn - A JSForce connection\n\t * @param {Object} fmsSettings - A bundle of settings for the FieldMetadataService.\n\t */\n\tconstructor(conn, fmsSettings) {\n\t\tthis.fieldMetadataService = new FieldMetadataService(conn, fmsSettings);\n\t}\n\n\t/**\n\t * Uses the provided JSARSettings object to construct a ServicesManager.\n\t * @param {Connection} conn - A JSForce connection.\n\t * @param {JSARSettings} jsarSettings - A JSARSettings instance.\n\t * @returns {ServicesManager}\n\t * @static\n\t */\n\tstatic constructFromJsarSettings(conn, jsarSettings) {\n\t\tlet fmsSettings = {\n\t\t\tsalesCloudPrefix: jsarSettings.salesCloudPrefix,\n\t\t\tserviceCloudPrefix: jsarSettings.serviceCloudPrefix,\n\t\t\tuserId: jsarSettings.userId,\n\t\t\tlabels: jsarSettings.labels\n\t\t};\n\t\treturn new ServicesManager(conn, fmsSettings);\n\t}\n\n\t/**\n\t * Uses the provided SettingsModel object to construct a ServicesManager.\n\t * @param {Connection} conn - A JSForce connection.\n\t * @param {SettingsModel} jsqcSettings - A SettingsModel used within the JSQC.\n\t * @returns {ServicesManager}\n\t * @static\n\t */\n\tstatic constructFromJsqcSettings(conn, jsqcSettings) {\n\t\tlet fmsSettings = {\n\t\t\tsalesCloudPrefix: jsqcSettings.scSettings.salesCloudPrefix,\n\t\t\tserviceCloudPrefix: jsqcSettings.scSettings.serviceCloudPrefix,\n\t\t\tuserId: jsqcSettings.userId,\n\t\t\tlabels: jsqcSettings.jsqcLabels\n\t\t};\n\t\treturn new ServicesManager(conn, fmsSettings);\n\t}\n}\n\nmodule.exports = ServicesManager;","import {AppContext} from 'common/core/AppContext.js';\n\nlet totalTime = 0;\nlet totalComponents = 0;\nlet currentTime;\nlet deviceClasses;\nlet checkPerformance = false;\nlet quiet = true;\n\nexport class DeviceBehavior {\n\n\tready() {\n\t\tif (checkPerformance)\n\t\t\tthis.startPerformanceCheck();\n\n\t\t// toggle the device classes to the component itself and to all of its \"device\" annotated elements\n\t\tlet deviceNodes = Polymer.dom(this.root).querySelectorAll('*[device]') || [];\n\t\tlet deviceClasses = this.getDeviceClasses();\n\t\tfor (let deviceClass of deviceClasses) {\n\t\t\tthis.toggleClass(deviceClass, true, this);\n\t\t\tfor(let deviceNode of deviceNodes)\n\t\t\t\tthis.toggleClass(deviceClass, true, deviceNode);\n\t\t}\n\n\t\t// add joined device classes as property on the component in case it needs to applied via class attribute interpolation\n\t\t// class$=\"[[deviceClasses]]\"\n\t\tthis['deviceClasses'] = deviceClasses.join(' ');\n\n\t\tif(checkPerformance)\n\t\t\tthis.stopPerformanceCheck(this);\n\n\t\tif(!quiet && deviceNodes.length === 0)\n\t\t\tconsole.warn(`${this.tagName.toLowerCase()}.html is missing an element with the device attribute`);\n\t}\n\n\tgetDeviceClasses() {\n\t\tif(deviceClasses)\n\t\t\treturn deviceClasses;\n\n\t\tif(!AppContext.hasInitialized())\n\t\t\tAppContext.init(window.sb.userSettings);\n\n\t\tif(AppContext.isPhone) deviceClasses = ['--phone', '--mobile'];\n\t\telse if(AppContext.isTablet) deviceClasses = ['--tablet','--mobile'];\n\t\telse deviceClasses = ['--desktop'];\n\n\t\treturn deviceClasses;\n\t}\n\n\tstartPerformanceCheck() {\n\t\tcurrentTime = performance.now();\n\t}\n\n\tstopPerformanceCheck() {\n\t\tvar time =  performance.now() - currentTime;\n\t\ttotalTime += time;\n\t\ttotalComponents++;\n\t\tif(time > 1) console.warn(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t\telse console.log(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.DeviceBehavior = DeviceBehavior.prototype;","/**\n * Common behavior for attaching and detaching globally dispatched events.\n * The implementing class needs to supply a \"events\" property that returns a map of string names to functions.\n */\nexport class EventBehavior {\n\t\n\tattached() {\n\t\t// attach all the event listeners if they haven't already been attached\n\t\tif( !this._eventBehaviorInitialized && this.events ) {\n\t\t\tthis._eventBehaviorListeners = {};\n\t\t\tfor( let e in this.events ) {\n\t\t\t\tlet f = this.events[e];\n\t\t\t\tif( f && typeof f == 'function' ) {\n\t\t\t\t\tlet boundFunction = f.bind(this);\n\t\t\t\t\tthis._eventBehaviorListeners[e] = boundFunction;\n\t\t\t\t\twindow.addEventListener(e, boundFunction);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._eventBehaviorInitialized = true;\n\t\t}\n\t}\n\n\tdetached() {\n\t\t// detach all the event listeners\n\t\tif (this._eventBehaviorListeners ) {\n\t\t\tfor( let e in this._eventBehaviorListeners ) {\n\t\t\t\twindow.removeEventListener(e, this._eventBehaviorListeners[e]);\n\t\t\t}\n\t\t\tthis._eventBehaviorInitialized = false;\n\t\t}\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.EventBehavior = EventBehavior.prototype;","import {AppContext} from 'common/core/AppContext.js';\n\nexport class LookupBehavior {\n\tready() {\n\t\tthis.handleProductsLoadServerResponse();\n\t\tthis.handleHideSearchFilterIfNoSearchColumnsDisplayed();\n\t\tthis.bindFilterEnterCallBacks();\n\t}\n\n\thandleHideSearchFilterIfNoSearchColumnsDisplayed() {\n\t\tthis.addEventListener('no-displayed-filters', function () {\n\t\t\tthis.removeFilter();\n\t\t}.bind(this));\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.LookupBehavior = LookupBehavior.prototype;","/**\n * Copyright, 1999-2019, salesforce.com All Rights Reserved Company Confidential\n *\n * Inline edit behavior for use in different components that require inline edit\n *\n * @author dgoldberg\n * @since 224\n */\n\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {DateParser} from \"common/forms/DateParser.js\";\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Util} from 'common/Util.js';\n\nexport class SFInlineEditBehavior {\n\n\t/**\n\t * Hide/show edit field\n\t * When inline edit begins, turn off other inline edit fields on the same row to ensure only one field is being edited at any time\n\t * When inline edit ends, update the templateInstance with formatted data\n\t * @param container\n\t * @param isEdit\n\t * @param isEditOnFocus whether this is a result of keyboard navigation focus move\n\t * @param suppressCalculateImmediately\n\t */\n\ttoggleInlineEdit(container, isEdit, isEditOnFocus = false, suppressCalculateImmediately = false) {\n\t\tif (!container || !container.classList.contains('editable')) {\n\t\t\treturn;\n\t\t}\n\t\tlet field = container.getAttribute('field');\n\t\tlet metadata = this._getFieldMetadataForInlineEdit(field);\n\n\t\t// boolean or checkbox types can be edited directly so we're not doing anything to toggle inline edit\n\t\tif (metadata.type === 'boolean' || metadata.type === 'checkbox') {\n\t\t\treturn;\n\t\t}\n\t\t// skip toggling if the field is RTE and it's coming from \"edit on focus\" (i.e., keyboard nav from another editing field)\n\t\tif (isEdit && isEditOnFocus && metadata.extraTypeInfo === \"richtextarea\") {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleInlineEditForDeviceDelegate(container, isEdit, field, metadata, suppressCalculateImmediately);\n\t}\n\n\t/**\n\t * Updates \"discardPendingEdit\" flag to indicate whether pending edit should be ignored\n\t * This flag is set to true when user hits escape key,\n\t * then it's consumed by \"commitPendingEdit\" method, which resets it back to false\n\t * @param value\n\t */\n\tsetDiscardPendingEdit(value) {\n\t\tthis._discardPendingEdit = value;\n\t}\n\n\t/**\n\t * Invoked when inline edit is turned off, commit the pending value into object model\n\t * Commit might be ignored if there's no pending data, or discardPendingEdit is set to true\n\t * @return {Boolean} true if pending edit data is available and is committed, false otherwise\n\t */\n\tcommitPendingEdit(suppressCalculateImmediately = false) {\n\t\tlet committed = false;\n\t\tif (this._pendingEdit && !this._discardPendingEdit) {\n\t\t\tlet field = this._pendingEdit.field;\n\t\t\tlet eventDetail = this._pendingEdit.eventDetail;\n\t\t\tlet eventType = this._pendingEdit.eventType;\n\t\t\tlet metadata = this._getFieldMetadataForInlineEdit(field);\n\t\t\tlet parsedValue = this._parseFieldData(metadata, eventDetail.value);\n\t\t\tthis.commitInlineEdit(field, parsedValue); \n\t\t\tif (metadata) {\n\t\t\t\tthis.handleControllingPicklistAndFields(metadata, field, eventType, eventDetail);\n\t\t\t}\n\t\t\tcommitted = true;\n\t\t\t// We don't need to calculate if customer total is set or indicated by suppressCalculateImmediately\n\t\t\tif (suppressCalculateImmediately === false) {\n\t\t\t\tthis.fireCalculateImmediately(field);\n\t\t\t}\n\t\t}\n\t\tthis._discardPendingEdit = false;\n\t\tthis._pendingEdit = null;\n\t\treturn committed;\n\t}\n\n\t/**\n\t * Writes the updated value from inline edit into the record model\n\t * @param field\n\t * @param value\n\t */\n\tcommitInlineEdit(field, value) {\n\t\tthis._getRecord()[field] = value;\n\t}\n\n\t/**\n\t * Goes through a parser to check if the value passed is valid or needs a lil' formatting.\n\t * @param metadata\n\t * @param detailValue is the new value the user inputted\n\t * @return {object} parsed field data object\n\t */\n\t_parseFieldData(metadata, detailValue) {\n\t\t// Picklist expected empty string when --none-- is selected\n\t\tif ((detailValue === '' || detailValue === null) && (metadata.type !== 'picklist' && metadata.type !== 'multipicklist')) {\n\t\t\treturn null;\n\t\t}\n\t\tswitch (metadata.type) {\n\t\t\tcase 'currency':\n\t\t\tcase 'double':\n\t\t\tcase 'percent':\n\t\t\t\t//Parse the value in case it's invalid: ex. 2,0000\n\t\t\t\tlet numberParser = new NumberParser();\n\t\t\t\treturn numberParser.parse(detailValue, false, metadata.scale);\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\tlet dateParser = new DateParser();\n\t\t\t\tlet dateObj = dateParser.parse(detailValue);\n\t\t\t\t// If null, the parser couldn't strip the value,\n\t\t\t\t// so that means the value is already a valid format\n\t\t\t\tif (dateObj !== null) {\n\t\t\t\t\treturn metadata.type === 'date' ?\n\t\t\t\t\t\tFormatter.toApexDate(dateObj) :\n\t\t\t\t\t\tFormatter.toApexDateTime(dateObj);\n\t\t\t\t} else {\n\t\t\t\t\treturn detailValue;\n\t\t\t\t}\n\t\t\tcase 'time':\n\t\t\t\treturn AppContext.i18n.parseTime(detailValue);\n\t\t\tdefault:\n\t\t\t\treturn detailValue;\n\t\t}\n\t}\n\n\t/**\n\t * Create a writable element for the field.\n\t * @param field\n\t * @param container\n\t * @private\n\t */\n\t_createWritableElement(field, container) {\n\t\tlet writeElem = document.createElement('div');\n\t\twriteElem.className = 'w';\n\t\tlet index = container.getAttribute('index');\n\t\tthis._createEditField(writeElem, index, field);\n\t\tcontainer.appendChild(writeElem);\n\t\tUtil.horizontalBound(writeElem);\n\t\treturn writeElem;\n\t}\n\n\t/**\n\t * Create, hydrate and attach inline-edit field the given container field\n\t * @param parentElement - The parent element where the inline edit field will be appended to\n\t * @param index - index of the field in this row\n\t * @param field - name of field\n\t */\n\t_createEditField(parentElement, index, field) {\n\t\tlet metadata = this._getFieldMetadataForInlineEdit(field);\n\t\tlet editField = this._getEditField(metadata, index);\n\t\tlet templateData = {};\n\t\teditField.attachTo(templateData);\n\t\tlet templateInstance = this.hydrateTemplate(editField.html, templateData);\n\t\tparentElement.appendChild(templateInstance.root);\n\t}\n\n\t/**\n\t * Toggle the dirty CSS class for a given field for the newValue\n\t * @param newValue\n\t * @param field\n\t * @param container The div container whose css class is to be toggled\n\t * @private\n\t */\n\t_toggleDirtyClass(newValue, field, container) {\n\t\tif (container) {\n\t\t\tlet originalValues = this._getOriginalRecord();\n\t\t\tif (originalValues) {\n\t\t\t\tlet dirty = this.checkIsDirty(newValue, originalValues, field);\n\t\t\t\t// Add/Remove the dirty class\n\t\t\t\tif (dirty) {\n\t\t\t\t\tif(!this._isEditable(field)) // if dirty but not editable then ignore\n\t\t\t\t\t\treturn;\n\t\t\t\t\tif(!container.classList.contains(TemplateGenerator.classNames.DIRTY)) {\n\t\t\t\t\t\tcontainer.classList.add(TemplateGenerator.classNames.DIRTY);\n\t\t\t\t\t}\n\t\t\t\t\tthis.isDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.classList.remove(TemplateGenerator.classNames.DIRTY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear all the dirty cells in this row, then re-apply dirty class for each cell\n\t * This is invoked after this row's content is re-stamped, which necessitates a complete reset of dirty class\n\t * @private\n\t */\n\t_refreshDirtyIndicators() {\n\t\t// first clear out all the dirty cells if any\n\t\tif (this.isDirty) {\n\t\t\tArray.from(this.querySelectorAll('div.r')).forEach((elem) => {\n\t\t\t\telem.classList.toggle('dirty', false);\n\t\t\t});\n\t\t\tthis.isDirty = false;\n\t\t}\n\t\t// now reset the dirty cells if any\n\t\tlet originalValues = this._getOriginalRecord();\n\t\tlet recordValues = this._getRecord();\n\t\tif (recordValues && originalValues) {\n\t\t\t//due to removal of ensureNullValues Apex method (for perf), originalValues doesn't have fields with null values\n\t\t\t// therefore looping over recordValues\n\t\t\tObject.keys(recordValues).forEach((field) => {\n\t\t\t\tlet newValue = recordValues[field];\n\t\t\t\tlet dirty = this.checkIsDirty(newValue, originalValues, field);\n\t\t\t\tif (dirty) {\n\t\t\t\t\tif(!this._isEditable(field)) // if dirty but not editable then ignore\n\t\t\t\t\t\treturn;\n\t\t\t\t\tlet container = this.querySelector(`div.td[field='${field}'] div.r`);\n\t\t\t\t\tthis._enableDirtyClass(container);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Enables dirty class for given container\n\t * @param container to enable dirty class for\n\t * @private\n\t */\n\t_enableDirtyClass(container) {\n\t\tif (container) {\n\t\t\tcontainer.classList.toggle('dirty', true);\n\t\t\tthis.isDirty = true;\n\t\t}\n\t}\n\n\t/**\n\t * Lazy load pencil icons for editable cells\n\t * @private\n\t */\n\t_handleEditableCellsHover(forceLoad) {\n\t\tif (!this._pencilLoaded || forceLoad) {\n\t\t\tlet editableCells = this.querySelectorAll('.container.editable');\n\t\t\tif (editableCells && editableCells.length > 0) {\n\t\t\t\tlet cellsArr = Array.from(editableCells);\n\t\t\t\tlet resizeRow = false;\n\t\t\t\tcellsArr.forEach((cell) => {\n\t\t\t\t\tif (!cell.querySelector('span.pencil')) {\n\t\t\t\t\t\tresizeRow = true;\n\t\t\t\t\t\tlet pencilSpan = document.createElement('span');\n\t\t\t\t\t\tpencilSpan.classList.add(TemplateGenerator.classNames.EDIT_ICON);\n\t\t\t\t\t\tif (cell.classList.contains(TemplateGenerator.classNames.RIGHT) ||\n\t\t\t\t\t\t\tcell.classList.contains(TemplateGenerator.classNames.CENTER)) {\n\t\t\t\t\t\t\tlet readElem = cell.querySelector('div.r');\n\t\t\t\t\t\t\treadElem.insertBefore(pencilSpan, readElem.firstChild);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcell.querySelector('div.r').appendChild(pencilSpan);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t\t\t});\n\n\t\t\t}\n\t\t\tthis._pencilLoaded = true;\n\t\t}\n\t}\n\n\t/**\n\t * Reset the _pencilLoaded attribute if pencil has been shown.\n\t * We want to do this for each line because we re-use the following row(s) when cloning, sorting, deleting...\n\t * which can cause the pencil icon to not appear (or appear) on a row that previously was not an editable cell\n\t */\n\t_resetPencilLoaded() {\n\t\tif(this._pencilLoaded) {\n\t\t\tlet pencilSpans = Array.from(this.querySelectorAll('.container.editable span.pencil'));\n\t\t\tpencilSpans.forEach(function(cell) {\n\t\t\t\tcell.parentNode.removeChild(cell);\n\t\t\t});\n\t\t\tthis._pencilLoaded = false;\n\t\t}\n\t}\n\n\t/**\n\t * Handles change event from inline editing.\n\t * @param evt\n\t */\n\tonChange(evt) {\n\t\tlet container = SFAbstractTable.findCell(evt, this.getCellClass());\n\t\tif (container) {\n\t\t\tlet field = container.getAttribute('field');\n\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\tif (evt.detail) {\n\t\t\t\t// THe new edited value is pending until committed (when inline edit is toggled off)\n\t\t\t\tthis._pendingEdit = {\n\t\t\t\t\tfield: field,\n\t\t\t\t\teventDetail: evt.detail,\n\t\t\t\t\teventType: evt.type\n\t\t\t\t};\n\n\t\t\t\t// For RTE, onChange signals editing is over and it should be committed\n\t\t\t\tconst writeElem = container.querySelector('.w');\n\t\t\t\tif (metadata.extraTypeInfo === \"richtextarea\") {\n\t\t\t\t\tthis.toggleInlineEdit(container, false);\n\t\t\t\t\t//removing the child for rte before calling toggleInlineEdit bc we don't remove it in\n\t\t\t\t\t// toggleInlineEdit\n\t\t\t\t\tcontainer.removeChild(writeElem);\n\t\t\t\t\t// put focus back on the read element\n\t\t\t\t\tthis._applyFocus(container, evt);\n\t\t\t\t} else if (AppContext.isMobile) {\n\t\t\t\t\t// we want to commit pending edit right away for mobile because it doesn't go through the regular focus treatment\n\t\t\t\t\t// W-7477808 we also need to delay the commit because we need to wait for additional discount field values update\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\t\t\t\tthis.commitPendingEdit();\n\t\t\t\t\t\tif (writeElem && this._deviceDelegate && this._deviceDelegate._updateEditableField) {\n\t\t\t\t\t\t\tthis._deviceDelegate._updateEditableField(container, this, field, metadata, writeElem);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * No-ops if not implemented by consuming class\n\t */\n\ttoggleInlineEditForDeviceDelegate(container, isEdit, field, metadata, suppressCalculateImmediately) {\n\t}\n\n\t/** Hook for dependent pick list handling */\n\thandleControllingPicklistAndFields(metadata, field, eventType, eventDetail) {\n\t}\n\n\t/** Hook for firing off quote calculation */\n\tfireCalculateImmediately(field) {\n\t}\n\n\t/**\n\t * Must be implemented, will throw error if missing\n\t */\n\t_getFieldMetadataForInlineEdit(field) {\n\t\tthrow new Error(\"Must implement method _getFieldMetadataForInlineEdit for SFInlineEditBehavior.\");\n\t}\n\n\t_getEditField(metadata, field) {\n\t\tthrow new Error(\"Must implement method _getEditField for SFInlineEditBehavior.\");\n\t}\n\n\t_getOriginalRecord() {\n\t\tthrow new Error(\"Must implement method _getOriginalRecord for SFInlineEditBehavior.\");\n\t}\n\n\t_isEditable(field) {\n\t\tthrow new Error(\"Must implement method _isEditable for SFInlineEditBehavior.\");\n\t}\n\n\t_getRecord() {\n\t\tthrow new Error(\"Must implement method _getRecord for SFInlineEditBehavior.\");\n\t}\n\n\tcheckIsDirty(newValue, originalValues, field) {\n\t\tthrow new Error(\"Must implement method checkIsDirty for SFInlineEditBehavior.\");\n\t}\n\n\t/**\n\t * Format the new value that the user has inputted.\n\t * And add it to the field's template instance\n\t * @param field\n\t * @param metadata\n\t * @returns newValue\n\t * @private\n\t */\n\t_formatNewValue(field, metadata) {\n\t\tthrow new Error('Must implement _formatNewValue for SFInlineEditBehavior');\n\t}\n\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFInlineEditBehavior = SFInlineEditBehavior.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n *\n * Common behavior for table row\n * In order to use this behavior, a component is also required to include Polymer.Templatizer behavior\n *\n * @author kzheng\n * @since 212\n *\n */\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class SFTableRowBehavior {\n\n\t/** Returns the cell element given the index of all cells in this row, null if not found */\n\tgetCellByIndex( index ) {\n\t\tlet container = this.getContentNode().querySelector('div');\n\t\tif( container ) {\n\t\t\tlet cells = Array.from( container.children );\n\t\t\tif( cells ) {\n\t\t\t\tindex = Math.min(Math.max(0, index), cells.length - 1);\n\t\t\t\treturn cells[index];\n\t\t\t}\n\t\t}\n\t}\n\n\tonHovered(evt) {\n\t\tthis.toggleClass('show', true, this.getContentNode());\n\t\tthis.hook_onHovered(evt);\n\t}\n\n\tonUnhovered(evt) {\n\t\tthis.toggleClass('show', false, this.getContentNode());\n\t\tthis.hook_onUnhovered(evt);\n\t}\n\n\tonTap( evt ) {\n\t\tlet handled = false;\n\t\tlet tableComp = this.getTableComponent( evt );\n\t\tlet cell = SFAbstractTable.findCell( evt, this.getCellClass() );\n\t\tlet isEditable = cell && cell.classList.contains( TemplateGenerator.classNames.EDITABLE ),\n\t\t\t\tisBoolean = cell && cell.classList.contains( TemplateGenerator.classNames.BOOLEAN ),\n\t\t\t\tisFocused = cell && cell.classList.contains( TemplateGenerator.classNames.HAS_FOCUS ),\n\t\t\t\tisEditing = cell && cell.classList.contains( TemplateGenerator.classNames.EDIT_MODE);\n\n\t\tif (tableComp && !isFocused) {\n\t\t\ttableComp.applyCellFocus(cell);\n\t\t\t// tapping a cell turns off editOnFocus, unless it also turns on editing (see below)\n\t\t\ttableComp.setEditOnFocus(false);\n\t\t}\n\n\t\t// if editable and already in focus or pencil clicked then go into edit mode\n\t\tif (isEditable && !isEditing && ( (isFocused && !isBoolean) || findEditIcon(evt) )) {\n\t\t\tthis.toggleInlineEdit(cell, true);\n\t\t\tif (tableComp) {\n\t\t\t\ttableComp.setEditOnFocus(true);\n\t\t\t}\n\t\t\thandled = true;\n\t\t}\n\n\t\t// allow custom handling of onTap\n\t\tthis.hook_onTap( evt, handled, isEditable );\n\t}\n\n\t/** Returns the table component for the given event, if it exists */\n\tgetTableComponent( e ) {\n\t\treturn Polymer.dom(e).path.find((pathElem) => {\n\t\t\tlet tagname = pathElem && pathElem.tagName ? pathElem.tagName.toUpperCase() : '';\n\t\t\treturn tagname === 'SF-STANDARD-TABLE' || tagname === 'SF-SEGMENTED-TABLE' || tagname === 'UBP-RATE-TABLE';\n\t\t});\n\t}\n\n\t/** Retrieve the root content div of a row, default to div#content **/\n\tgetContentNode() {\n\t\treturn this.$$('#content');\n\t}\n\n\t/**\n\t * Given an event, look for an element that contains the expected class in the event's path\n\t * @param event\n\t * @param clazz\n\t */\n\tfindElementForEvent(event, clazz) {\n\t\treturn Polymer.dom(event).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(clazz);\n\t\t});\n\t}\n\n\t/**\n     * Return the decorating CSS class for table cell. This is used to locate cells when a row is tapped\n     * @returns {string}\n     */\n\tgetCellClass() {\n\t    throw new Error('getCellClass must be implemented by row element');\n    }\n\n\t/**\n\t * Extra on hover handling, to be implemented by including component\n\t * @param evt\n\t */\n\thook_onHovered(evt) { }\n\n\n\t/**\n\t * Extra on unhover handling, to be implemented by including component\n\t * @param evt\n\t */\n\thook_onUnhovered(evt) { }\n\n\t/**\n\t * Extra onTap handling, to be implemented by including component\n\t * @param evt\n\t * @param handled whether the event has already been handled by SFTableRowBehavior's onTap\n\t */\n\thook_onTap(evt, handled) { }\n\n\t/**\n\t * Toggle inline edit behavior for the container\n\t * To be implemented by including component\n\t * @param container the container div where inline edit is being toggled\n\t * @param isEdit whether inline edit should be turn on or off\n\t */\n\ttoggleInlineEdit(container, isEdit) { }\n\n}\n\n/** Find the edit icon (pencil) in the event path, i.e. did the user click on the pencil? */\nfunction findEditIcon( e ) {\n\tlet paths = Polymer.dom(e).path;\n\tif( paths && paths.length > 0 && paths[0].classList.contains( TemplateGenerator.classNames.EDIT_ICON ) ) {\n\t\treturn paths[0];\n\t}\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFTableRowBehavior = SFTableRowBehavior.prototype;\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n *\n * Behavior that provides template hydration\n * In order to use this behavior, a component is also required to include Polymer.Templatizer behavior\n *\n * @author kzheng\n * @since 216\n *\n */\nexport class TemplatizationBehavior {\n\n\tstatic get properties() {\n\n\t\treturn {\n\t\t\t// the HTML element used to templatize content,\n\t\t\t// including component must populate either template or templateHTML\n\t\t\ttemplate: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_templateChanged'\n\t\t\t},\n\n\t\t\t// the HTML source used to templatize content,\n\t\t\t// including component must populate either template or templateHTML\n\t\t\ttemplateHTML: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: '_templateChanged'\n\t\t\t},\n\n\t\t\t// hydrated instance from template\n\t\t\ttemplateInstance: {\n\t\t\t\ttype: Object\n\t\t\t},\n\n\t\t\t// presentation data for stamping template\n\t\t\tuiData: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: \"_populateContent\"\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Templatize a template HTML string, then stamp it with data\n\t * @param templateHTML The HTML template string\n\t * @param data Data to stamp the template with\n\t * @return A template instance\n\t */\n\thydrateTemplate(templateHTML, data) {\n\t\tlet template = document.createElement('template');\n\t\ttemplate.innerHTML = this.isTemplatizeWithRootDivNode() ? `<div>${templateHTML}</div>` : templateHTML;\n\t\tthis.templatize(template);\n\t\treturn this.stamp(data || {});\n\t}\n\n\t/**\n\t * Build a template with the given DOM node, then templatize and stamp it\n\t * @param templateNode\n\t * @param data\n\t * @returns {*}\n\t */\n\thydrateTemplateFromNode(templateNode, data) {\n\t\tlet template = document.createElement('template');\n\t\ttemplate.content.appendChild(templateNode);\n\t\tthis.templatize(template);\n\t\treturn this.stamp(data || {});\n\t}\n\n\t/**\n\t * Invoked when template changes, in which case templateInstance may need to be rebuilt, data is always re-stamped\n\t * @param contentNode The DOM node that hosts the hydrated templateInstance\n\t * @private\n\t */\n\t_templateChanged() {\n\t\t// clear out old template instance and HTML content if it's already been built\n\t\tif (this.templateInstance) {\n\t\t\tthis.getContentNode().innerHTML = '';\n\t\t\tthis.templateInstance = null;\n\t\t}\n\t\tthis._populateContent();\n\t}\n\n\n\t/**\n\t * Invoked when template and uiData become available to hydrate this template\n\t * @private\n\t */\n\t_populateContent() {\n\t\tif ((this.template || this.templateHTML) && this.uiData) {\n\t\t\tif (this.templateInstance) {\n\t\t\t\t// node is already templatized, just update its content\n\t\t\t\tObject.keys(this.uiData).forEach((key) => {\n\t\t\t\t\tthis.templateInstance[key] = this.uiData[key];\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (this.template) {\n\t\t\t\t\tthis.templateInstance = this.hydrateTemplateFromNode(this.template.cloneNode(true), this.uiData);\n\t\t\t\t} else {\n\t\t\t\t\tthis.templateInstance = this.hydrateTemplate(this.templateHTML, this.uiData);\n\t\t\t\t}\n\t\t\t\tthis.getContentNode().appendChild(this.templateInstance.root);\n\t\t\t}\n\t\t\tthis.postPopulateContent();\n\t\t}\n\t}\n\n\t/**\n\t * To be implemented by behavioral component\n\t * @returns The DOM node that hosts the hydrated templateInstance\n\t */\n\tgetContentNode() {\n\t\tthrow \"getContentNode() must be implemented!\";\n\t}\n\n\t/**\n\t * To be implemented by behavioral component\n\t * Post operation logic after content is populated\n\t */\n\tpostPopulateContent() {}\n\n\t/**\n\t * When templatizing from templateHTML, whether an extra root DIV node should be created as part of the resulting template\n\t * @returns {boolean}\n\t */\n\tisTemplatizeWithRootDivNode() {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Restamp field value for templateInstance and update corresponding uiData value\n\t * @param field\n\t * @param value\n\t * @private\n\t */\n\t_restampField(field, value){\n\t\tif (this.templateInstance) {\n\t\t\tif (this.secondaryTemplateInstance != null) {\n\t\t\t\t// We need to update the secTemplate so polymer can reflect the property changes/updates\n\t\t\t\tthis.secondaryTemplateInstance[field] = value;\n\t\t\t}\n\t\t\tthis.templateInstance[field] = value;\n\t\t\tthis.uiData[field] = value;\n\t\t}\n\t}\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.TemplatizationBehavior = TemplatizationBehavior.prototype;\n","import { LABELS } from 'labels_en.js'\n\n// Singleton/instance data exposed by this class\nlet labels = {},\n\t\torg = {},\n\t\tmd = {},\n\t\tuser = {},\n\t\tdevice = {},\n\t\ti18n = {};  // instance of I18n.js, which we can't import normally due to circular dependency\n\nlet sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\nfunction getLabels() {\n\treturn sb.labels || LABELS;\n}\n\n/** Localize a string into a different language */\nexport function localizeContent( key, values ) {\n\tlet label = getLabels()[ key ] || key;\n\tif(/{[0-9]}/.test(label) && values && values.length > 0)\n\t\tlabel = replaceWildcards(label, values);\n\n\treturn label;\n}\n\nfunction replaceWildcards(label, values) {\n\tfor(let i = 0, l = values.length; i < l; i++)\n\t\tlabel = label.replace(new RegExp('{[' + i + ']}', 'g'), values[i]);\n\treturn label;\n}\n\n/**\n * A \"context\" class for the entire Application.  It knows how to initialize/get all the common stuff\n * that any page of the application might need.  This includes:\n *\n * User settings (language, locale, timezone, fullname, email, etc)\n * Localized labels\n * Org settings\n * Org Metadata\n * UI Themes\n *\n * It exposes these as both static and instance properties so that regular javascript can reference\n * in either way, and we can also use class inheritence so Polymer properties can be data bound.\n */\n\nexport class AppContext {\n\t/**\n\t * Initialize the application context data.  This needs to be called (at least once) before\n\t * other methods are used to access instance data.\n\t * @param  {Object} settingsObj details about the org and the user\n\t * @return {Promise}\n\t */\n\tstatic init(settingsObj) {\n\t\tAppContext.buildUserAndOrgFromSettings(settingsObj);\n\t\tAppContext.device = 'desktop';\n\t\t// For ipad, other tablets and Android tablet device, but not a windows hybrid\n\t\tif ( (navigator.userAgent.match(/Tablet|iPad|iPod/i) && !navigator.userAgent.match(/Tablet PC/i)) || (navigator.userAgent.match(/Android/i) && !navigator.userAgent.match(/Mobi/i)) ) {\n\t\t\tAppContext.device = 'tablet';\n\t\t} else if (navigator.userAgent.match(/Mobi/i)) {\n\t\t\tAppContext.device = 'phone';\n\t\t}\n\n\t\treturn new Promise( function(resolve, reject) {\n\t\t\tSystem.import( 'common/core/sb-i18n/I18n.js' ).then( function(n) {\n\t\t\t\tlet ret = { labels: getLabels(), user };\n\n\t\t\t\tif(n.I18n)\n\t\t\t\t\ti18n = new n.I18n( ret );  // create singleton instance\n\n\t\t\t\tresolve( ret );\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * It has been possible to call the static methods on this before init has been run W-3635053\n\t * Providing an API to let users of this know if it is ready for use\n\t * Which at this time means buildUserAndOrgFromSettings has been run\n\t * @returns {boolean} are the properties ready?\n\t */\n\tstatic hasInitialized() {\n\t\treturn AppContext.userAndOrgSettingsSet === true;\n\t}\n\n\tstatic buildUserAndOrgFromSettings(settingsObj) {\n\t\tif (!settingsObj)\n\t\t\treturn;\n\n\t\tAppContext.userAndOrgSettingsSet = true;\n\n\t\tAppContext.user = {\n\t\t\tlang: settingsObj.language,\n\t\t\tlocale: settingsObj.locale,\n\t\t\tid: settingsObj.userId,\n\t\t\tfullname: settingsObj.fullName,\n\t\t\tusername: settingsObj.userName,\n\t\t\tdevice: settingsObj.device,\n\t\t\tinCommunity: settingsObj.inCommunity,\n\t\t\thasQuoteEditPermission: settingsObj.hasQuoteEditPermission,\n\t\t\toik: settingsObj.oik\n\t\t};\n\n\t\tAppContext.org = {\n\t\t\tprefix: settingsObj.developerPrefix !== undefined ? settingsObj.developerPrefix : '',\n\t\t\tscPrefix: settingsObj.scDeveloperPrefix !== undefined ? settingsObj.scDeveloperPrefix : '',\n\t\t\tisMultiCurrencyOrg: settingsObj.isMultiCurrencyOrg,\n\t\t\tisServiceCloudEnabled: settingsObj.isServiceCloudEnabled,\n\t\t\tcalculateImmediately: settingsObj.calculateImmediately,\n\t\t\tdefaultCurrency: settingsObj.defaultCurrency,\n\t\t\tcurrencySymbol: settingsObj.currencySymbol,\n\t\t\tcurrencyDecimalScale: settingsObj.currencyDecimalScale, // TODO ALERT THIS IS WEIRD\n\t\t\tquantityScale: settingsObj.quantityScale,\n\t\t\tisOAuth: settingsObj.isOAuth,\n\t\t\torgUrl: settingsObj.orgUrl,\n\t\t\torgInstanceUrl: settingsObj.orgInstanceUrl,\n\t\t\tsiteUrl: settingsObj.siteUrl,\n\t\t\tadditionalLookupSearchTypes: settingsObj.additionalLookupSearchTypes,\n\t\t\tmaxLookupSearchFields: settingsObj.maxLookupSearchFields,\n\t\t\tisJSProductRulesEnabled: settingsObj.isJSProductRulesEnabled,\n\t\t\thasQuoteSelectionProductRules: settingsObj.hasQuoteSelectionProductRules,\n\t\t\tisUI3Enabled: true,\n\t\t\tisBundleCollapsible: settingsObj.isBundleCollapsible,\n\t\t\tdefaultBundleSetting: settingsObj.defaultBundleSetting,\n\t\t\tapiVersion : 39, //TODO: this should not be hardcoded\n\t\t\tisPricingGuidanceEnabled: settingsObj.isPricingGuidanceEnabled,\n\t\t\tisCompactModeEnabled: settingsObj.isCompactModeEnabled,\n\t\t\tisManualEditsForUBPEnabled: settingsObj.isManualEditsForUBPEnabled,\n\t\t\tisColumnResizingEnabled: settingsObj.isColumnResizingEnabled\n\t\t};\n\t}\n\n\t/**\n\t * The properties object, in Polymer format, that can be inherited by other components/classes.\n\t * @return {Object} a common set of properties for all components/classes in our app.\n\t */\n\tstatic get properties() {\n\t\treturn {\n\t\t\tapp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {\n\t\t\t\t\tuser: user,\n\t\t\t\t\tlabels: getLabels(),\n\t\t\t\t\torg: org,\n\t\t\t\t\tdeviceContext: {\n\t\t\t\t\t\tisDesktop: AppContext.isDesktop,\n\t\t\t\t\t\tisTablet: AppContext.isTablet,\n\t\t\t\t\t\tisPhone: AppContext.isPhone,\n\t\t\t\t\t\tisMobile: AppContext.isPhone || AppContext.isTablet\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t},\n\t\t\t/** A instance of sb-i18n in pure ES6 class form, for direct programmatic access in any inherited component */\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return i18n; }\n\t\t\t}\n\t\t};\n\t}\n\n\tget user() {\n\t\treturn user;\n\t}\n\n\tget labels() {\n\t\treturn getLabels();\n\t}\n\n\tget org() {\n\t\treturn org;\n\t}\n\n\tstatic get user() {\n\t\treturn user;\n\t}\n\n\tstatic get labels() {\n\t\treturn getLabels();\n\t}\n\n\tstatic get org() {\n\t\treturn org;\n\t}\n\n\tstatic get device() {\n\t\treturn device;\n\t}\n\n\tstatic set user(obj) {\n\t\tuser = obj;\n\t}\n\n\tstatic set org(obj) {\n\t\torg = obj;\n\t}\n\n\tstatic set device(obj) {\n\t\tdevice = obj;\n\t}\n\n\tstatic get isDesktop() {\n\t\treturn user.device ? user.device === 'desktop' : device === 'desktop';\n\t}\n\n\tstatic get isTablet() {\n\t\treturn user.device ? user.device === 'tablet' : device === 'tablet';\n\t}\n\n\tstatic get isPhone() {\n\t\treturn user.device  ? user.device === 'phone' : device === 'phone';\n\t}\n\n\tstatic isIE() {\n\t\tlet ua = window.navigator.userAgent;\n\t\t// Checks are for IE10 and below, IE11, and Edge respectively\n\t\treturn (ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0);\n\t}\n\n\tstatic isChrome() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Chrome') >= 0;\n\t}\n\n\tstatic isFirefox() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Firefox') >= 0;\n\t}\n\n\tstatic isSafari() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Safari') >= 0 && ua.indexOf('Chrome') < 0;\n\t}\n\n\tstatic get apiVersion() {\n\t\treturn AppContext.org.apiVersion;\n\t}\n\n\tstatic get apiVersionString() {\n\t\treturn AppContext.org.apiVersion + '.0';\n\t}\n\n\tstatic set apiVersion(version) {\n\t\tAppContext.org.apiVersion = version;\n\t}\n\n\tstatic get i18n() {\n\t\treturn i18n;\n\t}\n\n\tstatic get isMobile() {\n\t\treturn AppContext.properties.app.value().deviceContext.isMobile;\n\t}\n\n\tstatic isBundleCollapsible(editorModel) {\n\t\treturn AppContext.org.isBundleCollapsible &&\n\t\t\t!this.isMobile &&\n\t\t\teditorModel.data.settings.bundleKeptTogether &&\n\t\t\teditorModel.largeQuoteExperienceEnabled &&\n\t\t\teditorModel.isProductHierarchyVisualized();\n\t}\n\n\tstatic get defaultBundleSetting() {\n\t\treturn AppContext.org.defaultBundleSetting;\n\t}\n\n\tstatic get isPricingGuidanceEnabled() {\n\t\treturn AppContext.org.isPricingGuidanceEnabled;\n\t}\n\n\tstatic get isCompactModeEnabled() {\n\t\treturn AppContext.org.isCompactModeEnabled;\n\t}\n\n\tstatic get isManualEditsForUBPEnabled() {\n\t\treturn AppContext.org.isManualEditsForUBPEnabled;\n\t}\n\n\tstatic get isColumnResizingEnabled() {\n\t\treturn AppContext.org.isColumnResizingEnabled;\n\t}\n}\n\n\n// expose an instance of AppContext as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.AppContext = AppContext.prototype;\n","/**\n * All events in the CPQ application (used to be iron-signals)\n */\nexport const Events = Object.freeze({\n\tAUTO_LAUNCH_POPUP: 'sf-auto-launch-popup',  // sb-auto-launch-popup\n\tBUILD_LAYOUT: 'sf-build-layout',  // build-layout\n\tCLEAR_PRODUCT_FILTER: 'sf-clear-product-filter',  // sb-clear-product-filter\n\tCLOSE_GROUP_PANEL: 'sf-close-group-panel',  // close-group-panel\n\tCLOSE_LOOKUP_DIALOG: 'sf-close-lookup-dialog',  // lookup-dialog-closed\n\tCOL_WIDTHS_CHANGED: 'sf-col-widths-changed',  // col-widths-changed\n\tDELETE_GROUPS: 'sf-delete-groups',  // delete-groups\n\tDESELECT_CHECKBOX: 'sf-deselect-checkbox',  // deselect-checkbox\n\tGROUP_ADDED: 'sf-group-added',  // group-added\n\tGROUP_DELETED: 'sf-group-deleted',  // group-deleted\n\tGROUP_PANEL_CREATED: 'sf-group-panel-created',  // group-panel-created\n\tGROUP_PANEL_TOGGLED: 'sf-group-panel-toggled',  // group-panel-toggled\n\tGROUP_TOGGLED: 'sf-group-toggled',  // group-toggled\n\tIRON_LIST_RESIZED: 'sf-iron-list-resized',  // iron-list-resized\n\tLINE_SPLICE_COMPLETE: 'sf-line-splice-complete',  // line-splice-complete\n\tNAVIGATION_CHANGED: 'sf-navigation-changed',  // sb-navigation-changed\n\tOPEN_LOOKUP_DIALOG: 'sf-open-lookup-dialog',  // sb-open-lookup-dialog\n\tOPEN_RTE_DIALOG: 'sf-open-rte-dialog',  // sb-open-rte-dialog\n\tOPEN_SEARCH_BAR_DIALOG: 'sf-open-search-bar-dialog',  // sb-open-search-bar-dialog\n\tPAGE_RESIZED: 'sf-page-resized',  // sb-page-resized\n\tPANEL_CLOSED: 'sf-panel-closed',  // sb-panel-closed\n\tQUOTE_SAVED: 'sf-quote-saved',  // quote-saved\n\tREFRESH_LINE_ACTIONS: 'sf-refresh-line-actions',  // refresh-line-actions\n\tREFRESH_TABLE: 'sf-refresh-table',  // refresh-table\n\tRENDER_NEW_TAB: 'sf-render-new-tab',  // render-new-tab\n\tRESET_ON_ACTION: 'sf-reset-on-action',  // reset-on-action\n\tRESET_COL_SIZES: 'sf-reset-col-sizes',  // reset-column-sizes\n\tROWS_RENUMBERED: 'sf-rows-renumbered',  // rows-renumbered\n\tSCHEDULE_ACTION: 'sf-schedule-action',  //schedule-action\n\tSORT_LINES_REQUIRED: 'sf-sort-lines-required',  //sort-lines-required\n\tTOGGLE_OPTIONAL_CLICKED: 'sf-toggle-optional-clicked',\n\tTOGGLE_PANEL_CLICKED: 'sf-toggle-panel-clicked',   // toggle-panel-clicked\n\tUPDATE_IRON_LIST: 'sf-udpate-iron-list',  // update-iron-list\n\tVIEWPORT_CHANGED: 'sf-viewport-changed', // viewport-changed\n\tUBP_ROW_REFRESH: 'sf-ubp-row-refresh', // ubp-row-refresh\n\tTOGGLE_QUICKSAVE: 'sf-toggle-quicksave', // enable-quicksave\n\tCOL_SIZE_ERR: 'sf-col-size-err', // column-sizing-save-error\n\tGENERIC_ERROR: 'sf-generic-error', // generic error\n\t// when the last MDQ line from a group is deleted. Used to resize column widths\n\tMDQ_LINE_DELETED: 'sf-mdq-line-deleted', \n});\n\n/**\n * Fire a global event\n * @param {String} name the name of the event to fire\n * @param {Object} [data] the payload data object to pass to the event listener\n */\nexport function fireEvent( name, data ) {\n\tif (name && window && window.dispatchEvent) {\n\t\twindow.dispatchEvent(new CustomEvent(name, {detail: data}));\n\t}\n}","let stack = [''];\nlet forceTrackHistory = [['product', 'lookup']];\n\n/**\n * History class that used to manage the history between URLs of different paths.\n *\n * For example navigating from #/product/pc to #/product/ol will not include #/product/ol in history as same \"product\" path,\n * but navigating from #/asset/lookup to #/product/pc will include #/asset/lookup in history since different paths.\n *\n * Special case from #/product/lookup to #/product/pc will force #/product/lookup in history even though same \"product\" path\n */\nexport class History {\n\n\t/**\n\t * Push current path to the history stack if we should track it based on the provided next path\n\t *\n\t * @param current {String} represents the current path\n\t * @param next {String} represents the next path being navigated to\n\t */\n\tstatic push(current, next) {\n\t\t// only push current to stack if we should track current in history\n\t\tif(this._trackHistory(current, next))\n\t\t\tstack[0] = current;\n\t}\n\n\t/**\n\t * Pops the last path in the history stack\n\t *\n\t * @returns {String} the last path with query string parameters (e.g. #/product/pc?qid=xyz)\n\t */\n\tstatic pop() {\n\t\treturn stack[0];\n\t}\n\n\t/**\n\t * Pops the last path in the history stack as a path array without the query string\n\t *\n\t * @returns {Array} the last path array (e.g. ['product', 'pc'])\n\t */\n\tstatic popPath() {\n\t\treturn this._parsePath(this.pop());\n\t}\n\n\tstatic resetHistory() {\n\t\tstack = [''];\n\t}\n\t/**\n\t * Track current in history if a different path prefix then next or current is forced to history\n\t *\n\t * @param current {String} represents the current path\n\t * @param next {String} represents the next path being navigated to\n\t * @returns {boolean} true if current should be tracked in history, false otherwise\n\t */\n\tstatic _trackHistory(current, next) {\n\t\tlet currentPath = this._parsePath(current);\n\t\tlet nextPath = this._parsePath(next);\n\n\t\t// if path prefixes are different then we have different paths so allow\n\t\tif(currentPath[0] !== nextPath[0])\n\t\t\treturn true;\n\n\t\t// check special case to see if current path matches any force history paths\n\t\tfor(let forceHistoryPath of forceTrackHistory) {\n\t\t\tif (currentPath[0] === forceHistoryPath[0] && currentPath[1] === forceHistoryPath[1])\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Given a hash location parse the string into its path array.\n\t * For example: #/product/pc?qid=xyz > ['product', 'pc'].\n\t *\n\t * @param location {String} the hash location to parse as a path\n\t * @returns {Array} the location parsed into a path array\n\t */\n\tstatic _parsePath(location) {\n\t\t// remove the leading '#/' or '#'\n\t\tlet startIndex = location.indexOf('#/') === 0 ? 2 : 1;\n\t\tlocation = location.substring(startIndex, location.length);\n\n\t\t// get the path parts that precede the query params (before the '?')\n\t\tlet path = location.split('?')[0].split('/');\n\t\treturn path;\n\t}\n}","import {History} from 'common/core/History.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nexport class Navigator {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         \tthe relative URL to navigate to\n\t * @param  {Object} queryParams \ta map of query parameters to append to the URL\n\t * @param  {String[]} pathParams  \tarray of path strings to append to the URL\n\t * @param  {boolean} newWin     \ttrue to open in a new browser window\n\t * @return {null}\n\t */\n\tstatic nav( url, queryParams, pathParams, newWin, component ) {\n\t\tlet location = this._getLocation(queryParams, pathParams, url);\n\t\tHistory.push(window.location.hash, location);\n\t\tthis._nav(component, location, url);\n\t}\n\n\tstatic back(component, defaultQueryParams, defaultPathParams) {\n\t\tlet location = History.pop();\n\n\t\t// history.pop can equal the current location if the user hits the back\n\t\t// button on the browser because the url isn't pushed to the stack.\n\t\t// Therefore we fallback to the backup url.\n\t\tif (!location || location === window.location.hash) {\n\t\t\tlocation = this._getLocation(defaultQueryParams, defaultPathParams);\n\t\t}\n\n\t\tthis._nav(component, location);\n\t}\n\n\tstatic getPreviousRoute() {\n\t\treturn History.popPath().join('/');\n\t}\n\n\tstatic _getLocation(queryParams, pathParams, url = '#') {\n\t\tlet u = url,\n\t\t\tpLen = pathParams ? pathParams.length : 0,\n\t\t\tpKeys = queryParams ? Object.keys( queryParams ) : [],\n\t\t\tkLen = pKeys.length;\n\n\t\tif( pathParams ) {\n\t\t\tfor ( let i = 0; i < pLen; i++ ) {\n\t\t\t\tif ( pathParams[ i ] != null && pathParams[ i ] != undefined && pathParams[ i ] != '' )\n\t\t\t\t\tu += '/' + encodeURIComponent( pathParams[ i ] );\n\t\t\t}\n\t\t}\n\n\t\tfor( let i = 0; i < kLen; i++ ) {\n\t\t\tu += i == 0 ? '?' : '&';\n\t\t\tu += encodeURIComponent( pKeys[ i ] ) + '=' + encodeURIComponent( queryParams[ pKeys[ i ] ] );\n\t\t}\n\n\t\treturn u;\n\t}\n\n\tstatic _nav(component, location, url = '#') {\n\t\tfireEvent(Events.NAVIGATION_CHANGED, { url: url, location: location });\n\t\twindow.location.hash = location;\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Navigator} from 'common/core/Navigator.js';\n\nvar sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\n// Screen-ish / viewport sizes\nexport const SIZE_S = 'S';\nexport const SIZE_M = 'M';\nexport const SIZE_L = 'L';\nexport const SIZE_XL = 'XL';\n\n/**\n * The common base class for all Page objects.  A Page is a physical landing point of content when a user navigates in the app.\n */\nexport class Page extends AppContext {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         the relative URL to navigate to\n\t * @param  {Object} queryParams a map of query parameters to append to the URL\n\t * @param  {Object} pathParams  array of path strings to append to the URL\n\t * @param  {boolean} newWin     true to open in a new browser window\n\t * @return {null}\n\t */\n\tnav( url, queryParams, pathParams, newWin ) {\n\t\tNavigator.nav(url, queryParams, pathParams, newWin, this);\n\t}\n\n\t/**\n\t * The base properties object, in Polymer format, that all Pages have in common\n\t * @return {Object} a common set of properties for all pages\n\t */\n\tstatic get properties() {\n\t\treturn Polymer.Base.extend({\n\t\t\tctx: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {} }\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n}\n\n// expose an instance of Page as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.Page = Page.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {Html} from 'common/layout/sb-html/Html.js';\nimport {getUnitAndDisplayValue, updateUnitIfAmountInactive} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\n\n/**\n *\n * Utility for formatting raw data into presentation data\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class Formatter {\n\n\tstatic formatFieldData(model, rawData, fieldMetadata, record) {\n\t\tif(!fieldMetadata)\n\t\t\treturn rawData;\n\n\t\tlet dataType = fieldMetadata.type;\n\t\tlet formatter = new NumberFormatter(false, fieldMetadata, AppContext.i18n, dataType);\n\t\tif (QuoteContext.isDiscountField(fieldMetadata.name)) {\n\t\t\tdataType = 'discount';\n\t\t}\n\t\tif (QuoteContext.isMarkupField(fieldMetadata.name)) {\n\t\t\tdataType = 'markup';\n\t\t}\n\t\tif(fieldMetadata && fieldMetadata.extraTypeInfo === 'richtextarea') {\n\t\t\tdataType = 'richtextarea';\n\t\t}\n\n\t\tswitch (dataType) {\n\t\t\tcase 'double':\n\t\t\t\treturn formatter.format(rawData, false);\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn formatter.format(rawData, true);\n\t\t\tcase 'discount':\n\t\t\tcase 'markup':\n\t\t\t\treturn this.formatDiscountField(model, formatter);\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\treturn AppContext.i18n.format(rawData, { date: true });\n\t\t\tcase 'time':\n\t\t\t\treturn AppContext.i18n.formatTime(rawData);\n\t\t\tcase 'reference':\n\t\t\t\treturn Formatter.formatReferenceField( fieldMetadata, record ) || rawData;\n\t\t\tcase 'richtextarea':\n\t\t\tcase 'url':\n\t\t\t\tlet data = Html.sanitizeHtmlText(rawData);\n\t\t\t\treturn data === null ? '' : data;\n\t\t\tcase 'string':\n\t\t\t\tif(fieldMetadata.calculatedFormula && Html.containsMarkup(rawData)) {\n\t\t\t\t\treturn Html.sanitizeHtmlText(rawData);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'picklist':\n\t\t\tcase 'multipicklist':\n\t\t\t\treturn this.formatPicklistData(fieldMetadata, rawData);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn rawData;\n\t}\n\t\n\t/**\n\t * Find and render the picklist's label for the given value\n\t * @param fieldMetadata\n\t * @param values\n\t * @returns {*} Corresponding label for the given rawData (value)\n\t */\n\tstatic formatPicklistData(fieldMetadata, values) {\n\t\tif (fieldMetadata.picklistValues && values) {\n\t\t\tlet result = [];\n\t\t\tvalues.toString().split(';').forEach((value) => {\n\t\t\t\tlet pickListValue = this.findPickListValue(fieldMetadata, value);\n\t\t\t\tif (pickListValue) {\n\t\t\t\t\tresult.push(pickListValue.label);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result.join(';');\n\t\t}\n\t\treturn values;\n\t}\n\t\n\t/**\n\t * Locate pick list value from the given metadata for the given value\n\t * Caches visited pick list values in a map to help faster lookup\n\t * @param fieldMetadata\n\t * @param value\n\t * @returns {*}\n\t */\n\tstatic findPickListValue(fieldMetadata, value) {\n\t\tconst fieldName = fieldMetadata.name;\n\t\tif (!this._pickListValuesMap) {\n\t\t\tthis._pickListValuesMap = {};\n\t\t}\n\t\tif (!this._pickListValuesMap[fieldName]) {\n\t\t\tthis._pickListValuesMap[fieldName] = {};\n\t\t\tfieldMetadata.picklistValues.forEach((plValue) => {\n\t\t\t\tthis._pickListValuesMap[fieldName][plValue.value] = plValue;\n\t\t\t});\n\t\t}\n\t\treturn this._pickListValuesMap[fieldName][value];\n\t}\n\n\t/**\n\t * Format discount field from DiscountConverter (getUnitAndDisplayValue)\n\t * @param numFormatter\n\t * @returns {*}\n\t */\n\tstatic formatDiscountField(model, numFormatter) {\n\t\t// concatenates numeric value with unit label, e.g., 4.5 %\n\t\tupdateUnitIfAmountInactive(model, numFormatter.metadata.name);\n\t\tconst { displayValue, units, unit } = getUnitAndDisplayValue(model, numFormatter.metadata.name);\n\t\t// content is empty when value is null\n\t\tif (displayValue !== null && !isNaN(displayValue)) {\n\t\t\tlet selectedUnit = units.find((u) => {\n\t\t\t\treturn u.value === unit\n\t\t\t});\n\t\t\tlet unitLabel = selectedUnit ? selectedUnit.label : '';\n\t\t\tlet formattedVal = numFormatter.format(displayValue);\n\t\t\treturn `${formattedVal} ${unitLabel}`;\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t* Format a reference field (lookup or M/D)\n\t* @param  {Object} fieldMetadata the metadata of the field\n\t* @param  {Object} record        the data recordUI\n\t* @return {String}               the formatted value to display\n\t*/\n\tstatic formatReferenceField( fieldMetadata, record ) {\n\t\tlet name = '';\n\t\tif( record && fieldMetadata.relationshipName && record[fieldMetadata.relationshipName] ) {\n\t\t\tname = record[fieldMetadata.relationshipName].Name;\n\t\t}\n\t\treturn name;\n\t}\n\t\n\t/**\n\t * Format a given date object to ISO8601 format expected by Apex\n\t * @param {Date} date The date object to be formatted\n\t * @returns {String} The formatted string, or blank string if date is null or invalid\n\t */\n\tstatic toApexDate(date) {\n\t\tif (date && date instanceof Date) {\n\t\t\t// Get the ISO formatted date string.\n\t\t\t// This will be formatted: YYYY-MM-DDTHH:mm:ss.sssZ\n\t\t\tvar dateIso = date.toISOString();\n\t\t\t// Replace everything after the T with an empty string\n\t\t\treturn dateIso.replace(new RegExp('[Tt].*'), \"\");\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\t\n\t/**\n\t * Takes a JS Date object and turns it into a string of ISO8601 format (YYYY-MM-DDTHH:mm:ss.sss+0000), which is what Apex\n\t * expects a date-time to look like\n\t * @param {Date} dateTime The date object to be formatted\n\t * @returns {string} The formatted string, or blank string if dateTime is null or invalid\n\t */\n\tstatic toApexDateTime(dateTime) {\n\t\tif (dateTime && dateTime instanceof Date) {\n\t\t\t// Get the ISO formatted date string.\n\t\t\t// This will be formatted YYYY-MM;DDTHH:mm:ss.sssZ\n\t\t\tvar dateIso = dateTime.toISOString();\n\t\t\t\n\t\t\t// Replace the 'Z' at the end with '+0000'\n\t\t\treturn dateIso.slice(0, dateIso.length - 1) + \"+0000\";\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n}\n","import {I18n} from 'common/core/sb-i18n/I18n.js';\n\nexport class DateParser {\n\n\tconstructor(stripTime = false) {\n\t\tthis.stripTime = stripTime;\n\t\tlet dateTimeFormat = I18n.getLocaleData() ? I18n.getLocaleData().date.formats.dateFormats.yMd : 'M/D/YY';\n\t\t// simplify dateTimeFormat string for repeating characters\n\t\tlet dateTimeFormatSimple = dateTimeFormat.replace(new RegExp('[dD]+'), 'D').replace(new RegExp('[mM]+'), 'M').replace(new RegExp('[yY]+'), 'Y');\n\t\t// get the separator\n\t\tthis.separator = dateTimeFormatSimple.match(new RegExp('[\\/.-]'))[0];\n\t\t// split by separator to get day, month, and year indexes\n\t\tlet dateTimeElements = dateTimeFormatSimple.split(this.separator);\n\t\tthis.dateIdx = dateTimeElements.indexOf('D');\n\t\tthis.monthIdx = dateTimeElements.indexOf('M');\n\t\tthis.yearIdx = dateTimeElements.indexOf('Y');\n\t}\n\n\tparse(dateStr, isValidYearFunction = this._isValidYear) {\n\t\tif(typeof dateStr !== 'string')\n\t\t\treturn dateStr; // if dateStr is not a string, then nothing to parse\n\n\t\tif(this.stripTime)\n\t\t\tdateStr = dateStr.split(' ')[0];\n\n\t\tlet invalid = true;\n\t\tlet elements = dateStr.split(this.separator),\n\t\t\tday = elements[this.dateIdx],\n\t\t\tmonth = elements[this.monthIdx],\n\t\t\tyear = elements[this.yearIdx];\n\n\t\t// check day, month, and year strings for validity\n\t\tif ((year && year.length == 4) && (month && month.length > 0 && month.length <= 2) && (day && day.length > 0 && day.length <= 2)) {\n\t\t\tday = parseInt(day);\n\t\t\tmonth = parseInt(month);\n\t\t\tyear = parseInt(year);\n\n\t\t\t// check whether input is split into separate elements and that input elements are numbers\n\t\t\tif (elements.length && !isNaN(year) && !isNaN(month) && !isNaN(day)) {\n\t\t\t\t// check year\n\t\t\t\tif(typeof isValidYearFunction === 'function' && !isValidYearFunction(year))\n\t\t\t\t\treturn null;\n\n\t\t\t\t// check months\n\t\t\t\tif (month >= 1 && month <= 12) {\n\t\t\t\t\t// check days including leap years\n\t\t\t\t\tvar monthEnd = 31;\n\t\t\t\t\tif (month == 2) {\n\t\t\t\t\t\tmonthEnd = 28;\n\t\t\t\t\t\tif (year % 4 == 0) {\n\t\t\t\t\t\t\tif (year % 100 != 0) {\n\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (year % 400 == 0) {\n\t\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ((month == 4) || (month == 6) || (month == 9) || (month == 11)) {\n\t\t\t\t\t\t\tmonthEnd = 30;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (day >= 1 && day <= monthEnd) {\n\t\t\t\t\t\tinvalid = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !invalid ? new Date(Date.UTC(year, month - 1, day)) : null;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// valid years are between 1700 and 4000 according to https://success.salesforce.com/answers?id=90630000000giqGAAQ\n\t_isValidYear(year) {\n\t\treturn year >= 1700 && year <= 4000;\n\t}\n}","export class DependentPicklistBuilder {\n\n\tconstructor(controlledPicklist, controllingValue) {\n\t\tthis.controlledPicklist = controlledPicklist;\n\t\tthis.controllingValue = controllingValue;\n\t}\n\n\tbuild() {\n\t\tlet options = this.controlledPicklist.picklistValues;\n\t\tlet validOptions = [];\n\t\toptions.forEach( function(option) {\n\t\t\tif (this._testBit(atob(option.validFor), this._getControllingValueIndex(this.controllingValue))) {\n\t\t\t\tvalidOptions.push(option);\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn validOptions;\n\t}\n\n\t_getControllingValueIndex(value) {\n\t\tif (this.controlledPicklist.controllingField.type === 'boolean')\n\t\t\treturn value === true ? 1 : 0;\n\n\t\tlet controllingOptions = this.controlledPicklist.controllingField.picklistValues;\n\t\tfor (let i = 0, l = controllingOptions.length; i < l; i++) {\n\t\t\tif (controllingOptions[i].value == value) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_testBit(validFor, controllingValueIndex) {\n\t\tvar byteToCheck = Math.floor(controllingValueIndex / 8);\n\t\tvar bit = 7 - (controllingValueIndex % 8);\n\t\treturn ((Math.pow(2, bit) & validFor.charCodeAt(byteToCheck)) >> bit) == 1;\n\t}\n\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Locale {\n\n\tstatic get() {\n\t\treturn AppContext.user ? (AppContext.user.locale || 'en-US' ) : 'en-US';\n\t}\n\n\tstatic isCommaDecimal(locale) {\n\t\treturn COMMA_DECIMAL_LOCALES.indexOf(locale || Locale.get()) !== -1;\n\t}\n}\n\n\n// The below list was compiled from\n// https://help.salesforce.com/apex/HTViewHelpDoc?id=admin_supported_locales.htm&language=en_US\n\n// commented out entries are locales that conflict with our client-side formatter (Intl.NumberFormatter):\n// (*)  formats with period decimal which contradicts SalesForce documentation above\n// (**) unsupported locale in our client formatter\n\nexport const COMMA_DECIMAL_LOCALES = [\n\t//'sq-AL', // Albania (*)\n\t'ar-DZ', // Algeria\n\t//'hy-AM', // Armenia (*)\n\t//'az-AZ', // Azerbaijani (*)\n\t//'eu-ES', // Basque (Spain) (*)\n\t//'be-BY', // Belarusian (Belarus) (*)\n\t//'bs-BA', // Bosnian (Bosnia and Herzegovina) (*)\n\t'bg-BG', // Bulgarian (Bulgaria)\n\t//'ca-ES-EURO', // Catalan (Spain, Euro) (**)\n\t'ca-ES', // Catalan (Spain)\n\t'hr-HR', // Croatian (Croatia)\n\t'cs-CZ', // Czech (Czech Republic)\n\t'da-DK', // Danish (Denmark)\n\t'nl-AW', // Dutch (Aruba)\n\t'nl-BE', // Dutch (Belgium)\n\t'nl-NL', // Dutch (Netherlands)\n\t'nl-SR', // Dutch (Suriname)\n\t'en-ZA', // English (South Africa) (*)\n\t'et-EE', // Estonian (Estonia)\n\t//'fi-FI-EURO', // Finnish (Finland, Euro) (**)\n\t'fi-FI', // Finnish (Finland)\n\t'fr-BE', // French (Belgium)\n\t'fr-CA', // French (Canada)\n\t'fr-KM', // French (Comoros)\n\t//'fr-FR-EURO', // French (France, Euro) (**)\n\t'fr-FR', // French (France)\n\t'fr-GN', // French (Guinea)\n\t'fr-HT', // French (Haiti)\n\t'fr-LU', // French (Luxembourg)\n\t'fr-MR', // French (Mauritania)\n\t'fr-MC', // French (Monaco)\n\t'fr-CH', // French (Switzerland)\n\t'fr-WF', // French (Wallis and Futuna)\n\t//'ka-GE', // Georgian (Georgia) (*)\n\t//'de-AT-EURO', // German (Austria, Euro) (**)\n\t'de-AT', // German (Austria)\n\t//'de-DE-EURO', // German (Germany, Euro) (**)\n\t'de-DE', // German (Germany)\n\t//'de-LU-EURO', // German (Luxembourg, Euro) (**)\n\t'de-LU', // German (Luxembourg)\n\t'el-GR', // Greek (Greece)\n\t'hu-HU', // Hungarian (Hungary)\n\t//'is-IS', // Icelandic (Iceland) (*)\n\t'in-ID', // Indonesian (Indonesia)\n\t'it-IT', // Italian (Italy)\n\t//'kk-KZ', // Kazakh (Kazakhstan) (*)\n\t//'km-KH', // Khmer (Cambodia) (*)\n\t'lv-LV', // Latvian (Latvia)\n\t'lt-LT', // Lithuanian (Lithuania)\n\t//'mk-MK', // Macedonian (Macedonia) (*)\n\t//'ms-BN', // Malay (Brunei) (*)\n\t'no-NO', // Norwegian (Norway)\n\t'pl-PL', // Polish (Poland)\n\t'pt-AO', // Portuguese (Angola)\n\t'pt-BR', // Portuguese (Brazil)\n\t'pt-CV', // Portuguese (Cape Verde)\n\t'pt-MZ', // Portuguese (Mozambique)\n\t'pt-PT', // Portuguese (Portugal)\n\t'pt-ST', // Portuguese (São Tomé and Príncipe)\n\t'ro-MD', // Romanian (Moldova)\n\t'ro-RO', // Romanian (Romania)\n\t'ru-RU', // Russian (Russia)\n\t'sr-BA', // Serbian (Bosnia and Herzegovina)\n\t'sr-RS', // Serbian (Serbia)\n\t'sr-CS', // Serbian (Serbia and Montenegro)\n\t//'sh-BA', // Serbo-Croatian (Bosnia and Herzegovina) (*)\n\t//'sh-ME', // Serbo-Croatian (Montenegro) (*)\n\t//'sh-CS', // Serbo-Croatian (Serbia and Montenegro) (*)\n\t'sk-SK', // Slovak (Slovakia)\n\t'sl-SI', // Slovenian (Slovenia)\n\t'es-AR', // Spanish (Argentina)\n\t'es-BO', // Spanish (Bolivia)\n\t'es-CL', // Spanish (Chile)\n\t'es-CO', // Spanish (Colombia)\n\t'es-CR', // Spanish (Costa Rico)\n\t'es-EC', // Spanish (Ecuador)\n\t'es-PY', // Spanish (Paraguay)\n\t//'es-ES-EURO', // Spanish (Spain, Euro) (**)\n\t'es-ES', // Spanish (Spain)\n\t'es-UY', // Spanish (Uruguay)\n\t'es-VE', // Spanish (Venezuela)\n\t'sv-SE', // Swedish (Sweden)\n\t'tr-TR', // Turkish (Turkey)\n\t'uk-UA', // Ukrainian (Ukraine)\n\t'vi-VN' // Vietnamese (Vietnam)\n];","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport class NumberFormatter {\n\n\tconstructor(editable, metadata, i18n, type, viewport) {\n\t\tthis.editable = editable;\n\t\tthis.metadata = metadata;\n\t\tthis.i18n = i18n;\n\t\tthis.type = type;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t\tthis.appContext = AppContext;\n\t}\n\n\t/**\n\t * Formats the provided number according to the current locale, possibly adding unit symbols for currency or percent.\n\t * @param {Number|null} value - The number to be formatted.\n\t * @param {Boolean} allowUnits - If true, unit symbols such as currency or % will be added based on the field type.\n\t * @returns {String}\n\t */\n\tformat(value, allowUnits) {\n\t\tlet opts = {};\n\t\tif (this.metadata.scale != undefined && this.metadata.scale >= 0) {\n\t\t\topts.minimumFractionDigits = this.metadata.scale;\n\t\t\topts.maximumFractionDigits = this.metadata.scale;\n\t\t}\n\n\t\t// To properly display the units on a given field, we must provide i18n with the correct formatting options.\n\t\tif (allowUnits) {\n\t\t\tif (this.type === 'currency') {\n\t\t\t\tthis._setCurrencyFormatOptions(opts);\n\t\t\t} else if (this.type === 'percent') {\n\t\t\t\tthis._setPercentFormatOptions(opts);\n\t\t\t\t// Intl expects fractional numbers when formatting percents. For example, if we tell it to format 15\n\t\t\t\t// as a percent, it will return 1,500% instead of 15%. To counter that, we divide the number by 100\n\t\t\t\t// before sending it through.\n\t\t\t\tvalue = value != null ? (value / 100) : null;\n\t\t\t}\n\t\t}\n\n\t\t// if editable, in mobile, and the number locale does not use a comma as a decimal\n\t\t// then omit the separators (comma or spaces) so we can display this editable number value in an input field of type number\n\t\t// so that the mobile device will leverage its number keyboard instead of its text keyboard\n\t\tif(this.editable && this.isMobile() && !Locale.isCommaDecimal())\n\t\t\topts.useGrouping = false;\n\n\t\tif(this.isNil(value))\n\t\t\treturn null;\n\n\t\ttry {\n\t\t\tlet formattedValue = this.i18n.format(value, opts);\n\t\t\tif (formattedValue === 'NaN')\n\t\t\t\tthrow new Error(`${value} is not a number`);\n\t\t\treturn formattedValue;\n\t\t} catch (err) {\n\t\t\treturn value;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || isNaN(value);\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * Adds properties to 'opts' such that it can be used to properly format a currency value.\n\t * @param {object} opts\n\t * @private\n\t */\n\t_setCurrencyFormatOptions (opts) {\n\t\topts.style = 'currency';\n\t\tif (this.appContext.org.isMultiCurrencyOrg) {\n\t\t\topts.currency = (this.metadata && this.metadata.CurrencyIsoCode) ? this.metadata.CurrencyIsoCode  : this.appContext.org.defaultCurrency;\n\t\t\topts.currencyDisplay = 'code';\n\t\t} else {\n\t\t\topts.currencyDisplay = 'symbol';\n\t\t\tif (!this.appContext.org.currencySymbol) {\n\t\t\t\topts.currency = this.appContext.org.defaultCurrency;\n\t\t\t} else {\n\t\t\t\topts.currency = 'XXX';  // International symbol for No Currency\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Adds properties to 'opts' such that it can be used to properly format a percent value.\n\t * @param {object} opts\n\t * @private\n\t */\n\t_setPercentFormatOptions(opts) {\n\t\topts.style = 'percent';\n\t}\n}","import {Locale} from 'common/forms/Locale.js';\n\nexport class NumberParser {\n\tconstructor(locale) {\n\t\tthis.locale = locale || Locale.get();\n\t\tthis.isCommaDecimalLocale = Locale.isCommaDecimal(this.locale);\n\t}\n\n\tparse(numberStr, strict = false, scale) {\n\t\tif(typeof numberStr !== 'string')\n\t\t\treturn this.applyScale(numberStr, scale); // if numberStr is not a string, then nothing to parse\n\n\t\t// some locales uses unusual separators such as spaces or apostrophes, so lets remove them\n\t\tnumberStr = this.removeUnusualSeparators(numberStr);\n\n\t\t// 4,200.50 in US becomes 4200.50, but 4.200,50 in French stays 4.200,50\n\t\tnumberStr = this.removeNonDecimalCommas(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4.200,50 in French becomes 4200,50\n\t\tnumberStr =\tthis.removeDecimalSepartors(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4200,50 in French becomes 4200.50\n\t\tnumberStr = this.replaceCommaDecimalWithPeriod(numberStr);\n\n\t\tlet number = parseFloat(numberStr);\n\n\t\t// if not strict simply return the number where the string \"5/\" would return 5\n\t\tif(!strict)\n\t\t\treturn this.applyScale(number, scale);\n\n\t\t// if strict ensure the number coalesces to the numberStr or return NaN, this prevents \"5/\" from becoming 5 and instead returns NaN\n\t\treturn number == numberStr ? this.applyScale(number, scale) : NaN;\n\t}\n\n\tremoveUnusualSeparators(numberStr) {\n\t\treturn numberStr.replace(new RegExp('[\\\\\\s]+', 'g'), '').replace(new RegExp(\"'\", 'g'), '').replace(new RegExp(\"’\", 'g'), '');\n\t}\n\n\tremoveNonDecimalCommas(numberStr) {\n\t\treturn !this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '') : numberStr;\n\t}\n\n\tremoveDecimalSepartors(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp('[.]', 'g'), '') : numberStr\n\t}\n\n\treplaceCommaDecimalWithPeriod(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '.') : numberStr;\n\t}\n\n\tapplyScale(number, scale) {\n\t\tif(scale == null || typeof number !== 'number') {\n\t\t\treturn number;\n\t\t}\n\t\treturn parseFloat(number.toFixed(scale));\n\t}\n\n}","import {OAUTH_KEY} from 'common/oauth/oauth.local.js';\nimport {OAUTH_SECRET} from 'common/oauth/oauth.local.js';\nimport {PRIVATE_API_SECRET} from 'common/oauth/oauth.local.js';\nimport {OAUTH_PROXY_URL} from 'common/oauth/oauth.local.js';\nimport {OAUTH_LOGIN_URL} from 'common/oauth/oauth.local.js';\n\nlet url = 'http://localhost:' + location.port + '/common/oauth';\nlet oauth2 = {\n\tclientId : OAUTH_KEY,\n\tclientSecret: OAUTH_SECRET,\n\tredirectUri: url + '/callback',\n\tproxyUrl: OAUTH_PROXY_URL,\n\tloginUrl: OAUTH_LOGIN_URL\n};\n\nexport class OAuth {\n\n\tconstructor(tokens) {\n\t\tif(!oauth2.clientId || !oauth2.clientSecret)\n\t\t\tthrow Error(this._getNoOAuthClientKeyMessage());\n\n\t\t// Below we override jsforce.browser functions around token management to include the refresh token\n\t\tvar storeTokens = jsforce.browser.Client.prototype._storeTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._storeTokens = function(params) {\n\t\t\tstoreTokens(params);\n\t\t\tlocalStorage.setItem(this._prefix + '_refresh_token', params.refresh_token);\n\t\t}.bind(jsforce.browser);\n\n\t\tvar removeTokens = jsforce.browser.Client.prototype._removeTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._removeTokens = function() {\n\t\t\tremoveTokens();\n\t\t\tlocalStorage.removeItem(this._prefix + '_refresh_token');\n\t\t}.bind(jsforce.browser);\n\n\t\tvar getTokens = jsforce.browser.Client.prototype._getTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._getTokens = function() {\n\t\t\tvar tokens = getTokens();\n\t\t\tif(tokens)\n\t\t\t\ttokens.refreshToken = localStorage.getItem(this._prefix + '_refresh_token');\n\t\t\treturn tokens;\n\t\t}.bind(jsforce.browser);\n\n\t\tvar isLoggedIn = jsforce.browser.Client.prototype.isLoggedIn.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype.isLoggedIn = function() {\n\t\t\tif(!isLoggedIn())\n\t\t\t\treturn false;\n\t\t   return this.connection.refreshToken;\n\t\t}.bind(jsforce.browser);\n\n\t\t// update the issued at to current date since we don't need to reauthorize since we have a never expire refresh token\n\t\t(function() {\n\t\t\t localStorage.setItem(this._prefix + '_issued_at', new Date().getTime());\n\t\t\t document.cookie = this._prefix + '_loggedin=true;';\n\t\t}).bind(jsforce.browser)();\n\n\t\tif(tokens)\n\t\t\tjsforce.browser._storeTokens(tokens);\n\n\t\t// override to refresh the access token via the proxy\n\t\tjsforce.OAuth2.prototype.refreshToken = this._refresAccessToken;\n\n\t\t// initialize with the OAUTH credentials\n\t\tjsforce.browser.init(oauth2);\n\t}\n\n\tlogin() {\n\t\tjsforce.browser.login();\n\t}\n\n\tgetConnection() {\n\t\tif(!jsforce.browser.isLoggedIn())\n\t\t\treturn Promise.reject('Please login before establishing a connection at http://localhost:' + location.port + '/common/oauth');\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tjsforce.browser.once('connect', function(conn) {\n\t\t\t\tconn.oik = PRIVATE_API_SECRET;\n\t\t\t\tconn.once(\"refresh\", function(accessToken) {\n\t\t\t\t\tthis.accessToken = accessToken;\n\t\t\t\t}.bind(this));\n\t\t\t   resolve(conn);\n\t\t\t}.bind(this));\n\t\t\tjsforce.browser.init(oauth2);\n\t\t}.bind(this));\n\t}\n\n\tset accessToken(accessToken) {\n\t\tlocalStorage.setItem(jsforce.browser._prefix + '_access_token', accessToken);\n\t}\n\n\tget tokens() {\n\t\treturn jsforce.browser._getTokens();\n\t}\n\n\tset tokens(tokens) {\n\t\tjsforce.browser._storeTokens(tokens);\n\t}\n\n\t_getNoOAuthClientKeyMessage() {\n\t\treturn 'Need to add a \\'.env.json\\' file in the CPQ dir whose contents contains the Consumer Key and Consumer Secret of the Salesforce CPQ Connected App, and then execute a gulp compile.\\n' +\n\t\t\t\t'{\"oauth_key\": \"<Consumer Key>, \"oauth_secret\": \"<Consumer Secret>\"}'\n\t}\n\n\t_refresAccessToken(refreshToken, callback) {\n\t\treturn this._transport.httpRequest({\n\t\t\tmethod: 'POST',\n\t\t\turl: oauth2.proxyUrl,\n\t\t\tbody: 'grant_type=refresh_token&refresh_token=' + refreshToken + '&client_id=' + this.clientId + '&client_secret=' + this.clientSecret,\n\t\t\theaders: {\n\t\t\t\t'SalesforceProxy-Endpoint': this.tokenServiceUrl,\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t\t\t}\n\t\t}).then(function (response) {\n\t\t\tvar res;\n\t\t\ttry {\n\t\t\t\tres = JSON.parse(response.body);\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t\tif (response.statusCode >= 400) {\n\t\t\t\tres = res || {error: \"ERROR_HTTP_\" + response.statusCode, error_description: response.body};\n\t\t\t\tvar err = new Error(res.error_description);\n\t\t\t\terr.name = res.error;\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn res;\n\t\t}).thenCall(callback);\n\t}\n\n\tencodeTokenUrl() {\n\t\tlet tokens = jsforce.browser._getTokens();\n\t\tlet refreshToken = tokens.refreshToken;\n\t\tlet orgUrl = encodeURIComponent(tokens.instanceUrl);\n\t\tlet id = encodeURIComponent(tokens.userInfo.url);\n\t\treturn url + '?rt=' + refreshToken + '&org=' + orgUrl + '&id=' + id;\n\t}\n\n\tstatic decodeTokenUrl(url) {\n\t\tif(!url) return;\n\t\tvar refreshToken = OAuth._getParameterByName('rt', url);\n\t\tvar orgUrl = OAuth._getParameterByName('org', url);\n\t\tvar id = OAuth._getParameterByName('id', url);\n\t\tif(refreshToken && orgUrl && id)\n\t\t\treturn { refresh_token: refreshToken, instance_url: orgUrl, id: id, access_token: 'xyz', issued_at: new Date().getTime() };\n\t}\n\n\tstatic _getParameterByName(name, url) {\n\t\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\t\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n\t\t\tresults = regex.exec(url);\n\t\tif (!results) return null;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n\t}\n}","export const OAUTH_KEY = 'undefined';\nexport const OAUTH_SECRET = 'undefined';\nexport const PRIVATE_API_SECRET = '';\nexport const OAUTH_PROXY_URL = 'http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/';\nexport const OAUTH_LOGIN_URL = 'https://test.salesforce.com';\n","import {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class RelationshipFieldManager {\n\n\tconstructor(field, record, getValueCallback, setValueCallback) {\n\t\tthis._validateConstructorInputs(getValueCallback, setValueCallback);\n\t\tthis.field = field;\n\t\tthis.record = record;\n\t\tthis.getValueCallback = getValueCallback;\n\t\tthis.setValueCallback = setValueCallback;\n\t}\n\n\thasRelationship() {\n\t\treturn !!(this.getRelationship());\n\t}\n\n\tgetRelationship() {\n\t\tlet relationshipField = RelationshipFieldManager.getRelationshipField(this.field);\n\t\tif(!relationshipField)\n\t\t\treturn;\n\n\t\tif (this.getValueCallback != null)\n\t\t\treturn this.getValueCallback(relationshipField);\n\n\t\treturn this.record[relationshipField];\n\t}\n\n\tgetRelationshipName(nameField) {\n\t\tlet relationship = this.getRelationship();\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tlet name = nameField || this._getLookupName(relationship);\n\t\treturn relationship[name];\n\t}\n\n\taddRelationshipName(id, display, tableName) {\n\t\tlet relationship = this.buildRelationship(id, display, tableName);\n\t\tif (!relationship.value.Id) {\n\t\t\trelationship.value = null;\n\t\t}\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tif (this.setValueCallback != null)\n\t\t\treturn this.setValueCallback(relationship.field, relationship.value);\n\n\t\tthis.record[relationship.field] = relationship.value;\n\t}\n\n\tbuildRelationship(id, display, tableName) {\n\t\tlet relationshipField = (RelationshipFieldManager.getRelationshipField(this.field));\n\t\tif (!relationshipField)\n\t\t\treturn;\n\n\t\tlet relationship = this.getRelationship() || {};\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\n\t\trelationship.Id = id;\n\t\trelationship[nameField] = display;\n\t\treturn { value: relationship, field: relationshipField };\n\t}\n\n\t_getLookupName(relationship) {\n\t\tlet relationshipTable = relationship.attributes ? relationship.attributes.type : '';\n\t\treturn new LookupNameMapper(relationshipTable).getNameField();\n\t}\n\n\tstatic getRelationshipField(idField, tableName) {\n\t\tlet relationshipField;\n\t\tif(idField.endsWith('__c'))\n\t\t\trelationshipField = idField.replace(/__c$/, '__r');\n\t\telse if(idField.endsWith('Id'))\n\t\t\trelationshipField = idField.substring(0, idField.length - 2);\n\n\t\tif(!relationshipField || !tableName)\n\t\t\treturn relationshipField;\n\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\t\treturn relationshipField + '.' + nameField;\n\t}\n\n\t_validateConstructorInputs(getValueCallback, setValueCallback) {\n\t\t// validate getValueCallback is a function\n\t\tif (getValueCallback != null && typeof getValueCallback !== 'function') {\n\t\t\tthrow new TypeError(\"callbacks required when record is null\");\n\t\t}\n\t\t// validate setValueCallback is a function\n\t\tif (setValueCallback != null && typeof setValueCallback !== 'function') {\n\t\t\tthrow new TypeError(\"callbacks required when record is null\");\n\t\t}\n\t}\n}","import {RuleExecutor} from 'common/rules/RuleExecutor.js';\nimport {RuleEvaluator} from 'common/rules/RuleEvaluator.js';\n\nexport class QuoteRuleExecutor extends RuleExecutor {\n\n\tconstructor(quote, rules, prefix, errorStrings) {\n\t\tsuper(rules, prefix, errorStrings);\n\t\tthis._init(quote);\n\t}\n\n\t_init(quote) {\n\t\tthis.quote = quote;\n\t\tthis.response = { 'requiredProductIds': [] };\n\t\tthis.lineItemsById = {};\n\t\tfor (let line of this.quote.lineItems || [])\n\t\t\tthis.lineItemsById[line.record[this.PRODUCT]] = line;\n\t}\n\n\texecute() {\n\t\tlet ruleEvaluator = new RuleEvaluator(this.rules, this.quote, this.prefix, this.errorStrings);\n\t\tfor (let rule of this.rules || []) {\n\t\t\tif (ruleEvaluator.isRuleSatisfied(rule))\n\t\t\t\tfor (let action of rule[this.ACTIONS].records)\n\t\t\t\t\tthis._conditionallyAddToResponseObject(action);\n\t\t}\n\n\t\treturn this.response;\n\t}\n\n\t_conditionallyAddToResponseObject(action) {\n\t\tlet responseType = super._getResponseType(action[this.TYPE]);\n\t\tif (responseType === null)\n\t\t\treturn;\n\t\tif (responseType === 'requiredProductIds' && this._productAdded(action[this.PRODUCT]))\n\t\t\treturn;\n\n\t\tthis.response[responseType].push(action[this.PRODUCT])\n\t}\n\n\t_productAdded(productId) {\n\t\treturn !!this.lineItemsById[productId];\n\t}\n}","import {OperatorsUtils} from 'common/rules/operators/OperatorsUtils.js';\n\nexport class RuleEvaluator {\n\n\tconstructor(rules, quote, prefix, errorStrings) {\n\t\tthis.rules = rules; //instantiated with rules originally, design changed. leaving for now to minimize change, expecting it to be useful on init eventually\n\t\tthis.quote = quote;\n\t\tthis.prefix = prefix === undefined ? '' : prefix;\n\t\tthis.errorStrings = errorStrings;\n\t\tthis._init();\n\t}\n\n\t_init() {\n\t\tthis._setConstants();\n\t\tthis._setAliasedFieldsMap();\n\t}\n\n\n\t_setConstants() {\n\t\tthis.ERROR_CONDITIONS = this.prefix + 'ErrorConditions__r';\n\t\tthis.TESTED_VARIABLE = this.prefix + 'TestedVariable__c';\n\t\tthis.CONDITIONS_MET = this.prefix + 'ConditionsMet__c';\n\t\tthis.TESTED_OBJECT = this.prefix + 'TestedObject__c';\n\t\tthis.TESTED_FIELD = this.prefix + 'TestedField__c';\n\t\tthis.FILTER_VALUE = this.prefix + 'FilterValue__c';\n\t\tthis.FILTER_TYPE = this.prefix + 'FilterType__c';\n\t\tthis.OPERATOR = this.prefix + 'Operator__c';\n\t\tthis.ACTIONS = this.prefix + 'Actions__r';\n\t}\n\n\t_setAliasedFieldsMap() {\n\t\tthis.aliasedFieldsMap = {\n\t\t\t'Quote': {\n\t\t\t\t'Group Line Items': this.prefix + 'LineItemsGrouped__c'\n\t\t\t}\n\t\t};\n\t}\n\n\tisRuleSatisfied(rule) {\n\t\tif (!this._hasActions(rule))\n\t\t\treturn false;\n\t\tif (!this._hasErrorConditions(rule))\n\t\t\treturn true;\n\n\t\tlet conditionsMet = rule[this.CONDITIONS_MET],\n\t\t\tresult = false;\n\n\t\tfor (let condition of rule[this.ERROR_CONDITIONS].records || []) {\n\t\t\tlet testedVariable = condition[this.TESTED_VARIABLE],\n\t\t\t\ttestedObject = condition[this.TESTED_OBJECT],\n\t\t\t\tconditionDetails = this.packageConditionDetails(condition);\n\n\t\t\tif (testedObject === 'Quote')\n\t\t\t\tresult = this.evaluateCondition(condition, this.quote.record, conditionDetails);\n\t\t\telse if (testedObject === 'Quote Line' && this.quote.lineItems.length > 0)\n\t\t\t\tresult = this.evaluateCollection(condition, this.quote.lineItems, conditionDetails);\n\t\t\telse if (testedObject === 'Quote Line Group' && this.quote.lineItemGroups.length > 0)\n\t\t\t\tresult = this.evaluateCollection(condition, this.quote.lineItemGroups, conditionDetails);\n\t\t\telse if (!!testedVariable) // Not currently supporting summary variables (left side)\n\t\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace(\"{0}\", condition.Id));\n\t\t\telse\n\t\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_no_tested_object.replace(\"{0}\", condition.Id));\n\n\t\t\tif (this._canReturnImmediately(result, conditionsMet))\n\t\t\t\treturn result;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpackageConditionDetails(condition) {\n\t\tlet op = new OperatorsUtils(condition[this.OPERATOR]).getInstance();\n\t\tif (op === null) {\n\t\t\tlet errorMsg = this.errorStrings.msg_jspr_err_invalid_operator\n\t\t\t\t.replace(\"{0}\", condition[this.OPERATOR])\n\t\t\t\t.replace(\"{1}\", condition.Id);\n\t\t\tthis._throwError(errorMsg);\n\t\t}\n\t\tif (condition[this.FILTER_TYPE] === 'Variable') // Not currently supporting summary variables (right side)\n\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace(\"{0}\", condition.Id));\n\n\t\treturn {\n\t\t\t'op': op,\n\t\t\t'filterValue': condition[this.FILTER_VALUE]\n\t\t};\n\t}\n\n\tevaluateCollection(condition, collection, conditionDetails) {\n\t\tlet i = 0,\n\t\t\tlen = collection.length,\n\t\t\tcollectionResult = false;\n\t\twhile (i < len && !collectionResult)\n\t\t\tcollectionResult = this.evaluateCondition(condition, collection[i++].record, conditionDetails);\n\n\t\treturn collectionResult;\n\t}\n\n\tevaluateCondition(condition, target, conditionDetails) {\n\t\tlet testedValue = this._getValue(condition, target);\n\t\treturn conditionDetails.op.evaluate(testedValue, conditionDetails.filterValue);\n\t}\n\n\t_getValue(condition, target) {\n\t\tlet testedObject = condition[this.TESTED_OBJECT],\n\t\t\ttestedField = condition[this.TESTED_FIELD],\n\t\t\taliasedField = this.aliasedFieldsMap[testedObject] && this.aliasedFieldsMap[testedObject][testedField] ? this.aliasedFieldsMap[testedObject][testedField] : null,\n\t\t\tfield = aliasedField === null ? testedField : aliasedField;\n\t\tif (Object.keys(target).indexOf(field) < 0) {\n\t\t\tlet errorMsg = this.errorStrings.msg_jspr_err_no_tested_field\n\t\t\t\t.replace(\"{0}\", condition.Id)\n\t\t\t\t.replace(\"{1}\", condition[this.TESTED_FIELD])\n\t\t\t\t.replace(\"{2}\", testedObject);\n\t\t\tthis._throwError(errorMsg);\n\t\t}\n\n\t\treturn target[field];\n\t}\n\n\t_throwError(msg) {\n\t\tthrow {'msg': msg, 'type': 'info'};\n\t}\n\n\t_canReturnImmediately(result, conditionsMet) {\n\t\treturn !!(conditionsMet == 'All' && !result) || !!(conditionsMet == 'Any' && result);\n\t}\n\n\t_hasErrorConditions(rule) {\n\t\treturn !!rule[this.ERROR_CONDITIONS];\n\t}\n\n\t_hasActions(rule) {\n\t\treturn !!rule[this.ACTIONS] && rule[this.ACTIONS].totalSize > 0;\n\t}\n}","export class RuleExecutor {\n\tconstructor(rules, prefix, errorStrings) {\n\t\tthis.rules = rules;\n\t\tthis.prefix = prefix === undefined ? '' : prefix;\n\t\tthis.errorStrings = errorStrings;\n\t\tthis._setConstants();\n\t}\n\n\t_setConstants() {\n\t\tthis.ACTIONS = this.prefix + 'Actions__r';\n\t\tthis.TYPE = this.prefix + 'Type__c';\n\t\tthis.PRODUCT = this.prefix + 'Product__c';\n\t}\n\n\t_getResponseType(actionType) {\n\t\tif (actionType === 'Add' || actionType === 'Enable & Add' || actionType === 'Show & Add')\n\t\t\treturn 'requiredProductIds';\n\n\t\treturn null;\n\t}\n}","export class AbstractFocusSignaler {\n\n\tconstructor(element, focusEvents, blurEvents) {\n\t\tthis.element = element;\n\t\tthis.focusEvents = focusEvents;\n\t\tthis.blurEvents = blurEvents;\n\t}\n\n\tsignalOnFocus(signalName, unregister) {\n\t\tthis.fireFocusSignal = this.fireFocusSignal || this._fireSignal.bind(this, signalName, true);\n\t\tthis.fireBlurSignal = this.fireBlurSignal || this._fireSignal.bind(this, signalName, false);\n\n\t\tfor(let focusEvent of this.focusEvents) {\n\t\t\tthis.element.removeEventListener(focusEvent, this.fireFocusSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(focusEvent, this.fireFocusSignal);\n\t\t}\n\n\t\tfor(let blurEvent of this.blurEvents) {\n\t\t\tthis.element.removeEventListener(blurEvent, this.fireBlurSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(blurEvent, this.fireBlurSignal);\n\t\t}\n\t}\n\n\tfireSignal(signalName, focused) {\n\t\tthis._fireSignals(signalName, focused);\n\n\t\tlet lastSignaler = this._getLastSignaler();\n\t\tif(lastSignaler === this)\n\t\t\treturn;\n\n\t\t// if we have a last signaler that is not this, then ensure it fires a signal with focus as false\n\t\tif(lastSignaler)\n\t\t\tlastSignaler._fireSignals(signalName, false);\n\n\t\t// set this as the last signaler\n\t\tthis._setLastSignaler();\n\t}\n\n\t/* abstract */ getSignalTargets() {\n\t\treturn [];\n\t}\n\n\tdisable() {\n\t\tthis._toggleDisabled(true);\n\t}\n\n\tenable() {\n\t\tthis._toggleDisabled(false);\n\t}\n\n\t_fireSignal(signalName, focused) {\n\t\tif(!this._isDisabled())\n\t\t\tthis.fireSignal(signalName, focused);\n\t}\n\n\t_fireSignals(signalName, focused) {\n\t\tlet targets = this.getSignalTargets();\n\t\tfor(let target of targets)\n\t\t\ttarget.fire( signalName,  { focused: focused, signaler: this } );\n\t}\n\n\t_getLastSignaler() {\n\t\treturn window && window.signaler ? window.signaler.last : null;\n\t}\n\n\t_isDisabled() {\n\t\treturn window && window.signaler && window.signaler.disabled;\n\t}\n\n\t_setLastSignaler() {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.last = this;\n\t\twindow.signaler = signaler;\n\t}\n\n\t_toggleDisabled(disabled) {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.disabled = disabled;\n\t\twindow.signaler = signaler;\n\t}\n}","import {AbstractFocusSignaler} from 'common/signal/AbstractFocusSignaler.js';\nimport {RowFieldSelector} from 'common/layout/tables/RowFieldSelector.js';\n\nexport class RowFocusSignaler extends AbstractFocusSignaler {\n\n\tconstructor(row, groupId, cellName, rowId, rowIndex, rowIndexAttribute, ironList) {\n\t\tsuper(row, ['tap', 'mouseenter'], ['mouseleave']);\n\t\tthis.groupId = groupId;\n\t\tthis.cellName = cellName;\n\t\tthis.rowId = rowId;\n\t\tthis.rowIndex = rowIndex;\n\t\tthis.rowIndexAttribute = rowIndexAttribute;\n\t\tthis.ironList = ironList;\n\t}\n\n\tgetSignalTargets() {\n\t\tlet groupIds = this.groupId.constructor === Array ? this.groupId : [this.groupId];\n\t\tlet fields = [];\n\t\tfor(let groupId of groupIds) {\n\t\t\tlet group = this.element.$$('#' + groupId);\n\t\t\tif (!group)\n\t\t\t\tcontinue;\n\n\t\t\tlet cells = Polymer.dom(group.root).querySelectorAll(this.cellName);\n\t\t\tfor (let cell of cells)\n\t\t\t\tfields.push(cell.$$('sb-field'));\n\t\t}\n\t\treturn fields;\n\t}\n\n\tsignalNextPreviousEditableTarget(current, next) {\n\t\tlet selector = this.selector;\n\t\tlet target = next ? selector.selectNextEditableField(current) : selector.selectPreviousEditableField(current);\n\t\tif(target) target.fire('sb-field-edit', { next: next } );\n\t}\n\n\tsignalFirstLastEditableTarget(first) {\n\t\tlet selector = this.selector;\n\t\tlet target = first ? selector.selectFirstEditableField() : selector.selectLastEditableField();\n\t\tif(target) target.fire('sb-field-edit', { next: first } );\n\t}\n\n\ttoggleRowFocus(signal) {\n\t\tif(signal.detail.focused && !this.element.focused) {\n\t\t\tthis.element.focused = true;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', true, this.element.$$('#' + this.rowId));\n\n\t\t} else if(!signal.detail.focused && this.element.focused) {\n\t\t\tthis.element.focused = false;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', false, this.element.$$('#' + this.rowId));\n\t\t}\n\t}\n\n\tget selector() {\n\t\treturn new RowFieldSelector(this.element, this.getSignalTargets(), this.rowIndex, this.rowIndexAttribute);\n\t}\n\n\tstatic signalFirstEditableTargetFirstRow(table, rowName, rowIndexAttribute) {\n\t\tlet target = RowFieldSelector.selectFirstEditableFieldInFirstRow(table, rowName, rowIndexAttribute);\n\t\tif(target) target.fire('sb-field-edit', { next: true } );\n\t}\n\n\tstatic signalLastEditableTargetLastRow(table, rowName, rowNum, rowIndexAttribute) {\n\t\tlet target = RowFieldSelector.selectLastEditableFieldInLastRow(table, rowName, rowNum, rowIndexAttribute);\n\t\tif(target) target.fire('sb-field-edit', { next: false } );\n\t}\n}","import {Page} from '../../common/core/Page.js';\n\n// TODO: remove prototype data\nvar templates = [\n\t{ name: 't1', title: 'My Favorite Template' },\n\t{ name: 't2', title: 'Okay Template' },\n\t{ name: 't3', title: 'Super Template' },\n\t{ name: 't4', title: 'Nasty Template' },\n\t{ name: 't5', title: 'Don\\'t Go Here' }\n];\n\nexport class DocgenPreview extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-docgen-preview';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: {  // object instance\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; }\n\t\t\t},\n\t\t\ttemplates: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return templates; }\n\t\t\t}\n\t\t}, Page.properties );\n\t}\n\n\tcancel() {\n\t\tthis.nav( '/entities/quote/detail?id=' + this.ctx.params.id );\n\t}\n\n\tpreview() {\n\t\tthis.nav( '/docgen/preview?id=' + this.ctx.params.id );\n\t}\n\n}\n\nPolymer( DocgenPreview );\n","import {clearReferencesToIds} from 'common/Util.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class FavoriteLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-lookup';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tlineEditorModel: Object,\n\t\t\tfavoriteModel: Object,\n\t\t\tselectedFavorites: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tactions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tqId: String,\n\t\t\taId: String,\n\t\t\tgroupKey: Number,\n\t\t\tisMobile: Boolean\n\t\t}, Page.properties );\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.qId = this.qId || this.ctx.params.qId;\n\t\tthis.aId = this.aId || this.ctx.params.aId;\n\t\tthis.groupKey = parseInt(this.groupKey || this.ctx.params.groupKey) || null;\n\t\tthis.isMobile = this._isMobileViewport();\n\n\t\tthis.$.le.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t}.bind(this));\n\n\t\tthis.$.md.addEventListener('md-changed', function(e) {\n\t\t\tthis._setMetaData(e.detail.value.fields);\n\t\t}.bind(this));\n\n\t\tthis.$.fm.addEventListener('response-changed', function() {\n\t\t\tthis._setSelected();\n\t\t}.bind(this));\n\n\t\tthis.$.addFavorite.addEventListener('response-changed', function(e) {\n\t\t\tlet quote = e.detail.value;\n\t\t\tif (quote.partialVO) {\n\t\t\t\tquote = this._recombinePartialQuoteWithFullQuote(quote);\n\t\t\t}\n\t\t\tthis.lineEditorModel.quote = quote;\n\t\t\tthis._toggleSelected();\n\t\t\tif (!this.addMore) {\n\t\t\t\tlet queryParams = {qId : this.qId };\n\t\t\t\tif (Object.keys(this.selectedFavorites).length > 0)\n\t\t\t\t\tqueryParams.jspr = true;\n\t\t\t\tif (this.ctx.params.groupKey != null)\n\t\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\t\tNavigator.nav('#', queryParams, ['quote', 'le'], false, this);\n\t\t\t}\n\n\t\t\tthis.$.header.selected = false;\n\t\t\tthis.addMore = false;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('favorite-shared', function(e) {\n\t\t\tthis.$.shareFavorites.addEventListener('response-changed', function() {\n\t\t\t\tthis._toggleSelected();\n\t\t\t}.bind(this));\n\n\t\t\tlet model = new DataBuilder()\n\t\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t\t.add('groupIds', e.detail.groups)\n\t\t\t\t.add('userIds', e.detail.users)\n\t\t\t\t.build();\n\n\t\t\tthis.$.shareFavorites.model = model;\n\t\t}.bind(this));\n\n\t\tthis._handleOneFavoriteSelected();\n\t\tthis._handleAllFavoritesSelected();\n\t}\n\n\t_recombinePartialQuoteWithFullQuote(partialQuote) {\n\t\t// If the response quote was a partial VO, then it means we need to compare the new VO with the old one,\n\t\t// and combine the data from both.\n\t\tvar originalLines = this.le.quote.lineItems;\n\t\t// Append the new line items onto the existing ones.\n\t\tpartialQuote.lineItems = originalLines.concat(partialQuote.lineItems);\n\t\t// Delete all of the temporary attributes we added to the partial VO, and stop marking it as a partial VO.\n\t\tdelete partialQuote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\tdelete partialQuote.emptyGroupKeys;\n\t\tpartialQuote.partialVO = false;\n\t\treturn partialQuote;\n\t}\n\n\t_setMetaData(fields) {\n\t\t// used to set up the table row to display appropriate data\n\t\tthis.cols = fields.map((field) => field.name);\n\t\tlet model = {};\n\t\tlet colsDisplay = {};\n\t\tfor (let field of fields) {\n\t\t\tmodel[field.name] = {type: field.type};\n\t\t\tcolsDisplay[field.name] = field.label;\n\t\t}\n\t\tthis.model = model;\n\t\tlet desc = this.lineEditorModel.developerPrefix + 'Description__c';\n\t\tthis.primaryMobileCols = ['Name', desc];\n\t\tthis.colsDisplay = colsDisplay;\n\t\tthis.fieldLabels = fields.map((field) => field.label);\n\t}\n\n\t_setSelected() {\n\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\tfavorite.selected = false;\n\t\t});\n\t}\n\n\t_handleOneFavoriteSelected() {\n\t\t// listen for selection changes to the favorite list\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tlet record = e.detail;\n\t\t\tlet selected = record.selected; // true if selected, false if unselected\n\t\t\tlet recordId = record.Id; // the id of the record that was just selected or unselected\n\n\t\t\tif (selected)\n\t\t\t\tthis.selectedFavorites[recordId] = record;\n\t\t\telse\n\t\t\t\tdelete this.selectedFavorites[recordId];\n\n\t\t}.bind(this));\n\t}\n\n\t_handleAllFavoritesSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function(e) {\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\n\t\t\tif (selected) {\n\t\t\t\tthis._toggleSelected(true);\n\t\t\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\t\t\tthis.selectedFavorites[favorite.record.Id] = favorite.record;\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\tthis._toggleSelected(false);\n\t\t\t\tthis.selectedFavorites = {};\n\t\t\t}\n\n\t\t}.bind(this));\n\t}\n\n\t_toggleSelected(bool) {\n\t\tlet selected = bool ? bool : false;\n\t\tthis.$.header.selected = selected;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\trow.selected = selected;\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeSelections() {\n\t\tthis.selectedFavorites = {};\n\t\tthis._setSelected();\n\t}\n\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tonDeleteFavorite() {\n\t\tconst toDelete = Object.keys(this.selectedFavorites);\n\t\tlet model = new DataBuilder()\n\t\t\t.add('quoteFavIds', this.le.quote.favoriteIds || [])\n\t\t\t.add('favIdsToRemove', toDelete)\n\t\t\t.build();\n\n\t\tthis.$.deleteFavorite.save({ model }).then(() => {\n\t\t\tconst field = new Constants(this.le.developerPrefix).FAVORITE_ID_FIELD;\n\t\t\tclearReferencesToIds(toDelete, field, this.le.quote.lineItems);\n\t\t});\n\t}\n\n\ttoggleAddProducts() {\n\t\tthis._toggleSelected();\n\t\tlet params = {qId : this.qId};\n\t\tif(this.groupKey != null)\n\t\t\tparams.groupKey = this.groupKey;\n\t\tif(this.aId)\n\t\t\tparams.aId = this.aId;\n\t\tNavigator.nav('#', params, ['product', 'lookup'], false, this);\n\t}\n\n\tonShareFavorite() {\n\t\tif (Object.keys(this.selectedFavorites).length === 0) {\n\t\t\tthis.error = [\"Please select at least one favorite to share.\"]; //TODO: custom label with sb18n\n\t\t\treturn;\n\t\t}\n\t\tthis.$.shareFavorite.$.dialog.toggle();\n\t}\n\n\tonSelect() {\n\t\tlet largeQuoteThreshold = this.le.settings.largeQuoteThreshold;\n\t\tlet largeQuoteMessage = this.le.customLabels.msg_large_quote_sent_without_lines;\n\t\tlet quote = this.le.quote;\n\t\tif (largeQuoteThreshold && quote.lineItems.length > largeQuoteThreshold) {\n\t\t\tquote = this._minimizeQuoteVO(quote);\n\t\t\tconsole.log(largeQuoteMessage.replace('{0}', quote.record.Id).replace('{1}', largeQuoteThreshold));\n\t\t}\n\t\tlet model = new DataBuilder()\n\t\t\t.addQuote('quote', quote)\n\t\t\t.add('groupKey', this.groupKey)\n\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t.build();\n\n\t\tthis.$.addFavorite.model = model;\n\t}\n\n\t_minimizeQuoteVO(largeQuote) {\n\t\tlet smallQuote = JSON.parse(JSON.stringify(largeQuote));\n\t\tlet qla = new QuoteLineAggregator(largeQuote);\n\t\t// In order to make sure that the proper number of MDQ segments gets added, we need to get maps of MDQ\n\t\t// templates.\n\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);\n\t\tsmallQuote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\tsmallQuote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey || -1) + ''] = templates;\n\t\t// In order to make sure that products with the New Quote Group flag checked are added to their own group\n\t\t// under the correct circumstances, we need to send a set of the groups that are empty.\n\t\tsmallQuote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\t\t// Now we remove all of the line items, and mark the quote as partial.\n\t\tsmallQuote.lineItems = [];\n\t\tsmallQuote.partialVO = true;\n\t\treturn smallQuote;\n\t}\n\n\tonSelectMore() {\n\t\tthis.addMore = true; // used to stay on page after adding favorites\n\t\tthis.onSelect();\n\t}\n\n\tonCancel() {\n\t\tlet queryParams = {qId : this.qId};\n\t\tif (this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tNavigator.nav('#', queryParams, ['quote', 'le'], false, this);\n\t}\n\n\tclearStackTrace() {\n\t\tif (this.errors.validations && this.errors.validations.length > 0) {\n\t\t\tthis.error = this.errors.validations;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = formatError(this.errors);\n\t}\n}\n\nPolymer( FavoriteLookup );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FavoriteShareDialog{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-share-dialog';\n\t\tthis.properties = {\n\t\t\tfavdUsers: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavdGroups: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavoriteCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._favoriteCallbackFunction.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\ticonMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\tUser: 'sf-icon-user',\n\t\t\t\t\tGroup: 'sf-icon-groups'\n\t\t\t\t}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-share-fav', this.onCancel);\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis.toggleClass('mobile', true, this.$.dialog);\n\t}\n\n\t_favoriteCallbackFunction(searchValue) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (searchValue == null || searchValue.length < 2) {\n\t\t\t\tthis.viewport.isMobile() ? this.$.multilookup.updateTable([]) : resolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\n\n\t\t\tthis.$.service.uid = '';\n\t\t\tthis.$.service.context = searchValue;\n\t\t\tthis.$.multilookup.menuItemLabels = ['label'];\n\n\t\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\t\tlet results =  this._parseResults(e.detail.value);\n\t\t\t\tif (this.viewport.isMobile()) { // mobile => multilookup will handle results\n\t\t\t\t\tthis.$.multilookup.updateTable(results);\n\t\t\t\t} else { // desktop => send results to typeahead\n\t\t\t\t\tresolve(results);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\t\treject(e.detail.value);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t_parseResults(results) {\n\t\tlet groups = results.groups,\n\t\t\tnumGroups = groups.length,\n\t\t\tusers = results.users,\n\t\t\tnumUsers = users.length;\n\n\t\tfor (let i=0; i<numGroups; i++) {\n\t\t\tgroups[i].type = 'Group';\n\t\t\tgroups[i].label = `Group - ${groups[i].Name}`;\n\t\t}\n\n\t\tfor (let j=0; j<numUsers; j++) {\n\t\t\tusers[j].type = 'User';\n\t\t\tusers[j].label = `User - ${users[j].Name}`;\n\t\t}\n\t\treturn users.concat(groups);\n\t}\n\n\tonShare() {\n\t\tlet selected = this.$.multilookup.selectedIdsByItems,\n\t\t\titems = Object.keys(selected).map(function(k) {\n\t\t\t\treturn selected[k];\n\t\t\t}),\n\t\t\tnumItems = items.length;\n\n\t\tfor (let i=0; i<numItems; i++) {\n\t\t\tlet type = items[i].type === 'Group' ? 'favdGroups' : 'favdUsers';\n\t\t\tthis.push(type, items[i].Id);\n\t\t}\n\n\t\tthis.fire('favorite-shared', { groups: this.favdGroups, users: this.favdUsers });\n\n\t\tthis.$.dialog.toggle();\n\t\tthis._clearFavdLists();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t_clearFavdLists() {\n\t\tthis.set('favdUsers', []);\n\t\tthis.set('favdGroups', []);\n\t\tthis.$.multilookup.clear();\n\t}\n}\n\nPolymer( FavoriteShareDialog );","export class LocalizeFields {\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tlocalizeSearchModel(searchModel) {\n\t\t//localize product fields\n\t\tlet localizedProducts = searchModel.localizationByFieldByProductId;\n\t\tif (!localizedProducts)\n\t\t\treturn searchModel;\n\n\t\tfor (let result of searchModel.results) {\n\t\t\tlet localizedFields = localizedProducts[result.record.Product2Id];\n\t\t\tif (localizedFields) {\n\t\t\t\tfor (let field in localizedFields) {\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localizedFields[field].record);\n\t\t\t\t\tif (!localizedValue)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tresult.record.Product2[field] = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn searchModel;\n\t}\n\n\tlocalizeProduct(product) {\n\t\t//localize bundle name\n\t\tif(!product.localizationByFieldByProductId) {\n\t\t\treturn product;\n\t\t}\n\t\tlet localized = product.localizationByFieldByProductId[product.record.Id];\n\t\tif (localized && localized.Name) {\n\t\t\tlet localizedFeatureName = this.getLocalizedValue(localized.Name.record);\n\t\t\tif (localizedFeatureName){\n\t\t\t\t//need to store untranslated values to search against on configurator\n\t\t\t\tif (!product.untranslatedRecord)\n\t\t\t\t\tproduct.untranslatedRecord = {Name: JSON.parse(JSON.stringify(product.record.Name))};\n\t\t\t\tproduct.record.Name = localizedFeatureName;\n\t\t\t}\n\t\t}\n\n\t\t//localize option fields\n\t\tfor (let option of product.options) {\n\t\t\tlet untranslatedRecord = {};\n\t\t\tfor (let field in option.localizationByFieldName) {\n\t\t\t\tlet localizedOptionField = null;\n\t\t\t\t// Our understanding is that we only localize custom fields\n\t\t\t\tif (field.indexOf('__c') === -1)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet localized = option.localizationByFieldName[field];\n\t\t\t\tif (localized)\n\t\t\t\t\tlocalizedOptionField = this.getLocalizedValue(localized.record);\n\t\t\t\t// TODO: W-014862: Should fix the backend processes so that we only get one version of the localized values, we are currently getting a prefixed value and a non prefixed value.\n\t\t\t\tif (field === 'Description__c') // TODO: This should be handled in the backend as well\n\t\t\t\t\tfield = this.prefix + 'ProductDescription__c';\n\n\t\t\t\tfield = this._appendPrefix(this.prefix, field, localized.record[this.prefix + 'APIName__c']);\n\n\t\t\t\tuntranslatedRecord[field] = option.record[field];\n\t\t\t\tif (localizedOptionField && option.record[field])\n\t\t\t\t\toption.record[field] = JSON.parse(JSON.stringify(localizedOptionField));\n\n\t\t\t\telse if(localizedOptionField && option.record[this.prefix + field]) //TODO: Fix underlying problems; this should become unnecessary\n\t\t\t\t\toption.record[this.prefix + field] = JSON.parse(JSON.stringify(localizedOptionField));\n\t\t\t}\n\n\t\t\tif (!option.untranslatedRecord)\n\t\t\t\toption.untranslatedRecord = untranslatedRecord;\n\t\t}\n\n\t\t//localize feature names\n\t\tfor (let feature of product.features) {\n\t\t\tif (!feature.untranslatedRecord)\n\t\t\t\tfeature.untranslatedRecord = {Name: JSON.parse(JSON.stringify(feature.record.Name))};\n\t\t\tlet localizationByFieldName = feature.localizationByFieldName;\n\t\t\tif (localizationByFieldName) {\n\t\t\t\tif (localizationByFieldName.Name) {\n\t\t\t\t\tlet localized = localizationByFieldName.Name;\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localized.record);\n\t\t\t\t\tif (localizedValue)\n\t\t\t\t\t\tfeature.record.Name = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn product;\n\t}\n\n\t/**\n\t * Given a field name, this function appends the developer prefix if also\n\t * exists on the localized object APIName field and is missing from the field\n\t * name.\n\t *\n\t * @param {String} prefix - the developer prefix.\n\t * @param {String} fieldName - the field name.\n\t * @param {Object} localizedFieldName - the localization object.\n\t *\n\t * @returns a fieldname with the prefix appended if needed.\n\t */\n\t_appendPrefix(prefix, fieldName, localizedFieldName) {\n\t\t// W-4342059: the localized field name doesn't have the prefix, so return.\n\t\t// This use case happens if the customer creates and localizes their own\n\t\t// custom field - they will have a different prefix for that field.\n\t\tif (localizedFieldName.indexOf(prefix) === -1)\n\t\t\treturn fieldName;\n\n\t\tif (fieldName.replace('__c', '') !== localizedFieldName.replace('__c', '') ||\n\t\t\tfieldName === localizedFieldName.replace(prefix, ''))\n\t\t\treturn prefix + fieldName;\n\n\t\treturn fieldName;\n\t}\n\n\tgetLocalizedValue(record) {\n\t\t//field text type can be 1 of 4\n\t\treturn record[this.prefix + 'Text__c'] ||\n\t\t\trecord[this.prefix + 'TextArea__c'] ||\n\t\t\trecord[this.prefix + 'LongTextArea__c'] ||\n\t\t\trecord[this.prefix + 'RichTextArea__c'];\n\t}\n}","import { AppContext } from 'common/core/AppContext.js';\nimport { ServiceClient } from 'common/data/client/ServiceClient.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\nimport { put } from 'quotes/models/ClientCache.js';\nimport { AppLogger, LOG_TYPE } from 'logging/AppLogger.js';\n\nconst COLUMN_SIZE_SAVED = 'columnSizeSaved';\nconst COLUMN_SIZE_RESET = 'columnSizeReset';\n\n/**\n * Calls APEX API to save the column sizing objects,\n * Invoked when user changes the columns of the table\n * @param {String} context - The context for the Save Service\n * context = {\n *  fieldSetName: String,\n *  columnSizes: { Field1: Value1, .. }\n *  shouldBeDefault: Boolean\n *  objectType: String\n * }\n * @param {String} field - the field being resized\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function saveColumnObjects(context, field) {\n\tlet response = new ServiceClient().save(AppContext.org.prefix, 'ColumnSizingServiceProvider.SaveColumnSizes', context);\n\tcolumnResizeResponse(response, context, field, LOG_TYPE.RESIZE_COLUMN, [COLUMN_SIZE_SAVED]);\n}\n\n/**\n * Calls APEX API to reset the column sizing objects,\n * Invoked when user clicks on the reset column sizes\n * @param {String} context - The context for the Save Service\n * context = {\n *  fieldSetName: String,\n *  shouldBeDefault: Boolean\n *  objectType: String\n * }\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function resetColumnSizes(context) {\n\tlet response = new ServiceClient().save(AppContext.org.prefix, 'ColumnSizingServiceProvider.ResetColumnSizes', context);\n\tcolumnResizeResponse(response, context, '', LOG_TYPE.RESET_COLUMN, [COLUMN_SIZE_RESET]);\n}\n\nexport function columnResizeResponse(resp, context, field, logType, testState) {\n\treturn resp.then(response => {\n\t\tput('TestOnlyStates', testState, true);\n\t\tif (!response.isSuccessful) {\n\t\t\tfireEvent(Events.COL_SIZE_ERR, {errorMessage: response.errorMessage});\n\t\t} else {\n\t\t\tconst logger = new AppLogger();\n\t\t\tlogger.log(null, logType, {field: logger.maskCustomerData(field)});\n\t\t}\n\t}, reject => {\n\t\tput('TestOnlyStates', testState, true);\n\t\tfireEvent(Events.COL_SIZE_ERR, {errorMessage: reject});\n\t});\n}\n","/**\n * Ensures that the required fields are not null or undefined\n * @param scheduleId - Consumption Schedule Id\n * @param rate - Rate Object\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n * @return {[]}\n */\nconst ensureNonNullValueValidations = (scheduleId, rate, consumptionRateFields) => {\n\tconst errorList = [];\n\tconst errorPayload = {\n\t\tscheduleId,\n\t\trateId: rate.Id,\n\t};\n\n\tif (rate[consumptionRateFields.Price] == null) {\n\t\terrorList.push({\n\t\t\t...errorPayload,\n\t\t\terrorMsg: labels.msg_missing_rate_field\n\t\t});\n\t}\n\n\tif (rate[consumptionRateFields.ProcessingOrder] == null) {\n\t\terrorList.push({\n\t\t\t...errorPayload,\n\t\t\terrorMsg: labels.msg_missing_rate_field\n\t\t});\n\t}\n\n\tif (rate[consumptionRateFields.LowerBound] == null) {\n\t\terrorList.push({\n\t\t\t...errorPayload,\n\t\t\terrorMsg: labels.msg_missing_rate_field\n\t\t});\n\t}\n\n\treturn errorList;\n};\n\n/**\n * Ensures that the transaction rate passed has a correct price value\n * These include - Ensuring Price has a number value\n * \t\t\t\t  - Ensuring Price is not less than zero\n *\n * @param scheduleId - Consumption Schedule Id\n * @param rate - Rate Object\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n *\n * @return {Array|{ratePrice: *, scheduleId: *, rateId: *, errorMsg: *}[]}\n */\nconst individualRatesWithPriceErrors = (scheduleId, rate, consumptionRateFields) => {\n\tif (rate[consumptionRateFields.Price] != null) {\n\t\tlet errorMsg = '';\n\t\tif (typeof rate[consumptionRateFields.Price] !== 'number') {\n\t\t\terrorMsg = labels.msg_rate_price_not_a_number;\n\t\t} else {\n\t\t\tconst ratePrice = parseInt(rate[consumptionRateFields.Price], 10);\n\t\t\tif (ratePrice < 0) {\n\t\t\t\terrorMsg = labels.msg_rate_price_is_negative;\n\t\t\t}\n\t\t}\n\n\t\tif (errorMsg !== '') {\n\t\t\treturn [{\n\t\t\t\tscheduleId,\n\t\t\t\trateId: rate.Id,\n\t\t\t\tratePrice: rate[consumptionRateFields.Price],\n\t\t\t\terrorMsg,\n\t\t\t}];\n\t\t}\n\t}\n\treturn [];\n};\n\n/**\n * @param {String|Integer} number - Returns true if the number is a whole number\n */\nconst isWholeNumber = (number) => {\n\tconst integerFromString = parseInt(number, 10);\n\treturn integerFromString.toString() === number.toString() && integerFromString >= 0;\n};\n\n/**\n * Ensures that the rate passed in does not have invalid bounds\n * If the upper Rate is not present then the {prefix}UpperBound__c key doesn't exist\n * These include\n * \t\t- A rate's lower bound is equal to its upper bound\n * \t\t- Lower bound is less than upper bound\n * \t\t- Lower Bound or Upper Bound are not whole numbers\n *\n * @param scheduleId - Consumption Schedule Id\n * @param rate - Rate Object\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n *\n * @return {Array|{ratePrice: *, scheduleId: *, rateId: *, errorMsg: *}[]}\n */\nconst individualRatesWithBoundValidations = (scheduleId, rate, consumptionRateFields) => {\n\tconst lowerBound = rate[consumptionRateFields.LowerBound];\n\tconst upperBound = rate[consumptionRateFields.UpperBound];\n\tlet errorMsg = '';\n\n\t// Lower Bound and Upper Bound should be whole numbers\n\tif ((lowerBound != null && !isWholeNumber(lowerBound)) || upperBound != null && !isWholeNumber(upperBound)) {\n\t\terrorMsg = labels.msg_bound_fields_must_be_positive;\n\t} else if (lowerBound != null && upperBound != null && parseInt(lowerBound, 10) >= parseInt(upperBound, 10)) {\n\t\terrorMsg = labels.msg_lower_bound_greater_than_upper_bound;\n\t}\n\n\treturn errorMsg !== '' ? [{\n\t\tscheduleId,\n\t\trateId: rate.Id,\n\t\tlowerBound: lowerBound,\n\t\tupperBound: upperBound,\n\t\terrorMsg,\n\t}] : [];\n};\n\n/**\n * Sorts by Processing order. If the Processing order is the same, it sorts by LowerBound\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n * @param rateA - first Rate\n * @param rateB - second Rate\n * @return {number}\n */\nconst sortByProcessingOrder = (consumptionRateFields) => {\n\treturn (rateA, rateB) => {\n\t\tif (rateA[consumptionRateFields.ProcessingOrder] > rateB[consumptionRateFields.ProcessingOrder]) {\n\t\t\treturn 1;\n\t\t} else if (rateA[consumptionRateFields.ProcessingOrder] === rateB[consumptionRateFields.ProcessingOrder]) {\n\t\t\treturn (rateA[consumptionRateFields.LowerBound] > rateB[consumptionRateFields.LowerBound]) ? 1 : -1;\n\t\t} else {\n\t\t\treturn -1;\n\t\t}\n\t};\n};\n\n/**\n * Validates that adjacent rates don't have the same processing order\n *\n * @param scheduleId - Consumption Schedule Id\n * @param lowerOrderRate - Rate object of the lower Processing order\n * @param higherOrderRate - Rate object of the higher Processing order\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n * @return [*]\n */\nconst validateDuplicateProcessingOrder = (scheduleId, lowerOrderRate, higherOrderRate, consumptionRateFields) => {\n\tif (higherOrderRate != null &&\n\t\tlowerOrderRate[consumptionRateFields.ProcessingOrder] != null &&\n\t\thigherOrderRate[consumptionRateFields.ProcessingOrder] != null\n\t) {\n\t\tconst lowerProcessingOrder = parseInt(lowerOrderRate[consumptionRateFields.ProcessingOrder], 10);\n\t\tconst upperProcessingOrder = parseInt(higherOrderRate[consumptionRateFields.ProcessingOrder], 10);\n\t\tif (lowerProcessingOrder === upperProcessingOrder) {\n\t\t\treturn [{\n\t\t\t\tscheduleId,\n\t\t\t\tprocessingOrder: lowerProcessingOrder,\n\t\t\t\terrorMsg: labels.msg_duplicate_rate_processing_order\n\t\t\t}];\n\t\t}\n\t}\n\treturn [];\n};\n\n/**\n * Validates adjacent rates for null Upper Bound for a lower rate\n * @param scheduleId - Consumption Schedule Id\n * @param currRate - Rate Object\n * @param isLastRate - True if the rate has the highest priority order for a Consumption Schedule\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n * @return {{scheduleId: *, errorMsg: string}[]|Array}\n */\nconst validateLowerRateNullUpperBound = (scheduleId, currRate, isLastRate, consumptionRateFields) => {\n\tif (!isLastRate && currRate[consumptionRateFields.UpperBound] == null) {\n\t\treturn [{\n\t\t\tscheduleId,\n\t\t\trateId: currRate.Id,\n\t\t\terrorMsg: labels.msg_lesser_rate_has_null_upper_bound\n\t\t}];\n\t}\n\treturn [];\n};\n\n/**\n * Validates adjacent rates for gaps and overlaps between rate tiers\n *\n * @param scheduleId - Consumption Schedule Id\n * @param lowerOrderRate - Rate object of the lower Processing order\n * @param higherOrderRate - Rate object of the higher Processing order\n * @param consumptionRateFields - Fields available on the Consumption Rate Object\n */\nconst validateGapsAndOverlapsBetweenRates = (scheduleId, lowerOrderRate, higherOrderRate, consumptionRateFields) => {\n\tif (higherOrderRate !== null && lowerOrderRate[consumptionRateFields.UpperBound] != null && higherOrderRate[consumptionRateFields.LowerBound] != null) {\n\t\tconst upperBoundOfLowerRate = parseInt(lowerOrderRate[consumptionRateFields.UpperBound], 10);\n\t\tconst lowerBoundOfUpperRate = parseInt(higherOrderRate[consumptionRateFields.LowerBound], 10);\n\t\tconst difference = lowerBoundOfUpperRate - upperBoundOfLowerRate;\n\t\tif (difference > 0) {\n\t\t\t// Validate there is no gap between the 2 rates upper and lower bounds\n\t\t\treturn [{\n\t\t\t\tscheduleId,\n\t\t\t\terrorMsg: labels.msg_gaps_between_rates_bounds\n\t\t\t}];\n\t\t} else if (difference < 0) {\n\t\t\t// Validate that 2 rates upper and lower bounds does not overlap\n\t\t\treturn [{\n\t\t\t\tscheduleId,\n\t\t\t\terrorMsg: labels.msg_overlap_between_rates_bounds\n\t\t\t}];\n\t\t}\n\t}\n\treturn [];\n};\n\n// private member to hold labels for the different validation labels\nlet labels;\n\n/**\n * Validates context to return validations related to the Price, Lower Bound and Upper\n * Bound fields on the Consumption Rate Object\n *\n * @param context - Input for the Consumption Rate Validator\n * context = {\n *     'scheduleA' : [{RateA1}, {RateA2}...],\n *     'scheduleB' : [{RateB1}, {RateB2}...],\n *     ...\n * }\n *\n * @param constants - Objects with the field constants\n *\n * @return {Array} - Array of all the validation errors that we are able to find\n * @constructor\n */\nexport const ConsumptionRateValidator = (context, constants, customLabels) => {\n\tlet errorList = [];\n\tlabels = customLabels;\n\tconst consumptionRateFields = constants.UBP_FIELDS.ConsumptionRateFields;\n\tObject.keys(context).forEach((scheduleId) => {\n\t\tconst orderedRates = context[scheduleId].sort(sortByProcessingOrder(consumptionRateFields));\n\t\torderedRates.forEach((currRate, index) => {\n\t\t\tconst nextRateIndex = index + 1;\n\t\t\tconst nextRate = orderedRates.length <= nextRateIndex ? null : orderedRates[nextRateIndex];\n\t\t\terrorList = [\n\t\t\t\t...errorList,\n\t\t\t\t...ensureNonNullValueValidations(scheduleId, currRate, consumptionRateFields),\n\t\t\t\t...individualRatesWithPriceErrors(scheduleId, currRate, consumptionRateFields),\n\t\t\t\t...individualRatesWithBoundValidations(scheduleId, currRate, consumptionRateFields),\n\t\t\t\t...validateDuplicateProcessingOrder(scheduleId, currRate, nextRate, consumptionRateFields),\n\t\t\t\t...validateGapsAndOverlapsBetweenRates(scheduleId, currRate, nextRate, consumptionRateFields),\n\t\t\t\t...validateLowerRateNullUpperBound(scheduleId, currRate, nextRateIndex === orderedRates.length, consumptionRateFields),\n\t\t\t];\n\t\t});\n\t});\n\treturn errorList;\n};\n","/**\n * Created by jfeingold on 11/18/16.\n */\nexport class AssetQuantityValidator {\n\tconstructor(quoteModel, constants) {\n\t\tthis.quoteModel = quoteModel;\n\t\tthis.constants = constants;\n\t}\n\n\tvalidateAssetQuantityChanges() {\n\t\tlet quoteType = this.quoteModel.record[this.constants.TYPE_FIELD];\n\t\tif (quoteType === 'Renewal') {\n\t\t\treturn this._validateAssetQuantityChangeForRenewal();\n\t\t} else if (quoteType === 'Amendment') {\n\t\t\treturn this._validateAssetQuantityChangeForAmendment();\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t_validateAssetQuantityChangeForRenewal() {\n\t\tvar errMsgs = [];\n\t\t// TODO: Replace hardcoded string with label msg_qty_cannot_decrease_on_renewal\n\t\tvar cannotDecreaseTemplate = 'Quantity of Line {0} cannot decrease below original value {1} on a Renewal Quote.';\n\t\tthis.quoteModel.lineItems.forEach(function(line) {\n\t\t\t// Check if the line corresponds to an existing asset.\n\t\t\tlet renewal = line.record[this.constants.RENEWAL_CHECKBOX];\n\t\t\tlet existing = line.record[this.constants.EXISTING_FIELD];\n\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\tif (renewal && existing && (priorQty != null)) {\n\t\t\t\t// On renewal quotes, asset quantities cannot decrease\n\t\t\t\tlet currentQty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\t\tif (currentQty != 0 && currentQty < priorQty) {\n\t\t\t\t\tlet newErrMsg = cannotDecreaseTemplate\n\t\t\t\t\t\t.replace('{0}', line.record[this.constants.NUMBER_FIELD])\n\t\t\t\t\t\t.replace('{1}', priorQty);\n\t\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t\treturn errMsgs;\n\t}\n\n\t_validateAssetQuantityChangeForAmendment() {\n\t\tvar errMsgs = [];\n\t\tvar negativeQtyLines = [];\n\t\tvar linesWithTooManyUpgrades = [];\n\t\tvar linesWithTooFewUpgrades = [];\n\n\t\tvar getLineActualQty = (line) => {\n\t\t\tlet qty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD] || 0;\n\t\t\tlet upgradedQty = line.record[this.constants.UPGRADED_QUANTITY] || 0;\n\t\t\tlet existingProduct = line.record[this.constants.EXISTING_FIELD];\n\t\t\tlet carryoverLine = line.record[this.constants.CARRYOVER_LINE_FIELD];\n\t\t\treturn existingProduct || carryoverLine ? qty - priorQty + upgradedQty : qty;\n\t\t};\n\n\t\tthis.quoteModel.lineItems.forEach(function(line) {\n\t\t\t// Check if the line corresponds to an existing asset\n\t\t\tlet assetId = line.record[this.constants.UPGRADED_ASSET_FIELD];\n\t\t\tif (assetId != null) {\n\t\t\t\tlet qty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\t\tif (qty < 0 ) {\n\t\t\t\t\t// The quantity cannot be negative.\n\t\t\t\t\t// If it's from the existing asset but removed the virtual quote line, it will skip this check\n\t\t\t\t\tif ( line.record[this.constants.EXISTING_FIELD] && line.record[this.constants.RENEWAL_CHECKBOX]) {\n\t\t\t\t\t\tnegativeQtyLines.push(line);\n\t\t\t\t\t}\n\t\t\t\t} else if (line.record[this.constants.EXISTING_FIELD] || line.record[this.constants.CARRYOVER_LINE_FIELD]) {\n\t\t\t\t\tlet upgradedQty = line.record[this.constants.UPGRADED_QUANTITY];\n\t\t\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\t\t\tif (upgradedQty > priorQty) {\n\t\t\t\t\t\t// You cannot upgrade more units of the product than you had to begin with.\n\t\t\t\t\t\tlinesWithTooManyUpgrades.push(line);\n\t\t\t\t\t} else if (!line.record[this.constants.ALLOW_ASSET_REFUND_FIELD] && getLineActualQty(line) < 0) {\n\t\t\t\t\t\t// If asset refunds are not allowed, the line's actual quantity may not decrease.\n\t\t\t\t\t\tlinesWithTooFewUpgrades.push(line);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\n\t\tif (negativeQtyLines.length > 0) {\n\t\t\t// TODO: Replace the hardcoded string with label msg_qty_no_negative_on_amend\n\t\t\tlet negativeQtyTemplate = 'The quantities of the assets in the Amendment Quote are not allowed to be negative. Please adjust line(s) {0}';\n\t\t\tlet lineNumbers = '';\n\t\t\tnegativeQtyLines.forEach(function(line) {\n\t\t\t\tlineNumbers += line.record[this.constants.NUMBER_FIELD] + ', ';\n\t\t\t}, this);\n\t\t\tlineNumbers = lineNumbers.substr(0, lineNumbers.lastIndexOf(','));\n\t\t\terrMsgs.push(negativeQtyTemplate.replace('{0}', lineNumbers));\n\t\t}\n\n\n\t\tif (linesWithTooManyUpgrades.length > 0) {\n\t\t\t// TODO: Replace hardcoded string with label msg_qty_of_upgrade_exceeds_source_prior;\n\t\t\tlet tooManyUpgradesTemplate = 'Combined quantity of upgrades to Line {0} cannot exceed {1}.';\n\t\t\tlinesWithTooManyUpgrades.forEach(function(line) {\n\t\t\t\tlet num = line.record[this.constants.NUMBER_FIELD];\n\t\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\t\tlet newErrMsg = tooManyUpgradesTemplate\n\t\t\t\t\t.replace('{0}', num)\n\t\t\t\t\t.replace('{1}', priorQty);\n\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t}, this);\n\t\t}\n\n\t\tif (linesWithTooFewUpgrades.length > 0) {\n\t\t\t// TODO: Replace hardcoded string with label msg_qty_of_source_too_low\n\t\t\tlet tooFewUpgradesTemplate = 'Product \"{0}\" cannot be refunded. The quantity of Line {1} cannot decrease without a corresponding upgrade.';\n\t\t\tlinesWithTooFewUpgrades.forEach(function(line) {\n\t\t\t\tlet prodName = line.record[this.constants.PRODUCT_NAME_FIELD];\n\t\t\t\tlet num = line.record[this.constants.NUMBER_FIELD];\n\t\t\t\tlet newErrMsg = tooFewUpgradesTemplate\n\t\t\t\t\t.replace('{0}', prodName)\n\t\t\t\t\t.replace('{1}', num);\n\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t}, this);\n\t\t}\n\t\treturn errMsgs;\n\t}\n}","/**\n * NOTE: It is recommended to use SafeClientCache.js now for safe\n * access/setting of client cache values with validations and\n * type safety.\n */\nimport { pathGet, pathSet } from 'common/Util.js';\n\nwindow.__clientCache = { data: { }, observers: new Map() };\n\nfunction getObserverNode(map, key) {\n\tif (!map.has(key)) {\n\t\tmap.set(key, { fields: new Map(), observers: [ ] });\n\t}\n\treturn map.get(key);\n}\n\n/**\n * Get the value at the key.\n * @param {string} key - The key of the record\n * @param {Array} path - The path to the value\n * @returns {*} - The value to get\n */\nexport function get(key, path = []) {\n\treturn pathGet(__clientCache.data[key], path);\n}\n\nfunction notifyRec(obsNode, path, oldVal, newVal, index) {\n\tif (oldVal === newVal || !obsNode) {\n\t\treturn;\n\t}\n\tfor (let observer of obsNode.observers) {\n\t\tobserver(newVal);\n\t}\n\n\tconst callNext = field => {\n\t\tnotifyRec(obsNode.fields.get(field), path,\n\t\t\toldVal ? oldVal[field] : undefined, newVal ? newVal[field] : undefined, index + 1);\n\t}\n\tif (index < path.length) {\n\t\tcallNext(path[index]);\n\t} else {\n\t\tobsNode.fields.forEach((val, key) => {\n\t\t\tcallNext(key);\n\t\t});\n\t}\n}\n\n/**\n * Put the provided value into the key location.\n * @param {string} key - The key of the value to put\n * @param {Array} path - The path to the value\n * @param {*} value - The value to put\n */\nexport function put(key, path, value) {\n\tconst oldVal = __clientCache.data[key];\n\t__clientCache.data[key] = pathSet(oldVal, path, value);\n\tnotifyRec(__clientCache.observers.get(key), path, oldVal, __clientCache.data[key], 0);\n}\n\n/**\n * Observe the value at the path location.\n * Note: Will not notify on mutations of objects. You should use the immutable pattern to avoid issues.\n * @param {string} key - The key of the record\n * @param {Array} path - The path to the value\n * @param {(*) => ()} observer - A function that gets called every time the value at the field changes\n * @returns {() => ()} - The function to call to stop observing the field.\n */\nexport function observe(key, path, observer) {\n\tif (typeof observer !== 'function') {\n\t\tthrow new Error('Observer must be a function!');\n\t}\n\n\tlet obsNode = getObserverNode(__clientCache.observers, key);\n\tfor (let field of path) {\n\t\tobsNode = getObserverNode(obsNode.fields, field);\n\t}\n\tobsNode.observers.push(observer)\n\n\tconst current = get(key, path);\n\tif (current !== undefined) {\n\t\tobserver(current);\n\t}\n\treturn () => {\n\t\tobsNode.observers.splice(obsNode.observers.indexOf(observer), 1);\n\t}\n}\n\n/**\n * Completely remove a record and all observers from the cache.\n * Will notify all observers that values within the record is undefined before removing them.\n * @param {string} key - The key of the record\n */\nexport function del(key) {\n\tput(key, [ ], undefined);\n\t__clientCache.observers.delete(key);\n\tdelete __clientCache.data[key];\n}\n","// UBP client state that doesn't exist on the server.\nexport class UBPClientState {\n\tconstructor(quoteLineOrProdId, lineKey, queryLimit) {\n\t\tthis.quoteLineOrProdId = quoteLineOrProdId; // The base level id for the UBP\n\t\tthis.lineKey = lineKey; // the key number of the line, combined with quoteLineOrProdId they uniquely identify a line\n\t\tthis.queryLimit = queryLimit; // How many rows to get from the server\n\t\tthis.categoryIndex = 0; // The index of the selected group\n\t\tthis.errorMsg = null; // Any error message to display to the user\n\t\tthis.searchKeyword = null; // A keyword that must be somewhere within the rates in the table\n\t\tthis.requestCount = 0; // The count of requests in flight\n\t}\n}\n\n// Related data is data that belongs at the scope of the record but doesn't exist on the record.\nexport class QuoteLineRelated {\n\tconstructor(categoryIds) {\n\t\tthis.categoryIds = categoryIds; // Ordered list of categories to determine the ordering of the tabs\n\t\tthis.ubpFields = null; // The fieldset metadata for the ubp header\n\t}\n}\n\nexport class Category {\n\tconstructor(name, label, fields, orderedRates, rateCount, rateCardFields, sortField) {\n\t\tthis.name = name; // The name of the category.\n\t\tthis.label = label; // A human readable label for the category.\n\t\tthis.fields = fields; // Field set governing what to show in a table row.\n\t\tthis.orderedRates = orderedRates; // Ordered list of what rates to display\n\t\tthis.rateCount = rateCount; // The total number of rates in the table\n\t\tthis.rateCardFields = rateCardFields; // Field set governing what rate card data to show in the hover window\n\t\tthis.sortField = sortField; // The field to sort over\n\t\tthis.sortOrder = 'asc'; // The direction to sort\n\t}\n}\n\nexport class FieldMetadata {\n\tconstructor(field, type, label) {\n\t\tthis.field = field; // the api name of the field\n\t\tthis.type = type; // the type of data coresponding to the field\n\t\tthis.label = label; // Human readable descriptor of the field\n\t}\n}\n\n/**\n * Metadata definition of all SafeClientCache keys and their\n * related metadata for safe client cache handling.\n *\n * Metadata Options:\n * - type - Data type for the value.\n * - localizable - Will localize the data.\n * - required - Whether the value can be set to a falsey value or not.\n */\nexport const TYPES = {\n\tRootState: {\n\t\tfields: {\n\t\t\tspinnerMessage: { // The message to be displayed in sf-loading-spinner component for async operations\n\t\t\t\ttype: 'string',\n\t\t\t\tlocalizable: true,\n\t\t\t\trequired: true\n\t\t\t},\n\t\t\tspinnerStatus: { // The status to be displayed in sf-loading-spinner component for async operations\n\t\t\t\ttype: 'string'\n\t\t\t},\n\t\t\tshowSpinnerMessage: { // A toggle of the visibility of the sf-loading-spinner message.\n\t\t\t\ttype: 'boolean',\n\t\t\t\trequired: true\n\t\t\t}\n\t\t}\n\t}\n}","export let CONSTANTS = null;\n\nexport function Constants(prefix) {\n\t//object names\n\tthis.QUOTE = `${prefix}Quote__c`;\n\tthis.QUOTE_LINE = `${prefix}QuoteLine__c`;\n\tthis.QUOTE_LINE_GROUP = `${prefix}QuoteLineGroup__c`;\n\n\t//field names\n\tthis.LAST_MODIFIED_DATE_FIELD = 'LastModifiedDate';\n\tthis.ACCOUNT_FIELD = `${prefix}Account__r`;\n\tthis.ACCOUNT_ID_FIELD = `${prefix}Account__c`;\n\tthis.ACTION_FIELD = `${prefix}Action__c`;\n\tthis.ADDITIONAL_DISCOUNT_AMOUNT_FIELD = `${prefix}AdditionalDiscountAmount__c`;\n\tthis.ADDITIONAL_DISCOUNT_FIELD = `${prefix}AdditionalDiscount__c`;\n\tthis.ADDITIONAL_DISCOUNT_RATE_FIELD = `${prefix}Discount__c`;\n\tthis.ADDITIONAL_QUANTITY_FIELD = `${prefix}AdditionalQuantity__c`;\n\tthis.ALLOW_ASSET_REFUND_FIELD = `${prefix}AllowAssetRefund__c`;\n\tthis.BATCH_QUANTITY = `${prefix}BatchQuantity__c`;\n\tthis.BUNDLE_FIELD = `${prefix}Bundle__c`;\n\tthis.BUNDLED_FIELD = `${prefix}Bundled__c`;\n\tthis.BUNDLED_QUANTITY_FIELD = `${prefix}BundledQuantity__c`;\n\tthis.CARRYOVER_LINE_FIELD = `${prefix}CarryoverLine__c`;\n\tthis.CLASS_FIELD = `${prefix}Class__c`;\n\tthis.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD = `${prefix}ComponentDiscountedByPackage__c`;\n\tthis.COMPONENT_LIST_TOTAL_FIELD = `${prefix}ComponentListTotal__c`;\n\tthis.COMPONENT_SUBSCRIPTION_SCOPE_FIELD = `${prefix}ComponentSubscriptionScope__c`;\n\tthis.COMPONENT_VISIBILITY_FIELD = `${prefix}ComponentVisibility__c`;\n\tthis.CONDITIONS_MET_FIELD = `${prefix}ConditionsMet__c`;\n\tthis.CONSUMPTION_RATE_OVERRIDE = `${prefix}ConsumptionRateOverride__c`;\n\tthis.COST_EDITABLE_FIELD = `${prefix}CostEditable__c`;\n\tthis.CUSTOM_ACTION_CONDITIONS_FIELD = `${prefix}Custom_Action_Conditions__r`;\n\tthis.CUSTOMER_AMOUNT_FIELD = `${prefix}CustomerAmount__c`;\n\tthis.CUSTOMER_PRICE_FIELD = `${prefix}CustomerPrice__c`;\n\tthis.DEFAULT_SUBSCRIPTION_TERM_FIELD = `${prefix}DefaultSubscriptionTerm__c`;\n\tthis.DEFAULT_FIELD = `${prefix}Default__c`;\n\tthis.DESCRIPTION_FIELD = `${prefix}Description__c`;\n\tthis.DIMENSION_ID_FIELD = `${prefix}Dimension__c`;\n\tthis.DIMENSION_FIELD = `${prefix}Dimension__r`;\n\tthis.DISCOUNT_AMOUNT_FIELD = `${prefix}DiscountAmount__c`;\n\tthis.DISCOUNT_SCHEDULE_FIELD = `${prefix}DiscountSchedule__c`;\n\tthis.DISCOUNT_SCHEDULE_TYPE_FIELD = `${prefix}DiscountScheduleType__c`;\n\tthis.DISCOUNT_TIER_FIELD = `${prefix}DiscountTier__c`;\n\tthis.DISCOUNT_TIERS_FIELD = `${prefix}DiscountTiers__r`;\n\tthis.DISCOUNT_UNIT_FIELD = `${prefix}DiscountUnit__c`;\n\tthis.DISTRIBUTOR_DISCOUNT_FIELD = `${prefix}DistributorDiscount__c`;\n\tthis.EFFECTIVE_END_DATE_FIELD = `${prefix}EffectiveEndDate__c`;\n\tthis.EFFECTIVE_QUANTITY = `${prefix}EffectiveQuantity__c`;\n\tthis.END_DATE_FIELD = `${prefix}EndDate__c`;\n\tthis.EVENT_HANDLER_NAME_FIELD = `${prefix}EventHandlerName__c`;\n\tthis.EXISTING_FIELD = `${prefix}Existing__c`;\n\tthis.FAVORITE_ID_FIELD= `${prefix}Favorite__c`;\n\tthis.FIELD_FIELD = `${prefix}Field__c`;\n\tthis.FILTER_VALUE_FIELD = `${prefix}FilterValue__c`;\n\tthis.GROUP_LINE_ITEMS_FIELD = `${prefix}LineItemsGrouped__c`;\n\tthis.ICON_CLASS_FIELD = `${prefix}IconClass__c`;\n\tthis.LABEL_FIELD = `${prefix}Label__c`;\n\tthis.LIST_PRICE_FIELD = `${prefix}ListPrice__c`;\n\tthis.LOCATION_FIELD = `${prefix}Location__c`;\n\tthis.LONG_TEXT_AREA_FIELD = `${prefix}LongTextArea__c`;\n\tthis.LOWER_BOUND_FIELD = `${prefix}LowerBound__c`;\n\tthis.MARKUP_AMOUNT_FIELD = `${prefix}MarkupAmount__c`;\n\tthis.MARKUP_FIELD = `${prefix}Markup__c`;\n\tthis.MARKUP_RATE_FIELD = `${prefix}MarkupRate__c`;\n\tthis.NET_AMOUNT_FIELD = `${prefix}NetAmount__c`;\n\tthis.NET_PRICE_FIELD = `${prefix}NetPrice__c`;\n\tthis.NET_TOTAL_FIELD = `${prefix}NetTotal__c`;\n\tthis.NON_DISCOUNTABLE_FIELD = `${prefix}NonDiscountable__c`;\n\tthis.NON_PARTNER_DISCOUNTABLE_FIELD = `${prefix}NonPartnerDiscountable__c`;\n\tthis.NUMBER_FIELD = `${prefix}Number__c`;\n\tthis.OPERATOR_FIELD = `${prefix}Operator__c`;\n\tthis.OPPORTUNITY_FIELD = `${prefix}Opportunity2__r`;\n\tthis.OPPORTUNITY_ID_FIELD = `${prefix}Opportunity2__c`;\n\tthis.OPTION_LEVEL_FIELD = `${prefix}OptionLevel__c`;\n\tthis.OPTION_TYPE_FIELD = `${prefix}OptionType__c`;\n\tthis.OPTIONAL_FIELD = `${prefix}Optional__c`;\n\tthis.ORIGINAL_QUOTE_LINE_FIELD = `${prefix}OriginalQuoteLine__c`;\n\tthis.ORIGINAL_SCHEDULE_FIELD = `${prefix}OriginalDiscountSchedule__c`;\n\tthis.OVERRIDE_BEHAVIOR_FIELD = `${prefix}OverrideBehavior__c`;\n\tthis.PAGE_FIELD = `${prefix}Page__c`;\n\tthis.PARENT_CUSTOM_ACTION_FIELD = `${prefix}ParentCustomAction__c`;\n\tthis.PARTNER_DISCOUNT_FIELD = `${prefix}PartnerDiscount__c`;\n\tthis.PARTNER_PRICE_FIELD = `${prefix}PartnerPrice__c`;\n\tthis.PRICE_EDITABLE_FIELD = `${prefix}PriceEditable__c`;\n\tthis.PRICEBOOK_ID_FIELD = `${prefix}PricebookId__c`;\n\tthis.PRICEBOOK_LOOKUP_ID_FIELD = `${prefix}PriceBook__c`;\n\tthis.PRICING_GUIDANCE_FIELD = `${prefix}Guidance__c`;\n\tthis.PRICING_METHOD_EDITABLE_FIELD = `${prefix}PricingMethodEditable__c`;\n\tthis.PRICING_METHOD_FIELD = `${prefix}PricingMethod__c`;\n\tthis.PRIMARY_FIELD = `${prefix}Primary__c`;\n\tthis.PRICE_SCALE_FIELD = `${prefix}PriceScale__c`;\n\tthis.BRAND_BUTTON_FIELD = `${prefix}BrandButton__c`;\n\tthis.PRIOR_QUANTITY_FIELD= `${prefix}PriorQuantity__c`;\n\tthis.PRODUCT = `${prefix}Product__c`;\n\tthis.PRODUCT_CODE_FIELD = `${prefix}ProductCode__c`;\n\tthis.PRODUCT_NAME_FIELD = `${prefix}ProductName__c`;\n\tthis.PRORATE_MULTIPLIER_FIELD = `${prefix}ProrateMultiplier__c`;\n\tthis.QUANTITY_FIELD = `${prefix}Quantity__c`;\n\tthis.QUOTE_PROCESS_FIELD = `${prefix}QuoteProcess__c`;\n\tthis.QUOTE_PROCESS_ID_FIELD = `${prefix}QuoteProcessId__c`;\n\tthis.REGULAR_PRICE_FIELD = `${prefix}RegularPrice__c`;\n\tthis.RENEWAL_CHECKBOX = `${prefix}Renewal__c`;\n\tthis.RENEWED_ASSET_ID_FIELD = `${prefix}RenewedAsset__c`;\n\tthis.RENEWED_ASSET_RELATIONSHIP_FIELD = `${prefix}RenewedAsset__r`;\n\tthis.RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD = `${prefix}RenewedSubscription__r`;\n\tthis.REQUIRED_BY_FIELD = `${prefix}RequiredBy__c`;\n\tthis.RICH_TEXT_AREA_FIELD = `${prefix}RichTextArea__c`;\n\tthis.SEGMENT_INDEX_FIELD = `${prefix}SegmentIndex__c`;\n\tthis.SEGMENT_KEY_FIELD = `${prefix}SegmentKey__c`;\n\tthis.SEGMENT_LABEL_FIELD = `${prefix}SegmentLabel__c`;\n\tthis.SOLUTION_GROUP_ID_FIELD = `${prefix}SolutionGroup__c`;\n\tthis.SOURCE_FIELD = `${prefix}Source__c`;\n\tthis.SPECIAL_PRICE_FIELD = `${prefix}SpecialPrice__c`;\n\tthis.START_DATE_FIELD = `${prefix}StartDate__c`;\n\tthis.SUBSCRIBED_ASSET_IDS_FIELD = `${prefix}SubscribedAssetIds__c`;\n\tthis.SUBSCRIPTION_BASE_FIELD = `${prefix}SubscriptionBase__c`;\n\tthis.SUBSCRIPTION_PRICING_FIELD = `${prefix}SubscriptionPricing__c`;\n\tthis.SUBSCRIPTION_SCOPE_FIELD = `${prefix}SubscriptionScope__c`;\n\tthis.SUBSCRIPTION_TERM_FIELD = `${prefix}SubscriptionTerm__c`;\n\tthis.TARGET_CUSTOMER_AMOUNT = `${prefix}TargetCustomerAmount__c`;\n\tthis.SUBSCRIPTION_TYPE_FIELD = `${prefix}SubscriptionType__c`;\n\tthis.TARGET_CUSTOMER_AMOUNT = `${prefix}TargetCustomerAmount__c`;\n\tthis.TARGET_OBJECT_FIELD = `${prefix}TargetObject__c`;\n\tthis.TEXT_FIELD = `${prefix}Text__c`;\n\tthis.TEXT_AREA_FIELD = `${prefix}TextArea__c`;\n\tthis.TYPE_FIELD = `${prefix}Type__c`;\n\tthis.UNIT_COST_FIELD = `${prefix}UnitCost__c`;\n\tthis.UPGRADE_CONVERSION_RATE = `${prefix}UpgradeConversionRate__c`;\n\tthis.UPGRADED_ASSET_FIELD = `${prefix}UpgradedAsset__c`;\n\tthis.UPGRADED_QUANTITY = `${prefix}UpgradedQuantity__c`;\n\tthis.UPGRADED_SUBSCRIPTION_FIELD = `${prefix}UpgradedSubscription__c`;\n\tthis.UPGRADED_CONTRACT_LINE = `UpgradedContractLine__c`;\n\tthis.UPLIFT_FIELD = `${prefix}Uplift__c`;\n\tthis.UPPER_BOUND_FIELD = `${prefix}UpperBound__c`;\n\tthis.URL_TARGET_FIELD = `${prefix}URLTarget__c`;\n\tthis.URL_FIELD = `${prefix}URL__c`;\n\tthis.RETURN_URL_FIELD = `${prefix}ReturnURL__c`;\n\tthis.USE_PRICE_FOR_AMOUNT_FIELD = `${prefix}UsePriceForAmount__c`;\n\tthis.USER_DEFINED_FIELD = `${prefix}UserDefined__c`;\n\tthis.UNOPENED_FIELD = `${prefix}Unopened__c`;\n\tthis.HAS_CONSUMPTION_SCHEDULE = `${prefix}HasConsumptionSchedule__c`;\n\n\t// Value\n\tthis.CUSTOM_VALUE = 'Custom';\n\tthis.PANEL_ADDED_INDEX = 2;\n\tthis.PERCENT_OF_TOTAL = 'Percent Of Total';\n\n\t// Dimension types\n\tthis.TYPE_STANDARD = 'Standard';\n\tthis.TYPE_YEARLY_DIMENSION = 'Year';\n\tthis.TYPE_QUARTERLY_DIMENSION = 'Quarter';\n\tthis.TYPE_MONTHLY_DIMENSION = 'Month';\n\tthis.TYPE_SINGLE_DIMENSION = 'One-time';\n\tthis.TYPE_CUSTOM_DIMENSION = 'Custom';\n\n\t// Quote Line Editor row types\n\tthis.STANDARD_LINE = 'STANDARD_LINE';\n\tthis.SEGMENTED_LINE = 'SEGMENTED_LINE';\n\tthis.GROUP_HEADER = 'GROUP_HEADER';\n\tthis.GROUP_FOOTER = 'GROUP_FOOTER';\n\n\t//Pricing guidance fields\n\tthis.PRICING_GUIDANCE_TARGET=`${prefix}Target__c`;\n\tthis.PRICING_GUIDANCE_FLOOR=`${prefix}Floor__c`;\n\tthis.PRICING_GUIDANCE_NORM=`${prefix}Norm__c`;\n\tthis.PRICING_GUIDANCE_EXPLANATION=`${prefix}Explanation__c`;\n\n\n\t// Groups\n\tthis.QUANTITY_FIELDS = new Set([\n\t\tthis.ADDITIONAL_QUANTITY_FIELD,\n\t\tthis.BATCH_QUANTITY,\n\t\tthis.BUNDLED_QUANTITY_FIELD,\n\t\tthis.EFFECTIVE_QUANTITY,\n\t\tthis.PRIOR_QUANTITY_FIELD,\n\t\tthis.QUANTITY_FIELD,\n\t\tthis.UPGRADED_QUANTITY\n\t]);\n\tthis.UNIT_PRICE_FIELDS = new Set([\n\t\tthis.ADDITIONAL_DISCOUNT_FIELD,\n\t\tthis.CUSTOMER_PRICE_FIELD,\n\t\tthis.LIST_PRICE_FIELD,\n\t\tthis.MARKUP_AMOUNT_FIELD,\n\t\tthis.NET_PRICE_FIELD,\n\t\tthis.PARTNER_PRICE_FIELD,\n\t\tthis.REGULAR_PRICE_FIELD,\n\t\tthis.SPECIAL_PRICE_FIELD,\n\t\tthis.UNIT_COST_FIELD\n\t]);\n\n\t// UBP field mappings\n\tthis.UBP_FIELDS = {\n\t\tConsumptionSchedule: `${prefix}QuoteLineConsumptionSchedule__r`,\n\t\tConsumptionScheduleId: `${prefix}QuoteLineConsumptionSchedule__c`,\n\t\tConsumptionRateFields: {\n\t\t\tUpperBound: `${prefix}UpperBound__c`,\n\t\t\tLowerBound: `${prefix}LowerBound__c`,\n\t\t\tProcessingOrder: `${prefix}ProcessingOrder__c`,\n\t\t\tPrice: `${prefix}Price__c`,\n\t\t},\n\t};\n\n\tthis.FIELD_SET_METADATA = {\n\t\tDefault: `${prefix}Default__c`,\n\t\tFieldSet: `${prefix}FieldSet__c`,\n\t\tObjectType: `${prefix}ObjectType__c`,\n\t};\n\n\tthis.COLUMN_METADATA = {\n\t\tFieldColumnSize: `${prefix}FieldColumnSize__c`,\n\t\tFieldName: `${prefix}FieldName__c`,\n\t\tFieldSetMetadata: `${prefix}FieldSetMetadata__c`,\n\t\tFieldSetMasterDetail: `${prefix}FieldSetMetadata__r`,\n\t\tFieldSet: `${prefix}FieldSet__c`,\n\t};\n\n\tthis.prefix = prefix;\n\n\tCONSTANTS = this;\n}\n","import {Util} from 'common/Util.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class CustomActionModel {\n\tconstructor(editorModel, customAction, customActionModelsByParentId, renderLocation) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.record = customAction; // CustomAction__c\n\t\tthis.customActionModelsByParentId = customActionModelsByParentId;\n\t\tthis.renderLocation = renderLocation;\n\n\t\tif (this.record) {\n\t\t\tthis.icon = this.record[this.editorModel.constants.ICON_CLASS_FIELD];\n\t\t\tthis.class = (this.icon ? this.icon : '');\n\t\t\tthis.caClass = this.record[this.editorModel.constants.CLASS_FIELD];\n\t\t\tthis.location = this.record[this.editorModel.constants.LOCATION_FIELD];\n\t\t\tthis.eventHandlerName = this.record[this.editorModel.constants.EVENT_HANDLER_NAME_FIELD];\n\t\t\tthis.label = this.record[this.editorModel.constants.LABEL_FIELD];\n\t\t\tthis.title = this.icon ? this.record[this.editorModel.constants.LABEL_FIELD] : null;\n\t\t\tthis.type = this.record[this.editorModel.constants.TYPE_FIELD];\n\t\t\tthis.isSeparator = (this.type === 'Separator');\n\t\t\tthis.primary = this.record[this.editorModel.constants.BRAND_BUTTON_FIELD];\n\t\t\tthis.urlTarget = this.record[this.editorModel.constants.URL_TARGET_FIELD];\n\t\t\tthis.url = this.record[this.editorModel.constants.URL_FIELD];\n\t\t\tthis.name = this.record.Name;\n\t\t}\n\t\tif (this.renderLocation === 'Line') {\n\t\t\tthis.class = `${this.class} ${this.eventHandlerName} lineAction`;\n\t\t}\n\t}\n\n\tisHidden(model) {\n\t\tif (model) {\n\t\t\tthis.model = model;\n\t\t}\n\t\tif (model && !this._customActionsConditionsMet) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.renderLocation === 'Line' && model) {\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onAddToFavorites\":\n\t\t\t\t\treturn model.favorite || model.hasParent || model.existing;\n\t\t\t\tcase \"onRemoveFromFavorites\":\n\t\t\t\t\treturn !model.favorite || model.existing;\n\t\t\t\tcase \"onDeleteLine\":\n\t\t\t\t\treturn model.hasParent || (model.existing && this.editorModel.quoteModel.isAmendment);\n\t\t\t\tcase \"onCloneLine\":\n\t\t\t\t\treturn model.hasParent;\n\t\t\t\tcase \"onReconfigureLine\":\n\t\t\t\t\treturn model.hasParent || !model.configurable;\n\t\t\t\tcase \"onResegmentLine\":\n\t\t\t\t\treturn !model.lineVO.productHasDimensions || model.segmented || model.existing || model.bundle;\n\t\t\t\tcase \"onDesegmentLine\":\n\t\t\t\t\treturn !model.lineVO.productHasDimensions || !model.segmented || model.existing || model.bundle;\n\t\t\t\tcase \"showDSModal\":\n\t\t\t\t\tlet dsField = this.editorModel.constants.DISCOUNT_SCHEDULE_FIELD;\n\t\t\t\t\tlet dsId = model.lineVO.record[dsField];\n\t\t\t\t\treturn dsId == null || model.isDiscountScheduleIdExcluded(model.lineVO.record[dsField]);\n\t\t\t\tcase \"onViewConsumptionSchedule\":\n\t\t\t\t\treturn AppContext.isMobile || !model.lineVO.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE] || !this.editorModel.data.settings.isUsageBasedPricingEnabled;\n\t\t\t\tcase \"onViewPricingGuidance\":\n\t\t\t\t\treturn !AppContext.isPricingGuidanceEnabled || model.lineVO.quoteLinePricingGuidance == null || model.lineVO.quoteLinePricingGuidance.isDeleted;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.renderLocation === 'Quote' && this.location === 'Quote/Group' && this.editorModel.quoteModel.grouped)\n\t\t\t\treturn true;\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onUngroup\":\n\t\t\t\t\treturn !this.editorModel.quoteModel.grouped;\n\t\t\t\tcase \"updateLineOptional\":\n\t\t\t\t\tif (!this.editorModel.toggleOptionalShown) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t// Both Optional: All and Optional: None should always show on Group level if toggleOptionalShown is true\n\t\t\t\t\t} else if (this.location === 'Group') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.caClass === 'optionalAllBtn' === this.editorModel.quoteModel.allOptional;\n\t\t\t\t\t}\n\t\t\t\tcase \"onRenewSubscriptions\":\n\t\t\t\t\treturn !this.editorModel.data.settings.renewSubscriptionsButtonRendered || this.editorModel.quoteModel.isAmendmentOrChangeQuote;\n\t\t\t\tcase \"onAmendSubscriptions\":\n\t\t\t\t\treturn !this.editorModel.quoteModel.isAmendment;\n\t\t\t\tcase \"onUpgradeAssets\":\n\t\t\t\t\treturn !this.editorModel.data.settings.upgradeAssetsButtonRendered;\n\t\t\t\tcase \"onDeleteLines\":\n\t\t\t\t\treturn !this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget _customActionsConditionsMet() {\n\t\tlet constants = this.editorModel.constants;\n\t\tif (!this.record || !this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD]) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet evaluateCondition = (condition) => {\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Product') {\n\t\t\t\tif (!this.model.productVO) return true; // not enough information to say condition is not met\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.model.productVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Quote') {\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.editorModel.quoteModel.quoteVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\t\t\treturn true; // if a target object isn't set, then there isn't enough information to say condition is not met\n\t\t};\n\n\t\tlet meetAllConditions = this.record[constants.CONDITIONS_MET_FIELD] !== 'Any';\n\t\tlet conditions = this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD].records;\n\n\t\tfor (let i = 0, l = conditions.length; i < l; i++) {\n\t\t\tif (evaluateCondition(conditions[i])) {\n\t\t\t\tif (!meetAllConditions) return true;\n\t\t\t} else {\n\t\t\t\tif (meetAllConditions) return false;\n\t\t\t}\n\t\t};\n\n\t\treturn meetAllConditions;\n\t}\n\n\tget hasMenu() {\n\t\tif (!this.children) {\n\t\t\tthis.children = this.customActionModelsByParentId ? this.customActionModelsByParentId[this.record.Id] : null;\n\t\t}\n\t\tif (this.type === \"Menu\" && this.children && this.children.length > 0) {\n\t\t\tfor (let i = 0, l = this.children.length; i < l; i++) {\n\t\t\t\tif (!this.children[i].isHidden(this.model))\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget default() {\n\t\tlet isDefault = this.record[this.editorModel.constants.DEFAULT_FIELD];\n\t\tthis.record[this.editorModel.constants.DEFAULT_FIELD] = false;\n\t\treturn isDefault;\n\t}\n\n\tget customActionId() {\n\t\treturn this.record.Id;\n\t}\n}\n","import { put, observe } from './ClientCache.js';\n\nfunction observeProp(cmp, prop) {\n\tif (cmp._ignoreFns.hasOwnProperty(prop)) {\n\t\tcmp._ignoreFns[prop]();\n\t}\n\tcmp._ignoreFns[prop] = observe(cmp._recordIds[prop], cmp.properties[prop].observing.path, (value) => {\n\t\tif (!cmp.__data__) {\n\t\t\tcmp._detach();\n\t\t} else {\n\t\t\tcmp.set(prop, value);\n\t\t}\n\t});\n}\n\n// Convenience behavior for mapping fields on a record to properties on a component completely declaratively.\n// To connect properties to the model. define an 'observing' object in the property declaration with the following fields:\n// id - If you don't need to dynamically calculate the id put the id in this field\n// idProperty - If the id is set in a different property, put the property name here\n// idFunction - If the id needs to be calculated with a function, put the complex observer definition here\n// path - The path to the data to attach this property to\n// twoWay - Set to true if you want to two way bind the data to the model\nexport const DataHandlerBehavior = {\n\tready: function() {\n\t\tthis._ignoreFns = { };\n\t\tthis. _recordIds = { };\n\n\t\tfor (let prop in this.properties) {\n\t\t\tconst propData = this.properties[prop].observing;\n\t\t\tif (propData) {\n\t\t\t\tif (!Array.isArray(propData.path)) {\n\t\t\t\t\tthrow new Error(`Expected path to be an Array. Got: ${propData.path}`);\n\t\t\t\t}\n\t\t\t\tif (propData.twoWay) {\n\t\t\t\t\tconst propObserver = `__${prop}Changed`;\n\t\t\t\t\tthis[propObserver] = (value) => {\n\t\t\t\t\t\tif (this._recordIds.hasOwnProperty(prop)) {\n\t\t\t\t\t\t\tput(this._recordIds[prop], propData.path, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tthis._createPropertyObserver(prop, propObserver);\n\t\t\t\t}\n\n\t\t\t\tconst idObserver = `__${prop}IdChanged`;\n\t\t\t\tif (propData.hasOwnProperty('id')) {\n\t\t\t\t\tthis._recordIds[prop] = propData.id;\n\t\t\t\t\tobserveProp(this, prop);\n\t\t\t\t} else if (propData.hasOwnProperty('idProperty')) {\n\t\t\t\t\tthis[idObserver] = () => {\n\t\t\t\t\t\tthis._recordIds[prop] = this.hasOwnProperty(prop) ? this[propData.idProperty]\n\t\t\t\t\t\t\t: this.__data__[propData.idProperty];\n\t\t\t\t\t\tobserveProp(this, prop);\n\t\t\t\t\t};\n\t\t\t\t\tthis._addObserverEffect(propData.idProperty, idObserver);\n\t\t\t\t} else {\n\t\t\t\t\tconst parenInd = propData.idFunction.indexOf('(');\n\t\t\t\t\tconst fnName = parenInd === -1 ? null : propData.idFunction.substring(0, parenInd);\n\t\t\t\t\tthis[idObserver] = (...args) => {\n\t\t\t\t\t\tthis._recordIds[prop] = this[fnName](...args);\n\t\t\t\t\t\tobserveProp(this, prop);\n\t\t\t\t\t}\n\t\t\t\t\tthis._addComplexObserverEffect(`${idObserver}${propData.idFunction.substring(parenInd)}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tattached: function() {\n\t\tfor (let prop in this._recordIds) {\n\t\t\tobserveProp(this, prop);\n\t\t}\n\t},\n\n\tdetached: function() {\n\t\tthis._detach();\n\t},\n\n\t_detach: function() {\n\t\tfor (let prop in this._ignoreFns) {\n\t\t\tthis._ignoreFns[prop]();\n\t\t}\n\t},\n}\n","export class DiscountTierModel {\n\tconstructor(discountTierRecord, discountScheduleRecord) {\n\t\tthis.template = discountTierRecord;\n\t\tthis.discountSchedule = discountScheduleRecord;\n\t\tthis.selected = false;\n\t\tthis.hidden = false;\n\t\tthis.disabled = false;\n\t\tthis.tiers = [];\n\t}\n}","export class DiscountTiersValidator {\n\n\tconstructor(discountSchedule, editorModel) {\n\t\tthis.schedule = discountSchedule;\n\t\tthis.editorModel = editorModel;\n\t\tthis.constants = editorModel.constants;\n\t\tthis.unitPriceScale = editorModel.data.settings.priceScale;\n\t\tthis.isMultiCurrencyOrg = editorModel.data.settings.isMultiCurrencyOrg;\n\t}\n\n\tvalidate(rows) {\n\t\tlet errors = new Map();\n\t\tlet lastTier = null;\n\t\tlet label = this.editorModel.data.customLabels;\n\t\tlet schedule = this.schedule;\n\t\trows.forEach(function(row) {\n\t\t\tlet error = null;\n\t\t\tlet number = row.template[this.constants.NUMBER_FIELD];\n\t\t\tlet lowerBound = row.template[this.constants.LOWER_BOUND_FIELD];\n\t\t\tlet upperBound = row.template[this.constants.UPPER_BOUND_FIELD];\n\t\t\tlet lastUpperBound = lastTier != null ? lastTier[this.constants.UPPER_BOUND_FIELD] : null;\n\t\t\tlet discountUnit = schedule[this.constants.DISCOUNT_UNIT_FIELD];\n\t\t\tlet discount = row.template[this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD];\n\t\t\t// Price is added to record for discount schedule modal so remove it here\n\t\t\tdelete row.template.Price;\n\t\t\tif (lowerBound == null) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_lower_bound_tier, [number]);\n\t\t\t} else if ( lastTier != null && lowerBound != lastUpperBound) {\n\t\t\t\terror = this.formatLabel(label.msg_unequal_lower_upper_bounds_tier, [number]);\n\t\t\t} else if ( discount == null && ( discountUnit == null || discountUnit.toUpperCase() === 'PERCENT')) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_discount_tier, [number]);\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound ) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t} else if ( discountUnit && discountUnit.toUpperCase() === 'AMOUNT') {\n\t\t\t\trow.tiers.forEach(function(tier) {\n\t\t\t\t\tif (this.discountFormatted(tier) === null) {\n\t\t\t\t\t\tif (this.isMultiCurrencyOrg) {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier_currency, [number, row.CurrencyIsoCode]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier, [number]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t}\n\t\t\tif (error != null) {\n\t\t\t\terrors.set(Number(number), error);\n\t\t\t}\n\t\t\tlastTier = row.template;\n\t\t}.bind(this));\n\t\treturn errors;\n\t}\n\n\tdiscountFormatted(tier) {\n\t\treturn tier[this.constants.DISCOUNT_AMOUNT_FIELD] == null ? null : (Number(tier[this.constants.DISCOUNT_AMOUNT_FIELD]).toFixed(this.unitPriceScale));\n\t}\n\n\tformatLabel(label, args) {\n\t\tfor (let i = 0, l = args.length; i < l; i++) {\n\t\t\tlabel = label.replace('{' + i + '}', args[i].toString());\n\t\t}\n\t\treturn label;\n\t}\n}","/**\n *  DragDropModel class - To create instances of the dragDrop model which holds data to be used during drag and drop of\n *  components in the line editor page.\n *\n *  Features:\n *      - Instantiate this model in the direct parent component where elements will be dragged and dropped.\n *      - Method to handle the three states of drag and drop: start, track, and stop.\n *      - Appends a placeholder component to the dom should the setting be enabled.\n *      - Uses a ghost element to indicate to the user that dragging is in progress.\n *      - Optional highlighting of drop zone is possible where appropriate.\n **/\n\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst topBorderHighlightClass = 'droppableTopBorder';\nconst bottomBorderHighlightClass = 'droppableBottomBorder';\nconst DEFAULT_GHOST_X_OFFSET = 60;\nconst DEFAULT_GHOST_Y_OFFSET = 23;\n\nlet dragging = false;\n\nexport class DragDropModel {\n\tconstructor(/*Host component direct parent to draggable*/ host,\n\t\t\t\t/*Boolean, keep bundle together setting*/ keepBundle,\n\t\t\t\t/*Draggable element name*/ draggable,\n\t\t\t\t/*Array of container elements that draggable can target based on element name & class*/ validTargets,\n\t\t\t\t/*Function to handle 'start' state*/ dragFunc,\n\t\t\t\t/*Function to handle 'track' state*/ trackFunc,\n\t\t\t\t/*Function to handle 'end' state*/ dropFunc,\n\t\t\t\t/*Integer*/ ghostXOffset,\n\t\t\t\t/*Integer*/ ghostYOffset) {\n\n\t\tthis.host = host;                           //{Element} The component implementing the DragDropModel class\n\t\tthis.keepBundleTogether = keepBundle;       //{Boolean} Keep bundle together setting that determines how bundles are treated\n\t\tthis.draggable = draggable;                 //{String} Name of the draggable element\n\t\tthis.validTargets = validTargets;           //{Set(String)} Set of classnames for drop targets\n\t\tthis.sourceElement;                         //{Element} The component/element being dragged\n\t\tthis.hoverOver;                             //{Element} Element that the mouse is hovering over.\n\t\tthis.placeHolderComp = null;                //{Element} Element acting as placeholder appended before or after a\n\t\t\t\t\t\t\t\t\t\t\t\t\t//          valid drop target to indicate where dropping would occur\n\t\tthis.ghostField;\n\t\tthis.targetClass;                           //{String} Classname of the valid drop area.\n\t\tthis.dropBefore;                            //{Boolean} Whether to drop before a valid drop target\n\t\tthis.usePlaceholder;                        //{Boolean} If a placeholder is to be used.\n\t\tthis.highlightTargetPosition;               //{Boolean} If want to highlight target component border\n\t\tthis.highlightableElements = [];            //{Elements} Array of elements whose border can be highlighted on hover.\n\t\tthis.enableHighLight;                       //{Boolean} If a drop zone is to be highlighted.\n\t\tthis.lineEditor = document.body.querySelector('sb-page-container') ? Polymer.dom(document.body.querySelector('sb-page-container').root).querySelector('sb-line-editor') : document.body.querySelector('sb-line-editor');\n\t\tthis.linesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.linesByParentItemKey : null;\n\t\tthis.standardLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.standardLinesByParentItemKey : null;\n\t\tthis.segmentedLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.segmentedLinesByParentItemKey : null;\n\n\t\t/**\n\t\t * Ghost information:\n\t\t * */\n\t\tthis.ghost = null;\n\t\tthis.ghostXOffset = (ghostXOffset == null) ? DEFAULT_GHOST_X_OFFSET : ghostXOffset;\n\t\tthis.ghostYOffset = (ghostYOffset == null) ? DEFAULT_GHOST_Y_OFFSET : ghostYOffset;\n\n\t\t/**\n\t\t* Call back functions passed from the host element\n\t\t* Allows user to define custom drag, track, and drop logic\n\t\t*/\n\n\t\tthis.handleDrag = dragFunc;\n\t\tthis.handleTrack = trackFunc;\n\t\tthis.handleDrop = dropFunc;\n\n\t\tthis._bootstrapMetricsService();\n\t}\n\n\t/**\n\t * Bootstrap qtcMetricsService so that it's available for tracking dnd actions\n\t * @private\n\t */\n\t_bootstrapMetricsService() {\n\t\tif (window.sb && window.sb.MetricsService && !this.metricsService) {\n\t\t\tthis.metricsService = new MetricsService();\n\t\t}\n\t}\n\n\t/**\n\t * Primary method that handles the three states ('start, 'track', 'stop) of Polymer 'track' gesture events.\n\t * Called by the 'onTrack' event on the component that is using the DragDropModel Class.\n\t * @private\n\t */\n\n\t_onTrack(e) {\n\t\t// Check viewport, if mobile then return\n\t\tlet mouseX = e.detail.x,\n\t\t\tmouseY = e.detail.y;\n\n\t\t_pauseEvent(e);\n\t\tswitch(e.detail.state) {\n\t\t\tcase 'start':\n\t\t\t\tif (Math.abs(e.detail.dx) < 9 && Math.abs(e.detail.dy) < 4) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag start ept');\n\t\t\t\t}\n\t\t\t\tdragging = true;\n\t\t\t\t//Disable text highlighting in Line Editor during drag and drop.\n\t\t\t\tthis.lineEditor.toggleClass('disable-selection', true);\n\n\t\t\t\tthis.sourceElement = Polymer.dom(e).localTarget;\n\t\t\t\tlet sourceBox = this.sourceElement.getBoundingClientRect();\n\t\t\t\tthis.sourceWidth = sourceBox.width;\n\t\t\t\tthis.sourceHeight = sourceBox.height;\n\t\t\t\tthis.handleDrag(this.sourceElement, e);\n\t\t\t\tthis._appendGhostImage(mouseX, mouseY);\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'track':\n\t\t\t\tif(!dragging) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag tracking ept');\n\t\t\t\t}\n\t\t\t\ttry{\n\t\t\t\t\t// Have ghost track mouseremoveTableRowBorderClass position\n\t\t\t\t\tthis._moveGhost(mouseX, mouseY);\n\t\t\t\t\t// Component that mouse is hovering over.\n\t\t\t\t\tlet hoverOverComp = Polymer.dom(e).event.detail.hover();\n\t\t\t\t\tif (this.draggable === 'sf-le-table-row' && (hoverOverComp.id === 'panel' || hoverOverComp.classList.contains('nav-item'))) {\n\t\t\t\t\t\tthis._hideGhost();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._showGhost();\n\t\t\t\t\t}\n\t\t\t\t\t// Call handleTrack function for custom logic during track phase\n\t\t\t\t\tthis.handleTrack(hoverOverComp);\n\t\t\t\t\tthis.host.debounce('Cursor flipping', function() {\n\t\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this.lineEditor, () => {\n\t\t\t\t\t\t\tif (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n\t\t\t\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (hoverOverComp !== this.previousHoverOverComp){\n\t\t\t\t\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor',true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.previousHoverOverComp = this.hoverOver.comp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this), 15);\n\n\t\t\t\t\t// Return early if hoverOver object is null, which represents invalid drop target\n\t\t\t\t\tif (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n\t\t\t\t\t\tthis._removeHighlightHover(this.previousHoverOverComp);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// if 'usePlaceholder' is truthy, append placeholder to new position.\n\t\t\t\t\tthis.host.debounce('Apply Placeholder', function() {\n\t\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\t\tif (this.usePlaceholder && this.hoverOver && Object.keys(this.hoverOver).length != 0) {\n\t\t\t\t\t\t\tthis._usePlaceholder(mouseX, mouseY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this), 22);\n\t\t\t\t\t// if 'enableHighlight' of drop zone is truthy,remove previously highlighted background and highlight\n\t\t\t\t\t// current element's background.\n\t\t\t\t\tif (this.enableHighLight) {\n\t\t\t\t\t\tthis._removeHighlightHover(this.previousHoverOverComp);\n\t\t\t\t\t\tthis._highlightHover(this.hoverOver.comp);\n\t\t\t\t\t}\n\t\t\t\t} catch (e){\n\t\t\t\t\t//  Revert dom changes if error is encountered\n\t\t\t\t\tthis.sourceElement.toggleAttribute ? this.sourceElement.toggleAttribute('hidden', false) :\n\t\t\t\t\t\tthis.sourceElement.removeAttribute('hidden');\n\t\t\t\t\tthis._removeGhost();\n\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'end':\n\t\t\t\tif(!dragging) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag end ept');\n\t\t\t\t}\n\t\t\t\tthis._removePlaceholder();\n\t\t\t\tthis._removeGhost();\n\n\t\t\t\tif(this.hoverOver){\n\t\t\t\t\tthis.handleDrop(this.sourceElement, this.hoverOver.comp, this.targetClass, this.dropBefore);\n\t\t\t\t\tthis._removeHighlightHover(this.hoverOver.comp);\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleDrop(this.sourceElement, null, this.targetClass, this.dropBefore);\n\t\t\t\t}\n\n\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\tthis.sourceElement = null;\n\t\t\t\tthis.previousHoverOverComp = null;\n\t\t\t\tthis.hoverOver = {};\n\t\t\t\tdragging = false;\n\n\t\t\t\t//Re-enable text highlighting in Line Editor.\n\t\t\t\tthis.lineEditor.toggleClass('disable-selection', false);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Method that fires an event that affects the ghost element.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\t * Fires an event to sb-line-editor component to add a ghost element to the page.\n\t * @event changed-ghost\n\t * @param {String} - sends a string of 'add' to indicate that a ghost will be added.\n\t * @param {String} - x location in terms of number of pixels.\n\t * @param {String} - y location in terms of nuber of pixels.\n\t * @param {String} - width in terms of number of pixels.\n\t * @param {String} - height in terms of number of pixels.\n\t */\n\n\t_appendGhostImage(x, y) {\n\t\tlet ghostElement = this._clonePolymerElement(this.sourceElement);\n\t\tlet loadingSpinner = ghostElement.querySelector('.loadingSpinner');\n\t\tif (loadingSpinner) loadingSpinner.remove();\n\n\t\tghostElement.hidden = false;\n\t\tlet gX = (x - this.ghostXOffset) + 'px';\n\t\tlet gY = (y - this.ghostYOffset) + 'px';\n\t\tthis.ghost.style.width = this.sourceWidth + 'px';\n\t\tthis.ghost.style.height = this.sourceHeight + 'px';\n\t\tthis.ghost.style.left = gX;\n\t\tthis.ghost.style.top = gY;\n\t\tthis.ghost.style.visibility = 'visible';\n\t\tthis.ghost.appendChild(ghostElement);\n\t}\n\n\t/**\n\t * Method that takes mouse location as parameter and moves the ghost.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\n\t */\n\n\t_moveGhost(x, y) {\n\t\t//let xOffset = (this.sourceWidth + 15)/2;\n\t\tlet gX = (x - this.ghostXOffset) + 'px',\n\t\t\tgY = (y - this.ghostYOffset) + 'px';\n\n\t\tthis.ghost.style.left = gX;\n\t\tthis.ghost.style.top = gY;\n\t}\n\n\t/**\n\t * Method that removes the ghost from page.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\t */\n\n\t_removeGhost() {\n\t\tthis.ghost.innerHTML = '';\n\t\tthis.ghost.style.left = '';\n\t\tthis.ghost.style.top = '';\n\t\tthis.ghost.style.width = '';\n\t\tthis.ghost.style.height = '';\n\t\tthis.ghost.style.visibility = 'hidden';\n\t}\n\n\t/**\n\t * Method that hides the ghost.\n\t * @private\n\t *\n\t */\n\t_hideGhost() {\n\t\tthis.ghost.style.visibility = 'hidden';\n\t}\n\n\t/**\n\t * Method that shows the ghost.\n\t * @private\n\t *\n\t */\n\t_showGhost() {\n\t\tthis.ghost.style.visibility = 'visible';\n\t}\n\n\t/**\n\t * Recursive method to find the droppable component where the draggable element is standard lines.\n\t * During hover, the mouse may target a non-valid element. Method will recursively look for domHost, host or\n\t * parentNode to find a valid drop target. If none is found, then null is returned.\n\t * @param {Element} el - element that the mouse is hovering over during tracking.\n\t * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n\t * before, after, or both.\n\t * @private\n\t */\n\n\t_findTableRowValidTarget(el) {\n\t\tif (!el) return null;\n\t\tif (this._ifParentIsValidTarget(el) && !el.classList.contains('tfoot') && el.id !== 'header'\n\t\t\t&& el.localName !== 'template' && el.localName !== 'sb-le-summary-row') {\n\t\t\t//  Exceptions needed for standard lines to exclude footer and summary row.\n\t\t\treturn el;\n\t\t}\n\t\tif (el.domHost){\n\t\t\treturn this._findTableRowValidTarget(el.domHost);\n\t\t} else if (el.host){    // For Safari and FF\n\t\t\treturn this._findTableRowValidTarget(el.host);\n\t\t} else if (el.parentNode) {\n\t\t\treturn this._findTableRowValidTarget(el.parentNode);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t_updateMDQTableRowHoverOverObject(drag, hover){\n\t\tif (hover.lineModel.dimensionType !== drag.lineModel.dimensionType) {\n\t\t\tthis.hoverOver = null;\n\t\t}else if(!this.keepBundleTogether) {\n\t\t\tthis.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n\t\t} else if (drag.lineModel.component && hover.lineModel.groupModel.groupKey !== drag.lineModel.groupModel.groupKey) {\n\t\t\tthis.hoverOver = null;\n\t\t} else {\n\t\t\tthis.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n\t\t}\n\t}\n\n\t/**\n\t * Method to find the valid droppable element if the draggable element is a side panel group.\n\t * @param {Object} el - object that contains the element targed on hover. Check if it's a valid drop target.\n\t * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n\t * before, after, or both.\n\t * @private\n\t */\n\t_findSidePanelGroupValidTarget(el) {\n\t\tif( this._ifParentIsValidTarget(el) ) {\n\t\t\treturn el;\n\t\t} else if(el.id === 'panel') {\n\t\t\tlet navItems = el.querySelectorAll('.nav-item');\n\t\t\treturn navItems[navItems.length - 1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdateTableRowHoverOverObject(hoverElement) {\n\t\tlet that = this;\n\t\tif (!hoverElement) {return;}\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.ref === 'before' ? that._getPreviousLineSibling(hoverElement) : that._getNextLineSibling(hoverElement);\n\t\t}\n\t\tif (!this.keepBundleTogether && hoverElement.lineModel) {\n\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t} else if (hoverElement.lineModel) {\n\t\t\tlet lineKey = hoverElement.lineModel.lineVO.key;\n\t\t\tif (!isComponent(this.sourceElement) ){\n\t\t\t\tif (!this.standardLinesByParentKey[lineKey] && !hoverElement.lineModel.component){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t\t\t} else if ( hoverElement.lineModel.bundle && !hoverElement.lineModel.component ){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n\t\t\t\t} else {\n\t\t\t\t\tthis.hoverOver = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (isComponent(this.sourceElement) ){\n\t\t\t\tif (ifLineElementsShareParent(hoverElement, this.sourceElement) && ifLineElementsAreParentChild(hoverElement, that._getNextLineSibling(hoverElement))){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n\t\t\t\t} else if (ifLineElementsShareParent(hoverElement, this.sourceElement)){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t\t\t} else {\n\t\t\t\t\tthis.hoverOver = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(hoverElement.classList.contains('tfoot')){\n\t\t\tthis.hoverOver = null;\n\t\t} else {\n\t\t\tthis.hoverOver = null;\n\t\t}\n\t}\n\n\t_getNextLineSibling(element) {\n\t\tlet index = parseInt(element.getAttribute(\"data-index\")) + 1;\n\t\treturn this._helpGetLineSibling(index, element);\n\t}\n\n\t_getPreviousLineSibling(element) {\n\t\tlet index = parseInt(element.getAttribute(\"data-index\")) - 1;\n\t\treturn this._helpGetLineSibling(index, element);\n\t}\n\n\t_helpGetLineSibling(index, element) {\n\t\tlet row_locator = \"sf-le-table-row\";\n\t\tlet locator = row_locator + \"[data-index='\" + index + \"']\";\n\t\treturn element.parentNode.querySelector(locator);\n\t}\n\n\t/**\n\t * Recursive method to find the dom custom element given the element's name.\n\t * @param {String} nodeName - element name.\n\t * @param {String} value of select; could be a value representing 'id', 'class', 'nodeName'\n\t * @param {String} selector - selector used to fine element valid entries ('id', 'class', 'nodeName').\n\t * @returns {Object} - Return the element if found.\n\t * @public\n\t */\n\n\t_findParentCustomElement(el, value, selector) {\n\t\tif (!el) return null;\n\t\tswitch(selector) {\n\t\t\tcase 'id':\n\t\t\t\tif (el.id === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'class':\n\t\t\t\tif (el.classList.contains(value)) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'nodeName':\n\t\t\t\tif (el.nodeName === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (el.rootNode){\n\t\t\treturn this._findParentCustomElement(el.rootNode, value, selector);\n\t\t} else if (el.host){\n\t\t\treturn this._findParentCustomElement(el.host, value, selector);\n\t\t} else if (el.parentNode) {\n\t\t\treturn this._findParentCustomElement(el.parentNode, value, selector);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\t_highlightHover(selected) {\n\t\tthis.host.toggleClass('hoverover', true, selected);\n\t}\n\n\t/**\n\t * Helper method to determine whether the element being passed is a valid target.\n\t * Criteria is whether the element's parent has a css class we're looking for.\n\t * @param {Element} element.\n\t * @private\n\t */\n\n\t_ifParentIsValidTarget(element) {\n\t\tif (!element || !element.parentElement) return false;\n\t\tlet classArr = Array.from(element.parentElement.classList);\n\t\tfor (let i = 0, len = classArr.length; i < len; i ++){\n\t\t\tif (this.validTargets.has(classArr[i])){\n\t\t\t\tthis.targetClass = classArr[i];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\n\t_removePlaceholder() {\n\t\tif (this.placeHolderComp && this.placeHolderComp.parentElement) {\n\t\t\tthis.placeHolderComp.parentElement.removeChild(this.placeHolderComp);\n\t\t\tthis.placeHolderComp = null;\n\t\t}\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\t_removeHighlightHover(selected) {\n\t\tif (!selected || !selected.parentNode) return;\n\t\tPolymer.dom(selected.parentNode).querySelectorAll(selected.localName).forEach(\n\t\t\t(node) => {\n\t\t\t\tthis.host.toggleClass('hoverover', false, node);\n\t\t\t}\n\t\t)\n\t}\n\n\t/**\n\t * If 'highlightTargetPosition' property is truthy, css class to highlight the top or bottom highlightableElements\n\t * element border during tracking.\n\t * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n\t * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n\t * @private\n\t */\n\n\t_highlightDroppableBorder(x, y) {\n\t\tlet boundBox = this.hoverOver.comp.getBoundingClientRect(),\n\t\t\tmidHeight = boundBox.top + boundBox.height / 2,\n\t\t\tresults = this.highlightableElements;\n\n\t\tswitch (this.hoverOver.phLoc) {\n\n\t\t\tcase 'both':\n\t\t\t\tif (y < midHeight) {\n\t\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t\t_addTopBorderClass(results[m]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t} else if (y > midHeight) {\n\t\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t\t_addBottomBorderClass(results[m]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'before':\n\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t_addTopBorderClass(results[m]);\n\t\t\t\t}\n\t\t\t\tthis.dropBefore = true;\n\t\t\t\tbreak;\n\t\t\tcase 'after':\n\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t_addBottomBorderClass(results[m]);\n\t\t\t\t}\n\t\t\t\tthis.dropBefore = false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Remove the css class used to highlight the top or bottom previous highlightableElements border during tracking.\n\t * @private\n\t */\n\n\t_removeHighlightDroppableBorder(elements) {\n\t\tif (!elements) {return;}\n\n\t\tfor (let m = 0, l = elements.length; m < l; m++) {\n\t\t\tremoveTopBottomBorderClass(elements[m]);\n\t\t}\n\t}\n\n\t/**\n\t * If 'usePlaceholder' property is truthy, apply a placeholder to indicate to user a valid drop area.\n\t * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n\t * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n\t * @private\n\t */\n\n\t_usePlaceholder(mouseX, mouseY) {\n\t\t//Target hoverOver only if element is valid, not the same as source element, and not the placeholder.\n\t\tif (this.hoverOver && this.hoverOver.comp !== this.placeHolderComp){\n\t\t\tlet boundBox = this.hoverOver.comp.getBoundingClientRect(),\n\t\t\t\tmidHeight = boundBox.top + boundBox.height/ 2;\n\t\t\tif(!this.placeHolderComp){\n\t\t\t\t// place holder component is the clone of the source element, or draggable\n\t\t\t\tif (this.sourceElement.deepCloneNode) {\n\t\t\t\t\tthis.placeHolderComp = this.sourceElement.deepCloneNode();\n\t\t\t\t\tthis.placeHolderComp.hidden = false;\n\t\t\t\t\tthis.placeHolderComp.setAttribute('id', 'placeholder');\n\t\t\t\t\tthis.placeHolderComp.$$ ? this.placeHolderComp.toggleClass('placeholder', true, this.placeHolderComp.$$('.tr')) : null;\n\t\t\t\t} else {\n\t\t\t\t\tthis.placeHolderComp = this.host.create(this.draggable);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('id', 'placeholder');\n\t\t\t\t\tthis.placeHolderComp.$$ ? this.placeHolderComp.toggleClass('placeholder', true, this.placeHolderComp.$$('.tr')) : null;\n\t\t\t\t\tfor (let x in this.sourceElement.properties) {\n\t\t\t\t\t\tif (x === 'data') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.placeHolderComp[x] = this.sourceElement[x];\n\t\t\t\t\t\t} catch (e) {/* Just catch the exception in case property is read-only*/};\n\t\t\t\t\t}\n\t\t\t\t\tthis.placeHolderComp['data'] = this.sourceElement['data'];   // Ensure data is set last\n\t\t\t\t}\n\t\t\t\tthis.placeHolderComp.style.width = boundBox.width + 'px';\n\t\t\t\tthis.placeHolderComp.style.height = boundBox.height + 'px';\n\t\t\t\tthis.placeHolderComp.style.backgroundColor = '#d8dde6';\n\t\t\t}\n\n\t\t\tswitch(this.hoverOver.phLoc) {\n\t\t\t\tcase 'both':\n\t\t\t\t\tif (mouseY < midHeight){\n\t\t\t\t\t\tPolymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n\t\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'after');\n\t\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t\t} else if (mouseY > midHeight){\n\t\t\t\t\t\tPolymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n\t\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'before');\n\t\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'before':\n\t\t\t\t\tPolymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'after');\n\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'after':\n\t\t\t\t\tPolymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'before');\n\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else if (this.hoverOver && this.hoverOver.comp === this.placeHolderComp){\n\t\t\tif (!this.placeHolderComp.hasAttribute('ref')) return;\n\t\t\tif (this.placeHolderComp.getAttribute('ref') === 'before'){\n\t\t\t\tthis.hoverOver.comp = this.hoverOver.comp.previousElementSibling;\n\t\t\t\tthis.dropBefore = false;\n\t\t\t} else if (this.placeHolderComp.getAttribute('ref') === 'after'){\n\t\t\t\tthis.hoverOver.comp = this.hoverOver.comp.nextElementSibling;\n\t\t\t\tthis.dropBefore = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_clonePolymerElement(node) {\n\t\t// use custom deepClone logic if available\n\t\tif (node.deepCloneNode) {\n\t\t\treturn node.deepCloneNode();\n\t\t}\n\t\tlet clonedElement = node.cloneNode(true);\n\t\tfor (let x in node.properties) {\n\t\t\tif (x === 'data') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttry{\n\t\t\t\tclonedElement[x] = node[x];\n\t\t\t}catch(e){/* Just catch the exception in case property is read-only*/};\n\t\t}\n\t\tclonedElement['data'] = node['data'];   // Ensure data is set last\n\t\treturn clonedElement;\n\t}\n\n}\n\n/**\n * Helper method that receives an event object and prevents further propagation of the event.\n * @param {Event} e - event object from the track event.\n * @private\n */\n\nfunction _pauseEvent(/* Event */e){\n\tif(e.stopPropagation) e.stopPropagation();\n\tif(e.preventDefault) e.preventDefault();\n\treturn false;\n}\n\n/**\n * Helper method that receives node and toggles style of the top border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addTopBorderClass(node) {\n\tnode.classList.add(topBorderHighlightClass);\n}\n\n/**\n * Helper method that receives node and toggles style of the bottom border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addBottomBorderClass(node) {\n\tnode.classList.add(bottomBorderHighlightClass);\n}\n\nexport function removeTableRowBorderClass(rowComp){\n\tlet tds = Array.from(Polymer.dom(rowComp.root).querySelector('.tr').getElementsByClassName('td'));\n\tfor (let m = 0, l = tds.length; m < l; m++) {\n\t\tremoveTopBottomBorderClass(tds[m]);\n\t}\n}\n\n/**\n * Helper method that removes border style of the top and bottom border if exists.\n * @param {Element} node - DOM node.\n * @private\n */\n\nexport function removeTopBottomBorderClass(node) {\n\tif (node.classList.contains(topBorderHighlightClass)) {\n\t\tnode.classList.remove(topBorderHighlightClass);\n\t}\n\tif (node.classList.contains(bottomBorderHighlightClass)) {\n\t\tnode.classList.remove(bottomBorderHighlightClass);\n\t}\n}\n\n/**\n * Helper method check if a table row element is a component.\n * Check's the element's lineModel.component property.\n * @param {Element} el - checks whether element is a table row.\n * @public\n */\n\nexport function isComponent(/* 'table row' element*/ el) {\n\tif (!el || !el.lineModel) return;\n\treturn el.lineModel.component;\n}\n\n/**\n * Helper method to determine whether two table rows share a common parent line item.\n * @param {Element} eL1 - first table row element for comparison.\n * @param {Element} eL2 - second table row element for comparison.\n * @public\n */\n\nexport function ifLineElementsShareParent(/* 'table row' element*/eL1, /* 'table row' element*/ eL2) {\n\tif (!eL1.lineModel || !eL2.lineModel) return;\n\treturn eL1.lineModel.lineVO.parentItemKey === eL2.lineModel.lineVO.parentItemKey;\n}\n\n/**\n * Helper method to determine whether the one table row is the parent of the other.\n * @param {Element} eL1 - first table row element for comparison.\n * @param {Element} eL2 - second table row element for comparison.\n * @public\n */\n\nexport function ifLineElementsAreParentChild(/* 'table row' element*/eL1, /* 'table row' element*/ eL2) {\n\tif (!eL1.lineModel || !eL2.lineModel) return;\n\treturn eL1.lineModel.lineVO.key === eL2.lineModel.lineVO.parentItemKey\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {QuoteModel} from 'quotes/models/QuoteModel.js';\nimport {Constants} from 'quotes/models/Constants.js';\nimport {CustomActionModel} from 'quotes/models/CustomActionModel.js';\n\n/**\n * EditorModel class - To create a editorModel which contains the basic informaiton and reference which are used in clients \n *\n */\nexport class EditorModel {\n\tconstructor(data, md, lineEditor) {\n\t\tthis.i18n = AppContext.properties.i18n.value();\n\t\tthis._observers = new Map();\n\n\t\tthis.data = data; // editorModel returned from the server\n\t\tthis.md = md;\n\t\tthis.fieldsetMap = _createFieldsetMap(this.data, this.md);\n\t\tthis.columnMetadata = this.data.columnMetadata;\n\t\tthis.constants = new Constants(data.developerPrefix);\n\t\tthis.deviceContext = lineEditor ? lineEditor.app.deviceContext : {};\n\t\tthis.fieldNameSet = lineEditor ? lineEditor.fieldNameSet : {};\n\t\tthis.fieldSetNames = this.data.fieldSetNames;\n\t\t// Sets the required property of the field md so that the \"--None--\" picklist value won't show up.\n\t\tthis.md.fieldsMap[this.data.quoteLineObjectName][this.constants.SUBSCRIPTION_SCOPE_FIELD].required = true;\n\t\tthis.data.excludedDiscountScheduleIds = Array.isArray(this.data.excludedDiscountScheduleIds)\n\t\t\t? this._convertExcludedDiscountScheduleIdsToObject(this.data.excludedDiscountScheduleIds) // convert if array\n\t\t\t: (this.data.excludedDiscountScheduleIds || {}); // keep or set object\n\n\t\tthis.largeQuoteExperienceEnabled = data.settings.largeQuoteExperienceEnabled && !this.deviceContext.isMobile;\n\t\tthis.summarized = data.quote.summaries && Object.keys(data.quote.summaries).length > 0;\n\t\tthis.createQuoteModel(data.quote);\n\t\tthis.standardPrimaryMobileCols = [];\n\t\tthis.segmentedPrimaryMobileCols = [];\n\t\tthis.segmentedDetailsPrimaryMobileCols = [];\n\n\t\tthis.toggleOptionalShown = _isToggleOptionalShown(this);\n\n\t\tif (lineEditor && lineEditor.editorModel) {\n\t\t\tthis.customActionsByLocation = lineEditor.editorModel.customActionsByLocation;\n\t\t\tthis.customActionsByLocationMobile = lineEditor.editorModel.customActionsByLocationMobile;\n\t\t\tthis.groupMobileMenuButtonAction = lineEditor.editorModel.groupMobileMenuButtonAction;\n\t\t\t// Updates EditorModel property on CustomActionModels that have already been initialized\n\t\t\t_updateCustomActions(this);\n\t\t} else {\n\t\t\t_initCustomActions(data.customActions, this);\n\t\t}\n\t\tthis.quoteCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Quote : this.customActionsByLocation.Quote;\n\t\tthis.lineCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Line : this.customActionsByLocation.Line;\n\t\tthis.styleQuoteAndGroupActionButtons();\n\t\tthis.communityPrefix = this._getCommunityPrefix();\n\t\tthis.scPrefix = AppContext.org.scPrefix;\n\t\tthis.isMultiGroupViewEnabled = data.settings.multiGroupViewEnabled;\n\n\t\tthis._verifyAdditionalDiscountUnitOptions();\n\t}\n\n\t/**\n\t * Getter for Quote line actions on the left\n\t * @returns {boolean}\n\t */\n\tget actionsOnTheLeft() {\n\t\treturn this.data.settings.actionsColumnPlacement === 'Left';\n\t}\n\n\t/**\n\t * To create a new quote model when new QuoteVO is coming from the server\n\t *\n\t * @param quoteVO\n\t */\n\tcreateQuoteModel(quote) {\n\t\tthis.quoteModel = new QuoteModel(quote, this);\n\t}\n\n\tstyleQuoteAndGroupActionButtons() {\n\t\tlet styleActionButtons = (location) => {\n\t\t\tlet first = true;\n\t\t\tlet actions = this.customActionsByLocation[location];\n\t\t\tlet lastCustomAction = actions[0];\n\t\t\tfor (let i = 0, l = actions.length; i < l; i++) {\n\t\t\t\tif (actions[i].isHidden(this.quoteModel)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tactions[i].first = first;\n\t\t\t\tif (actions[i].isSeparator) {\n\t\t\t\t\tfirst = true;\n\t\t\t\t\tlastCustomAction.last = true;\n\t\t\t\t} else {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tlastCustomAction = actions[i];\n\t\t\t\t\tlastCustomAction.last = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastCustomAction) {\n\t\t\t\tlastCustomAction.last = true;\n\t\t\t}\n\t\t}\n\t\tstyleActionButtons('Quote');\n\t\tstyleActionButtons('Group');\n\t}\n\n\t/**\n\t * Use W-3615205 as a reference on why this function was created\n\t * @private\n\t */\n\t_verifyAdditionalDiscountUnitOptions() {\n\t\tif(this.data.additionalDiscountUnitOptions.length === 0) {\n\t\t\tthis.data.additionalDiscountUnitOptions.push({label: '%', value: 'Percent'});\n\t\t}\n\t}\n\n\t_getCommunityPrefix() {\n\t\tlet path = document.location.pathname;\n\t\tlet idx = path.indexOf('/apex');\n\t\tif (idx < 0) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.substring(0, idx);\n\t}\n\n\t/**\n\t * Retrieve metadata object for the given field name\n\t * @param fieldName - name of field we are getting metadata for\n\t * @param quoteRecord - record of the quote\n\t * @return {*}\n\t */\n\tgetFieldMetadata(fieldName, quoteRecord) {\n\t\tlet md = this.md.fieldsMap[this.data.quoteLineObjectName][fieldName];\n\t\tif (quoteRecord && this.data.settings.isMultiCurrencyOrg && md.type === 'currency' && quoteRecord.CurrencyIsoCode) {\n\t\t\tmd = JSON.parse(JSON.stringify(md));\n\t\t\tmd.CurrencyIsoCode = quoteRecord.CurrencyIsoCode;\n\t\t}\n\t\treturn md;\n\t}\n\t\n\t/**\n\t * Find all dependent picklist fields for the given control field\n\t * @param controllerFieldName\n\t */\n\tgetDependentFields(controllerFieldName) {\n\t\tlet fieldMetadata = this.md.fieldsMap[this.data.quoteLineObjectName];\n\t\treturn Object.keys(fieldMetadata).filter((field) => {\n\t\t\treturn fieldMetadata[field].controllerName === controllerFieldName;\n\t\t});\n\t}\n\n\t/**\n\t * @return {boolean} whether drawer field set has any fields\n\t */\n\thasDrawerFields() {\n\t\treturn this.fieldsetMap.standardLineItemDrawerFieldNames.length > 0;\n\t}\n\n\t/**\n\t * @return {boolean} whether product hierarchy view is turned on\n\t */\n\tisProductHierarchyVisualized() {\n\t\treturn this.data.settings.productHierarchyVisualized;\n\t}\n\n\t/**\n\t * @returns {boolean} whether multi-line delete is enabled\n\t */\n\tisMultiLineDeleteEnabled() {\n\t\treturn this.data.settings.multiLineDeleteEnabled;\n\t}\n\n\n\t_convertExcludedDiscountScheduleIdsToObject(excludedDiscountScheduleIds) {\n\t\tif (excludedDiscountScheduleIds) {\n\t\t\treturn excludedDiscountScheduleIds.reduce(function(accumulator, current) {\n\t\t\t\taccumulator[current] = true;\n\t\t\t\treturn accumulator;\n\t\t\t}, {});\n\t\t}\n\t}\n}\n\n/**\n * Recreates fieldsets after applying field level security\n * Relies on the metadata retrieved from describe.js\n * @param data\n * @param md\n * @returns {{}} object of fieldsets mapped by fieldset name\n * @private\n */\nlet _createFieldsetMap = (data, md) => {\n\tlet fieldsetList = _createFieldsetList(data.developerPrefix);\n\tlet fieldsetMap = {};\n\tfieldsetList.forEach( (fieldset) => {\n\t\tif (!data[fieldset.name]) {\n\t\t\tfieldsetMap[fieldset.name] = data[fieldset.name];\n\t\t\treturn;\n\t\t}\n\t\tfieldsetMap[fieldset.name] = [];\n\t\tdata[fieldset.name].forEach( (field) => {\n\t\t\tif (md.fieldsMap[fieldset.table] && md.fieldsMap[fieldset.table][field]) {\n\t\t\t\tfieldsetMap[fieldset.name].push(field);\n\t\t\t};\n\t\t});\n\t});\n\treturn fieldsetMap;\n};\n\nlet _createFieldsetList = (prefix) => {\n\treturn [{ table: prefix + 'QuoteLine__c', name : 'lineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesTablet' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesPhone' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'standardLineItemDrawerFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineSummaryFieldNames' },\n\t\t\t{ table: prefix + 'DiscountTier__c', name : 'discountScheduleModalFieldNames' },\n\t\t\t{ table: prefix + 'Quote__c', name : 'quoteFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLineGroup__c', name : 'groupFieldNames' }];\n};\n\nlet _isToggleOptionalShown = (editorModel) => {\n\tlet containsOptional_Field = (lineFieldNames) => {\n\t\tfor (let i = 0, l = lineFieldNames.length; i < l; i++) {\n\t\t\tif (lineFieldNames[i] === editorModel.constants.OPTIONAL_FIELD)\n\t\t\t\treturn true;\n\t\t}\n\t};\n\treturn containsOptional_Field(editorModel.fieldsetMap.lineFieldNames) || containsOptional_Field(editorModel.fieldsetMap.multiSegmentLineFieldNames) || containsOptional_Field(editorModel.fieldsetMap.standardLineItemDrawerFieldNames);\n};\n\n/**\n * [_initCustomActions description]\n * @param  {[type]} customActions [description]\n * @return {[type]}               [description]\n */\nlet _initCustomActions = (customActions, editorModel) => {\n\teditorModel.defaultCustomActions = [];\n\tlet validLocations = ['Quote', 'Group', 'Line'];\n\tlet customActionsByLocation = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByLocationMobile = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByParentId = {'Quote': {}, 'Group': {}, 'Line':{}};\n\tlet addGroupCustomActionModel;\n\n\tlet addToLocation = (customAction, location) => {\n\t\tif(validLocations.indexOf(location) === -1)\n\t\t\treturn; // not a valid location, so we bail\n\t\t\n\t\tlet customActionModel = new CustomActionModel(editorModel, customAction, customActionsByParentId[location], location);\n\t\tif (!customActionModel.isSeparator) {\n\t\t\tcustomActionsByLocationMobile[location].push(customActionModel);\n\t\t}\n\t\t\n\t\t// Grab all the default Custom Actions\n\t\tif (customActionModel.default) {\n\t\t\teditorModel.defaultCustomActions.push(customActionModel);\n\t\t}\n\n\t\t// Grab the addGroup custom action in case solution groups used. If so, add solution groups as children\n\t\tif (customActionModel.eventHandlerName === 'onAddGroup') {\n\t\t\taddGroupCustomActionModel = customActionModel;\n\t\t}\n\n\t\t// If it has a parent, add it to the parent and not main array.\n\t\tif (customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD]) {\n\t\t\tlet parentId = customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD];\n\t\t\tlet childCustomActions = customActionsByParentId[location][parentId];\n\t\t\tif (childCustomActions) {\n\t\t\t\tchildCustomActions.push(customActionModel);\n\t\t\t} else\n\t\t\t\tcustomActionsByParentId[location][parentId] = [customActionModel];\n\t\t} else {\n\t\t\tcustomActionsByLocation[location].push(customActionModel);\n\t\t}\n\t}\n\t\n\tfor (let i = 0, l = customActions.length; i < l; i++) {\n\t\tlet location = customActions[i][editorModel.constants.LOCATION_FIELD];\n\t\tif (location === 'Quote/Group') {\n\t\t\taddToLocation(customActions[i], 'Quote');\n\t\t\taddToLocation(customActions[i], 'Group');\n\t\t} else if (location && location !== 'Configurator')\n\t\t\taddToLocation(customActions[i], location);\n\t}\n\n\teditorModel.customActionsByLocation = customActionsByLocation;\n\teditorModel.customActionsByLocationMobile = customActionsByLocationMobile;\n\teditorModel.groupMobileMenuButtonAction = new CustomActionModel(editorModel);\n\teditorModel.groupMobileMenuButtonAction.children = customActionsByLocationMobile.Group;\n\n\t// Setup Solution Groups\n\tif (editorModel.data.settings.solutionGroupsEnabled && editorModel.data.solutionGroups.length > 0 && addGroupCustomActionModel) {\n\t\tlet solutionGroups = editorModel.data.solutionGroups;\n\t\tlet addGroupChildren = customActionsByParentId.Quote[addGroupCustomActionModel.record.Id] || [];\n\t\taddGroupCustomActionModel.type = 'Menu';\n\t\tfor (let j = 0, sgL = solutionGroups.length; j < sgL; j++) {\n\t\t\tlet solutionGroupAction = new CustomActionModel(editorModel, solutionGroups[j]);\n\t\t\tsolutionGroupAction.type = 'Solution Group';\n\t\t\tsolutionGroupAction.eventHandlerName = 'onAddGroup';\n\t\t\tsolutionGroupAction.label = solutionGroups[j].Name;\n\t\t\taddGroupChildren.push(solutionGroupAction);\n\t\t}\n\t\taddGroupCustomActionModel.children = addGroupChildren;\n\t}\n\n};\n\nexport function getSubchange(path, target, depth) {\n\tfor (let i = 0; i < depth; i ++) {\n\t\tif (path.length <= 1 || path[1] === 'splices') {\n\t\t\treturn null;\n\t\t}\n\t\ttarget = target[path[0].startsWith('#') ? path[0].substring(1) : path[0]];\n\t\tpath = path.slice(1);\n\t}\n\treturn { path, target };\n}\n\nlet _updateCustomActions = (editorModel) => {\n\tlet loopThroughActionsByLocation = function(map) {\n\t\tfor (let location in map) {\n\t\t\tfor (let customAction of map[location]) {\n\t\t\t\tcustomAction.editorModel = editorModel;\n\t\t\t}\n\t\t}\n\t};\n\tif (editorModel.deviceContext.isMobile) {\n\t\tloopThroughActionsByLocation(editorModel.customActionsByLocationMobile);\n\t\teditorModel.groupMobileMenuButtonAction.editorModel = editorModel;\n\t} else {\n\t\tloopThroughActionsByLocation(editorModel.customActionsByLocation);\n\t}\n};\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {setDiscountValue} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport {getSubchange} from 'quotes/models/EditorModel.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {register, notify, setThenNotify} from 'quotes/models/UiNotifier.js';\nimport {toFieldName} from \"../../common/Util.js\";\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * GroupModel - contains the QuoteLineGroupVO and linked with the quoteModel\n *\n * Feature:\n *      1. Contains QuoteLineGroupVO which is the same as the server\n *      2. Linked with QuoteModel\n *      3. Builds the standardLines array that stores the LineModels\n *      4. Builds the dimensions array that stores the price dimensions to keep the order of dimensions on the page\n *      5. Builds the segmentedLinesByDimension object that stores the segmented LineModels by dimension\n *      6. Builds the segmentedLinesBySegmentKey object that stores the segmented LineModels by segment key\n *      (Segment key is unique to each product)\n */\nexport class GroupModel {\n\tconstructor(groupVO, quoteModel) {\n\t\tthis.groupVO = groupVO;\n\t\tthis.quoteModel = quoteModel;\n\n\t\tthis.standardLines = [];\n\t\tthis.segmentedLines = [];\n\t\tthis.dimensions = [];\n\t\tthis.dimensionsMap = {};\n\t\tthis.segmentedLinesByDimension = {}; //stores lineModels in the order the UI needs (arrays of lineModels per dimension)\n\t\tthis.segmentedLinesBySegmentKey = {}; // stores lineModels by segment key for easy reference\n\t\tthis.segmentedLineKeysBySegmentKey = {}; // stores keys by segment key for easy reference\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t\tthis.groupObjectName = this.constants.QUOTE_LINE_GROUP;\n\t\tthis.summaries = this.quoteModel.grouped ? this.groupVO.summaries : this.quoteModel.quoteVO.summaries;\n\t\tthis.multiSegmentColumnTotals = this.groupVO.multiSegmentColumnTotals ? this.groupVO.multiSegmentColumnTotals : this.quoteModel.quoteVO.multiSegmentColumnTotals;\n\t\tthis.netMultiSegmentTotal = this.groupVO.netMultiSegmentTotal ? this.groupVO.netMultiSegmentTotal : this.quoteModel.quoteVO.netMultiSegmentTotal;\n\t\tthis.hasVisibleStandardLines = false;\n\t\tthis.hasVisibleSegmentedLines = {};\n\t\tthis.standardLineFieldNames = this._setStandardLineFieldNames();\n\t\tthis.groupFieldNames = this._getFieldSetNames();\n\t\tthis._setDrawerFields();\n\n\t\tregister(this, (path) => {\n\t\t\tif (path[0] === \"lineType\"\n\t\t\t\t|| (this.lineType === this.constants.TYPE_STANDARD ? path[0] === \"standardLines\"\n\t\t\t\t\t: (path[0] === \"segmentedLinesByDimension\" && path[1] === this.lineType))) {\n\t\t\t\tnotify(this, [ \"flattenedRows\" ]);\n\t\t\t}\n\t\t});\n\t}\n\n\t// getters\n\tget editorModel() {\n\t\treturn this.quoteModel.editorModel;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\tget lineType() {\n\t\tif (!this._lineType) {\n\t\t\tthis._lineType = this.standardLines.length > 0 || this.dimensions.length === 0 ? 'Standard'\n\t\t\t\t: this.dimensions[0];\n\t\t}\n\t\treturn this._lineType;\n\t}\n\tset lineType(lt) {\n\t\tthis._lineType = lt;\n\t\tnotify(this, ['lineType']);\n\t}\n\n\tget tabs() {\n\t\tconst tabNames = this.dimensions.length === 0 ? [ ]\n\t\t\t: this.standardLines.length > 0 ? [ 'Standard' ].concat(this.dimensions)\n\t\t\t\t: this.dimensions;\n\t\treturn tabNames.map((name) => ({ name, label: this.editorModel.i18n.l(name) }))\n\t}\n\n\tget groupMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE_GROUP];\n\t}\n\n\tget standardLineColumnWidths() {\n\t\treturn this.colWidth.Standard;\n\t}\n\n\tget groupKey() {\n\t\treturn this.groupVO.key;\n\t}\n\n\t/**\n\t * Adds to the appropriate array depending on type (standard vs segmented)\n\t * Will also populate the lineModelsByKey object in QuoteModel\n\t *\n\t * @param lineModel\n\t * @param lineToAdd\n\t */\n\n\tprocessQuoteLines(lineVO) {\n\t\tlet lineModel = new LineModel(lineVO, this);\n\t\tthis.quoteModel.lineModelsByKey[lineModel.lineVO.key] = lineModel;\n\n\t\tif (!lineModel.segmented)\n\t\t\tthis._addStandardLine(lineModel);\n\t\telse\n\t\t\tthis._addSegmentedLine(lineModel);\n\n\t\tif (lineModel.lineVO.parentItemKey && (!lineModel.segmented || (lineModel.segmented && lineModel.segments))) {\n\t\t\tthis.addToLinesByParentItemKey(lineModel);\n\t\t}\n\t}\n\n\t/**\n\t *  Add the lineModel to the Standard Line list\n\t *\n\t * @param lineModel\n\t * @private\n\t */\n\t_addStandardLine(lineModel) {\n\t\tif (lineModel.visible) {\n\t\t\tthis.hasVisibleStandardLines = true;\n\t\t}\n\t\tthis.quoteModel.indexByGroupKey[lineModel.lineVO.parentGroupKey].indexByLineKey[lineModel.lineVO.key] = this.standardLines.length;\n\t\tthis.standardLines.push(lineModel);\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped) {\n\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t\t}\n\t}\n\n\n\t/**\n\t * Each segment of a segmented product is represented as a separate lineVO and eventually lineModel.\n\t * We create a lineModel to represent the summary line item on the segmented products table off of the 1st segment.\n\t * And all segments are added to the segments array of their parent lineModel (summary line item).\n\t *\n\t * Creates a segments array for the lineModel, and either adds the lineModel to the appropriate dimension or\n\t * adds the lineModel to the segments array of its parent summary.\n\t * @param lineModel\n\t * @private\n\t */\n\t_addSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.quoteVO.multiSegmentKeys) ? this.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tif (this.segmentedLinesBySegmentKey[segmentKey]) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = this.segmentedLinesBySegmentKey[segmentKey].segments.length;\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tlineModel.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segments.push(lineModel);\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segmentsByLabel[segmentLabel] = lineModel;\n\t\t} else {\n\t\t\tif (lineModel.visible && !this.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tthis.hasVisibleSegmentedLines[dimension] = true;\n\t\t\t}\n\t\t\tlet firstSegment = new LineModel(lineVO, this);\n\t\t\tthis.setDimensionProperties(dimension);\n\t\t\tlineModel.addToSegmentsArray(firstSegment); // create list of lineModels per segments (in order)\n\t\t\tlineModel.addToSegmentsByLabel(segmentLabel, lineModel); // create map of lineModels by segment label for easy access\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = lineModel.segments.length - 1;\n\t\t\tfirstSegment.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLines.push(lineModel);\n\t\t\tif ( dimension ) {\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = this.segmentedLinesByDimension[dimension].length;\n\t\t\t\tthis.segmentedLinesByDimension[dimension].push(lineModel);\n\t\t\t\tthis.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\t\t\tlineModel.dimensionType = dimension;\n\t\t\t}\n\t\t}\n\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped) {\n\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t\t}\n\t}\n\n\tremoveDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (this.segmentedLinesByDimension[dim] && this.segmentedLinesByDimension[dim].length === 0) {\n\t\t\tdelete this.segmentedLinesByDimension[dim];\n\t\t\tif (this.dimensionsMap[dim]) {\n\t\t\t\tdelete this.dimensionsMap[dim];\n\t\t\t}\n\t\t\tthis.dimensions.splice(this.dimensions.indexOf(dim), 1);\n\t\t}\n\t}\n\n\tsetDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (!this.dimensionsMap[dim]) {\n\t\t\tthis.dimensionsMap[dim] = true;\n\t\t\tthis.dimensions.push(dim);\n\t\t}\n\t\tif (!this.segmentedLinesByDimension[dim]) {\n\t\t\tthis.segmentedLinesByDimension[dim] = [];\n\t\t}\n\t}\n\n\tgetDimensionColWidths(dimension) {\n\t\tlet colWidths = {};\n\t\tfor(let label in this.colWidth[dimension]) {\n\t\t\tcolWidths[toFieldName(label)] = this.colWidth[dimension][label];\n\t\t}\n\t\treturn colWidths;\n\t}\n\n\t/**\n\t * Adds lineModels into linesByParentItemKey map on the quoteModel\n\t * @param lineModel\n\t */\n\taddToLinesByParentItemKey(lineModel) {\n\t\tlet map = this.quoteModel.linesByParentItemKey,\n\t\t\tstdMap = this.quoteModel.standardLinesByParentItemKey,\n\t\t\tmdqMap = this.quoteModel.segmentedLinesByParentItemKey,\n\t\t\tparentItemKey = lineModel.lineVO.parentItemKey;\n\t\tif (parentItemKey) {\n\t\t\tif (!map[parentItemKey]) {\n\t\t\t\tmap[parentItemKey] = [];\n\t\t\t}\n\t\t\tmap[parentItemKey].push(lineModel);\n\t\t\tif (!lineModel.segmented) {\n\t\t\t\tif (!stdMap[parentItemKey]) {\n\t\t\t\t\tstdMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tstdMap[parentItemKey].push(lineModel);\n\t\t\t} else {\n\t\t\t\tif (!mdqMap[parentItemKey]) {\n\t\t\t\t\tmdqMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tmdqMap[parentItemKey].push(lineModel);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a clone of the passed in standard lineModel\n\t * @param line - lineModel\n\t * @returns {lineModel} - cloned lineModel\n\t */\n\tcloneLine(line, parentItemKey, groupSelected) {\n\t\tlet newLineVO = JSON.parse(JSON.stringify(line.lineVO));\n\t\tnewLineVO.record = JSON.parse(JSON.stringify(line.lineVO.record));\n\t\tlet groupModel = groupSelected ? groupSelected : line.groupModel;\n\t\tlet clone = new LineModel(newLineVO, groupModel);\n\t\tclone.lineVO.parentItemKey = parentItemKey ? parentItemKey : null; // Update clone's parentItemKey to create the new bundle-component linkage\n\t\tif (clone.segmented && !line.segmentedLineKey) {\n\t\t\tclone.segments = [];\n\t\t\tclone.segmentsByLabel = {};\n\t\t}\n\n\t\tif (AppContext.isBundleCollapsible(line.editorModel)) {\n\t\t\tclone.bundleCollapsed = line.bundleCollapsed;\n\t\t\tclone.bundleVisible = line.bundleVisible;\n\t\t}\n\t\tclone.lineVO.record.Id = null; // Record Id needs to be removed to avoid upsert duplication error\n\t\tif (clone.lineVO.quoteLinePricingGuidance != null && clone.lineVO.quoteLinePricingGuidance.record) {\n\t\t\tclone.lineVO.quoteLinePricingGuidance.record.Id = null;\n\t\t}\n\n\t\t// Avoid original cloned bundle quote line RequiredBy__c field being referenced after it had been deleted\n\t\tclone.lineVO.record[this.constants.REQUIRED_BY_FIELD] = null;\n\t\t// Add original quote line as the source in the cloned quote line\n\t\t// For clone of clone, original quote line is represented in the source field of the previous clone\n\t\tclone.lineVO.record[this.constants.SOURCE_FIELD] = line.lineVO.record['Id'] || line.lineVO.record[this.constants.SOURCE_FIELD];\n\t\t//For cloning a group the Last modified date field should be null before cloning \n\t\tif (clone.lineVO.record[this.constants.LAST_MODIFIED_DATE_FIELD] != null) {\n\t\t\tclone.lineVO.record[this.constants.LAST_MODIFIED_DATE_FIELD] = null;\n\t\t}\n\t\t// If line is being cloned from amend on contract\n\t\tif (line.editorModel.quoteModel.quoteVO.record[this.constants.TYPE_FIELD] === 'Amendment') {\n\n\t\t\t// Check if Service Cloud org\n\t\t\t// Change appropriate field\n\t\t\tif(AppContext.org.isServiceCloudEnabled) {\n\t\t\t\tlet scPrefix = AppContext.org.scPrefix;\n\t\t\t\tlet scUpgradedContractLineField = `${scPrefix}${this.constants.UPGRADED_CONTRACT_LINE}`;\n\t\t\t\tclone.lineVO.record[scUpgradedContractLineField] = null;\n\t\t\t} \n\t\t\telse {\n\t\t\t\tclone.lineVO.record[this.constants.UPGRADED_SUBSCRIPTION_FIELD] = null;\n\t\t\t}\n\n\t\t\tclone.lineVO.record[this.constants.EXISTING_FIELD] = false;\n\t\t\tclone.lineVO.record[this.constants.RENEWAL_CHECKBOX] = false;\n\t\t\tclone.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.NET_TOTAL_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] = null;\n\t\t}\n\t\tclone.lineVO.key = ++clone.editorModel.quoteModel.quoteVO.nextKey;\n\t\tif (groupSelected) {\n\t\t\tclone.lineVO.parentGroupKey = groupSelected.groupKey;\n\t\t}\n\t\tthis._updateColWidths(line);\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Creates a clone of the passed in segmented lineModel including cloned segments\n\t * @param line - original segmented summary lineModel\n\t * @param parentItemKey - key of the parent lineModel if this lineModel is a component\n\t * @returns {lineModel} - returns cloned summary segmented lineModel with its cloned segment\n\t */\n\tcloneSegmentedLine(line, parentItemKey, groupSelected) {\n\t\tlet clone = this.cloneLine(line, parentItemKey, groupSelected);\n\n\t\t// Replacing segment key as datetime with a random hash string, to prevent overlap of values\n\t\t//  which causes segments and lines to disappear.\n\t\tlet segmentKey = Math.random().toString(36).substr(2, 9);\n        clone.lineVO.record[this.constants.SEGMENT_KEY_FIELD] = segmentKey;\n\t\tlet cloneSegmentKey = clone.lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tlet lineSegmentKey = line.lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tlet multiSegmentRowTotals = this.quoteModel.quoteVO.multiSegmentRowTotals;\n\t\tif (multiSegmentRowTotals) {\n\t\t\tmultiSegmentRowTotals[cloneSegmentKey] = multiSegmentRowTotals[lineSegmentKey]; // There is a bug where multiSegmentedRowTotals aren't reproduced in new groups.\n\t\t}\n\n\t\tthis.segmentedLinesBySegmentKey[cloneSegmentKey] = clone;\n\t\tthis.quoteVO.multiSegmentKeys[cloneSegmentKey] = clone.lineVO.dimensionType;\n\n\t\tfor (let i = 0, l = line.segments.length; i < l; i++) {\n\t\t\tlet clonedSegment = this.cloneLine(line.segments[i], null, groupSelected);\n\t\t\tclonedSegment.lineVO.record[this.constants.SEGMENT_KEY_FIELD] = cloneSegmentKey; // This needs to match its parent summary's segment key\n\t\t\tclonedSegment.lineVO.parentItemKey = clone.lineVO.parentItemKey; // Segments have the same parentItemKeys as its parent summary line, if it's bundled\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tclonedSegment.segmentedLineKey = clone.lineVO.key;\n\t\t\tif (clone.segments) {\n\t\t\t\tclone.segments.push(clonedSegment);\n\t\t\t}\n\t\t\tif (clone.segmentsByLabel) {\n\t\t\t\tlet label = clonedSegment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\t\tclone.segmentsByLabel[label] = clonedSegment;\n\t\t\t}\n\t\t}\n\t\tclone.dimensionType = line.dimensionType;\n\t\tlet dimension = clone.dimensionType;\n\t\tif (!this.segmentedLinesByDimension[dimension])\n\t\t\tthis.setDimensionProperties(dimension);\n\n\t\t// this data is only needed for clone to group, which is only enabled on a group quote\n\t\tif (this.quoteModel.grouped) {\n\t\t\tthis._updateColWidths(line, dimension);\n\t\t\tthis.groupVO.multiSegmentColumns[dimension] = line.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\t\tthis.groupVO.localizedMultiSegmentColumns[dimension] = line.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t}\n\n\t\treturn clone;\n\t}\n\n\t_updateColWidths(line, dimension) {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.colWidth) {\n\t\t\tthis.colWidth = {};\n\t\t}\n\t\t// Update the receiving groups colWidths object to handle MDQ dimensions if a certain dimension does not already exist\n\t\tif (!this.colWidth[dimension]) {\n\t\t\tthis.colWidth[dimension] = line.groupModel.colWidth[dimension];\n\t\t}\n\n\t\t// Update the receiving groups colWidths object to handle layout if Standard object does not already exist\n\t\tif (!this.colWidth.Standard) {\n\t\t\tthis.colWidth.Standard = line.groupModel.colWidth.Standard;\n\t\t}\n\t}\n\n\t_groupHasStandardProducts() {\n\t\tthis.hasVisibleStandardLines = false;\n\t\tfor (let j = 0, l = this.standardLines.length; j < l; j ++) {\n\t\t\tif (this.standardLines[j].visible) {\n\t\t\t\tthis.hasVisibleStandardLines = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this.hasVisibleStandardLines;\n\t}\n\n\t_groupHasSegmentedProducts() {\n\t\tlet dimensions = Object.keys(this.hasVisibleSegmentedLines);\n\t\tlet result = false;\n\t\tfor (let s in this.segmentedLinesByDimension) {\n\t\t\tthis.hasVisibleSegmentedLines[s] = false;\n\t\t\tfor(let k = 0, l = this.segmentedLinesByDimension[s].length; k < l; k ++ ){\n\t\t\t\tif (this.segmentedLinesByDimension[s][k].visible) {\n\t\t\t\t\tthis.hasVisibleSegmentedLines[s] = true;\n\t\t\t\t\tresult = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateStandardSubscriptionScopeEditable(removedLine) {\n\t\tif (this.quoteModel.grouped) {\n\t\t\tfor (let j = 0, l = this.standardLines.length; j < l; j++) {\n\t\t\t\tif (this.standardLines[j].visible && this.standardLines[j].subscriptionScopeEditable && this.standardLines[j] !== removedLine) {    //ignore the removed line\n\t\t\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateSegmentedSubscriptionScopeEditable(removedLine) {\n\t\tif (this.quoteModel.grouped) {\n\t\t\tfor (let j = 0, l = this.segmentedLines.length; j < l; j++) {\n\t\t\t\tif (this.segmentedLines[j].visible && this.segmentedLines[j].subscriptionScopeEditable && this.segmentedLines[j] !== removedLine) {     //ignore the removed line\n\t\t\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t}\n\n\tget serviceModel() {\n\t\treturn {\n\t\t\tkeys: [this.groupKey],\n\t\t\tfavIds: [this.groupVO.record[this.constants.FAVORITE_ID_FIELD]]\n\t\t}\n\t}\n\n\t/**\n\t * Recreates the indexByGroupKey after a front end operation that changes the index of line items\n\t */\n\trenumberStandardIndexes() {\n\t\tfor (let i = 0, l = this.standardLines.length; i < l; i++) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[this.standardLines[i].lineVO.key] = i;\n\t\t}\n\t}\n\n\trenumberSegmentedIndexes() {\n\t\tfor (let j = 0, d = this.dimensions.length; j < d; j++) {\n\t\t\tlet dimension = this.dimensions[j];\n\t\t\tlet lineItems = this.segmentedLinesByDimension[dimension];\n\t\t\tfor (let k = 0; k < lineItems.length; k++) {\n\t\t\t\tvar segmentKey = lineItems[k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = k;\n\t\t\t\tlet segments = lineItems[k].segments;\n\t\t\t\tfor (let m = 0, len = segments.length; m < len; m ++) {\n\t\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[segments[m].lineVO.key] = m;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Specifies whether this group can be deleted\n\t * @returns {boolean} - Whether the group can be deleted\n\t */\n\tcanDelete() {\n\t\tconst canDeleteLines = (lines) => lines.every((line) => !line.existing);\n\t\treturn canDeleteLines(this.standardLines) && canDeleteLines(this.segmentedLines);\n\t}\n\n\tget flattenedRows() {\n\t\tconst rowType = this.lineType === this.constants.TYPE_STANDARD ? this.constants.STANDARD_LINE\n\t\t\t: this.constants.SEGMENTED_LINE;\n\t\tconst lines = rowType === this.constants.STANDARD_LINE ? this.standardLines\n\t\t\t: this.segmentedLinesByDimension[this.lineType];\n\t\treturn [\n\t\t\t{ rowType: this.constants.GROUP_HEADER, model: this },\n\t\t\t...lines.map((model) => ({ rowType, model })),\n\t\t\t{ rowType: this.constants.GROUP_FOOTER, model: this }\n\t\t];\n\t}\n\n\t_setStandardLineFieldNames() {\n\t\tlet fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis.fieldSet = fieldSetHandler.getByViewport(PageContainer.getViewport());\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\treturn this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.standardSubscriptionScopeEditable ? [this.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t_setDrawerFields() {\n\t\tlet drawerFields = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,\n\t\t\tisMobile = this.editorModel.deviceContext.isMobile;\n\n\t\tif (drawerFields && !isMobile) {\n\t\t\tthis.standardLineDrawerFieldNames = drawerFields;\n\t\t} else if (drawerFields && isMobile) {\n\t\t\t// if there are fields in the line item drawer field set and we're in mobile, append the fields to the field set used\n\t\t\tthis.standardLineFieldNames = this.standardLineFieldNames.concat(drawerFields);\n\t\t}\n\t}\n\n\ttoggleOptional(optional) {\n\t\tthis._callChildren((model) => {\n\t\t\tsetThenNotify(model, ['lineVO', 'record', this.constants.OPTIONAL_FIELD], optional)\n\t\t});\n\t}\n\n\tnotifyUi(path) {\n\t\tconst subchange = path[0] === 'segmentedLinesByDimension' ? getSubchange(path, this, 3)\n\t\t\t: path[0] === 'standardLines' ? getSubchange(path, this, 2) : null;\n\t\tif (subchange !== null) {\n\t\t\tnotify(subchange.target, subchange.path);\n\t\t} else {\n\t\t\tnotify(this, path);\n\t\t}\n\t}\n\n\t/**\n\t * Filters out Description and Name field from QuoteLineGroup fieldset\n\t * Used to render all of QuoteLineGroup fields in the QuoteLineGroup fieldset\n\t */\n\t_getFieldSetNames() {\n\t\tlet groupFieldNames = this.editorModel.fieldsetMap.groupFieldNames.slice();\n\t\t// Name and Description fields are handled else where\n\t\tfor (let i = 0, l = groupFieldNames.length; i < l; i++) {\n\t\t\tif (!this.isMobile && (this.constants.DESCRIPTION_FIELD == groupFieldNames[i] ||  'Name' == groupFieldNames[i])) {\n\t\t\t\tgroupFieldNames.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn groupFieldNames;\n\t}\n\n\t/**\n\t * QuoteLineGroup field metadata\n\t * @param fieldName\n\t * @returns {*}\n\t */\n\tgetFieldMD(fieldName) {\n\t\treturn this.groupMD[fieldName];\n\t}\n\n\ttoggleSelected(selected) {\n\t\tthis._callChildren((model) => {\n\t\t\tsetThenNotify(model, ['selected'], selected)\n\t\t});\n\t}\n\n\tresetDiscounts() {\n\t\tthis._callChildren((model) => {\n\t\t\tsetDiscountValue(model, this.constants.ADDITIONAL_DISCOUNT_FIELD, null)\n\t\t});\n\t}\n\n\t_callChildren(callback) {\n\t\tthis.standardLines.forEach(callback);\n\t\tthis.dimensions.forEach((dimension) => {\n\t\t\tthis.segmentedLinesByDimension[dimension].forEach((line) => {\n\t\t\t\tline.segments.forEach(callback);\n\t\t\t});\n\t\t});\n\t}\n\n\tget modelType() {\n\t\treturn 'GroupModel';\n\t}\n\n}\n","/**\n * JSQCNotifier class - Sends out notifyPaths each time a property on QuoteModel, QuoteLineGroupModel, or QuoteLineModel change\n *\n * Used to make polymer components aware of sub-property changes during JSQC calculate\n */\nexport class JSQCNotifier {\n\tconstructor(lineEditorComponent) {\n\t\tthis.lineEditorComponent = lineEditorComponent;\n\t\tthis.editorModel = this.lineEditorComponent.editorModel;\n\t\tthis.indexByGroupKey = this.editorModel.quoteModel.indexByGroupKey;\n\t\tthis.fieldNameSet = this.lineEditorComponent.editorModel.fieldNameSet;\n\t\tthis.propertyNameSet = new Set();\n\t\tthis.propertyNameSet.add('multiSegmentRowTotals');\n\t\tthis.propertyNameSet.add('multiSegmentColumnTotals');\n\t\tthis.propertyNameSet.add('netMultiSegmentTotal');\n\t\tthis.propertyNameSet.add('summaries');\n\t\tthis.propertyNameSet.add('fieldVisibility');\n\t\tthis.propertyNameSet.add('fieldEditability');\n\t\tthis.pathNameSet = new Set(this.fieldNameSet);\n\t\tfor (var elem of this.propertyNameSet) {\n\t\t\tif (!this.pathNameSet.has(elem)) {\n\t\t\t\tthis.pathNameSet.add(elem);\n\t\t\t}\n\t\t}\n\t\tthis.constants = this.editorModel.constants;\n\t\tthis.pathsToNotify = {};\n\t\tthis.originalPathValues = {};\n\t\tthis.pathsToSet = {};\n\n\t\tthis.groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tthis.quoteVO = this.editorModel.quoteModel.quoteVO;\n\t}\n\n\t/**\n\t * notifies the correct path based on which sub-property was changed and what object it came from in the JSQC\n\t *\n\t * @param root\n\t * @param path\n\t * @param value\n\t * @param modelVO\n\t *\n\t */\n\tnotify(root, path, value, modelVO, previous) {\n\t\tlet groupIndex;\n\t\tlet lineIndex;\n\n\t\t// Only notifies paths for fields on the quote, quote line group, or quote line field sets\n\t\t// Currently manually adding fields to set from VO's that are related to rendered fields\n\t\tif (!this.pathNameSet.has(path.split('.').pop())) {\n\t\t\treturn;\n\t\t}\n\t\tif (root == 'QuoteModel') {\n\t\t\t// Notify QuoteVO and record level fields\n\t\t\tthis.notifyPath(`editorModel.quoteModel.quoteVO.${path}`, value, previous, root);\n\t\t\t// Used to update the total column for MDQ products\n\t\t\tif (path == 'multiSegmentRowTotals') {\n\t\t\t\tif (!value)\n\t\t\t\t\treturn;\n\n\t\t\t\tfor (let i = 0, l = this.groupModels.length; i < l; i++) {\n\t\t\t\t\tlet dimensions = this.groupModels[i].dimensions;\n\t\t\t\t\tfor (let j = 0, length = dimensions.length; j < length; j ++) {\n\t\t\t\t\t\tfor (let k = 0, len = this.groupModels[i].segmentedLinesByDimension[dimensions[j]].length; k < len; k++) {\n\t\t\t\t\t\t\tlet segmentKey = this.groupModels[i].segmentedLinesByDimension[dimensions[j]][k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\t\t\t\t// TODO Use localized value for total\n\t\t\t\t\t\t\tthis.notifyPath(`groupModels.${i}.segmentedLinesByDimension.${dimensions[j]}.${k}.total`, value[segmentKey], previous, root);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (modelVO.grouped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet groupIndex = this.indexByGroupKey[this.groupModels[0].groupVO.key].index;\n\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t// Notify GroupVO and record level fields\n\t\t} else if (root == 'QuoteLineGroupModel') {\n\t\t\tif ( this.indexByGroupKey[modelVO.key] != null && this.indexByGroupKey[modelVO.key].index != null ) {\n\t\t\t\tgroupIndex = this.indexByGroupKey[modelVO.key].index;\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.groupVO.${path}`, value, previous, root);\n\t\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t\t}\n\t\t// Notify LineVO and record level fields\n\t\t} else if (root == 'QuoteLineModel') {\n\t\t\tgroupIndex = this.indexByGroupKey[modelVO.parentGroupKey].index;\n\t\t\tlineIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexByLineKey[modelVO.key];\n\t\t\t// Used to update the horizontal MDQ row that displays net total of each segment for a single product\n\t\t\tif (modelVO.record[this.constants.SEGMENT_KEY_FIELD]) {\n\t\t\t\tvar dimensionType = modelVO.parentQuote.multiSegmentKeys[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tlet segmentIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexBySegmentKey[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.segments.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t\tif (path == 'record.' + [this.constants.NET_TOTAL_FIELD]) {\n\t\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.` + modelVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, ''), value, previous, root);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// StandardLines notification\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.standardLines.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Used to update the subtotal row that sums all the net totals at the bottom of MDQ section\n\t * Also updates summary lines\n\t * These paths have to match properties set on the polymer group component to work\n\t * @param element\n\t * @param path\n\t * @param modelVO\n\t * @param value\n\t */\n\tnotifySpecificPath(groupIndex, path, modelVO, value, previous, root) {\n\t\tif (path != 'multiSegmentColumnTotals' && path != 'netMultiSegmentTotal' && path != 'summaries') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (path == 'summaries') {\n\t\t\tthis.set(`groupModels.${groupIndex}.summaries`, value, previous, root);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!value)\n\t\t\treturn;\n\n\t\tvar dimensions = modelVO.localizedMultiSegmentColumns ? Object.keys(modelVO.localizedMultiSegmentColumns) : Object.keys(modelVO.multiSegmentColumnTotals);\n\n\t\t// Updates segmented lines sub totals\n\t\tfor (let i = 0, dimensionsLength = dimensions.length; i < dimensionsLength; i++) {\n\t\t\tlet columns = (path == 'netMultiSegmentTotal') ? modelVO.netMultiSegmentTotal[dimensions[i]] : modelVO.multiSegmentColumnTotals[dimensions[i]];\n\t\t\tif (path == 'netMultiSegmentTotal') {\n\t\t\t\tthis.set(`groupModels.${groupIndex}.netMultiSegmentTotal.${dimensions[i]}`, value[dimensions[i]], previous, root);\n\t\t\t} else {\n\t\t\t\tlet columnKeys = Object.keys(columns);\n\t\t\t\tfor (let j = 0, columnsLength = columnKeys.length; j < columnsLength; j++) {\n\t\t\t\t\tthis.set(`groupModels.${groupIndex}.multiSegmentColumnTotals.${dimensions[i]}.${columnKeys[j]}`, value[dimensions[i]][columnKeys[j]], previous, root);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Collects map of paths and values to notify after calculate is complete\n\t * @param path\n\t * @param value\n\t */\n\tnotifyPath(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToNotify[path] = { value : value, root : root };\n\t}\n\n\tset(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToSet[path] = { value : value, root : root };\n\t}\n\n\tfireEvent(name, detail) {\n\t\tthis.lineEditorComponent.fire(name, detail);\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class LineModel {\n\tconstructor(lineVO, groupModel) {\n\t\t// bail if lineVO is missing\n\t\tif (!lineVO) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lineVO = lineVO;\n\t\tthis.groupModel = groupModel;\n\t\tthis.selected = false;\n\t\tthis.lineItemDrawerIconClass = this._getLineItemDrawerIconClass();\n\t\tthis.expandedIconClass = this._getExpansionClass();\n\t\tthis.visible = this.isVisibleInLineEditor();\n\t\tthis.hasParent = this.hasParentLine();\n\t\tthis.bundleVisible = true; // bundleVisible controls a line's visibility when it's part of a collapsible bundle\n\t\tthis.setItemClassMap();\n\n\t\t// Default pricing method\n\t\tif (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == null) {\n\t\t\tthis.lineVO.record[this.constants.PRICING_METHOD_FIELD] = 'List';\n\t\t}\n\n\t\tthis.cellClasses = { };\n\t}\n\n\tget editorModel() {\n\t\treturn this.quoteModel.editorModel;\n\t}\n\n\tget quoteModel() {\n\t\treturn this.groupModel.quoteModel;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget fieldNames() {\n\t\treturn this.constants;\n\t}\n\n\tget component() {\n\t\treturn (this.lineVO.record[this.constants.OPTION_LEVEL_FIELD] != null);\n\t}\n\n\tget subscription() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] != null);\n\t}\n\n\tget isMDQ() {\n\t\treturn (this.lineVO.record[this.constants.SEGMENT_LABEL_FIELD] != null);\n\t}\n\n\tget dynamicSubscription() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total');\n\t}\n\n\tget isCustomDimension() {\n\t\treturn !!this.lineVO.record[this.constants.SEGMENT_KEY_FIELD] &&\n\t\t\tthis.quoteModel.quoteVO.multiSegmentKeys[this.lineVO.record[this.constants.SEGMENT_KEY_FIELD]] === 'Custom';\n\t}\n\n\tget dynamic() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total' || this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Percent Of Total');\n\t}\n\n\tget isBundle() {\n\t\t// A Quote line is a bundle line only if it has components underneath it in the quote\n\t\t// The bundle field on the quote line is not marked consistently therefore we are also checking whether the line key exists in the lineByParentItemKey map.\n\t\treturn this.bundle && this.quoteModel.linesByParentItemKey[this.lineVO.key];\n\t}\n\n\tget subscriptionScopeEditable() {\n\t\treturn this.dynamic && (this.lineVO.record[this.constants.COMPONENT_SUBSCRIPTION_SCOPE_FIELD] == null) && (this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] == null);\n\t}\n\n\tget rootPackage() {\n\t\treturn (this.bundle || (this.lineVO.productPullIns && (this.lineVO.productPullIns.hasConfiguration || this.lineVO.productPullIns.hasConfigurationAttributes))) && !this.component;\n\t}\n\n\tget legacySupport() {\n\t\treturn (!(this.lineVO.record[this.constants.RENEWAL_CHECKBOX] == true && this.lineVO.record[this.constants.EXISTING_FIELD] != true && this.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD] == null)) || this.editorModel.data.settings.renewalQuotesWithoutAssetsAllowed;\n\t}\n\n\t// Sorry if you need to touch this method, because it's a piece of convoluted crap\n\t// In general, if a line is a component, it should have a quantity, and it should remain not editable (this.component -> true and this.lineVO.record[this.constants.BUNDLED_QUANTITY_FIELD] -> a number)\n\t// this.lineVO.productQuantityEditable is determined by Product.quantityEditable, or ProductOption.QuantityEditable for bundled lines\n\t// this.lineVO.quantityEditable is most likely dead code because nobody is setting it, but a customer may set it directly from their custom plugin (no I am not kidding)\n\t// then there's the legacySupport, you can read the legacySupport method above right?\n\t// good luck\n\tget quantityEditable() {\n\t\treturn ((this.lineVO.record[this.constants.BUNDLED_QUANTITY_FIELD] == null) || !this.component) && this.legacySupport && (this.lineVO.productQuantityEditable) || (this.lineVO.quantityEditable == true);\n\t}\n\n\tget costEditable() {\n\t\treturn (this.lineVO.record[this.constants.COST_EDITABLE_FIELD] == true);\n\t}\n\n\tget unitCostEditable() {\n\t\treturn this.costEditable && !this.bundled && !this.dynamic;\n\t}\n\n\tget pricingMethodList() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'List');\n\t}\n\n\tget pricingMethodCustom() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Custom');\n\t}\n\n\tget pricingMethodCost() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Cost');\n\t}\n\n\tget pricingMethodDisabled() {\n\t\treturn this.dynamicSubscription || this.bundled || !(this.lineVO.record[this.constants.PRICING_METHOD_EDITABLE_FIELD]);\n\t}\n\n\tget bundled() {\n\t\treturn (this.lineVO.record[this.constants.BUNDLED_FIELD] == true);\n\t}\n\n\tget bundle() {\n\t\treturn (this.lineVO.record[this.constants.BUNDLE_FIELD] == true);\n\t}\n\n\tget nonDiscountable() {\n\t\treturn (this.lineVO.record[this.constants.NON_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\tget nonPartnerDiscountable() {\n\t\treturn (this.lineVO.record[this.constants.NON_PARTNER_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\t// W-5475338: Partner discount should be editable for new lines even on amendment quote, but non-editable on existing amendment quote lines\n\tget partnerDiscountEditable() {\n\t\treturn !this.quoteModel.isAmendmentOrChangeQuote || !this.existing;\n\t}\n\n\tget componentDiscountedByPackage() {\n\t\treturn (this.lineVO.record[this.constants.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD] == true);\n\t}\n\n\tget discountable() {\n\t\treturn !this.bundled && !this.nonDiscountable && !this.pricingMethodCustom && !this.componentDiscountedByPackage;\n\t}\n\n\tget discountEditable() {\n\t\treturn !this.quoteModel.isAmendmentOrChangeQuote || !this.existing;\n\t}\n\n\tget removable() {\n\t\treturn !this.component && (!this.quoteModel.isAmendment || (this.quoteModel.isAmendment && !this.existing));\n\t}\n\n\tget configurable() {\n\t\treturn this.rootPackage && !this.lineVO.reconfigurationDisabled && (this.lineVO.configurationType != 'Disabled') && ((this.lineVO.configurationEvent == null) || (this.lineVO.configurationEvent == 'Always') || (this.lineVO.configurationEvent == 'Edit'));\n\t}\n\n\tget listPriceEditable() {\n\t\treturn this.lineVO.record[this.constants.PRICE_EDITABLE_FIELD] && !this.bundled && !this.dynamicSubscription && this.pricingMethodList;\n\t}\n\n\tget segmented() {\n\t\treturn (this.lineVO.record[this.constants.SEGMENT_KEY_FIELD] != null);\n\t}\n\n\tget favorite() {\n\t\treturn (!this.component && (this.lineVO.record[this.constants.FAVORITE_ID_FIELD] != null));\n\t}\n\n\tget existing() {\n\t\treturn this.lineVO.record[this.constants.EXISTING_FIELD];\n\t}\n\n\tget descriptionLocked() {\n\t\treturn this.lineVO.descriptionLocked;\n\t}\n\n\tget hasStandardLineItemDrawer() {\n\t\treturn this._hasStandardLineItemDrawer();\n\t}\n\n\tget asset() {\n\t\treturn (this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] != null);\n\t}\n\n\tget renewal() {\n\t\treturn this.lineVO.record[this.constants.RENEWAL_CHECKBOX];\n\t}\n\n\tget hasSubscribedAssetIds() {\n\t\treturn this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] != null;\n\t}\n\n\tget isAsset() {\n\t\treturn this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] != null;\n\t}\n\n\tget isDeltaQty() {\n\t\treturn !this.existing || this.existing && !this.renewal && (this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] || this.asset);\n\t}\n\n\tget standardLineFieldNames() {\n\t\treturn this.groupModel.standardLineFieldNames;\n\t}\n\n\tget standardLineDrawerFieldNames() {\n\t\treturn this.groupModel.standardLineDrawerFieldNames;\n\t}\n\n\tget standardLineColumnWidths() {\n\t\treturn this.editorModel.layout.colWidths[this.groupModel.groupKey]['Standard'];\n\t}\n\n\tisDiscountScheduleIdExcluded(discountScheduleId) {\n\t\treturn this.editorModel.data.excludedDiscountScheduleIds.hasOwnProperty(discountScheduleId);\n\t}\n\n\tgetFieldMD(fieldName) {\n\t\treturn this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName][fieldName];\n\t}\n\n\tgetField(fieldName) {\n\t\treturn this.lineVO.record[fieldName];\n\t}\n\n\tgetLineVOProperty(fieldName) {\n\t\treturn this.lineVO[fieldName];\n\t}\n\n\t_getExpansionClass() {\n\t\tif (!this.segmented) {\n\t\t\treturn '';\n\t\t}\n\t\treturn this.lineVO.expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t}\n\n\t_hasStandardLineItemDrawer() {\n\t\treturn this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames && this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0\n\t\t\t&& !this.editorModel.deviceContext.isMobile && !this.segmented;\n\t}\n\n\t_getLineItemDrawerIconClass() {\n\t\tif (this.segmented || !this.hasStandardLineItemDrawer) {\n\t\t\treturn '';\n\t\t}\n\t\treturn this.lineVO.expanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright';\n\t}\n\n\tisEditable(fieldName, editability = this.lineVO.fieldEditability) {\n\t\tlet field = this.getFieldMD(fieldName);\n\n\t\tif (!field) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (editability && editability[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn editability[fieldName];\n\t\t}\n\n\t\tif(field.extraTypeInfo === 'richtextarea' && this.editorModel.deviceContext.isMobile) {\n\t\t\treturn false; // Mobile RT Fields should be non editable\n\t\t}\n\n\t\tif (field.name == this.constants.QUANTITY_FIELD || field.name == this.constants.ADDITIONAL_QUANTITY_FIELD) {\n\t\t\treturn field.updateable && this.quantityEditable;\n\t\t} else if (field.name == this.constants.LIST_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.listPriceEditable;\n\t\t} else if (field.name == this.constants.ADDITIONAL_DISCOUNT_FIELD ||\n\t\t\tfield.name == this.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD ||\n\t\t\tfield.name == this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) {\n\t\t\treturn this.discountable && this.discountEditable;\n\t\t} else if (field.name == this.constants.PARTNER_DISCOUNT_FIELD) {\n\t\t\treturn !this.nonPartnerDiscountable && this.partnerDiscountEditable;\n\t\t} else if (field.name == this.constants.DISTRIBUTOR_DISCOUNT_FIELD) {\n\t\t\treturn this.discountEditable;\n\t\t} else if (field.name == this.constants.UPLIFT_FIELD) {\n\t\t\treturn field.updateable && this.lineVO.upliftable;\n\t\t} else if (field.name == this.constants.UNIT_COST_FIELD) {\n\t\t\treturn field.updateable && this.unitCostEditable;\n\t\t} else if (field.name == this.constants.CUSTOMER_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.pricingMethodCustom;\n\t\t} else if (field.name == this.constants.PRICING_METHOD_FIELD) {\n\t\t\treturn field.updateable && !this.pricingMethodDisabled;\n\t\t} else if (field.name == this.constants.MARKUP_FIELD) {\n\t\t\treturn !this.bundled && this.pricingMethodCost && this.discountEditable;\n\t\t} else if (field.name == this.constants.NET_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.PARTNER_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.DESCRIPTION_FIELD) {\n\t\t\treturn !this.descriptionLocked;\n\t\t} else if (field.name == this.constants.PACKAGE_PRODUCT_CODE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.PRORATED_LIST_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.REGULAR_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (this.lineVO.record[this.constants.SUBSCRIPTION_TYPE_FIELD] === 'Evergreen' && (field.name === this.constants.SUBSCRIPTION_TERM_FIELD || field.name === this.constants.END_DATE_FIELD)) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.START_DATE_FIELD || field.name == this.constants.END_DATE_FIELD) {\n\t\t\treturn this.subscription && (!this.isMDQ || this.isCustomDimension); // only editable for non-MDQ or custom dimensional subscription product\n\t\t} else if (field.name === this.constants.SUBSCRIPTION_SCOPE_FIELD) {\n\t\t\treturn field.updateable && this.subscriptionScopeEditable;\n\t\t} else if(field.name == this.constants.PRICING_GUIDANCE_FIELD) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!field && field.updateable;\n\t}\n\n\tisFieldRendered(fieldName, isMobile) {\n\t\tif (this.lineVO.fieldVisibility && this.lineVO.fieldVisibility[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn this.lineVO.fieldVisibility[fieldName];\n\t\t}\n\n\t\tlet field = this.getFieldMD(fieldName);\n\t\tif (field && field.name == this.constants.SUBSCRIPTION_TERM_FIELD) {\n\t\t\treturn this.subscription;\n\t\t} else if (field && field.extraTypeInfo === 'richtextarea') {\n\t\t\treturn !isMobile || (this.lineVO.record[fieldName] && isMobile);\n\t\t}\n\t\treturn true;\n\t}\n\n\tget serviceModel() {\n\t\tlet keys = [];\n\t\t// Only MDQ Summary Lines have a segments array. Standard Lines' segments property is undefined\n\t\tif (this.segments) {\n\t\t\tfor (let i = 0, segmentsLength = this.segments.length; i < segmentsLength; i++)\n\t\t\t\tkeys.push(this.segments[i].lineVO.key);\n\t\t} else \n\t\t\tkeys.push(this.lineVO.key)\n\t\t\t\n\t\treturn {\n\t\t\tkeys: keys,\n\t\t\tsegmentKey: this.getField(this.constants.SEGMENT_KEY_FIELD),\n\t\t\tsegmented: this.segmented,\n\t\t\tupdateCustomSegments: false,\n\t\t\tfavIds: [this.getField(this.constants.FAVORITE_ID_FIELD)],\n\t\t\tscheduleId: this.getField(this.constants.DISCOUNT_SCHEDULE_FIELD)\n\n\t\t};\n\t}\n\n\tisVisibleInLineEditor() {\n\t\tlet visible = (this.lineVO.componentVisibility == null) || (this.lineVO.componentVisibility == '') || (this.lineVO.componentVisibility == 'Always') || (this.lineVO.componentVisibility == 'Editor Only');\n\t\tif (visible && this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] != null && this.quoteModel.isRenewal && this.editorModel.data.settings.renewedAssetsHiddenWhenEditing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn visible;\n\t}\n\n\thasParentLine() {\n\t\treturn this.lineVO.parentItemKey !== null;\n\t}\n\n\taddToSegmentsArray (lineModel) {\n\t\tif (!this.segments) {\n\t\t\tthis.segments = []; // list of lineModels per segments (in order)\n\t\t}\n\t\tthis.segments.push(lineModel);\n\t}\n\n\tremoveFromSegmentsArray (lineModel) {\n\t\tthis.segments.splice(this.segments.indexOf(lineModel), 1);\n\t\tif (this.segments.length === 0) {\n\t\t\tdelete this.segments;\n\t\t}\n\t}\n\n\taddToSegmentsByLabel (segmentLabel, lineModel) {\n\t\tif (!this.segmentsByLabel) {\n\t\t\tthis.segmentsByLabel = {}; // map of lineModels by segment label for easy access\n\t\t}\n\t\tthis.segmentsByLabel[segmentLabel] = lineModel;\n\t}\n\n\tremoveFromSegmentsByLabel (segmentLabel) {\n\t\tif (this.segmentsByLabel[segmentLabel]) {\n\t\t\tdelete this.segmentsByLabel[segmentLabel];\n\t\t}\n\t\tif (Object.keys(this.segmentsByLabel).length == 0) {\n\t\t\tdelete this.segmentsByLabel;\n\t\t}\n\t}\n\n\tsetLineTypeClass() {\n\t\tif(this.bundle) {\n\t\t\treturn 'parent-line';\n\t\t} else if(this.component) {\n\t\t\treturn 'component';\n\t\t} else {\n\t\t\treturn 'standalone';\n\t\t}\n\t}\n\n\tsetItemClassMap() {\n\t\tlet isMobile = this.editorModel.deviceContext.isMobile,\n\t\t\titemClassMap = {};\n\n\t\tfor (let field in this.lineVO.record) {\n\t\t\tif (!this.isFieldRendered(field, isMobile)) {\n\t\t\t\titemClassMap[field] = isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t}\n\n\t\t\tif(this.segmented) {\n\t\t\t\t// Use mdqSummaryRow as the indicator to prevent editing summary MDQ fields in LETableCell\n\t\t\t\tif (itemClassMap[field]) {\n\t\t\t\t\titemClassMap[field] += ' mdqSummaryRow';\n\t\t\t\t} else {\n\t\t\t\t\titemClassMap[field] = 'mdqSummaryRow';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titemClassMap['total'] = 'hiddenInMobile';\n\t\t}\n\n\t\t// Iterate over Line Drawer fields\n\t\t// If a field has a null value it will not be in the record and thus not be evaluated against the PSP\n\t\tlet drawerFields = this.standardLineDrawerFieldNames || [];\n\t\tfor (let x = 0; x < drawerFields.length; x++) {\n\t\t\tlet drawerField = drawerFields[x];\n\t\t\tif (!this.lineVO.record[drawerField]) {\n\t\t\t\tif (!this.isFieldRendered(drawerField, isMobile)) {\n\t\t\t\t\titemClassMap[drawerField]  = isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.itemClassMap = itemClassMap;\n\t}\n\n\t/**\n\t * @return {string} Path to record, e.g., lineModel.lineVO.record\n\t */\n\tstatic get recordPath() {\n\t\treturn 'lineModel.lineVO.record';\n\t}\n\n\tget modelType() {\n\t\treturn 'LineModel';\n\t}\n}\n","import {LineModel} from 'quotes/models/LineModel.js';\n\n/**\n * Created by jfeingold on 9/30/16.\n */\nexport class MDQSegmentHelper {\n\tconstructor(editorModel, groupModelsByKey) {\n\t\tthis.MONTHLY_DIM = 'Month';\n\t\tthis.YEARLY_DIM = 'Year';\n\t\tthis.QUARTERLY_DIM = 'Quarter';\n\t\tthis.editorModel = editorModel;\n\t\tthis.groupModelsByKey = groupModelsByKey;\n\t\tthis.prefix = editorModel.developerPrefix;\n\t\tthis.START_DATE_FIELD = this.prefix + 'StartDate__c';\n\t\tthis.END_DATE_FIELD = this.prefix + 'EndDate__c';\n\t\tthis.SUBSCRIPTION_TERM_FIELD = this.prefix + 'SubscriptionTerm__c';\n\t\tthis.LINES_GROUPED_FIELD = this.prefix + 'LineItemsGrouped__c';\n\t\tthis.SEGMENT_KEY_FIELD = this.prefix + 'SegmentKey__c';\n\t\tthis.SEGMENT_INDEX_FIELD = this.prefix + 'SegmentIndex__c';\n\t\tthis.SEGMENT_LABEL_FIELD = this.prefix + 'SegmentLabel__c';\n\t\tthis.FIRST_SEGMENT_END_DATE_FIELD = this.prefix + 'FirstSegmentTermEndDate__c';\n\t\tthis.TYPE_FIELD = this.prefix + 'Type__c';\n\t\tthis.EXISTING_FIELD = this.prefix + 'Existing__c';\n\n\t\tthis._segmentsChanged = false;\n\t}\n\n\tupdateSegments() {\n\t\tvar quote = this.editorModel.quote;\n\t\tif (this._hasMultiSegmentLines(quote)) {\n\t\t\tif (quote.grouped || quote.record[this.LINES_GROUPED_FIELD]) {\n\t\t\t\tquote.lineItemGroups.forEach(function(group) {\n\t\t\t\t\tthis._adjustSegments(quote, group);\n\t\t\t\t}, this);\n\t\t\t} else {\n\t\t\t\tthis._adjustSegments(quote, null);\n\t\t\t}\n\t\t}\n\t\treturn this._segmentsChanged;\n\t}\n\n\t_hasMultiSegmentLines(obj) {\n\t\tvar lineCount = obj.lineItems.length;\n\t\tfor (var i = 0; i < lineCount; i++) {\n\t\t\tif (obj.lineItems[i].record[this.SEGMENT_KEY_FIELD] != null) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_adjustSegments(quote, group) {\n\t\tvar term = this._calculateSubscriptionTerm(quote, group);\n\t\tvar lines = group ? quote.lineItems.filter((line) => line.parentGroupKey === group.key) : quote.lineItems;\n\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.YEARLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.MONTHLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.QUARTERLY_DIM);\n\t}\n\n\t_calculateSubscriptionTerm(quote, group) {\n\t\tvar startDateFieldValue = group\n\t\t\t? group.record[this.START_DATE_FIELD] || quote.record[this.START_DATE_FIELD]\n\t\t\t: quote.record[this.START_DATE_FIELD];\n\t\tvar endDateFieldValue = group\n\t\t\t? group.record[this.END_DATE_FIELD] || quote.record[this.END_DATE_FIELD]\n\t\t\t: quote.record[this.END_DATE_FIELD];\n\t\tvar subscriptionTermValue = (group && (group.record[this.SUBSCRIPTION_TERM_FIELD] != null))\n\t\t\t? group.record[this.SUBSCRIPTION_TERM_FIELD]\n\t\t\t: quote.record[this.SUBSCRIPTION_TERM_FIELD];\n\n\t\tvar startDate = startDateFieldValue ? new Date(startDateFieldValue) : null;\n\t\tvar endDate = endDateFieldValue ? new Date(endDateFieldValue) : null;\n\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\n\t\tif (firstSegEndDate) {\n\t\t\tstartDate = startDate ? startDate : new Date();\n\t\t\tif (!endDate) {\n\t\t\t\tendDate = new Date(startDate.getTime());\n\t\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() + subscriptionTermValue - 1);\n\t\t\t\t} else {\n\t\t\t\t\tSB.addMonths(endDate, subscriptionTermValue);\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(firstSegPlusOneDay, endDate);\n\t\t\t} else {\n\t\t\t\treturn SB.monthsBetweenRoundPartialUp(firstSegPlusOneDay, endDate);\n\t\t\t}\n\t\t} else if (startDate && endDate) {\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(startDate, endDate);\n\t\t\t} else {\n\t\t\t\treturn SB.monthsBetweenRoundPartialUp(startDate, endDate);\n\t\t\t}\n\t\t} else {\n\t\t\treturn subscriptionTermValue;\n\t\t}\n\t}\n\n\t_calculateSegmentDeltasAndModifySegments(quote, group, lines, term, dimType) {\n\t\tvar segmentDeltasBySegmentKey = this._calculateSegmentDeltas(quote, lines, term, dimType);\n\t\tif (segmentDeltasBySegmentKey.size != 0) {\n\t\t\tthis._modifySegmentsBasedOnDelta(quote, group, segmentDeltasBySegmentKey, dimType);\n\t\t}\n\t}\n\n\t_calculateSegmentDeltas(quote, lines, term, dimType) {\n\t\tvar termIsDay = this.editorModel.settings.subscriptionTermUnitIsDay;\n\n\t\t// Term might be null if there wasn't enough information to calculate it. In that case, default to 1 year.\n\t\tterm = (term == null) ? (termIsDay ? 365 : 12) : term;\n\n\t\t// Map all segment keys to the number of time-based segments with that key.\n\t\tvar segmentCountsBySegmentKey = mapSegmentCountsBySegmentKeys.bind(this)();\n\t\tvar trueSegmentCount = determineDesiredNumberOfSegments.bind(this)();\n\t\tvar segmentDeltasBySegmentKey = new Map();\n\t\tsegmentCountsBySegmentKey.forEach(function(currentSegCount, segKey) {\n\t\t\tsegmentDeltasBySegmentKey.set(segKey, trueSegmentCount - currentSegCount);\n\t\t});\n\t\treturn segmentDeltasBySegmentKey;\n\n\n\t\tfunction mapSegmentCountsBySegmentKeys() {\n\t\t\tvar segmentCountsBySegmentKey = new Map();\n\t\t\tvar lineCount = lines.length;\n\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\tlet line = lines[i];\n\t\t\t\tif (line.dimensionType == dimType) {\n\t\t\t\t\tlet lineSegKey = line.record[this.SEGMENT_KEY_FIELD];\n\t\t\t\t\tlet currentSegCount = segmentCountsBySegmentKey.get(lineSegKey) || 0;\n\t\t\t\t\tsegmentCountsBySegmentKey.set(lineSegKey, currentSegCount + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn segmentCountsBySegmentKey;\n\t\t}\n\n\t\tfunction determineDesiredNumberOfSegments() {\n\t\t\t// Calculate the number of segments represented by the given term and dimension type.\n\t\t\tvar trueSegmentCount = 0;\n\t\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\t\t\t// If the first segment has a specified end date, we must take that into account as we calculate the\n\t\t\t// number of segments\n\t\t\tif (firstSegEndDate) {\n\t\t\t\t// We immediately include the first term in our count.\n\t\t\t\ttrueSegmentCount = 1;\n\n\t\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\t}\n\n\t\t\t// Convert term expressed as days into months if termIsDay to ensure the number of segments is correct.\n\t\t\tif (termIsDay) {\n\t\t\t\tlet termStartDate = firstSegPlusOneDay ? firstSegPlusOneDay : new Date(this.editorModel.quote.record[this.START_DATE_FIELD]);\n\t\t\t\tlet quoteEndDate = this.editorModel.quote.record[this.END_DATE_FIELD] ? new Date(this.editorModel.quote.record[this.END_DATE_FIELD]) : new Date(termStartDate.setUTCDate(termStartDate.getUTCDate() + term));\n\t\t\t\tterm = SB.monthsBetween(termStartDate, quoteEndDate);\n\t\t\t\ttermStartDate.setUTCMonth(termStartDate.getUTCMonth() + term);\n\t\t\t\ttermStartDate.setUTCDate(termStartDate.getUTCDate() - 1);\n\t\t\t\t// If the date in the month of the termStartDate is less than the end date of the quote we need to add one more month to the term,\n\t\t\t\t// this ensures that the number of segments will be calculated correctly.\n\t\t\t\tif (termStartDate < quoteEndDate) {\n\t\t\t\t\tterm += 1\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Now we calculate the number of segments based on our dimension type and the term.\n\t\t\tswitch (dimType) {\n\t\t\t\tcase this.YEARLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 12);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.QUARTERLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 3);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.MONTHLY_DIM:\n\t\t\t\t\ttrueSegmentCount += term;\n\t\t\t}\n\t\t\treturn trueSegmentCount;\n\t\t}\n\t}\n\n\t_modifySegmentsBasedOnDelta(quote, group, deltaMap, dimType) {\n\t\tdeltaMap.forEach(function(delta, segmentKey) {\n\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\n\t\t\tvar noDelta = delta === 0;\n\t\t\tvar amendmentLine = quote.record[this.TYPE_FIELD] === 'Amendment' && lastSegment.record[this.EXISTING_FIELD];\n\n\t\t\tvar lastSegStartDateFieldValue = lastSegment.record[this.START_DATE_FIELD];\n\t\t\tvar lastSegEndDateFieldValue = lastSegment.record[this.END_DATE_FIELD];\n\n\t\t\tvar lastSegStartDate = lastSegStartDateFieldValue ? new Date(lastSegStartDateFieldValue) : null;\n\t\t\tvar lastSegEndDate = lastSegEndDateFieldValue ? new Date(lastSegEndDateFieldValue) : null;\n\t\t\tvar startDateBeforeEndDate = lastSegEndDate >= lastSegStartDate;\n\t\t\tif (noDelta || amendmentLine) {\n\t\t\t\t// If we're amending an old line, or the delta is 0, do nothing\n\t\t\t\treturn;\n\t\t\t} else if (delta > 0 && startDateBeforeEndDate) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\tfor (let i = 1; i <= delta; i++) {\n\t\t\t\t\t// We need to add additional segments, which we do by repeatedly cloning the last segment\n\t\t\t\t\tvar newSegmentVO = this._createNewSegment(quote, lastSegment, i);\n\t\t\t\t\tquote.lineItems.push(newSegmentVO);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Add line to group model, so that the models can have a handle on the new segment and reflect it in the UI\n\t\t\t\t\t\tthis.groupModelsByKey[newSegmentVO.parentGroupKey].processQuoteLines(newSegmentVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (delta < 0) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\t// If the delta is negative, we need to remove that many segments\n\t\t\t\tfor (let i = 0; i > delta; i--) {\n\t\t\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\t\t\t\t\tthis._removeSegment(quote, lastSegment);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Remove deleted line from segments array on the given group model\n\t\t\t\t\t\tlet line = this.groupModelsByKey[lastSegment.parentGroupKey].segmentedLinesBySegmentKey[segmentKey];\n\t\t\t\t\t\tline.segments.splice(line.segments.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t}\n\n\t_getLastSegmentFromQuote(quote, segmentKey, dimType) {\n\t\tvar lineItem = null;\n\t\tvar maxIndex = null;\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tif (line.record[this.SEGMENT_KEY_FIELD] === segmentKey && line.dimensionType === dimType) {\n\t\t\t\tlet index = line.record[this.SEGMENT_INDEX_FIELD];\n\t\t\t\tif ((index != null) && ((maxIndex == null) || (maxIndex < index))) {\n\t\t\t\t\t// If the segment index is higher than the highest we've seen so far, store this line\n\t\t\t\t\tmaxIndex = index;\n\t\t\t\t\tlineItem = line;\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t\treturn lineItem;\n\t}\n\n\t_createNewSegment(quote, sourceSegment, offset) {\n\t\tvar clone = JSON.parse(JSON.stringify(sourceSegment));\n\t\t// We need to update the clone's key, and delete its ID\n\t\tclone.key = ++quote.nextKey;\n\t\tclone.record.Id = null;\n\t\t// We also need to offset the segment indices\n\t\tclone.record[this.SEGMENT_KEY_FIELD] = sourceSegment.record[this.SEGMENT_KEY_FIELD];\n\t\tclone.record[this.SEGMENT_INDEX_FIELD] = sourceSegment.record[this.SEGMENT_INDEX_FIELD] + offset;\n\t\tvar whitespace = (clone.record[this.SEGMENT_INDEX_FIELD] < 10) ? '  ' : ' ';\n\t\tclone.record[this.SEGMENT_LABEL_FIELD] = sourceSegment.dimensionType + whitespace + clone.record[this.SEGMENT_INDEX_FIELD];\n\t\treturn clone;\n\t}\n\n\t_removeSegment(quote, segmentToRemove) {\n\t\tvar lineCount = quote.lineItems.length;\n\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\tvar line = quote.lineItems[i];\n\t\t\tif (line.key === segmentToRemove.key) {\n\t\t\t\tquote.lineItems = quote.lineItems.slice(0, i).concat(quote.lineItems.slice(i + 1, lineCount));\n\t\t\t\tif (quote.deletedLineIds && line.record && line.record.Id) {\n\t\t\t\t\tquote.deletedLineIds.push(line.record.Id);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n}","export class QuoteMessenger {\n\n\tconstructor(editorModel, targetRecord) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.targetRecord = targetRecord;\n\t}\n\n\tgetRequest() {\n\t\tlet message = {\n\t\t\ttarget: this.targetRecord,\n\t\t\tquote: this.editorModel.quoteModel.quoteVO.record,\n\t\t\tlines: [],\n\t\t\tactions: []\n\t\t};\n\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif (!message)\n\t\t\treturn;\n\n\t\tswitch (message.actions[0].toLowerCase().replace(' ', '')) {\n\t\t\tcase 'save':\n\t\t\t\treturn {lines: message.lines, action: 'save'};\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\treturn {lines: message.lines, action: 'quicksave'};\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\treturn {lines: message.lines, action: 'reload'};\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t\t\treturn {lines: message.lines, action: 'none'};\n\t\t}\n\t}\n\n}","import {getSubchange} from 'quotes/models/EditorModel.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {register, notify} from 'quotes/models/UiNotifier.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { get as readFromCache, put as updateCache } from 'quotes/models/ClientCache.js';\n\nlet quoteTypes = {RENEWAL: 'Renewal', AMENDMENT: 'Amendment', CHANGE_ORDER: 'Re-Quote'};\n\n/**\n *  QuoteModel - contains the quoteVO and linked with the editorModel\n *\n * Feature:\n *      1. Contains QuoteVO which is the same as the server\n *      2. Linked with EditorModel\n *      3. Rebuild the groupsByKey to link GroupVO and QuoteVO together\n */\nexport class QuoteModel {\n\tconstructor(quoteVO, editorModel) {\n\t\tthis.quoteVO = quoteVO; // quote returned from the server\n\t\tthis.editorModel = editorModel;\n\n\t\tthis.grouped = quoteVO.record[this.constants.GROUP_LINE_ITEMS_FIELD];\n\n\t\tthis.groupsByKey = {};\n\t\tthis.lineModelsByKey = {};\n\t\tthis.indexByGroupKey = {};\n\t\tthis.lineGroups = [];\n\t\t// stores lineModels by parentItemKey (parenItemKey: [array of components])\n\t\t// this map is on the quoteModel instead of each group because users can drag components to other groups when Keep Bundle Together setting is off\n\t\tthis.linesByParentItemKey = {};\n\t\tthis.standardLinesByParentItemKey = {};\n\t\tthis.segmentedLinesByParentItemKey = {};\n\n\t\t// stores selected lines by key used in clone to group\n\t\tthis.selectedLinesByKey = {};\n\n\t\tthis.allOptional = true;\n\t\tthis.isPrimary = this.quoteVO.record[this.constants.PRIMARY_FIELD];\n\t\tthis.isRenewal = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.RENEWAL;\n\t\tthis.isAmendment = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.AMENDMENT;\n\t\tthis.isChangeQuote = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.CHANGE_ORDER;\n\t\tthis.isAmendmentOrChangeQuote = this.isAmendment || this.isChangeQuote;\n\t\tthis.hasConsumptionSchedules = this.quoteVO.hasConsumptionSchedules;\n\n\t\t// If Group Line Items is true but there are no Groups in the Model, create an empty one and add all lines to it\n\t\tif (this.grouped && this.quoteVO.lineItemGroups.length == 0) {\n\t\t\tlet groupRecord = {Name: `Group${1}`};\n\t\t\tgroupRecord[this.constants.prefix + 'Number__c'] = 1;\n\t\t\tlet groupVO = {key: ++this.quoteVO.nextKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\t\tlet group = new GroupModel(groupVO, this);\n\t\t\tthis.quoteVO.lineItemGroups.push(groupVO);\n\t\t\tthis.groupsByKey[group.groupVO.key] = group;\n\t\t\tthis.indexByGroupKey[group.groupVO.key] = {index: Object.keys(this.indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t\tlet lineVOs = this.quoteVO.lineItems;\n\t\t\tfor (let i = 0; i < lineVOs.length; i++) {\n\t\t\t\tlet lineVO = lineVOs[i];\n\t\t\t\tlineVO.parentGroupKey = group.groupVO.key;\n\t\t\t}\n\t\t}\n\t\t// form the Group Models looping through the GroupVOs on the QuoteVO\n\t\tlet groups = this.grouped ? this.quoteVO.lineItemGroups : [{key: null, record: {}}];\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tlet groupModel = new GroupModel(groups[i], this);\n\t\t\tthis.lineGroups.push(groupModel);\n\t\t\tthis.groupsByKey[groupModel.groupVO.key] = groupModel;\n\t\t\tthis.indexByGroupKey[groupModel.groupVO.key] = {index: i, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t\tthis.quoteVO.nextGroupKey = groupModel.groupVO.key + 1;\n\t\t}\n\n\t\t// form the Line Models and push each model into its Group Model's lines array depending on type (standard vs segmented)\n\t\tfor (let line of this.quoteVO.lineItems) {\n\t\t\tif (!line.record[this.constants.OPTIONAL_FIELD])\n\t\t\t\tthis.allOptional = false;\n\t\t\tthis.groupsByKey[line.parentGroupKey].processQuoteLines(line);\n\t\t}\n\n\t\t// now that lines are built and hierarchy established,\n\t\t// update bundle's expansion states and visibility\n\t\tif (AppContext.isBundleCollapsible(this.editorModel)) {\n\t\t\tthis._setBundleExpansionStates();\n\t\t}\n\n\t\tlet shouldNotify = true;\n\t\tlet observer = () => {\n\t\t\tif (shouldNotify) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tnotify(this, [ 'flattenedRows' ]);\n\t\t\t\t\tshouldNotify = true;\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tshouldNotify = false;\n\t\t};\n\t\tregister(this, (path) => {\n\t\t\tif (path[0] === 'lineGroups') {\n\t\t\t\tobserver();\n\t\t\t}\n\t\t});\n\t\tthis.lineGroups.forEach((group) => {\n\t\t\tregister(group, (path) => {\n\t\t\t\tif (path[0] === 'flattenedRows') {\n\t\t\t\t\tobserver();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget quoteMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.editorModel.data.quoteObjectName];\n\t}\n\n\tgetFieldMD(fieldName) {\n\t\treturn this.quoteMD[fieldName];\n\t}\n\n\trenumberIndexes(/*Boolean*/ deepRenumber) {\n\t\t// if deepRenumber is true, it will renumber all of the line items as well\n\t\tfor (let i = 0, l = this.lineGroups.length; i < l; i ++) {\n\t\t\tlet groupKey = this.lineGroups[i].groupKey;\n\t\t\tthis.indexByGroupKey[groupKey].index = i;\n\t\t\tif (deepRenumber) {\n\t\t\t\tthis.lineGroups[i].renumberStandardIndexes();\n\t\t\t\tthis.lineGroups[i].renumberSegmentedIndexes();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Used to renumber all lines in a quote - performed after operations such as delete/clone lines\n\trenumber() {\n\t\tlet idx = 1,\n\t\t\tinvisibleIdx = 3000;\n\t\tfor (let i = 0, numOfGroups = this.lineGroups.length; i < numOfGroups; i++) { // loop through each group model\n\t\t\tlet groupModel = this.lineGroups[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) { //loop through each dimension for the current group\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) { // loop through all the segmented summary lines for the current dimension\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tif (segmentedLines[k].visible) {\n\t\t\t\t\t\tthis.lineGroups[i].segmentedLinesByDimension[dim][k].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tidx++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsegmentedLines[k].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop through standard lines\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++) {\n\t\t\t\tlet line = groupModel.standardLines[n];\n\t\t\t\tif (line.visible) {\n\t\t\t\t\tthis.lineGroups[i].standardLines[n].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\tidx++;\n\t\t\t\t} else {\n\t\t\t\t\tgroupModel.standardLines[n].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(optional, groupKey) {\n\t\tthis._callChildren(groupKey, (model) => {\n\t\t\tmodel.toggleOptional(optional);\n\t\t});\n\t}\n\n\tresetDiscounts(groupKey) {\n\t\tthis._callChildren(groupKey, (model) => {\n\t\t\tmodel.resetDiscounts();\n\t\t});\n\t}\n\n\t_callChildren(groupKey, callback) {\n\t\tif (groupKey) {\n\t\t\tcallback(this.groupsByKey[groupKey]);\n\t\t} else {\n\t\t\tthis.lineGroups.forEach(callback);\n\t\t}\n\t}\n\n\tget flattenedRows() {\n\t\treturn [].concat(...this.lineGroups.map((model) => model.flattenedRows));\n\t}\n\n\tnotifyUi(path) {\n\t\tconst subchange = path[0] === 'lineGroups' ? getSubchange(path, this, 2) : null;\n\t\tif (subchange !== null) {\n\t\t\tsubchange.target.notifyUi(subchange.path);\n\t\t} else {\n\t\t\tnotify(this, path);\n\t\t}\n\t}\n\n\tsetHiddenFromPSPClass() {\n\t\tlet itemClassMap = {};\n\t\tfor (let field in this.quoteVO.fieldVisibility) {\n\t\t\tif (this.isFieldVisible(field) == false) {\n\t\t\t\titemClassMap[field] = 'hiddenFromPSP';\n\t\t\t}\n\t\t}\n\t\treturn itemClassMap;\n\t}\n\n\tisFieldVisible(fieldName) {\n\t\tif (this.quoteVO.fieldVisibility && this.quoteVO.fieldVisibility[fieldName] != null) {\n\t\t\treturn this.quoteVO.fieldVisibility[fieldName];\n\t\t}\n\t}\n\n\t_setBundleExpansionStates() {\n\t\t// first update bundle collapsed for each line\n\t\t// consider cached state first if it's available, otherwise fall back to default\n\t\tObject.keys(this.lineModelsByKey).forEach((key) => {\n\t\t\tlet line = this.lineModelsByKey[key];\n\t\t\tif (line.isBundle) {\n\t\t\t\tconst key = 'l' + line.lineVO.key;\n\t\t\t\tlet cachedValue = readFromCache('BundleCollapsed', [key]);\n\t\t\t\tline.bundleCollapsed = cachedValue != null ? cachedValue : AppContext.defaultBundleSetting === 'Collapsed';\n\t\t\t\tupdateCache('BundleCollapsed', [key], line.bundleCollapsed);\n\t\t\t\tif (line.bundleCollapsed && line.bundleVisible) {\n\t\t\t\t\t// make children lines invisible if this line is collapsed\n\t\t\t\t\tthis._hideTree(line);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t_hideTree(parentLine) {\n\t\tlet children = parentLine.isBundle;\n\t\tif (children) {\n\t\t\tchildren.forEach((line) => {\n\t\t\t\tline.bundleVisible = false;\n\t\t\t\tif (this.linesByParentItemKey[line.lineVO.key]) {\n\t\t\t\t\tthis._hideTree(line);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tget modelType() {\n\t\treturn 'QuoteModel';\n\t}\n}\n","import {localizeContent} from 'common/core/AppContext.js';\nimport {mergeRec} from 'common/Util.js';\nimport * as ClientCache from 'quotes/models/ClientCache.js';\nimport {TYPES} from 'quotes/models/ClientModels.js';\n\n/**\n * Safely places a value into a given cache field.\n *\n * @param {string} fieldType - The field type metadata name.\n * @param {string} fieldName - The field name within the field type metadata.\n * @param value - The value to store in the client cache slot.\n */\nexport function put(fieldType, fieldName, value) {\n\tconst fieldTypeMD = _getFieldTypeMD(TYPES, fieldType);\n\tconst fieldMD = _getFieldMD(fieldTypeMD, fieldName);\n\n\t// -- VALIDATIONS --\n\t_typeCheck(fieldMD, value);\n\t_requiredCheck(fieldMD, value);\n\n\t// -- LOCALIZATION --\n\tlet actualVal = fieldMD.localizable ? localizeContent(value) : value \n\n\tClientCache.put(fieldType, [ fieldName ], actualVal);\n}\n\n/**\n * Safely clears a value for a given cache field, despite being 'required'.\n * Exported and primarily used for testing purposes.\n *\n * @param {string} fieldType - The field type metadata name.\n * @param {string} fieldName - The field name within the field type metadata.\n */\nexport function clear(fieldType, fieldName) {\n\tClientCache.put(fieldType, [ fieldName ], null);\n}\n\n/**\n * Safely returns a value from a given cache field, and localizes it\n * if needed.\n * Exported for test visibility.\n *\n * @param {string} fieldType - The field type metadata name.\n * @param {string} fieldName - The field name within the field type metadata.\n *\n * @returns the value from client cache for a given field name.\n */\nexport function get(fieldType, fieldName) {\n\treturn ClientCache.get(fieldType, [ fieldName ]);\n}\n\n/**\n * Returns a Promise of a value once that value is set.\n * @param {string} key - The record key.\n * @param {[string]} path - The path to the value.\n * @returns The promise for the value once it is set.\n */\nexport function getOnce(key, path) {\n\treturn new Promise((resolve) => {\n\t\tconst ignore = ClientCache.observe(key, path, (value) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tignore();\n\t\t\t});\n\t\t\tresolve(value);\n\t\t})\n\t});\n}\n\n/**\n * Merges the specified data into the ClientCache\n * @param {object} data - The data to be merged into the root of ClientCache.\n */\nexport function merge(data) {\n\tfor (let key in data) {\n\t\tClientCache.put(key, [ ], mergeRec(ClientCache.get(key, [ ]), data[key]));\n\t}\n}\n\n/**\n * Given a field type name, returns the field type metadata.\n * Exported for test visibility.\n *\n * @param {object} metadata - The entire metadata object to query from.\n * @param {string} fieldType - The metadata field type name.\n *\n * @returns {object} a metadata object with related fields.\n */\nexport function _getFieldTypeMD(metadata, fieldType) {\n\tif (!metadata.hasOwnProperty(fieldType))\n\t\tthrow new Error('Metadata type does not exist.');\n\treturn metadata[fieldType];\n}\n\n/**\n * Given a field type metadata object and a field name, returns\n * the metadata for a specific field, if exists.\n * Exported for test visibility.\n *\n * @param {object} fieldTypeMD - Metadata associated to a field type.\n * @param {string} fieldName - The name of the field in the field type.\n *\n * @returns {object} a metadata object for the specific field name.\n */\nexport function _getFieldMD(fieldTypeMD, fieldName) {\n\tif (!fieldTypeMD.fields || !fieldTypeMD.fields.hasOwnProperty(fieldName))\n\t\tthrow new Error('Field does not exist in metadata.');\n\treturn fieldTypeMD.fields[fieldName];\n}\n\n/**\n * Given a metadata object for a field and a value, determines if\n * the value's type matches the field's type.\n * Exported for test visibility.\n *\n * @param {object} fieldMD - The metadata for a specific field.\n * @param value - The value to be persisted in client cache for the field.\n */\nexport function _typeCheck(fieldMD, value) {\n\tconst type = fieldMD.type;\n\tif (type && typeof value !== type)\n\t\tthrow new Error('Given type does not match field metadata.');\n}\n\n/**\n * Given a metadata object for a field and a value, determines if\n * a falsey value is allowed to be persisted.\n * Exported for test visibility.\n *\n * @param {object} fieldMD - The metadata for a specific field.\n * @param value - The value to be persisted in client cache for the field.\n */\nexport function _requiredCheck(fieldMD, value) {\n\tif (fieldMD.required && (value === undefined || value === null || value === ''))\n\t\tthrow new Error('Field is required to have a value set.');\n}","import {Constants} from 'quotes/models/Constants.js';\n\nexport class SortLinesHandler {\n\tconstructor(prefix) {\n\t\tthis.constants = new Constants(prefix);\n\t}\n\n\tsortLineItems(lines, lineSortField) {\n\t\tlines.sort(function(a, b) {\n\t\t\ta.lineSortValue = a.record[lineSortField];\n\t\t\tb.lineSortValue = b.record[lineSortField];\n\t\t\tif (a.lineSortValue != null && b.lineSortValue != null && a.lineSortValue != b.lineSortValue) {\n\t\t\t\t// We know both values are non-null and non-equal, so we can try to compare them.\n\t\t\t\t// Try subtraction, on the chance we're dealing with numeric strings or numbers\n\t\t\t\tvar difference = a.lineSortValue - b.lineSortValue;\n\t\t\t\tif (difference === difference) {\n\t\t\t\t\t// There's only one value in all of JS that's not equal to itself, and it's NaN. So if the difference\n\t\t\t\t\t// is equal to itself, we can just return it, since it's going to be a number.\n\t\t\t\t\treturn difference;\n\t\t\t\t} else {\n\t\t\t\t\t// If the difference isn't equal to itself, then we're dealing with a non-numeric string.\n\t\t\t\t\t// Just use '<'. It should be fine.\n\t\t\t\t\treturn a.lineSortValue < b.lineSortValue ? -1 : 1;\n\t\t\t\t}\n\t\t\t} else if (a.lineSortValue == b.lineSortValue) {\n\t\t\t\tvar aSecondary = a.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tvar bSecondary = b.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tif (aSecondary == bSecondary) {\n\t\t\t\t\t// If both of the secondary sort values are equal, then we should try using the Number__c field\n\t\t\t\t\treturn a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n\t\t\t\t} else if (aSecondary == null) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (bSecondary == null) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn aSecondary - bSecondary;\n\t\t\t\t}\n\t\t\t} else if (a.lineSortValue == null) {\n\t\t\t\treturn -1;\n\t\t\t} else if (b.lineSortValue == null) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\t// There's no reason we should end up in this branch, but if we somehow do, then we should compare the\n\t\t\t\t// Number__c fields.\n\t\t\t\treturn a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn lines;\n\t}\n}\n","const observers = new Map();\n\n/**\n * Register observer function.\n * @param {Model} model - The model to observe.\n * @param {function(string[])} observer - The function to be called when the model changes.\n *     notifier will send the path of the changed data to the observer.\n * @returns {function()} The function that unregisters the observer.\n */\nexport function register(model, observer) {\n\tif (!observers.has(model)) {\n\t\tobservers.set(model, new Set());\n\t}\n\tconst modelObservers = observers.get(model);\n\tmodelObservers.add(observer);\n\treturn () => {\n\t\tmodelObservers.delete(observer);\n\t}\n}\n\n/**\n * Tell the notifier that some data changed\n * @param {Model} model - The model that contains the data.\n * @param {string[]} path - The path of the data within the model.\n */\nexport function notify(model, path) {\n\tif (observers.has(model)) {\n\t\tobservers.get(model).forEach((observer) => {\n\t\t\tobserver(path);\n\t\t});\n\t}\n}\n\nconst unregisterMap = new Map();\n\n/**\n * Convenience function for registering a component to observe a model.\n *     If the component is already refistered it will unregister from the previous model\n *     Hooks into the polymer notifier directly.\n * @param {PolymerComponent} component - The component that is observing the model.\n * @param {string} [modelAttr=model] - The attribute name that contains the model to observe\n */\nexport function registerComponent(component, modelAttr = 'model') {\n\tif (unregisterMap.has(component)) {\n\t\tunregisterMap.get(component)();\n\t}\n\tunregisterMap.set(component, register(component[modelAttr], (path) => {\n\t\tcomponent.notifyPath([ modelAttr ].concat(path).join('.'));\n\t}));\n}\n\n/**\n * Convenience function for telling a model to set a value and notify observers of the change.\n * @param {Model} model - The model that contains the data.\n * @param {string[]} path - The path of the data within the model.\n * @param {*} value - The value to set in the data\n */\nexport function setThenNotify(model, path, value) {\n\tconst lastInd = path.length - 1;\n\tpath.slice(0, lastInd).reduce((obj, key) => obj[key], model)[path[lastInd]] = value;\n\tnotify(model, path);\n}\n","/**\n * Created by jfeingold on 10/13/16.\n */\nmodule.exports = convertTo18;\n\nvar CONVERSION_TABLE = {\n\t\"00000\": \"A\",\n\t\"00001\": \"B\",\n\t\"00010\": \"C\",\n\t\"00011\": \"D\",\n\t\"00100\": \"E\",\n\t\"00101\": \"F\",\n\t\"00110\": \"G\",\n\t\"00111\": \"H\",\n\t\"01000\": \"I\",\n\t\"01001\": \"J\",\n\t\"01010\": \"K\",\n\t\"01011\": \"L\",\n\t\"01100\": \"M\",\n\t\"01101\": \"N\",\n\t\"01110\": \"O\",\n\t\"01111\": \"P\",\n\t\"10000\": \"Q\",\n\t\"10001\": \"R\",\n\t\"10010\": \"S\",\n\t\"10011\": \"T\",\n\t\"10100\": \"U\",\n\t\"10101\": \"V\",\n\t\"10110\": \"W\",\n\t\"10111\": \"X\",\n\t\"11000\": \"Y\",\n\t\"11001\": \"Z\",\n\t\"11010\": \"0\",\n\t\"11011\": \"1\",\n\t\"11100\": \"2\",\n\t\"11101\": \"3\",\n\t\"11110\": \"4\",\n\t\"11111\": \"5\"\n};\n\n/**\n * Converts the ID provided to an 18-digit Apex ID\n * @param {String} id An Apex ID string\n * @returns {string|null}\n * @throws Throws an error if argument is not 15 or 18 characters long\n */\nfunction convertTo18(id) {\n\tif (!id) {\n\t\treturn null;\n\t} else if (id.length === 18) {\n\t\treturn id;\n\t} else if (id.length === 15) {\n\t\tvar part1 = convertToDigit(id.slice(0, 5));\n\t\tvar part2 = convertToDigit(id.slice(5, 10));\n\t\tvar part3 = convertToDigit(id.slice(10, 15));\n\t\treturn (id + part1 + part2 + part3);\n\t} else {\n\t\treturn null;\n\t}\n}\n\n\n/**\n * Reverses the characters in an alphanumeric string, i.e., \"SpinOn\" becomes \"nOnipS\"\n * @param {String} str An alphanumeric string\n * @returns {string}\n * @private\n */\nfunction reverseString(str) {\n\treturn str.split(\"\").reverse().join(\"\");\n}\n\n/**\n * Replaces all numeric or lowercase characters with 0, and all uppercase characters with 1, i.e. \"0Sa0Z\" becomes \"01001\"\n * @param {String} string\n * @returns {string}\n * @private\n */\nfunction replaceWithBinary(string) {\n\tvar res = string.replace(/[^A-Z]/g, \"0\");\n\treturn res.replace(/[A-Z]/g, \"1\");\n}\n\n/**\n * Uses the Conversion Table to turn a 5-digit binary string into a single character\n * @param {String} seg A 5-digit string of 1s and 0s\n * @returns {String} A single character in the range A-Z or 0-5\n * @private\n */\nfunction convertToDigit(seg) {\n\treturn CONVERSION_TABLE[replaceWithBinary(reverseString(seg))];\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nself.addEventListener('message', function(e) {\n\tvar startTime = new Date().getTime();\n\t// We need to import these scripts so that we have access to JSForce and a Promise polyfill.\n\timportScripts(\"//cdnjs.cloudflare.com/ajax/libs/jsforce/1.7.0/jsforce.min.js\");\n\timportScripts(\"https://www.promisejs.org/polyfills/promise-7.0.4.min.js\");\n\t// Create JSForce connection using the access token provided by the event's context.\n\n\tvar conn = new jsforce.Connection({\n\t\tsessionId : e.data.sessionId,\n\t\tinstanceUrl: e.data.siteUrl\n\t});\n\tconn.oik = e.data.oik;\n\t// Create a proxy REST connection to the org.\n\tvar client = require('./PrecacheRestClient.js')(conn, e.data.orgUrl, e.data.siteUrl, e.data.proxyUrl);\n\t// Create a wrapper object to manage the apex connection and simplify interaction.\n\tvar apex = apexFactory(client);\n\n\t// The specific precaching actions are all handled by separate files that we've called 'Sequence Runners'.\n\t// Every Sequence Runner contains a method that takes several parameters and returns\n\t// an object with a method called executeSequence(), which actually performs the precaching.\n\t// We identify which runner to use, and create an array of arguments to pass into an apply call.\n\tvar precacheSequence = e.data.precacheSequence;\n\tvar runnerConstructor = getRunnerConstructor(precacheSequence);\n\tif (!runnerConstructor) {\n\t\tself.postMessage({failure: true, sequence: precacheSequence, msg: 'Unrecognized sequence'});\n\t\tclose();\n\t}\n\tvar argumentList = getArgumentList(precacheSequence, apex, e.data, self.postMessage);\n\tvar runner = runnerConstructor.apply(null, argumentList);\n\trunner.executeSequence()\n\t\t.then(function() {\n\t\t\tclose();\n\t\t});\n});\n\n/**\n * Requires the right constructor for the sequence runner associated with the precache sequence \n * @param {String} sequence Indicates which precache sequence to use\n * @returns {function} A constructor for an object with an executeSequence() method.\n */\nfunction getRunnerConstructor(sequence) {\n\tvar requiredModulesBySequence = {\n\t\t'PriceRuleSequence': require('./PrecacheSequenceRunners/PriceRuleSequenceRunner.js'),\n\t\t'MetadataSequence': require('./PrecacheSequenceRunners/MetadataSequenceRunner.js'),\n\t\t'OptionSequence': require('./PrecacheSequenceRunners/OptionSequenceRunner.js'),\n\t\t'DiscountAndAccountSequence': require('./PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js'),\n\t\t'ProductSequence': require('./PrecacheSequenceRunners/ProductSequenceRunner.js'),\n\t\t'RelatedRecordSequence': require('./PrecacheSequenceRunners/RelatedRecordSequenceRunner.js'),\n\t\t'UbpSequence': require('./PrecacheSequenceRunners/UbpSequenceRunner.js'),\n\t\t'PricingGuidanceSequence': require('./PrecacheSequenceRunners/PricingGuidanceSequenceRunner.js')\n\t};\n\treturn requiredModulesBySequence[sequence] || null;\n}\n\n/**\n * Creates a list of arguments to be passed into a sequence runner using .apply().\n * @param {String} sequence Indicates which sequence is in progress.\n * @param {Object} apex A wrapper to provide access to the SFDC org\n * @param {Object} data The context passed in from the main thread\n * @param {Function} resultPoster self.postMessage() passed in as a parameter.\n * @returns {*}\n */\nfunction getArgumentList(sequence, apex, data, resultPoster) {\n\t// All sequence runners receive these three arguments.\n\tvar result = [apex, data.prefix, resultPoster];\n\t// Each runner requires extra data, so we get that data and append it to the argument list.\n\tswitch(sequence) {\n\t\tcase 'PriceRuleSequence':\n\t\t\t// In addition to the standard data, we must also include the Account ID for this quote, so assets and subscriptions\n\t\t\t// may be loaded.\n\t\t\treturn result.concat([data.accountId]);\n\t\tcase 'MetadataSequence':\n\t\t\t// In addition to the standard data, the context will include the Referenced Field Map from the inner class\n\t\t\t// EditorSettings in QuoteEditorModel.cls. This indicates which fields must have their metadata queried.\n\t\t\treturn result.concat([data.referencedFieldMap, data.settings]);\n\t\tcase 'DiscountAndAccountSequence':\n\t\t\t// In addition to the standard data, we must also include the Quote JSON, and the account ID. The former\n\t\t\t// is swept for schedule IDs, and the latter is used to get asset and subscription summary information.\n\t\t\treturn result.concat([data.quote, data.accountId]);\n\t\tcase 'RelatedRecordSequence':\n\t\t\t// In addition to the standard data, we must also include the QuoteJSON, the referenced field map,\n\t\t\t// and a map of lookup fields. The quote is swept for data, the the lookup map indicates which fields must\n\t\t\t// be checked for IDs, and the referenced field map indicates which fields on the corresponding objects must\n\t\t\t// be queried.\n\t\t\treturn result.concat([data.quote, data.lookupFieldMap, data.referencedFieldMap]);\n\t\tcase 'ProductSequence':\n\t\tcase 'OptionSequence':\n\t\t\t// Both the Option and Product sequences require the Quote JSON, and a list of referenced fields.\n\t\t\treturn result.concat([data.quote, data.referencedFields]);\n\t\tcase 'UbpSequence':\n\t\t\t// The UBP sequence requires the Quote JSON, and the Settings object.\n\t\t\treturn result.concat([data.quote, data.settings]);\n\t\tcase 'PricingGuidanceSequence':\n\t\t\t// In addition to the standard data, we must also include the Quote JSON, and the account ID. The former\n\t\t\t// is swept for schedule IDs, and the latter is used to get asset and subscription summary information.\n\t\t\treturn result.concat([data.quote, data.accountId, data.settings]);\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n\nfunction apexFactory(client) {\n\tfunction read(prefix, provider, uid) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.read(prefix, provider, uid).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.load(prefix, provider, uid || '', context).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\tclient.setOptions(opts);\n\t}\n\n\tfunction md(mdType, fields, prefix) {\n\t\treturn load(prefix, 'MetaDataServiceProvider.FieldMetaDataLoader', null, {fields});\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tmd: md,\n\t\tsetOptions: setOptions\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n */\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class JSQCPrecacheWorkerManager {\n\tconstructor(data) {\n\t\tthis.data = data;\n\t\tthis.orgUrl = this.data.settings.orgUrl;\n\t\tthis.siteUrl = this.data.settings.siteUrl;\n\t\tthis.proxyUrl = this.data.settings.proxyUrl;\n\t\tthis.oik = this.data.settings.oik;\n\t\tthis.prefix = this.data.developerPrefix ? this.data.developerPrefix.slice(0, this.data.developerPrefix.indexOf('_')) : '';\n\t\tthis.constants = new Constants(this.data.developerPrefix);\n\t\tthis.filePath = this.siteUrl + '/resource/' + new Date().getTime() + '/' + this.data.developerPrefix + 'PrecacherUI2';\n\t}\n\n\tbeginPrecaching() {\n\t\tthis.sessionId = window.sb.vfSessionId;\n\t\tthis._spoolWorkers();\n\t}\n\n\t_spoolWorkers() {\n\t\tvar accountId = this.data.quote.record[this.constants.ACCOUNT_ID_FIELD];\n\t\tvar settings = this.data.settings;\n\t\tvar quote = this.data.quote;\n\t\tvar referencedFieldMap = this.data.settings.referencedFieldMap;\n\n\n\t\tvar priceRuleWorker = this._createWorker();\n\t\tvar priceRuleContext = this._createWorkerContext('PriceRuleSequence',\n\t\t\t// We must include the account ID so that the sequence runner can retrieve asset and subscription records.\n\t\t\tnew Map([['accountId', accountId]]));\n\t\tpriceRuleWorker.postMessage(priceRuleContext);\n\n\t\tvar metadataWorker = this._createWorker();\n\t\tvar metadataContext = this._createWorkerContext('MetadataSequence',\n\t\t\t// We must include the referenced field map so that the sequence runner knows which fields it needs metadata for.\n\t\t\tnew Map([['referencedFieldMap', referencedFieldMap], ['settings', settings]])\n\t\t);\n\t\tmetadataWorker.postMessage(metadataContext);\n\n\t\tvar discountWorker = this._createWorker();\n\t\tvar discountContext = this._createWorkerContext('DiscountAndAccountSequence',\n\t\t\t// We must include the Account Id so its assets and subscriptions may be summarized, and the quote so we\n\t\t\t// can sweep it for discount schedule Ids.\n\t\t\tnew Map([['accountId', accountId], ['quote', quote]])\n\t\t);\n\t\tdiscountWorker.postMessage(discountContext);\n\n\t\tvar relatedRecordWorker = this._createWorker();\n\t\tvar lookupFieldMap = {\n\t\t\tquoteLookups: settings.quoteLookups || {},\n\t\t\tgroupLookups: settings.groupLookups || {},\n\t\t\tlineLookups: (function() {\n\t\t\t\tvar allLineLookups = settings.lineLookups || {};\n\t\t\t\tvar nonstandardLineLookups = {};\n\t\t\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\t\t\tfor (var key in allLineLookups) {\n\t\t\t\t\tif (key !== fieldPrefix + 'Product__c' && key !== fieldPrefix + 'ProductOption__c') {\n\t\t\t\t\t\tnonstandardLineLookups[key] = allLineLookups[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn nonstandardLineLookups;\n\t\t\t})()\n\t\t};\n\t\tvar relatedRecordContext = this._createWorkerContext('RelatedRecordSequence',\n\t\t\t// We must include the quote so it can be swept for Ids, the lookup field map to know what fields point to other\n\t\t\t// records, and the referenced field map so we can know what fields on those objects to query.\n\t\t\tnew Map([['quote', quote], ['referencedFieldMap', referencedFieldMap], ['lookupFieldMap', lookupFieldMap]])\n\t\t);\n\t\trelatedRecordWorker.postMessage(relatedRecordContext);\n\n\t\tvar productWorker = this._createWorker();\n\t\tvar productContext = this._createWorkerContext('ProductSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap['Product2']]])\n\t\t);\n\t\tproductWorker.postMessage(productContext);\n\n\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\tvar optionWorker = this._createWorker();\n\t\tvar optionContext = this._createWorkerContext('OptionSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap[fieldPrefix + 'ProductOption__c']]])\n\t\t);\n\t\toptionWorker.postMessage(optionContext);\n\n\t\tlet ubpWorker = this._createWorker();\n\t\tlet ubpContext = this._createWorkerContext('UbpSequence',\n\t\t\t// We must include the quote so its lines can be swept for IDs and schedules, and we need the settings object\n\t\t\t// so we can get plugin information and referenced fields.\n\t\t\tnew Map([['quote', quote], ['settings', settings]])\n\t\t);\n\t\tubpWorker.postMessage(ubpContext);\n\n\t\tif(settings && settings.isPricingGuidanceEnabled) {\n\t\t\tlet pricingGuidanceWorker = this._createWorker();\n\t\t\tlet pricingGuidanceContext = this._createWorkerContext('PricingGuidanceSequence',\n\t\t\t\t// We must include the Account Id so its assets and subscriptions may be summarized for Cross order Pricing guidance\n\t\t\t\tnew Map([['accountId', accountId], ['quote', quote], ['settings', settings]])\n\t\t\t);\n\t\t\tpricingGuidanceWorker.postMessage(pricingGuidanceContext);\n\t\t}\n\t}\n\n\t_createWorkerContext(sequence, extrasMap) {\n\t\tvar baseContext = {\n\t\t\torgUrl: this.orgUrl,\n\t\t\tsiteUrl: this.siteUrl,\n\t\t\tproxyUrl: this.proxyUrl,\n\t\t\tsessionId: this.sessionId,\n\t\t\tprecacheSequence: sequence,\n\t\t\tprefix: this.prefix,\n\t\t\toik: this.oik\n\t\t};\n\t\tif (extrasMap && extrasMap.size != 0) {\n\t\t\textrasMap.forEach(function(val, key) {\n\t\t\t\tbaseContext[key] = val;\n\t\t\t});\n\t\t}\n\t\treturn baseContext;\n\t}\n\n\t_createWorker() {\n\t\tvar wrkr = new Worker(this.filePath);\n\t\tvar precachingFn = this._precache;\n\t\twrkr.addEventListener('message', function(e) {\n\t\t\tif (e.data.successful) {\n\t\t\t\tprecachingFn(e.data.provider, e.data.uid, e.data.results);\n\t\t\t} else if (e.data.failure) {\n\t\t\t\tconsole.error('Main thread received failure from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t} else if (e.data.err) {\n\t\t\t\tconsole.error('Main thread received error from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t}\n\t\t});\n\t\treturn wrkr;\n\t}\n\n\t_precache(provider, uid, results) {\n\t\tif (SB && SB.JSQCPrecacher) {\n\t\t\tvar precacher = new SB.JSQCPrecacher();\n\t\t\tprecacher.precacheValue(provider, uid, results);\n\t\t}\n\t}\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nmodule.exports= restClient;\nfunction restClient(conn, orgUrl, siteUrl, proxyUrl) {\n\tvar proxy = restProxy(conn, orgUrl, siteUrl, proxyUrl);\n\n\tfunction read(prefix, provider, uid) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.get(endpoint + '?reader=' + provider + '&uid=' + uid).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\tvar body = JSON.stringify({context: JSON.stringify(context)});\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.patch(endpoint + '?loader=' + provider + '&uid=' + uid, body).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\t// not supported\n\t}\n\n\tfunction getEndpoint(prefix) {\n\t\tvar endpoint = '/ServiceRouter';\n\t\treturn prefix ? ('/' + prefix + endpoint) : endpoint;\n\t}\n\n\tfunction parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch (e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tsetOptions: setOptions\n\t};\n}\n\nfunction restProxy(conn, orgUrl, siteUrl, proxyUrl) {\n\n\tfunction get(endpoint) {\n\t\treturn send(endpoint, 'GET');\n\t}\n\n\tfunction patch(endpoint, body) {\n\t\treturn send(endpoint, 'PATCH', body);\n\t}\n\n\tfunction send(endpoint, method, body) {\n\t\tendpoint += (conn.oik  === undefined ? '' : '&oik=' + conn.oik);\n\t\tvar params = {\n\t\t\turl: siteUrl != '' ? (siteUrl + '/services/apexrest' + endpoint) : proxyUrl,\n\t\t\tmethod: method,\n\t\t\theaders: {\n\t\t\t\t'SalesforceProxy-Endpoint': orgUrl + '/services/apexrest' + endpoint,\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t};\n\n\t\tif(body)\n\t\t\tparams.body = body;\n\n\t\treturn conn.request(params);\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tpatch: patch\n\t};\n}","import {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js'\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport {JsonFormatter} from 'common/data/format/JsonFormatter.js';\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {getPrunedRecord} from 'common/Util.js';\nimport {AssetQuantityValidator} from 'quotes/models/AssetQuantityValidator.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {JSQCNotifier} from 'quotes/models/JSQCNotifier.js';\nimport {MDQSegmentHelper} from 'quotes/models/MDQSegmentHelper.js';\nimport {QuoteMessenger} from 'quotes/models/QuoteMessenger.js';\nimport { getOnce } from 'quotes/models/SafeClientCache.js';\nimport {SortLinesHandler} from 'quotes/models/SortLinesHandler.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {put, get, del} from 'quotes/models/ClientCache.js';\nimport {overrideRecValues} from 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js';\nimport {mergeRec, Util} from 'common/Util.js';\nimport {AppLogger, LOG_TYPE} from \"logging/AppLogger.js\";\n\n/**\n *  <sb-le-custom-action-services>\n *\n *  Features:\n *\n **/\nexport class LECustomActionServices {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-custom-action-services';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\teventDetail: Object,\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Finds the sb-service component and sets its model\n\t * @param  {String} eventHandlerName   - Id of the sb-service component\n\t * @param  {Object} pseudoServiceModel - The initial value of the model to set the sb-service component\n\t * @param {lineFilterCallback} [lineFilterFn] - An optional method by which non-essential quote lines will be excluded\n\t *                                              from the JSON, thus minimizing JSON bloat.\n\t */\n\t_executeServiceAction(eventHandlerName, pseudoServiceModel, lineFilterFn) {\n\t\tlet serviceModel = pseudoServiceModel || (this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null);\n\t\tif(this.editorModel) {\n\t\t\tif (this._usesClientCalculator())\n\t\t\t\tthis.sortLines(this.editorModel.quoteModel.quoteVO, false);\n\t\t\t// Replaces lineItems on quoteVO with a reordered version after front end operations (i.e. drag and drop, clone lines, delete lines, etc) so the lineVOs are indexed correctly before sent to server\n\t\t\tthis.editorModel.quoteModel.quoteVO.lineItems = this._reorderLineItems();\n\t\t\tthis._reorderGroups();\n\t\t}\n\t\tlet quoteVO = this.editorModel ? this.editorModel.quoteModel.quoteVO : this.data.quote;\n\t\tconst essentialLines = (lineFilterFn && serviceModel) ? lineFilterFn(quoteVO, serviceModel) : quoteVO.lineItems;\n\t\tlet allLines = quoteVO.lineItems;\n\t\tquoteVO.partialVO = (allLines.length != essentialLines.length);\n\t\tquoteVO.lineItems = essentialLines;\n\t\tlet largeQuoteThreshold = this.data.settings.largeQuoteThreshold;\n\t\tlet isLargeQuote = largeQuoteThreshold && quoteVO.lineItems.length > largeQuoteThreshold;\n\t\tif ( (eventHandlerName === 'saveService' || eventHandlerName === 'quickSaveService') && isLargeQuote && SB && SB.QuoteDAO) {\n\t\t\tquoteVO.lineItems = allLines;\n\t\t\tquoteVO.partialVO = false;\n\t\t\tthis._saveLargeQuote(quoteVO, eventHandlerName);\n\t\t\treturn;\n\t\t}\n\t\tconst formatterOptions = {\n\t\t\tcleanRootProperty: 'record',\n\t\t\tcleanPathFromRoot: ['ui_original_record'],\n\t\t\tkeepIfDirtyWhenParentContains: 'attributes',\n\t\t\tkeepIfDirtyWhiteList: { type: [`${this.prefix}QuoteLineConsumptionSchedule__c`, `${this.prefix}QuoteLineConsumptionRate__c`] }\n\t\t};\n\t\tif (serviceModel) {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tserviceModel.quote = new JsonFormatter(true, null, null, formatterOptions).format(quoteVO);\n\t\t\tthis.$[eventHandlerName].model = serviceModel;\n\t\t} else {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tthis.$[eventHandlerName].model = new JsonFormatter(true, null, null, formatterOptions).format(quoteVO);\n\t\t}\n\t\tquoteVO.lineItems = allLines;\n\t\tquoteVO.partialVO = false;\n\t}\n\n\t_executeQuotelessServiceAction(eventHandlerName, pseudoServiceModel) {\n\t\tlet serviceModel = pseudoServiceModel || (this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null);\n\t\tif (serviceModel) {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tthis.$[eventHandlerName].model = serviceModel;\n\t\t} else {\n\t\t\tconsole.log('no service model means nothing to do');\n\t\t}\n\t}\n\n\t_saveLargeQuote(quoteVO, eventHandlerName) {\n\t\tfor (let groupVO of quoteVO.lineItemGroups) {\n\t\t\tif (!groupVO.record.attributes) {\n\t\t\t\tgroupVO.record.attributes = { type: `${this.prefix}QuoteLineGroup__c` };\n\t\t\t}\n\t\t}\n\n\t\tconst prefix = this.app.org.prefix;\n\t\tPromise.resolve().then(() => {\n\t\t\tif (!this.data.settings.enableLQTValidations) {\n\t\t\t\treturn [ ];\n\t\t\t}\n\n\t\t\treturn getOnce('validationErrorConditionDependencies', [ ]).then((response) => {\n\t\t\t\tif (response.errors) {\n\t\t\t\t\tthrow new Error(formatError(response.errors));\n\t\t\t\t}\n\n\t\t\t\treturn this.$.productRuleValidator.load({\n\t\t\t\t\tuid: quoteVO.record.Id,\n\t\t\t\t\tcontext: {\n\t\t\t\t\t\tquote: quoteVO.record,\n\t\t\t\t\t\tquoteLineGroups: quoteVO.lineItemGroups.map((vo) => vo.record),\n\t\t\t\t\t\tquoteLines: quoteVO.lineItems.map((vo) => getPrunedRecord(vo.record, response.fields)),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}).then((validations) => {\n\t\t\tif (validations.length > 0) {\n\t\t\t\tthrow new Error(formatError(validations));\n\t\t\t}\n\n\t\t\treturn new ConnectionClient(prefix).getConnection();\n\t\t}).then((connection) => {\n\t\t\tlet quoteDAO = new SB.QuoteDAO(prefix, connection, this.data.settings);\n\t\t\treturn quoteDAO.saveQuote(quoteVO).then(() => {\n\t\t\t\t// override the sobject on connection here to avoid using apex batch jobs in QLE\n\t\t\t\tconnection.sobject = () => {\n\t\t\t\t\tconst self = this;\n\t\t\t\t\tfunction upsertBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncUpserter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction insertBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncInserter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction deleteBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncDeleter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tupsertBulk: upsertBulk,\n\t\t\t\t\t\tinsertBulk: insertBulk,\n\t\t\t\t\t\tdeleteBulk: deleteBulk\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tlet oppSync = new SB.QuoteOpportunitySynchronizer(this.data.settings, connection, prefix);\n\t\t\t\tlet promiseArray = [];\n\t\t\t\tpromiseArray.push(oppSync.updateOpportunityProducts(quoteVO));\n\t\t\t\tpromiseArray.push(this._checkIfRecordJobFailed());\n\t\t\t\treturn Promise.all(promiseArray);\n\t\t\t});\n\t\t}).then((results) => {\n\t\t\treturn results[1] !== 'Failed' ? Promise.resolve()\n\t\t\t\t: this._setRecordJob(\"Completed\");\n\t\t}).then(() => {\n\t\t\treturn this._handleLargeQuoteSaveResponse(eventHandlerName);\n\t\t}).catch((err) => {\n\t\t\tthis.error = this.$[eventHandlerName].createError(err);\n\t\t\tthis.showSpinner = false;\n\t\t\tconst msg = err.message || err;\n\t\t\tconst stk = err.stack || err;\n\t\t\tthis._setRecordJob(\"Failed\", msg, stk);\n\t\t});\n\t}\n\n\t_checkIfRecordJobFailed() {\n\t\tconst context = {\n\t\t\trecordId: this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\tjobType: \"QuoteCalculator\"\n\t\t};\n\n\t\treturn this.$.getRecordJobStatus.load( {context} );\n\t}\n\n\t_setRecordJob(sta, msg, stk) {\n\t\tconst model = {\n\t\t\trecordIds: [this.editorModel.quoteModel.quoteVO.record.Id],\n\t\t\tjobType: \"QuoteCalculator\",\n\t\t\tjobStatus: sta,\n\t\t\tjobDetails: msg,\n\t\t\tstacktrace: stk\n\t\t};\n\n\t\treturn this.$.setJobStatus.save( {model} );\n\t}\n\n\t_bulkService(service, records) {\n\t\tlet results = [];\n\t\t// Make a copy so original array is not affected because it is used to populate parentID's\n\t\tlet recordsCopy = records.slice();\n\t\tlet executeBatch = function(service, records) {\n\t\t\treturn this.$[service].save({model: records.splice(0,200)})\n\t\t\t\t.then( (response) => {\n\t\t\t\t\tresults = results.concat(response);\n\t\t\t\t\tif (records.length > 0) {\n\t\t\t\t\t\treturn executeBatch(service, records);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.resolve(results);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}.bind(this);\n\n\t\treturn executeBatch(service, recordsCopy);\n\t}\n\n\t_handleLargeQuoteSaveResponse(eventHandlerName) {\n\t\tif (eventHandlerName === 'saveService') {\n\t\t\tthis.saverResponse = 'SUCCESS';\n\t\t} else if (eventHandlerName === 'quickSaveService') {\n\t\t\t// Ignores checking for product rule validation on large quotes\n\t\t\tthis._reloadEditor();\n\t\t\tlet lineEditorReader = this._getDomHost().$.sbLineEditorRead;\n\t\t\tlineEditorReader.update(true); // clears cache\n\t\t}\n\t}\n\n\t/**\n\t * Reorders lineItems on quoteVO before sent to server after front end operations (i.e. drag and drop, clone lines, delete lines, etc)\n\t * @return  {Array} lineItems - lineVOs that have been reordered\n\t * @private\n\t */\n\t_reorderLineItems() {\n\t\tlet lineItems = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, numOfGroups = groupModels.length; i < numOfGroups; i++) {\n\t\t\tlet groupModel = groupModels[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) {\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) {\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) {\n\t\t\t\t\t\t// push segments lineVO\n\t\t\t\t\t\tlineItems.push(segments[m].lineVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++)\n\t\t\t\tlineItems.push(groupModel.standardLines[n].lineVO);\n\t\t}\n\t\treturn lineItems;\n\t}\n\n\t_reorderGroups() {\n\t\tlet groupModels = this.domHost.groupModels;\n\t\tfor (let i = 0; i < groupModels.length; i ++ ) {\n\t\t\tgroupModels[i].groupVO.record[this.editorModel.constants.NUMBER_FIELD] = i + 1;    // Update groupVO number field\n\t\t}\n\t}\n\n\tupdateUIAfterCalculate(quoteVO) {\n\t\t// Runs after a calculate to update the UI\n\t\tlet sortRequired = quoteVO.lineSortField && quoteVO.lineSortField == this.editorModel.constants.NUMBER_FIELD;\n\t\tthis.domHost.updateAfterJSQC(this.notifier, sortRequired);\n\t\t// Sorts lines after a normal calculate\n\t\tif (!this.sortLines(quoteVO, true)) {\n\t\t\tfireEvent(Events.REFRESH_TABLE);\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-favorite-saved': '_saveFavorite',\n\t\t\t'sb-clone-to-group-selected': '_cloneToGroup',\n\t\t\t'job-completed': '_jobCompleted',\n\t\t\t'sb-accept-pricing-guidance': '_onAcceptPricingGuidance'\n\t\t};\n\t}\n\n\n\t_saveFavorite(e) {\n\t\t/**\n\t\t * Filters all lines except for lines contained in a bundle whose key is included in serviceModel.keys.\n\t\t * @callback lineFilterCallback\n\t\t * @param {Object} quote A quote whose lines will be filtered\n\t\t * @param {Object} serviceModel The service model object containing information about which lines should be kept.\n\t\t * @param {Number[]} serviceModel.keys A list of line keys that should be kept\n\t\t * @return {[]} An array of the quote lines that must be sent to the server\n\t\t */\n\t\tlet lineFilterFn = (quote, serviceModel) => {\n\t\t\t// If there are no lines, there's nothing to filter.\n\t\t\tlet noLines = quote.lineItems == null || quote.lineItems.length == 0;\n\t\t\t// If there are no specified keys, then we have nothing to filter.\n\t\t\tlet noEssentialKeys = serviceModel.keys == null || serviceModel.keys.length == 0;\n\t\t\tif (noLines || noEssentialKeys) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tlet keysToKeep = new Set();\n\t\t\t// This method will let us get the keys of all lines whose parent item has the provided key.\n\t\t\tlet getComponentKeys = (key) => {\n\t\t\t\t// Add the provided key to the set.\n\t\t\t\tkeysToKeep.add(key);\n\t\t\t\tquote.lineItems.forEach((line) => {\n\t\t\t\t\t// For every line whose parent has the provided key, add that line's key to the set.\n\t\t\t\t\tif (line.parentItemKey === key) {\n\t\t\t\t\t\tkeysToKeep.add(line.key);\n\t\t\t\t\t\t// If the child line is itself the root of a bundle, call the function recursively.\n\t\t\t\t\t\tif (line.record[this.data.developerPrefix + 'Bundle__c']) {\n\t\t\t\t\t\t\tgetComponentKeys(line.key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tserviceModel.keys.forEach(getComponentKeys);\n\t\t\tlet linesToKeep = [];\n\t\t\tquote.lineItems.forEach((line) => {\n\t\t\t\tif (keysToKeep.has(line.key)) {\n\t\t\t\t\tlinesToKeep.push(line);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn linesToKeep;\n\t\t};\n\t\tthis._executeServiceAction('favoriteLinesService', {keys: e.detail.keys, favName: e.detail.name, groupKey: e.detail.groupKey}, lineFilterFn);\n\t}\n\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_executeCustomAction(eventDetail)',\n\t\t\t'_handleCalculateResponse(calculateResponse)',\n\t\t\t'_checkForGuidedMessages(saverResponse)',\n\t\t\t'_reloadEditor(quoteEditorModelResponse)',\n\t\t\t'_handleFavoriteResponse(favoriteResponse)',\n\t\t\t'_handleUnfavoriteResponse(unfavoriteResponse)',\n\t\t\t'_handleResegmentResponse(resegmentResponse)',\n\t\t\t'_updateQuote(quoteVOResponse)',\n\t\t\t'_handleToggleGroupResponse(toggleGroupResponse)',\n\t\t\t'_handlePopupResponse(popupResponse)'\n\t\t];\n\t}\n\n\t_handleFavoriteResponse() {\n\t\t// The response we received from the server is going to be a partial quote that only has the lines that we favorited.\n\t\t// So we need to define a function that copies those changes back to the original quote.\n\t\tlet quoteReconcileFn = (updatedQuote, originalQuote) => {\n\t\t\tlet originalLines = originalQuote.lineItems;\n\t\t\t// First, we need to replace any lines that were sent to the server with their updated versions.\n\t\t\tlet originalLineCount = originalLines.length;\n\t\t\tif (updatedQuote.lineItems && updatedQuote.lineItems.length !== 0) {\n\t\t\t\tupdatedQuote.lineItems.forEach((line) => {\n\t\t\t\t\t// Get the key of the response line...\n\t\t\t\t\tlet key = line.key;\n\t\t\t\t\t// Then search the original line list for that key.\n\t\t\t\t\tfor (let i = 0; i < originalLineCount; i++) {\n\t\t\t\t\t\tif (originalLines[i].key === key) {\n\t\t\t\t\t\t\t// When we find that key, we replace the old line with the new one.\n\t\t\t\t\t\t\toriginalLines[i] = line;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t// Then we need to replace any groups that were sent to the server with their updated versions too.\n\t\t\tlet originalGroups = originalQuote.lineItemGroups;\n\t\t\tlet originalGroupCount = originalGroups.length;\n\t\t\tif (updatedQuote.lineItemGroups && updatedQuote.lineItemGroups.length !== 0) {\n\t\t\t\tupdatedQuote.lineItemGroups.forEach((group) => {\n\t\t\t\t\t// Get the key of the response group...\n\t\t\t\t\tlet key = group.key;\n\t\t\t\t\t// Then search the original group list for that key.\n\t\t\t\t\tfor (let i = 0; i < originalGroupCount; i++) {\n\t\t\t\t\t\tif (originalGroups[i].key === key) {\n\t\t\t\t\t\t\t// When we find that key, we replace the old group with the new one.\n\t\t\t\t\t\t\toriginalGroups[i] = group;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tupdatedQuote.lineItems = originalLines;\n\t\t\tupdatedQuote.lineItemGroups = originalGroups;\n\t\t\treturn updatedQuote;\n\t\t};\n\t\tthis.domHost.updateQuote(this.favoriteResponse, quoteReconcileFn);\n\t}\n\n\t_handleUnfavoriteResponse() {\n\t\tthis._removeFavoritesFromQuote(this.unfavoriteResponse);\n\t}\n\n\t_removeFavoritesFromQuote(favoriteIds) {\n\t\t// removeFavoriteResponse is going to be an array of all the IDs that were deleted. We convert it into a Set\n\t\t// so we can call the .has() method to easily check whether a line's favorite ID is one that was removed.\n\t\tlet favIdSet = new Set(favoriteIds);\n\t\tlet favFieldName = this.editorModel.constants.FAVORITE_ID_FIELD;\n\t\t// Any line that had this favorite ID should have its favorite field nulled.\n\t\tthis.editorModel.quoteModel.quoteVO.lineItems.forEach((line) => {\n\t\t\tif (favIdSet.has(line.record[favFieldName])) {\n\t\t\t\tline.record[favFieldName] = null;\n\t\t\t}\n\t\t});\n\n\t\t// Ditto for groups.\n\t\tthis.editorModel.quoteModel.quoteVO.lineItemGroups.forEach((group) => {\n\t\t\tif (favIdSet.has(group.record[favFieldName])) {\n\t\t\t\tgroup.record[favFieldName] = null;\n\t\t\t}\n\t\t});\n\t\t// Then we remove the favorite IDs from the quote's set of favorite IDs\n\t\tif (this.editorModel.quoteModel.quoteVO.favoriteIds) {\n\t\t\tlet favs = this.editorModel.quoteModel.quoteVO.favoriteIds;\n\t\t\tthis.editorModel.quoteModel.quoteVO.favoriteIds = favs.filter((favId) => {\n\t\t\t\t\treturn !favIdSet.has(favId);\n\t\t\t});\n\t\t}\n\t\t// Then we pass the QuoteVO up to the domHost to update it.\n\t\tthis._updateQuote(this.editorModel.quoteModel.quoteVO);\n\t}\n\n\n\n\t/**\n\t * Invoked with eventDetail is set. The eventDetail object looks like {customAction: CustomActionModel, model: QuoteModel, GroupModel, or LineModel}\n\t * If there is a function with the same name as the eventHandlerName, invoke it. Otherwise, execute the action.\n\t */\n\t_executeCustomAction() {\n\t\tlet action = this.eventDetail.customAction;\n\t\tif (typeof this[action.eventHandlerName] == \"function\") {\n\t\t\tthis[action.eventHandlerName]();\n\t\t} else if (action.url && action.urlTarget) {\n\t\t\tthis._executeCustomURLAction(action.url, action.urlTarget, this.eventDetail.model);\n\t\t} else {\n\t\t\tthis._executeServiceAction(this.eventDetail.customAction.eventHandlerName);\n\t\t}\n\t}\n\n\t/**\n\t * Interface to the onSave function to be used if custom action === \"Save and Navigate\"\n\t *\n\t * W-4682308: Custom action of Save And Navigate.\n\t * It saves the quote using the save logic however instead of navigating to return url,\n\t * we return the url given to us by the user.\n\t */\n\tonSaveAndNavigate() {\n\t\tthis.onSave();\n\t}\n\n\t_executeCustomURLAction(url, target, model) {\n\t\tswitch (model.modelType) {\n\t\t\tcase 'QuoteModel':\n\t\t\t\tthis.model = model.quoteVO;\n\t\t\t\tbreak;\n\t\t\tcase 'LineModel':\n\t\t\t\tthis.model = model.lineVO;\n\t\t\t\tbreak;\n\t\t\tcase 'GroupModel':\n\t\t\t\tthis.model = model.groupVO;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.model = model.quoteVO || model.lineVO || model.groupVO;\n\t\t}\n\n\t\tlet parsedURL = this._parseURL(url, this.model, this.editorModel.quoteModel);\n\t\tif (target === 'Popup')\n\t\t\tthis._handlePopup(parsedURL, this.model.record);\n\t\telse\n\t\t\tthis._navigateToURL(parsedURL);\n\t}\n\n\t_handleCalculateResponse() {\n\t\tlet response = this.calculateResponse;\n\t\tif (response) {\n\t\t\t// if job id is exist, this implies that the background calculate was executed before.\n\t\t\tif ( response.jobId != null) {\n\t\t\t\tthis._onJobChecker(response);\n\t\t\t} else {\n\t\t\t\tthis._updateQuote(response);\n\t\t\t}\n\t\t}\n\t}\n\n\t_updateQuote(quoteVO) {\n\t\tthis.domHost.updateQuote(quoteVO);\n\t}\n\n\t_checkForGuidedMessages() {\n\t\tif (this.saverResponse.guidedMessages && this.saverResponse.guidedMessages.length > 0) {\n\t\t\tthis.domHost.handleProductRuleAlertModal('saveService', this.saverResponse);\n\t\t\tthis.showSpinner = false;\n\t\t} else {\n\t\t\t// Pass true to ensure validation process is called in navigateToReturnUrl\n\t\t\tthis.navigateToReturnUrl(true);\n\t\t}\n\t}\n\n\tnavigateToReturnUrl(args) {\n\t\t// when cancelling, no args are passed and we can just go to the detail page, skipping the validation process\n\t\tif(args && this.saverResponse && this.saverResponse.messages && this.saverResponse.messages.length > 0) {\n\t\t\tif (this.showSpinner)\n\t\t\t\tthis.showSpinner = false;\n\t\t\tthis.domHost.error = {validations: this.saverResponse.messages};\n\t\t\treturn;\n\t\t}\n\t\tlet returnUrl = \"\";\n\n\t\t// W-4682308: Custom action of Save And Navigate.\n\t\t// It saves the quote using the save logic however instead of navigating to return url,\n\t\t// we return the url given to us by the user.\n\t\tif (this.eventDetail.customAction.eventHandlerName === \"onSaveAndNavigate\") {\n\t\t\treturnUrl = this._parseURL(this.eventDetail.customAction.url, this.editorModel.quoteModel.quoteVO, this.editorModel.quoteModel);\n\t\t} else {\n\t\t\tlet sobjectId = this.editorModel.quoteModel.quoteVO.record.Id;\n\t\t\treturnUrl = this.eventDetail.customAction.record ? this.eventDetail.customAction.record[this.editorModel.constants.RETURN_URL_FIELD] : null;\n\t\t\tif (returnUrl) {\n\t\t\t\treturnUrl = this._parseURL(returnUrl, this.editorModel.quoteModel.quoteVO, this.editorModel.quoteModel);\n\t\t\t\tif ((returnUrl.length === 15 || returnUrl.length === 18) && returnUrl.match(/^[a-zA-Z0-9]*$/)) {\n\t\t\t\t\t// This is an ID\n\t\t\t\t\tsobjectId = returnUrl;\n\t\t\t\t\treturnUrl = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Only true if Large Quote Experience is enabled and the user is in full screen mode\n\t\t\tif (this._getDomHost().inFullScreenMode) {\n\t\t\t\tthis._getDomHost().exitFullScreenMode();\n\t\t\t}\n\n\t\t\t// Send a message to LDS to invalidate the quote in their cache\n\t\t\twindow.parent.postMessage({acknowledgement: \"I acknowledge that this is an unsupported feature that may stop working at any time.\", recordId: sobjectId}, '*');\n\n\t\t\tif (!returnUrl) {\n\t\t\t\tif (this._isLightningExperience()) {\n\t\t\t\t\t//W-014658: mobile does not have a way to exit the Visualforce page besides the back button\n\t\t\t\t\t//W-6747693: community on mobile needs to use navigateToSObject, WTF\n\t\t\t\t\tif (this._getViewport().isMobile() === true && !AppContext.user.inCommunity) {\n\t\t\t\t\t\tthis._navigateToURL('#/sObject/' + sobjectId + '/view');\n\t\t\t\t\t} else  {\n\t\t\t\t\t\tsforce.one.navigateToSObject(sobjectId);\n\t\t\t\t\t\tthis._closeSubTab();\n\t\t\t\t\t}\n\n\t\t\t\t\t// dismiss spinner if it's showing\n\t\t\t\t\tif (this.showSpinner) {\n\t\t\t\t\t\tthis.showSpinner = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t} else if (typeof Sfdc !== 'undefined' && Sfdc && Sfdc.Url) {\n\t\t\t\t\t// handle classic console app, which has isdtp=vw and needs to be preserved. Fix for W-4057287\n\t\t\t\t\tconst params = Sfdc.Url.getUrlParameters(window.location.href);\n\t\t\t\t\tif (this._areUrlParamsValid(params)) {\n\t\t\t\t\t\twindow.location.href = `${this.editorModel.communityPrefix}/${sobjectId}?isdtp=${params.isdtp}`;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Check if in partner portal\n\t\t\treturnUrl = returnUrl || (this.editorModel.communityPrefix + '/') + sobjectId;\n\t\t}\n\t\tif (this.showSpinner) {\n\t\t\tthis.showSpinner = false;\n\t\t}\n\t\tthis._navigateToURL(returnUrl, true);\n\t}\n\n\t_areUrlParamsValid(params) {\n\t\treturn params && (params.isdtp === 'nv' || params.isdtp === 'vw');\n\t\t// isdtp=vw : The page will be rendered without the tabs and sidebar.\n\t\t// isdtp=nv : The page will be rendered without the tabs and sidebar, and will accommodate all the buttons in a list view\n\t}\n\n\t_closeSubTab() {\n\t\tsforce.console.getEnclosingTabId((result) => {\n\t\t\tsforce.console.closeTab(result.id);\n\t\t});\n\t}\n\n\t_reloadEditor() {\n\t\tthis.domHost.destampGroups(); //destroy the groups so that they can be rerendered;\n\t\tthis.domHost.md = undefined;\n\t\tthis._clearAppliedUbpChanges();\n\n\t\t// Wrap this in after next render so destampGroups has time to remove group elements.\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tlet largeQuoteThreshold = this.editorModel.data.settings.largeQuoteThreshold;\n\t\t\tif (largeQuoteThreshold == null || (this.editorModel.quoteModel.quoteVO.lineItems.length <= largeQuoteThreshold)) {\n\t\t\t\tthis.domHost.rawData = this.quoteEditorModelResponse;\n\t\t\t\tif (this.quoteEditorModelResponse.guidedMessages && this.quoteEditorModelResponse.guidedMessages.length > 0) {\n\t\t\t\t\tthis.domHost.$.productAlertModal.displayContinueButton = false; // Set product alert's contBtn back to false if true\n\t\t\t\t\tthis.domHost.handleProductRuleAlertModal('quickSaveService', this.quoteEditorModelResponse);\n\t\t\t\t}\n\t\t\t}\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\t\tthis.showSpinner = false;\n\t\t\t\t// the quicksave button is disabled until save is complete, fire event to re-enable\n\t\t\t\tfireEvent(Events.TOGGLE_QUICKSAVE, { enable: true } );\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Event handler for response-event changed from sb-service (id=\"toggleGroupService\") component.\n\t * @private\n\t */\n\t_handleToggleGroupResponse() {\n\t\tthis.domHost.set('editorModel.quoteModel.quoteVO', this.toggleGroupResponse);\n\t\tif (this.domHost.$$('#quoteTabs'))\n\t\t\tthis.domHost.$$('#quoteTabs').destroyTabs();\n\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\n\t\tlet lineItemGroups = quoteModel.quoteVO.lineItemGroups;\n\t\tif (!quoteModel.grouped){ //Grouping the quote\n\t\t\tif (this.eventDetail.customAction.type === 'Solution Group') { this._extendSolutionGroupRecord(lineItemGroups[0].record)};\n\t\t\tthis.set('editorModel.quoteModel.grouped', true);\n\t\t\tthis.set('editorModel.quoteModel.quoteVO.lineItemGroups', quoteModel.quoteVO.lineItemGroups);\n\t\t} else { //Ungrouping the quote\n\t\t\tthis.domHost.set('editorModel.quoteModel.grouped', false);\n\t\t\t// Hides the \"Groups\" button that toggles the side panel\n\t\t\tthis.domHost.rightSideButton = false;\n\t\t\t// Notifies LEGroupLayout to close the group side panel\n\t\t\tfireEvent(Events.CLOSE_GROUP_PANEL);\n\t\t\tfor (let i =0; i < this.domHost.groupModels.length; i++) {\n\t\t\t\tthis.domHost.set('groupModels.' + i + '.groupVO', {});\n\t\t\t}\n\t\t}\n\t\tthis._updateQuote(quoteModel.quoteVO);\n\t\tif (this.domHost.viewport.isMobile()) {\n\t\t\tthis.domHost.buildQuoteTabs();\n\t\t}\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_handlePopupResponse() {\n\t\tswitch (this.popupResponse.action) {\n\t\t\tcase 'save':\n\t\t\t\tthis.onSave();\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\tthis.onQuickSave();\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\tlocation.reload();\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t_handlePopup(url, record) {\n\t\tlet popup = this.$.popup;\n\t\tpopup.url = url;\n\t\tpopup.messenger = new QuoteMessenger(this.editorModel, record);\n\t\tpopup.open();\n\t}\n\n\t_parseURL(url, targetModel, quoteModel) {\n\t\tlet parsedURL = url.replace(/{!(.*?)}/g, function(match, value) {\n\t\t\tlet record;\n\t\t\tlet splitValues = value.split('.');\n\t\t\tlet objectName = splitValues[0];\n\t\t\tif (objectName == this.app.org.prefix + '__Quote__c' || objectName == this.app.org.prefix + '__Quote__r' || objectName == 'Quote__c' || objectName == 'Quote__r') {\n\t\t\t\trecord = quoteModel.quoteVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else if (objectName === this.app.org.prefix + '__Group__c' || objectName === this.app.org.prefix + '__Group__r' || objectName == 'Group__c' || objectName == 'Group__r') {\n\t\t\t\trecord = quoteModel.groupsByKey[this.model.parentGroupKey].groupVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else {\n\t\t\t\trecord = targetModel.record;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < splitValues.length; i++) {\n\t\t\t\tif (i === splitValues.length - 1)\n\t\t\t\t\treturn record[splitValues[i]];\n\t\t\t\telse\n\t\t\t\t\trecord = record[splitValues[i]];\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn parsedURL;\n\t}\n\n\t_navigateToURL(url, isRedirect) {\n\t\t/**\n\t\t * W-7719644: navigateToURL doesn't work in communities, so use old window.location code instead\n\t\t */\n\t\tif (this._isLightningExperience() && !AppContext.user.inCommunity) {\n\t\t\t// W-3762767: isRedirect helps ensure canceling out of LE in Lightning Console does not open a new tab and leave the LE hanging in the current one\n\t\t\tsforce.one.navigateToURL(url, !!isRedirect);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce != 'undefined') && sforce && (!!sforce.one);\n\t}\n\n// Quote Actions\n\n\t/**\n\t * Sets the calculate service model\n\t *\n\t * @private\n\t */\n\tonFlagCalculate(showSpinner, updateQuoteRequired, doneCallback) {\n\t\tthis.domHost.errors = null;\n\t\tif (this._usesClientCalculator()) {\n\t\t\tthis.domHost.calculateGetCacheArray = []; // reset the calculate get cache array\n\t\t\tthis._jsqcCalculate(showSpinner).then(function(res){\n\t\t\t\t// Runs after a quote service comes back from the server and it requires a calculation\n\t\t\t\t// Or if custom segments have changed and need to be reflected in UI\n\t\t\t\tif (updateQuoteRequired || res.updateQuoteRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tthis._updateQuote(res.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Runs after add products\n\t\t\t\tif (this.data.quote.calculationRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tif ( res.value.lineSortField && res.value.lineSortField != this.data.developerPrefix + 'Number__c' ) {\n\t\t\t\t\t\t// Unique sort to handle sorting line items that haven't been rendered yet (navigating from add products)\n\t\t\t\t\t\tres.value.lineItems = new SortLinesHandler(this.data.developerPrefix).sortLineItems(res.value.lineItems, res.value.lineSortField);\n\t\t\t\t\t}\n\t\t\t\t\tthis.domHost._createEditorModel(this.domHost.data, this.domHost.md);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.updateUIAfterCalculate(res.value);\n\t\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\t\tdoneCallback(res.value);\n\t\t\t}.bind(this), function(rej) {\n\t\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\t\tdoneCallback();\n\t\t\t\tif (this.editorModel !== undefined) {\n\t\t\t\t\tthis.domHost.error = rej;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//When errors get caught here the LE page is not usable.  So we display an alert with the message and a button that goes back to the last page\n\t\t\t\tthis.$.alertModal.displayContinueButton = false;\n\t\t\t\tthis.$.alertModal.cancelCB = function() {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}.bind(this);\n\t\t\t\tthis.$.alertModal.alerts = [rej.message];\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tthis.$.calculateService.model = undefined;\n\t\t\tthis.$.calculateService.background = showSpinner === false;\n\t\t\tthis._executeServiceAction('calculateService');\n\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\tdoneCallback();\n\t\t}\n\t}\n\n\tonSave() {\n\t\tthis.showSpinner = true;\n\t\tthis.$.saveService.background = true;\n\t\tthis._save('saveService');\n\t}\n\n\tonQuickSave() {\n\t\tthis.$.quickSaveService.uid = this.editorModel.quoteModel.quoteVO.record.Id.substring(0, 15);\n\t\tthis.showSpinner = true;\n\t\tthis.$.quickSaveService.background = true;\n\t\t// clear from cache on save to prevent JsonParser from adding back the cached original record\n\t\tthis.domHost.$.sbLineEditorRead.clearCache();\n\t\t// Find the right key to navigate to after quick saving because the group keys of newly added groups will change after saving\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tlet groups = this.editorModel.quoteModel.lineGroups;\n\t\t\tfor (let i = 0, l = groups.length; i < l; i++) {\n\t\t\t\tif (groups[i].groupKey == this.domHost.selectedGroupKey) {\n\t\t\t\t\t// Group keys start at 2 after saving so use group index and add 2\n\t\t\t\t\tthis.domHost.returnGroupKeyAfterQuickSave = i + 2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.domHost.returnGroupKeyAfterQuickSave = null;\n\t\t}\n\t\tthis._save('quickSaveService');\n\t\tfireEvent(Events.QUOTE_SAVED);\n\t}\n\n\tonCancel() {\n\t\tthis.showSpinner = true;\n\t\tthis.navigateToReturnUrl();\n\t}\n\n\tonAddProducts() {\n\t\tthis._navigateToLookup('product');\n\t}\n\n\tonAddFavorites() {\n\t\tthis._navigateToLookup('favorite');\n\t}\n\n\t/**\n\t *   Invoked by the Quote-level multi-line Delete action\n\t */\n\tonDeleteLines() {\n\t\tif (this._usesClientCalculator()) {\n\t\t\tlet keysToDelete = new Set();\n\t\t\tthis._retrieveKeysOfSelected().forEach((key) => {\n\t\t\t\tkeysToDelete.add(key);\n\t\t\t});\n\t\t\tthis._deleteLines(keysToDelete, this.editorModel.quoteModel.quoteVO, true);\n\t\t\tthis.domHost.renumber();\n\t\t\tthis.onFlagCalculate(true, false);\n\t\t\tthis.domHost.quoteHasNoLines();\n\t\t\t// Render new tabs on large quote experience/mobile so that segmented or standard lines tabs can be re-rendered if needed\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled || this.editorModel.deviceContext.isMobile) {\n\t\t\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t\t\tthis.domHost.buildQuoteTabs();\n\t\t\t\t}\n\t\t\t\tfor (let i = 0, len = this.editorModel.quoteModel.lineGroups.length; i < len; i++) {\n\t\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: this.editorModel.quoteModel.lineGroups[i].groupKey });\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis._executeServiceAction('onDeleteLine', {keys: this._retrieveKeysOfSelected()});\n\t\t}\n\t}\n\n\t/**\n\t *   Invoked by line-level Delete action\n\t */\n\tonDeleteLine() {\n\t\tif (this._usesClientCalculator()) {\n\t\t\tlet keyToDelete = new Set();\n\t\t\tkeyToDelete.add(this.eventDetail.model.serviceModel.keys[0]);\n\t\t\tthis._deleteLines(keyToDelete, this.editorModel.quoteModel.quoteVO, true);\n\t\t\tthis.domHost.renumber();\n\t\t\tthis.onFlagCalculate(true, false);\n\t\t\tthis.domHost.quoteHasNoLines();\n\t\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t\tthis.domHost.buildQuoteTabs();\n\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: this.eventDetail.model.groupModel.groupKey });\n\t\t\t}\n\t\t\t// Render new tabs on large quote experience so that segmented or standard lines tabs can be re-rendered if needed\n\t\t\telse if (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: this.domHost.selectedGroupKey });\n\t\t\t}\n\t\t} else {\n\t\t\tthis._executeServiceAction('onDeleteLine', {keys: this.eventDetail.model.serviceModel.keys});\n\t\t}\n\t}\n\n\tonAddGroup() {\n\t\tthis._resetOnActionSignal();\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis._addGroup(); // Called when quote is grouped to add a new empty group.\n\t\t\tthis.onFlagCalculate(true, true); // kick off calculation so that default values are populated\n\t\t} else {\n\t\t\tthis._groupQuote();\n\t\t}\n\t}\n\n\tonUngroup() {\n\t\tthis._resetOnActionSignal();\n\t\tthis._ungroupQuote();\n\t}\n\n\t_groupQuote() {\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet quoteVO = quoteModel.quoteVO;\n\t\tquoteVO.record[this.data.developerPrefix + 'LineItemsGrouped__c'] = true;\n\t\tif(quoteVO.lineItemGroups.length === 0) {\n\t\t\tlet defaultName = this.editorModel.data.customLabels.lbl_default_group_name;\n\n\t\t\tif(quoteVO.record[this.data.developerPrefix + 'DefaultGroupName__c']) {\n\t\t\t\tconst defaultNameDefined = quoteVO.record[this.data.developerPrefix + 'DefaultGroupName__c'];\n\t\t\t\tif(defaultNameDefined)\n\t\t\t\t\tdefaultName = defaultNameDefined;\n\t\t\t}\n\n\t\t\tlet constants = this.editorModel.constants;\n\t\t\tlet groupRecord = this._createGroupRecord(quoteModel);\n\t\t\tgroupRecord.Name = defaultName;\n\t\t\tgroupRecord[constants.NUMBER_FIELD] = 1;\n\n\t\t\t// Create a copy of groupRecord to disconnect property values in memory\n\t\t\tgroupRecord = JSON.parse(JSON.stringify(groupRecord));\n\n\t\t\tif (this.eventDetail.customAction.type === 'Solution Group') {\n\t\t\t\tthis._extendSolutionGroupRecord(groupRecord);\n\t\t\t}\n\n\t\t\tquoteModel.lineGroups[0].groupVO = {key: ++quoteModel.quoteVO.nextGroupKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\n\t\t\tif(sb.common.core.AppContext.org.isMultiCurrencyOrg) {\n\t\t\t\tquoteModel.lineGroups[0].groupVO.CurrencyIsoCode = quoteVO.record['CurrencyIsoCode'];\n\t\t\t}\n\n\t\t\tquoteModel.grouped = true;\n\t\t\tquoteVO.lineItemGroups.push(quoteModel.lineGroups[0].groupVO);\n\t\t\tquoteModel.groupsByKey[quoteModel.lineGroups[0].groupVO.key] = quoteModel.lineGroups[0];\n\t\t\tdelete quoteModel.groupsByKey[null];\n\t\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\t\tindexByGroupKey[quoteModel.lineGroups[0].groupVO.key] = {index: Object.keys(indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\n\t\t\tquoteVO.lineItems.forEach(function (line) {\n\t\t\t\tline.parentGroupKey = quoteModel.lineGroups[0].groupVO.key;\n\t\t\t});\n\n\t\t\tthis.onFlagCalculate(true, true);\n\n\t\t\t// update selectedGroupKey to first group's key to render the first group in Single Group View\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis.domHost.set('selectedGroupKey', quoteModel.lineGroups[0].groupVO.key);\n\t\t\t}\n\t\t}\n\t}\n\n\t_ungroupQuote() {\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tquoteModel.indexByGroupKey[null] = {index: 0, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\tquoteModel.grouped = false;\n\t\tlet quoteVO = quoteModel.quoteVO;\n\t\tlet thePrefix = this.data.developerPrefix;\n\t\tlet deletedGroupIds = [];\n\t\t// Clear all groups in the quote\n\t\tif(quoteVO.lineItemGroups.length !== 0) {\n\t\t\tquoteVO.lineItemGroups.forEach((group) => {\n\t\t\t\tif(group.record.Id && deletedGroupIds.indexOf(group.record.Id) === -1)\n\t\t\t\t\tdeletedGroupIds.push(group.record.Id)\n\t\t\t});\n\t\t\t// clearGroups\n\t\t\tquoteVO.lineItemGroups = [];\n\t\t\tquoteVO.deletedGroupIds = deletedGroupIds;\n\t\t\tquoteVO.lineItems.forEach(function (line) {\n\t\t\t\tline.parentGroupKey = null;\n\t\t\t\tline.record[thePrefix + 'Group__c'] = null;\n\t\t\t});\n\t\t}\n\t\tquoteVO.record[thePrefix + 'LineItemsGrouped__c'] = false;\n\n\t\tthis.onFlagCalculate(true, true);\n\n\t\t// Hides the \"Groups\" button that toggles the side panel\n\t\tthis.domHost.rightSideButton = false;\n\t\t// Notifies LEGroupLayout to close the group side panel\n\t\tfireEvent(Events.CLOSE_GROUP_PANEL);\n\n\t\t// update selectedGroupKey to null to render the table/(s) for ungrouped quote in Single Group View\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.domHost.set('groupModels', []); //need this step to make sure it renders correctly after ungrouping a multi-group quote with an empty first group\n\t\t\tthis.domHost.set('selectedGroupKey', null);\n\t\t}\n\t}\n\n\tonResegmentLine() {\n\t\t// Before we do anything else, we should check whether the quote's size exceeds the Large Quote Threshold.\n\t\tlet largeQuoteThreshold = this.editorModel.data.settings.largeQuoteThreshold;\n\t\tlet largeQuoteMsg = this.editorModel.data.customLabels.msg_large_quote_sent_without_lines;\n\t\tif (largeQuoteThreshold != null && (largeQuoteThreshold < this.editorModel.quoteModel.quoteVO.lineItems.length)) {\n\t\t\t// If we exceeded the large quote threshold, we need to send a partial VO instead of a full one. We can provide a\n\t\t\t// filter function to _executeServiceAction() to make sure that unnecessary lines are omitted, but we still\n\t\t\t// need to manually populate extra aggregate data.\n\n\t\t\t// First, we need to define our filter function.\n\t\t\t/**\n\t\t\t * Returns a singleton list consisting solely of the line being resegmented.\n\t\t\t * @callback lineFilterCallback\n\t\t\t * @param {Object} quote A quote whose lines will be filtered\n\t\t\t * @param {Object} serviceModel The service model object containing information about which lines should be kept.\n\t\t\t * @param {Number[]} serviceModel.keys A list of line keys that should be kept\n\t\t\t * @return {[]} An array of the quote lines that must be sent to the server\n\t\t\t */\n\t\t\tlet filterFn = (quote, serviceModel) => {\n\t\t\t\t// We're resegmenting a single line, meaning that serviceModel.keys will be a singleton array.\n\t\t\t\tlet targetKey = serviceModel.keys[0];\n\t\t\t\t// Since we're only looking for one key, there will only be one line. However, we still must return it\n\t\t\t\t// as a singleton list.\n\t\t\t\tlet keptLines = [];\n\t\t\t\tlet lineCount = quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = quote.lineItems[i];\n\t\t\t\t\tif (line.key == targetKey) {\n\t\t\t\t\t\tkeptLines.push(line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn keptLines;\n\t\t\t};\n\t\t\t// Now that we've got a filter function, we need to get MDQ template information. That requires an aggregator\n\t\t\t// and the group key.\n\t\t\tlet groupKey = this.eventDetail.model.lineVO.parentGroupKey;\n\t\t\tlet quoteVO = this.editorModel.quoteModel.quoteVO;\n\t\t\tlet qla = new QuoteLineAggregator(quoteVO);\n\t\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(groupKey);\n\t\t\tquoteVO.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\t\tquoteVO.segmentTemplatesByDimensionTypeByGroupKey[(groupKey || -1) + ''] = templates;\n\t\t\t// Finally, we can't forget to log a message to the console indicating that lines are being skipped.\n\t\t\tlet lineOmissionMsg = largeQuoteMsg\n\t\t\t\t.replace('{0}', quoteVO.record.Id)\n\t\t\t\t.replace('{1}', largeQuoteThreshold);\n\t\t\tconsole.log(lineOmissionMsg);\n\t\t\t// Now that we've defined a function to omit the proper lines, provided the right MDQ template data\n\t\t\t// to the quote, and logged a message indicating what's happening, we can invoke _executeServiceAction().\n\t\t\tthis._executeServiceAction('onResegmentLine', null, filterFn);\n\t\t} else {\n\t\t\t// If we didn't exceed the large quote threshold, we can just invoke _executeServiceAction() as normal.\n\t\t\tthis._executeServiceAction('onResegmentLine');\n\t\t}\n\t}\n\n\t_handleResegmentResponse() {\n\t\t// We should remove the segment template information from the response quote so it doesn't linger around.\n\t\tdelete this.resegmentResponse.segmentTemplatesByDimensionTypeByGroupKey;\n\t\t// We can call this._updateQuote(), which will pass the response to the Line Editor. We need to provide that method\n\t\t// with a callback that it can use to reconcile the original QuoteVO with a partialVO.\n\t\tlet recombineFn = (updatedQuote, originalQuote) => {\n\t\t\t// In this case, all but one of the lines on Updated Quote are going to be new lines representing segments.\n\t\t\t// The other line is going to be the original line that was sent to the server, having been transformed into an MDQ line.\n\t\t\t// To recombine the two lists, we should remove the original version of the line from the list, and append all of the new\n\t\t\t// versions to the list.\n\n\t\t\t// Find the line for the first segment in the updated quote.\n\t\t\tlet firstSegmentKey;\n\t\t\tlet segCount = updatedQuote.lineItems.length;\n\t\t\tlet constants = this.editorModel.constants;\n\t\t\tfor (let i = 0; i < segCount; i++) {\n\t\t\t\tlet line = updatedQuote.lineItems[i];\n\t\t\t\tif (line.record[constants.SEGMENT_INDEX_FIELD] == 1) {\n\t\t\t\t\tfirstSegmentKey = line.key;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet combinedLineList = [];\n\t\t\toriginalQuote.lineItems.forEach((line) => {\n\t\t\t\t// All lines except for the original version of the resegmented line are added to the combined list.\n\t\t\t\tif (line.key !== firstSegmentKey) {\n\t\t\t\t\tcombinedLineList.push(line);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Now we append all of the new quote lines to the end of the list, and set that as our new list.\n\t\t\tcombinedLineList = combinedLineList.concat(updatedQuote.lineItems);\n\t\t\tupdatedQuote.lineItems = combinedLineList;\n\t\t\treturn updatedQuote;\n\t\t};\n\t\tthis.domHost.updateQuote(this.resegmentResponse, recombineFn);\n\t}\n\n\tonDesegmentLine() {\n\t\tlet constants = this.editorModel.constants;\n\t\t/**\n\t\t * @property {String} segmentKey - A key shared by all segments of the MDQ product being segmented.\n\t\t */\n\t\tlet serviceModel = this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null;\n\t\tlet segmentKey = serviceModel.segmentKey;\n\n\t\t// First, we need to find all of the lines in the MDQ product.\n\t\t// We need to do a serialization round-trip in order to avoid updating an in-use model, which would cause\n\t\t// all sorts of issues.\n\t\tlet quote = JSON.parse(JSON.stringify(this.editorModel.quoteModel.quoteVO));\n\t\tlet firstSegmentLine;\n\t\tlet keysToDelete = new Set();\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.record[constants.SEGMENT_KEY_FIELD] === segmentKey) {\n\t\t\t\t// We want to get the object corresponding to the first segment, and we want to get the keys of all the\n\t\t\t\t// other segments so we can delete them.\n\t\t\t\tif (line.record[constants.SEGMENT_INDEX_FIELD] === 1) {\n\t\t\t\t\tfirstSegmentLine = line;\n\t\t\t\t} else {\n\t\t\t\t\tkeysToDelete.add(line.key);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlet transformedLine = this._transformLineToNonSegmentedLine(firstSegmentLine);\n\t\t// If there are other segments, we need to delete those lines.\n\t\tif (keysToDelete.size !== 0) {\n\t\t\tthis._deleteLines(keysToDelete, quote, false);\n\t\t}\n\n\t\t// Create a new line item list, adding the original lines one-at-a-time.\n\t\tlet finalLineList = [];\n\t\t// If the transformed line is a child of something, we need to add it right after its parent.\n\t\tlet lookingForParent = transformedLine.parentItemKey != null;\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.key != transformedLine.key) {\n\t\t\t\tfinalLineList.push(line);\n\t\t\t}\n\t\t\tif (lookingForParent && transformedLine.parentItemKey == line.key) {\n\t\t\t\t// If this line is the parent line of our desegmented line, we also add that line and stop looking for\n\t\t\t\t// a parent.\n\t\t\t\tfinalLineList.push(transformedLine);\n\t\t\t\tlookingForParent = false;\n\t\t\t}\n\t\t});\n\n\t\t// If there was no parent line to look for, we should add the line to the list at the very end.\n\t\tif (transformedLine.parentItemKey == null) {\n\t\t\tfinalLineList.push(transformedLine);\n\t\t}\n\t\tquote.lineItems = finalLineList;\n\t\tquote.calculationRequired = true;\n\t\tthis._updateQuote(quote);\n\t}\n\n\t_deleteLines(keysToDelete, quote, includeSiblingSegments) {\n\t\tlet constants = this.editorModel.constants;\n\t\t// Get the indexes of every line we're deleting, so that we can easily remove them from the line item list later.\n\t\tlet deletedLineIndexes = new Set();\n\t\tlet deletedLineIds = new Set();\n\n\t\t// Add the keys for all related lines i.e. components and sibling MDQ segments\n\t\tlet relatedKeysToDelete = this._getAllRelatedKeys(keysToDelete, includeSiblingSegments);\n\t\tkeysToDelete = new Set([...keysToDelete, ...relatedKeysToDelete]);\n\n\t\tquote.lineItems.forEach((line, index) => {\n\t\t\tif (keysToDelete.has(line.key)) {\n\t\t\t\t// Store the list index for deletion later.\n\t\t\t\tdeletedLineIndexes.add(index);\n\t\t\t\t// Store the ID so we can remove it later.\n\t\t\t\tif (line.record.Id) {\n\t\t\t\t\tdeletedLineIds.add(line.record.Id);\n\t\t\t\t}\n\t\t\t\t// nuke UBP inline changes also\n\t\t\t\tif (AppContext.isManualEditsForUBPEnabled && line.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]) {\n\t\t\t\t\tconst lineOrProdId = this._getLineOrProdId(line.record);\n\t\t\t\t\tconst key = `AppliedUbpChanges_${lineOrProdId}_${line.key}`;\n\t\t\t\t\tdel(key);\n\t\t\t\t}\n\t\t\t\t// If we delete a line from a favorited group, we've changed the structure of the group, and must therefore\n\t\t\t\t// unfavorite the group.\n\t\t\t\tif (line.parentGroup) {\n\t\t\t\t\tline.parentGroup.record[constants.FAVORITE_ID_FIELD] = null;\n\t\t\t\t}\n\t\t\t\t// If the line itself is a favorite, we must remove the favorite ID from the quote's list of favorite IDs\n\t\t\t\tif (line.record[constants.FAVORITE_ID_FIELD] && quote.favoriteIds) {\n\t\t\t\t\tlet favId = line.record[constants.FAVORITE_ID_FIELD];\n\t\t\t\t\tlet newFavIdList = [];\n\t\t\t\t\tquote.favoriteIds.forEach((fId) => {\n\t\t\t\t\t\tif (fId != favId) {\n\t\t\t\t\t\t\tnewFavIdList.push(fId);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tquote.favoriteIds = newFavIdList;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tlet updatedLineList = [];\n\n\t\t// Now that we know the indexes and IDs of all lines we're going to be deleting, we can create a new line item list\n\t\t// without those lines or any references to them.\n\t\tquote.lineItems.forEach(function(line, index) {\n\t\t\t// If the line index isn't one we're supposed to delete...\n\t\t\tif (!deletedLineIndexes.has(index)) {\n\t\t\t\t// Null out the Source ID field if it references a deleted line...\n\t\t\t\tif (deletedLineIds.has(line.record[constants.SOURCE_FIELD])) {\n\t\t\t\t\tline.record[constants.SOURCE_FIELD] = null;\n\t\t\t\t}\n\t\t\t\t// ...And add the line to the new line list.\n\t\t\t\tupdatedLineList.push(line);\n\t\t\t} else {\n\t\t\t\t// Update the group models to ensure changes are reflected in later operations such as reorderLineItems (especially for when Enable Summary Lines is enabled)\n\t\t\t\tlet groupKey = line.parentGroupKey,\n\t\t\t\t\tgroupIndex = this.editorModel.quoteModel.indexByGroupKey[line.parentGroupKey].index;\n\t\t\t\tif (line.record[this.editorModel.constants.SEGMENT_KEY_FIELD]) {\n\t\t\t\t\tlet segmentKey = line.record[this.editorModel.constants.SEGMENT_KEY_FIELD],\n\t\t\t\t\t\tsegmentedLineModel = this.editorModel.quoteModel.lineModelsByKey[line.key];\n\n\t\t\t\t\t// Only MDQ Summary Lines (the one that's rendered on the UI) have a segments array, so we need to check if it's defined first\n\t\t\t\t\tif (segmentedLineModel.segments && segmentedLineModel.segments.length > 0) {\n\t\t\t\t\t\tlet dimType = segmentedLineModel.dimensionType,\n\t\t\t\t\t\t\tsegmentIndex = this.editorModel.quoteModel.indexByGroupKey[groupKey].indexBySegmentKey[segmentKey];\n\t\t\t\t\t\tsegmentedLineModel.segments = [];\n\t\t\t\t\t\t// Deletes the MDQ line from the UI, as the assignment only removes the segments from the data model\n\t\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimType}`, segmentIndex, 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet lineIndex = this.editorModel.quoteModel.indexByGroupKey[groupKey].indexByLineKey[line.key];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.standardLines`, lineIndex, 1);\n\t\t\t\t}\n\t\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t\t}\n\t\t}.bind(this));\n\t\tif(deletedLineIndexes.size > 0) {\n\t\t\t//firing signal to notify table that splicing of the groupModel is complete and the UI can be refreshed.\n\t\t\tfireEvent(Events.LINE_SPLICE_COMPLETE);\n\t\t}\n\t\tquote.lineItems = updatedLineList;\n\t\t// Now we need to combine the deletedLineIds set with the deletedLineIds array on the quoteVO.\n\t\tquote.deletedLineIds = quote.deletedLineIds || [];\n\t\tdeletedLineIds.forEach((id) => {\n\t\t\tquote.deletedLineIds.push(id);\n\t\t});\n\t}\n\n\n\t_transformLineToNonSegmentedLine(line) {\n\t\tlet constants = this.editorModel.constants;\n\n\t\t// Clear out these fields and properties to transform the first segment into a non-MDQ line.\n\t\tline.dimensionType = null;\n\t\tline.record[constants.DIMENSION_ID_FIELD] = null;\n\t\tline.record[constants.DIMENSION_FIELD] = null;\n\t\tline.record[constants.SEGMENT_KEY_FIELD] = null;\n\t\tline.record[constants.SEGMENT_INDEX_FIELD] = null;\n\t\tline.record[constants.SEGMENT_LABEL_FIELD] = null;\n\t\tline.record[constants.START_DATE_FIELD] = null;\n\t\tline.record[constants.END_DATE_FIELD] = null;\n\n\t\t// Respect the line's BundledQuantity.\n\t\tlet optionType = line.record[constants.OPTION_TYPE_FIELD];\n\t\tif (optionType && (optionType.toLowerCase() === 'component')) {\n\t\t\tline.record[constants.BUNDLED_QUANTITY_FIELD] = getActualQuantity(line);\n\t\t} else if (optionType && (optionType.toLowerCase() === 'accessory')) {\n\t\t\tline.record[constants.BUNDLED_QUANTITY_FIELD] = line.record[constants.QUANTITY_FIELD];\n\t\t}\n\t\treturn line;\n\n\t\tfunction getActualQuantity(line) {\n\t\t\tif (line.actualQuantity != null) {\n\t\t\t\treturn line.actualQuantity;\n\t\t\t}\n\t\t\tlet qty = line.record[constants.QUANTITY_FIELD];\n\t\t\tlet priorQty = line.record[constants.PRIOR_QUANTITY_FIELD] || 0;\n\t\t\tlet upgradedQty = line.record[constants.UPGRADED_QUANTITY] || 0;\n\n\t\t\treturn line.record[constants.EXISTING_FIELD] || line.record[constants.CARRYOVER_LINE_FIELD] ? qty - priorQty + upgradedQty : qty;\n\t\t}\n\t}\n\n// Quote/Group Actions\n\n\tonResetDiscounts() {\n\t\tthis.editorModel.quoteModel.resetDiscounts(this.eventDetail.model.groupKey);\n\t}\n\n\tupdateLineOptional() {\n\t\tlet groupKey;\n\t\tif (this.eventDetail.model.groupKey) {\n\t\t\tgroupKey = this.eventDetail.model.groupKey;\n\t\t}\n\t\tthis.editorModel.quoteModel.allOptional = this.eventDetail.customAction.caClass === 'optionalAllBtn';\n\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\tthis.notifyPath('editorModel.quoteModel.allOptional', this.editorModel.quoteModel.allOptional);\n\t\tfireEvent(Events.TOGGLE_OPTIONAL_CLICKED, { toggleOptionalBoolean: this.editorModel.quoteModel.allOptional, groupKey: groupKey });\n\t}\n\n\tonUpgradeAssets() {\n\t\tthis._navigateToLookup('asset');\n\t}\n\n\tonRenewSubscriptions() {\n\t\tthis._navigateToLookup('subscription');\n\t}\n\n\tonAmendSubscriptions() {\n\t\tthis._navigateToLookup('subscription');\n\t}\n\n// Group Actions\n\n\tonCloneGroup() {\n\t\tthis.$.showSpinner = true;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet groupKey = this.eventDetail.model.serviceModel.keys[0];\n\t\tthis._cloneGroup(quoteModel, groupKey);\n\t\t// Delete the model so that the legacy calculator will send just the quote VO if enabled.\n\t\tdelete this.eventDetail.model;\n\t\tthis.onFlagCalculate(true, false);\n\t}\n\n\t_cloneGroup(quoteModel, groupKey) {\n\t\tlet groupModel = quoteModel.groupsByKey[groupKey];\n\t\tif(groupModel) {\n\t\t\tthis._addGroup(groupModel.groupVO);\n\t\t\tlet newGroup = quoteModel.groupsByKey[quoteModel.quoteVO.nextGroupKey - 1];\n\n\t\t\tif(newGroup) {\n\t\t\t\tlet linesInOtherGroupKey = new Set();\n\t\t\t\tlet allStandardLinesMap = groupModel.quoteModel.lineModelsByKey;\n\t\t\t\tfor(let key in allStandardLinesMap) {\n\t\t\t\t\tif(allStandardLinesMap.hasOwnProperty(key)) {\n\t\t\t\t\t\tif(!allStandardLinesMap[key].lineVO.parentItemKey && allStandardLinesMap[key].lineVO.parentGroupKey != groupKey) {\n\t\t\t\t\t\t\t// This is the collection of all line keys have no parent line and in a different group\n\t\t\t\t\t\t\tlinesInOtherGroupKey.add(allStandardLinesMap[key].lineVO.key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// For mdq items\n\t\t\t\tgroupModel.segmentedLines.forEach((originalLine) => {\n\t\t\t\t\tlet rootPackage = null;\n\t\t\t\t\t// A mdq's parent line is not in the target group\n\t\t\t\t\tif(originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// Check whether this mdq is part of a bundle whose root is in another group.\n\t\t\t\t\t\trootPackage = this._getRootPackage(allStandardLinesMap[originalLine.lineVO.parentItemKey], allStandardLinesMap);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the mdq's parent is in another group, the mdq is cloned by it's parent\n\t\t\t\t\tif(rootPackage && linesInOtherGroupKey.has(rootPackage.lineVO.key)) {\n\t\t\t\t\t\tthis._cloneLine(rootPackage, newGroup);\n\t\t\t\t\t} else if(!originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// When the mdq is a standalone, clone it.\n\t\t\t\t\t\tthis._cloneLine(originalLine, newGroup);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tgroupModel.standardLines.forEach((originalLine) => {\n\t\t\t\t\tif (!originalLine.lineVO.key) return; // Skip lines with undefined keys (ie. summary and subtotal rows when large quote experience is enabled)\n\t\t\t\t\tlet rootPackage = null;\n\t\t\t\t\t// A component's parent line is not in the target group\n\t\t\t\t\tif(originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// Check whether this component is part of a bundle whose root is in another group.\n\t\t\t\t\t\trootPackage = this._getRootPackage(allStandardLinesMap[originalLine.lineVO.parentItemKey], allStandardLinesMap);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(rootPackage && linesInOtherGroupKey.has(rootPackage.lineVO.key)) {\n\t\t\t\t\t\tthis._cloneLine(rootPackage, newGroup);\n\t\t\t\t\t} else if(!originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// When parent line is in the target group, send the parent line to clone the bundle.\n\t\t\t\t\t\tthis._cloneLine(originalLine, newGroup);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_getRootPackage(component, allStandardLinesMap) {\n\t\tif(component.lineVO.parentItemKey) {\n\t\t\treturn this._getRootPackage(allStandardLinesMap[component.lineVO.parentItemKey], allStandardLinesMap);\n\t\t} else {\n\t\t\treturn component;\n\t\t}\n\t}\n\n\tonDeleteGroup() {\n\t\tif (this.editorModel.quoteModel.isAmendmentOrChangeQuote && !this.eventDetail.model.canDelete()) {\n\t\t\tthis.domHost.errors = [this.domHost.i18n.l('msg_cannot_delete_group')];\n\t\t\treturn;\n\t\t}\n\n\t\tif (confirm(this.domHost.i18n.l('msg_confirm_group_delete'))) {\n\t\t\tthis._deleteGroup();\n\t\t}\n\t}\n\n\t_deleteGroup() {\n\t\tlet groupKey = this.eventDetail.model.serviceModel.keys[0];\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\n\t\t// This is for onFlagCalculate function.\n\t\t// When using legacy calculator,\n\t\t// set eventDetail model to undefined so in _executeServiceAction can generate correct JSON.\n\t\t// The _executeServiceAction is run only when it's using legacy calculator in onFlagCalculate function.\n\t\tthis.eventDetail.model = undefined;\n\n\t\tif (quoteModel.groupsByKey != null) {\n\t\t\tthis._removeGroup(quoteModel, groupKey);\n\t\t\tthis.onFlagCalculate(true, true);\n\t\t\tthis._updateQuote(quoteModel.quoteVO);\n\n\t\t\t// Close panel when number of groups is reduced to one because there is no side panel in that case\n\t\t\tif (quoteModel.lineGroups.length == 1) {\n\t\t\t\tfireEvent(Events.CLOSE_GROUP_PANEL);\n\t\t\t}\n\n\t\t\t// update selectedGroupKey to first group's key to render the first group in Single Group View\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled && quoteModel.lineGroups[0]) {\n\t\t\t\tfireEvent(Events.GROUP_DELETED, { groupKey: quoteModel.lineGroups[0].groupKey });\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeGroup(quoteModel, groupKey) {\n\t\t// Check to make sure no components are deleted unless the parent is also deleted\n\t\tlet removeGroup = true;\n\t\tlet parentItemKeys = new Set();\n\t\tif(quoteModel.quoteVO.lineItems.length > 0) {\n\t\t\t// Get the all the parents from the lines in the target group,\n\t\t\t// then use the collection to make sure the parents are also in the target group.\n\t\t\t// The lines can only be deleted when the parents and the lines are in the target group.\n\t\t\tquoteModel.quoteVO.lineItems.forEach(function (lineItem) {\n\t\t\t\tif (lineItem.parentItemKey && lineItem.parentGroupKey == groupKey) {\n\t\t\t\t\tparentItemKeys.add(lineItem.parentItemKey);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tquoteModel.quoteVO.lineItems.forEach(function (lineItem) {\n\t\t\t\tif (lineItem.parentGroupKey != groupKey && parentItemKeys.has(lineItem.key)) {\n\t\t\t\t\t// Do not delete the group\n\t\t\t\t\tremoveGroup = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (removeGroup) {\n\t\t\t\tlet deletedLineIds = new Set();\n\t\t\t\t// Create a new line list consisting of only lines not in the target group\n\t\t\t\tlet newLines = [];\n\t\t\t\tquoteModel.quoteVO.lineItems.forEach((line) => {\n\t\t\t\t\tif (line.parentGroupKey != groupKey) {\n\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t} else if (line.record.Id && !deletedLineIds.has(line.record.Id)) {\n\t\t\t\t\t\tdeletedLineIds.add(line.record.Id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnewLines.forEach((line) => {\n\t\t\t\t\tif (deletedLineIds.has(line.record[this.editorModel.constants.SOURCE_FIELD])) {\n\t\t\t\t\t\tline.record[this.editorModel.constants.SOURCE_FIELD] = null;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tquoteModel.quoteVO.deletedLineIds = quoteModel.quoteVO.deletedLineIds.concat(...deletedLineIds);\n\t\t\t\tquoteModel.quoteVO.lineItems = newLines;\n\t\t\t}\n\t\t}\n\n\t\tif(removeGroup) {\n\t\t\t// Create a new line item group list consisting of only line item groups not in the target group\n\t\t\tlet newlineItemGroups = [];\n\t\t\tlet deletedGroupIds = [];\n\t\t\tquoteModel.quoteVO.lineItemGroups.forEach((ligroup) => {\n\t\t\t\tif (ligroup.key != groupKey) {\n\t\t\t\t\tnewlineItemGroups.push(ligroup);\n\t\t\t\t} else if (ligroup.record.Id && deletedGroupIds.indexOf(ligroup.record.Id) == -1) {\n\t\t\t\t\tdeletedGroupIds.push(ligroup.record.Id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tquoteModel.quoteVO.lineItemGroups = newlineItemGroups;\n\t\t\tquoteModel.quoteVO.deletedGroupIds = quoteModel.quoteVO.deletedGroupIds.concat(deletedGroupIds);\n\n\t\t\t// Create a new line group list consisting of only line groups without the deleted group\n\t\t\tlet newlineGroups = [];\n\t\t\tlet idx = -1;\n\t\t\tquoteModel.lineGroups.forEach((lgroup, index) => {\n\t\t\t\t// skip the deleted group\n\t\t\t\tif (lgroup.groupKey != groupKey) {\n\t\t\t\t\tnewlineGroups.push(lgroup);\n\t\t\t\t} else {\n\t\t\t\t\t// grab the index of the deleted group so we can splice it from the groupModels\n\t\t\t\t\tidx = index;\n\t\t\t\t}\n\t\t\t});\n\t\t\tquoteModel.lineGroups = newlineGroups;\n\n\t\t\tdelete quoteModel.groupsByKey[groupKey];\n\t\t\tdelete quoteModel.indexByGroupKey[groupKey];\n\n\t\t\t// fix for W-6128792 - splice the groupModels so that dom-repeat in sb-line-editor won't get confused\n\t\t\tif (idx > -1) {\n\t\t\t\tthis.domHost.splice('groupModels', idx, 1);\n\t\t\t\tPolymer.dom.flush();\n\t\t\t}\n\t\t}\n\t}\n\n// Line Actions\n\n\tonReconfigureLine() {\n\t\tlet params = {\n\t\t\tlineKey: this.eventDetail.model.lineVO.key,\n\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\tignoreCache: true\n\t\t};\n\t\t// Pass in the group key when quote is grouped, in order to make sure that any satisfied product rules add new lines\n\t\t// to the correct group.\n\t\tif (this.eventDetail.model.groupModel.quoteModel.grouped) {\n\t\t\tparams.groupKey = this.eventDetail.model.groupModel.groupKey;\n\t\t}\n\t\tNavigator.nav('#', params, ['product', 'pc'], false, this);\n\t}\n\n\tonAddToFavorites() {\n\t\tthis._openDialog('favDialog');\n\t}\n\n\n\tonViewPricingGuidance(){\n\t\tthis._openPricingGuidanceDialog('pricingGuidanceDialog');\n\t}\n\n\t/**\n\t * Action handler for viewing consumption schedule\n\t */\n\tonViewConsumptionSchedule() {\n\t\tthis.fire('toggle-ubp-editor', {\n\t\t\tlineModel: this.eventDetail.model,\n\t\t\tvisible: true\n\t\t});\n\t}\n\n\tonRemoveFromFavorites() {\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tif (!confirm(this.domHost.i18n.l('msg_confirm_remove_favorite')))\n\t\t\t\treturn;\n\t\t} else {\n\t\t\tif (!confirm(this.domHost.i18n.l('msg_confirm_remove_group_from_favorites')))\n\t\t\t\treturn;\n\t\t}\n\t\tthis._executeQuotelessServiceAction('onRemoveFromFavorites');\n\t}\n\n\t_onAcceptPricingGuidance() {\n\t\tif (this.eventDetail &&\n\t\t\tthis.eventDetail.model &&\n\t\t\tthis.eventDetail.model.lineVO &&\n\t\t\tthis.eventDetail.model.lineVO.record &&\n\t\t\tthis.eventDetail.model.lineVO.quoteLinePricingGuidance &&\n\t\t\tthis.eventDetail.model.lineVO.quoteLinePricingGuidance.record &&\n\t\t\tthis.eventDetail.model.groupModel &&\n\t\t\tthis.eventDetail.model.groupModel.quoteModel &&\n\t\t\tthis.eventDetail.model.groupModel.quoteModel.quoteVO &&\n\t\t\tthis.eventDetail.model.groupModel.quoteModel.quoteVO.lineItems) {\n\t\t\tlet currentLineVO = this.eventDetail.model.lineVO;\n\t\t\tlet currentLineVORecord = currentLineVO.record;\n\t\t\tlet devPrefix = this.data.developerPrefix;\n\t\t\tlet targetDiscountPercentage = currentLineVO.quoteLinePricingGuidance.record[devPrefix + \"Target__c\"];\n\n\t\t\tlet calculate = false;\n\t\t\tlet productKey = devPrefix + \"Product__c\";\n\t\t\tlet currentProductId = currentLineVORecord[productKey];\n\t\t\tlet discountKey = devPrefix + \"Discount__c\";\n\t\t\tlet additionalDiscountAmountKey = devPrefix + \"AdditionalDiscountAmount__c\";\n\t\t\tlet quoteKey = devPrefix + \"Quote__c\";\n\t\t\tlet lineItems = this.eventDetail.model.groupModel.quoteModel.quoteVO.lineItems;\n\t\t\tfor (let i = 0; i < lineItems.length; i++) {\n\t\t\t\tlet lineItemsRecord = lineItems[i].record;\n\t\t\t\tif (lineItemsRecord[productKey] === currentProductId && lineItems[i].quoteLinePricingGuidance) {\n\t\t\t\t\tlet previousDiscount = lineItemsRecord[discountKey];\n\t\t\t\t\t// Sanity check on additionalDiscountAmount to ensure that the user doesn't try to set both\n\t\t\t\t\t// Discount__c (%) and AdditionalDiscountAmount__c at the same time.\n\t\t\t\t\tif (previousDiscount !== targetDiscountPercentage ||\n\t\t\t\t\t\tlineItemsRecord[additionalDiscountAmountKey] != null) {\n\t\t\t\t\t\tlineItemsRecord[discountKey] = targetDiscountPercentage;\n\t\t\t\t\t\tlineItemsRecord[additionalDiscountAmountKey] = null;\n\t\t\t\t\t\tcalculate = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (calculate) {\n\t\t\t\tthis.onFlagCalculate(true, false);\n\t\t\t}\n\t\t\tnew AppLogger().log(currentLineVORecord[quoteKey], LOG_TYPE.PRICING_GUIDANCE, JSON.stringify({pricingGuidanceAction: \"Accepted\"}));\n\t\t}\n\t}\n\n\t/**\n\t * Executed after the dual-list-box component sends back the selected groups, takes each selected line and clones into the group selected\n\t * @private\n\t * @param e - Object, the event containing the selected groups sent from the dual-list-box component\n\t */\n\t_cloneToGroup(e) {\n\t\tlet selectedGroups = e.detail;\n\t\tif (selectedGroups.length === 0)\n\t\t\treturn;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet constants = this.editorModel.constants;\n\t\tlet lineEditor = this.domHost;\n\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\tfor (let lineKey in this.selectedLinesByKey) {\n\t\t\tlet originalLine = this.selectedLinesByKey[lineKey];\n\t\t\tfor (let i = 0, l = selectedGroups.length; i < l; i++) {\n\t\t\t\t// The value of the selected group is the groupKey\n\t\t\t\tlet groupModel = quoteModel.groupsByKey[selectedGroups[i].value];\n\t\t\t\tthis._cloneLine(originalLine, groupModel);\n\t\t\t}\n\t\t\tlet indexes = indexByGroupKey[originalLine.lineVO.parentGroupKey];\n\t\t\tlet groupIndex = indexes.index;\n\t\t\tlet lineIndex = originalLine.segmented ? indexes.indexBySegmentKey[originalLine.lineVO.record[constants.SEGMENT_KEY_FIELD]] : indexes.indexByLineKey[lineKey];\n\t\t\tthis._clearSelectedCheckbox(lineIndex, groupIndex, lineEditor, originalLine.lineVO.dimensionType);\n\t\t}\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tfor (let j = 0, len = selectedGroups.length; j < len; j++) {\n\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: selectedGroups[j].value });\n\t\t\t}\n\t\t}\n\t\tthis.onFlagCalculate(true, false);\n\t}\n\n\t_clearSelectedCheckbox(lineIndex, groupIndex, emitter, dimension) {\n\t\tif (dimension) {\n\t\t\temitter.set(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimension}.${lineIndex}.selected`, false);\n\t\t} else {\n\t\t\temitter.set(`groupModels.${groupIndex}.standardLines.${lineIndex}.selected`, false);\n\t\t}\n\t}\n\n\t/**\n\t * Clones line items\n\t * @private\n\t * cloneLines and clonedSegmentedLines are holding arrays used to keep a list of the lines that need to be cloned\n\t */\n\tonCloneLine() {\n\t\t// Check if current line is selected there are multiple lines selected\n\t\t// else call cloneLine\n\t\tlet originalLine = this.eventDetail.model;\n\t\tif (originalLine.selected && this.editorModel.quoteModel.grouped) {\n\t\t\tthis.selectedLinesByKey = this.editorModel.quoteModel.selectedLinesByKey;\n\n\t\t\tlet cloneToGroupDialog = this.$.cloneToGroupDialog;\n\t\t\tcloneToGroupDialog.quoteModel = this.editorModel.quoteModel;\n\n\t\t\tcloneToGroupDialog.open();\n\t\t\treturn;\n\t\t}\n\t\tthis.showSpinner = true;\n\t\tconst callback = () => { this.showSpinner = false; };\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tif (this.editorModel.data.settings.caPlugin) {\n\t\t\t\tlet lineKeys = {};\n\t\t\t\tlineKeys.originalLines = this._getOriginalLineKeys(originalLine);\n\t\t\t\tthis.callPlugin('onBeforeCloneLine', lineKeys)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tlet clonedLines = this._cloneLine(originalLine);\n\t\t\t\t\t\tlineKeys.clonedLines = this._getClonedLineKeys(clonedLines);\n\t\t\t\t\t\treturn this.callPlugin('onAfterCloneLine', lineKeys);\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tdelete this.eventDetail.model;\n\t\t\t\t\t\tthis.onFlagCalculate(true, false, callback);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._cloneLine(originalLine);\n\t\t\t\t// We need to delete the event detail model, in order to make sure that flag calculating will send just the quote VO\n\t\t\t\t// when the legacy calculator is enabled.\n\t\t\t\tdelete this.eventDetail.model;\n\t\t\t\tthis.onFlagCalculate(true, false, callback);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Creates a JSQC instance and executes the custom action plugin actions\n\t * @param methodName custom action plugin method name (ie. 'onBeforeCloneLine)\n\t * @param lineKeys map of keys\n\t * @returns {Promise} Resolves when the plugin completes\n\t */\n\tcallPlugin(methodName, lineKeys) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (SB && SB.JSQC) {\n\t\t\t\tlet client = new ConnectionClient(this.app.org.prefix);\n\t\t\t\tthis.notifier = !this.data.quote.calculationRequired && this.domHost.editorModel ? new JSQCNotifier(this.domHost) : null;\n\t\t\t\tlet qc = new SB.JSQC(this.data.settings, this.data.quote, this.notifier);\n\t\t\t\tlet connectionPromiseArray = [client.getConnection(), client.getConnection()];\n\t\t\t\tPromise.all(connectionPromiseArray).then((connections) => {\n\t\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\t\tlet promise = qc.onCallCAPlugin(methodName, lineKeys);\n\t\t\t\t\tpromise.then((successQuote) => {\n\t\t\t\t\t\tthis.updateUIAfterCalculate(successQuote);\n\t\t\t\t\t\tthis.showSpinner = false;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\tthis.showSpinner = false;\n\t\t\t\t\t\tlet errMessage = err.message || err;\n\t\t\t\t\t\tthis.domHost.errors = [this.domHost.i18n.l(errMessage)];\n\t\t\t\t\t\treject({message: errMessage});\n\t\t\t\t\t});\n\t\t\t\t}, (err) => {\n\t\t\t\t\tthis.showSpinner = false;\n\t\t\t\t\tlet errMessage = err.message || err;\n\t\t\t\t\tthis.domHost.errors = [this.domHost.i18n.l(errMessage)];\n\t\t\t\t\treject({message: errMessage});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treject({message: \"ERROR: Could not find the Client-Side Calculator\"});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Retrieves the list of line keys to clone - keys for individual segments for mdq products and all component lines for bundle parent lines\n\t * @param originalLine line that the clone action is clicked on\n\t * @param parentItemKey unique identifier (lineKey) for bundle-parent relationship\n\t * @param lines list of line keys\n\t * @returns {*|Array} lineKeys array\n\t * @private\n\t */\n\t_getOriginalLineKeys(originalLine, parentItemKey, lineKeys) {\n\t\tlineKeys = lineKeys || {};\n\t\tif (originalLine.segmented) {\n\t\t\tif (!lineKeys.segmented)\n\t\t\t\tlineKeys.segmented = {};\n\t\t\tlet dimension = originalLine.dimensionType;\n\t\t\tif (!lineKeys.segmented[dimension])\n\t\t\t\tlineKeys.segmented[dimension] = [];\n\t\t\tfor (let i = 0 ; i < originalLine.segments.length; i++) {\n\t\t\t\tlineKeys.segmented[dimension].push(originalLine.segments[i].lineVO.key);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!lineKeys.standard)\n\t\t\t\tlineKeys.standard = [];\n\t\t\tlineKeys.standard.push(originalLine.lineVO.key);\n\t\t\tlet components = this.editorModel.quoteModel.linesByParentItemKey[originalLine.lineVO.key]; // get components, if this is a bundle line\n\t\t\tif (components) {\n\t\t\t\tfor (let i = 0, l = components.length; i < l; i++) {\n\t\t\t\t\tlineKeys = this._getOriginalLineKeys(components[i], components[i].lineVO.key, lineKeys);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn lineKeys;\n\t}\n\n\t/**\n\t * Creates an obj that holds the keys of standard (flattened component lines) and individual segments to be consumed by the custom action plugin methods\n\t * @param clonedLines obj that holds cloned standard and segmented summary line keys\n\t * @returns {{}} lineKeys object {standard:[], segmented: {'Year': [], 'Quarter': []}}\n\t * @private\n\t */\n\t_getClonedLineKeys(clonedLines){\n\t\tlet lineKeys = {};\n\t\tlineKeys.standard = [];\n\t\tfor (let i = 0; i < clonedLines.standard.length; i++) {\n\t\t\tlineKeys.standard.push(clonedLines.standard[i].lineVO.key)\n\t\t}\n\t\t// flatten segmented lines for each dimension so the plugin consumes the segments not the segmented summary lines\n\t\tlineKeys.segmented = {};\n\t\tfor (let dimension in clonedLines.segmented) {\n\t\t\tif (clonedLines.segmented.hasOwnProperty(dimension)) {\n\t\t\t\tif (!lineKeys.segmented[dimension])\n\t\t\t\t\tlineKeys.segmented[dimension] = [];\n\t\t\t\tlet segmentedSummaryLines = clonedLines.segmented[dimension].lines;\n\t\t\t\tfor (let j = 0 ; j < segmentedSummaryLines.length; j++)  {\n\t\t\t\t\tlet segmentedSummaryLine = segmentedSummaryLines[j];\n\t\t\t\t\tfor (let k = 0 ; k < segmentedSummaryLine.segments.length; k++)  {\n\t\t\t\t\t\tlineKeys.segmented[dimension].push(segmentedSummaryLine.segments[k].lineVO.key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn lineKeys;\n\t}\n\n\t_cloneLine(line, groupSelected) {\n\t\tlet clonedLines = []; // list of cloned standard lines\n\t\tlet clonedSegmentedLines = {Year: {lines: []}, Quarter: {lines: []}, Month: {lines: []}, Custom: {lines: []}}; // list of cloned segmented summary lines by dimension\n\t\tlet groupModels = this.domHost.groupModels;\n\t\tlet groupKey = groupSelected ? groupSelected.groupKey : line.lineVO.parentGroupKey;\n\t\tlet groupIndex = groupKey ? this.editorModel.quoteModel.indexByGroupKey[groupKey].index : 0;\n\n\t\t/**\n\t\t * Recursively populates the clonedLines and clonedSegmentedLines arrays that hold cloned line models\n\t\t * @param line - lineModel, will either be the standard line being cloned and if bundle first is the parent line of the bundle then recursively called for each option that belongs to the bundle\n\t\t * @param parentItemKey - unique identifier that establishes the link between bundle and component line\n\t\t * @param clonedLines - array that holds cloned standard lines\n\t\t * @param clonedSegmentedLines - array that holds clones segmented lines\n\t\t * @private\n\t\t */\n\t\tconst _addParentAndAllChildLineItems = (line, parentItemKey) => {\n\t\t\tlet clone;\n\t\t\tif (line.segmented) {\n\t\t\t\tclone = groupModels[groupIndex].cloneSegmentedLine(line, parentItemKey, groupSelected);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].lines.push(clone);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].key = line.lineVO.key;\n\t\t\t} else {\n\t\t\t\tclone = groupModels[groupIndex].cloneLine(line, parentItemKey, groupSelected);\n\t\t\t\tclonedLines.push(clone);\n\t\t\t}\n\t\t\tgroupModels[groupIndex].addToLinesByParentItemKey(clone); // update linesByParentItemKey map for the new bundle\n\n\t\t\t// if line is a bundle, execute this method for each component recursively\n\t\t\tif (line.bundle) {\n\t\t\t\tif (groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key]) {\n\t\t\t\t\tlet components = groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key];\n\t\t\t\t\tfor (let i = 0, l = components.length; i < l; i++) {\n\t\t\t\t\t\t_addParentAndAllChildLineItems(components[i], clone.lineVO.key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned standard lines into the group's standardLines array and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedLines - the holding array containing the lines that need to be cloned, will be spliced into groupModel.standardLines\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tconst _addClonedLines = () => {\n\t\t\tlet standardLinesLength = groupModels[groupIndex].standardLines.length;\n\t\t\tif (clonedLines.length > 0) {\n\t\t\t\t// find the index of the original line within the group\n\t\t\t\tlet idx;\n\t\t\t\tlet i,\n\t\t\t\t\tlen = groupModels[groupIndex].standardLines.length;\n\t\t\t\t// if clone to group is invoking this method, set the index to the end of the group\n\t\t\t\t// else find the index to insert it at\n\t\t\t\tif (groupSelected) {\n\t\t\t\t\tidx = len;\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tif (line.lineVO.key === groupModels[groupIndex].standardLines[i].lineVO.key) {\n\t\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// if the original line is a bundle, increment the index until we reach a non-component item\n\t\t\t\tif (line.bundle) {\n\t\t\t\t\tif (!this.editorModel.data.settings.bundleKeptTogether) {\n\t\t\t\t\t\tidx = len;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let j = i; j < len; j++) {\n\t\t\t\t\t\t\tif (!groupModels[groupIndex].standardLines[j].component && groupModels[groupIndex].standardLines[j].lineVO.key !== line.lineVO.key) {\n\t\t\t\t\t\t\t\tidx = j;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else { // Assign idx to end of groupModel.standardLines in case bundle is indexed at the end to avoid idx not getting set, will be overridden by the above if assignment in case the bundle is not at the end of the array\n\t\t\t\t\t\t\t\tidx = len;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// add cloned lines to the standardLines array of the group and the lineVO's to the quoteVO\n\t\t\t\tfor (let k = 0, l = clonedLines.length; k < l; k++) {\n\t\t\t\t\tlet clonedLine = clonedLines[k];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.standardLines`, idx, 0, clonedLine);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(clonedLine.lineVO);\n\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[clonedLine.lineVO.key] = clonedLine;\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\n\t\t\t\tif (this.editorModel.deviceContext.isMobile && standardLinesLength === 0) {\n\t\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: groupSelected.groupKey });\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned segmented lines into the group's segmentedLinesByDimension array it should belong in and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedSegmentedLines - the holding array containing the lines that need to be cloned, will be spliced into the dimensionType on segmentedLinesByDimension\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tconst _addClonedSegmentedLines = () => {\n\t\t\tfor (let dimension in clonedSegmentedLines) {\n\t\t\t\tif (!(clonedSegmentedLines[dimension].lines.length > 0)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet idx = 0;\n\t\t\t\tlet segmentedLinesToSplice = clonedSegmentedLines[dimension].lines;\n\t\t\t\tlet segmentedLines = groupModels[groupIndex].segmentedLinesByDimension[dimension];\n\t\t\t\tlet segmentedLinesLength = segmentedLines.length; // used to check if we need to destroy tabs for clone to group\n\t\t\t\tlet lastSegmentedLineKey = clonedSegmentedLines[dimension].key;\n\t\t\t\t// if clone to group is invoking this method, set the index to the end of the segmented lines table for the group\n\t\t\t\t// else find the index to insert it at\n\t\t\t\tif (groupSelected) {\n\t\t\t\t\tidx = segmentedLinesLength;\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, l = segmentedLines.length; i < l; i++) {\n\t\t\t\t\t\tif (segmentedLines[i].lineVO.key === lastSegmentedLineKey) {\n\t\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let j = 0, len = segmentedLinesToSplice.length; j < len; j++) {\n\t\t\t\t\tlet segmentedLineModelToSplice = segmentedLinesToSplice[j];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimension}`, idx + j, 0, segmentedLineModelToSplice);\n\t\t\t\t\t// Need to push it in the segmentsLines array as well because the segmentLines are being used in the delete lines @ Quote level\n\t\t\t\t\tthis.domHost.push(`groupModels.${groupIndex}.segmentedLines`, segmentedLineModelToSplice);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tfor (let k = 0; k < segmentedLineModelToSplice.segments.length; k++) {\n\t\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(segmentedLineModelToSplice.segments[k].lineVO);\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[k].lineVO.key] = segmentedLineModelToSplice.segments[k];\n\t\t\t\t\t}\n\t\t\t\t\tif (segmentedLineModelToSplice.segments.length > 0) {\n\t\t\t\t\t\t// set segments and dimensionType of the first segment only\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[0].lineVO.key].segments = segmentedLineModelToSplice.segments;\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[0].lineVO.key].dimensionType = segmentedLineModelToSplice.dimensionType;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (segmentedLinesLength === 0) {\n\t\t\t\t\tfireEvent(Events.RENDER_NEW_TAB, { groupKey: groupSelected.groupKey });\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Clone update rates from the original line to the cloned line(s)\n\t\t * @param clonedLines - the holding array containing the lines that nesed to be cloned, will be spliced into groupModel.standardLines\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tconst _cloneUpdatedRates = () =>\n\t\t{\n\t\t\t// issue when saving, modified lines get reverted to source line values\n\t\t\tif (AppContext.isManualEditsForUBPEnabled && line.lineVO.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]) {\n\t\t\t\t// get the updated rates from the original line\n\t\t\t\tconst lineOrProdId = this._getLineOrProdId(line.lineVO.record);\n\t\t\t\tconst key = `AppliedUbpChanges_${lineOrProdId}_${line.lineVO.key}`;\n\t\t\t\tconst appliedChanges = get(key, ['rates']);\n\t\t\t\t// if there are updated rates, clone those too\n\t\t\t\tif (appliedChanges) {\n\t\t\t\t\tfor (let clonedLine of clonedLines) {\n\t\t\t\t\t\tconst clonedLineOrProdId = this._getLineOrProdId(clonedLine.lineVO.record);\n\t\t\t\t\t\tconst clonedLineKey = `AppliedUbpChanges_${clonedLineOrProdId}_${clonedLine.lineVO.key}`;\n\t\t\t\t\t\tput(clonedLineKey, ['rates'], Util.deepClone(appliedChanges));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t_addParentAndAllChildLineItems(line);\n\t\t_addClonedLines();\n\t\t_addClonedSegmentedLines();\n\t\t_cloneUpdatedRates();\n\n\t\tthis.domHost.renumber();\n\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\n\t\t// return the list of cloned lines for further processing in the plugin\n\t\treturn {standard: clonedLines, segmented: clonedSegmentedLines};\n\t}\n\n\n// Helper functions\n\n\t_usesClientCalculator() {\n\t\treturn this.data.settings.usesClientCalculator;\n\t}\n\n\t_jsqcCalculate(showSpinner) {\n\t\t// Prevents this showSpinner from overriding showSpinner initiated by a save\n\t\tthis.showSpinner = showSpinner || showSpinner == null ? true : this.showSpinner;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (SB && SB.JSQC) {\n\t\t\t\tlet res = {};\n\t\t\t\tlet settings = this.data.settings;\n\t\t\t\tlet client = new ConnectionClient(this.app.org.prefix);\n\t\t\t\tthis.notifier = !this.data.quote.calculationRequired && this.domHost.editorModel ? new JSQCNotifier(this.domHost) : null;\n\t\t\t\tsettings.displayedLookupMap = this.getDisplayedLookupNames(this.data);\n\t\t\t\tlet mdqHelper = this.editorModel ? new MDQSegmentHelper(this.data, this.editorModel.quoteModel.groupsByKey) : new MDQSegmentHelper(this.data, null);\n\t\t\t\tconst segmentsChanged = mdqHelper.updateSegments();\n\t\t\t\tif (segmentsChanged && !this.data.quote.calculationRequired) {\n\t\t\t\t\tres.updateQuoteRequired = true;\n\t\t\t\t\tthis.notifier = null;\n\t\t\t\t}\n\t\t\t\tlet qc = new SB.JSQC(settings, this.data.quote, this.notifier);\n\t\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\t\tlet connectionPromiseArray = [client.getConnection(), client.getConnection()];\n\t\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\t\tqc.initServices(connections[0]);\n\t\t\t\t\tlet promise = qc.onCalc();\n\t\t\t\t\tpromise.then(function(successQuote) {\n\t\t\t\t\t\tres.value = successQuote;\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\treject({message: \"ERROR: Could not find the Client-Side Calculator\"});\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetDisplayedLookupNames(data) {\n\t\tlet results = {'line': [], 'group': [], 'quote': []};\n\n\t\t// Retrieve lookup objects and convert to array so we can cycle through and replace the fields with their relationship fields\n\t\tlet lineFields = (data.settings.lineLookups) ? Object.keys(data.settings.lineLookups) : [];\n\t\tlet groupFields = (data.settings.groupLookups) ? Object.keys(data.settings.groupLookups) : [];\n\t\tlet quoteFields = (data.settings.quoteLookups) ? Object.keys(data.settings.quoteLookups) : [];\n\n\t\tlineFields.forEach(function (field) {\n\t\t\tresults.line.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tgroupFields.forEach(function (field) {\n\t\t\tresults.group.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tquoteFields.forEach(function (field) {\n\t\t\tresults.quote.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\treturn results;\n\t}\n\n\t_onJobChecker(job){\n\t\tjob.jobType = 'QuoteCalculator';\n\t\tthis.$.jobchecker.useSpinner = !this.$.calculateService.background;\n\t\tthis.$.jobchecker.data = job;\n\t}\n\n\t_jobCompleted() {\n\t\tif (this.$.jobchecker.result.payload != null) {\n\t\t\tlet quote = JSON.parse(this.$.jobchecker.result.payload);\n\t\t\tquote.backgroundCalculatePending = false;\n\t\t\tif (this.saveServiceAfterBackgroundCalc) {\n\t\t\t\t// Update quoteModel so the newly calculated quote reference is used in preparation for the save\n\t\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\t\tthis._executeServiceAction(this.saveServiceAfterBackgroundCalc);\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._getDomHost().updateQuote(quote);\n\t\t}\n\t}\n\n\t_save(saveService) {\n\t\tif (this.editorModel.data.settings.usesClientCalculator) { // Check if jsqc should be used\n\t\t\tthis._jsqcCalculate(false).then(function(res) {\n\t\t\t\tthis._mergeUbpEdits(this.editorModel.quoteModel.quoteVO);\n\t\t\t\t// Since the calculation was performed here, and the server will make no further changes, there is no reason\n\t\t\t\t// not to validate asset quantities here. So do that.\n\t\t\t\tlet aqv = new AssetQuantityValidator(this.editorModel.quoteModel.quoteVO, this.editorModel.constants);\n\t\t\t\tconst invalidQtyMessages = aqv.validateAssetQuantityChanges();\n\t\t\t\tif (invalidQtyMessages.length !== 0) {\n\t\t\t\t\t// If any messages about invalid quantities were returned, display them instead of triggering the service action.\n\t\t\t\t\tthis.domHost.error = {validations: invalidQtyMessages};\n\t\t\t\t} else {\n\t\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t\t}\n\t\t\t}.bind(this), function(rej) {\n\t\t\t\tthis.domHost.error = rej;\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\t// If background calc enabled, need to run background calc and wait for response before triggering the correct save\n\t\t\tif (this.editorModel.data.settings.usesBackgroundCalculator) {\n\t\t\t\t// This property is used in _onJobChecker to trigger a save after job is complete\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = saveService;\n\t\t\t\tthis.onFlagCalculate(false);\n\t\t\t} else {\n\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Merge unsaved ubp edits before saving\n\t * @private\n\t */\n\t_mergeUbpEdits(quote) {\n\t\tif (AppContext.isManualEditsForUBPEnabled) {\n\t\t\t// prepare field metadata for merging\n\t\t\tconst fields = Object.keys(this.editorModel.constants.UBP_FIELDS.ConsumptionRateFields).map((key) => {\n\t\t\t\treturn {fieldPath: this.editorModel.constants.UBP_FIELDS.ConsumptionRateFields[key]};\n\t\t\t});\n\t\t\tlet merged = false;\n\t\t\tfor (let line of quote.lineItems) {\n\t\t\t\tif (line.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]) {\n\t\t\t\t\tconst lineOrProdId = this._getLineOrProdId(line.record);\n\t\t\t\t\tconst key = `AppliedUbpChanges_${lineOrProdId}_${line.key}`;\n\t\t\t\t\tconst appliedChanges = get(key, ['rates']);\n\t\t\t\t\tif (appliedChanges) {\n\t\t\t\t\t\tObject.keys(appliedChanges).forEach((rateId) => {\n\t\t\t\t\t\t\tif (!line.ubpChanges) {\n\t\t\t\t\t\t\t\tline.ubpChanges = {rates: {}};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!line.ubpChanges.rates[rateId]) {\n\t\t\t\t\t\t\t\tline.ubpChanges.rates[rateId] = {\n\t\t\t\t\t\t\t\t\tId: rateId,\n\t\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t\ttype: `${this.editorModel.constants.prefix}QuoteLineConsumptionRate__c`\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tline.ubpChanges.rates[rateId] = overrideRecValues(line.ubpChanges.rates[rateId] || {}, appliedChanges[rateId], fields);\n\t\t\t\t\t\t\tmerged = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (merged) {\n\t\t\t\tquote.record[this.editorModel.constants.CONSUMPTION_RATE_OVERRIDE] = true;\n\t\t\t}\n\t\t}\n\t\t// additionally, merge ubpChanges to client cache to prevent stale data (W-6802316)\n\t\tfor (let line of quote.lineItems) {\n\t\t\tif (line.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE] && line.ubpChanges && line.ubpChanges.rates) {\n\t\t\t\tObject.keys(line.ubpChanges.rates).forEach((rateId) => {\n\t\t\t\t\tput(rateId, ['record'], mergeRec(get(rateId, ['record']) || {}, line.ubpChanges.rates[rateId]));\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear AppliedUbpChanges after a successful save (or editor reload)\n\t * @private\n\t */\n\t_clearAppliedUbpChanges() {\n\t\tif (AppContext.isManualEditsForUBPEnabled &&\n\t\t\tthis.quoteEditorModelResponse &&\n\t\t\tthis.quoteEditorModelResponse.quote &&\n\t\t\tthis.quoteEditorModelResponse.quote.lineItems) {\n\t\t\tthis.quoteEditorModelResponse.quote.lineItems.forEach((line) => {\n\t\t\t\tconst lineOrProdId = this._getLineOrProdId(line.record);\n\t\t\t\tconst key = `AppliedUbpChanges_${lineOrProdId}_${line.key}`;\n\t\t\t\tdel(key);\n\t\t\t})\n\t\t}\n\t}\n\n\t_navigateToLookup(lookupName) {\n\t\tthis._resetOnActionSignal();\n\t\tthis.domHost.errors = null;\n\t\tlet queryParams = {\n\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\taId : this.eventDetail.customAction.customActionId\n\t\t};\n\t\tif (this.eventDetail.model && this.eventDetail.model.groupKey)\n\t\t\tqueryParams.groupKey = this.eventDetail.model.groupKey;\n\n\t\tNavigator.nav('#', queryParams, [lookupName, 'lookup'], false, this);\n\t}\n\n\t_retrieveKeysOfSelected() {\n\t\tlet keys = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, gmLength = groupModels.length; i < gmLength; i++) {\n\t\t\tlet standardLines = groupModels[i].standardLines;\n\t\t\tfor (let j = 0, standardLinesLength = groupModels[i].standardLines.length; j < standardLinesLength; j++) {\n\t\t\t\tif (standardLines[j].selected && standardLines[j].removable)\n\t\t\t\t\tkeys.push(standardLines[j].lineVO.key);\n\t\t\t}\n\t\t\tlet segmentedLines = groupModels[i].segmentedLines;\n\t\t\tfor (let j = 0, segmentedLinesLength = segmentedLines.length; j < segmentedLinesLength; j++) {\n\t\t\t\tif (segmentedLines[j].selected && segmentedLines[j].removable){\n\t\t\t\t\tlet segments = segmentedLines[j].segments;\n\t\t\t\t\tfor (let k = 0, segmentsLength = segments.length; k < segmentsLength; k++)\n\t\t\t\t\t\tkeys.push(segments[k].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn keys;\n\t}\n\n\t_getAllRelatedKeys(keys, includeSiblingSegments) {\n\t\tlet relatedKeysToDelete = new Set();\n\t\tkeys.forEach((key) => {\n\t\t\tif (!key) {\n\t\t\t\treturn;\n\t\t\t} // Skip lines with undefined keys (ie. summary and subtotal rows when large quote experience is enabled)\n\t\t\tlet thisLine = this.editorModel.quoteModel.lineModelsByKey[key];\n\t\t\tlet childLines = this.editorModel.quoteModel.linesByParentItemKey[key];\n\t\t\t// For bundle parents, we need to get the keys of all decendents\n\t\t\tif (childLines) {\n\t\t\t\tlet childKeys = new Set();\n\t\t\t\tfor (let i = 0; i < childLines.length; i++) {\n\t\t\t\t\tchildKeys.add(childLines[i].lineVO.key);\n\t\t\t\t}\n\t\t\t\tlet grandChildKeys = this._getAllRelatedKeys(childKeys, includeSiblingSegments);\n\t\t\t\trelatedKeysToDelete = new Set([...relatedKeysToDelete, ...childKeys, ...grandChildKeys]);\n\t\t\t}\n\t\t\t// For MDQ segments, we need to get the keys of its \"sibling\" segments\n\t\t\telse if (includeSiblingSegments && thisLine.segmented && thisLine.segments) {\n\t\t\t\tthisLine.segments.forEach((segment) => {\n\t\t\t\t\trelatedKeysToDelete.add(segment.lineVO.key);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn relatedKeysToDelete;\n\t}\n\n\t_addGroup(groupVO) {\n\t\tlet constants = this.editorModel.constants;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet standardSubScope = false, segmentedSubScope = false;\n\t\tif (!groupVO) {\n\t\t\tlet groupRecord = this._createGroupRecord(quoteModel);\n\t\t\tgroupRecord.Name = `Group${quoteModel.lineGroups.length + 1}`;\n\t\t\tgroupVO = {record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\t} else {\n\t\t\t// If a group is being cloned, update the scopes\n\t\t\tlet oldGroupModel = this.editorModel.quoteModel.groupsByKey[groupVO.key];\n\t\t\tstandardSubScope = oldGroupModel.standardSubscriptionScopeEditable;\n\t\t\tsegmentedSubScope = oldGroupModel.segmentedSubscriptionScopeEditable;\n\t\t}\n\n\t\tif (this.eventDetail.customAction.type === 'Solution Group') {\n\t\t\tthis._extendSolutionGroupRecord(groupVO.record);\n\t\t}\n\n\t\t// Create a copy of groupVO to disconnect property values in memory from _createGroupRecord\n\t\tgroupVO = JSON.parse(JSON.stringify(groupVO));\n\t\tgroupVO.key = quoteModel.quoteVO.nextGroupKey;\n\t\tquoteModel.quoteVO.nextGroupKey++;\n\t\tgroupVO.record.Id = undefined;\n\n\t\tlet group = new GroupModel(groupVO, quoteModel);\n\n\t\tgroup.standardSubscriptionScopeEditable = standardSubScope;\n\t\tgroup.segmentedSubscriptionScopeEditable = segmentedSubScope;\n\t\tquoteModel.quoteVO.lineItemGroups.push(groupVO);\n\t\tquoteModel.groupsByKey[group.groupVO.key] = group;\n\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\tindexByGroupKey[group.groupVO.key] = {index: Object.keys(indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\n\t\tthis.domHost.push('groupModels', group);\n\t\tfor (let i = 0; i < quoteModel.quoteVO.lineItemGroups.length; i++) {\n\t\t\tquoteModel.quoteVO.lineItemGroups[i].record[constants.NUMBER_FIELD] = i + 1;\n\t\t}\n\t\tthis.domHost.rightSideButton = quoteModel.lineGroups.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.domHost.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\n\t\tif(quoteModel.lineGroups.length == constants.PANEL_ADDED_INDEX) {\n\t\t\tfireEvent(Events.GROUP_PANEL_CREATED, {groupKey: group.groupVO.key});\n\t\t} else {\n\t\t\tfireEvent(Events.BUILD_LAYOUT, { group: group });\n\t\t}\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tfireEvent(Events.GROUP_ADDED, { groupKey: group.groupVO.key });\n\t\t}\n\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_createGroupRecord(quoteModel) {\n\t\tlet groupRecord = {},\n\t\t\tconstants = this.editorModel.constants;\n\n\t\tgroupRecord[constants.QUOTE_PROCESS_FIELD] = this.editorModel.data.defaultQuoteProcessId;\n\t\tgroupRecord[constants.ACCOUNT_FIELD] = quoteModel.quoteVO.record[constants.ACCOUNT_FIELD];\n\t\tgroupRecord[constants.ACCOUNT_ID_FIELD] = quoteModel.quoteVO.record[constants.ACCOUNT_ID_FIELD];\n\t\tgroupRecord.attributes = { type: `${this.prefix}QuoteLineGroup__c` };\n\t\treturn groupRecord;\n\t}\n\n\t_extendSolutionGroupRecord(groupRecord) {\n\t\tgroupRecord.Name = this.eventDetail.customAction.record.Name;\n\t\tgroupRecord[this.editorModel.constants.DESCRIPTION_FIELD] = this.eventDetail.customAction.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tgroupRecord[this.editorModel.constants.SOLUTION_GROUP_ID_FIELD] = this.eventDetail.customAction.record.Id;\n\t}\n\n\n\t_openDialog(dialogName) {\n\t\tlet favDialog = this.$[dialogName];\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tfavDialog.favoritedLine = this.eventDetail.model.serviceModel.keys;\n\t\t} else {\n\t\t\tlet groupLines = [].concat(this.eventDetail.model.standardLines).concat(this.eventDetail.model.segmentedLines);\n\t\t\tif (groupLines.length === 0) {\n\t\t\t\tthis.domHost.errors = [AppContext.properties.i18n.value().l('Please select a group with one or more lines to favorite.')];\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tfavDialog.favoritedGroup = this.eventDetail.model.groupKey;\n\t\t\t\tfavDialog.groupLines = groupLines;\n\t\t\t}\n\t\t}\n\t\tfavDialog.$.dialog.toggle();\n\t}\n\n\t_openPricingGuidanceDialog(dialogName) {\n\n\t\tlet pricingGuidanceDialog = this.$[dialogName];\n\t\tlet lineVO = this.eventDetail.model.lineVO;\n\t\tlet fieldMap = this.editorModel.md.fieldLabelsMap[this.editorModel.constants.QUOTE_LINE];\n\t\tlet pricingGuidanceArray = [];\n\t\tlet quoteLineFields = this.data.lineFieldNames;\n\t\tlet isPricingRecommendationAvailable = false;\n\t\tlet isPricingGuidanceAvailable = false;\n\t\tlet pricingGuidanceRecord = {};\n\t\tlet fieldLabels = {};\n\t\tlet isMobileDevice = false;\n\t\tlet quoteLineObjectArray = [];\n\t\tlet lineModel = this.eventDetail.model;\n\n\t\tif (lineVO.quoteLinePricingGuidance && lineVO.quoteLinePricingGuidance.record) {\n\t\t\tpricingGuidanceDialog.pricingGuidanceRecord = lineVO.quoteLinePricingGuidance.record;\n\n\t\t\tlet pricingGuidanceFieldMetadata={\"type\": \"percent\", \"scale\": 2};\n\n\t\t\tif (lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_TARGET] != null) {\n\t\t\t\tlet targetPrice = lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_TARGET];\n\t\t\t\tlet targetDisplayValue = Formatter.formatFieldData(lineModel, targetPrice, pricingGuidanceFieldMetadata,lineVO.record );\n\t\t\t\tthis.pushPricingGuidanceValueToArray(pricingGuidanceArray, \"Target\",  targetDisplayValue);\n\t\t\t\tisPricingRecommendationAvailable = true;\n\t\t\t\tisPricingGuidanceAvailable = true;\n\t\t\t}\n\t\t\tif (lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_NORM] != null) {\n\t\t\t\tlet normPrice = lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_NORM];\n\t\t\t\tlet normDisplayValue = Formatter.formatFieldData(lineModel, normPrice, pricingGuidanceFieldMetadata,lineVO.record );\n\t\t\t\tthis.pushPricingGuidanceValueToArray(pricingGuidanceArray, \"Norm\",  normDisplayValue);\n\t\t\t\tisPricingGuidanceAvailable = true;\n\t\t\t}\n\t\t\tif (lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_FLOOR] != null) {\n\t\t\t\tlet floorPrice = lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_FLOOR];\n\t\t\t\tlet floorDisplayValue = Formatter.formatFieldData(lineModel, floorPrice, pricingGuidanceFieldMetadata,lineVO.record );\n\t\t\t\tthis.pushPricingGuidanceValueToArray(pricingGuidanceArray, \"Floor\",  floorDisplayValue);\n\t\t\t\tisPricingGuidanceAvailable = true;\n\t\t\t}\n\n\t\t\tif (lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_EXPLANATION] != null) {\n\t\t\t\tlet reasoning = lineVO.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_EXPLANATION];\n\t\t\t\tthis.pushPricingGuidanceValueToArray(pricingGuidanceArray, \"Explanation\", reasoning);\n\t\t\t\tisPricingGuidanceAvailable = true;\n\t\t\t}\n\n\t\t\tpricingGuidanceDialog.pricingGuidanceArray = pricingGuidanceArray;\n\t\t}\n\n\t\tif (!isPricingGuidanceAvailable) {\n\t\t\tpricingGuidanceRecord = {errorMessage: [this.domHost.i18n.l(\"PricingGuidanceNotAvailable\")]};\n\t\t}\n\n\n\t\tlet uiData = UIDataManager.prepareSingleLineData(lineModel, 0, quoteLineFields, this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName]);\n\n\t\tif (quoteLineFields) {\n\t\t\tfor (let value of Object.values(quoteLineFields)) {\n\t\t\t\tquoteLineObjectArray.push({key: fieldMap[value], value: uiData[value]});\n\t\t\t\tfieldLabels[value] = fieldMap[value];\n\t\t\t}\n\t\t}\n\t\tif (this.editorModel.deviceContext && this.editorModel.deviceContext.isMobile) {\n\t\t\tisMobileDevice = true;\n\t\t}\n\n\t\tpricingGuidanceDialog.pricingGuidanceRecord = pricingGuidanceRecord;\n\t\tpricingGuidanceDialog.isPricingGuidanceAvailable = isPricingGuidanceAvailable;\n\t\tpricingGuidanceDialog.lineVO = lineVO;\n\t\tpricingGuidanceDialog.isPricingRecommendationAvailable = isPricingRecommendationAvailable;\n\t\tpricingGuidanceDialog.isMobileDevice = isMobileDevice;\n\t\tpricingGuidanceDialog.quoteLineObjectArray = quoteLineObjectArray;\n\n\t\tpricingGuidanceDialog.$.dialog.toggle();\n\n\t\tlet currentLineVORecord = lineVO.record;\n\t\tlet devPrefix = this.data.developerPrefix;\n\t\tlet isViewed = devPrefix + \"IsViewed__c\";\n\t\tlet product = devPrefix + \"Product__c\";\n\t\tlet quote = devPrefix + \"Quote__c\";\n\n\t\tlet currentProduct = currentLineVORecord[product];\n\t\tlet lineItems = this.eventDetail.model.groupModel.quoteVO.lineItems;\n\t\tfor (let i = 0; i <  lineItems.length; i++) {\n\t\t\tlet currentLineItemsRecord = lineItems[i].record;\n\t\t\tif (currentLineItemsRecord[product] == currentProduct && lineItems[i].quoteLinePricingGuidance) {\n\t\t\t\tlet currentQuoteLinePricingGuidance = lineItems[i].quoteLinePricingGuidance.record;\n\t\t\t\tcurrentQuoteLinePricingGuidance[isViewed] = true;\n\t\t\t}\n\t\t}\n\t\tnew AppLogger().log(currentLineVORecord[quote], LOG_TYPE.PRICING_GUIDANCE, JSON.stringify({pricingGuidanceAction: \"Viewed\"}));\n\n\t}\n\n\tpushPricingGuidanceValueToArray(pricingGuidanceArray, name, value) {\n\t\tlet displayText = this.domHost.i18n.l(name);\n\t\tpricingGuidanceArray.push({name: name, value: value, displayName: displayText});\n\t}\n\n\tget prefix() {\n\t\tif(this.app === undefined)\n\t\t\treturn;\n\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tsortLines(quote, notify) {\n\t\tlet lineSortField = quote.lineSortField;\n\t\tif ( !quote.lineSortField || lineSortField == this.editorModel.constants.NUMBER_FIELD ) {\n\t\t\treturn false;\n\t\t}\n\t\tfireEvent(Events.SORT_LINES_REQUIRED, { lineSortField: lineSortField, notify: notify });\n\t\treturn true;\n\t}\n\n\t/**\n\t * Calls SFSegmentedTable/SegmentedLines#_resetOnAction\n\t * to reset the expanded value to false\n\t * @private\n\t */\n\t_resetOnActionSignal() {\n\t\tfireEvent(Events.RESET_ON_ACTION);\n\t}\n\n\t// proxy method to return domHost\n\t_getDomHost() {\n\t\treturn this.domHost;\n\t}\n\n\t// proxy method to return PageContainer.getViewport()\n\t_getViewport() {\n\t\treturn PageContainer.getViewport();\n\t}\n\n\t_getLineOrProdId(record) {\n\t\treturn record.Id || record[this.editorModel.constants.SOURCE_FIELD] || record[this.editorModel.constants.PRODUCT];\n\t}\n}\n\n\n\nPolymer( LECustomActionServices );\n","import {Localizer} from '../layout/sb-le-table-cell/Localizer.js';\n\nlet sortByField;\nlet lookupNameField;\nlet constants;\n\n/**\n * For each node in the tree, starting at a given id and proceeding\n * depth-first (pre-order), sort the child nodes based on sortChildLinesAsc, and\n * call the callback with each child node.\n */\nfunction depthFirstTraversal(tree, id, byOrder, callback) {\n\tlet children = tree[id];\n\tif (!children) return;\n\n\tif(byOrder === '') {    // Scenario of reverting the sort\n\t\tchildren.sort(sortLinesAscByKey.bind(this));\n\t} else if (byOrder === 'asc'){\n\t\tchildren.sort(sortLinesAscByField.bind(this));\n\t} else if (byOrder === 'desc'){\n\t\tchildren.sort(sortLinesDescByField.bind(this));\n\t}\n\n\tfor (let i=0; i < children.length; i++) {\n\t\tcallback(children[i]);\n\t\tdepthFirstTraversal(tree, children[i].lineVO.key, byOrder, callback);\n\t}\n}\n\n/**\n * Returns an object, where each key is a node, and\n * its value is an array of child nodes.\n */\nfunction makeLineItemsTree(arr) {\n\tvar tree = {};\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tif (!tree[arr[i].lineVO.parentItemKey]){\n\t\t\ttree[arr[i].lineVO.parentItemKey] = [];\n\t\t}\n\t\ttree[arr[i].lineVO.parentItemKey].push(arr[i]);\n\t}\n\treturn tree;\n}\n\n// Child Lines are sorted ascending order by their line keys.\nfunction sortLinesAscByKey(a, b) {\n\treturn a.lineVO.key-b.lineVO.key;\n}\n\n// Parent lines are sorted by user defined ascending or descending.\nfunction sortLinesAscByField(a, b) {\n\tlet A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n\tlet B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n\tlet isABundled;\n\tlet isBBundled;\n\tif (sortByField === constants.LIST_PRICE_FIELD) {\n\t\tisABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n\t\tisBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n\t} else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n\t\tlet aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n\t\tlet bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n\t\tA = aLocalizedValue || A;\n\t\tB = bLocalizedValue || B;\n\t}\n\tA = updateFieldFormat(A, isABundled);\n\tB = updateFieldFormat(B, isBBundled);\n\tif (A == B) {\n\t\treturn 0;\n\t}else if ( A < B ){\n\t\treturn -1;\n\t}else if ( A > B ){\n\t\treturn 1;\n\t}else if (A == null){\n\t\treturn -1;\n\t}else if (B == null){\n\t\treturn 1;\n\t}else{\n\t\treturn 0;\n\t}\n}\n\nfunction sortLinesDescByField(a, b) {\n\tlet A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n\tlet B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n\tlet isABundled;\n\tlet isBBundled;\n\tif (sortByField === constants.LIST_PRICE_FIELD) {\n\t\tisABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n\t\tisBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n\t} else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n\t\tlet aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n\t\tlet bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n\t\tA = aLocalizedValue || A;\n\t\tB = bLocalizedValue || B;\n\t}\n\tA = updateFieldFormat(A, isABundled);\n\tB = updateFieldFormat(B, isBBundled);\n\tif (A == B) {\n\t\treturn 0;\n\t}else if ( A > B ){\n\t\treturn -1;\n\t}else if ( A < B ){\n\t\treturn 1;\n\t}else if (A == null){\n\t\treturn 1;\n\t}else if (B == null){\n\t\treturn -1;\n\t}else{\n\t\treturn 0;\n\t}\n}\n\n/**\n * Renumbers the Number__c field from record of LineViewModel to update displayed line numbers on line editor.\n * @param {arr}: Array of line items\n * @param {num}: String starting number taken from original line items array.\n */\nfunction reorderLineNumbers(lowestVisibleNumber, lowestInvisibleNumber, array){\n\tif (array.length > 0) {\n\t\tvar indexByGroupKey = array[0].groupModel.quoteModel.indexByGroupKey;\n\t\tvar groupKey = array[0].lineVO.parentGroupKey;\n\t}\n\tfor (let i = 0; i < array.length; i++){\n\t\t// Used to update key to index map that is used for JSQCNotifier to update correct paths\n\t\tvar lineKey = array[i].lineVO.key;\n\t\tif (array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]) {\n\t\t\t// Used to update MDQ summary line index\n\t\t\tindexByGroupKey[groupKey].indexBySegmentKey[array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]] = i;\n\t\t} else {\n\t\t\t// Used to update standard lines index only\n\t\t\tindexByGroupKey[groupKey].indexByLineKey[lineKey] = i;\n\t\t}\n\t\tif (array[i].visible) {\n\t\t\tarray[i].lineVO.record[constants.NUMBER_FIELD] = lowestVisibleNumber;\n\t\t\tlowestVisibleNumber++;\n\t\t} else {\n\t\t\tarray[i].lineVO.record[constants.NUMBER_FIELD] = lowestInvisibleNumber;\n\t\t\tlowestInvisibleNumber++;\n\t\t}\n\t}\n\treturn array;\n}\n\n\nfunction updateFieldFormat(field, isBundled) {\n\tif (isBundled) {\n\t\tfield = 0;\n\t}\n\tif (typeof field === 'string') {\n\t\tfield.toUpperCase();\n\t} else if (typeof field === 'undefined') {\n\t\tfield = null;\n\t}\n\treturn field;\n}\n\n/**\n * Returns lowest starting visible and invisible line numbers\n */\nfunction getStartingNumbers(arr) {\n\tlet lowestVisibleNumber;\n\tlet lowestInvisibleNumber;\n\tarr.forEach( function(line) {\n\t\tlet lineNumber = line.lineVO.record[constants.NUMBER_FIELD];\n\t\t// lowest numbers will be undefined the first time through so assign them to the first lineNumber\n\t\tif (line.visible) {\n\t\t\tlowestVisibleNumber = !lowestVisibleNumber || lineNumber < lowestVisibleNumber ? lineNumber : lowestVisibleNumber;\n\t\t} else {\n\t\t\tlowestInvisibleNumber = !lowestInvisibleNumber || lineNumber < lowestInvisibleNumber ? lineNumber : lowestInvisibleNumber;\n\t\t}\n\t}.bind(this));\n\treturn { lowestVisibleNumber : lowestVisibleNumber, lowestInvisibleNumber : lowestInvisibleNumber};\n}\n\n/**\n * Sorts line items while maintaining bundle hierarchy.\n * @param {arr}: Array of line items\n * @param {byOrder}: String 'asc' for ascending order, 'desc' for descending order\n */\nexport function depthFirstLineItemsTreeSort(arr, field, byOrder, keepBundle, nameField) {\n\tlet i = 0;\n\tconstants = arr[0].editorModel.constants;\n\tlet bundleKeptTogether = keepBundle;\n\tsortByField = arr[0].segmented && !arr[0].lineVO.record[field] ? constants.NET_TOTAL_FIELD : field;\n\tlookupNameField = nameField;\n\tlet startingNumbers = getStartingNumbers(arr);\n\n\t// bundleKeptTogether flag will only be true if bundleKeptTogether setting is true and the lines being sorted are from the standard lines table\n\t// Segmented lines table will send false because parent bundle hierarchy tree does not need to be created, skip directly to sorting\n\tif (bundleKeptTogether){\n\t\tlet tree = makeLineItemsTree(arr);\n\t\tdepthFirstTraversal(tree, null, byOrder, function(node) {\n\t\t\tarr[i++] = node;\n\t\t});\n\t} else {\n\t\tif (byOrder === 'asc'){\n\t\t\tarr.sort(sortLinesAscByField.bind(this));\n\t\t} else if (byOrder === 'desc'){\n\t\t\tarr.sort(sortLinesDescByField.bind(this));\n\t\t} else if (byOrder === ''){     // Scenario of reverting the sort\n\t\t\tarr.sort(sortLinesAscByKey.bind(this));\n\t\t}\n\t}\n\n\t// Overwrite arr with the reordered result\n\tarr = reorderLineNumbers(startingNumbers.lowestVisibleNumber, startingNumbers.lowestInvisibleNumber, arr);\n\n\treturn arr;\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {fieldFactory} from 'common/forms/sb-field/factory/FieldFactory.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {DependentPicklistBuilder} from 'common/forms/DependentPicklistBuilder.js';\n\nlet REF_DISPLAY = 'refDisplay';\n\n/**\n * Component Factory for instantiating web component of inline fields\n * Currently this is an adaptor for FieldFactory\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFComponentFactory {\n\n\tstatic getFieldComponent(fieldMetadata, lineModel, index, record) {\n\n\t\tlet type = fieldMetadata.type;\n\t\tlet fieldName = fieldMetadata.name || fieldMetadata.fieldPath;\n\t\trecord = record || lineModel.lineVO.record;\n\t\tlet referenceDetails = null;\n\t\tlet selectOptions = null;\n\n\t\tif (type === 'reference') {\n\t\t\treferenceDetails = {\n\t\t\t\trefDisplay: record && fieldMetadata.relationshipName && record[fieldMetadata.relationshipName] ? record[fieldMetadata.relationshipName].Name : '',\n\t\t\t\trefDisplayName: REF_DISPLAY,\n\t\t\t\trefTable: computeRefTable(fieldMetadata),\n\t\t\t\trefObjects: [],\n\t\t\t\trecord: record\n\t\t\t};\n\t\t} else if (type === 'picklist' || type === 'multipicklist') {\n\t\t\tif (fieldMetadata.controllerName) {\n\t\t\t\tlet controllerValue = record[fieldMetadata.controllerName];\n\t\t\t\tselectOptions = new DependentPicklistBuilder(fieldMetadata, controllerValue).build();\n\t\t\t} else {\n\t\t\t\tselectOptions = fieldMetadata.picklistValues;\n\t\t\t}\n\t\t}\n\n\t\treturn fieldFactory(type, lineModel,\n\t\t\trecord[fieldName],  // value\n\t\t\ttrue,               // editable\n\t\t\tfalse,              // disabled\n\t\t\tfalse,              // hidden\n\t\t\tindex,              // index\n\t\t\tfieldMetadata,      // metadata\n\t\t\tAppContext.i18n,    // i18n\n\t\t\tfieldMetadata.extraTypeInfo === 'richtextarea' ? true : false, // render read-only, RTAs always read only so dialog shows on tap\n\t\t\tselectOptions,      // selectOptions\n\t\t\treferenceDetails);\n\t}\n\n}\n\n/** Compute the reference table for lookup or M/D fields */\nfunction computeRefTable( md ) {\n\tif( md === undefined ) {\n\t\treturn;\n\t}\n\tif(md.referenceTable) {\n\t\treturn md.referenceTable;\n\t}\n\t// if no referenceTable property on md, check the referenceTo array property which is same property on field metadata from sb-describe\n\treturn md.referenceTo && md.referenceTo.length > 0 ? md.referenceTo[0] : null;\n}\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {toFieldName} from \"../../common/Util.js\";\n\n/**\n * Common behavior for QLE segmented table across UI2 and UI3\n *\n * @author kzheng\n * @since 216\n */\n\nexport class QLESegmentedTableBehavior {\n\n\tstatic get properties() {\n\n\t\treturn {\n\t\t\t// Segment Summary line column names\n\t\t\tfieldNames: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t//\n\t\t\tquoteLineFields: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// Each column name for the pricing and the customized\n\t\t\tcolumnNames: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserver: 'columnNamesChanged'\n\t\t\t},\n\t\t\t// Currency MD which are from NetTotal__c so that we can format the subtotals and total will the correct currency format\n\t\t\tcurrencyMd: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_getNetTotalFieldMd(groupModel)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgroupModel: Object,\n\t\t}\n\t}\n\n\t// Observers\n\tget observers() {\n\t\treturn ['_render(groupModel)',\n\t\t\t'_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)',\n\t\t\t'_showSubtotal(groupModel.*)'];\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t}\n\n\t_getFields() {\n\t\tlet fields = this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;\n\t\treturn this.groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields) : fields;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = {};\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\t//check colWidth for the dimension exists\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout && this.groupModel.colWidth[this.dimension]) {\n\t\t\tcolWidths = this.groupModel.getDimensionColWidths(this.dimension);\n\t\t\tif (!colWidths)\n\t\t\t\treturn;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\tif (!columnWidths) {\n\t\t\treturn; //temporary fix for tests\n\t\t}\n\t\t// get the width of the subtotal label column which should align with the last summary line field\n\t\tlet labelColWidth = offset;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 'px';\n\t\t// set width of the total column\n\t\tthis.totalColWidth = columnWidths['total'] + 'px';\n\t}\n\n\t_setSubtotalColWidth(columnName, columnWidths) {\n\t\t// set widths of each segment total\n\t\tlet colName = toFieldName(columnName);\n\t\treturn columnWidths[colName] + 'px';\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\tonTrack(e) {\n\t\tthis.domHost.domHost._onTrack(e);\n\t}\n\n\t/**\n\t * Return the raw editorModel from usps. Once the package is arrived, it will return the updated editorModel\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\t/**\n\t * Return the quoteVO from usps. Once the package is arrived, it will return the updated quoteVO\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget quoteVO() {\n\t\treturn this.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Return the multiSegmentColumnTotals based on the column name which are one-time and currency column names\n\t * @param columnName\n\t * @returns {*[]}\n\t */\n\tgetMultiSegmentColumnTotal(columnName) {\n\t\tif (this.groupModel.multiSegmentColumnTotals[this.dimension])\n\t\t\treturn [this.groupModel.multiSegmentColumnTotals[this.dimension][columnName]];\n\t}\n\n\tgetMultiSegmentTotalField() {\n\t\tif (this.groupModel.netMultiSegmentTotal)\n\t\t\treturn this.groupModel.netMultiSegmentTotal[this.dimension];\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.currencyMd) {\n\t\t\tthis.currencyMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (this.editorModel.data.settings.lineEditorSubtotalsField != \"doNotDisplay\") {\n\t\t\tthis._getNetTotalFieldMd();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t/**\n\t * Return the Quote line object from the net total field\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_getNetTotalFieldMd() {\n\t\tlet priceScale;\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\tpriceScale = this.quoteVO.currencyDecimalScale;\n\t\t} else {\n\t\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay' || subtotalField == null) {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\t} else {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t\t}\n\t\t}\n\t\treturn { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t}\n\n\t/**\n\t *  Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e      - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\t// False parameter added because we don't care about bundleKeptTogether for segmented line sorting\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], e.detail.field, e.detail.order, false, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], lineSortField, 'asc', false, notify);\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.lineModels.length + 10 - idx;\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.lineModels.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor ( let i = 0, l = this.groupModel.segmentedLinesByDimension[this.dimension].length; i < l; i++ ) {\n\t\t\t\tfor ( let j = 0, k = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments.length; j < k; j++) {\n\t\t\t\t\tlet model = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments[j];\n\t\t\t\t\t// Keep dirty check in sync when the sb-le-table-cell's are not yet instantiated\n\t\t\t\t\t// This is the case when the MDQ summary line has not been expanded yet\n\t\t\t\t\tif (!model.lineVO._transient_) {\n\t\t\t\t\t\tmodel.lineVO._transient_ = {};\n\t\t\t\t\t\tmodel.lineVO._transient_.original = model.lineVO._transient_.original || JSON.parse(JSON.stringify(model.lineVO.record));\n\t\t\t\t\t}\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}.${i}.segments.${j}.lineVO.record.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset the expanded value of the lines, in case they're opened.\n\t * @param e\n\t * @private\n\t */\n\t_resetOnAction(e) {\n\t\tlet lineModels = Array.from(this.lineModels); // bc we support ie\n\t\tlineModels.forEach(function(lineModel) {\n\t\t\tlineModel.lineVO.expanded = false;\n\t\t});\n\t}\n\t\n\t/**\n\t * observer for reacting to column name changes\n\t * @param newValue\n\t * @param oldValue\n\t */\n\tcolumnNamesChanged(newValue, oldValue) {}\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.QLESegmentedTableBehavior = QLESegmentedTableBehavior.prototype;\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\n/**\n * Common behavior for QLE table\n *\n * @author kzheng\n * @since 216\n */\nexport class QLEStandardTableBehavior {\n\n\tstatic get properties() {\n\n\t\treturn {\n\t\t\tgroupModel: { /** required - built from the LineEditor from the incoming data */\n\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsettings: Object,\n\t\t\tfieldNames: Array,\n\t\t\tquoteLineFields: Object,\n\t\t\tfieldLabelsMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: {\n\t\t\t\ttype: Number\n\t\t\t},\n\t\t\tsubtotalMd: Object,\n\t\t\tdragDrop: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tvisibleLines: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_initVisibleLines(groupModel)'\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: '_initTabIndex(viewport)'\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Common init code invoked by ready\n\t */\n\tinit() {\n\t\t// return if necessary data isn't available so it's test-friendly\n\t\tif (!this.groupModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tthis.summaries = this.groupModel.quoteModel.grouped ? this.groupModel.groupVO.summaries : this.groupModel.quoteModel.quoteVO.summaries;\n\t\tQuoteContext.constants = this.editorModel.constants;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(groupModel)',\n\t\t\t'_updatePrimaryMobileColumnsObserver(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)',\n\t\t\t'_lineSplicesListener(groupModel.standardLines.splices)',\n\t\t\t'_showSubtotal(groupModel.*)',\n\t\t\t'_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)'\n\t\t];\n\t}\n\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\tget md() {\n\t\treturn this.editorModel.md;\n\t}\n\n\tget prefix() {\n\t\treturn this.editorModel.data.developerPrefix;\n\t}\n\n\t/**\n\t *  Updates fieldNames reference and binds the header data\n\t * @private\n\t */\n\t_buildRows() {\n\t\t// return if necessary data isn't available so it's test-friendly\n\t\tif (!this.groupModel || !this.groupModel.quoteModel || !this.groupModel.quoteModel.editorModel || !this.editorModel.fieldsetMap) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.actionsOnTheLeft = this.editorModel.actionsOnTheLeft;\n\t\tthis.multiLineDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis._setFieldNames();\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.columnNames = null;\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap[this.prefix + 'QuoteLine__c'];\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis._setDrawerFields();\n\t\tthis.settings = this.editorModel.data.settings;\n\t\tthis.postBuildRowRefresh();\n\t\t// We need to resize iron list when going from grouped to ungrouped.  Try to limit calls to resize otherwise.\n\t\tif (this.$$('iron-list') // iron-list must be present and loaded\n\t\t\t&& this.groupModel.groupKey //quote must be grouped\n\t\t\t&& this.editorModel.quoteModel.quoteVO.lineItemGroups.length == 1) // adding group for the first time\n\t\t{\n\t\t\t// Note we may get here also when updateQuote is called on a 1-group quote.  Fine...notifyResize is called unnecessarily in that rare case.\n\t\t\tthis.$$('iron-list').notifyResize();\n\t\t}\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = null;\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout) {\n\t\t\tcolWidths = this.groupModel.colWidth.Standard;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\t// get the width of the subtotal label column which should align with the field before Net Total\n\t\tlet labelColWidth = offset;\n\n\t\tlet len = this.fieldNames.length;\n\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 6 + 'px'; // adjust for td padding (6px)\n\n\t\tlet lastColWidth = columnWidths[this.fieldNames[this.fieldNames.length - 1]];\n\t\tthis.subtotalColWidth = lastColWidth + 6 + 'px'; // adjust for td padding (6px)\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\t_setDrawerFields() {\n\t\tlet drawerFields = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,\n\t\t\tisMobile = this.editorModel.deviceContext.isMobile;\n\n\t\tif (drawerFields && !isMobile) {\n\t\t\tthis.drawerFieldNames = drawerFields;\n\t\t} else if (drawerFields && isMobile) {\n\t\t\t// if there are fields in the line item drawer field set and we're in mobile, append the fields to the field set used\n\t\t\tthis.fieldNames = this.fieldNames.concat(drawerFields);\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\t// return if necessary data isn't available so it's test-friendly\n\t\tif (!this.groupModel || !this.groupModel.quoteModel || !this.groupModel.quoteModel.editorModel || !this.editorModel.md) {\n\t\t\treturn;\n\t\t}\n\t\tlet settings = this.editorModel.data.settings;\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (settings.lineEditorSubtotalsField != \"doNotDisplay\" && this.groupModel.standardLines.length > 0) {\n\t\t\tthis._getSubtotal();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getPriceScale() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\treturn this.groupModel.quoteModel.quoteVO.currencyDecimalScale;\n\t\t}\n\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay'|| subtotalField == null) {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t} else {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tlet subtotalField,\n\t\t\tsubtotal,\n\t\t\tsettings = this.editorModel.data.settings,\n\t\t\tlines = this.groupModel.standardLines;\n\n\t\tif (settings.lineEditorSubtotalsField == 'Default' || settings.lineEditorSubtotalsField == null) {\n\t\t\tsubtotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\t} else { // Custom subtotals field\n\t\t\tsubtotalField = settings.lineEditorSubtotalsField;\n\t\t}\n\n\t\tsubtotal = 0;\n\t\tfor (let i= 0, len = lines.length; i < len; i++ ) {\n\t\t\tlet line = lines[i];\n\t\t\tif (!isNaN(line.lineVO.record[subtotalField]))\n\t\t\t\tsubtotal += line.lineVO.record[subtotalField];\n\t\t}\n\n\t\tthis.subtotal = subtotal;\n\t}\n\n\tonTrack(e) {\n\t\tif (this.removeCellFocus) {\n\t\t\tthis.removeCellFocus(this.focusedCell);\n\t\t}\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\tlet dd = this.dragDrop;\n\t\t// Get ghost from lineEditor\n\t\tdd.ghost = dd.lineEditor.$.ghost;\n\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\n\t\tdd.dragKeys = [];\n\t\tdd.dragStandardIndexes = [];\n\t\tdd.dragMdqIndexesByDim = {};\n\t\tdd.dragLineModels = [];\n\t\tdd.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tdd.dragKeys.push(dragElement.lineModel.lineVO.key);\n\t\t//Run only if keep bundle together setting is true.\n\t\tif (dd.keepBundleTogether)\n\t\t\tthis._getBundleWithChildren(dd.dragKeys[0], dd.dragKeys);  //Update list of dragged elements' line keys\n\n\t\tdd.dragKeys.forEach(function(key){   //Update list of dragged elements' line models\n\t\t\tlet lm = this.lineModelsByKey[key];\n\t\t\tdd.dragLineModels.push(lm);\n\t\t\tif (!this.lineModelsByKey[key].segmented) {\n\t\t\t\tdd.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines, key));\n\t\t\t} else {\n\t\t\t\tif (dd.dragMdqIndexesByDim[lm.dimensionType]) {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key));\n\t\t\t\t} else {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType] = [this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key)];\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tdd.dragTargetElementIndex = this._getLineIndexFromKey(this.groupModel.standardLines, dragElement.lineModel.lineVO.key );\n\n\t\t//Toggle 'hidden' attribute true to hide standard rows being dragged from page.\n\t\tfor(let j = 0, index; j < dd.dragStandardIndexes.length; j++){\n\t\t\tindex = dd.dragStandardIndexes[j];\n\t\t\tthis.set(`groupModel.standardLines.${index}.hidden`, true);\n\t\t}\n\n\t\t//Toggle 'hidden' attribute true to hide mdq rows being dragged from page.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor(let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++){\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdd.ghostField = dragElement.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD];\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop,\n\t\t\tkeepBundleTogether = this.groupModel.editorModel.data.settings.bundleKeptTogether,\n\t\t\tlastIndex = this.groupModel.standardLines.length - 1;\n\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tswitch (dd.targetClass) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd.updateTableRowHoverOverObject(hoverElement);\n\t\t\t\tif (!dd.hoverOver) {return;}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.parentNode.parentNode;\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_removeLinesByIndex(indexesToRemove){\n\t\tindexesToRemove.sort( (a, b) => {\n\t\t\treturn a - b;\n\t\t});\n\n\t\tfor (let i = 0; i < indexesToRemove.length; i++) {\n\t\t\tthis.splice('groupModel.standardLines', indexesToRemove[i], 1);\n\t\t\tindexesToRemove = indexesToRemove.map( index => {\n\t\t\t\treturn --index;\n\t\t\t});\n\t\t}\n\t}\n\n\t_getBundleWithChildren(key, keyArray) {\n\t\tlet length;\n\t\tif (this.dragDrop.linesByParentKey[key]) {\n\t\t\tlength = this.dragDrop.linesByParentKey[key].length;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tfor (let j = 0; j < length; j ++) {\n\t\t\tlet nextKey = this.dragDrop.linesByParentKey[key][j].lineVO.key;\n\t\t\tkeyArray.push(nextKey);\n\t\t\tif (this.dragDrop.linesByParentKey[nextKey]){\n\t\t\t\tthis._getBundleWithChildren(nextKey, keyArray);\n\t\t\t}\n\t\t}\n\t}\n\n\t_getLineIndexFromKey(/*Standard Lines Array*/ lines, /*Array of line keys*/ key) {\n\t\tlet index;\n\t\tfor (let i = 0; i < lines.length; i++){\n\t\t\tif (lines[i].lineVO.key === key){\n\t\t\t\tindex = i;\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getStandardLineIndexesFromKeys(/*Standard Lines Array*/ lines, /*Array of line keys*/ keys) {\n\t\tlet indexes = [];\n\t\tfor(let j = 0; j < keys.length; j++){\n\t\t\tindexes.push(this._getStandardLineIndexFromKey(lines, keys[j]));\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t * @returns Boolean for when the field names collection has changed\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.groupModel.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setFieldNames();\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t\tthis._prepareUIData();\n\t\tsetTimeout(() => {\n\t\t\tthis._onUpdateSizeForItem(e);\n\t\t});\n\t}\n\n\t_prepareUIData() {\n\n\t}\n\n\ttoggleOptional(e) {\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.set(`groupModel.standardLines.${i}.lineVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.groupModel.standardLines.length + 10 - idx;\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.standardLines, lineSortField, 'asc', false, notify);\n\t}\n\n\t_updatePrimaryMobileColumnsObserver (fieldSet, standardPrimaryMobileCols) {\n\t\tif (fieldSet === undefined || standardPrimaryMobileCols === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updatePrimaryMobileColumns(fieldSet, standardPrimaryMobileCols);\n\t}\n\t\n\t_updatePrimaryMobileColumns() {\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(this.groupModel.editorModel.standardPrimaryMobileCols && this.groupModel.editorModel.standardPrimaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone'))\n\t\t\tthis.groupModel.editorModel.standardPrimaryMobileCols[0] = this.fieldSet.fields[0];\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t_initVisibleLines() {\n\t\treturn this.groupModel.standardLines.filter(function (line) {\n\t\t\treturn line.visible;\n\t\t}.bind(this));\n\t}\n\n\t_initTabIndex() {\n\t\treturn this.viewport && this.viewport.isMobile() ? -1 : 0;\n\t}\n\n\t/**\n\t * Observes linesByParentKey in case it has been updated after\n\t * dragDrop instance has been created,\n\t * @param newValue\n\t * @private\n\t */\n\t_updateDragDropParentKey(newValue) {\n\t\tif (this.dragDrop && newValue) {\n\t\t\tthis.dragDrop.linesByParentKey = newValue;\n\t\t}\n\t}\n\n\tforwardFocusDown(e) {\n\t\tif(e.keyCode === 9 && !e.shiftKey) // tab key\n\t\t\tRowFocusSignaler.signalFirstEditableTargetFirstRow(this, this.getRowComponentName(), 'data-index');\n\t}\n\n\tforwardFocusUp(e) {\n\t\tif (e.keyCode === 9 && e.shiftKey) // shift+tab key\n\t\t\tRowFocusSignaler.signalLastEditableTargetLastRow(this, this.getRowComponentName(), this.visibleLines.length, 'data-index');\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dropLeGroup,\n\t\t\tdragLeGroup = dragElement.domHost.domHost,\n\t\t\tdd = this.dragDrop;\n\t\tdd.dropKey = null;\n\t\tdd.dropIndex = null;\n\t\tdd.dropGroupModel = null;\n\t\t//  Unhide standard rows being dragged.\n\t\tfor(let k = 0, indH, l = dd.dragStandardIndexes ? dd.dragStandardIndexes.length : 0; k < l; k++){\n\t\t\tindH = dd.dragStandardIndexes[k];\n\t\t\tthis.set(`groupModel.standardLines.${indH}.hidden`, false);\n\t\t}\n\t\t//  Unhide segmented rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!dropElement) return;\n\t\t// Update the subscription scope editable property to determine whether to display the 'Percent of Total Scope'\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\t// override destination table's col width with the drag element's\n\t\t\t// so that addition of PoT column is reflected\n\t\t\tdropElement.domHost.groupModel.colWidth = dragElement.lineModel.groupModel.colWidth;\n\t\t\tdd.dragGroupModel._updateStandardSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tthis._setFieldNames();\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t\t//  Remove standard rows being dragged.\n\t\tthis._removeLinesByIndex(dd.dragStandardIndexes);\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd.dropKey = dropElement.lineModel.lineVO.key;\n\t\t\t\tdd.dropGroupModel = dropElement.lineModel.groupModel;\n\t\t\t\tdd.dropIndex = this._getLineIndexFromKey(dd.dropGroupModel.standardLines, dd.dropKey);\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost;\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dd.dropIndex;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\tcase 'emptyTableMessage':\n\t\t\t\tdropLeGroup = Polymer.dom(dropElement).getOwnerRoot().host;\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = dd._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let l = 0; l < dd.dragLineModels.length; l ++) {\n\t\t\t//Splice into new location\n\t\t\tif (!dd.dragLineModels[l].segmented) {\n\t\t\t\tif (dd.dragLineModels[l].subscriptionScopeEditable) {\n\t\t\t\t\tdd.dropGroupModel.standardSubscriptionScopeEditable = dd.dragLineModels[l].quoteModel.grouped;\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(Polymer.dom(dropLeGroup.root).querySelector('#standardLines'), () => {\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setFieldNames();\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setColumnWidths();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (dd.dragLineModels[l].visible) {\n\t\t\t\t\tswitch(className) {\n\t\t\t\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\t\t\t\tdropElement.domHost.splice('groupModel.standardLines', dd.dropIndex, 0, dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\t\t\tcase 'emptyTableMessage':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t\t// Update line model's group properties\n\t\t\t\tdd.dragLineModels[l].groupModel = dd.dropGroupModel;\n\t\t\t\tdd.dragLineModels[l].lineVO.parentGroupKey = dd.dropGroupModel.groupKey;\n\t\t\t\tdd.dropIndex++;\n\t\t\t} else {\n\t\t\t\tif (dd.dragGroupModel.groupKey === dd.dropGroupModel.groupKey) continue;  //  Only add segment row if group is different\n\t\t\t\tif (!dd.dropGroupModel.dimensions.includes(dd.dragLineModels[l].segmentType)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dd.dragLineModels[l]);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//  Remove mdq rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tdd.dragMdqIndexesByDim[k].reverse();\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t\tif(dd.dragGroupModel.groupKey !== dd.dropGroupModel.groupKey){  //  Only remove segment row if group is different\n\t\t\t\t\t\tlet mdqLm = dragLeGroup.groupModel.segmentedLinesByDimension[k][index];\n\t\t\t\t\t\tdragLeGroup.removeSegmentedLine(mdqLm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\n\t\tthis.postDrop(dragElement, dropElement);\n\t}\n\n\t_lineSplicesListener(changeRecord) {\n\t\tif (!changeRecord) return;   //when a new groupModel is assigned, changeRecord is undefined\n\t\tthis.set('groupModel.hasVisibleStandardLines', this.groupModel._groupHasStandardProducts());\n\t\tthis._showSubtotal();\n\t}\n\n\t/**\n\t * Post DnD operation\n\t * @param dragElement\n\t * @param dropElement\n\t */\n\tpostDrop(dragElement, dropElement) {}\n\n\t/**\n\t * Post buildRow refresh\n\t */\n\tpostBuildRowRefresh() {};\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.QLEStandardTableBehavior = QLEStandardTableBehavior.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\nimport {MobileLETemplateGenerator} from 'quotes/layout/template-generator/MobileLETemplateGenerator.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst ENTER_KEY = 13;\nconst SPACE_KEY = 32;\nconst ESC_KEY = 27;\nconst TAB_KEY = 9;\nconst LEFT_KEY = 37;\nconst RIGHT_KEY = 39;\nconst UP_KEY = 38;\nconst DOWN_KEY = 40;\n\nconst IGNORED_ELEMENT_KEYS = {\n\t'INPUT': new Set([LEFT_KEY, RIGHT_KEY]),\n\t'TEXTAREA': new Set([LEFT_KEY,RIGHT_KEY,UP_KEY,DOWN_KEY]),\n\t'SELECT': new Set([UP_KEY, DOWN_KEY])\n}\n\n/**\n * Abstract table-level component for QuoteLineEditor.  This contains common methods to all QLE table variants\n */\nexport class SFAbstractTable {\n\tgetTemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary) {\n\t\tif (AppContext.isMobile) {\n\t\t\treturn new MobileLETemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary);\n\t\t}\n\t\treturn new LETemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary);\n\t}\n\n\t/** focusout event listener.  Removes focused UI treatment if user clicks outside this table (either on document body or another table) */\n\t_onFocusOut(e) {\n\t\t// If focusOut is by clicking actions involving calculation, calculate immediately can be suppressed\n\t\tlet suppressCalculateImmediately = false;\n\t\tif (e.relatedTarget != null && e.relatedTarget.parentElement != null &&\n\t\t\te.relatedTarget.parentElement.tagName === 'SB-CUSTOM-ACTION' &&\n\t\t\te.relatedTarget.parentElement.customAction != null) {\n\t\t\tlet relatedEventHandlerName = e.relatedTarget.parentElement.customAction.eventHandlerName;\n\t\t\tif (relatedEventHandlerName === 'onQuickSave' || relatedEventHandlerName === 'onSave' ||\n\t\t\t\trelatedEventHandlerName === 'onFlagCalculate') {\n\t\t\t\tsuppressCalculateImmediately = true;\n\t\t\t}\n\t\t}\n\t\t// need to use setTimeout here to avoid native event sequencing issues around document.activeElement\n\t\tsetTimeout((suppCalImm) => {\n\n\t\t\tlet cell = null;\n\t\t\tlet isSameTable = false;\n\n\t\t\tlet elem = document.activeElement;\n\t\t\twhile (elem) {\n\t\t\t\tif (elem.classList && elem.classList.contains('focusable')) {\n\t\t\t\t\tcell = elem;\n\t\t\t\t} else if (elem.tagName === 'SF-STANDARD-TABLE' || elem.tagName === 'SF-SEGMENTED-TABLE' || elem.tagName === 'UBP-RATE-TABLE') {\n\t\t\t\t\tisSameTable = Polymer.dom(elem).node === this;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telem = elem.parentElement;\n\t\t\t}\n\n\t\t\tif (cell === null || !isSameTable) {\n\t\t\t\tthis.removeCellFocus(this.focusedCell, suppCalImm);\n\t\t\t}\n\t\t}, 5, suppressCalculateImmediately);\n\t}\n\n\t/** onkeydown event listener.  Performs common table-level key actions on cells */\n\t_onKeyDown( e ) {\n\t\tswitch ( e.keyCode ) {\n\t\t\tcase ENTER_KEY:\n\t\t\t\tthis._onEnterKeyPress(e);\n\t\t\t\tbreak;\n\t\t\tcase SPACE_KEY:\n\t\t\t\tthis._onSpaceBarPress(e);\n\t\t\t\tbreak;\n\t\t\tcase ESC_KEY:\n\t\t\t\tthis._onEscapePress(e);\n\t\t\t\tbreak;\n\t\t\tcase TAB_KEY:\n\t\t\t\tthis._moveCellFocus( e, e.shiftKey ? 'left' : 'right' );\n\t\t\t\tbreak;\n\t\t\tcase LEFT_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'left' );\n\t\t\t\tbreak;\n\t\t\tcase UP_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'up' );\n\t\t\t\tbreak;\n\t\t\tcase RIGHT_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'right' );\n\t\t\t\tbreak;\n\t\t\tcase DOWN_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'down' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Handle escape key press\n\t * @param e\n\t * @private\n\t */\n\t_onEscapePress(e) {\n\t\tif (this._routeKeyEvent(e)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._toggleInlineEditIfFocused( e, false );\n\t\tthis._editOnFocus = false;\n\t\tif (this.focusedCell) {\n\t\t\tthis.applyCellFocus(this.focusedCell);\n\t\t}\n\t}\n\n\t/**\n\t * Handle space bar press\n\t * @param e\n\t * @private\n\t */\n\t_onSpaceBarPress(e) {\n\t\tif (this._routeKeyEvent(e)) {\n\t\t\treturn;\n\t\t}\n\t\t// If it toggled a inline editable cell, update editOnFocus\n\t\tthis._editOnFocus = !!this._toggleInlineEditIfFocused( e, true );\n\t}\n\n\t/**\n\t * Route a keyboard event to row level\n\t * @param e\n\t * @return {boolean} whether event should stop propagation\n\t * @private\n\t */\n\t_routeKeyEvent(e) {\n\t\tlet parentRow = findParentRow(e.target);\n\t\tif (parentRow && parentRow.onKeyDown) {\n\t\t\t// this means the row decides to stop propagation\n\t\t\treturn parentRow.onKeyDown(e);\n\t\t}\n\n\t}\n\n\t/**\n\t * Handle ENTER key, which could be the trigger for both turning on or off inline edit\n\t * @param e\n\t * @private\n\t */\n\t_onEnterKeyPress(e) {\n\t\tlet cell = SFAbstractTable.findCell(e, this.getCellClass());\n\t\tif (this._isCellFocusedAndInteractive(cell)) {\n\t\t\t// enter key can either trigger inline edit or commit a change, so it's truly toggling\n\t\t\tlet isEditing = cell.classList.contains(TemplateGenerator.classNames.EDIT_MODE);\n\t\t\tlet metadata = getCellMetadata( cell );\n\n\t\t\tif( metadata && isEditing && (metadata.type === 'textarea' || metadata.type === 'reference' || metadata.type === 'id') )\n\t\t\t\treturn; // do nothing with enter in textarea or lookup so those natively can handle\n\n\t\t\t// for IE and FF, we need to explicitly unfocus on the input element so that it fires onChange event\n\t\t\t// for Chrome the event is fired implicitly when write element is removed\n\t\t\tif (isEditing && document.activeElement) {\n\t\t\t\tdocument.activeElement.blur();\n\t\t\t}\n\t\t\t// If it toggled a inline editable cell, update editOnFocus\n\t\t\tthis._editOnFocus = !!this._toggleInlineEditIfFocused( e, !isEditing );\n\t\t\tif (isEditing && this.focusedCell) {\n\t\t\t\t// put the focus back on the cell after inline edit is off\n\t\t\t\tthis.applyCellFocus(this.focusedCell);\n\t\t\t}\n\t\t}\n\t}\n\n\t_toggleTappableCell(cell, parentRow, evt) {\n\t\tif (cell.classList.contains(TemplateGenerator.classNames.TAPPABLE)) {\n\t\t\tparentRow.hook_onTap(evt, false);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_openLookupDialog() {\n\t\tthis.keepEditableFocus = true; // keep cell in \"focus\" and in edit mode while Lookup Dialog is open\n\t}\n\n\t_closeLookupDialog() {\n\t\tthis.keepEditableFocus = false; // reset it so next key/mouse action can toggle inline edit on lookup cell\n\t}\n\n\t_toggleInlineEditIfFocused( e, isEdit ) {\n\t\tlet cell = SFAbstractTable.findCell(e, this.getCellClass());\n\t\tif (this._isCellFocusedAndInteractive(cell)) {\n\t\t\tlet parentRow = findParentRow(cell);\n\t\t\tif (parentRow) {\n\t\t\t\tif (!this._toggleTappableCell(cell, parentRow, e)) {\n\t\t\t\t\tparentRow.toggleInlineEdit(cell, isEdit);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\t_isCellFocusedAndInteractive(cell) {\n\t\treturn cell && cell.classList && cell.classList.contains(TemplateGenerator.classNames.HAS_FOCUS) &&\n\t\t\t(cell.classList.contains(TemplateGenerator.classNames.EDITABLE) || cell.classList.contains(TemplateGenerator.classNames.TAPPABLE));\n\t}\n\n\t/**\n\t * Remove focus for the current focused cell (this.focusedCell)\n\t */\n\tunfocus() {\n\t\tthis.removeCellFocus(this.focusedCell);\n\t}\n\n\tremoveCellFocus( cell , suppressCalculateImmediately) {\n\t\tif( cell && cell.classList && cell.classList.contains( TemplateGenerator.classNames.HAS_FOCUS ) && !this.keepEditableFocus ) {\n\t\t\tlet parentRow = findParentRow( cell );\n\t\t\tif( parentRow ) {\n\t\t\t\tparentRow.toggleInlineEdit( cell, false, false, suppressCalculateImmediately );\n\t\t\t\tparentRow.toggleCellClass(TemplateGenerator.classNames.HAS_FOCUS, false, cell, cell.getAttribute('field'));\n\t\t\t}\n\t\t\tif (cell === this.focusedCell) {\n\t\t\t\tthis.focusedCell = null;\n\t\t\t}\n\t\t\treturn parentRow;\n\t\t}\n\t}\n\n\tapplyCellFocus( cell ) {\n\t\t// apply focus if the cell isn't already in focus\n\t\tif( cell && cell.classList ) {\n\t\t\t// need to use setTimeout here as some browsers are quirky with native focus/blur event sequence\n\t\t\tsetTimeout( () => {\n\t\t\t\t// focus on the first focusable element if the cell is a container (e.g., sf-line-action)\n\t\t\t\tif (!cell.classList.contains('focusable') && cell.querySelector('.focusable')) {\n\t\t\t\t\tcell = cell.querySelector('.focusable');\n\t\t\t\t}\n\t\t\t\tif (!this._isMobile()) {\n\t\t\t\t\tcell.focus();\n\t\t\t\t}\n\t\t\t\tlet parentRow = findParentRow(cell);\n\t\t\t\tif (parentRow) {\n\t\t\t\t\tparentRow.toggleCellClass(TemplateGenerator.classNames.HAS_FOCUS, true, cell, cell.getAttribute('field'));\n\t\t\t\t}\n\t\t\t\tif (this.focusedCell !== cell && this.focusedCell) {\n\t\t\t\t\tthis.removeCellFocus(this.focusedCell);\n\t\t\t\t}\n\t\t\t\tthis.focusedCell = cell;\n\t\t\t}, 10 );\n\t\t}\n\t}\n\n\t_isMobile() {\n\t\treturn AppContext.isMobile;\n\t}\n\t/**\n\t * When editOnFocus is turned on, cell will enter edit mode immediately upon focus\n\t * @param value\n\t */\n\tsetEditOnFocus(value) {\n\t\tthis._editOnFocus = value;\n\t}\n\n\t/**\n\t * Moves the focus of the current cell in the direction specified (up/left/right/down)\n\t * @param  {event} e the current mouse/key event.  Must be an event on/or bubbled to a table Cell\n\t * @param  {string} direction up/down/left/right\n\t * @return {null}\n\t */\n\t_moveCellFocus( e, direction ) {\n\t\t// don't move focus if the key should be ignored for the native input/textarea/select element\n\t\tif( e && direction && !isIgnored( e ) ) {\n\t\t\tlet cell = SFAbstractTable.findCell( e, 'focusable' );\n\t\t\tif( cell ) {\n\t\t\t\tlet row = findParentRow( cell ), newParentRow = row;\n\t\t\t\tlet nextCell = null;\n\t\t\t\tif (row) {\n\t\t\t\t\tlet parentEl = row.getContentNode().querySelector('div');\n\t\t\t\t\tswitch( direction ) {\n\t\t\t\t\t\tcase 'up':\n\t\t\t\t\t\tcase 'down':\n\t\t\t\t\t\t\tlet isUp = direction === 'up' ? true : false;\n\t\t\t\t\t\t\tlet isEditing = cell.classList.contains(TemplateGenerator.classNames.EDIT_MODE);\n\t\t\t\t\t\t\tlet metadata = getCellMetadata(cell, row);\n\t\t\t\t\t\t\tif( metadata && isEditing && (metadata.type === 'reference' || metadata.type === 'id' || metadata.type === 'date' || metadata.type === 'datetime' ) )\n\t\t\t\t\t\t\t\treturn; // ignore up/down in lookup and datepicker so they can natively consume those keys\n\n\t\t\t\t\t\t\tlet adjRow = findAdjacentRow( row, isUp, this._rowHasParentDiv() );\n\t\t\t\t\t\t\tif( adjRow ) {\n\t\t\t\t\t\t\t\tnewParentRow = adjRow;\n\t\t\t\t\t\t\t\tlet index = getCellRowIndex( parentEl, cell );\n\t\t\t\t\t\t\t\tnextCell = adjRow.getCellByIndex( index );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'left':\n\t\t\t\t\t\tcase 'right':\n\t\t\t\t\t\t\tlet focusableChildren = parentEl.querySelectorAll('.focusable');\n\t\t\t\t\t\t\tlet index = Array.from( focusableChildren ).indexOf( cell ),\n\t\t\t\t\t\t\t\tisLeft = direction == 'left' ? true : false,\n\t\t\t\t\t\t\t\tlen = focusableChildren.length;\n\n\t\t\t\t\t\t\tif( (index == 0 && isLeft) || (!isLeft && index == len-1) ) {\n\t\t\t\t\t\t\t\tlet adjRow = findAdjacentRow( row, isLeft, this._rowHasParentDiv() );\n\t\t\t\t\t\t\t\tif( adjRow ) {\n\t\t\t\t\t\t\t\t\tnewParentRow = adjRow;\n\t\t\t\t\t\t\t\t\tnextCell = isLeft ? adjRow.getCellByIndex(len-1) : adjRow.getCellByIndex(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tnextCell = focusableChildren[index + (isLeft ? -1 : 1)];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nextCell) {\n\t\t\t\t\tthis.applyCellFocus(nextCell);\n\t\t\t\t\t// also turn on inline edit if preserveEdit is true and the old cell is currently being edited\n\t\t\t\t\tif (this._editOnFocus && newParentRow) {\n\t\t\t\t\t\tnewParentRow.toggleInlineEdit(nextCell, true, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Indicate whether a table row has a parent div, this is the case for LQE and UBP\n\t * @returns {*}\n\t * @private\n\t */\n\t_rowHasParentDiv() {\n\t\treturn this.editorModel && this.editorModel.largeQuoteExperienceEnabled;\n\t}\n\n\t/**\n\t * Find the first td or decorated element in DOM ancestor tree from given event\n\t * @param event The event that contains the cell path\n\t * @param cellClass The decorating CSS class, 'sf-le-table-cell'\n\t * @return the cell container element if found, null otherwise\n\t */\n\tstatic findCell(e, cellClass = 'sf-le-table-cell') {\n\t\treturn Polymer.dom(e).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(cellClass);\n\t\t});\n\t}\n\n\t/**\n\t * CSS class to identify cell elements\n\t * @returns {string}\n\t */\n\tgetCellClass() {\n\t\treturn 'sf-le-table-cell';\n\t}\n}\n\nfunction getCellRowIndex( row, cell ) {\n\t// traverse up the DOM tree if cell is not a direct child of the row element\n\twhile (cell.parentElement !== row && cell.parentElement) {\n\t\tcell = cell.parentElement;\n\t}\n\treturn Array.from( row.children ).indexOf( cell );\n}\n\nfunction findAdjacentRow( cur, isUp, isLQE ) {\n\tif( cur ) {\n\t\tlet curTag = cur.tagName,\n\t\t\t\tprop = isUp ? 'previousElementSibling' : 'nextElementSibling';\n\n\t\tif (!isLQE) {\n\t\t\tlet adj = cur[prop];\n\t\t\twhile (adj) {\n\t\t\t\tif (adj && adj.tagName == curTag) {\n\t\t\t\t\treturn adj;\n\t\t\t\t}\n\t\t\t\tadj = adj[prop]\n\t\t\t}\n\t\t} else {\n\t\t\t// for LQE, there is a parent div\n\t\t\tlet adjParent = cur.parentElement[ prop ];\n\t\t\twhile (adjParent) {\n\t\t\t\tfor (let child of adjParent.children) {\n\t\t\t\t\t// Check that the row is visible by looking at its style display\n\t\t\t\t\tif (child && child.tagName == curTag && child.style.display !== 'none') {\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tadjParent = adjParent[prop];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n}\n\n/**\n * Gets the metadata for the cell\n * @param  {object} cell the cell DOM element\n * @param  {object} [row]  the row DOM element, if already known.\n * @return {object}      the cell's metadata, null if not found\n */\nfunction getCellMetadata( cell, row ) {\n\tlet field = cell ? cell.getAttribute('field') : null;\n\tif( !row ) {\n\t\trow = cell ? findParentRow( cell ) : null;\n\t}\n\treturn row && field ? row._getFieldMetadata(field) : null;\n}\n\nfunction findParentRow(el) {\n\tif( el && el.parentElement ) {\n\t\tif( el.parentElement.tagName === 'SF-LE-TABLE-ROW' || el.parentElement.tagName === 'UBP-RATE-ROW')\n\t\t\treturn el.parentElement;\n\t\telse\n\t\t\treturn findParentRow( el.parentElement );\n\t}\n}\n\n/**\n * Returns true if the keyCode of the event should be ignored for the target element.\n * @param  {[type]}  e The event object\n */\nfunction isIgnored( e ) {\n\tlet tag = e.target && e.target.tagName ? e.target.tagName : '',\n\t\t\tel = IGNORED_ELEMENT_KEYS[tag];\n\treturn el && el.has(e.keyCode);\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFAbstractTable = SFAbstractTable.prototype;\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n *\n * Common behavior for table header\n  *\n * @author kzheng\n * @since 216\n *\n */\n\nimport {AppContext} from \"common/core/AppContext.js\";\n\nexport class SFTableHeaderBehavior {\n\n\tstatic get properties() {\n\n\t\treturn {\n\t\t\t// column width for resizing\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: \"_columnsResized\"\n\t\t\t},\n\t\t\t// tracks last sort order: 'asc' for ascending, 'desc' gor descending and '' for neutral\n\t\t\tbyOrder: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\t// tracks field used for last sort\n\t\t\tlastSortedByField: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tfieldSetName: String,\n\t\t}\n\t}\n\t/**\n\t * When mousedown occurs on the header\n\t * @param e\n\t */\n\tstartResize(e) {\n\t\tif (AppContext.isColumnResizingEnabled) {\n\t\t\te.preventDefault();\n\t\t\tlet elem = e.target;\n\t\t\tlet cellHeaderElem = elem.parentElement;\n\t\t\tif (elem.classList.contains('col-adj-bar') && cellHeaderElem.getAttribute('field') != null) {\n\t\t\t\tlet indicator = this.querySelector('div#col-resize-indicator');\n\t\t\t\tlet offset = this.getBoundingClientRect().x;\n\t\t\t\tdocument._currentHeaderSource = this; // What header to place the indicator at\n\t\t\t\tthis._currentHeaderCell = cellHeaderElem;\n\t\t\t\tthis._currentCellWidth = parseFloat(cellHeaderElem.style.maxWidth.replace('px', ''));\n\t\t\t\tthis._mouseXStartPos = e.clientX - offset;\n\t\t\t\tthis._currOffset = -offset; // used for onResize when moving the mouse\n\t\t\t\tindicator.style.transform = `translate3d(${this._mouseXStartPos}px, 0px, 0px)`;\n\t\t\t\tindicator.style.visibility = 'visible';\n\t\t\t\tthis._changeVisibilityOnColAdjBars(this, 'hidden');\n\t\t\t\tdocument.addEventListener('mousemove', this._onResize, false);\n\t\t\t\tdocument.addEventListener('mouseup', this._stopResize, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * When mousemove occurs:\n\t * This method updates the position of the indicator to the mouse's new position\n\t * It also updates the header cell's global attr: new header size, updated mouse position\n\t * @param e\n\t * @private\n\t */\n\t_onResize(e) {\n\t\tlet tableHeader = this._currentHeaderSource;\n\t\tlet indicator = tableHeader.querySelector('div#col-resize-indicator');\n\t\t// Get the starting position of the mouse along with the offset to calculate\n\t\t// the new position and the headers width\n\t\tlet mousePosition = (e.clientX + tableHeader._currOffset);\n\t\tlet currOffset = tableHeader._mouseXStartPos - mousePosition;\n\t\t// The updated header cell's width after the indicator moved.\n\t\tlet cellsWidth = tableHeader._currentCellWidth - currOffset;\n\t\t// Cells width cannot be smaller than 67 pixels\n\t\tif (cellsWidth > 67) {\n\t\t\ttableHeader._currentCellWidth = cellsWidth; // set the new cells width\n\t\t\ttableHeader._mouseXStartPos = mousePosition; // mouse/indicators new position\n\t\t\tindicator.style.transform = `translate3d(${tableHeader._mouseXStartPos}px, 0px, 0px)`;\n\t\t}\n\t}\n\n\t/**\n\t * When mouseup occurs:\n\t * Grab the global attr and fire the event to update the column size\n\t * @param e\n\t * @private\n\t */\n\t_stopResize(e) {\n\t\te.preventDefault();\n\t\tlet tableHeaderElem = this._currentHeaderSource;\n\t\tlet currentHeaderCell = tableHeaderElem._currentHeaderCell;\n\t\tlet indicator = tableHeaderElem.querySelector('div#col-resize-indicator');\n\t\ttableHeaderElem._changeVisibilityOnColAdjBars(tableHeaderElem, 'visible');\n\t\tindicator.style.visibility = 'hidden';\n\t\tthis.removeEventListener('mousemove', tableHeaderElem._onResize, false);\n\t\tthis.removeEventListener('mouseup', tableHeaderElem._stopResize, false);\n\t\ttableHeaderElem.fire('sf-col-size-adjusted',  {\n\t\t\tfieldsWidth: tableHeaderElem._currentCellWidth,\n\t\t\tfield: currentHeaderCell.getAttribute('field'),\n\t\t\tdimension: tableHeaderElem.lineModels[0].dimensionType,\n\t\t\tfieldSet: tableHeaderElem.fieldSetName,\n\t\t});\n\t\tdelete this._currentHeaderSource;\n\t}\n\n\tonHover(evt) {\n\t\tlet fieldDiv = this.findElementForEvent(evt, 'th');\n\t\tif (fieldDiv) {\n\t\t\tlet field = fieldDiv.getAttribute('field');\n\t\t\tif (field) {\n\t\t\t\tthis.showTooltip(fieldDiv, this.getTooltipContent(field));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Lazy create paper tooltip for header cell\n\t * @param cell the header cell\n\t * @content text content of the tooltip\n\t */\n\tshowTooltip(headerCell, content) {\n\t\tif (!headerCell.querySelector('paper-tooltip')) {\n\t\t\tlet tooltipCmp = document.createElement('paper-tooltip');\n\t\t\ttooltipCmp.position = 'bottom';\n\t\t\ttooltipCmp.animationDelay = 0;\n\t\t\ttooltipCmp.fitToVisibleBounds = 'true';\n\t\t\theaderCell.appendChild(tooltipCmp);\n\t\t\tPolymer.dom(tooltipCmp).textContent = content;\n\t\t}\n\t}\n\n\t/**\n\t * Tap behavior, handles checkbox selection and sorting\n\t * @param evt\n\t */\n\tonTap(evt) {\n\t\tif (this.onTap_hook(evt)) {\n\t\t\treturn;\n\t\t}\n\t\t// checkbox selection\n\t\tlet cbContainer = this.findElementForEvent(evt, 'checkboxcontainer');\n\t\tif (cbContainer) {\n\t\t\tthis.toggleSelection(cbContainer);\n\t\t\treturn;\n\t\t}\n\t\tlet headerCell = this.findElementForEvent(evt, 'sortable');\n\t\tif (headerCell) {\n\t\t\tthis.sortLines(headerCell);\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Given an event, look for an element that contains the expected class in the event's path\n\t * @param event\n\t * @param clazz\n\t */\n\tfindElementForEvent(event, clazz) {\n\t\treturn Polymer.dom(event).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(clazz);\n\t\t});\n\t}\n\n\t/**\n\t * Invoked when column width values are changed\n\t * @param newValue\n\t * @param oldValue\n\t * @private\n\t */\n\t_columnsResized(newValue, oldValue) {\n\t\t// only interested in resizing, i.e., when old value is already set\n\t\tif (newValue != null && oldValue != null) {\n\t\t\tObject.keys(newValue).forEach((field) => {\n\t\t\t\tlet container = this.$$(`div.th[field='${field}']`);\n\t\t\t\tif (container) {\n\t\t\t\t\tcontainer.style.minWidth = newValue[field] + 'px';\n\t\t\t\t\tcontainer.style.maxWidth = newValue[field] + 'px';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t_changeVisibilityOnColAdjBars(headerElem, visibility) {\n\t\tlet columnAdjBars = headerElem.querySelectorAll('.col-adj-bar');\n\t\tcolumnAdjBars.forEach((adjBar) => {\n\t\t\tadjBar.style.visibility = visibility;\n\t\t});\n\t}\n\n\n/**\n\t * Update header cell sort visually and fire 'table-header-sort-clicked' event\n\t * @param headerCell\n\t */\n\tsortLines(headerCell) {\n\t\tif (this.lastSortedByField !== headerCell.getAttribute('field')){\n\t\t\tthis.byOrder = '';\n\t\t}\n\t\tthis.resetHeaderCellStyles();\n\t\tthis.updateSortColumnHeaderStyles(headerCell, this._getNewByOrder(this.byOrder));\n\t\tthis._fireSortClickedEvent(headerCell);\n\t}\n\n\tresetHeaderCellStyles() {\n\t\tlet headers = this.querySelectorAll('.sortable');\n\t\tfor(let i = 0; i < headers.length; i++) {\n\t\t\tthis._resetHeaderCellState(headers[i]);\n\t\t}\n\t}\n\n\t/**\n\t * Reset sorted header cell state back to neutral by clearing styles\n\t * @param headerCell\n\t * @param arrow\n\t *\n\t */\n\t_resetHeaderCellState(headerCell) {\n\t\tlet arrow = headerCell.querySelector('.arrow');\n\t\tif (arrow) {\n\t\t\tthis.toggleClass('sf-icon-arrowup', false, arrow);\n\t\t\tthis.toggleClass('sf-icon-arrowdown', false, arrow);\n\t\t\tthis.toggleClass('arrow-on-hover', true, headerCell);\n\t\t\tthis.toggleClass('column-selected', false, headerCell);\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to fire 'table-header-sort-clicked' event\n\t * @param headerCell\n\t */\n\t_fireSortClickedEvent(headerCell) {\n\t\tlet data = {lineSortField: headerCell.getAttribute('field'), order: this.byOrder};\n\t\tthis.fire('table-header-sort-clicked', data);\n\t}\n\n\t/**\n\t * Get new byOrder based on the previous one\n\t * @param byOrder\n\t */\n\t_getNewByOrder(byOrder) {\n\t\tswitch (byOrder) {\n\t\t\tcase 'asc':\n\t\t\t\treturn 'desc';\n\t\t\tcase 'desc':\n\t\t\t\treturn '';\n\t\t\tcase '':\n\t\t\t\treturn 'asc';\n\t\t\tdefault:\n\t\t\t\treturn 'asc';\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to update header cell sort visually by updating styles for sort column header cell\n\t * used when update needs to be called externally (ex. by parent cmp)\n\t * @param headerCell\n\t * @param byOrder\n\t * @param updateHeaderState (pass true when called externally to update header internal state)\n\t **/\n\tupdateSortColumnHeaderStyles(headerCell, byOrder) {\n\t\tlet arrow = headerCell.querySelector('.arrow');\n\t\tthis.toggleClass('column-selected', true, headerCell);\n\t\tthis.toggleClass('arrow-on-hover', false, headerCell);\n\t\tif (byOrder === 'asc'){\n\t\t\tthis.toggleClass('sf-icon-arrowup', true, arrow);\n\t\t\tthis.toggleClass('sf-icon-arrowdown', false, arrow);\n\t\t} else if (byOrder === 'desc'){\n\t\t\tthis.toggleClass('sf-icon-arrowup', false, arrow);\n\t\t\tthis.toggleClass('sf-icon-arrowdown', true, arrow);\n\t\t} else if (byOrder === '') {\n\t\t\tthis._resetHeaderCellState(headerCell);\n\t\t}\n\t\tthis.lastSortedByField = headerCell.getAttribute('field');\n\t\tthis.byOrder = byOrder;\n\t}\n\n\t/**\n\t * Invoked when checkboxcontainer is toggled\n\t * @param cbContainer The element with checkboxcontainer class\n\t */\n\ttoggleSelection(cbContainer) { }\n\n\t/**\n\t * Callback for composing component's onTap handling\n\t * @param evt\n\t * @return true if onTap is handled\n\t */\n\tonTap_hook(evt) { }\n\n\t/**\n\t * Retrieve tooltip content for a given field\n\t * @param field\n\t * @returns {string}\n\t */\n\tgetTooltipContent(field) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Sets new header sort state and styles\n\t * called by parent component\n\t * @param field\n\t * @param order\n\t */\n\tsetSort(field, order) {\n\t\t// do not reset or update style if table header is already in the right state\n\t\tif (field === this.lastSortedByField && order === this.byOrder) {\n\t\t\treturn;\n\t\t}\n\t\tthis.resetHeaderCellStyles();\n\t\tlet newSortCell = this._getHeaderCell(field);\n\t\tif (newSortCell) {\n\t\t\tthis.updateSortColumnHeaderStyles(newSortCell, order);\n\t\t}\n\t}\n\n\t_getHeaderCell(sortField) {\n\t\treturn this.querySelector(\"div[field='\" + sortField + \"']\");\n\t}\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFTableHeaderBehavior = SFTableHeaderBehavior.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFComponentFactory} from 'quotes/sf-component-factory/SFComponentFactory.js';\nimport {Localizer} from 'quotes/layout/sb-le-table-cell/Localizer.js';\nimport {toFieldName} from 'common/Util.js';\n\n/**\n * Data management utility to prepare presentation-ready data from raw record data\n *\n * @author kzheng\n * @since 212\n */\n\nexport class UIDataManager {\n\n\t/**\n\t * For each row, prepare the data required to stamp the row template\n\t * @param standardLines\n\t * @param fieldSet\n\t * @param quoteLineFields\n\t * @return Array of objects representing ui data\n\t */\n\tstatic prepareLineData(standardLines, fieldSet, quoteLineFields) {\n\t\t// set ui_original_record if it was not set yet (ex. it is null after 'Quick Save')\n\t\t// preparing uiData may mutate record thus we want to create ui_original_record first\n\t\tlet uiData = [];\n\t\tif(standardLines) {\n\t\t\tstandardLines.forEach(function (lineModel, lineIndex) {\n\t\t\t\tif(lineModel.lineVO.ui_original_record == null) {\n\t\t\t\t\tlineModel.lineVO.ui_original_record = JSON.parse(JSON.stringify(lineModel.lineVO.record));\n\t\t\t\t}\n\t\t\t\tlet recordUI = this.prepareSingleLineData(lineModel, lineIndex, fieldSet, quoteLineFields);\n\t\t\t\tuiData.push(recordUI);\n\t\t\t}.bind(this));\n\t\t}\n\t\treturn uiData;\n\t}\n\n\t/**\n\t * Prepare recordUI for a single line\n\t * @param lineModel\n\t * @param lineIndex\n\t * @returns {} a single recordUI map object\n\t */\n\tstatic prepareSingleLineData(lineModel, lineIndex, fieldSet, quoteLineFields) {\n\t\tlet record = lineModel.lineVO.record;\n\t\tlet recordUI = { Id: record.Id };\n\t\tlet fieldVisibility = lineModel.lineVO.fieldVisibility;\n\n\t\tfieldSet.forEach(function(field) {\n\t\t\tlet fieldMetadata = quoteLineFields[field];\n\t\t\trecordUI[field] = this.prepareFieldData(record, field, fieldMetadata, lineModel, fieldVisibility);\n\t\t\tthis.computeCellClass(record, field, recordUI, lineModel, fieldVisibility, fieldMetadata);\n\t\t}.bind(this));\n\n\t\t// Add segmented line data to the recordUI property\n\t\tif (lineModel.hasOwnProperty('segments')) {\n\t\t\tthis.prepareSegmentedLineData(lineModel, record, recordUI, quoteLineFields, fieldVisibility);\n\t\t}\n\n\t\tlet constants = lineModel.editorModel.constants;\n\t\trecordUI.lineNumber = record[constants.NUMBER_FIELD];\n\t\trecordUI.rowIndex = lineIndex;\n\t\trecordUI.lineModel = lineModel;\n\t\t// disable checkbox when lineModel is a component (part of a product bundle)\n\t\tthis.prepareSelectionCheckbox(lineModel, recordUI);\n\t\t// warning icons\n\t\tthis.prepareWarningIcon(lineModel, recordUI);\n\t\t// bundle caret\n\t\tthis.prepareBundleCaret(lineModel, recordUI);\n\t\tif(!recordUI._cellClasses) {\n\t\t\t// Add empty cell classes so if row changes, classes update.\n\t\t\trecordUI._cellClasses = {};\n\t\t}\n\t\treturn recordUI;\n\t}\n\n\t/**\n\t * Parent lines in a bundle has dynamic caret depending on the line's expansion state\n\t * @param lineModel\n\t * @param recordUI\n\t */\n\tstatic prepareBundleCaret(lineModel, recordUI) {\n\t\tif (lineModel.editorModel.isProductHierarchyVisualized() && !lineModel.segmented && lineModel.isBundle) {\n\t\t\trecordUI._caretContent = lineModel.bundleCollapsed ?\n\t\t\t\tTemplateGenerator.classNames.CHEVRON_RIGHT_CONTENT :\n\t\t\t\tTemplateGenerator.classNames.CHEVRON_DOWN_CONTENT;\n\t\t\t// If we're collapsible we want to focus on the caret individually\n\t\t\tif (AppContext.isBundleCollapsible(lineModel.editorModel)) {\n\t\t\t\trecordUI._cellClasses = recordUI._cellClasses || {};\n\t\t\t\trecordUI._cellClasses._isFocusable = 'focusable';\n\t\t\t}\n\t\t} else {\n\t\t\trecordUI._caretContent = '';\n\t\t}\n\t}\n\n\t/**\n\t * When multi-line delete is enabled, some checkboxes may need to be disabled\n\t * @param lineModel\n\t * @param recordUI\n\t */\n\tstatic prepareSelectionCheckbox(lineModel, recordUI) {\n\t\tif (lineModel.editorModel.data.settings.multiLineDeleteEnabled && lineModel.component) {\n\t\t\trecordUI._cellClasses = recordUI._cellClasses || {};\n\t\t\trecordUI._cellClasses._selectionCB = TemplateGenerator.classNames.DISABLED;\n\t\t}\n\t}\n\n\t/**\n\t * Each line may display a warning icon when valid pricebook entry doesn't exist\n\t * @param lineModel\n\t * @param recordUI\n\t */\n\tstatic prepareWarningIcon(lineModel, recordUI) {\n\t\tif (lineModel.lineVO.validPricebookEntryExists === false) {\n\t\t\trecordUI.hasLineWarning = true;\n\t\t\tif (lineModel.groupModel.quoteModel.isPrimary && lineModel.lineVO.opportunityLineItemExists == false) {\n\t\t\t\trecordUI.lineWarningKey = 'missingOpportunityLineItem';\n\t\t\t\trecordUI.lineWarningMsg = 'This product will not sync to the opportunity because a valid pricebook entry does not exist.';\n\t\t\t} else {\n\t\t\t\trecordUI.lineWarningKey = 'invalidPricebookEntry';\n\t\t\t\trecordUI.lineWarningMsg = 'There is not a valid price book entry for this line item.';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Prepare the content of each field\n\t * @param record\n\t * @param field\n\t * @param fieldMetadata\n\t * @param lineModel\n\t * @param fieldVisibility\n\t * @returns {*}\n\t */\n\tstatic prepareFieldData(record, field, fieldMetadata, lineModel, fieldVisibility) {\n\t\t// check field visibility\n\t\tif (fieldVisibility && fieldVisibility[field] === false) {\n\t\t\treturn '';\n\t\t}\n\t\t// suppress non-editable subscription scope field\n\t\tif (QuoteContext.isSubscriptionScopeField(field) && !lineModel.subscriptionScopeEditable) {\n\t\t\treturn '';\n\t\t}\n\t\t// override list unit price with \"Included\" for bundled QuoteLine\n\t\tif (lineModel.bundled && QuoteContext.isListPriceField(field)) {\n\t\t\treturn AppContext.properties.i18n.value().l('Included');\n\t\t}\n\t\t// localization\n\t\tlet localizedValue = Localizer.getLocalizedValue(lineModel, field);\n\t\tif (localizedValue) {\n\t\t\treturn localizedValue;\n\t\t}\n\t\tif (fieldMetadata) {\n\t\t\tlet metadata = this._getFieldMetadata(record, fieldMetadata, lineModel);\n\t\t\tlet originalRecord = lineModel.lineVO.ui_original_record;\n\t\t\t// for unpersisted record, set and use default field value if the field is not found\n\t\t\tif ((!record.Id && !record.hasOwnProperty(field)) && (originalRecord && !originalRecord.Id &&\n\t\t\t\t!originalRecord.hasOwnProperty(field)) && metadata.defaultValue) {\n\t\t\t\tlineModel.lineVO.ui_original_record[field] = metadata.defaultValue;\n\t\t\t\trecord[field] = metadata.defaultValue;\n\t\t\t}\n\t\t\treturn Formatter.formatFieldData(lineModel, record[field], metadata, record);\n\t\t} else {\n\t\t\t// can't locate field metadata, just return the record data as is\n\t\t\treturn record[field];\n\t\t}\n\t}\n\n\t/**\n\t * Deep copy if needed and update metadata CurrencyIsoCode for currency types that are using multi-currency in their org\n\t * Also updates the Quantity Field if their scale has changed\n\t *\n\t * See NumberFormatter#_setCurrencyFormatOptions for CurrencyIsoCode usage.\n\t * @param record\n\t * @param metadata\n\t * @param lineModel\n\t **/\n\tstatic _getFieldMetadata(record, metadata, lineModel) {\n\t\tlet isCurrency = metadata.type === 'currency';\n\t\tlet isQuantity = lineModel.editorModel.constants.QUANTITY_FIELDS.has(metadata.name) && lineModel.lineVO.productQuantityScale !== null;\n\n\t\tif (isCurrency || isQuantity) {\n\t\t\t// Deep copy to avoid mutating shared state\n\t\t\tmetadata = JSON.parse(JSON.stringify(metadata));\n\t\t\tif (isCurrency) {\n\t\t\t\tmetadata.CurrencyIsoCode = record.CurrencyIsoCode;\n\t\t\t}\n\t\t\tif (isQuantity) {\n\t\t\t\tmetadata.scale = lineModel.lineVO.productQuantityScale;\n\t\t\t}\n\t\t}\n\t\treturn metadata;\n\n\t}\n\n\t/**\n\t * Prepare the segmented data for the line\n\t * @param lineModel\n\t * @param record\n\t * @param recordUI\n\t * @param quoteLineFields\n\t * @param fieldVisibility\n\t */\n\tstatic prepareSegmentedLineData(lineModel, record, recordUI, quoteLineFields, fieldVisibility) {\n\t\tlet segmentData = {};\n\t\t// carry currency iso code from main record so that currency fields are formatted properly\n\t\tif (record.CurrencyIsoCode) {\n\t\t\tsegmentData.CurrencyIsoCode = record.CurrencyIsoCode;\n\t\t}\n\t\tlet constants = lineModel.editorModel.constants;\n\t\t// Create a map(segment column, segment value)\n\t\tlineModel.segments.forEach((segment) => {\n\t\t\tlet label = toFieldName(segment.lineVO.record[constants.SEGMENT_LABEL_FIELD]);\n\t\t\tsegmentData[label] = segment.lineVO.record[constants.NET_TOTAL_FIELD];\n\t\t});\n\t\tlet quoteVO = lineModel.editorModel.quoteModel.quoteVO;\n\t\tsegmentData['total'] = quoteVO.multiSegmentRowTotals[record[constants.SEGMENT_KEY_FIELD]];\n\t\t// Add segment data to the recordUI\n\t\tObject.keys(segmentData).forEach((segment) => {\n\t\t\tlet fieldMetadata = quoteLineFields[constants.NET_TOTAL_FIELD];\n\t\t\trecordUI[segment] = this.prepareFieldData(segmentData, segment, fieldMetadata, lineModel, fieldVisibility);\n\t\t\tthis.computeCellClass(segmentData, segment, recordUI, lineModel, fieldVisibility, quoteLineFields[segment]);\n\t\t});\n\t\t// row expansion\n\t\trecordUI._cellClasses._expansionIcon = lineModel.lineVO.expanded ? TemplateGenerator.classNames.DOWN_ICON : TemplateGenerator.classNames.RIGHT_ICON;\n\t}\n\n\t/**\n\t * Provide additional cell-level css classes, to be stamped from SFStandardTable#computeCellClass\n\t * @param record\n\t * @param field name of field for which css is being calculated\n\t * @param recordUI\n\t * @param lineModel\n\t * @param fieldVisibility\n\t */\n\tstatic computeCellClass(record, field, recordUI, lineModel, fieldVisibility, fieldMetadata) {\n\t\tlet cellClass = '';\n\t\t// editable class\n\t\tif (!fieldVisibility || fieldVisibility[field] !== false) {\n\t\t\tcellClass += lineModel.isEditable(field) && !lineModel.dimensionType ? `${TemplateGenerator.classNames.EDITABLE} ` : '';\n\t\t\tcellClass += lineModel.itemClassMap[field] ? lineModel.itemClassMap[field] : '';\n\t\t}\n\n\t\tif (fieldVisibility && fieldVisibility[field] === false && fieldMetadata && fieldMetadata.type === 'boolean') {\n\t\t\tcellClass += (TemplateGenerator.classNames.HIDE_CHECKBOX + ' ');\n\t\t}\n\n\t\t// product hierarchy classes (top-level, sbIndentx etc.)\n\t\tif (lineModel.editorModel.isProductHierarchyVisualized() && !lineModel.segmented) {\n\t\t\tcellClass += this.computeProductHierarchyCss(field, record, lineModel);\n\t\t}\n\n\t\tif (AppContext.isBundleCollapsible(lineModel.editorModel) && !lineModel.isBundle) {\n\t\t\tcellClass += ' focusable';\n\t\t}\n\n\t\tconst modelClasses = lineModel.cellClasses ? lineModel.cellClasses[field] : null;\n\t\tif (modelClasses) {\n\t\t\tfor (let modelClass in modelClasses) {\n\t\t\t\tif (modelClasses[modelClass]) {\n\t\t\t\t\tcellClass += ` ${modelClass}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (cellClass) {\n\t\t\trecordUI._cellClasses = recordUI._cellClasses || {};\n\t\t\trecordUI._cellClasses[field] = cellClass;\n\t\t}\n\t}\n\n\t/**\n\t * Compute cell css when product hierarchical view is turned on\n\t * @param field\n\t * @param record\n\t * @param lineModel\n\t * @returns {string}\n\t */\n\tstatic computeProductHierarchyCss(field, record, lineModel) {\n\t\tlet cellClass = '';\n\t\tlet classNames = TemplateGenerator.classNames;\n\t\tif (!AppContext.isMobile) {\n\t\t\tif (QuoteContext.isProductNameField(field)) {\n\t\t\t\tif (!lineModel.isBundle && !lineModel.component) {\n\t\t\t\t\tcellClass += `${classNames.TOP_LEVEL} `;\n\t\t\t\t}\n\t\t\t\tif (lineModel.component) {\n\t\t\t\t\tif (!lineModel.isBundle) {\n\t\t\t\t\t\tcellClass += `${classNames.OPTION} `;\n\t\t\t\t\t}\n\t\t\t\t\tcellClass += `${classNames.INDENT}${record[QuoteContext.constants.OPTION_LEVEL_FIELD]} `;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ((QuoteContext.isProductNameField(field) || QuoteContext.isNetTotalField(field)) && record[QuoteContext.constants.OPTION_LEVEL_FIELD] !== null) {\n\t\t\tcellClass += `${classNames.INDENT}${record[QuoteContext.constants.OPTION_LEVEL_FIELD]} `;\n\t\t}\n\t\treturn cellClass;\n\t}\n}\n","import { AppContext } from 'common/core/AppContext.js';\nimport { ServiceClient } from 'common/data/client/ServiceClient.js';\nimport { mergeRec, pathMutate } from 'common/Util.js';\nimport { get, put, observe } from 'quotes/models/ClientCache.js';\nimport { Category } from 'quotes/models/ClientModels.js';\nimport { QuoteContext } from 'quotes/QuoteContext.js';\nimport { Cache } from 'common/data/cache/Cache.js';\n/**\n * Calls APEX API to load UBP for Quote Line, or Product when Quote Line ID is unavailable.\n * @param shouldLoadRateFieldsMd Whether field rates metadata should be loaded (editability and scale)\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function loadUbp(shouldLoadRateFieldsMd = false) {\n\tconst quoteLineOrProdId = get('UBPClientState', [ 'quoteLineOrProdId' ]);\n\tshouldLoadRateFieldsMd = shouldLoadRateFieldsMd && get('ConsumptionRateMetadata') == null;\n\tconst ubpLabels = get('ubpLabels', ['labels']);\n\tconst shouldLoadLabels = ubpLabels === null || ubpLabels === undefined;\n\tconst context = { ...getLoadRatesContext(0, `${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.Name`, 'asc'), loadCategories: true, shouldLoadRateFieldsMd, shouldLoadLabels };\n\tconst loader = (id, ctx) => load('ConsumptionServiceProvider.UBPLoader', id, ctx);\n\treturn handleRequestSync(quoteLineOrProdId, context, loader, normalizeUbp);\n}\n\n/**\n * Calls APEX API for paginated load of an (already loaded) category or the initial load of a new category\n * @param {number} offset - The offset of the rate data.\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function loadRates(offset) {\n\tconst categoryId = getCategoryId();\n\tif (!categoryId) {\n\t\treturn Promise.resolve();\n\t}\n\tconst { name, nameSpace, sortField, sortOrder } = get(categoryId, [ ]);\n\tconst quoteLineOrProdId = get('UBPClientState', [ 'quoteLineOrProdId' ]);\n\tconst context = { ...getLoadRatesContext(offset, sortField, sortOrder), category: name , nameSpace: nameSpace};\n\tconst loader = (id, ctx) => load('ConsumptionServiceProvider.ConsumptionCategoryRateLoader', id, ctx);\n\treturn handleRequestSync(quoteLineOrProdId, context, loader, normalizeRates);\n}\n\n/**\n * Calls APEX API to load rate card summary,\n * Invoked when user hovers over a rate card\n * @param {String} scheduleId - The schedule id associate with the rate card.\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function loadRateCardSummary(scheduleId) {\n\tconst context = { categoryId: getCategoryId() };\n\tconst loader = (id, ctx) => load('ConsumptionServiceProvider.ConsumptionScheduleLoader', id, ctx);\n\treturn handleRequest(scheduleId, context, loader, normalizeRateCardSummary);\n}\n\n/**\n * Get Data from the cache\n * Look at ClientCache#get\n * @param key you're searching with\n * @param path Where the data is located\n * @returns {*}\n */\nexport function getDataFromCache(key, path) {\n\treturn get(key, path);\n}\n\n/**\n * Get data from cache, invoke loadFunction when there's a cache miss\n * @param key\n * @param path\n * @param loadFunction\n * @returns {Promise.<*>}\n */\nexport function getDataFromCacheAsync(key, path, loadFunction) {\n\tlet result = get(key, path);\n\tif (!result && loadFunction) {\n\t\tif (typeof loadFunction === 'function') {\n\t\t\treturn loadFunction().then((response) => {\n\t\t\t\treturn Promise.resolve(get(key, path));\n\t\t\t});\n\t\t} else {\n\t\t\tthrow new Error (`Expecting loadFunction to be a function but got ${typeof loadFunction}`);\n\t\t}\n\t}\n\treturn Promise.resolve(result);\n}\n\nfunction _changeCount(diff) {\n\tput('UBPClientState', [ 'requestCount' ], get('UBPClientState', [ 'requestCount' ]) + diff);\n};\n\n/**\n * Wrapper for handleRequest that also displays a spinner.\n * @param {string} id - The main id of the requested data.\n * @param {object} context - Any extra needed for the loader and normalizer.\n * @param {function} loader - Function that handles loading the data.\n * @param {function} normalizer - Function that normalizes the load response data.\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function handleRequestSync(id, context, loader, normalizer) {\n\t_changeCount(1);\n\treturn handleRequest(id, context, loader, normalizer).then(() => {\n\t\t_changeCount(-1);\n\t}).catch((e) => {\n\t\t_changeCount(-1);\n\t\tthrow e;\n\t});\n}\n\n/**\n * The skeleton for handling a request.\n * It allows for injection of loading and normalizing logic.\n * @param {string} id - The main id of the requested data.\n * @param {object} context - Any extra needed for the loader and normalizer.\n * @param {function} loader - Function that handles loading the data.\n * @param {function} normalizer - Function that normalizes the load response data.\n * @returns {Promise<Void>} Promise that completes when request is finished.\n */\nexport function handleRequest(id, context, loader, normalizer) {\n\treturn loader(id, context).then((response) => {\n\t\tconst normalized = normalizer(response, id, context)\n\t\tfor (let field in normalized) {\n\t\t\tput(field, [ ], mergeRec(get(field, [ ]), normalized[field]))\n\t\t}\n\t}).catch((e) => {\n\t\tput('UBPClientState', [ 'errorMsg' ], [ e instanceof Error ? e.message : e ]);\n\t\tthrow e;\n\t});\n}\n\nexport function getLoadRatesContext(offSet, field, order) {\n\tconst { quoteLineOrProdId, queryLimit, searchKeyword } = get('UBPClientState', [ ]);\n\tconst sortOrders = [ { field, order } ];\n\tconst processingOrder = `${QuoteContext.constants.prefix}ProcessingOrder__c`;\n\tif (field !== processingOrder) {\n\t\tsortOrders.push({ field: processingOrder, order: 'asc' });\n\t}\n\treturn { quoteLineOrProdId, queryLimit, searchKeyword, offSet, sortOrders,\n\t\tcurrencyCode: get(quoteLineOrProdId, [ 'record', 'CurrencyIsoCode' ]),\n\t};\n}\n\nfunction getCategoryId() {\n\tconst { quoteLineOrProdId, categoryIndex } = get('UBPClientState', [ ]);\n\tconst categoryIds = get(quoteLineOrProdId, [ 'related', 'categoryIds' ]);\n\treturn categoryIds ? categoryIds[categoryIndex] : null;\n}\n\nfunction categoryNameToId(qlId, name) {\n\treturn `${qlId}_${name}`;\n}\n\n/**\n * Normalize interface. Defines the signature of functions responsible for normalizing data from the server.\n * @param {object} response - Raw response from the loader.\n * @param {string} id - The main id of the requested data.\n * @param {object} context - Any extra needed for the loader and normalizer.\n * @returns {object} Normalized data\n */\n\n/**\n * Normalizes data returned from loadUbp Server calls.\n */\nexport function normalizeUbp(response, qlId, context) {\n\tif (response.rateFieldsMd) {\n\t\tconst md = response.rateFieldsMd;\n\t\tlet editableObj = {}, scaleObj = {};\n\t\t// Split up rateFieldsMd\n\t\tObject.keys(md).forEach((fieldName) => {\n\t\t\tconst scaleMd = (md[fieldName].scale ? { [fieldName]: {'scale': md[fieldName].scale} } : {});\n\t\t\tObject.assign(editableObj,{[fieldName]: md[fieldName].updatable}); // Copy to editableObj\n\t\t\tscaleObj = {...scaleObj, ...scaleMd};\n\t\t});\n\t\tput('ConsumptionRateMetadata', ['rateEditable'], editableObj);\n\t\tput('ConsumptionRateMetadata', ['rateScale'], scaleObj);\n\t}\n\tconst { field: sortField, order: sortOrder } = context.sortOrders[0];\n\tconst ratesCurrencyScale = get('ConsumptionRateMetadata', ['rateScale']);\n\tlet normalized = {};\n\tlet categories = [];\n\tif (ratesCurrencyScale) {\n\t\tresponse.categories.forEach((category) => {\n\t\t\tlet fields = category.fields.map((fields) => {\n\t\t\t\tconst fieldPath = fields.fieldPath;\n\t\t\t\tconst scaleMd = ratesCurrencyScale[fieldPath] ? ratesCurrencyScale[fieldPath] : {};\n\t\t\t\treturn {...fields, ...scaleMd};\n\t\t\t});\n\t\t\tcategory.fields = fields;\n\t\t\tcategories.push(category);\n\t\t});\n\t} else {\n\t\tcategories = response.categories;\n\t}\n\tconst categoryIds = categories.map(({ name, nameSpace, label, fields }) => {\n\t\tconst id = categoryNameToId(qlId, name);\n\t\tnormalized[id] = { name, nameSpace, label, fields, sortField, sortOrder };\n\t\treturn id;\n\t});\n\tlet qlFieldsMD = [];\n\t// unfortunately response.qlFieldMD doesn't contain all the metadata we need\n\t// so we need to enrich it with the data we got previously from QuoteLine describe (W-5602229)\n\tif (response.qlFieldMD) {\n\t\tconst quoteLineDesc = Cache.get('describe', `${QuoteContext.constants.prefix}QuoteLine__c`, 'value');\n\t\tif (quoteLineDesc && quoteLineDesc.fields) {\n\t\t\tresponse.qlFieldMD.forEach((fieldMD) => {\n\t\t\t\tlet descFieldMD = quoteLineDesc.fields.find((f) => { return f.name === fieldMD.fieldPath});\n\t\t\t\t// merge the described field MD with fieldMD\n\t\t\t\tqlFieldsMD.push(Object.assign(fieldMD, descFieldMD || {}));\n\t\t\t});\n\t\t} else {\n\t\t\t// this shouldn't happen - cache doesn't have the info we need, so we just fall back to what we have\n\t\t\tqlFieldsMD = response.qlFieldMD;\n\t\t}\n\t}\n\tnormalized[qlId] = { related: { categoryIds, ubpFields: qlFieldsMD } };\n\tif (response['customLabels']) {\n\t\tnormalized['ubpLabels'] = response['customLabels'];\n\t}\n\tconst category = response.resultSet.categoryName;\n\tnormalized.UBPClientState = {\n\t\tcategoryIndex: categoryIds.indexOf(categoryNameToId(qlId, category))\n\t};\n\treturn mergeRec(normalized, normalizeRates(response, qlId, { ...context, category }));\n}\n\n/**\n * Normalizes data returned from loadRates Server calls.\n */\nexport function normalizeRates({ resultSet: { totalCount, records } }, qlId, { offSet, category }) {\n\tconst categoryId = categoryNameToId(qlId, category);\n\tconst normalized = { };\n\tnormalized[categoryId] = { rateCount: totalCount };\n\tconst oldRates = get(categoryId, [ 'orderedRates' ]) || [ ];\n\tif (offSet <= oldRates.length) {\n\t\trecords = records || [];\n\t\tnormalized[categoryId].orderedRates = [\n\t\t\t...oldRates.slice(0, offSet),\n\t\t\t...records.map((rate) => {\n\t\t\t\tnormalized[rate.Id] = { record: rate };\n\t\t\t\treturn rate.Id;\n\t\t\t})\n\t\t];\n\t}\n\treturn normalized;\n}\n\n/**\n * Normalizes data returned from loadRateCardSummary Server calls.\n */\nexport function normalizeRateCardSummary({ fields, record }, scheduleId, { categoryId }) {\n\tlet normalized = {};\n\tnormalized[categoryId] = { rateCardFields: fields };\n\tnormalized[scheduleId] = { record };\n\treturn normalized;\n}\n\nfunction load(loader, id, context) {\n\treturn new ServiceClient().load(AppContext.org.prefix, loader, id, context);\n}\n\n/**\n * Take an old and new UBP rate record and the list of fields, create an overridden record\n * @param {Object} oldRecord - Existing record object\n * @param {Object} newVal - Object with new values to override existing object's values\n * @returns {Object} A new record after overriding.\n */\nexport function overrideRecValues(oldRecord, newRecord, fields) {\n\t// make a deep clone of the old record, so we don't mess up the original data\n\tconst response = JSON.parse(JSON.stringify(oldRecord));\n\tif (newRecord) {\n\t\tfields.forEach((field) => {\n\t\t\tif (newRecord.hasOwnProperty(field.fieldPath)) {\n\t\t\t\tpathMutate(response, field.fieldPath.split('.'), newRecord[field.fieldPath]);\n\t\t\t}\n\t\t});\n\t}\n\treturn response;\n}","export class QuoteAggregator {\n\tconstructor(clientQuote, serverQuote, requiredKeys) {\n\t\tthis.clientQuote = clientQuote;\n\t\tthis.serverQuote = serverQuote;\n\t\tthis.requiredKeys = requiredKeys;\n\t}\n\n\treconcileServerQuoteWithUIQuote() {\n\t\t// linesRequiringInjection is a map where the keys are line keys and the values are lists of lines.\n\t\t// The head of each list is an updated version of a line that was sent to the server.\n\t\t// Any other nodes in the list are going to be new quote lines that need to be added immediately after the\n\t\t// head. These new lines will be in the same bundle structure as the updated line they must follow.\n\t\tlet linesRequiringInjection = new Map();\n\t\t// linesBelongingAtEnd is the list of new lines that we can just append to the end of the quote. These will\n\t\t// all be lines in new bundles.\n\t\tlet linesBelongingAtEnd = [];\n\n\t\tlet serverLineCount = this.serverQuote.lineItems.length;\n\t\tlet existingLineKey;\n\t\tfor (let i = 0; i < serverLineCount; i++) {\n\t\t\tlet line = this.serverQuote.lineItems[i];\n\t\t\tif (this.requiredKeys.has(line.key)) {\n\t\t\t\t// If this line's key is in requiredKeys, it means that we sent it to the server and received an updated version.\n\t\t\t\t// So what we have to do is create a singleton list for this line and add it to the linesRequiringInjection set.\n\t\t\t\tlinesRequiringInjection.set(line.key, [line]);\n\t\t\t\t// We also mark this line as the existingLineKey, marking its list as the one to append new child lines to, for now.\n\t\t\t\texistingLineKey = line.key;\n\t\t\t} else {\n\t\t\t\t// If the line's key isn't in requiredKeys, it was created by the server.\n\t\t\t\tif (existingLineKey && line.parentItemKey) {\n\t\t\t\t\t// If the line is a child and we have a key corresponding to a known existing line, we append this line\n\t\t\t\t\t// to that line's list.\n\t\t\t\t\tlinesRequiringInjection.get(existingLineKey).push(line);\n\t\t\t\t} else {\n\t\t\t\t\t// If the line isn't a child line, or there's not an existing line it should be grouped with,\n\t\t\t\t\t// we should just add it to the list of lines belonging at the end, and blank out the existingLineKey.\n\t\t\t\t\texistingLineKey = null;\n\t\t\t\t\tlinesBelongingAtEnd.push(line);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Now that we've sorted all of our lines and grouped the ones that need to be added together, we need to create\n\t\t// the actual line list.\n\t\tlet resultLines = [];\n\t\tthis.clientQuote.lineItems.forEach((line) => {\n\t\t\tif (!this.requiredKeys.has(line.key)) {\n\t\t\t\t// If the line's key isn't in requiredKeys, it means we didn't send the line to the server, and therefore\n\t\t\t\t// it can't have changed. Use the original version.\n\t\t\t\tresultLines.push(line);\n\t\t\t} else if (linesRequiringInjection.has(line.key)) {\n\t\t\t\t// If the key is in requiredKeys, and there's an associated list in linesRequiringInjection, we concatenate\n\t\t\t\t// that list onto the result list.\n\t\t\t\tresultLines = resultLines.concat(linesRequiringInjection.get(line.key));\n\t\t\t}\n\t\t\t// Otherwise, the line was sent to the server but no result was returned, meaning the line was deleted and should\n\t\t\t// not be added to the result list.\n\t\t});\n\t\t// Now that we've injected all of the lines that need to be injected, we can append the rest.\n\t\tresultLines = resultLines.concat(linesBelongingAtEnd);\n\t\tthis.serverQuote.lineItems = resultLines;\n\t\treturn this.serverQuote;\n\t}\n}","/**\n * Created by jfeingold on 12/22/16.\n */\nimport {Constants} from 'quotes/models/Constants.js';\nexport class QuoteLineAggregator {\n\tconstructor(quote) {\n\t\tthis._quote = quote;\n\t\tthis._linesByKey = new Map();\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tthis._linesByKey.set(line.key, line);\n\t\t\t});\n\t\t}\n\t\t// Determine the prefix by examining the quote record\n\t\tvar devPrefix = (quote.record.attributes.type === 'Quote__c') ? '' : quote.record.attributes.type.slice(0, -8);\n\t\tthis._constants = new Constants(devPrefix);\n\t}\n\n\t/**\n\t * Returns a map from each line item's key to its Prior Bundled Quantity.\n\t * @returns {{}}\n\t */\n\tmapPriorBundledQuantityByLineKey() {\n\t\tlet result = {};\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tresult[line.key + ''] = this._getPriorBundledQuantity(line);\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a list containing every line's Upgraded Asset Id.\n\t * @returns {Array}\n\t */\n\tgetUpgradedAssetIdsAsArray() {\n\t\t// Collect all Asset IDs in a set to make sure that we don't have duplicates.\n\t\tlet idSet = new Set();\n\t\tlet upgradedAssetIdField = this._constants.UPGRADED_ASSET_FIELD;\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tlet upgradedAssetId = line.record[upgradedAssetIdField];\n\t\t\t\tif (upgradedAssetId != null) {\n\t\t\t\t\tidSet.add(upgradedAssetId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Now turn that set into an Array so it can be serialized properly.\n\t\tlet result = [];\n\t\tidSet.forEach((id) => {\n\t\t\tresult.push(id);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Retrieves all of the Product IDs from quote lines where the Existing Flag is true.\n\t * @returns {Array}\n\t */\n\tgetExistingProductIdsFromLines() {\n\t\tlet idSet = new Set();\n\t\tlet existingField = this._constants.EXISTING_FIELD;\n\t\tlet productIdField = this._constants.PRODUCT;\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tif (line.record[existingField]) {\n\t\t\t\t\tidSet.add(line.record[productIdField]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet result = [];\n\t\tidSet.forEach((id) => {\n\t\t\tresult.push(id);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a map from a string representing a Dimension Type to the first set of MDQ lines it finds with that dimension,\n\t * in the provided group (or if no key is provided, lines without a group key).\n\t * @param {Number|null} groupKey A unique integer corresponding to a QuoteLineGroupVO, or null if no key is to be used.\n\t * @returns {{}}\n\t */\n\tgetSegmentTemplatesByDimensionTypeForGroupKey(groupKey) {\n\t\tlet result = {};\n\t\tlet customKey, yearlyKey, monthlyKey, quarterlyKey;\n\t\tlet customSegs = [];\n\t\tlet monthlySegs = [];\n\t\tlet yearlySegs = [];\n\t\tlet quarterlySegs = [];\n\n\t\tlet dimensionIdField = this._constants.DIMENSION_ID_FIELD;\n\t\tlet dimensionField = this._constants.DIMENSION_FIELD;\n\t\tlet typeField = this._constants.TYPE_FIELD;\n\t\tlet segmentKeyField = this._constants.SEGMENT_KEY_FIELD;\n\t\tif (this._quote.lineItems) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tif (line.parentGroupKey == groupKey) {\n\t\t\t\t\tlet dimensionType = line.dimensionType || (line.record[dimensionIdField] ? line.record[dimensionField][typeField] : null);\n\t\t\t\t\tlet segmentKey = line.record[segmentKeyField];\n\t\t\t\t\tswitch (dimensionType) {\n\t\t\t\t\t\tcase this._constants.TYPE_CUSTOM_DIMENSION:\n\t\t\t\t\t\t\tif (!customKey || customKey == segmentKey) {\n\t\t\t\t\t\t\t\tcustomKey = segmentKey;\n\t\t\t\t\t\t\t\tcustomSegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_YEARLY_DIMENSION:\n\t\t\t\t\t\t\tif (!yearlyKey || yearlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tyearlyKey = segmentKey;\n\t\t\t\t\t\t\t\tyearlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_MONTHLY_DIMENSION:\n\t\t\t\t\t\t\tif (!monthlyKey || monthlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tmonthlyKey = segmentKey;\n\t\t\t\t\t\t\t\tmonthlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_QUARTERLY_DIMENSION:\n\t\t\t\t\t\t\tif (!quarterlyKey || quarterlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tquarterlyKey = segmentKey;\n\t\t\t\t\t\t\t\tquarterlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tresult[this._constants.TYPE_CUSTOM_DIMENSION] = customSegs;\n\t\tresult[this._constants.TYPE_MONTHLY_DIMENSION] = monthlySegs;\n\t\tresult[this._constants.TYPE_YEARLY_DIMENSION] = yearlySegs;\n\t\tresult[this._constants.TYPE_QUARTERLY_DIMENSION] = quarterlySegs;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a list of keys corresponding to groups that have no lines.\n\t * @returns {Array}\n\t */\n\tgetKeysOfEmptyGroups() {\n\t\tif (!this._quote.lineItemGroups || this._quote.lineItemGroups.length == 0) {\n\t\t\t// If there are no groups, then just return an empty list.\n\t\t\treturn [];\n\t\t}\n\t\tlet groupKeySet = new Set();\n\t\tthis._quote.lineItemGroups.forEach((group) => {\n\t\t\t// Add all group keys to the set\n\t\t\tgroupKeySet.add(group.key);\n\t\t});\n\n\t\tif (this._quote.lineItems) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\t// For every line, remove the line's parent group key from the group key set.\n\t\t\t\tgroupKeySet.delete(line.parentGroupKey);\n\t\t\t});\n\t\t}\n\t\t// At this point, the only group keys remaining in groupKeySet are the ones for groups that have no lines.\n\t\t// Turn that set into an array and return it.\n\t\tlet result = [];\n\t\tgroupKeySet.forEach((groupKey) => {\n\t\t\tresult.push(groupKey);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Calculates a line's Prior Bundled Quantity. For standard lines, this is the prior quantity divided by the parent\n\t * line's prior quantity. For option lines carried over from a source parent to an upgrade parent, also known as\n\t * Carryover Lines, this is the number of lines carried over from the source child divided by the upgrade parent's\n\t * current quantity.\n\t * @param {Object} line An object representing a quote line\n\t * @returns {Number|null}\n\t * @private\n\t */\n\t_getPriorBundledQuantity(line) {\n\t\tlet prior;\n\t\tlet parentPrior;\n\t\tif (this._isCarryoverLine(line)) {\n\t\t\tprior = this._getCarryoverQuantity(line);\n\t\t\tparentPrior = this._linesByKey.get(line.parentItemKey).record[this._constants.QUANTITY_FIELD];\n\t\t} else {\n\t\t\tprior = line.record[this._constants.PRIOR_QUANTITY_FIELD];\n\t\t\tparentPrior = this._linesByKey.get(line.parentItemKey) ? this._linesByKey.get(line.parentItemKey).record[this._constants.PRIOR_QUANTITY_FIELD] : null;\n\t\t}\n\t\tif (parentPrior == null || prior == null || !this._optionTypeIsComponent(line)) {\n\t\t\treturn prior;\n\t\t} else {\n\t\t\treturn prior / parentPrior;\n\t\t}\n\t}\n\n\t_isCarryoverLine(line) {\n\t\treturn line.record[this._constants.CARRYOVER_LINE_FIELD] == true;\n\t}\n\n\t_getCarryoverQuantity(line) {\n\t\tlet carryoverQuantity = line.record[this._constants.PRIOR_QUANTITY_FIELD];\n\t\tlet parentItem = this._linesByKey.get(line.parentItemKey);\n\t\tif (line.sourceLineKey != null && parentItem) {\n\t\t\tlet sourceLine = this._linesByKey.get(line.sourceLineKey);\n\t\t\tif (sourceLine) {\n\t\t\t\tcarryoverQuantity = this._getPriorBundledQuantity(sourceLine);\n\t\t\t\tif (this._optionTypeIsComponent(sourceLine)) {\n\t\t\t\t\tcarryoverQuantity *= parentItem.record[this._constants.QUANTITY_FIELD];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn carryoverQuantity;\n\t}\n\n\t_optionTypeIsComponent(line) {\n\t\tlet optionType = line.record[this._constants.OPTION_TYPE_FIELD];\n\t\treturn optionType != null && optionType.toLowerCase() === 'component';\n\t}\n}","export class AssetUpgradeQuantityCalculator {\n\n\tconstructor(upgradeHandler) {\n\t\tthis.upgradeHandler = upgradeHandler;\n\t}\n\n\tsetQuantitiesByRatio() {\n\t\tlet source;\n\t\tlet upgrade;\n\t\tlet isSourceLine = this.upgradeHandler.isSourceLine();\n\n\t\t// If the configuration changed by the user is a source line, we need to find the corresponding upgrade option\n\t\tif(isSourceLine) {\n\t\t\tsource = this.upgradeHandler.getLine();\n\t\t\tupgrade = this._getUpgrade(source, null);\n\t\t// If the configuration changed by the user is an upgrade, we need to find the corresponding source option\n\t\t} else {\n\t\t\tupgrade = this.upgradeHandler.getLine();\n\t\t\tsource = this._getSource(null, upgrade);\n\t\t}\n\n\t\tif(!source || !upgrade) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.upgradeHandler.setSourceAndUpgrade(source, upgrade);\n\t\tthis._setAutomaticQuantity(source, upgrade, isSourceLine);\n\t}\n\n\t_getSource(source, upgrade) {\n\t\treturn this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n\t}\n\n\t_getUpgrade(source, upgrade) {\n\t\treturn this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n\t}\n\n\t_setAutomaticQuantity(source, upgrade, didUserChangeSourceQuantity) {\n\t\tlet upgradeRatio = this._getUpgradeRatio(source, upgrade, this.upgradeHandler.getSourceIdField(), this.upgradeHandler.getUpgradeConversionRateField());\n\n\t\tif(upgradeRatio == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceCurrentQty = this.upgradeHandler.getSourceCurrentQuantityField(source);\n\t\tlet upgradeCurrentQty = this.upgradeHandler.getUpgradeCurrentQuantityField(upgrade);\n\t\tlet sourceRate = upgradeRatio.split(':')[0];\n\t\tlet upgradeRate = upgradeRatio.split(':')[1];\n\t\tlet sourceQtyAfterUpdate = sourceCurrentQty;\n\t\tlet upgradeQtyAfterUpdate = upgradeCurrentQty;\n\t\tlet sourcePriorQty = this.upgradeHandler.getSourcePriorQuantity(source);\n\n\t\tif(sourceCurrentQty < 0) {\n\t\t\tsource.invalidQuantity = sourceCurrentQty;\n\t\t\tsource.validQuantity = 0;\n\t\t} else if(upgradeCurrentQty < 0) {\n\t\t\tupgrade.invalidQuantity = upgradeCurrentQty;\n\t\t\tupgrade.validQuantity = 0;\n\t\t}\n\n\t\tif (this.upgradeHandler.didSourceQuantityChange(didUserChangeSourceQuantity, source, upgrade)) {\n\t\t\t// If the upgrade option is selected, then its quantity should automatically change if\n\t\t\t// the source option isn't selected, since that's the same as source quantity of 0\n\t\t\t// or the source configuration is selected and the user changes its quantity necessitating ratio enforcement\n\t\t\tupgradeQtyAfterUpdate = (sourcePriorQty - sourceCurrentQty) * (upgradeRate / sourceRate);\n\t\t} else if (this.upgradeHandler.didUpgradeQuantityChange(didUserChangeSourceQuantity, source)) {\n\t\t\t// If the source option is selected and the user changes the upgrade's quantity\n\t\t\t// the change must reflect on the source\n\t\t\tsourceQtyAfterUpdate = sourcePriorQty - (upgradeCurrentQty * (sourceRate / upgradeRate));\n\t\t}\n\n\t\tif (sourceQtyAfterUpdate < 0) {\n\t\t\tsourceQtyAfterUpdate = 0;\n\t\t\tif (this.upgradeHandler.isSelected(upgrade)) {\n\t\t\t\tupgradeQtyAfterUpdate = sourcePriorQty * (upgradeRate / sourceRate);\n\t\t\t\tif(upgradeCurrentQty > upgradeQtyAfterUpdate) {\n\t\t\t\t\tupgrade.invalidQuantity = upgradeCurrentQty;\n\t\t\t\t\tupgrade.validQuantity = upgradeQtyAfterUpdate;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (upgradeQtyAfterUpdate < 0) {\n\t\t\tupgradeQtyAfterUpdate = 0;\n\t\t\tif (this.upgradeHandler.isSelected(source)) {\n\t\t\t\tsourceQtyAfterUpdate = sourcePriorQty;\n\t\t\t\tif(sourceCurrentQty > sourceQtyAfterUpdate) {\n\t\t\t\t\tsource.invalidQuantity = sourceCurrentQty;\n\t\t\t\t\tsource.validQuantity = sourceQtyAfterUpdate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.upgradeHandler.setUpdatedQuantity(source, upgrade, sourceQtyAfterUpdate, upgradeQtyAfterUpdate);\n\t}\n\n\t_getUpgradeRatio(source, upgrade, sourceIdField, upgradeConversionRateField) {\n\t\tfor (let sourceId in upgrade.upgradeSourcesBySourceProductId) {\n\t\t\tif (sourceId === source.record[sourceIdField]) {\n\t\t\t\treturn upgrade.upgradeSourcesBySourceProductId[sourceId][upgradeConversionRateField];\n\t\t\t}\n\t\t}\n\t}\n}\n","import {AppContext, localizeContent} from '../AppContext.js';\nimport {Util, rationalizeDate} from '../../Util.js';\n\n// Maps of cached Intl.DateTimeFormat and Intl.NumberFormat objects using their \"options\" object as 2nd-level keys\n// First level keys are locale strings\nlet dateFormatCache = new Util.Map(),\n\t\tnumberFormatCache = new Util.Map(),\n\t\tlocaleData;  // CLDR locale data for current user's locale, e.g. fr-CA\n\nexport class I18n {\n\n\tconstructor( app ) {\n\t\t// As a Polymer web component we get \"this.app\" from AppContext behavior.\n\t\t// But as regular ES6 class we have to set up ourselves (and we can't extend AppContext for circular dep reasons)\n\t\tthis.app = app;\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-i18n';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\t/**\n\t\t\t * The BCP 47 locale to use to format the data value or translate the message string (i.e. the language).\n\t\t\t * This will default to the user's locale or language so you only need to set it in \"override\" situations.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tlocale: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * The key to use to lookup the translated message string. Only set for overrides or complex/long messages.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tkey: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false\n\t\t\t},\n\t\t\t/**\n\t\t\t * The single value to replace the 0th wildcard in the provided translation key (e.g. '{0} items found')\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\t/**\n\t\t\t * The array of values to replace the multiple wildcard strings provided by the translation key (e.g. '{0} of {1} items found')\n\t\t\t * @type {Array}\n\t\t\t */\n\t\t\tvalues: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['_localizeObserver(key, value, values)'];\n\t}\n\n\tattached() {\n\t\tthis.key = this.key ? this.key : this.innerHTML;\n\t\tif(/{[0-9]}/.test(this.innerHTML))\n\t\t\tthis.innerHTML = ''; // contains wildcard so lets hide until wildcard values are replaced\n\t}\n\n\t_localizeObserver (key, value, values) {\n\t\tif (key === undefined || value === undefined || values === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.localize(key, value, values);\n\t}\n\n\tlocalize() {\n\t\tthis.innerHTML = this.l(this.key, this.value ? [this.value] : this.values);\n\t}\n\n\t/** Localize a string into a different language */\n\tl( key, values ) {\n\t\treturn localizeContent(key, values);\n\t}\n\n\tstatic addLocaleData( d ) {\n\t\tif( d )\n\t\t\tlocaleData = d;\n\t}\n\n\tstatic getLocaleData( locale ) {\n\t\treturn localeData;  // in future we may hold more than 1 data concurrently\n\t}\n\n\t_getFormat( locale, key, isDate ) {\n\t\tlet f = null;\n\t\tif( locale && key ) {\n\t\t\tlet loc = isDate ? dateFormatCache.get( locale ) : numberFormatCache.get( locale );\n\t\t\tif ( !loc ) {\n\t\t\t\tloc = new Util.Map();\n\t\t\t\tlet c = isDate ? dateFormatCache : numberFormatCache;\n\t\t\t\tc.set( locale, loc );\n\t\t\t}\n\n\t\t\tlet stringKey = JSON.stringify( key );\n\t\t\tf = loc.get( stringKey );\n\t\t\tif( !f ) {\n\t\t\t\tf = isDate ? new Intl.DateTimeFormat( locale, key ) : new Intl.NumberFormat( locale, key );\n\t\t\t\tloc.set( stringKey, f );\n\t\t\t}\n\t\t}\n\t\treturn f;\n\t}\n\n\t/**\n\t * Format a date or number.\n\t * @param  {Object|number} value   the Date object or number value (float or integer)\n\t * @param  {object} options the options object to pass into Intl.DateTimeFormat or Intl.NumberFormat constructor\n\t * @return {string}         the formatted string\n\t */\n\tformat( value, options ) {\n\t\tlet opts = options || {},\n\t\t\tlocale = this.user.locale === 'no-NO' ? 'nb-NO' : this.user.locale;\n\n\t\tif ( value || value == 0 ) {\n\t\t\tif ( value instanceof Date || opts.date ) {\n\t\t\t\treturn this._getFormat(locale, { ...opts, timeZone: 'UTC' }, true).format(rationalizeDate(value));\n\t\t\t} else {\n\t\t\t\tlet fmt = this._getFormat( locale, opts, false );\n\t\t\t\tlet v = fmt.format( value );\n\t\t\t\tif (opts.style === 'currency') {\n\t\t\t\t\tv = this._additionalCurrencyFormat(opts, v);\n\t\t\t\t}\n\t\t\t\treturn v;\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * Format ISO 8601 time into HH:mm a\n\t * @param value\n\t */\n\tformatTime(value) {\n\t\tif (value != null) {\n\t\t\tconst date = new Date(`1970-01-01T${value}`);\n\t\t\tif (!isNaN(date)) {\n\t\t\t\treturn date.toLocaleTimeString(this.user.locale, {timeZone: 'UTC', hour: 'numeric', minute: 'numeric'});\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * Parse a HH:mm a value to ISO 8601 time, e.g., 21:00AM -> 21:00:00.000Z\n\t * @param value\n\t */\n\tparseTime(value) {\n\t\tconst regex = /\\d?\\d:\\d\\d *(am)?(pm)?/i;\n\t\tif (regex.test(value)) {\n\t\t\tvalue = value.match(regex)[0] + ' UTC';\n\t\t\tconst d = new Date(`1970/01/01 ${value}`);\n\t\t\tif (!isNaN(d)) {\n\t\t\t\treturn d.toISOString().split('T')[1];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Applies extra formatting to currency values in order to properly add currency symbols.\n\t * @param {object} opts - An options object provided to the formatter.\n\t * @param {String} v - The output of the formatter, a string representing a formatted number.\n\t * @returns {String} The final formatted currency value.\n\t * @private\n\t */\n\t_additionalCurrencyFormat(opts, v) {\n\t\t// Allow a user defined Currency Symbol to override org default currency.\n\t\tlet formattedCurrency;\n\t\tif (opts.currency === 'XXX') {\n\t\t\tif (v.includes('XXX')) {\n\t\t\t\t// Replace the XXX with the org's currency symbol\n\t\t\t\tconst xxxIndex = v.indexOf('XXX');\n\t\t\t\tformattedCurrency = v.substr(0, xxxIndex) + this.org.currencySymbol + v.substring(xxxIndex + 3);\n\t\t\t} else {\n\t\t\t\t// If the XXX is not available, we just append the currencySymbol to the front of the formatted string\n\t\t\t\tformattedCurrency = this.org.currencySymbol + v;\n\t\t\t}\n\t\t} else {\n\t\t\tlet containsDash;\n\t\t\tif (opts.currencyDisplay === 'code') {\n\t\t\t\tcontainsDash = v.indexOf('-') > -1;\n\t\t\t\tif (containsDash) {\n\t\t\t\t\tv = v.replace('-', '');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Append a space after currency code if code is used.\n\t\t\tconst additionalContent = containsDash ? ' -' : '';\n\t\t\tformattedCurrency = v.replace(opts.currency, opts.currency + additionalContent) ;\n\t\t}\n\t\t// In case chrome gives us a encoded character replace with space, take into account dash\n\t\tformattedCurrency = this._replaceCharacters(formattedCurrency, 160, ' ');\n\t\t// In case firefox gives us a weird shuriken (¤) symbol replace with space\n\t\tformattedCurrency = this._replaceCharacters(formattedCurrency, 164, ' ');\n\t\treturn formattedCurrency.trim();\n\t}\n\n\t/**\n\t * Replace special characters such as char(160) (non-breaking space) that come from browser\n\t * @param {String} formattedCurrency - The string containing the formatted currency.\n\t * @param {Integer} charCode - The character code we want to replace.\n\t * @param {String} replacementVal - The string replacement value.\n\t * @returns replaced result or original result if no replacement was done.\n\t * @private\n\t */\n\t_replaceCharacters(formattedCurrency, charCode, replacementVal) {\n\t\tif (formattedCurrency.indexOf(String.fromCharCode(charCode)) > -1) {\n\t\t\tconst regExp = new RegExp(String.fromCharCode(charCode), 'g');\n\t\t\treturn formattedCurrency.replace(regExp, replacementVal);\n\t\t} else {\n\t\t\treturn formattedCurrency;\n\t\t}\n\t}\n}\n\nPolymer( I18n );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\n/**\n * THIS COMPONENT IS DEPRECATED.\n * For page level spinners, call: PageContainer.toggleSpinner(b);\n * For individual spinners on things like modals, use sf-loading-spinner\n */\nexport class LoadingSpinner {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-loading-spinner';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'toggle'\n\t\t\t},\n\t\t\tisReady: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpreviousState: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Component is ready\n\t */\n\tready() {\n\t\tthis.isReady = true;\n\t}\n\n\t/**\n\t * When the component detaches, disable spinner if previously turned on\n\t */\n\tdetached() {\n\t\tif (this.previousState === false) return;\n\n\t\tPageContainer.toggleSpinner(false);\n\t}\n\n\t/**\n\t * Turn spinner on/of\n\t * Some state logic in here due to the polymer lifecycle\n\t * @param {boolean} state Specify the toggle state\n\t */\n\ttoggle(state) {\n\t\t// check if the component has hit the ready function\n\t\t// it's possible it won't hit the ready function, but be toggled on\n\t\t// this happens when the property is set before the component is ready and we should honor that\n\t\tif (this.isReady !== true && state === false) return;\n\n\t\tif (state === this.previousState) return; // not a change in state\n\n\t\tPageContainer.toggleSpinner(state); // toggle the page spinner\n\t\tthis.previousState = state;\n\t}\n}\n\nPolymer(LoadingSpinner);","// Media Query breakpoints.  These need to be kept in sync with variables.less.\nlet bpXS = 0, bpS = 480, bpM = 800, bpL = 1024, bpXL = 1200,\n\t\tmqXS = window.matchMedia( 'screen and (max-width: ' + bpS + 'px)' ),\n\t\tmqSOnly = window.matchMedia( 'screen and (min-width: ' + (bpS + 1) + 'px) and (max-width: ' + bpM + 'px)' ),\n\t\tmqMOnly = window.matchMedia( 'screen and (min-width: ' + (bpM + 1) + 'px) and (max-width: ' + bpL + 'px)' ),\n\t\tmqLOnly = window.matchMedia( 'screen and (min-width: ' + (bpL + 1) + 'px) and (max-width: ' + bpXL + 'px)' ),\n\t\t// AA Fix to resolve button rendering issue\n\t\tmqXL = window.matchMedia( 'screen and (min-width: ' + (bpXL + 1) + 'px)' ),\n\t\tactiveSpinners = 0;\n\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Events, fireEvent} from 'common/core/Events.js';\nexport class PageContainer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-container';\n\t\tthis.properties = {\n\t\t\troute: String,\n\n\t\t\tallRoutes: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; },\n\t\t\t\tobserver: '_allRoutesChanged'\n\t\t\t},\n\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_buildViewport( xs, s, m, l, xl ) {\n\t\tlet v = {\n\t\t\tXS: {},\n\t\t\tS: {},\n\t\t\tM: {},\n\t\t\tL: {},\n\t\t\tXL: {},\n\t\t\tcurrent: function() {\n\t\t\t\tif(this.XS.only)\n\t\t\t\t\treturn {size: 'XS', window: [bpXS, bpS]};\n\t\t\t\tif(this.S.only)\n\t\t\t\t\treturn {size: 'S', window: [bpS + 1, bpM]};\n\t\t\t\tif(this.M.only)\n\t\t\t\t\treturn {size: 'M', window: [bpM + 1, bpL]};\n\t\t\t\tif(this.L.only)\n\t\t\t\t\treturn {size: 'L', window: [bpL + 1, bpXL]};\n\t\t\t\tif(this.XL.only)\n\t\t\t\t\treturn {size: 'XL', window: [bpXL, 10000]};\n\t\t\t},\n\t\t\tisMobile: function() {\n\t\t\t\treturn this.isPhone() || this.isTablet();\n\t\t\t},\n\t\t\tisPhone: function() {\n\t\t\t\treturn AppContext.isPhone;\n\t\t\t},\n\t\t\tisTablet: function() {\n\t\t\t\treturn AppContext.isTablet;\n\t\t\t},\n\t\t\tisDesktop: function() {\n\t\t\t\treturn AppContext.isDesktop;\n\t\t\t}\n\t\t};\n\n\t\tv.XS.only = xs && !s && !m && !l && !xl;\n\t\tv.XS.down = v.XS.only;\n\t\tv.XS.up = xs || s || m || l || xl;\n\n\t\tv.S.only = !xs && s && !m && !l && !xl;\n\t\tv.S.down = (xs || s) && !m && !l && !xl;\n\t\tv.S.up = !xs && (s || m || l || xl);\n\n\t\tv.M.only = !xs && !s && m && !l && !xl;\n\t\tv.M.down = (xs || s || m) && !l && !xl;\n\t\tv.M.up = !xs && !s && (m || l || xl);\n\n\t\tv.L.only = !xs && !s && !m && l && !xl;\n\t\tv.L.down = (xs || s || m || l) && !xl;\n\t\tv.L.up = !xs && !s && !m && (l || xl);\n\n\t\tv.XL.only = !xs && !s && !m && !l && xl;\n\t\tv.XL.down = true;\n\t\tv.XL.up = v.XL.only;\n\n\t\treturn v;\n\t}\n\n\tready() {\n\t\tthis._setupViewportListeners();\n\t}\n\n\trenderPage( e, detail, sender ) {\n\n\t\tif( detail.route.comp && detail.route.comp != '' ) {\n\t\t\tlet ctx = {};\n\t\t\tctx.params = detail.params;\n\t\t\tctx.pathParams = detail.pathParams;\n\n\t\t\t// dynamically add component\n\t\t\t// todo: unbind stuff?\n\t\t\tconst html = (function(detail, ctx) {\n\t\t\t\treturn '<' + detail.route.comp + ' ctx=\\'' + JSON.stringify(ctx) + '\\'></' + detail.route.comp + '>';\n\t\t\t})(detail, ctx);\n\t\t\tif (detail.route.mod) {\n\t\t\t\tSystem.import( detail.route.mod ).then( function(m) {\n\t\t\t\t\tthis._updateContent( html );\n\t\t\t\t}.bind(this) ).catch( function(err){\n\t\t\t\t\tconsole.log( err );\n\t\t\t\t\tconsole.log( err.originalErr );\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._updateContent( html );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// load view HTML file - todo: cache\n\t\t\tthis.$.ajax.url = detail.route.view;\n\t\t\tif( this.$.ajax.url )\n\t\t\tthis.$.ajax.go();\n\t\t}\n\t}\n\n\t/** Update the content element's innerHTML with new html */\n\t_updateContent( html ) {\n\t\tthis.$.content.innerHTML = html;\n\t\tthis._viewportChanged(); // update the Page's viewport\n\t\tPolymer.dom.flush();  // releases internal Polymer memory\n\t\tPolymer.updateStyles();\n\t}\n\n\t_allRoutesChanged( nv ) {\n\t\tthis.$.router.init( nv );\n\t}\n\n\t_viewportChanged() {\n\t\t// pass down the new value to the page instance and fire event for any other WC's that may be listening\n\t\tlet el = this.$.content.querySelector( '*:first-child' );\n\t\tif( el ) el.viewport = this.viewport;\n\n\t\t// some browsers (e.g. Firefox) need this setTimeout to break the event loop\n\t\tsetTimeout( function() {\n\t\t\tfireEvent(Events.VIEWPORT_CHANGED, { viewport: this.viewport } );\n\t\t}.bind(this), 10 );\n\t}\n\n\t// We listener for MQ stuff here and pass it down to page so we don't have to do this every time we create a new Page\n\t_setupViewportListeners() {\n\t\tvar self = this;\n\t\tfunction build(m) {\n\t\t\tif( m.matches )\n\t\t\t\tself.viewport = self._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t};\n\n\t\t// disable all viewport listeners for DreamForce\n\t\tmqXS.addListener( build );\n\t\tmqSOnly.addListener( build );\n\t\tmqMOnly.addListener( build );\n\t\tmqLOnly.addListener( build );\n\t\tmqXL.addListener( build );\n\t}\n\n\tstatic getContainer() {\n\t\treturn document.querySelector( '#' + PageContainer.domId );\n\t}\n\n\tstatic getViewport() {\n\t\tlet container = PageContainer.getContainer();\n\t\treturn container ? container.viewport : null;\n\t}\n\n\tstatic isMobile() {\n\t\tconst viewport = PageContainer.getViewport();\n\t\treturn viewport && viewport.isMobile();\n\t}\n\n\t/**\n\t * Toggle spinner state to on/off\n\t * @param {boolean} state Specify the toggle state\n\t */\n\tstatic toggleSpinner(state) {\n\t\tactiveSpinners += state === true ? 1 : -1;\n\t\tconst container = PageContainer.getContainer();\n\t\tif (container !== null) {\n\t\t\tcontainer.$.spinner.show = activeSpinners > 0;\n\t\t}\n\t}\n}\n\n// the id used in the DOM for this element\nPageContainer.domId = 'sbPageContainer';\n\nPolymer( PageContainer );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class PageHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-header';\n\t\tthis.properties = {\n\t\t\t/**\n\t\t\t * Viewport information for things like T-shirt size (S, M, L, XL)\n\t\t\t * @type {Object}\n\t\t\t */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowMenu: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\tmenuClosed : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\thideFullTitle: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tsearchbar: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_setSearchbarStyles'\n\t\t\t},\n\t\t\tdebugMode: Boolean,\n\t\t\tept: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tbpt: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tspt: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\t/* Show or hide the lookup dialog */\n\t\t\tshowLookupDialog: Boolean\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.AUTO_LAUNCH_POPUP] = this.allowAutoLaunchPopup;\n\t\te[Events.NAVIGATION_CHANGED] = this.navigationChanged;\n\t\te[Events.OPEN_LOOKUP_DIALOG] = this.openLookupDialog;\n\t\te[Events.CLOSE_LOOKUP_DIALOG] = this.closeLookupDialog;\n\t\te[Events.OPEN_RTE_DIALOG] = this.openRteDialog;\n\t\te[Events.OPEN_SEARCH_BAR_DIALOG] = this.openSearchDialog;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\tthis.debugMode = (window.sb.mode && window.sb.mode.debugMode) || false;\n\t\tif (this.debugMode) {\n\t\t\tthis._setupMetricsServiceListeners();\n\t\t}\n\t}\n\n\t_showFullTitle(e) {\n\t\tif (!this.viewport.isMobile()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hideFullTitle && !Polymer.dom(this).children[1].textContent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideFullTitle = !this.hideFullTitle;\n\n\t\tthis.$.fullTitle.innerText     = this.hideFullTitle ? Polymer.dom(this).children[1].textContent : \"\";\n\t\tthis.$.fullTitle.style.opacity = this.hideFullTitle ? 1 : 0;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tnavigationChanged() {\n\t\tthis._closeMenu();\n\t}\n\n\t_closeMenu() {\n\t\tthis.toggleClass('open', false, this.$.buttons);\n\t\tthis.toggleClass('autoLaunch', false, this.$.buttons);\n\t\tsetTimeout(function () {\n\t\t\t// defer setting the menuClosed flag in case _changeMenu is called after _closeMenu in the same event loop\n\t\t\tthis.menuClosed = true;\n\t\t}.bind(this), 1);\n\t}\n\n\t_changeMenu(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.getAttribute('data-target');\n\t\tif(target === \"Popup\")\n\t\t\treturn; // the popup will handle closing the menu when it closes\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed , this.$.buttons, 'open', this);\n\t\tif (this.menuClosed)\n\t\t\tthis.fire('sb-menu-closed');\n\t}\n\n\t_viewportChanged() {\n\t\t// need an explicit boolean + CSS here so we don't have race condition with dom-if\n\t\tthis.showMenu = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tif( this.showMenu )\n\t\t\tthis.$.buttons.classList.remove( 'normal' );\n\t\telse\n\t\t\tthis.$.buttons.classList.add( 'normal' );\n\t}\n\n\t_setSearchbarStyles() {\n\t\t//if (this.searchbar && this.viewport.isMobile())\n\t\t//\tthis.toggleClass('mobileSearch', true, this.$$('header'));\n\t}\n\n\t// Helper function that can be used with a menu dropdown button. It returns the flipped state of the menu button.\n\t// target element will be a dom element on which adding an openClass will show the menu and removing it will\n\t// close the menu\n\tstatic changeMenu(e, menuClosed, targetElement, openClass, toggler) {\n\t\t\tlet rect = e.currentTarget.getBoundingClientRect();\n\t\t\tlet\tbs = targetElement.style;\n\t\t\tbs.top = (rect.bottom+2) + 'px';\n\t\t\tbs.right = (window.innerWidth - rect.right) + 'px';\n\t\t\ttoggler.toggleClass(openClass, menuClosed, targetElement);\n\t\treturn !menuClosed;\n\t}\n\n\topenLookupDialog(e) {\n\t\tthis.showLookupDialog = true;\n\t\t// let dom-if restamp fully before attempting to open dialog\n\t\tPolymer.RenderStatus.afterNextRender( this, () => {\n\t\t\tlet lookup = this.querySelector( '#lookup' );\n\t\t\tlookup.invoker = e.detail.lookup;\n\t\t\tlookup.open(e.detail.searchValue);\n\t\t});\n\t}\n\n\tcloseLookupDialog(e) {\n\t\tthis.showLookupDialog = false;\n\t}\n\n\topenRteDialog(e) {\n\t\tlet rte = this.$.rte;\n\t\trte.value = e.detail.value;\n\t\trte.rte = e.detail.rte;\n\t\trte.open();\n\t}\n\n\topenSearchDialog(e) {\n\t\tlet search = this.$.search;\n\t\tsearch.value = e.detail.value;\n\t\tsearch.quote = e.detail.quote;\n\t\tsearch.open();\n\t}\n\n\tallowAutoLaunchPopup() {\n\t\tif(this.showMenu) {\n\t\t\t// \"open\" the menu so the auto launched popup is visible\n\t\t\tthis.toggleClass('open', true, this.$.buttons);\n\t\t\tthis.toggleClass('autoLaunch', true, this.$.buttons);\n\t\t\tthis.menuClosed = false;\n\t\t}\n\t}\n\n\t_setupMetricsServiceListeners() {\n\t\tdocument.addEventListener('metrics-changed', function(e) {\n\t\t\tlet metricsData = e.detail;\n\t\t\tlet sticker = Polymer.dom(this.root).querySelector('.header').querySelector('.sticker');\n\t\t\tif (metricsData.ept != null) {\n\t\t\t\tthis.ept = Math.round(metricsData.ept);\n\t\t\t}\n\t\t\tif (metricsData.bpt != null) {\n\t\t\t\tthis.bpt = Math.round(metricsData.bpt);\n\t\t\t}\n\t\t\tif (metricsData.spt != null) {\n\t\t\t\tthis.spt = Math.round(metricsData.spt);\n\t\t\t}\n\t\t\tif (sticker) {\n\t\t\t\tsticker.style.display = \"block\";\n\t\t\t\tif (this.ept <= 2000) {\n\t\t\t\t\tsticker.style.backgroundColor = '#468847';\n\t\t\t\t} else if (this.ept > 2000 && this.ept <= 3000) {\n\t\t\t\t\tsticker.style.backgroundColor = '#daa520';\n\t\t\t\t} else {\n\t\t\t\t\tsticker.style.backgroundColor = '#b72020';\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( PageHeader );\n","let private_router,\n\t\troutes,\n\t\tPATH_PARAM_REGEX = /:[a-z0-9_$]*/g;\n\nexport class Router {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-router';\n\t\tthis.properties = {\n\t\t\tautoHash: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return false; }\n\t\t\t},\n\n\t\t\troute: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'routeChanged'\n\t\t\t},\n\n\t\t\trouter: {\n\t\t\t\ttype: Object,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif( !private_router ) {\n\t\t\t\t\t\tprivate_router = new window.Router();\n\t\t\t\t\t\tprivate_router.init();\n\t\t\t\t\t}\n\t\t\t\t\treturn private_router;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinit( allRoutes ) {\n\t\tlet modules = Object.keys(allRoutes);\n\n\t\tif( !routes && modules.length ) {\n\t\t\troutes = allRoutes;\n\t\t\tlet router = this.router,\n\t\t\tlen = modules ? modules.length : 0;\n\n\t\t\t// attach a Director handler for all configured routes (module + path = route)\n\t\t\tfor( let i=0; i < len; i++ ) {\n\t\t\t\tlet mod = modules[i],\n\t\t\t\tmodulePaths = Object.keys( routes[mod] ),\n\t\t\t\tpLen = modulePaths ? modulePaths.length : 0;\n\n\t\t\t\tfor( let p=0; p < pLen; p++ ) {\n\t\t\t\t\tlet path = modulePaths[p],\n\t\t\t\t\tpathParams = path ? path.match( PATH_PARAM_REGEX ) : null,\n\t\t\t\t\tparamNames = [],\n\t\t\t\t\tparamMap = {};\n\n\t\t\t\t\t// if path params exist build map of name=value for easy access\n\t\t\t\t\tif( pathParams ) {\n\t\t\t\t\t\tparamNames = pathParams.map( function( val, index ) {\n\t\t\t\t\t\t\tlet p = val.substring(1);\n\t\t\t\t\t\t\tparamMap[p] = null;\n\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\trouter.on( mod + path, function( m, p, paramNames, paramMap ) {\n\t\t\t\t\t\tlet pathParams = JSON.parse(JSON.stringify( paramMap )),  // clone\n\t\t\t\t\t\tparams = Array.prototype.slice.call(arguments,4),\n\t\t\t\t\t\tparamsLen = params ? params.length : 0;\n\n\t\t\t\t\t\t// map path parameter name to actual value\n\t\t\t\t\t\tfor( let j=0; j < paramsLen; j++ )\n\t\t\t\t\t\tpathParams[paramNames[j]] = params[j];\n\n\t\t\t\t\t\tthis.routeHandler( m, p, pathParams );\n\t\t\t\t\t}.bind(this, mod, path, paramNames, paramMap));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trouter.on( '/*', function() {\n\t\t\t\tconsole.log( 'got an unknown route. need to show 404 here' ); // todo\n\t\t\t});\n\n\t\t\trouter.on( '', function() {\n\t\t\t\tconsole.log( 'Got the <empty> route' );\n\t\t\t})\n\t\t}\n\t}\n\n\t/* the Director route handler */\n\trouteHandler( mod, path, params ) {\n\t\t// Director doesn't support query string-like params in the hash.  We have to manually get them.\n\t\tlet hash = window.location.hash.slice(1),\n\t\tpos = hash.indexOf( '?' ),\n\t\tqsParams = {};\n\n\t\tif( pos >= 0 && hash.length > pos ) {\n\t\t\t// use 3rd party to parse\n\t\t\tqsParams = queryString.parse( hash.substring( pos+1 ) );\n\t\t}\n\t\tthis.fire( 'sb-route-complete', {mod: mod, path: path, route: routes[mod][path], pathParams: params, params: qsParams } );\n\t}\n\n\t/** Observer for when the route property changes.  Update the window hash and fire event if needed */\n\trouteChanged( nv, ov ) {\n\t\tif( this.autoHash && nv ) {\n\t\t\tlet same = window.location.hash.slice(1) == this.route;\n\t\t\twindow.location.hash = this.route;\n\n\t\t\t// if you set the hash to be same value as it currently has you don't get a hashchange event\n\t\t\tif( same ) {\n\t\t\t\t// window.dispatchEvent(new HashChangeEvent(\"hashchange\"));  doesn't work in FF so manually dispatch event\n\t\t\t\tthis.router.dispatch( 'on', nv );\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Router );\n","export class Toast {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-toast';\n\t\tthis.properties = {\n\t\t\t/**\n\t\t\t * The array of messages used to build the messagesModel which renders the toasts\n\t\t\t * Can be an array of strings or it can be an array of objects with properties (msg and type)\n\t\t\t * where msg is a string and type is success, error, warning or info (default if type is undefined)\n\t\t\t */\n\t\t\tmessages: {       // Can be array of strings or objects with type and msg properties\n\t\t\t\ttype: Array,  // ['test', '123', 'abc']\n\t\t\t\tnotify: true  // [{type: error, msg: 'hello', type: warning, msg: 'test123', type: success, msg: 'great success'}]\n\t\t\t},\n\t\t\t/**\n\t\t\t * Used to determine the styling if messages is an array of strings.\n\t\t\t * Info styling is used if type is left undefined.\n\t\t\t * This property is not used if messages is an array of objects.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\ttype: String, // Optional -- error, success, warning, info (default if undefined)\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.hasMessages = false;\n\t\tthis.messagesModel = [];\n\t\tthis.repeatHandlers = {};\n\t}\n\n\tget observers() {\n\t\treturn['validation(messages)'];\n\t}\n\n\t/**\n\t * Populates messagesModel that contains information on how to render each type of toast\n\t * Checks to see if first index of array is type String or Object, then it will group and style accordingly.\n\t */\n\tvalidation() {\n\t\tif (!this.messages) {\n\t\t\tthis.messagesModel = [];\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.repeatHandlers = {};\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorMsgs = { type: 'error', class: 'slds-theme--error', msgs: [], icon: 'sf-icon-error' };\n\t\tconst successMsgs = { type: 'success', class: 'slds-theme--success', msgs: [], icon: 'sf-icon-notification' };\n\t\tconst warningMsgs = { type: 'warning', class: 'slds-theme--warning', msgs: [], icon: 'sf-icon-warning' };\n\t\tconst infoMsgs = { type: 'info', class: '', msgs: [], icon: 'sf-icon-info' };\n\t\tif (typeof this.messages[0] === 'object') {\n\t\t\tthis.messages.forEach(({ type, msg }) => {\n\t\t\t\tconst messagesSplit = this.decodeHTML(msg).split('\\n');\n\t\t\t\tif (type === 'error') {\n\t\t\t\t\terrorMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else if (type === 'warning') {\n\t\t\t\t\twarningMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else if (type === 'success') {\n\t\t\t\t\tsuccessMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else {\n\t\t\t\t\tinfoMsgs.msgs.push(messagesSplit);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (typeof this.messages[0] === 'string') {\n\t\t\tconst messagesSplit = this.messages.map(message => ((this.decodeHTML(message).split('\\n'))));\n\t\t\tif (this.type === 'error') {\n\t\t\t\terrorMsgs.msgs = messagesSplit;\n\t\t\t} else if (this.type === 'success') {\n\t\t\t\tsuccessMsgs.msgs = messagesSplit;\n\t\t\t} else if (this.type === 'warning') {\n\t\t\t\twarningMsgs.msgs = messagesSplit;\n\t\t\t} else {\n\t\t\t\tinfoMsgs.msgs = messagesSplit;\n\t\t\t}\n\t\t}\n\n\t\tif (this.messages && this.messages.length > 0) {\n\t\t\tthis.removeRepeatedMessages(errorMsgs, 'error');\n\t\t\tif (errorMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', errorMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(successMsgs, 'success');\n\t\t\tif (successMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', successMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(successMsgs, 'warning');\n\t\t\tif (warningMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', warningMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(infoMsgs, 'info');\n\t\t\tif (infoMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', infoMsgs);\n\t\t\t}\n\t\t\tthis.hasMessages = true;\n\t\t} else {\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.messages = undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Decodes HTML entities to text\n\t * @param {String} html\n\t * @return String with Decoded HTML\n\t */\n\tdecodeHTML(html) {\n\t\tconst text = document.createElement('textarea');\n\t\ttext.innerHTML = html;\n\t\treturn text.value;\n\t}\n\n\tremoveRepeatedMessages(messages, type) {\n\t\tif(!this.messagesModel)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.messagesModel.length; i < l; i++) {\n\t\t\tlet msg = this.messagesModel[i];\n\t\t\tif(type !== msg.type)\n\t\t\t\tcontinue;\n\n\t\t\tlet repeat = this.isMessageRepeated(msg, messages);\n\t\t\tif(repeat) messages.msgs = [];\n\t\t\tthis.toggleRepeatClass(type, repeat, i);\n\t\t}\n\t}\n\n\tisMessageRepeated(msg1, msg2) {\n\t\tfor(let i = 0, l = msg1.msgs.length; i < l; i++) {\n\t\t\tfor (let j = 0, ll = msg1.msgs[i].length; j < ll; j++) {\n\t\t\t\tif (msg2.msgs[i] !== undefined && msg1.msgs[i][j] !== msg2.msgs[i][j])\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\ttoggleRepeatClass(type, repeat, index) {\n\t\tthis.removeAnimationListeners(type, index);\n\t\tlet container = this.addAnimationListeners(type, index);\n\t\tthis.toggleClass('repeat', repeat, container);\n\t}\n\n\tremoveAnimationListeners(type, index) {\n\t\tlet id = type + '_' + index;\n\t\tlet handler = this.repeatHandlers[id];\n\t\tif(!handler)\n\t\t\treturn;\n\n\t\tlet container = this.$$('#' + id);\n\t\tcontainer.removeEventListener('animationend', handler);\n\t\tcontainer.removeEventListener('webkitAnimationEnd', handler);\n\t}\n\n\taddAnimationListeners(type, index) {\n\t\tlet id = type + '_' + index;\n\t\tlet container = this.$$('#' + id);\n\t\tlet handler = this.repeatHandlers[id] || this.removeRepeatClass.bind(this, container);\n\t\tthis.repeatHandlers[id] = handler;\n\n\t\tcontainer.addEventListener('animationend', handler);\n\t\tcontainer.addEventListener('webkitAnimationEnd', handler);\n\t\treturn container;\n\t}\n\n\tremoveRepeatClass(container) {\n\t\tthis.toggleClass('repeat', false, container);\n\t}\n\n\tcloseMessage(e) {\n\t\tlet type = e.model.__data__.messages.type;\n\t\tlet index = 0;\n\t\tfor (let i = 0; i < this.messagesModel.length; i++) {\n\t\t\tif (this.messagesModel[i].type == type) {\n\t\t\t\tdelete this.repeatHandlers[type + '_' + (index++)];\n\t\t\t\tthis.splice('messagesModel', i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tif (this.messagesModel.length == 0) {\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.messages = undefined;\n\t\t}\n\t}\n}\n\nPolymer( Toast );","import {DataHandlerBehavior} from 'quotes/models/DataHandlerBehavior.js';\n\n/**\n * sf-loading-spinner is used to ensure that there is only one spinner on the page at a time. We can increment a counter when a service\n * wishes for a spinner to be shown and decrement it once the service is done loading. If the counter is 0, then the sf-loading-spinner hides.\n *\n * For page level spinners, call: PageContainer.toggleSpinner(b);\n * For individual spinners on things like modals, use sf-loading-spinner\n */\nexport class LoadingSpinner {\n\tget behaviors() {\n\t\treturn [DataHandlerBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-loading-spinner';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'fixed',\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'large',\n\t\t\t},\n\t\t\tmessage: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'RootState',\n\t\t\t\t\tpath: ['spinnerMessage']\n\t\t\t\t},\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'RootState',\n\t\t\t\t\tpath: ['spinnerStatus']\n\t\t\t\t},\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tshowMessage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'RootState',\n\t\t\t\t\tpath: ['showSpinnerMessage']\n\t\t\t\t},\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Conditional to determine whether to hide/show the message.\n\t *\n\t * @param {boolean} showMessage - The boolean property on this component for message visibility.\n\t * @param {string} message - The message content to show.\n\t *\n\t * @returns a boolean indicating whether to hide the message div or not.\n\t */\n\tmessageIsHidden(showMessage, message) {\n\t\treturn !showMessage || !message;\n\t}\n}\n\nPolymer(LoadingSpinner);","let map = {};\n\nexport class Cache {\n\n\tstatic add(name, id, object, type, emitter) {\n\t\tif(!name || !id || !object)\n\t\t\treturn;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\tmap[type] = {};\n\n\t\tif(!map[type][name]) {\n\t\t\tmap[type][name] = {};\n\t\t\tif (emitter && type == 'value' && name == 'LineEditor') {\n\t\t\t\tvar event = document.createEvent('Event');\n\t\t\t\tevent.initEvent(name + '-cached', true, true);\n\t\t\t\tdocument.dispatchEvent(event);\n\t\t\t}\n\t\t}\n\n\t\tmap[type][name][id] = object;\n\t}\n\n\tstatic get(name, id, type) {\n\t\tif(!name || !id)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn null;\n\n\t\tif(!map[type][name])\n\t\t\treturn null;\n\n\t\treturn map[type][name][id];\n\t}\n\n\tstatic remove(name, id, type) {\n\t\tif(!name || !id || !type)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn;\n\t\tif(!map[type][name])\n\t\t\treturn;\n\n\t\tdelete map[type][name][id];\n\t}\n}","import {RemoteSession} from 'common/data/client/RemoteSession.js';\nimport {OAuth} from 'common/oauth/OAuth.js';\n\nexport class ConnectionClient {\n\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tgetConnection() {\n\t\tif (typeof Visualforce !== 'undefined')\n\t\t\treturn Promise.resolve(this.getRemoteConnection());\n\n\t\treturn new OAuth().getConnection();\n\t}\n\n\tgetRemoteConnection(version) {\n\t\treturn new RemoteSession(window.sb.vfSessionId, version).getConnection();\n\t}\n}","import {ConnectionClient} from 'common/data/client/ConnectionClient.js'\nimport {RestClient} from 'common/data/client/RestClient.js';\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\nimport {JsonParser} from 'common/data/parse/JsonParser.js';\n\nexport class RemoteClient {\n\n\tconstructor(metricsService) {\n\t\tthis.VF_MAX_INPUT = 1000000;\n\t\tthis._remoteConnection = new ConnectionClient().getRemoteConnection();\n\t\tthis._restClient = new RestClient(this._remoteConnection);\n\t\tthis.metricsService = metricsService || new MetricsService();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn this._remote('read', reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\tlet _context = JSON.stringify(context);\n\t\tif (this._isPayloadTooLarge([_context, uid]) === true)\n\t\t\treturn this._restClient.load(prefix, loader, uid, context);\n\n\t\t\treturn this._remote('load', loader, uid, _context);\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\tvar _model = typeof model === 'string' ? model : JSON.stringify(model);\n\t\tif (this._isPayloadTooLarge([_model, saver]) === true)\n\t\t\treturn this._restClient.save(prefix, saver, model);\n\n\t\t\treturn this._remote('save', saver, _model);\n\t}\n\n\tdescribe(sObject) {\n\t\treturn this._remoteConnection.describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn new ConnectionClient().getRemoteConnection(version).query(soql);\n\t}\n\n\trequestPost(url, body, options = {}) {\n\t\treturn this._remoteConnection.requestPost(url, body, options);\n\t}\n\n\t_remote(method, provider, input, context) {\n\t\tvar action = this._getAction() + '.' + method;\n\n\t\tif(context)\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(provider);\n\t\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, context, this.metricsService.canGatherMetrics(), function(obj, event) {\n\t\t\t\t\tthis._callback(obj, event, resolve, reject, id);\n\t\t\t   }.bind(this), {escape: false, timeout: 120000});\n\t\t\t}.bind(this));\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tlet id = this.metricsService.startServiceRequest(provider);\n\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, this.metricsService.canGatherMetrics(), function(obj, event) {\n\t\t\t\tthis._callback(obj, event, resolve, reject, id);\n\t\t   }.bind(this), {escape: false, timeout: 120000});\n\t\t}.bind(this));\n\t}\n\n\t_getAction() {\n\t\treturn this._getPrefix() + 'ServiceRouter';\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? (this.prefix + '.') : '';\n\t}\n\n\t_callback(obj, event, resolve, reject, id) {\n\t\tif(!event.status) {\n\t\t\tthis.metricsService.stopServiceRequest(id);\n\t\t\treject(event.message);\n\t\t\treturn;\n\t\t}\n\n\t\tlet response = this._parse(obj);\n\t\tlet spt = Object.keys(response).indexOf('spt') != -1 ? response.spt : undefined;\n\t\tresponse = spt || spt === 0 ? this._parse(response.response) : response;\n\t\tthis.metricsService.stopServiceRequest(id, spt);\n\t\tresolve(response);\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn new JsonParser().parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n\n\t/**\n\t * Is the payload too big to VF remote?\n\t * @param content\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_isPayloadTooLarge(content) {\n\t\treturn (JSON.stringify(content).length > this.VF_MAX_INPUT);\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class RemoteSession {\n\n\tconstructor(sessionId, version) {\n\t\tthis.sessionId = sessionId;\n\t\tthis.version = version || '36.0';\n\t}\n\n\tgetConnection() {\n\t\tlet conn = new jsforce.Connection({\n\t\t\tsessionId : this.sessionId,\n\t\t\tversion: this.version,\n\t\t\tinstanceUrl: sb.common.core.AppContext.user.inCommunity ? sb.common.core.AppContext.org.orgUrl : sb.common.core.AppContext.org.orgInstanceUrl\n\t\t});\n\t\tconn.oik = AppContext.user.oik;\n\t\treturn conn;\n\t}\n}","import {OAuth} from 'common/oauth/OAuth.js';\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\nimport {JsonParser} from 'common/data/parse/JsonParser.js';\n\nexport class RestClient {\n\n\tconstructor(conn, metricsService) {\n\t\tthis.connection = conn;\n\t\tthis.metricsService = metricsService || new MetricsService();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet url = '&reader=' + reader + '&uid=' + uid + '&spt=' + this.metricsService.canGatherMetrics();\n\t\t\t\tlet id = this.metricsService.startServiceRequest(url);\n\t\t\t\tapex.get(this._getEndpoint() + url).then(function(result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet url = '&loader=' + loader + '&uid=' + uid + '&spt=' + this.metricsService.canGatherMetrics();\n\t\t\t\tlet id = this.metricsService.startServiceRequest(url);\n\t\t\t\tapex.patch(this._getEndpoint() + url, {\n\t\t\t\t\tcontext: JSON.stringify(context)\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(saver);\n\t\t\t\tapex.post(this._getEndpoint() + '&spt=' + this.metricsService.canGatherMetrics(), {\n\t\t\t\t\tsaver: saver,\n\t\t\t\t\tmodel: (typeof model === 'string' ? model : JSON.stringify(model))\n\t\t\t\t}).then(function (result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tdescribe(sObject) {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn conn.describe(sObject);\n\t\t});\n\t}\n\n\tquery(soql) {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn conn.query(soql);\n\t\t});\n\t}\n\n\trequestPost(url, body, options = {}) {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn conn.requestPost(url, body, options);\n\t\t});\n\t}\n\n\tstreamFileContents(fileType, fileId, fileContentsField) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._getApex().then((apex) => {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(fileId);\n\t\t\t\tapex.post(null, {\n\t\t\t\t\tsaver: 'sobjects',\n\t\t\t\t\tmodel: '/sobjects/' + fileType + '/' + fileId + '/' + fileContentsField\n\t\t\t\t})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}, (err) => {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t})\n\t\t\t}, (err) => {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetConnection(conn) {\n\t\tthis.connection = conn;\n\t}\n\n\tgetConnection() {\n\t\tif(this.connection)\n\t\t\treturn Promise.resolve(this.connection);\n\n\t\tif(typeof window === 'undefined')\n\t\t\treturn Promise.reject('Connection not set');\n\n\t\tthis.oauth = this.oauth || new OAuth();\n\t\treturn this._getConnection(this.oauth);\n\t}\n\n\t_getConnection(oauth) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\toauth.getConnection().then(function(conn) {\n\t\t\t\tthis.connection = conn;\n\t\t\t\tresolve(this.connection);\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\t_getApex() {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn Promise.resolve(conn.apex);\n\t\t});\n\t}\n\n\t_getEndpoint() {\n\t\treturn this._getPrefix() + '/ServiceRouter?' + (this.connection.oik === undefined ? '' : 'oik=' + this.connection.oik);\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? ('/' + this.prefix) : '';\n\t}\n\n\t_resolve(response, resolve, id) {\n\t\tlet spt = Object.keys(response).indexOf('spt') != -1 ? response.spt : undefined;\n\t\tthis.response = spt || spt === 0 ? this._parse(response.response) : response;\n\t\tthis.metricsService.stopServiceRequest(id, spt);\n\t\tresolve(this.response);\n\t}\n\n\t_reject(reject, errorMessage, id) {\n\t\tnew MetricsService().stopServiceRequest(id);\n\t\treject(this._adjustErrorMessage(errorMessage));\n\t}\n\n\t_adjustErrorMessage(errorMessage) {\n\t\tif(errorMessage === 'expired access/refresh token')\n\t\t\terrorMessage += ' - to authorize go to http://localhost:' + location.port + '/common/oauth';\n\n\t\treturn errorMessage;\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn new JsonParser().parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n}","import {RemoteClient} from 'common/data/client/RemoteClient.js';\nimport {RestClient} from 'common/data/client/RestClient.js';\n\nexport class ServiceClient {\n\n\tconstructor() {\n\t\tthis.client = typeof Visualforce !== 'undefined' ? new RemoteClient() : new RestClient();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\treturn this.client.read(prefix, reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\treturn this.client.load(prefix, loader, uid, context);\n\t}\n\n\tsave(prefix, saver, model) {\n\t\treturn this.client.save(prefix, saver, model);\n\t}\n\n\tmd(prefix, type, fullNames) {\n\t\treturn this.client.load(prefix, 'OAuthExtension.MetadataReader', null, {type: type, items: fullNames});\n\t}\n\n\tdescribe(prefix, sObject) {\n\t\treturn this.client.describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn this.client.query(soql, version);\n\t}\n\n\trequestPost(url, body, options = {}) {\n\t\treturn this.client.requestPost(url, body, options);\n\t}\n\n\tstreamFileContents(fileType, fileId, fileContentsField) {\n\t\treturn this.client.streamFileContents(fileType, fileId, fileContentsField);\n\t}\n\n\tsetConnection(conn) {\n\t\tif(typeof this.client.setConnection === 'function')\n\t\t\tthis.client.setConnection(conn);\n\t}\n}","import {JsonFormatter} from 'common/data/format/JsonFormatter.js';\n\nexport class DataBuilder {\n\n\tconstructor(pretty) {\n\t\tthis.pretty = pretty;\n\t\tthis.data = {};\n\t}\n\n\taddQuote(key, quote, omitRelationships) {\n\t\treturn this.addObject(key, quote, true, omitRelationships, false);\n\t}\n\n\t/**\n\t *\n\t * @param key\n\t * @param obj\n\t * @param omitNull\n\t * @param omitRelationships\n\t * @param stringify\n\t * @returns {DataBuilder}\n\t */\n\taddObject(key, obj, omitNull, omitRelationships, stringify) {\n\t\tthis.data[key] = obj != null ? new JsonFormatter(omitNull, omitRelationships, this.pretty).format(obj, stringify) : obj;\n\t\treturn this;\n\t}\n\n\t//currently unused as the parameters have been checked before reaching the DataBuilder\n\taddInt(key, int) {\n\t\ttry {\n\t\t\tint = parseInt(int);\n\t\t\tif(!isNaN(int))\n\t\t\t\tthis.data[key] = int;\n\t\t\treturn this;\n\t\t} catch (e) {\n\t\t\t// just in case parseInt throws exception in other browsers\n\t\t\treturn this;\n\t\t}\n\t}\n\n\tadd(key, val) {\n\t\tthis.data[key] = val;\n\t\treturn this;\n\t}\n\n\tbuild() {\n\t\treturn this.data;\n\t}\n}","export function formatError(message) {\n\tconst msg = typeof message === 'string' ? message : message[0];\n\tlet topLine = msg.split('\\n')[0].split(':');\n\tif (topLine.length > 1)\n\t\tif (topLine[0].startsWith('System'))\n\t\t\treturn [topLine.splice(1, topLine.length - 1).join(':')];\n\t\telse\n\t\t\treturn [topLine.join(':')];\n\treturn topLine;\n}\n","export class JsonFormatter {\n\n\tconstructor(omitNull, omitRelationships, pretty, formatterOptions) {\n\t\tthis.omitNull = omitNull;\n\t\tthis.omitRelationships = omitRelationships;\n\t\tthis.pretty = pretty;\n\t\tthis.formatterOptions = formatterOptions || {};\n\t}\n\n\t/**\n\t * Formats an object\n\t * @param obj\n\t * @param stringify\n\t * @returns {*}\n\t */\n\tformat(obj, stringify) {\n\t\tif(obj === undefined)\n\t\t\treturn;\n\n\t\tif(obj === null)\n\t\t\treturn JSON.stringify(obj);\n\n\t\tlet pretty = this.pretty;\n\t\tif (typeof pretty !== 'number')\n\t\t\tpretty = pretty ? 2 : null;\n\n\t\tlet _this = this;\n\t\tlet results = JSON.stringify(obj, function (key, value) {\n\t\t\treturn _this._replacer(key, value, this);\n\t\t}, pretty);\n\n\t\treturn stringify === true ? results : JSON.parse(results);\n\t}\n\n\n\t _replacer(key, value, parent) {\n\t\tif (value === undefined || key === '_transient_' || key === 'ui_original_record')\n\t\t\treturn;\n\n\t\tif(this.formatterOptions.cleanRootProperty === key) {\n\t\t\t// since the cleanRootProperty equals the current key, lets store the current clean object from the clean path\n\t\t\tthis.formatterOptions.cleanObj = parent[this.formatterOptions.cleanPathFromRoot[0]];\n\t\t\tfor(let i = 1, l = this.formatterOptions.cleanPathFromRoot.length; i < l; i++)\n\t\t\t\tthis.formatterOptions.cleanObj = this.formatterOptions.cleanObj ? this.formatterOptions.cleanObj[this.formatterOptions.cleanPathFromRoot[i]] : undefined;\n\t\t}\n\n\t\tif (this.omitNull && value === null) {\n\t\t\t// now special handling to prevent removing a null property if dirty\n\n\t\t\t// only consider keeping null properties if the current parent object\n\t\t\t// contains the keepIfDirtyWhenParentContains key; otherwise return to remove the null property\n\t\t\tconst keepDirtyParent = parent[this.formatterOptions.keepIfDirtyWhenParentContains];\n\n\t\t\tif(keepDirtyParent == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// so if the keepDirtyParent matches a value in the keepIfDirtyWhiteList then always keep the null\n\t\t\t// one such use case is for records inside of the ubpChanges object on QuoteLineVO\n\t\t\tif (this.formatterOptions.keepIfDirtyWhiteList != null) {\n\t\t\t\tfor (let whiteListKey in this.formatterOptions.keepIfDirtyWhiteList) {\n\t\t\t\t\tif (this.formatterOptions.keepIfDirtyWhiteList[whiteListKey].indexOf(keepDirtyParent[whiteListKey]) !== -1) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// keep the null property if not null on the clean object as its dirty\n\t\t\tif(this.formatterOptions.cleanObj && this.formatterOptions.cleanObj[key] != null)\n\t\t\t\treturn null;\n\n\t\t\treturn;\n\t\t}\n\n\t\t// if key is an number and not a string then key.endsWith is undefined so lets check its defined before we dereference it\n\t\t// without this check the underlying error affected apply immediately product rule execution for Nimble in Safari\n\t\tif(this.omitRelationships && key.endsWith && key.endsWith('__r'))\n\t\t\treturn;\n\n\t\tif(value === '#Error!')\n\t\t\treturn !this.omitNull ? null : undefined;\n\n\t\treturn value;\n\t}\n}","import {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class QuoteMinimizer {\n\tconstructor(quote, products, groupkey, stripLinesThreshold, stripLinesMessage) {\n\t\tthis.quote = quote;\n\t\tthis.products = products;\n\t\tthis.groupKey = groupkey;\n\t\tthis.stripLinesThreshold = stripLinesThreshold;\n\t\tthis.stripLinesMessage = stripLinesMessage;\n\t}\n\n\treduceQuote(hasRelatedLines) {\n\t\tthis.originalLines = this.quote.lineItems;\n\t\tthis.quote.partialVO = true;\n\n\t\tif (hasRelatedLines === false) {\n\t\t\t// When a quote scoped product selection rules will not have any related lines\n\t\t\tthis.quote.lineItems = [];\n\t\t\treturn this.quote;\n\t\t}\n\n\t\t// If the quote size exceeds the admin-declared large quote threshold, then we need to remove all non-essential\n\t\t// lines from the quote, and capture necessary data about the omitted lines.\n\t\t// Log a message to the console indicating that lines have been omitted.\n\t\tlet lineOmissionMsg = this.stripLinesMessage\n\t\t\t.replace('{0}', this.quote.record.Id)\n\t\t\t.replace('{1}', this.stripLinesThreshold);\n\t\tconsole.log(lineOmissionMsg);\n\n\t\t// Get aggregated data about the lines. Initialize a QuoteLineAggregator to do it.\n\t\tlet qla = new QuoteLineAggregator(this.quote);\n\t\t// We need the IDs of existing products, so that upgrade products can be loaded.\n\t\tthis.quote.existingProductIds = qla.getExistingProductIdsFromLines();\n\t\t// We need to get MDQ Segment Templates from the existing lines, filtering by a group key if one exists.\n\t\t// These let us know how many segments new MDQ products need.\n\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);\n\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey || -1) + ''] = templates;\n\t\t// We need a list of the keys that correspond to empty groups, so we can guarantee that products whose\n\t\t// NewQuoteGroup__c field is checked will be added to new groups under the right circumstances.\n\t\tthis.quote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\n\t\t// Now we need to actually determine which lines can or cannot be omitted.\n\t\t// Get the set of keys we'll have to send. Save it on the component so that we can compare it to the set of lines\n\t\t// we get back.\n\t\tif (this.products)\n\t\t\tthis.requiredKeys = this._getNecessaryLineKeys();\n\t\t// Pull all of those lines into their own list.\n\t\tlet sentLines = [];\n\t\tfor (let line of this.quote.lineItems)\n\t\t\tif (this.requiredKeys.has(line.key))\n\t\t\t\tsentLines.push(line);\n\t\t// Store the original line list so we can restore it after we send the model.\n\t\t// Replace the quote's line item list with this new, abridged one.\n\t\tthis.quote.lineItems = sentLines;\n\n\t\t// Mark the quote VO as partial, and add it to the data model.\n\t\treturn this.quote;\n\t}\n\n\n\n\trevertQuote() {\n\t\tthis.quote.partialVO = false;\n\t\tthis.quote.lineItems = this.originalLines;\n\t\tdelete this.quote.existingProductIds;\n\t\tdelete this.quote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\tdelete this.quote.emptyGroupKeys;\n\t\treturn this.quote;\n\t}\n\n\tgetRequiredKeys() {\n\t\treturn this.requiredKeys;\n\t}\n\n\t_getNecessaryLineKeys() {\n\t\tlet prefix = this.quote.record.attributes.type == 'Quote__c' ? '' : this.quote.record.attributes.type.slice(0, -8);\n\t\tlet relevantKeys = new Set();\n\n\t\t// If we determine that a given line must be sent to the server, we also need to send any lines designated as its\n\t\t// children or its source. This method will add the given line's key to the set, along with its children and source.\n\t\tthis.products.forEach((product) => {\n\t\t\t// Each ProductVO we're sending to the server can require lines for two reasons.\n\t\t\t// 1. If the product has a configuration, the configuration's lineItemKey property can indicate an existing line.\n\t\t\tif (product.configuration && product.configuration.lineItemKey) {\n\t\t\t\tlet lineCount = this.quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = this.quote.lineItems[i];\n\t\t\t\t\tif (line.key === product.configuration.lineItemKey) {\n\t\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 2. If the product has an Upgraded Asset Id, the product requires the line that has that Upgraded Asset Id,\n\t\t\t// and is also marked Existing__c.\n\t\t\tif (product.upgradedAssetId) {\n\t\t\t\tlet lineCount = this.quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = this.quote.lineItems[i];\n\t\t\t\t\tif (line.record[prefix + 'UpgradedAsset__c'] === product.upgradedAssetId && line.record[prefix + 'Existing__c']) {\n\t\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn relevantKeys;\n\t}\n\n\t_addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, rootLine) {\n\t\tif (relevantKeys.has(rootLine.key)) {\n\t\t\t// If the relevant key set already has this rootLine's key, we can be sure we've got all lines related to it too.\n\t\t\t// So we can exit early.\n\t\t\treturn;\n\t\t}\n\t\tlet rootIsParent = rootLine.record[prefix + 'Bundle__c'];\n\t\tlet rootIsUpgrade = rootLine.sourceLineKey != null;\n\t\tif (rootIsParent || rootIsUpgrade) {\n\t\t\t// If the line is a parent line, or an upgrade line, we need to get the line's children and its source.\n\t\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\t\tlet isChildOfRoot = rootIsParent && line.parentItemKey === rootLine.key;\n\t\t\t\tlet isSourceOfRoot = rootIsUpgrade && line.key === rootLine.sourceLineKey;\n\t\t\t\tif (isChildOfRoot || isSourceOfRoot) {\n\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Now that we've got all of the keys related to the root line's key, we add the root line's key and return.\n\t\trelevantKeys.add(rootLine.key);\n\t}\n}","import {Cache} from 'common/data/cache/Cache.js';\n\nexport class JsonParser {\n\n\tparse(strObj) {\n\t\treturn JSON.parse(strObj, this._reviver);\n\t}\n\n\t_reviver(key, value) {\n\t\t// only want to revive original record, so any other key just return the value\n\t\tif(key !== 'ui_original_record')\n\t\t\treturn value;\n\n\t\t// if the value is null then go ahead and return it\n\t\tif(!value) return value;\n\n\t\tlet record = this.record;\n\t\tlet cacheName = value.cacheName; // name of the cached entry to find the original record\n\t\tlet cacheId = value.cacheId; // id of the cached entry to find the original record\n\t\tlet cachePath = value.cachedOriginalRecordPath || []; // path to the original record in the cached object\n\t\tlet clone = value.cloneRecordIfNoCache;\n\t\tlet cachePathLength = cachePath.length;\n\n\t\t// if the cache details are not available then no original record to revive so return null or cloned record\n\t\tlet hasCachedDetails = cacheName && cacheId && cachePathLength > 0;\n\t\tif(!hasCachedDetails) return clone ? JSON.parse(JSON.stringify(record)) : null;\n\n\t\t// if an object is not in the cache then no original record to revive so return null or cloned record\n\t\tlet cachedRecord = Cache.get(cacheName, cacheId.substring(0, 15));\n\t\tif(!cachedRecord) return clone ? JSON.parse(JSON.stringify(record)) : null;\n\n\t\t// loop through cached object via the cache path to find the original record\n\t\tlet original = cachedRecord[cachePath[0]];\n\t\tfor(let i = 1; i < cachePathLength; i++) {\n\t\t\tlet key = cachePath[i];\n\t\t\ttry {\n\t\t\t\t// in case one of the cache parts is a string number, parse to an actual number\n\t\t\t\tlet keyNumber = parseInt(key);\n\t\t\t\tkey = !isNaN(keyNumber) ? keyNumber : key;\n\t\t\t} catch (e) {}\n\n\t\t\t// assign original to the next location in the cached path\n\t\t\toriginal = original ? original[key] : null;\n\t\t}\n\n\t\t// return the original if non nil\n\t\tif(original) return original;\n\n\t\t// no original record, so return null or the cloned record\n\t\treturn clone ? JSON.parse(JSON.stringify(record)) : null\n\t}\n}","import {Cache} from 'common/data/cache/Cache.js';\n\n/**\n * When a service request can run in the background, this component abstracts the service call.\n * If the response is determined to be async, it will poll the job and return the payload.\n * This prevents the client from having to know anything about the job being sync or async.\n */\nexport class AsyncService {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-async-service';\n\t\tthis.properties = {\n\t\t\tresponse: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tcache: String,\n\t\t\tuid: String,\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', this.handleServiceResponse.bind(this));\n\t\tthis.$.jobchecker.addEventListener('result-changed', this.handleAsyncResponse.bind(this));\n\t}\n\n\t/**\n\t * Set response from the server\n\t * @param response\n\t */\n\tsetResponse(response) {\n\t\tthis.response = response;\n\t}\n\n\t/**\n\t * Server responded with a response\n\t * @param e\n\t */\n\thandleServiceResponse(e) {\n\t\tlet response = e.detail.value;\n\t\tif (AsyncService.isAsyncResponse(response) === true)\n\t\t\tthis.pollAsyncJob(response);\n\t\telse\n\t\t\tthis.setResponse(response);\n\t}\n\n\t/**\n\t * Response from the job checker\n\t * @param e\n\t */\n\thandleAsyncResponse(e) {\n\t\tlet response = AsyncService.parseAsyncResponse(e.detail.value);\n\t\tthis.swapCache(response);\n\t\tthis.setResponse(response);\n\t}\n\n\t/**\n\t * Request comes in and we cache a record job response\n\t * We want to cache the payload when the job is complete\n\t * This utility swaps record job for the actual payload\n\t * @param entry\n\t */\n\tswapCache(entry) {\n\t\tif(!this.cache || !this.uid)\n\t\t\treturn;\n\n\t\tlet slot = Cache.get(this.cache, this.uid);\n\t\tdelete slot.recordId;\n\t\tdelete slot.jobId;\n\t\tdelete slot.jobType;\n\t\tCache.add(this.cache, this.uid, Object.assign(entry, slot));\n\t}\n\n\t/**\n\t * Server returned an async model, so we need to check the job status to get the result\n\t * @param asyncModel\n\t */\n\tpollAsyncJob(asyncModel) {\n\t\tthis.$.jobchecker.data = {jobId: asyncModel.jobId, recordId: asyncModel.recordId, jobType: asyncModel.jobType};\n\t}\n\n\t/**\n\t * Checks if the server response is async\n\t * Meaning, the job is running async on the server\n\t * @param response\n\t * @returns {boolean}\n\t */\n\tstatic isAsyncResponse(response) {\n\t\treturn !!(response && response.recordId && response.jobId && response.jobType);\n\t}\n\n\t/**\n\t * Parses the payload from the response\n\t * @param response\n\t */\n\tstatic parseAsyncResponse(response) {\n\t\treturn JSON.parse(response.payload);\n\t}\n}\n\nPolymer(AsyncService);","export class Describe {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-describe';\n\t\tthis.properties = {\n\t\t\tobjects: Array, // An array of objectNames for describing objects\n\t\t\tfields: Array, // An array of objectName.fieldName for describing fields\n\t\t\tcache: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'describe'\n\t\t\t},\n\t\t\tdescribe: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'describeObjects(objects)',\n\t\t\t'describeFields(fields)'\n\t\t];\n\t}\n\n\tdescribeObjects() {\n\t\tlet ordered = [];\n\t\tthis.objects.forEach(function (obj) {\n\t\t\tordered.push(obj);\n\t\t});\n\t\tthis._describe(this.objects).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet response = {objects: ordered};\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tmd[obj.name] = obj;\n\t\t\t}\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\tdescribeFields() {\n\t\tlet ordered = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tordered.push(field);\n\t\t});\n\t\tlet objectFields = {};\n\t\tfor (let i = 0, l = this.fields.length; i < l; i++) {\n\t\t\tlet parts = this.fields[i].split('.'), obj = parts[0], field = parts[1];\n\t\t\tobjectFields[obj] = objectFields[obj] || {};\n\t\t\tobjectFields[obj][field] = true;\n\t\t}\n\n\t\tthis._describe(Object.keys(objectFields)).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet allFields = {};\n\t\t\tlet response = {fields: ordered};\n\t\t\tlet controlledFields = [];\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tlet mdFields = objectFields[obj.name];\n\t\t\t\tfor (let i = 0, l = obj.fields.length; i < l; i++) {\n\t\t\t\t\tallFields[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\tif (mdFields[obj.fields[i].name]) {\n\t\t\t\t\t\tmd[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\t\tobj.fields[i].tableName = obj.name; // add a reference to the field's table\n\t\t\t\t\t\tif (obj.fields[i].controllerName != null) {\n\t\t\t\t\t\t\tcontrolledFields.push(obj.fields[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Loop through all controlled pick-list fields (children) on the requested set of fields\n\t\t\t// and find each child's corresponding controlling pick-list field (parent) and associate the two together\n\t\t\t// also add each controlling pick-list field (parent) to the response md object even if not part of the requested set of fields\n\t\t\tcontrolledFields.forEach((controlledField) => {\n\t\t\t\tlet controllingFieldName = controlledField.tableName + '.' + controlledField.controllerName;\n\t\t\t\tcontrolledField.controllingField = allFields[controllingFieldName];\n\t\t\t\tcontrolledField.controllingField.controllingPicklist = true;\n\t\t\t\tmd[controllingFieldName] = controlledField.controllingField;\n\t\t\t});\n\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\t_describe(objects) {\n\t\tthis.waiting = true;\n\t\tlet promises = [];\n\t\tfor (let i = 0, l = objects.length; i < l; i++)\n\t\t\tpromises.push(this.$.service.describe({sObject: objects[i]}));\n\n\t\treturn Promise.all(promises);\n\t}\n}\n\nPolymer(Describe);","import {AppContext} from 'common/core/AppContext.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {Cache} from 'common/data/cache/Cache.js';\n\nexport class Service {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-service';\n\t\tthis.properties = {\n\t\t\treader: String,\n\t\t\tloader: String,\n\t\t\tsaver: String,\n\t\t\tuid: String, // used for reader, loader, and saver\n\t\t\tmodel: Object, // user for saver\n\t\t\tcontext: Object, // used for loader\n\t\t\tmdType: String, // type of metadata to read (see https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_types_list.htm)\n\t\t\tmdItems: Array, // items of metadata to read\n\t\t\tsObject: String, // name of an sObject to be described\n\t\t\tsoql: String, // soql statement to be queried\n\t\t\tfileType: String, // SObject type of a file whose contents will be read\n\t\t\tfileId: String, // ID of a file whose contents will be read\n\t\t\tfileContentsField: String, // API Name of the field where a file's contents are stored\n\t\t\tcache: String, // the named cache used manage the server retrieve response\n\t\t\twaiting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclient: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn new ServiceClient();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttransient: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean, //Setting this to true will force a read from the service and not use the cache\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tversion: String // currently only supported for the query API for RemoteClient\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_readObserver(reader, uid)',\n\t\t\t'_saveObserver(saver, model)',\n\t\t\t'_loadObserver(loader, uid, context)',\n\t\t\t'_mdObserver(mdType, mdItems)',\n\t\t\t'_describe(sObject)',\n\t\t\t'_query(soql)',\n\t\t\t// though uid is not used for the callout, it is necessary to cache the results, and thus included in the observer\n\t\t\t'_streamFileContentsObserver(uid, fileType, fileId, fileContentsField)',\n\t\t\t'_spinnerObserver(waiting, background)'];\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix : '';\n\t}\n\n\tread(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.read(this.prefix, this.reader, this.uid));\n\t}\n\n\tload(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.load(this.prefix, this.loader, this.uid, this.context));\n\t}\n\n\tsave(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tif (this.transient)\n\t\t\treturn this._response(Promise.resolve(this.model));\n\n\t\tvar promise = this._returnCachedPromise(this.uid);\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.save(this.prefix, this.saver, this.model));\n\t}\n\n\tmd(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.md(this.prefix, this.mdType, this.mdItems));\n\t}\n\n\tdescribe(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse(this.sObject);\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.describe(this.prefix, this.sObject), this.sObject);\n\t}\n\n\tstreamFileContents(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise) {\n\t\t\treturn promise;\n\t\t}\n\t\treturn this._response(this.client.streamFileContents(this.fileType, this.fileId, this.fileContentsField));\n\t}\n\n\tquery(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.query(this.soql, this.version));\n\t}\n\n\t_readObserver (reader, uid) {\n\t\tif (reader === undefined || uid === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._read(reader, uid);\n\t}\n\t\n\t_read() {\n\t\tthis.read().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_loadObserver (loader, uid, context) {\n\t\tif (loader === undefined || uid === undefined || context === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._load(loader, uid, context);\n\t}\n\t\n\t_load() {\n\t\tthis.load().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_saveObserver (saver, model) {\n\t\tif (saver === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._save(saver, model);\n\t}\n\t\n\t_save() {\n\t\tthis.save().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err);\n\t\t});\n\t}\n\n\t_mdObserver (mdType, mdItems) {\n\t\tif (mdType === undefined || mdItems === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._md(mdType, mdItems);\n\t}\n\t\n\t_md() {\n\t\tthis.md().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_describe() {\n\t\tthis.describe().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_query() {\n\t\tthis.query().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_streamFileContentsObserver (uid, fileType, fileId, fileContentsField) {\n\t\tif (uid === undefined || fileType === undefined || fileId === undefined || fileContentsField === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._streamFileContents(uid, fileType, fileId, fileContentsField);\n\t}\n\t\n\t_streamFileContents() {\n\t\tthis.streamFileContents().then(() => {\n\n\t\t}, (err) => {\n\t\t\tconsole.error(err.message || err);\n\t\t});\n\t}\n\n\t_spinnerObserver (waiting, background) {\n\t\tif (waiting === undefined || background === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._spinner(waiting, background);\n\t}\n\t\n\t_spinner() {\n\t\tthis.spinner = this.waiting && !this.background;\n\t}\n\n\t_returnCachedPromise(uid) {\n\t\tvar cachedPromise = Cache.get(this.cache, uid, 'promise');\n\t\tif (cachedPromise) {\n\t\t\tcachedPromise._services = cachedPromise._services || [];\n\t\t\tif(cachedPromise._services.indexOf(this) === -1)\n\t\t\t\tcachedPromise._services.push(this);\n\t\t\treturn cachedPromise;\n\t\t}\n\n\t\tif (this.transient)\n\t\t\treturn Promise.resolve(this.response);\n\n\t\treturn null;\n\t}\n\n\t_returnPromiseIfCachedResponse(uid) {\n\t\tif(this.ignoreCache === true)\n\t\t\treturn false;\n\n\t\tuid = uid || this.uid;\n\n\t\tvar cachedResponse = Cache.get(this.cache, uid);\n\t\tif (cachedResponse) {\n\t\t\tthis.response = cachedResponse;\n\t\t\treturn Promise.resolve(this.response);\n\t\t}\n\n\t\treturn this._returnCachedPromise(uid);\n\t}\n\n\t_response(promise, uid) {\n\t\tthis.waiting = true;\n\t\tCache.add(this.cache, uid || this.uid, promise, 'promise');\n\t\treturn promise.then(function (res) {\n\t\t\tif (res != undefined) {\n\t\t\t\tthis.response = res;\n\t\t\t\tvar services = promise._services || [];\n\t\t\t\tservices.forEach(function(service) {\n\t\t\t\t\tservice.response = this.response;\n\t\t\t\t}.bind(this));\n\t\t\t\tCache.add(this.cache, uid || this.uid, this.response, 'value', this);\n\t\t\t}\n\t\t\tCache.remove(this.cache, uid || this.uid, 'promise');\n\t\t\tthis.waiting = false;\n\t\t\treturn Promise.resolve(this.response);\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tif (err) {\n\t\t\t\tthis.error = this._createError(err);\n\t\t\t\tvar services = promise._services || [];\n\t\t\t\tservices.forEach(function(service) {\n\t\t\t\t\tservice.error = this.error;\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\tCache.remove(this.cache, uid || this.uid, 'promise');\n\t\t\treturn Promise.reject(this.error);\n\t\t}.bind(this));\n\t}\n\n\tcreateError(err) {\n\t\treturn this._createError(err);\n\t}\n\n\t_createError(err) {\n\t\tvar msg = err.message || err;\n\t\tvar error = {message: msg, errorCode: err.errorCode};\n\t\tvar validations;\n\t\tif (msg.indexOf('ValidationException: [') != -1 || msg.startsWith('[')) {\n\t\t\tvar start = msg.indexOf('[');\n\t\t\tvar end = msg.indexOf(']', start) + 1;\n\t\t\tif (end > start)\n\t\t\t\tvalidations = msg.substring(start, end);\n\t\t}\n\n\t\tif (validations) {\n\t\t\ttry {\n\t\t\t\tvar escapedValidations = validations.replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\\\\r\");\n\t\t\t\tvar validationsArray = JSON.parse(escapedValidations);\n\t\t\t\terror.validations = validationsArray;\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n\n\t\treturn error;\n\t}\n}\n\nPolymer(Service);","import {Util} from 'common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Searcher {\n\tconstructor(model) {\n\t\tthis.model = model;\n\t\tthis.searchFilterData = {};\n\t}\n\n\tbuildFields(fields) {\n\t\treturn fields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.model.targetObjectName;\n\t}\n\n\tgetGroupKey(filter) {\n\t\tif (this.model.hasCustomSearchFilters)\n\t\t\treturn filter.record.Id;\n\t\telse\n\t\t\treturn filter.targetFieldName;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tif (this.model.hasCustomSearchFilters) {\n\t\t\tfor (let id of group) {\n\t\t\t\tfor (let filter of this.model.searchFilters) {\n\t\t\t\t\tif (filter.record.Id === id) {\n\t\t\t\t\t\tif(searchFilterModel && this.isLookupType(searchFilterModel[id].model.type))\n\t\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(filter.stringValue, searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\t\tsearchFilterData[id] = {\n\t\t\t\t\t\t\tvalue: this.searchFilterData[id] === undefined ? filter.stringValue : this.searchFilterData[id].value,\n\t\t\t\t\t\t\tfield: this.searchFilterData[id] === undefined ? (filter.targetFieldName ? filter.targetFieldName : '') : this.searchFilterData[id].field,\n\t\t\t\t\t\t\thidden: filter.hidden\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let filter of group) {\n\t\t\t\tsearchFilterData[filter] = {value: this.searchFilterData[filter] === undefined ? searchFilterModel[filter].stringValue : this.searchFilterData[filter].value};\n\t\t\t\tif(this.searchFilterData[filter] && this.searchFilterData[filter].label)\n\t\t\t\t\tsearchFilterData[filter].label = this.searchFilterData[filter].label;\n\t\t\t}\n\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = Searcher.handleDynamicSearchFilters(searchFilterData, this.dynamicSearchFilters);\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = Searcher.handleDynamicSearchFilters(searchFilterData, this.dynamicSearchFilters);\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Given the search filter data, this method adds optional dynamic\n\t * search filter data to the search filter data if they exist.\n\t *\n\t * @param searchFilterData The current state of the search filters\n\t * @param dynamicSearchFilters An object of dynamic search filters\n\t *\n\t * @returns a search filter state with dynamic search filters added.\n\t */\n\tstatic handleDynamicSearchFilters(searchFilterData, dynamicSearchFilters) {\n\t\tif (!dynamicSearchFilters) return searchFilterData;\n\n\t\tfor (let filter of dynamicSearchFilters) {\n\t\t\tif (filter.type === 'Optional Filter' && searchFilterData[filter.targetFieldName])\n\t\t\t\tsearchFilterData[filter.targetFieldName].value = filter.stringValue;\n\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\t/**\n\t * This method returns the field set name for the search filters to use. This\n\t * has to be passed in the request to filter search results with filters\n\t * in order for the backend to know which set of filters to use.\n\t *\n\t * @returns the name of the field set used by the search filters.\n\t */\n\tgetFieldSet() {\n\t\treturn this.fieldSet;\n\t}\n\n\t/**\n\t * Gives the state of the search filters.\n\t *\n\t * @returns an object containing all the filters used with their corresponding\n\t * values.\n\t */\n\tgetFilterContext() {\n\t\tif (this.model.hasCustomSearchFilters)\n\t\t  return this.loadCustomSearchFilterValues(this.model.searchFilters, this.searchFilterData);\n\n\t\treturn this.loadStandardSearchFilterValues(this.searchFilterData);\n\t}\n\n\t/**\n\t * Given a search model with custom search filters, this method returns the\n\t * user's search filter entries/changes.\n\t *\n\t * @param searchModelFilters The search model filters that contains all the\n\t * custom filters\n\t * @param filterData The user's selected/entered filter values\n\t *\n\t * @returns An object containing the up-to-date filter values\n\t */\n\tloadCustomSearchFilterValues(searchModelFilters, filterData) {\n\t\tlet searchFilterData = {};\n\t\tfor (let value in filterData) {\n\t\t\tfor (let filter of searchModelFilters) {\n\t\t\t\t// ignore hidden filters since they are handled in the backend and\n\t\t\t\t// shouldn't be modified on the client-side\n\t\t\t\tif (filter.hidden === true) continue;\n\t\t\t\tif (value !== filter.record.Id) continue;\n\t\t\t\tif (filterData[value] === undefined || filterData[value] === null) continue;\n\t\t\t\t// some search filters evaluate equals instead of contains so need to\n\t\t\t\t// avoid searching against only empty value\n\t\t\t\tif (this.isBlank(filterData[value].value) === true) continue;\n\n\t\t\t\tsearchFilterData[filter.targetFieldName] = filterData[value].value;\n\t\t\t}\n\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\t/**\n\t * Given an object of filters, this method returns an object containing\n\t * user-entered filter values.\n\t *\n\t * @returns an object containing user-entered filter values.\n\t */\n\tloadStandardSearchFilterValues(filterData) {\n\t\tlet searchFilterData = {};\n\t\tfor (let value in filterData) {\n\t\t\t// some search filters evaluate equals instead of contains so need to \n\t\t\t// avoid searching against only empty value\n\t\t\tif (this.isBlank(filterData[value].value) === true) continue;\n\n\t\t\tsearchFilterData[value] = filterData[value].value;\n\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\tgetAdditionalProperties() {\n\t\t// build object for DynamicOptionsLoader service\n\t\tif (this.dynamicSearchFilters) {\n\t\t\tlet filters = [];\n\t\t\tfor (let i = 0, numFilters = this.dynamicSearchFilters.length; i < numFilters; i++)\n\t\t\t\tif (this.dynamicSearchFilters[i].type === 'Default Filter')\n\t\t\t\t\tfilters.push(JSON.stringify(this.dynamicSearchFilters[i]));\n\t\t\treturn filters;\n\t\t}\n\t}\n\n\tclearFields() {\n\t\tlet searchFilterData = {};\n\t\tfor (let filter in this.searchFilterData) {\n\t\t\t// clone the previous object as we want to maintain all previous search filter data properties (i.e. field) and simply clear the value property\n\t\t\tsearchFilterData[filter] = JSON.parse(JSON.stringify(this.searchFilterData[filter]));\n\t\t\tsearchFilterData[filter].value = '';\n\t\t}\n\t\treturn this.searchFilterData = searchFilterData;\n\t}\n\n\trunOnLoad(filterValues) {\n\t\tthis.searchFilterData = filterValues;\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n\n\thasSearchFilterValues() {\n\t\tlet searchValues = this.getFilterContext();\n\t\tfor (let searchFilter in searchValues) {\n\t\t\tif (searchValues[searchFilter] != null)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Is the value blank?\n\t * @param value\n\t * @returns {boolean}\n\t */\n\tisBlank(value) {\n\t\treturn value === null || value === '' || value === undefined;\n\t}\n}\n","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class Checkbox {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-checkbox';\n\t\tthis.properties = {\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_boolify'\n   \t\t\t},\n\t\t\thide: { // this could be a boolean or an object with properties {hidden:true|false and type:hide:invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'hideShow'\n\t\t\t}\n\t\t}\n\t}\n\n\t_boolify() {\n\t\t// if a non-boolean value is pased in, convert it to a boolean\n\t\tif (typeof this.value !== 'boolean')\n\t\t\tthis.value = (this.value !== null && this.value.toLowerCase() === \"true\");\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.checkbox.focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\thideShow() {\n\t\tlet hider = new FieldHider(this.hide, Polymer.Base);\n\t\thider.applyTo(this.$.checkbox);\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Checkbox);","export class DateRange{\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-daterange';\n\t\tthis.properties = {\n\t\t\tformattedValue: Object\n\t\t}\n\t}\n\n\tready() {\n\t\t// Fire daterange change event after datepicker event chain is concluded\n\t\t// Otherwise datepicker event will overwrite filter data\n\t\tthis.addEventListener('selected-date-changed', function() {\n\t\t\tthis.fire('selected-date-range-changed', {value: this.formattedValue});\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( DateRange );","import { AppContext } from 'common/core/AppContext.js';\nimport { I18n } from 'common/core/sb-i18n/I18n.js';\nimport { DateParser } from 'common/forms/DateParser.js';\nimport { rationalizeDate } from 'common/Util.js';\nimport { Events } from 'common/core/Events.js';\nimport { Util } from 'common/Util.js';\n\nexport class Datepicker extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.PANEL_CLOSED] = this.hideCalendar;\n\t\treturn e;\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-datepicker';\n\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedDate: { // if not empty, this property needs to be in ISO-8601 format\n\t\t\t\ttype: Date,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'selectedDateChanged'\n\t\t\t},\n\t\t\trange: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 30\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tdateParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new DateParser();\n\t\t\t\t}\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n\n\tready() {\n\t\tlet localeData = I18n.getLocaleData();\n\t\tthis.isActive = false;\n\n\t\tthis.weeks = [];\n\t\tthis.weekDays = localeData && localeData.date ? localeData.date.calendars.gregory.days.short : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\t\tthis.months = localeData && localeData.date ? localeData.date.calendars.gregory.months.long : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\n\t\tthis.year = this.date.getUTCFullYear();\n\t\tthis.month = this.date.getUTCMonth();\n\t\tthis.monthName = this.months[this.month].toUpperCase();\n\t\tthis.day = this.date.getUTCDate();\n\t}\n\n\t// methods for rendering\n\tgetDate(date) {\n\t\tif (typeof date != 'object') {\n\t\t\treturn new Date(Date.UTC(this.year, this.month, date));\n\t\t}\n\t\treturn date.getUTCDate();\n\t}\n\n\tgetMonthDay(date) {\n\t\tif (typeof date != 'object') {\n\t\t\treturn this.month + '-' + date;\n\t\t}\n\t\tlet month = date.getUTCMonth() + 1; //getMonth() is 0 indexed\n\t\tlet day = date.getUTCDate();\n\t\treturn month + '-' + day;\n\t}\n\n\tgetClass(day) {\n\t\tif (typeof day != 'object') {\n\t\t\tday = new Date(Date.UTC(this.year, this.month, day));\n\t\t}\n\t\tvar className = '';\n\t\tif (day.getUTCMonth() !== this.month ) {\n\t\t\tclassName += 'notCurrent';\n\t\t} else {\n\t\t\tif ( (day.getUTCFullYear() === this.date.getUTCFullYear()) && (day.getUTCMonth() === this.date.getUTCMonth()) && (day.getUTCDate() === this.date.getUTCDate()) ) {\n\t\t\t\tclassName += 'selected';\n\t\t\t}\n\t\t\tif ( (day.getUTCFullYear() === this.year) && (day.getUTCMonth() === this.month) && (day.getUTCDate() === this.date.getUTCDate()) ) {\n\t\t\t\tclassName += ' current';\n\t\t\t}\n\t\t}\n\t\treturn className;\n\t}\n\n\t// observers\n\tselectedDateChanged(newDate, oldDate) {\n\t\tif (this.initialized || this.selectedDate) {\n\t\t\t//handle clicking Clear Fields button on lookup pages\n\t\t\tif (this.selectedDate === '' && this.dateFormatted !=='') {\n\t\t\t\tthis.dateFormatted = '';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._selectedDateChanged(oldDate, this.selectedDate, this.selectedDate == null);\n\t\t\treturn\n\t\t}\n\t\tthis._selectedDateChanged(oldDate, new Date(), true, true);\n\t\tthis.focus();\n\t}\n\n\t_selectedDateChanged(oldDate, selectedDate, isBlank, internal) {\n\t\tthis.initialized = true;\n\t\tthis.date = rationalizeDate(selectedDate);\n\t\tthis.updateVariables();\n\n\t\tif(!isBlank)\n\t\t\tthis.dateFormatted = this.getLocaleDate();\n\t\tif(!internal) {\n\t\t\t// flag we use to determine if calculateImmediately should be fired\n\t\t\t// we prevent firing calculate immediately if this is the first time browser loads (this.selectedDate is undefined)\n\t\t\tlet suppressImmediateCalculation  = oldDate === undefined;\n\t\t\tthis.fire( 'selected-date-changed', { value:  selectedDate, suppressImmediateCalculation } );\n\t\t}\n\n\t}\n\n\t// event handlers\n\tshowCalendar() {\n\t\tif(this.disabled)\n\t\t\treturn;\n\n\t\tthis.ensureProperYearInSelectedAndShowCalendar();\n\t}\n\n\tensureProperYearInSelectedAndShowCalendar() {\n\t\tif(this.year === this.date.getUTCFullYear() && this.haveEnsured)\n\t\t\tthis._showCalendar();\n\n\t\tthis.haveEnsured = true;\n\t\tthis.date.getUTCFullYear();\n\t\tlet years = [];\n\t\tvar start = this.year - this.range;\n\t\tvar end = this.year + this.range + 1;\n\t\tfor ( var i = start; i < end; i++) {\n\t\t\tyears.push(i);\n\t\t}\n\t\tif (AppContext.isIE()) {\n\t\t\tif (!this.yearsCreated) {\n\t\t\t\tthis.$.years.remove(0); // IE creates an extra options\n\t\t\t\tfor (let j = 0, len = years.length; j < len; j++) {\n\t\t\t\t\tthis._createOptionElements(this.$.years, years[j]);\n\t\t\t\t}\n\t\t\t\tthis.yearsCreated = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.years = years;\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.yearSelection = this.$.years;\n\t\t\tif (this.yearSelection.selectedOptions) {\n\t\t\t\tthis.yearSelection.selectedOptions[0].selected = '';\n\t\t\t}\n\t\t\tthis.yearSelection.options[this.range].selected = 'selected';\n\t\t\tthis._showCalendar();\n\t\t}.bind(this));\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option;\n\t\toptionEl.value = option;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\t_showCalendar() {\n\t\tthis.isActive = true;\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t\tthis.fire('datepicker-opened', {datepicker: this.$.datePicker, dateContainer: this.$.dateContainer});\n\t\tdocument.addEventListener('click', this._clickHandler.bind(this));\n\t\tUtil.horizontalBound(this.$.datePicker, 5);\n\t}\n\n\t_clickHandler(e) {\n\t\tlet shouldKeepCalendarOpen = Polymer.dom(e).path.some(element => {return element === this});\n\t\tif (!shouldKeepCalendarOpen) {\n\t\t\tthis.hideCalendar();\n\t\t}\n\t}\n\n\thideCalendar() {\n\t\tif (this.isActive) {\n\t\t\tthis.isActive = false;\n\t\t\tthis.focus();\n\t\t}\n\t\tdocument.removeEventListener('click', this._clickHandler);\n\t}\n\n\tfindToday() {\n\t\tthis.selectedDate = new Date();\n\t\tthis.updateYearPicklist();\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tupdateYearPicklist() {\n\t\tlet options = this.yearSelection.options;\n\t\tfor (let i= 0, l=options.length; i<l; i++) {\n\t\t\toptions[i].selected = this.year == options[i].text;\n\t\t}\n\t}\n\n\tchangeYear() {\n\t\tthis.year = parseInt(this.yearSelection.selectedOptions[0].text);\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tdecreaseMonth() {\n\t\tthis.month = this.month - 1;\n\t\tif(this.month < 0){\n\t\t\tthis.month = 11;\n\t\t\tthis.year = this.year -1;\n\t\t\tthis.updateYearPicklist();\n\t\t}\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.updateCalendar();\n\t}\n\n\tincreaseMonth() {\n\t\tthis.month = this.month + 1;\n\t\tif(this.month>11){\n\t\t\tthis.month = 0;\n\t\t\tthis.year = this.year + 1;\n\t\t\tthis.updateYearPicklist();\n\t\t}\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.updateCalendar();\n\t}\n\n\tselectDay(e) {\n\t\tthis.selectedDate = e.model ? e.model.day : this.date;\n\t\tthis.hideCalendar();\n\t}\n\n\t// helper methods\n\tupdateVariables() {\n\t\tthis.year = this.date.getUTCFullYear();\n\t\tthis.month = this.date.getUTCMonth();\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.day = this.date.getUTCDate();\n\t}\n\n\tupdateDate(increment) {\n\t\tthis.date.setUTCDate(this.date.getUTCDate() + increment);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t}\n\n\tupdateCalendar() {\n\t\tthis.weeks = [];\n\t\tvar firstDay = new Date(Date.UTC(this.year, this.month, 1));\n\t\tvar index = firstDay.getUTCDay();\n\t\tvar numOfDays = 6 * 7;\n\t\tvar week = [];\n\t\tvar dayIdx = 0;\n\t\tfor ( var i = 0; i < numOfDays; i++) {\n\t\t\tvar day = new Date(firstDay);\n\t\t\tday.setUTCDate(firstDay.getUTCDate() + (i - index));\n\t\t\tweek[dayIdx] = day;\n\t\t\tdayIdx++;\n\n\t\t\tif ( ((i+1) % 7) === 0 || i+1 === numOfDays) {\n\t\t\t\tthis.push('weeks', week);\n\t\t\t\tweek = [];\n\t\t\t\tdayIdx = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidateInput() {\n\t\tif (this.noblur)\n\t\t\treturn;\n\n\t\tlet error;\n\t\tlet invalid = false;\n\t\tlet dateString = this.$.dateInput.value;\n\t\tlet emptyDate = dateString.trim() === '';\n\t\tlet localeDate = !emptyDate ? this.getLocaleDate() : '';\n\t\tlet dateChanged = dateString !== localeDate || (this.selectedDate === null && !emptyDate);\n\t\tif (dateChanged) {\n\t\t\tlet parsedDate = this.dateParser.parse(dateString, function(year) {\n\t\t\t\treturn year >= this.year - this.range && year <= this.year + this.range;\n\t\t\t}.bind(this));\n\t\t\tinvalid = parsedDate == null;\n\n\t\t\t// update date to reflect the input change\n\t\t\tif (!invalid) {\n\t\t\t\tthis.selectedDate = parsedDate;\n\t\t\t\tthis.updateVariables();\n\t\t\t} else {\n\t\t\t\terror = this.i18n.l('Invalid Date.');\n\t\t\t}\n\t\t}\n\n\t\tlet hasSelectedDate = typeof this.selectedDate === 'object' || this.selectedDate.trim() !== '';\n\t\tif(emptyDate && hasSelectedDate) {\n\t\t\tthis.dateFormatted = '';\n\t\t\tthis.selectedDate = null;\n\t\t}\n\n\t\tthis.invalidInput = invalid;\n\t\tthis.fire('field-change-validated', {error: error});\n\n\t\tthis.fire('sb-date-blur');\n\t}\n\n\tnavigate(e) {\n\t\tif (e.keyCode === 9) { // tab key\n\t\t\tthis.hideCalendar();// hide the calendar\n\t\t\treturn; // allow default behavior\n\t\t}\n\n\t\tswitch(e.keyCode) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tif (this.isActive) // changes made using calendar popout\n\t\t\t\t\tthis.selectDay(e);\n\t\t\t\telse // manual edits to the input text\n\t\t\t\t\tthis.validateInput();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif (this.isActive) this.hideCalendar();\n\t\t\t\telse {\n\t\t\t\t\tthis.escaped = true;\n\t\t\t\t\tthis.fire('sb-date-esc', {keyCode: 27});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 37: // left arrow\n\t\t\t\tthis.updateDate(-1);\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\t\tthis.updateDate(-7);\n\t\t\t\tbreak;\n\t\t\tcase 39: // right arrow\n\t\t\t\tthis.updateDate(+1);\n\t\t\t\tbreak;\n\t\t\tcase 40: // down arrow\n\t\t\t\tif(!this.isActive) this.showCalendar();\n\t\t\t\telse this.updateDate(+7);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetLocaleDate() {\n\t\ttry {\n\t\t\treturn this.date.toLocaleDateString(this.user.locale, { timeZone: 'UTC' });\n\t\t} catch (e) {\n\t\t\treturn this.date.toLocaleDateString(); // Catch error as FF does not accept parameter\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.highlight();\n\t\tthis.$.dateInput.focus();\n\t}\n\n\thighlight() {\n\t\tif(this.dateFormatted)\n\t\t\tthis.$.dateInput.setSelectionRange(0, this.dateFormatted.length);\n\t}\n\n\tpreventBlur() {\n\t\tthis.noblur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noblur = false;\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\n\nPolymer( Datepicker );\n","import {NumberParser} from 'common/forms/NumberParser.js';\nimport {getUnitAndDisplayValue, setDiscountValue, convertDiscountValue} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\n\nexport class Discount {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount';\n\t\tthis.properties = {\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged',\n\t\t\t},\n\t\t\tproperty: String,\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tunitChanged: Object,\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tformatter: Object,\n\t\t\tdisplayValue: String,\n\t\t\toriginal: Object,\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ '_runConverterObserver(model, property)' ];\n\t}\n\n\tready() {\n\t\tlet input = this.$.discount.querySelector('.myinput');\n\t\tinput.addEventListener('change', this.checkThenSetDiscountValue.bind(this));\n\t\tinput.addEventListener('focus', this.focused.bind(this));\n\t\tinput.addEventListener('blur', this.deferBlur.bind(this));\n\t\tinput.addEventListener('keydown', this.tabBlur.bind(this, true));\n\n\t\tlet select = this.$.discountUnits.querySelector('.myselect');\n\t\tselect.addEventListener('change', this.convertDiscountValueThenUpdate.bind(this));\n\t\tselect.addEventListener('focus', this.focused.bind(this));\n\t\tselect.addEventListener('blur', this.deferBlur.bind(this));\n\t\tselect.addEventListener('keydown', this.tabBlur.bind(this, false));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.discount.focus();\n\t}\n\n\tfocused() {\n\t\tif(this.blurred)\n\t\t\tclearTimeout(this.blurred);\n\t}\n\n\tdeferBlur() {\n\t\tif(this.tabBlurred)\n\t\t\tthis.tabBlurred = false;\n\t\telse {\n\t\t\tthis.blurred = setTimeout(function () {\n\t\t\t\tthis.blurDiscount(true);\n\t\t\t}.bind(this), 1);\n\t\t}\n\t}\n\n\ttabBlur(isInput, e) {\n\t\tif (e.keyCode === 27 && this.renderReadOnly) { // esc key\n\t\t\tthis.resetToOriginal();\n\t\t\treturn;\n\t\t}\n\n\t\tif(e.keyCode !== 9) // bail if not tab key\n\t\t\treturn;\n\n\t\tthis.tabBlurred = true;\n\n\t\t// blur direction is shift+tab from input or normal tab from select\n\t\tlet blurDirection = (isInput && e.shiftKey) || (!isInput && !e.shiftKey);\n\t\tif(blurDirection)\n\t\t\tthis.blurDiscount(false, e);\n\t}\n\n\tblurDiscount(directBlur, tabBlurEvent) {\n\t\tif(directBlur)\n\t\t\tthis._blur(tabBlurEvent);\n\t\telse {\n\t\t\tsetTimeout(function () {\n\t\t\t\tthis._blur(tabBlurEvent);\n\t\t\t}.bind(this), 10);\n\t\t}\n\t}\n\n\t_blur(tabBlurEvent) {\n\t\tlet value = this.$.discount.value !== '' ? this.numberParser.parse(this.$.discount.value) : null;\n\t\tsetDiscountValue(this.model, this.property, value);\n\t\tthis.fire('sb-discount-blur');\n\t\tif(tabBlurEvent) this.fire('sb-discount-keydown', {keyCode: 9, shiftKey: tabBlurEvent.shiftKey} );\n\t}\n\n\tcheckThenSetDiscountValue(e) {\n\t\tconst { displayValue: oldValue } = getUnitAndDisplayValue(this.model, this.property);\n\t\t// If value is empty string set to null to avoid NaN returning from NumberParser.js parse method\n\t\tlet value = e.target.value !== '' ? this.numberParser.parse(e.target.value) : null;\n\t\tif ( oldValue != value ) {\n\t\t\tsetDiscountValue(this.model, this.property, value);\n\t\t\tthis.fire('sb-discount-change', { value });\n\t\t}\n\t}\n\n\tconvertDiscountValueThenUpdate(e) {\n\t\tconvertDiscountValue(this.model, this.property, e.target.value);\n\t\tthis.displayValue = undefined;\n\t\tthis.displayValue = this.formatter.format(getUnitAndDisplayValue(this.model, this.property).displayValue);\n\t}\n\n\tresetToOriginal() {\n\t\t// need to call each API twice during escape sequence (this is not a mistake)\n\t\tthis.checkThenSetDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValueThenUpdate({target: {value: this.original.unitValue}});\n\t\tthis.checkThenSetDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValueThenUpdate({target: {value: this.original.unitValue}});\n\t\tthis.selectUnit(getUnitAndDisplayValue(this.model, this.property).unit);\n\t}\n\n\tselectUnit(value) {\n\t\tlet select = this.$.discountUnits.querySelector('.myselect');\n\t\tlet options = select.options;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif(options[i].value === value) {\n\t\t\t\tselect.selectedIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_runConverterObserver (model, property) {\n\t\tif (model === undefined || property === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._runConverter(model, property);\n\t}\n\t\n\t_runConverter(model, property) {\n\t\tconst {units, unit} = getUnitAndDisplayValue(model, property);\n\t\tthis.$.discountUnits.value = unit; // This must be set before options are set\n\t\tthis.$.discountUnits.options = units;\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this);\n\t}\n}\nPolymer(Discount);","export class DualListBox {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dual-list-box';\n\t\tthis.properties = {\n\t\t\toptions: Array,\n\t\t\tavailableTitle: String,\n\t\t\tchosenTitle: String,\n\t\t\tvalue: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_buildOptions(options)'];\n\t}\n\n\t_buildOptions() {\n\t\tthis.value = [];\n\t\tthis.chosenOptions = [];\n\t\tlet availableOptions = [];\n\t\tthis._clearSelected();\n\t\tthis.options.forEach( function(option) {\n\t\t\toption.available = true;\n\t\t\tavailableOptions.push(option);\n\t\t}.bind(this));\n\t\tthis.availableOptions = availableOptions;\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.$.available.addEventListener('change', function (e) {\n\t\t\t\tthis.availableOptionsSelected = e.detail.value;\n\t\t\t}.bind(this));\n\t\t\tthis.$.chosen.addEventListener('change', function (e) {\n\t\t\t\tthis.chosenOptionsSelected = e.detail.value;\n\t\t\t}.bind(this));\n\t\t});\n\t}\n\n\t_updateOptions(e) {\n\t\tlet direction = e.currentTarget.getAttribute('data-index');\n\t\t// Create a set of values that represent selected options depending on the chosen direction\n\t\tlet valueSet = new Set(direction === 'right' ? this.availableOptionsSelected.split(';') : this.chosenOptionsSelected.split(';'));\n\t\tthis.availableOptionsSelected = '';\n\t\tthis.chosenOptionsSelected = '';\n\t\tlet availableOptions = [];\n\t\tlet chosenOptions = [];\n\t\tthis.options.forEach( function(option) {\n\t\t\tif (direction === 'right') {\n\t\t\t\t// Gathers values that are selected in the available column or are already in the chosen list\n\t\t\t\tif (valueSet.has(option.value.toString()) || !option.available) {\n\t\t\t\t\toption.available = false;\n\t\t\t\t\tchosenOptions.push(option);\n\t\t\t\t} else {\n\t\t\t\t\tavailableOptions.push(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Gathers values that are selected in the chosen list or are already in the available list\n\t\t\t\tif (valueSet.has(option.value.toString()) || option.available) {\n\t\t\t\t\toption.available = true;\n\t\t\t\t\tavailableOptions.push(option);\n\t\t\t\t} else {\n\t\t\t\t\tchosenOptions.push(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._clearSelected();\n\t\tthis.availableOptions = availableOptions;\n\t\tthis.chosenOptions = chosenOptions;\n\t\tthis.value = this.chosenOptions;\n\t}\n\n\t/**\n\t * Used to clear the value of the sb-select components in order to remove the gray highlights\n\t * @private\n\t */\n\t_clearSelected() {\n\t\tthis.$.available.value = null;\n\t\tthis.$.chosen.value = null;\n\t}\n}\nPolymer( DualListBox );","import {AppContext} from 'common/core/AppContext.js';\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {fieldFactory} from 'common/forms/sb-field/factory/FieldFactory.js';\nimport {DependentPicklistBuilder} from 'common/forms/DependentPicklistBuilder.js';\nimport {Html} from 'common/layout/sb-html/Html.js';\nimport { Formatter } from 'common/formatter/Formatter.js';\n\nlet KEY_READ_ONLY = 'keyReadOnly',\n\tKEY_DOWN_READ_ONLY = 'keyDownReadOnly',\n\tBLUR_READ_ONLY = 'blurReadOnly',\n\tCHANGE = 'change',\n\tHIDE_FIELD = 'hideField',\n\tREF_DISPLAY = 'refDisplay',\n\tAPPLY_FOCUS = 'applyFocus';\n\nexport class Field extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: Object,\n\t\t\t/** Required but only if you are not passing in a value */\n\t\t\tproperty: String,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\t//adapt product metadata to return map object instead of array\n\t\t\t/** Object with structure of:\n\t\t\t {\n\t\t\t\ttype: STRING | REFERENCE | DOUBLE | CURRENCY | PICKLIST | DATE | DATETIME | CHECKBOX | BOOLEAN | RADIO\n\t\t\t\tname: <object field API name>\n\t\t\t\tlabel: <object field label>\n\t\t\t\tscale: integer\n\t\t\t\tpicklistValues: [ { label: <label>, value: <value> }]\n\t\t\t\treferenceTable: <name of editable reference lookup table>\n\t\t\t\tlink: boolean\n\t\t\t }\n\t\t\t */\n\t\t\tmd: Object,\n\t\t\ttype: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getType(md)'\n\t\t\t},\n\t\t\t/** Metadata for all referenced objects in same structure as md */\n\t\t\trefObjects: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tediting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\t_wasEverEditable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setWasEverEditable(editing)'\n\t\t\t},\n\t\t\tdisabled: { // optional boolean if field is disabled\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t\thidden: { // optional field if hidden, this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible} (only supports checkbox and radio fields)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'hiddenChanged'\n\t\t\t},\n\t\t\tlink: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\tvalue: {\n\t\t\t\tobserver: '_valueChanged'\n\t\t\t},\n\t\t\trefDisplay: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tobjAndRefObjects: Object, // use if obj and refObjects on same object\n\t\t\tobjKey: String, // if objAndRefObjects is set, this string is the key to the obj sub property\n\t\t\trefObjectsKey: String, // if objAndRefObjects is set, this string is the key to the refObjects sub property,\n\t\t\trefTable: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'computeRefTable(md)'\n\t\t\t},\n\t\t\treadOnly: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\trenderReadOnly: { // set to true if field should be initially rendered as read-only\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tformattedValue: Object, // set to the formatted value of this field for direct binding if renderReadOnly is true\n\t\t\toriginalFormattedValue: String,\n\t\t\thideFormattedValue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'applyFocus'\n\t\t\t},\n\t\t\tindex: Number, // index of this field in the context of a group of fields (e.g. table row)\n\t\t\trecordId: { // the record id of this field\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'recordIdChanged'\n\t\t\t},\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tpreventNumericAlignment: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tsignaler: Object,\n\t\t\trecord: Object,\n\t\t\ttabIndex: Number,\n\t\t\tfactoryData: Object,\n\t\t\thtml: Object\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['_renderObserver(model, obj, property, md, refObjects, editing, renderReadOnly, html)',\n\t\t\t'_setObjAndRefObjectsObserver(objAndRefObjects, objKey, refObjectsKey)',\n\t\t\t'_setOriginalFormattedValueObserver(model, originalValue, md)',\n\t\t\t'addControlledSelectListener(md)',\n\t\t\t'recordChanged(record.*)',\n\t\t\t'_valueChangedObserver(model, obj, md, property, html, value)',\n\t\t\t'_disabledChangedObserver(model, obj, md, html, disabled)',\n\t\t\t'_createObjObserver(value, property)'];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-row-focus-signal', this.handleRowFocusSignal.bind(this));\n\t\tthis.addEventListener('sb-field-edit', this.handleFieldEditSignal.bind(this));\n\t\tthis.html = new Html(this);\n\t}\n\n\tattached() {\n\t\tthis._tapHandler = this.linkOrEdit.bind(this);\n\t\tthis.querySelector('#formatted').addEventListener('tap', this._tapHandler, { passive: true });\n\t}\n\n\tdetached() {\n\t\tif (this._tapHandler && this.querySelector('#formatted')) {\n\t\t\tthis.querySelector('#formatted').removeEventListener('tap', this._tapHandler);\n\t\t}\n\t}\n\n\t_createObjObserver (value, property) {\n\t\tif (value === undefined || property === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._createObj(value, property);\n\t}\n\n\t// have a value and property but no object, so create object with the value\n\t// if other required properties are already set, then will trigger the render via the observer\n\t_createObj(value, property) {\n\t\tif (this.obj && !this.isInternalObject) {\n\t\t\treturn;\n\t\t}\n\t\tthis.isInternalObject = true;\n\t\tconst obj = this.obj ? this.obj : { };\n\t\tobj[property] = value;\n\t\tthis.obj = obj;\n\t}\n\n\t_setObjAndRefObjectsObserver (objAndRefObjects, objKey, refObjectsKey) {\n\t\tif (objAndRefObjects === undefined || objKey === undefined || refObjectsKey === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey);\n\t}\n\n\tsetObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey) {\n\t\tthis.obj = undefined;\n\t\tthis.refObjects = undefined;\n\t\tthis.refObjects = objAndRefObjects[refObjectsKey];\n\t\tif (typeof this.refObjects === 'undefined')\n\t\t\tthis.refObjects = {};\n\t\tif (objKey !== '')\n\t\t\tthis.obj = objAndRefObjects[objKey];\n\t\telse\n\t\t\tthis.obj = objAndRefObjects;\n\t}\n\n\t_renderObserver (model, obj, property, md, refObjects, editing, renderReadOnly, html) {\n\t\tif (model === undefined || obj === undefined || property === undefined || md === undefined ||\n\t\t\t refObjects === undefined || editing === undefined || renderReadOnly === undefined || html === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.render(model, obj, property, md, refObjects, editing, renderReadOnly, html);\n\t}\n\n\trender(model, obj, property, md, refObjects, editing, renderReadOnly, html) {\n\t\tthis.rendered = true;\n\t\tif (this.isReadOnly()) {\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._toggleEditing)\n\t\t\tthis._unrender();\n\n\t\tthis._render(model, obj, md, html);\n\t}\n\n\t_render(model, obj, md, html) {\n\t\tif(this.template)\n\t\t\treturn;\n\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tlet ff = this.updateTemplateData(model, obj, md, html);\n\t\tthis.createBaseElement(ff.html);\n\n\t\t// callback to handle general events on fields\n\t\tthis.template[CHANGE] = this.onChange.bind(this);\n\t\tthis.template[KEY_READ_ONLY] = (e) => this.onKeyupReadOnly(this.model, this.obj, this.md, this.html, e);\n\t\tthis.template[KEY_DOWN_READ_ONLY] = this.onKeyDownReadOnly.bind(this);\n\t\tthis.template[BLUR_READ_ONLY] = (keepNewValue) => this.onBlurReadOnly(this.model, this.obj, this.md, this.html, keepNewValue);\n\n\t\tif(!this.isReadOnly())\n\t\t\tthis.hideFormattedValue = true;\n\n\t\t// stamp the template into the DOM\n\t\tPolymer.dom(this.$.f).appendChild(this.template);\n\t}\n\n\t_unrender() {\n\t\tif (!this.template)\n\t\t\treturn;\n\t\ttry {\n\t\t\tlet field = Polymer.dom(this.$.f);\n\t\t\tlet childNodes = field.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tfield.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_setOriginalFormattedValueObserver (model, originalValue, md) {\n\t\tif (model === undefined || originalValue === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setOriginalFormattedValue(model, originalValue, md);\n\t}\n\n\t_setOriginalFormattedValue(model, originalValue, md) {\n\t\tlet formField = this.getFormField(model, originalValue, md);\n\t\tlet originalValueChanged = this.originalFormattedValue && this.originalFormattedValue.value !== undefined && this.originalFormattedValue.value !== originalValue;\n\t\tthis.originalFormattedValue = this.getFormattedValue(formField, originalValue);\n\t\tif(this.formattedValue && originalValueChanged) // if formatted value exists and original has changed, then lets recalculate the dirty class\n\t\t\tthis.addFormattedDirtyClass(this.isEditable());\n\t}\n\n\tonChange(e) {\n\t\tthis._onChange(e);\n\t\tlet suppressImmediateCalculation = e.detail ? e.detail.suppressImmediateCalculation : false;\n\t\tthis.fire('sb-field-on-change-field', {suppressImmediateCalculation});\n\t}\n\n\t_onChange(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tlet target = this.getEventTarget(e);\n\t\tlet val = target.value !== undefined ? target.value : (e.detail ? e.detail.value : null);\n\t\tthis.refDisplay = target[REF_DISPLAY] !== undefined ? target[REF_DISPLAY] :\n\t\t\t(e.detail && e.detail[REF_DISPLAY] !== undefined ? e.detail[REF_DISPLAY] : this.refDisplay);\n\n\n\t\tif (this.isNumericType()) {\n\t\t\t// If val is truthy, or 0 we need to parse a number from it. 0 is included so we don't accidentally convert\n\t\t\t// it to null.\n\t\t\tif (val && val !== 0) {\n\t\t\t\tval = this.numberParser.parse(val, false, this.md.scale);\n\t\t\t} else {\n\t\t\t\t// Any falsy, non-zero values must be converted to null to avoid deserialization problems. For example,\n\t\t\t\t// an empty string deserializes to 0 on SF, which is a problem.\n\t\t\t\tval = null;\n\t\t\t}\n\t\t} else if (val instanceof Date) {\n\t\t\tval = this.type === 'date' ? Formatter.toApexDate(val) : Formatter.toApexDateTime(val);\n\t\t}\n\n\t\tthis.internal = true;\n\t\tthis.obj[this.property] = val;\n\t\tthis.domHost.value = val;\n\t\tthis.internal = false;\n\t\tthis.fireCustomChangeEvents(e);\n\t}\n\n\tfireCustomChangeEvents(e) {\n\t\t// must have e.detail check for FireFox as caller method is fired twice when we only want this to be fired once\n\t\t// however, the caller method is only called once with an event object that contains detail\n\t\tif (this.md && (!e || e.detail))\n\t\t\tthis.fireControllingSelectChangeEvent();\n\t}\n\n\tfireControllingSelectChangeEvent() {\n\t\tvar data = {tableName: this.md.tableName, fieldName: this.md.name, record: this.record};\n\t\tvar signal = new CustomEvent('sb-controlling-select-changed', {bubbles: false, detail: data});\n\t\tdocument.dispatchEvent(signal);\n\t}\n\n\tonKeyDownReadOnly(e) {\n\t\tif(!this.signaler || !this.isRenderReadOnly())\n\t\t\treturn;\n\n\t\tlet keyCode = e.keyCode || e.detail.keyCode;\n\t\tif (keyCode !== 9) // bail if not tab key\n\t\t\treturn;\n\n\t\tlet shiftKey = e.shiftKey || e.detail.shiftKey;\n\t\tthis.signaler.signalNextPreviousEditableTarget(this, !shiftKey);\n\t}\n\n\tonKeyupReadOnly(model, obj, md, html, e) {\n\t\tlet keyCode = e.keyCode || e.detail.keyCode;\n\t\tif(keyCode !== 27) // bail if not escape key\n\t\t\treturn;\n\n\t\tthis.onBlurReadOnly(model, obj, md, html, false);\n\t}\n\n\tonBlurReadOnly(model, obj, md, html, keepNewValue) {\n\t\tif(!this.isReadOnly())\n\t\t\treturn;\n\n\t\tif(this.template[HIDE_FIELD])\n\t\t\treturn;\n\n\t\tif(keepNewValue) {\n\t\t\tthis.setPreviouslyFormattedValue();\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t} else {\n\t\t\tlet data = { target: { value: this.previouslyFormatted ? (this.previouslyFormatted.value) : this.formattedValue.value } };\n\t\t\tif(this.isLookup())\n\t\t\t\tdata.target[REF_DISPLAY] = this.previouslyFormatted ? this.previouslyFormatted.label : this.formattedValue.label;\n\t\t\tthis._onChange(data);\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t}\n\n\t\tthis.template[HIDE_FIELD] = true;\n\t\tthis.hideFormattedValue = false;\n\n\t\tif(this.isRenderReadOnly())\n\t\t\tthis.enableSignals();\n\t}\n\n\tupdateTemplateData(model, obj, md, html) {\n\t\tlet value = obj[this.property];\n\t\tlet formField = this.getFormField(model, value, md);\n\n\t\tif(formField.defaultValue && this.template) // default value only used if a template\n\t\t\tthis._onChange( { target: { value: formField.defaultValue} } );\n\n\t\tthis.formattedValue = this.getFormattedValue(formField, value);\n\t\tthis.originalFormattedValue = this.originalFormattedValue || this.formattedValue;\n\t\tthis.addFormattedValueClasses(formField.numeric);\n\n\t\tif(this.isReadOnly())\n\t\t\tthis.setFormattedDetails(html);\n\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tformField.attachTo(this.template, KEY_READ_ONLY, KEY_DOWN_READ_ONLY, BLUR_READ_ONLY, CHANGE, HIDE_FIELD, this.isRenderReadOnly());\n\t\treturn formField;\n\t}\n\n\tgetFormField(model, value, md) {\n\t\tlet editable = this.isEditable(!this._toggleEditing);\n\t\tlet selectOptions = this.getSelectOptions(md);\n\t\tlet referenceDetails = { refDisplay: this.refDisplay, refDisplayName: REF_DISPLAY, refTable: this.refTable, refObjects: this.refObjects, property: this.property, obj: this.obj, record: this.record };\n\t\treturn fieldFactory(this.type, model, value, editable, this.disabled, this.hidden, this.index, this.md, this.i18n, this.isRenderReadOnly(), selectOptions, referenceDetails, this.tabIndex, this.factoryData);\n\t}\n\n\tgetFormattedValue(formField, value) {\n\t\treturn formField.formattedValue || { value: value, label: value };\n\t}\n\n\taddFormattedValueClasses(numeric) {\n\t\tlet editable = this.isEditable();\n\t\tthis.toggleClass('editable', editable, this.$.formatted);\n\t\tthis.toggleClass('numericField', this.segmentedAlignment || (!this.preventNumericAlignment && numeric), this.$.formatted);\n\t\tthis.toggleClass('firstField', this.index == 0, this.$.formatted);\n\t\tthis.toggleClass('readOnly', this.readOnly, this.$.formatted);\n\n\t\tthis.addFormattedDirtyClass(editable);\n\n\t\tlet isBool = this.isBoolean();\n\t\tlet isEmpty = !isBool && (this.formattedValue.value === false || (this.isNil(this.formattedValue.label) && this.formattedValue.value !== true));\n\t\tthis.toggleClass('empty', isEmpty, this.$.formatted);\n\t\tthis.toggleClass('empty', isEmpty, this.$.me);\n\n\t\tthis.toggleClass('link', this.link, this.$.formatted);\n\t\tthis.toggleClass('link', this.link, this.$.me);\n\n\t\tthis.toggleClass('boolean', isBool, this.$.formatted);\n\t}\n\n\taddFormattedDirtyClass(editable) {\n\t\tthis.isDirty = editable && this.formattedValue.value !== this.originalFormattedValue.value && !(this.isNil(this.formattedValue.value) && this.isNil(this.originalFormattedValue.value));\n\t\tthis.toggleClass('dirty', this.isDirty, this.$.formatted);\n\t}\n\n\tsignalRowFocus() {\n\t\tif(this.signaler) {\n\t\t\tthis.signaler.fireSignal('sb-row-focus-signal', true);\n\t\t\tsetTimeout(function() {\n\t\t\t\t// disable the signaler's internal focus events in timeout as some blur events\n\t\t\t\t// may enable it on a delay such as the discount field\n\t\t\t\tthis.signaler.disable();\n\t\t\t}.bind(this), 20);\n\t\t}\n\t}\n\n\tenableSignals() {\n\t\tif(this.signaler)\n\t\t\tthis.signaler.enable(); // enable the signalers internal focus events\n\t}\n\n\thandleRowFocusSignal(signal) {\n\t\tif(!this.signaler)\n\t\t\treturn;\n\n\t\tthis.signaler.toggleRowFocus(signal);\n\t\tif(this.isEditable())\n\t\t\tthis.toggleClass('show', signal.detail.focused, this.$.formatted);\n\t}\n\n\thandleFieldEditSignal(signal) {\n\t\tif (this.md.extraTypeInfo === 'richtextarea') {\n\t\t\tthis.signaler.signalNextPreviousEditableTarget(this, signal.detail.next);\n\t\t} else {\n\t\t\tthis.ironList = this.signaler.ironList;\n\t\t\tif (this.ironList && (this.ironList.lastVisibleIndex == this.ironList.items.length - 1)) {\n\t\t\t\tthis.ironList.toggleScrollListener(false);\n\t\t\t\tthis.scrollListenerDetached = true;\n\t\t\t}\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (this.scrollListenerDetached) {\n\t\t\t\t\tthis.ironList.toggleScrollListener(true);\n\t\t\t\t\tthis.scrollListenerDetached = false;\n\t\t\t\t}\n\t\t\t\tthis.edit();\n\t\t\t}.bind(this), 0);\n\t\t}\n\t}\n\n\tcreateBaseElement( html ) {\n\t\tvar d = this.template.content.ownerDocument.createElement('div');\n\t\td.innerHTML = html;\n\t\tlet el = Polymer.dom(d).firstChild;\n\t\tPolymer.dom(this.template.content).appendChild(el);\n\t}\n\n\tisNumericType() {\n\t\tswitch(this.type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetType(md) {\n\t\treturn md && md.type ? md.type.toLowerCase() : '';\n\t}\n\n\t/**\n\t * Single property observer to make sure the template is updated when value changes to undefined\n\t * @private\n\t */\n\t_valueChanged() {\n\t\tif(!this.rendered)\n\t\t\treturn;\n\t\t// We need to call the valueChanged method manually here because Polymer does not call multi-property observers\n\t\t// when the new value of the path is undefined (ie. field is empty for a record)\n\t\tif (this.value === undefined)\n\t\t\tthis.valueChanged(this.model, this.obj, this.md, this.property, this.html, this.value);\n\t}\n\n\t_valueChangedObserver (model, obj, md, property, html, value) {\n\t\tif (model === undefined || obj === undefined || md === undefined || property === undefined ||\n\t\t\t html === undefined || value === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.valueChanged(model, obj, md, property, html, value);\n\t}\n\n\tvalueChanged(model, obj, md, property, html, value) {\n\t\tif(value === undefined && this.isBoolean())\n\t\t\treturn;\n\n\t\tif(this.internal && this.template)\n\t\t\tthis.template.value = value;\n\t\telse\n\t\t\tthis.obj[property] = value;\n\n\t\tthis.setPreviouslyFormattedValue();\n\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\tsetPreviouslyFormattedValue() {\n\t\tthis.previouslyFormatted = this.formattedValue === undefined ? null : JSON.parse(JSON.stringify(this.formattedValue));\n\t}\n\n\t_disabledChangedObserver (model, obj, md, html, disabled) {\n\t\tif (model === undefined || obj === undefined || md === undefined || html === undefined || disabled === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.disabledChanged(model, obj, md, html, disabled);\n\t}\n\n\tdisabledChanged(model, obj, md, html, disabled) {\n\t\tthis.toggleClass('disabled', disabled, this.$.formatted);\n\t\tif(this.template)\n\t\t\tthis.template.disabled = disabled;\n\n\t\tif(this.isRenderReadOnly() && this.editing)\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\thiddenChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.hide = this.hidden;\n\t}\n\n\trecordIdChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.recordId = this.recordId;\n\t}\n\n\trecordChanged(e) {\n\t\tif(!this.template || !e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tcomputeRefTable(md) {\n\t\tif(md === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tif(md.referenceTable)\n\t\t\treturn md.referenceTable;\n\t\t// if no referenceTable property on md, check the referenceTo array property which is same property on field metadata from sb-describe\n\t\treturn md.referenceTo && md.referenceTo.length > 0 ? md.referenceTo[0] : null;\n\t}\n\n\tlinkOrEdit() {\n\t\tif(this.link)\n\t\t\tthis.fire('sb-link-tapped', { value: this.value, Id: this.recordId } ) ;\n\t\telse\n\t\t\tthis.edit(true);\n\t}\n\n\tedit(clickEdit) {\n\t\tif(!this.isEditable())\n\t\t\treturn;\n\n\t\tthis._render(this.model, this.obj, this.md, this.html);\n\t\tthis.hideFormattedValue = !this.isRichText(); // hide the formattedValue text for non-richtext field\n\t\tthis.template[HIDE_FIELD] = !this.hideFormattedValue; // show the editable field for non-richtext field\n\n\t\t// apply focus to the editable field\n\t\tif(this.template._nodes && this.template._nodes[0].focus)\n\t\t\tthis.template._nodes[0].focus(); // necessary for Firefox\n\n\t\tif(clickEdit)\n\t\t\tthis.invertValueIfInlineBoolean();\n\n\t\tif(this.isRenderReadOnly())\n\t\t\tthis.signalRowFocus();\n\t}\n\n\tgetEventTarget(e) {\n\t\ttry {\n\t\t\treturn Polymer.dom(e).localTarget || e.target;\n\t\t} catch(ex) {\n\t\t\treturn  e.target;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || (typeof value === 'number' && value + '' === 'NaN');\n\t}\n\n\tapplyFocus() {\n\t\tif(this.template)\n\t\t\tthis.template[APPLY_FOCUS] = this.focus;\n\t}\n\n\tisEditable(returnTrueIfEverEditable) {\n\t\tif(returnTrueIfEverEditable && this._wasEverEditable)\n\t\t\treturn true;\n\n\t\treturn (this.readOnly || (this.isRenderReadOnly() && this.disabled)) ? false : this.editing;\n\t}\n\n\tisReadOnly() {\n\t\treturn this.readOnly || this.isRenderReadOnly() || this.isFormulaHtml();\n\t}\n\n\tisRenderReadOnly() {\n\t\treturn this.renderReadOnly || this.isRichText() /* always render read only for rte */;\n\t}\n\n\tisFormulaHtml() {\n\t\treturn this.md.htmlFormatted && this.md.calculated; /* checks for formula text fields that resolve to html such as hyperlinks */\n\t}\n\n\tsetFormattedDetails(html) {\n\t\thtml.isDirty = this.isDirty;\n\t\thtml.link = !!this.link;\n\t\thtml.type = this.type;\n\t\thtml.booleanValue = this.isBoolean() ? this.obj[this.property] : null;\n\t\thtml.value = this.formattedValue.label;\n\t\tif(this.formattedValue.unit) {\n\t\t\thtml.value += ' ' + this.formattedValue.unit\n\t\t}\n\t\thtml.sanitizeAndSetInnerHTML();\n\t}\n\n\tisBoolean() {\n\t\treturn this.type === 'boolean' || this.type === 'checkbox';\n\t}\n\n\tisLookup() {\n\t\treturn this.type === 'id' || this.type === 'reference';\n\t}\n\n\tisRichText() {\n\t\treturn this.type === 'textarea' && this.md.extraTypeInfo === 'richtextarea';\n\t}\n\n\taddControlledSelectListener(md) {\n\t\tif (md && md.controllerName)\n\t\t\tdocument.addEventListener('sb-controlling-select-changed', (e) => this.controllerSelectHandler(this.model, this.obj, this.md, this.html, e));\n\t}\n\n\tcontrollerSelectHandler(model, obj, md, html, e) {\n\t\tlet tableName = e.detail.tableName;\n\t\tlet fieldName = e.detail.fieldName;\n\t\tlet record = e.detail.record;\n\n\t\tlet sameRecord = typeof this.record.equals === 'function' && record ? this.record.equals(record) : this.record === record;\n\t\tif (tableName !== md.tableName || md.controllerName !== fieldName || !sameRecord)\n\t\t\treturn; // not a child of the controlling field that has changed, so we bail\n\n\t\t// build the select options for the controlled field and clear the current value if invalid\n\t\tlet valueCleared = this.buildSelectOptions(md, true);\n\n\t\t// if the current value was not cleared because it was still valid, then need to update explicitly\n\t\t// otherwise the changing value to null would invoke valueChange observer which would do the update for us\n\t\tif (!valueCleared)\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\tgetSelectOptions(md) {\n\t\tif(this._selectOptions)\n\t\t\treturn this._selectOptions;\n\n\t\tthis.buildSelectOptions(md);\n\t\treturn this._selectOptions;\n\t}\n\n\tbuildSelectOptions(md, clearInvalidValue) {\n\t\tif(!md.controllerName || !this.record) {\n\t\t\tthis._selectOptions = md.picklistValues;\n\t\t\treturn false;\n\t\t}\n\n\t\tlet value = typeof this.record.getValue === 'function' ? this.record.getValue(md.controllerName) : this.record[md.controllerName];\n\t\tthis._selectOptions = new DependentPicklistBuilder(md, value).build();\n\t\tif(clearInvalidValue)\n\t\t\treturn this.clearValueIfNotAnOption(this._selectOptions);\n\n\t\treturn false;\n\t}\n\n\tclearValueIfNotAnOption(options) {\n\t\tif(this.value === null)\n\t\t\treturn false;\n\n\t\tlet clearValue = true;\n\t\toptions.forEach( function(option) {\n\t\t\tif (option.value == this.value) {\n\t\t\t\tclearValue = false;\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif(!clearValue)\n\t\t\treturn false;\n\n\t\tif(typeof this.record.setValue === 'function')\n\t\t\tthis.record.setValue(this.property, null);\n\t\telse\n\t\t\tthis.record[this.property] = null;\n\n\t\t// set value to null by simulating an onChange with a null value\n\t\t// define detail to allow chaining dependent picklists\n\t\tthis.onChange( { target: { value: null, }, detail: true } );\n\t\treturn true;\n\t}\n\n\tinvertValueIfInlineBoolean() {\n\t\tif(this.isRenderReadOnly() && this.isBoolean()) {\n\t\t\tthis.value = undefined;\n\t\t\tthis.value = !this.obj[this.property];\n\t\t\tthis.internal = true;\n\t\t\tthis.domHost.value = this.value;\n\t\t\tthis.internal = false;\n\t\t\tthis.fireCustomChangeEvents();\n\t\t\tthis.fire('sb-field-on-change-field');\n\t\t}\n\t}\n\n\t_setWasEverEditable() {\n\t\treturn this._wasEverEditable || this.editing;\n\t}\n\n\t/**\n\t * Toggles the field between non-edit and edit mode and vice versa.\n\t * This will not supersede the readOnly or disabled properties.\n\t *\n\t * So for example this function can toggle a field from a text label (editing=false)\n\t * to an input (editing=true) but if readOnly=true or disabled=true\n\t * then the input will be disabled.\n\t *\n\t * @param editable\n\t */\n\ttoggleEditing(editable) {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tif(!!editable === !!this.editing)\n\t\t\treturn;\n\n\t\tthis._toggleEditing = true;\n\t\tthis.editing = editable;\n\t\tthis._toggleEditing = false;\n\t}\n}\n\nPolymer( Field );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Input {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-input';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed',\n\t\t\t\tnotify: true,\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tinputType: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'text'\n\t\t\t},\n\t\t\trenderReadOnly: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowClear: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showClear(viewport, inputType, disabled)'\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocused: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_hideClearIfEmptyObserver(value, showClear, focused)']\n\t}\n\n\t_hideClearIfEmptyObserver (value, showClear, focused) {\n\t\tif (value === undefined || showClear === undefined || focused === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.hideClearIfEmpty(value, showClear, focused);\n\t}\n\t\n\thideClearIfEmpty() {\n\t\tif(!this.showClear)\n\t\t\treturn;\n\t\tif(!this.$$('#clear')) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis._hideClearIfEmpty();\n\t\t\t}.bind(this));\n\t\t} else\n\t\t\tthis._hideClearIfEmpty();\n\t}\n\n\t_hideClearIfEmpty() {\n\t\tthis.toggleClass('hide', this.focused || this.value == null || this.value === '' , this.$$('#clear'));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.querySelector('.myinput').focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t\tthis.focused = false;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t\tthis.querySelector(\".myinput\").blur();\n\t}\n\n\thighlight() {\n\t\tthis.focused = true;\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.querySelector('.myinput').setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.querySelector('.myinput').value = this.value;\n\n\t\tthis.fire('sb-input-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_showClear() {\n\t\treturn this.viewport && this.viewport.isMobile() && !this.disabled && this.inputType !== 'date' && this.inputType !== 'datetime';\n\t}\n}\nPolymer(Input);","import {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nexport class Lookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'initTableLabel'\n\t\t\t},\n\t\t\tlimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 5\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabelName: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'label'\n\t\t\t},\n\t\t\tselectedLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSelectedLabel(tableName)'\n\t\t\t},\n\t\t\tmenuItemLabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlookupCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this.lookupResultsCallback.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\thideInputAndShowPill: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tinDialog: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttableLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: 'getLabels(selectedLabel, menuItemLabels)'\n\t\t\t},\n\t\t\tsearchText: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSearchText(placeholder, tableLabel, i18n)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'showSearch(viewport, inDialog)'\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed:'isMobile(viewport)'\n\t\t\t},\n\t\t\tfieldFullName: String,\n\t\t\thasFilter: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcontrollingFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\terrors: Array,\n\t\t\tcurrentRecordFilters: Object,\n\t\t\trecord: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tdialogMetadata: Object\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_setSelectedItemObserver(value, selectedLabel)',\n\t\t\t\t'_setLabelObserver(label, value, record)',\n\t\t\t\t'setCallback(customCallback)',\n\t\t\t\t'_handleMobileEventsObserver(viewport, inDialog)',\n\t\t\t\t'setForceSuggest(record.*)',\n\t\t\t\t'_initCurrentRecordFiltersObserver(hasFilter, controllingFields, fieldFullName)'];\n\t}\n\n\tready() {\n\t\tthis.$.object.addEventListener('describe-changed', this.setTableLabel.bind(this));\n\t\tthis.$.typeahead.addEventListener('enter-without-selection',this.handleEnterPressed.bind(this));\n\t\tthis.$.fields.addEventListener('md-changed', this.setCurrentRecordFilters.bind(this));\n\t}\n\n\tinitTableLabel() {\n\t\tif(this.tableName)\n\t\t\tthis.$.object.objects = [this.tableName];\n\t}\n\n\tsetTableLabel(e) {\n\t\tthis.tableLabel = e.detail.value.md[this.tableName].labelPlural;\n\t}\n\n\tsetCallback() {\n\t\tthis.lookupCallback = this.customCallback.bind(this);\n\t}\n\n\tlookupResultsCallback(searchValue) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif(!this.tableName) {\n\t\t\t\tresolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.queryLookupResults(searchValue, resolve, reject);\n\t\t}.bind(this));\n\t}\n\n\tqueryLookupResults(searchValue, resolve, reject) {\n\t\tthis.errors = null;\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, this.limit, this.currentRecordFilters, this.record, true, this.dialogMetadata);\n\t\tlet soql = queryBuilder.build(searchValue, false, this.inDialog);\n\t\tthis.$.q.query({ soql: soql, version: AppContext.apiVersionString }).then(function(response) {\n\t\t\tlet records = response.records;\n\t\t\tlet searchText = searchValue == null ? '' : searchValue;\n\t\t\tlet search = { Id: '', __md__: {class: 'search', searchValue: searchText, clearAfterSelection: !this.inDialog, noFocusAfterSelection: this.inDialog } };\n\t\t\tlet tableLabel = this.tableLabel;\n\t\t\tif(!tableLabel) {\n\t\t\t\t// if table label not yet set from sb-lookup-dialog, then do our best to create a readable table label from the tableName\n\t\t\t\tlet tableParts = this.tableName.split('__');\n\t\t\t\tlet tableLabelPartIndex = tableParts.length > 1 ? tableParts.length - 2 : 0;\n\t\t\t\ttableLabel = tableParts[tableLabelPartIndex];\n\t\t\t}\n\n\t\t\tif(this.isMobile()) {\n\t\t\t\tsearch[this.selectedLabel] = searchText ? this.i18n.l('\"{0}\"', [searchText]) : '';\n\t\t\t\trecords.push(search);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet searchLabel = searchText ? '\"{0}\" in {1}' : ' in {1}';\n\t\t\t\tsearch[this.selectedLabel] = this.i18n.l(searchLabel, [searchText, tableLabel]);\n\t\t\t\trecords = [search].concat(records);\n\t\t\t}\n\t\t\tif(this.inDialog && this.isMobile())\n\t\t\t\tthis.domHost.handleSearchResults(this.limit, {records: records, totalSize: response.totalSize});\n\t\t\telse\n\t\t\t\tresolve(records);\n\t\t}.bind(this), function(error) {\n\t\t\tlet errorMessage;\n\t\t\tif (error.errorCode === 'INVALID_FIELD') {\n\t\t\t\terrorMessage = this.i18n.l('lookupQueryError');\n\t\t\t} else {\n\t\t\t\terrorMessage = 'SOQL Execution Error: ' + soql + ' (' + (error && error.message ? error.message : error) + ')';\n\t\t\t}\n\t\t\tthis.errors = [{\n\t\t\t\ttype: 'error',\n\t\t\t\tmsg: errorMessage\n\t\t\t}];\n\t\t\treject(errorMessage);\n\t\t}.bind(this));\n\t}\n\n\t_setLabelObserver (label, value, record) {\n\t\tif (label === undefined || value === undefined || record === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setLabel(label, value, record);\n\t}\n\t\n\tsetLabel(label, value, record) {\n\t\tthis._setLabel(label, value, record);\n\t\tif(this.value != null && this.selectedLabel != null)\n\t\t\tthis.setSelectedItem();\n\t}\n\n\t_setSelectedItemObserver (value, selectedLabel) {\n\t\tif (value === undefined || selectedLabel === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelectedItem(value, selectedLabel);\n\t}\n\t\n\tsetSelectedItem() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tif(this.label == null)\n\t\t\treturn;\n\n\t\tlet label = this.getLabel();\n\t\tlet selectedItem = { Id: this.value };\n\t\tselectedItem[this.selectedLabel] = label;\n\t\tthis.$.typeahead.items = this.$.typeahead.items || [ selectedItem ];\n\t\tthis.$.typeahead.selectedItem = selectedItem;\n\t\tthis.setHideInputAndShowPill(this.value);\n\n\t\tthis.focus();\n\n\t\tif(!this._handleSelectedItemChanged) {\n\t\t\tthis._handleSelectedItemChanged = this.handleSelectedItemChanged.bind(this);\n\t\t\tthis.$.typeahead.addEventListener('selected-item-changed', this._handleSelectedItemChanged);\n\t\t}\n\t}\n\n\thandleSelectedItemChanged(e) {\n\t\tif (e.detail.path || e.detail.value == '')\n\t\t\treturn;\n\n\t\tlet md = e.detail.value.__md__;\n\t\tlet searchValue = md && md.searchValue !== undefined ? md.searchValue : undefined;\n\t\tif(searchValue !== undefined) {\n\t\t\tthis.applySearchValue(searchValue);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setHideInputAndShowPill(e.detail.value.Id);\n\t\tthis.focus();\n\n\t\tthis.internal = true;\n\t\tthis.value = e.detail.value.Id || null;\n\t\tthis.label = e.detail.value[this.selectedLabel] || '';\n\t\tthis.internal = false;\n\n\t\tthis._setLabel();\n\t\tthis.fireLookupValueChanged(this.value, this.label, e.detail.value);\n\t}\n\n\tapplySearchValue(searchValue) {\n\t\tif(searchValue && searchValue.detail)\n\t\t\tsearchValue = searchValue.detail.value;\n\n\t\tif(this.inDialog) {// tell host dialog component that the search value has changed\n\t\t\tthis.domHost.searchValue = searchValue;\n\t\t\tthis.domHost.querySearchResults();\n\t\t}\n\t\telse { // open the dialog\n\t\t\tfireEvent(Events.OPEN_LOOKUP_DIALOG, {\n\t\t\t\tlookup: this,\n\t\t\t\tsearchValue: searchValue\n\t\t\t});\t\n\t\t}\t\t\n\t}\n\n\thandleEnterPressed(e) {\n\t\tif(this.currentRecordFilters)\n\t\t\tthis.applySearchValue(e.detail.value);\n\t}\n\n\tfireLookupValueChanged(value, label, obj) {\n\t\tlet data = {\n\t\t\tvalue: value,\n\t\t\tobj: obj,\n\t\t\titem: this.record ? this.record.item : null\n\t\t};\n\t\tdata[this.labelName] = label;\n\t\tthis.fire( 'lookup-value-changed', data );\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.isMobile())\n\t\t\treturn;\n\t\tif(!this.hideInputAndShowPill) {\n\t\t\tthis.$.typeahead.focus(forceSuggest || this.forceSuggest);\n\t\t\tthis.forceSuggest = false;\n\t\t}\n\t\telse if(!this.focusDisabled)\n\t\t\tthis.$.container.focus();\n\t}\n\n\tgetLabel() {\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tlet val = this._getLabelValueKey();\n\t\tlet label = this.labelsByValue[val];\n\t\tif(this.value && !label) {\n\t\t\tthis.labelsByValue[val] = this.label;\n\t\t\tlabel = this.label;\n\t\t}\n\t\treturn label;\n\t}\n\n\t_setLabel(label, value, record) {\n\t\tlet val = this._getLabelValueKey();\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tthis.labelsByValue[val] = this.getDefaultLabelFromRecord(label, value, record);\n\t}\n\n\t_getLabelValueKey() {\n\t\treturn this.value && typeof this.value === 'string' ?  this.value.substring(0,15) : this.value;\n\t}\n\n\tsetHideInputAndShowPill(value) {\n\t\tthis.hideInputAndShowPill = !this.isMobile() && !this.isNil(value) && !(this.clearAfterSelection);\n\t}\n\n\tblurContainer() {\n\t\tif(this.hideInputAndShowPill && !this.blurDisabled)\n\t\t\tthis.blur();\n\t}\n\n\tblur() {\n\t\tthis.$.typeahead.setOriginalSelected();\n\t\tthis.fire('sb-type-blur');\n\t}\n\n\tpropagateEscOrHandleDelete(e) {\n\t\tif(e.keyCode === 27) // esc key\n\t\t\tthis.$.typeahead.suggest(e);\n\t\telse if(e.keyCode === 8) {// delete key\n\t\t\tthis.deletePill(); // only works in FF if its about:config > browser:backspace_action is set to 2 - https://support.mozilla.org/en-US/questions/924490\n\t\t\tthis.blurDisabled = !!(this.previousBlurDisabled);\n\t\t}\n\t}\n\n\tpreventBlurOnDelete(e) {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tif(e.keyCode === 8) // delete key\n\t\t\tthis.blurDisabled = true;\n\t}\n\n\tpreventBlur() {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tthis.blurDisabled = true;\n\t}\n\n\tdeletePill() {\n\t\tif(!this.disabled)\n\t\t\tthis.$.typeahead.clear();\n\t\tthis.blurDisabled = this.previousBlurDisabled;\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '';\n\t}\n\n\tdialogOpened() {\n\t\tthis.blurDisabled = true;\n\t\tthis.focusDisabled = true;\n\t}\n\n\tdialogClosed() {\n\t\tthis.blurDisabled = false;\n\t\tthis.focusDisabled = false;\n\t\tthis.focus(true);\n\t\tfireEvent(Events.CLOSE_LOOKUP_DIALOG, {lookup: this});\n\t}\n\n\tgetDefaultLabelFromRecord(label, value, record) {\n\t\tif (!record || !record.model || !record.model.attributeMD || !record.model.attributeMD[record.item])\n\t\t\treturn label;\n\t\t// W-5621784: Load in the referencedFieldValue for default lookup attributes when component initializes\n\t\tlet attributeMD = record.model.attributeMD[record.item];\n\t\tif (attributeMD.value === value && attributeMD.referencedFieldValue != null)\n\t\t\treturn attributeMD.referencedFieldValue;\n\n\t\treturn label;\n\t}\n\n\tgetSelectedLabel() {\n\t\treturn new LookupNameMapper(this.tableName).getNameField();\n\t}\n\n\tgetLabels() {\n\t\treturn this.menuItemLabels || [this.selectedLabel];\n\t}\n\n\tgetSearchText() {\n\t\treturn this.placeholder || this.buildSearchText();\n\t}\n\n\tbuildSearchText() {\n\t\tif(this.i18n && typeof this.i18n.l === 'function')\n\t\t\treturn this.i18n.l('Search {0}', [this.tableLabel]);\n\t\treturn `Search ${this.tableLabel}`;\n\t}\n\n\t_handleMobileEventsObserver (viewport, inDialog) {\n\t\tif (viewport === undefined || inDialog === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.handleMobileEvents(viewport, inDialog);\n\t}\n\t\n\thandleMobileEvents() {\n\t\tif(!this.isMobile())\n\t\t\treturn;\n\n\t\tif(this.inDialog) {\n\t\t\tthis._clearAndSave = this._clearAndSave || (this.domHost.clearAndSave ? this.domHost.clearAndSave.bind(this.domHost) : null);\n\t\t\tif (this._clearAndSave) {\n\t\t\t\tthis.$.typeahead.removeEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t\tthis.$.typeahead.addEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._applySearchValue = this._applySearchValue || this.applySearchValue.bind(this);\n\t\t\tthis.$.typeahead.removeEventListener('sb-type-focus', this._applySearchValue);\n\t\t\tthis.$.typeahead.addEventListener('sb-type-focus', this._applySearchValue);\n\t\t}\n\t}\n\n\tshowSearch() {\n\t\treturn this.isMobile() && !this.inDialog;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t_initCurrentRecordFiltersObserver (hasFilter, controllingFields, fieldFullName) {\n\t\tif (hasFilter === undefined || controllingFields === undefined || fieldFullName === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.initCurrentRecordFilters(hasFilter, controllingFields, fieldFullName);\n\t}\n\t\n\tinitCurrentRecordFilters() {\n\t\tif (this.controllingFields.length === 0) {\n\t\t\tthis.currentRecordFilters = {};\n\t\t\treturn;\n\t\t}\n\n\t\t// concatenate source object name with the field name(s) for the field describe call\n\t\tlet lookupFieldTable = this.fieldFullName.split('.')[0];\n\t\tlet fields = [];\n\t\tfor (let f of this.controllingFields) {\n\t\t\tfields.push(lookupFieldTable + '.' + f);\n\t\t}\n\n\t\tthis.$.fields.fields = fields;\n\t}\n\n\tsetCurrentRecordFilters(e) {\n\t\tlet currentRecordFilters = {};\n\t\tfor(let field of e.detail.value.fields)\n\t\t\tcurrentRecordFilters[field.name] = field.type;\n\t\tthis.currentRecordFilters = currentRecordFilters;\n\t}\n\n\tsetForceSuggest(e) {\n\t\tif(this.forceSuggest)\n\t\t\treturn;\n\n\t\tif(!e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tif(!this.hasFilter)\n\t\t\treturn;\n\n\t\tlet currentRecordFiltersKeys = this.currentRecordFilters ? Object.keys(this.currentRecordFilters) : [];\n\t\tif(currentRecordFiltersKeys.length === 0)\n\t\t\treturn;\n\n\t\tlet parts = e.path.split('.');\n\t\tlet property = parts[parts.length-1];\n\t\tif(currentRecordFiltersKeys.indexOf(property) === -1)\n\t\t\treturn;\n\n\t\tthis.forceSuggest = true;\n\t}\n}\n\nPolymer( Lookup );\n","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\n\nconst LAYOUT_FIELD_SET = 'CPQ_Lookup';\nconst SEARCH_FIELD_SET = 'CPQ_Lookup_Search';\n\nconst DEFAULT_SEARCH_TYPES = ['string','picklist','multipicklist'];\nconst ALLOWED_SEARCH_TYPES = DEFAULT_SEARCH_TYPES.concat(['textarea', 'date', 'datetime', 'int', 'number', 'currency', 'percent', 'double', 'reference']);\n\nexport class LookupDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: String,\n\t\t\ttableName: String,\n\t\t\ttableLabel: String,\n\t\t\tfieldLabel: String,\n\t\t\tlabelName: String,\n\t\t\tselectedLabel: String,\n\t\t\tsearchValue: String,\n\t\t\tmetadata: Object,\n\t\t\tnumResults: Number,\n\t\t\tresults: Object,\n\t\t\tinvoker: { // the sb-lookup component that invoked this dialog\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'initialize'\n\t\t\t},\n\t\t\tisOAuth: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org ? AppContext.org.isOAuth : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\topenSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trecordSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isMobile(viewport)'\n\t\t\t},\n\t\t\thideCancel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_hideCancel(isMobile, openSpinner, recordSpinner)'\n\t\t\t},\n\t\t\tlayoutFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tsearchFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tlookupSearchTypes: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn DEFAULT_SEARCH_TYPES.concat(AppContext.org ? AppContext.org.additionalLookupSearchTypes : []);\n\t\t\t\t}\n\t\t\t},\n\t\t\tmaxSearchFields: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org ? AppContext.org.maxLookupSearchFields : 1;\n\t\t\t\t}\n\t\t\t},\n\t\t\tfieldSetPrefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_getMetadataObserver(tableName, viewport)',\n\t\t\t'_processCPQLayoutFieldsObserver(fieldSets, i18n)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.cancel.bind(this));\n\t\tthis.addEventListener('lookup-value-changed', this.setValues.bind(this));\n\t\tthis.$.field.addEventListener('md-changed', this.processListFields.bind(this));\n\t\tthis.addEventListener('sb-link-tapped', this.updateLookup.bind(this));\n\t\tthis.setResultsHeightHandler = this.setResultsHeight.bind(this);\n\t\twindow.addEventListener('resize', this.setResultsHeightHandler);\n\t\t// this removes iron-list resize handler as we will use our own\n\t\tthis.$$('#list').assignParentResizable({\n\t\t\tstopResizeNotificationsFor: function() {\n\t\t\t\twindow.removeEventListener('resize', this.setResultsHeightHandler);\n\t\t\t}.bind(this)\n\t\t});\n\t}\n\n\tinitialize() {\n\t\tif(!this.invoker)\n\t\t\treturn;\n\n\t\tthis.labelName = this.invoker.labelName;\n\t\tthis.label = this.invoker.label;\n\t\tthis.selectedLabel = this.invoker.selectedLabel;\n\t\tthis.tableName = this.invoker.tableName;\n\t\tthis.fieldLabel = this.invoker.fieldLabel;\n\t\tthis.currentRecordFilters = this.invoker.currentRecordFilters;\n\t\tthis.controllingFields= this.invoker.controllingFields;\n\t\tthis.record = this.invoker.record;\n\t\tthis.hasFilter = this.currentRecordFilters && Object.keys(this.currentRecordFilters).length > 0 && AppContext.apiVersion < 39 ? false : this.invoker.hasFilter;\n\t\tthis.fieldFullName = this.invoker.fieldFullName;\n\t}\n\n\topen(searchValue) {\n\t\tthis.$.dialog.toggle();\n\t\tthis.invoker.dialogOpened();\n\t\tthis.$.lookup.$.typeahead.blurred = true;\n\t\tthis.$.lookup.$.typeahead.hasList = false;\n\t\tthis.$.lookup.$.typeahead.labelValue = searchValue;\n\t\tthis.invoker.$.typeahead.$.itemLabel.blur();\n\t\tthis.searchValue = searchValue;\n\t}\n\n\tcancel() {\n\t\tthis.close();\n\t}\n\n\tsaveAndDeferredClose() {\n\t\tthis.syncSelection();\n\t\tthis.deferredClose();\n\t}\n\n\tsave() {\n\t\tthis.syncSelection();\n\t\tthis.close();\n\t}\n\n\tsyncSelection() {\n\t\tthis.invoker.value = undefined;\n\t\tthis.invoker.label = this.label;\n\t\tthis.invoker.value = this.value;\n\t}\n\n\tclearAndSave() {\n\t\tthis.label = ''; // set to empty string instead of null to ensure clear in mobile works due to a typeahead null check on label\n\t\tthis.value = null;\n\t\tthis.save();\n\t}\n\n\tclose() {\n\t\tthis.$.dialog.toggle();\n\t\tthis.$.lookup.$.typeahead.suggest({});\n\t\tthis.invoker.dialogClosed();  // fires CLOSE event\n\t\tthis.reset();\n\t\tthis.clearSelected();\n\t}\n\n\n\tdeferredClose() {\n\t\t// defer the closing of the dialog to prevent applying focus in mobile to any input field\n\t\t// directly behind where the dialog was tapped that initiated the close\n\t\t// 350ms seems to be the least amount of time we can delay to ensure the focus does not seep through\n\t\tsetTimeout(function () {\n\t\t\tthis.close();\n\t\t}.bind(this), 350);\n\t}\n\n\treset() {\n\t\tthis.value = null;\n\t\tthis.label = null;\n\t\tthis.results = null;\n\t\tthis.tableLabel = null;\n\t\tthis.fieldLabel = null;\n\t\tthis.fieldFullName = undefined;\n\t\tthis.hasFilter = false;\n\t\tthis.currentRecordFilters = null;\n\t\tthis.controllingFields = null;\n\t\tthis.record = null;\n\t\tthis.tableName = null;\n\t\tthis.numResults = 0;\n\t\tthis.metadata = undefined;\n\t\tthis.layoutFields = [];\n\t\tthis.searchFields = [];\n\t\tthis.$.header.cols = undefined;\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tthis.$.fs.response = null;\n\t\tthis.$.fs.context = undefined;\n\t\tthis.invoker = null;\n\t\tthis.errors = null;\n\t}\n\n\tsetValues(e) {\n\t\tthis.value = e.detail.value;\n\t\tthis.label = e.detail[this.labelName];\n\t}\n\n\tupdateLookup(e) {\n\t\tthis.label = undefined;\n\t\tthis.value = e.detail.Id;\n\t\tthis.label = this.getSelectedLabelValueById(e.detail.Id);\n\t}\n\n\tgetSelectedLabelValueById(id) {\n\t\tfor(let result of this.results) {\n\t\t\tif(result.Id === id)\n\t\t\t\treturn result[this.selectedLabel];\n\t\t}\n\t}\n\n\t_getMetadataObserver (tableName, viewport) {\n\t\tif (tableName === undefined || viewport === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getMetadata(tableName, viewport);\n\t}\n\t\n\tgetMetadata() {\n\t\tif(!this.tableName)\n\t\t\treturn;\n\n\t\tthis.openSpinner = true;\n\t\tthis.$.fs.context = {fieldSets: [{tableName: this.tableName, name: LAYOUT_FIELD_SET}, {tableName: this.tableName, name: SEARCH_FIELD_SET}]};\n\t}\n\n\tinitSearchFieldsAndReturnOnesNotInLayout(fieldSets, layoutFields) {\n\t\tlet searchFieldsNotInLayout = [];\n\t\tlet searchFields = this.getCpqLookupSearchFields(fieldSets);\n\t\tif(!searchFields)\n\t\t\treturn searchFieldsNotInLayout;\n\n\t\tthis.searchFields = searchFields.names;\n\t\tlet fields = searchFields.fields;\n\t\tfor(let field of fields) {\n\t\t\tif(field === (this.tableName + '.' + this.selectedLabel))\n\t\t\t\tcontinue;\n\n\t\t\tif(layoutFields.indexOf(field) !== -1)\n\t\t\t\tcontinue;\n\n\t\t\tsearchFieldsNotInLayout.push(field);\n\t\t}\n\t\treturn searchFieldsNotInLayout;\n\t}\n\n\t_processCPQLayoutFieldsObserver (fieldSets, i18n) {\n\t\tif (fieldSets === undefined || i18n === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.processCPQLayoutFields(fieldSets, i18n);\n\t}\n\t\n\tprocessCPQLayoutFields(fieldSets) {\n\t\tif(!fieldSets)\n\t\t\treturn;\n\n\t\tthis.tableLabel = fieldSets[0].tableLabel;\n\t\tif(this.isMobile) {\n\t\t\tthis.initMobileMetadata();\n\t\t\treturn;\n\t\t}\n\n\t\tlet layoutFields = this.getCpqLookupLayoutFields(fieldSets);\n\t\tif(!layoutFields) {\n\t\t\tlayoutFields = {fields: [], names: []};\n\t\t\tthis.warnUserAboutCPQLayoutFieldSet();\n\t\t}\n\n\t\tlet omittedNameField = this.getNameFieldIfOmittedFrom(layoutFields.fields);\n\t\tif(omittedNameField) {\n\t\t\tlayoutFields.fields = [omittedNameField.field].concat(layoutFields.fields);\n\t\t\tlayoutFields.names.push(omittedNameField.name);\n\t\t}\n\n\t\tthis.layoutFields = layoutFields.names;\n\t\tlet searchFieldsNotInLayout = this.initSearchFieldsAndReturnOnesNotInLayout(fieldSets, layoutFields.fields);\n\t\tlet fields = layoutFields.fields.concat(searchFieldsNotInLayout);\n\t\tthis.$.field.fields = fields;\n\t}\n\n\tprocessListFields(e) {\n\t\tlet fields = e.detail.value.fields;\n\t\tlet fieldNames =[];\n\t\tlet fieldLabels =[];\n\t\tlet fieldTypeByName = {};\n\t\tlet fieldTypeObjByName = {};\n\t\tlet fieldTypeByLabel = {};\n\t\tlet fieldsOfTypeLookup = [];\n\t\tfor(let i = 0, l = fields.length; i < l; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tlet type = { type: field.type, link: i === 0 };\n\t\t\tif(this.layoutFields.indexOf(field.name) !== -1) {\n\t\t\t\tfieldNames.push(field.name);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t}\n\t\t\tfieldTypeByName[field.name] = field.type;\n\t\t\tfieldTypeObjByName[field.name] = type;\n\t\t\tif (field.scale) {\n\t\t\t\t// i18n needs scale to be able to format properly\n\t\t\t\tfieldTypeObjByName[field.name].scale = field.scale;\n\t\t\t}\n\t\t\tfieldTypeByLabel[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\tif(field.type === 'reference' || field.type === 'id')\n\t\t\t\tfieldsOfTypeLookup.push({name: field.name, table: field.referenceTo[0]});\n\t\t}\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(fieldTypeByLabel), 'Th', fieldTypeByLabel, null, true).build();\n\t\tthis.rowClassMap = new TableClassBuilder(fieldNames, 'Td', fieldTypeByName).build();\n\t\tlet additionalSearchFields = this.sanitizeAdditionalSearchFields(fieldTypeObjByName);\n\t\tthis.metadata = { fieldNames: fieldNames, fieldLabels: fieldLabels, fieldTypeObjByName: fieldTypeObjByName, fieldsOfTypeLookup: fieldsOfTypeLookup, additionalSearchFields: additionalSearchFields };\n\t\tthis.querySearchResults();\n\t}\n\n\tsanitizeAdditionalSearchFields(fieldTypeObjByName) {\n\t\tlet index = 0;\n\t\tlet offset = 0;\n\t\tlet sanitizedAdditionalSearchFields = [];\n\n\t\tfor(let searchField of this.searchFields) {\n\t\t\tif (searchField === this.selectedLabel) {\n\t\t\t\toffset = 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet type = fieldTypeObjByName[searchField].type;\n\n\t\t\t// ensure the field type is one that we support, else continue\n\t\t\tif(this.lookupSearchTypes.indexOf(type) === -1 || ALLOWED_SEARCH_TYPES.indexOf(type) === -1)\n\t\t\t\tcontinue;\n\n\t\t\tsanitizedAdditionalSearchFields.push(searchField);\n\t\t\tif(++index === this.maxSearchFields)\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(sanitizedAdditionalSearchFields.length < (this.searchFields.length - offset))\n\t\t\tthis.warnUserAboutSanitizedCPQSearchFieldSet(sanitizedAdditionalSearchFields);\n\n\t\treturn sanitizedAdditionalSearchFields;\n\t}\n\n\tquerySearchResults() {\n\t\tthis.recordSpinner = !this.openSpinner;\n\t\tlet limit = 100;\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, limit + 1, this.currentRecordFilters, this.record, false, this.metadata);\n\t\tlet soql = queryBuilder.build(this.searchValue, true, true);\n\t\tthis.$.query.query({ soql: soql }).then(this.handleSearchResults.bind(this, limit));\n\t}\n\n\thandleSearchResults(limit, response) {\n\t\tthis.clearSelected();\n\t\tlet plus = response.totalSize > limit ? '+' : '';\n\t\tlet totalSize = Math.min(limit, response.totalSize);\n\t\tthis.numResults = totalSize + plus;\n\t\tthis.results = this.getResults(response, limit);\n\t\tthis.recordSpinner = false;\n\t\tthis.openSpinner = false;\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = null; // iOS mobile has quirk where the overflow style must be cleared and reset\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.setResultsHeight();\n\t\t}.bind(this));\n\t}\n\n\tgetResults(response, limit) {\n\t\tlet results = response.records;\n\t\tlet numResults = response.totalSize;\n\t\tlet isMobileWithSpotlight = this.isMobile && results.length > numResults;\n\t\tlet mobileSpotlight = isMobileWithSpotlight ? results.pop() : null;\n\t\t// ensure number of results matches the limit\n\t\twhile(numResults > limit) {\n\t\t\tresults.pop();\n\t\t\tnumResults--;\n\t\t}\n\n\t\tif(isMobileWithSpotlight && mobileSpotlight && mobileSpotlight[this.selectedLabel] && mobileSpotlight[this.selectedLabel] !== '') {\n\t\t\tresults.push(mobileSpotlight); // add back the mobile spotlight\n\t\t\tresults[numResults][this.selectedLabel] = mobileSpotlight[this.selectedLabel]; // add mobile spotlight result\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tsetResultsHeight() {\n\t\tlet offsetBottom = !this.isMobile ? this.$.dialog.$$('#footer').offsetTop : document.documentElement.clientHeight;\n\t\tlet offset = offsetBottom - this.$.tbody.offsetTop;\n\t\tlet scrollHeight = this.$.tbody.scrollHeight;\n\t\tlet height = offset < scrollHeight ? (offset + 'px') : null;\n\t\tthis.$.tbody.style.height = height;\n\t\tlet dataTableHeight = offsetBottom - this.$.datatable.offsetTop + 'px';\n\t\tthis.$.datatable.style.height = dataTableHeight;\n\t\tlet mask = this.$.spinner.$$('#mask');\n\t\tmask.style.height = offset + 'px';\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = 'auto'; // set overflow in mobile in this render cycle to handle iOS quirk\n\t\telse\n\t\t\tmask.style.marginLeft = '-24px';\n\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tlet list = this.$$('#list');\n\t\t\tlist.notifyResize();\n\t\t}.bind(this));\n\t}\n\n\tgetCpqLookupLayoutFields(fieldSets) {\n\t\treturn this.getCpqLookupFields(fieldSets, false);\n\t}\n\n\tgetCpqLookupSearchFields(fieldSets) {\n\t\treturn this.getCpqLookupFields(fieldSets, true);\n\t}\n\n\tgetCpqLookupFields(fieldSets, forSearch) {\n\t\tlet fields = [];\n\t\tlet names = [];\n\t\tfor(let fieldSet of fieldSets) {\n\t\t\tif(!this.validCPQFieldSet(fieldSet, forSearch))\n\t\t\t\tcontinue;\n\n\t\t\tlet df = fieldSet.displayedFields;\n\t\t\tlet displayedFields = !df ? [] : (df.constructor === Array ? df: [df]);\n\t\t\tfor(let displayedField of displayedFields) {\n\t\t\t\tlet field = displayedField.field || displayedField;\n\t\t\t\tif(field.split('.').length === 1) { // only support fields directly on table\n\t\t\t\t\tnames.push(field);\n\t\t\t\t\tfields.push(this.tableName + '.' + field);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// return the field array (even if empty) to indicate the field set does exist\n\t\t\treturn {fields: fields, names: names};\n\t\t}\n\t\t// return null to indicate the field set does not exist\n\t\treturn null;\n\t}\n\n\tvalidCPQFieldSet(fieldSet, forSearch) {\n\t\tif(!forSearch && (fieldSet.label === LAYOUT_FIELD_SET || fieldSet.fullName === (this.fieldSetPrefix + LAYOUT_FIELD_SET)))\n\t\t\treturn true;\n\n\t\tif(forSearch && (fieldSet.label === SEARCH_FIELD_SET || fieldSet.fullName === (this.fieldSetPrefix + SEARCH_FIELD_SET)))\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\tgetNameFieldIfOmittedFrom(fields) {\n\t\tif(fields.indexOf(this.tableName + '.' + this.selectedLabel) === -1)\n\t\t\treturn {field: (this.tableName + '.' + this.selectedLabel), name: this.selectedLabel};\n\t}\n\n\twarnUserAboutCPQLayoutFieldSet() {\n\t\tthis.errors = [this.i18n.l(\"FieldSetWarning\", [this.tableLabel])];\n\t}\n\n\twarnUserAboutSanitizedCPQSearchFieldSet(sanitizedSearchFields) {\n\t\tconsole.warn(`The ${this.tableLabel}.${this.fieldSetPrefix}${SEARCH_FIELD_SET} field set either contains fields of unsupported types or the field set size exceeds the max size (${this.maxSearchFields}).\\nActual: ${sanitizedSearchFields.join(',')}\\nExpect: ${this.searchFields.join(',')}`);\n\t}\n\n\tinitMobileMetadata() {\n\t\tlet rowClassMap = {};\n\t\trowClassMap[this.selectedLabel] = 'lookupItemTd';\n\t\tthis.rowClassMap = rowClassMap;\n\t\tthis.metadata = { fieldNames: [this.selectedLabel], fieldLabels: [], fieldTypeObjByName: {}, fieldsOfTypeLookup: [], additionalSearchFields: [] };\n\t\tthis.$.lookup.lookupResultsCallback(this.searchValue);\n\t}\n\n\tmobileSelection(e) {\n\t\tif(!this.isMobile)\n\t\t\treturn;\n\n\t\tlet row = Polymer.dom(e).localTarget;\n\t\tthis.setSelected(row);\n\t\tif(row.hasAttribute('data-search')) {\n\t\t\tthis.searchValue = row.getAttribute('data-search');\n\t\t\tthis.querySearchResults();\n\t\t} else {\n\t\t\tthis.value = row.getAttribute('data-id');\n\t\t\tthis.label = row.getAttribute('data-name');\n\t\t\tthis.saveAndDeferredClose();\n\t\t}\n\t}\n\n\tgetSearchValue(row) {\n\t\tif(row && !row.Id)\n\t\t\treturn row['__md__'].searchValue;\n\t}\n\n\tgetNameValue(row) {\n\t\treturn row[this.selectedLabel];\n\t}\n\n\tsetSelected(row) {\n\t\tthis.selected = row.$.row.$$('sb-table-cell');\n\t\tthis.toggleClass('selectedLookupItem', true, this.selected);\n\t}\n\n\tclearSelected() {\n\t\tif(this.selected)\n\t\t\tthis.toggleClass('selectedLookupItem', false, this.selected);\n\t}\n\n\t_hideCancel() {\n\t\treturn !this.isMobile || this.openSpinner || this.recordSpinner;\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n\nPolymer(LookupDialog);\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class MultiLookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-multi-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: String,\n\t\t\tobjectName: String,\n\t\t\thideCancel: Boolean,\n\t\t\ticonName: String,\n\t\t\ticonMap: Object,\n\t\t\tresults: Array,\n\t\t\tselectedItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tselectedIdsByItems: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcustomCallBack: Function,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: Boolean\n\t\t};\n\t}\n\n\tupdateTable(results) {\n\t\tthis.results = results;\n\t}\n\n\tready() {\n\t\t// eventlistener on lookup (lookup changed)\n\t\tthis.$.lookup.addEventListener('lookup-value-changed', function (e) {\n\t\t\tlet selectedItem = e.detail.obj;\n\t\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\t\tthis._addItem(selectedItem);\n\t\t\t} else {\n\t\t\t\tthis._animateDuplicate(selectedItem);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis._appendMobileClasses();\n\t}\n\n\t_addItem(item) {\n\t\tthis.selectedIdsByItems[item.Id] = item;\n\t\tthis.unshift('selectedItems', item);\n\t\tPolymer.dom.flush();\n\t\tif (this.iconName && this.iconMap)\n\t\t\tthis.toggleClass(this.iconMap[item[this.iconName]], true, this.$$(`.pill-icon`));\n\t}\n\n\t_animateDuplicate(item) {\n\t\tlet pills = Polymer.dom(this.$.selectedContainer).querySelectorAll('.pill');\n\t\tfor (let i=0; i<pills.length;i++) {\n\t\t\tif (pills[i].dataValue == item.Id) {\n\t\t\t\tpills[i].addEventListener('webkitAnimationEnd', function() {\n\t\t\t\t\tthis.toggleClass('invalid-selection', false, pills[i]);\n\t\t\t\t}.bind(this), false);\n\t\t\t\tthis.toggleClass('invalid-selection', true, pills[i]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t_appendMobileClasses() {\n\t\tthis.isMobile = true;\n\t\tthis.toggleClass('mobile', true, this.$.multilookup);\n\t\tthis.toggleClass('mobile', true, this.$.selectedContainer);\n\t\tthis.toggleClass('mobile', true, this.$.lookupContainer);\n\t\tthis.toggleClass('mobile', true, this.$.resultsTable);\n\t}\n\n\tremoveItem(e) {\n\t\tthis.splice('selectedItems', Polymer.dom(e.target).parentNode.dataIndex, 1);\n\t\tdelete this.selectedIdsByItems[Polymer.dom(e.target).parentNode.dataValue];\n\t}\n\n\tselectRow(e) {\n\t\tlet selectedItem = this.results[e.currentTarget.index];\n\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\tthis._addItem(selectedItem);\n\t\t} else {\n\t\t\tthis._animateDuplicate(selectedItem);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.selectedItems = [];\n\t\tthis.selectedIdsByItems = {};\n\t}\n\n}\n\nPolymer( MultiLookup );","export class Pagination {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pagination';\n\t\tthis.properties = {\n\t\t\tpageIndex: { // the current page the pagination widget is on\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tpageSize: Number, // the number of items per page\n\t\t\tnumItems: Number // the number of total items\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setNumberOfPagesObserver(pageSize, numItems)',\n\t\t'_setPageWindowObserver(pageIndex, pageSize, numItems)',\n\t\t'_setNextDisabledObserver(pageIndex, numPages)',\n\t\t'setPreviousDisabled(pageIndex)',\n\t\t'setPageNum(pageIndex)']\n\t}\n\n\tnext() {\n\t\tthis.pageIndex++;\n\t\tthis.firePageEvent('next');\n\t}\n\n\tprevious() {\n\t\tthis.pageIndex--;\n\t\tthis.firePageEvent('previous');\n\t}\n\n\t_setNumberOfPagesObserver (pageSize, numItems) {\n\t\tif (pageSize === undefined || numItems === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setNumberOfPages(pageSize, numItems);\n\t}\n\t\n\tsetNumberOfPages() {\n\t\tthis.numPages = Math.ceil(this.numItems / this.pageSize);\n\t}\n\n\t_setPageWindowObserver (pageIndex, pageSize, numItems) {\n\t\tif (pageIndex === undefined || pageSize === undefined || numItems === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setPageWindow(pageIndex, pageSize, numItems);\n\t}\n\t\n\tsetPageWindow() {\n\t\tlet start = this.pageIndex * this.pageSize;\n\t\tlet end = start + this.pageSize;\n\t\tif(end >= this.numItems)\n\t\t\tend = this.numItems;\n\t\tthis.pageWindow = [start, end];\n\t}\n\n\t_setNextDisabledObserver (pageIndex, numPages) {\n\t\tif (pageIndex === undefined || numPages === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setNextDisabled(pageIndex, numPages);\n\t}\n\t\n\tsetNextDisabled() {\n\t\tthis.nextDisabled = this.pageIndex === (this.numPages - 1);\n\t}\n\n\tsetPreviousDisabled() {\n\t\tthis.previousDisabled = this.pageIndex === 0;\n\t}\n\n\tsetPageNum() {\n\t\tthis.pageNum = this.pageIndex + 1;\n\t}\n\n\tfirePageEvent(direction) {\n\t\tthis.fire('pagination-changed', {direction: direction, page: this.pageNum, index: this.pageIndex, window: this.pageWindow});\n\t}\n}\n\nPolymer(Pagination);","import { Events, fireEvent } from 'common/core/Events.js';\n\n/**\n * A RichTextEditor component class.\n */\nexport class RichTextEditor {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-rte';\n\t\tthis.properties = {\n\t\t\t/** The rich text value, i.e. a string of HTML */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t};\n\t}\n\n\tattached() {\n\t\tif (this.renderReadOnly) {\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\tfocus() {\n\t\tfireEvent(Events.OPEN_RTE_DIALOG, { rte: this, value: this.value });\n\t}\n\n}\n\nPolymer( RichTextEditor );\n","import {AppContext} from 'common/core/AppContext.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {Page} from 'common/core/Page.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\n\n/**\n * SearchBar is a component providing an input element.\n * Uses are:\n *        When 2+ characters are entered products will be searched and shown below the input element\n *        When a product in that list is selected an event is fired with that product from the searchModel\n *            Event:    sb-search-item-selected\n *        When enter is pressed or the search button is clicked a search is performed and en event with the searchModel results are fired\n *            Event:    sb-search-invoked\n */\nexport class SearchBar {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-bar';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlimit: { //the limit to apply on search\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 5\n\t\t\t},\n\t\t\tvalue: { //the value in the search bar\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tnotify: true //notify is true so that callers of this can bind in values\n\t\t\t},\n\t\t\tsearchedValue: { //the value last searched\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabel: { //what value(s) to show in the list of results\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tquote: Object, //the quote is needed for search so that we can at minimum get the Pricebook on the backend\n\t\t\tsearchService: String, //backend API to call on search,\n\t\t\tactionId: String, // the id of the action/button clicked.  used on the server\n\t\t\tsearchResultCallback: Function, //callback for handling the typeahead results\n\t\t\tshowResetButton: { //show/hide the reset button\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPlaceholder(i18n)'\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsearcher: Object\n\t\t}, Page.properties);\n\t}\n\n\t/**\n\t * Observers:\n\t *        valueChanged: expected to run when the value in the input is changed\n\t */\n\tget observers() {\n\t\treturn [\n\t\t\t'valueChanged(value)',\n\t\t\t'_realignObserver(reposition, isMobile)'\n\t\t];\n\t}\n\n\t/**\n\t * Component is ready so we can add event listeners\n\t */\n\tready() {\n\t\tthis.$.typeahead.addEventListener('enter-without-selection', this.search.bind(this));\n\t\tthis.$.typeahead.addEventListener('selected-item-changed', this.handleItemSelected.bind(this));\n\t\tthis.$.typeahead.showAllResults = true; //we want to show all results, not just ones containing the search text\n\t\tthis.$.typeahead.itemsCallback = this.typeAheadCallback.bind(this);\n\t\tthis.localizer = new LocalizeFields(this.fieldPrefix); //provides the ability to localize a SearchModel\n\t}\n\n\t/**\n\t * Value changed observer\n\t */\n\tvalueChanged() {\n\t\tif(this.value === undefined || this.value === '') //special case for when nil or undefined, turn the button on\n\t\t{\n\t\t\tthis.fire('sb-type-clear');\n\t\t\tthis.toggleClass('disabled', false, this.$.search); //enable\n\t\t}\n\t\telse\n\t\t\tthis.toggleClass('disabled', this.isSearchValid() === false, this.$.search); //enabled/disabled search button\n\t}\n\n\t_realignObserver (reposition, isMobile) {\n\t\tif (reposition === undefined || isMobile === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.realign(reposition, isMobile);\n\t}\n\t\n\trealign() {\n\t\tif (this.isMobile)\n\t\t\tthis.toggleClass('shiftRight', true, this.$.buttons);\n\t}\n\n\t/**\n\t * Fire search event with the selected item and the value\n\t * @param e\n\t */\n\thandleItemSelected(e) {\n\t\tthis.value = e.detail.value.Name;\n\t\tif (this.value === undefined) //when the cancel icon is clicked, this is triggered and the value is undefined\n\t\t\treturn;\n\t\tthis.fire('sb-search-item-selected', {\n\t\t\titem: this.getSearchResultRow(e.detail.value.Id),\n\t\t\tsearchValue: this.value\n\t\t});\n\t}\n\n\t/**\n\t * @param enabled - enables/disabled the reset button\n\t */\n\ttoggleResetButton(enabled) {\n\t\tif (this.showResetButton === true)\n\t\t\tthis.toggleClass('disabled', enabled === false, this.$$('#reset')); //enabled/disabled reset button\n\t}\n\n\t/**\n\t * Fires an event when the reset button is clicked\n\t */\n\treset() {\n\t\tthis.fire('sb-search-reset-clicked');\n\t}\n\n\t/**\n\t * Handle enter keypress or search button pressed\n\t * Performs a search with no LIMIT\n\t * Fires an event with the searchModel for that search\n\t */\n\tsearch() {\n\t\tif (this.isSearchValid() === false) {\n\t\t\tif (this.value === '' || this.value === undefined) //fire an event when search is run and there is a nil value\n\t\t\t\tthis.fire('sb-search-nil-search-invoked');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.spinner = true;\n\t\tthis.blur(); //don't need to show the typeAhead results\n\t\tthis.searchedValue = this.value; //store the value that was searched\n\t\tthis.serviceCallout(null).then(function (result) {\n\t\t\tthis.fire('sb-search-invoked', {\n\t\t\t\tsearchModel: result,\n\t\t\t\tsearchValue: this.value\n\t\t\t});\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t *\n\t * @param productId to search for\n\t * searches for the result within the searchModel and returns it\n\t * @returns {Object}\n\t */\n\tgetSearchResultRow(productId) {\n\t\tlet searchModel = Object.assign({}, this.mostRecentResults);\n\t\tfor (let result of searchModel.results)\n\t\t\tif (result.record.Product2Id === productId)\n\t\t\t\treturn result;\n\t}\n\n\t/**\n\t * This will call the server with a search and parse the results into an array\n\t * @returns {Promise}\n\t */\n\ttypeAheadCallback() {\n\t\treturn new Promise(function (resolve) {\n\t\t\tif (this.searchService === undefined || this.quote === undefined || this.isSearchValid() === false)\n\t\t\t\treturn;\n\n\t\t\tthis.serviceCallout(this.limit).then(function (result) {\n\t\t\t\tthis.mostRecentResults = result;\n\t\t\t\tif (typeof this.searchResultCallback === 'function')\n\t\t\t\t\treturn this.searchResultCallback(this.parseResults(result));\n\n\t\t\t\tresolve(this.parseResults(result));\n\t\t\t}.bind(this));\n\t\t}.bind(this))\n\t}\n\n\t/**\n\t * Returns the filter context from the searcher object\n\t * @returns {Object} filterContext\n\t */\n\tgetFilterContextFromSearcher() {\n\t\treturn this.searcher ? this.searcher.getFilterContext() : {};\n\t}\n\n\t/**\n\t * Returns a DataBuilder object that provides context for the server callback\n\t * @returns {Object} DataBuilder\n\t */\n\tbuildContext(limit) {\n\t\treturn new DataBuilder()\n\t\t\t.addObject('filterContext', this.getFilterContextFromSearcher(), undefined, undefined, true)\n\t\t\t.add('searchContext', this.getSearchContext())\n\t\t\t.add('resultLimit', limit)\n\t\t\t.add('pageNumber', null)\n\t\t\t.add('actionId', this.actionId)\n\t\t\t.addObject('quote', this.quote.record)\n\t\t\t.build();\n\t}\n\n\t/**\n\t * This calls out to the server searching using SOSL returning a searchModel\n\t * @param limit to apply to the SOSL query\n\t * @returns {Promise}\n\t */\n\tserviceCallout(limit) {\n\t\treturn new Promise(function (resolve) {\n\t\t\tthis.$.service.client.load(\n\t\t\t\tthis.prefix,\n\t\t\t\tthis.searchService,\n\t\t\t\tnull,\n\t\t\t\tthis.buildContext(limit)\n\t\t\t).then(function (result) {\n\t\t\t\tresolve(this.localizer.localizeSearchModel(result)); //resolve a localized SearchModel\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Parses a searchModel and extracts the results.  Then formats them for display\n\t * @param searchModel\n\t * @returns {Array}\n\t */\n\tparseResults(searchModel) {\n\t\tlet results = [],\n\t\t\tsearchValue = this.getSearchContext();\n\t\tif (searchValue === null) //if a user were to type in a search, but clear it out before the server returned, this would throw an error\n\t\t\treturn results;\n\t\tfor (let result of searchModel.results) {\n\t\t\tlet productRecord = result.record.Product2;\n\t\t\t//if the text in the search bar matches part of the product name we make that part of the name bold\n\t\t\tlet reg = new RegExp(searchValue, 'i');\n\t\t\tlet match = productRecord.Name.match(reg);\n\t\t\tif (match) {\n\t\t\t\tlet first = productRecord.Name.substring(0, match.index);\n\t\t\t\tlet inner = productRecord.Name.substring(match.index, match.index + searchValue.length);\n\t\t\t\tlet second = productRecord.Name.substring(match.index + searchValue.length);\n\t\t\t\tproductRecord.DisplayName = first + '<b>' + inner + '</b>' + second;\n\t\t\t}\n\t\t\telse\n\t\t\t\tproductRecord.DisplayName = productRecord.Name;\n\n\t\t\tresults.push(productRecord);\n\t\t}\n\t\treturn results;\n\t}\n\n\t/**\n\t * @returns {String}\n\t */\n\tget prefix() {\n\t\treturn this.app.org.prefix;\n\t}\n\n\t/**\n\t * @returns {String}\n\t */\n\tget fieldPrefix() {\n\t\treturn this.app.org.prefix === undefined ? '' : this.app.org.prefix + '__';\n\t}\n\n\t/**\n\t * Returns the string to search on\n\t * @returns {Object}\n\t */\n\tgetSearchContext() {\n\t\treturn this.isSearchValid() === true ? this.value : null;\n\t}\n\n\t/**\n\t * SOSL requires a minimum of 2 characters to search\n\t * *, ?, (, ), and \" \" are not valid search characters\n\t * @returns {boolean}\n\t */\n\tisSearchValid() {\n\t\tif (this.value === undefined)\n\t\t\treturn false;\n\t\tlet value = this.value\n\t\t\t.replace(/ /g, \"\")\n\t\t\t.replace(/\\*/g, \"\")\n\t\t\t.replace(/\\?/g, \"\")\n\t\t\t.replace(/\\(/g, \"\")\n\t\t\t.replace(/\\)/g, \"\");\n\t\treturn value.length > 1;\n\t}\n\n\tgetPlaceholder() {\n\t\tif(this.i18n && typeof this.i18n.l === 'function')\n\t\t\treturn this.i18n.l('Search Products');\n\t\treturn 'Search Products';\n\t}\n}\n\nPolymer(SearchBar);","export class SearchBarDialog {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-bar-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: String,\n\t\t\tcols: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\tcolsDisplay: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\tresults: Array\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.attachSearchProperties();\n\t\tthis.attachSearchEvents();\n\t}\n\n\tattachSearchProperties() {\n\t\tthis.$.search.searchResultCallback = this.handleSearchResults.bind(this);\n\t}\n\n\tattachSearchEvents() {\n\t\tthis.$.search.addEventListener('sb-search-invoked', this.toggle.bind(this));\n\t\tthis.$.search.addEventListener('sb-search-nil-search-invoked', this.updateSearchResults.bind(this));\n\n\t}\n\n\topen() {\n\t\tthis.$.search.value = this.value; //if search has been cleared on selection screen, reflect that here\n\t\tif (this.value === '')\n\t\t\tthis.results = [];\n\t\tthis.toggle();\n\t\tthis.$.search.$.typeahead.focus();\n\t}\n\n\tclose() {\n\t\tthis.blur();\n\t\tthis.toggle();\n\t}\n\n\ttoggle() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\thandleSearchResults(results) {\n\t\tthis.results = results;\n\t}\n\n\tupdateSearchResults() {\n\t\tlet displayResults = [];\n\t\tfor (let result of this.results) {\n\t\t\tif (result.Name === this.$.search.value)\n\t\t\t\tdisplayResults.push(result);\n\t\t}\n\t\tthis.results = displayResults;\n\t}\n\n\tmobileSelection(e) {\n\t\tlet row = Polymer.dom(e).localTarget,\n\t\t\tsearchValue = row.getAttribute('data-name');\n\t\tthis.$.search.value = searchValue;\n\t\tlet rowId = row.getAttribute('data-id');\n\t\tthis.fire('sb-search-item-selected', {\n\t\t\titem: this.$.search.getSearchResultRow(rowId),\n\t\t\tsearchValue: searchValue\n\t\t});\n\n\t\tsetTimeout(function () {\n\t\t\tthis.toggle();\n\t\t}.bind(this), 350);\n\t\tthis.updateSearchResults();\n\t}\n\n\tclearSearchResults() {\n\t\tthis.results = [];\n\t}\n}\n\nPolymer(SearchBarDialog);","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Select {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-select';\n\t\tthis.properties = {\n\t\t\tvalue: { // the value of the selected option\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\toptions: Array, // array of objects with the keys 'value' and 'label'\n\t\t\tisRequired: { // true if this is a required field\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tnoneLabel: { // if not required, value of the first option that represents no selection\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tmultiSelect: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_multiSelectChanged'\n\t\t\t},\n\t\t\tsize: Number,\n\t\t\t_multiple: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setMultiple(multiSelect)'\n\t\t\t},\n\t\t\t_options: Array\n\t\t};\n\t}\n\n\t_multiSelectChanged(newVal, oldVal) {\n\t\tif (oldVal === undefined && newVal) {\n\t\t\tthis.buildOptions();\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_buildOptionsObserver(options, isRequired)',\n\t\t'_setSelectedObserver(value, _options)']\n\t}\n\n\t_buildOptionsObserver (options, isRequired) {\n\t\tif (options === undefined || isRequired === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildOptions(options, isRequired);\n\t}\n\t\n\tbuildOptions() {\n\t\tif (!this.options) {\n\t\t\treturn;\n\t\t}\n\t\tlet noneSelected = true;\n\t\tlet options = [];\n\t\tlet values = this._getValues();\n\t\tfor (let i = 0, l = this.options.length; i < l; i++) {\n\t\t\tlet option = this.options[i];\n\t\t\tlet selected = values.indexOf(option.value.toString()) !== -1;\n\t\t\tnoneSelected = noneSelected && !selected;\n\t\t\toptions.push( { value: option.value, label: option.label, selected: selected } );\n\t\t}\n\n\t\tif (noneSelected && values.length > 0) {\n\t\t\tfor(let val of values)\n\t\t\t\toptions.push({ value: val, label: val, selected: true });\n\t\t\tnoneSelected = false;\n\t\t}\n\n\t\tif ((noneSelected && !this.multiSelect) || !this.isRequired)\n\t\t\toptions = [ { value: '', label: this.noneLabel, selected: noneSelected } ].concat(options);\n\n\t\tif (AppContext.isIE()) {\n\t\t\tlet select = Polymer.dom(this.querySelector('.myselect'));\n\t\t\tlet childNodes = select.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tselect.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tfor (let j = 0, len = options.length; j < len; j++) {\n\t\t\t\tthis._createOptionElements(this.querySelector('.myselect'), options[j]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._options = options;\n\t\t}\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option.label;\n\t\toptionEl.value = option.value;\n\t\toptionEl.selected = option.selected;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\t_setSelectedObserver (value, _options) {\n\t\tif (value === undefined || _options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelected(value, _options);\n\t}\n\t\n\tsetSelected() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tlet values = this._getValues();\n\t\tfor(let i = 0, l = this._options.length; i < l; i++) {\n\t\t\tthis._options[i].selected = values.indexOf(this._options[i].value.toString()) !== -1;\n\t\t\tif(this.querySelector('.myselect').options[i])\n\t\t\t\tthis.querySelector('.myselect').options[i].selected = values.indexOf(this.querySelector('.myselect').options[i].value.toString()) !== -1;\n\t\t}\n\t}\n\n\tchange() {\n\t\tlet options = this.querySelector('.myselect').options;\n\t\tlet value = null;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (!AppContext.isIE())\n\t\t\t\tthis._options[i].selected = options[i].selected;\n\n\t\t\tif (!options[i].selected)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.multiSelect && value != null)\n\t\t\t\tvalue += (';' + options[i].value);\n\t\t\telse\n\t\t\t\tvalue = options[i].value;\n\t\t}\n\t\tthis.internal = true;\n\t\tthis.value = value;\n\t\tthis.internal = false;\n\n\t\tthis.fire('change', { value: this.value } );\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.querySelector('.myselect').focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_setMultiple() {\n\t\treturn this.multiSelect ? true : undefined;\n\t}\n\n\t_getValues() {\n\t\treturn Select.getValues(this.value, this.multiSelect);\n\t}\n\n\tstatic getValues(value, multiSelect) {\n\t\tif(value != null && value !== '')\n\t\t\treturn multiSelect ? value.split(';') : [value.toString()];\n\t\treturn [];\n\t}\n}\n\nPolymer(Select);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Textarea {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-textarea';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed'\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.textarea.focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t}\n\n\thighlight() {\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.$.textarea.setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.$.textarea.value = this.value;\n\n\t\tthis.fire('sb-textarea-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Textarea);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst wildCards = new RegExp('[*_%]+', 'g');\nlet resultLimit = 10; // first 10 matching items\nimport {Html} from 'common/layout/sb-html/Html.js';\n\n\nexport class Typeahead {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-typeahead';\n\n\t\tthis.properties = {\n\t\t\t// users can give items as input or provide a callback that sets items. An optional debounce parameter with\n\t\t\t// callback ensures that the callback is called only after some delay in millis. Default value for debounce is 1s.\n\t\t\titems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\titemsCallback: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdebounceDelay: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 300\n\t\t\t},\n\t\t\tselectedItem:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titemsList: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserver: 'itemsListChanged',\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('labels') || ['label'];\n\t\t\t\t}\n\t\t\t},\n\t\t\tlabelValue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tdelimiter: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('delimiter') || '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tsavedLabelValue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tinvalidLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasList: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_calculateListPosition'\n\t\t\t},\n\t\t\thasLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasFilter: Boolean, /* set by parent component, sb-lookup.html */\n\t\t\toptionIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tclearAfterSelection: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trevertOnEscape: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcalculateListPosition: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListNoSuggestion: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideInput: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowLeftSearchIcon: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tdisjointLabel: Boolean,\n\t\t\tshowAllResults: { //determines if items not containing the value should be shown\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\n\t\tthis.observers = ['_itemsChangedObserver(items, labels)',\n\t\t'_selectedItemChangedObserver(selectedItem, value)',\n\t\t'_setStylesObserver(showLeftSearchIcon, hideCancelIcon)'];\n\t}\n\n\tready() {\n\t\tthis.$.itemLabel.addEventListener('focus', this._directInputFocus.bind(this));\n\t\tthis.$.itemLabel.addEventListener('blur', this._directInputBlur.bind(this));\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\t_setStylesObserver (showLeftSearchIcon, hideCancelIcon) {\n\t\tif (showLeftSearchIcon === undefined || hideCancelIcon === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setStyles(showLeftSearchIcon, hideCancelIcon);\n\t}\n\t\n\tsetStyles() {\n\t\tif (this.showLeftSearchIcon)\n\t\t\tthis.toggleClass('leftSearch', true, this.$.itemLabel)\n\t\tif (!this.hideCancelIcon)\n\t\t\tthis.toggleClass('cancelIcon', true, this.$.itemLabel)\n\t}\n\n\t_itemsChangedObserver (items, labels) {\n\t\tif (items === undefined || labels === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.itemsChanged(items, labels);\n\t}\n\t\n\titemsChanged() {\n\t\tif(this.items.length)\n\t\t\tthis.itemsList = this.updateItemsList();\n\t}\n\n\t_selectedItemChangedObserver (selectedItem, value) {\n\t\tif (selectedItem === undefined || value === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.selectedItemChanged(selectedItem, value);\n\t}\n\t\n\tselectedItemChanged() {\n\t\tif (this.selectedItem) {\n\t\t\tlet md = this.selectedItem.__md__;\n\t\t\tlet clearAfterSelection = md ? md.clearAfterSelection : false;\n\n\t\t\tthis.labelValue = this.getSelectedItemValue();\n\n\t\t\tif (this.clearAfterSelection || clearAfterSelection) {\n\t\t\t\tthis.selectedItem = '';\n\t\t\t\tthis.items = this.itemsList = [];\n\t\t\t}\n\t\t\tif(!this.originalSelected)\n\t\t\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem));\n\t\t}\n\t}\n\n\titemsListChanged() {\n\t\tPolymer.dom.flush(); // need to update DOM before updating innerHTML of the new elements on the list\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tif(!options) return;\n\t\tlet numOfOptions = options.length;\n\t\tlet numOfLabels = this.labels.length;\n\t\tif ( numOfOptions > 0 ) {\n\t\t\tthis.optionIndex = -1; // highlights the characters\n\t\t\tfor ( let i = 0; i < numOfOptions; i++ ) { // highlight matching characters in the label\n\t\t\t\tlet item = this.itemsList[i],\n\t\t\t\t\thtml = '';\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet label = this.labels[j],\n\t\t\t\t\t\tdelimiter = ( j===0 ) ? '' : this.delimiter,\n\t\t\t\t\t\tlabelValue = item[label];\n\t\t\t\t\thtml += delimiter + labelValue;\n\t\t\t\t}\n\t\t\t\toptions[i].innerHTML = Html.sanitizeHtmlText(html);\n\t\t\t\tPolymer.dom(options[i]).setAttribute('data-label', html)\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedItemValue() {\n\t\tconst valueAttr = this.value ? this.value : 'value';\n\t\treturn this.selectedItem ? this.selectedItem[valueAttr] : '';\n\t}\n\n\tclear() {\n\t\tthis.hide();\n\t\tthis.updateItem({}, true);\n\t\tthis.fire('sb-type-clear');\n\t}\n\n\thide() {\n\t\tthis.hideList();\n\t\tthis.invalidLabel = false;\n\t\tthis.optionIndex = -1;\n\t}\n\n\tcloneItem(item) {\n\t\tlet clone = {},\n\t\t\tkeys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tfor ( let i = 0; i < len; i++ ) {\n\t\t\tlet key = keys[i];\n\t\t\tclone[key] = item[key];\n\t\t}\n\t\treturn clone;\n\t}\n\n\tupdateItem(item, forceSuggestOnFocus) {\n\t\t//update selectedItem\n\t\tlet keys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tlet selectedItem = {};\n\t\tfor ( let i=0; i < len; i++) {\n\t\t\tlet key = keys[i];\n\t\t\tselectedItem[key] = item[key] !== undefined ? item[key] : '';\n\t\t}\n\t\tthis.selectedItem = selectedItem;\n\t\t//update value in the input box\n\t\tlet labelValue = '',\n\t\t\tnumOfLabels = this.labels.length;\n\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\tlet delimiter = ( j===0 ) ? '' : this.delimiter;\n\t\t\tlet selectedLabel = this.selectedItem[this.labels[j]];\n\t\t\tif(selectedLabel)\n\t\t\t\tlabelValue += delimiter + selectedLabel;\n\t\t}\n\n\t\tlet md = this.selectedItem.__md__;\n\t\tif (!this.disjointLabel) //If the displayed data is different from the backend data, don't replace displayed data\n\t\t\tthis.labelValue = md && !md.clearAfterSelection && md.searchValue !== undefined ? md.searchValue : labelValue;\n\n\t\tthis.clearSelection();\n\t\tthis.focusOrBlurAfterSelection(this.selectedItem, forceSuggestOnFocus);\n\t}\n\n\tsubmitItem(e) {\n\t\tlet item = e.model.item;\n\t\tthis.updateItem(item);\n\t\tthis.hide();\n\t\tthis.focusOrBlurAfterSelection(item)\n\t}\n\n\tfocusOrBlurAfterSelection(item, forceSuggestOnFocus) {\n\t\tif(!item || !item.__md__ || !item.__md__.noFocusAfterSelection)\n\t\t\tthis.focus(forceSuggestOnFocus);\n\t\telse\n\t\t\tthis.$.itemLabel.blur();\n\t}\n\n\tselectAdjacentItem(keyCode) {\n\t\t// keycode 40 => arrow-down, 38 arrow-up\n\t\tif(!this.itemsList)\n\t\t\treturn;\n\t\tlet len = this.itemsList.length;\n\t\tif ( this.optionIndex >= 0 && this.optionIndex < len ) {\n\t\t\tthis.$.selector.children[this.optionIndex].removeAttribute( 'selected' );\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === 0 ? len - 1 : this.optionIndex - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === len - 1 ? 0 : this.optionIndex + 1;\n\t\t\t}\n\t\t} else if (this.optionIndex === -1) {\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = len - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = 0;\n\t\t\t}\n\t\t}\n\t\tthis.$.selector.children[this.optionIndex].setAttribute( 'selected', '' );\n\t}\n\n\tupdateItemsList() {\n\t\tif (!this.searchLabels)\n\t\t\tthis.searchLabels = this.labels;\n\t\tif(this.showAllResults === true) //don't parse through items, just show them all\n\t\t\treturn this.items;\n\t\tlet result = [],\n\t\t\thighlighted = false;\n\t\tif (this.showListNoSuggestion || this.labelValue) {\n\t\t\tlet labelValue = this.labelValue || '';\n\t\t\tlet searchLabel = labelValue.replace(/\\+/g, '\\\\+').replace(/\\\\/g, '\\\\\\\\').replace( wildCards, '.+'), //capture wild card characters (1 or more)\n\t\t\t\tsearchText = new RegExp( searchLabel, 'i' );\n\n\t\t\tlet numOfItems = this.items.length,\n\t\t\t\tnumOfLabels = this.searchLabels.length;\n\t\t\tfor ( let i = 0; i < numOfItems; i++ ) {\n\t\t\t\tlet item = this.items[i],\n\t\t\t\t\tclone = this.cloneItem(item); // clone item to preserve original object\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet itemLabel = item[this.searchLabels[j]];\n\t\t\t\t\tif ( itemLabel && (this.showListNoSuggestion || searchText.test(itemLabel)) ) {\n\t\t\t\t\t\tlet label = '_' + this.searchLabels[j]; // create a new label for internally storing the highlighted html text\n\t\t\t\t\t\t\tclone[label] = itemLabel.replace( searchText, '<span style=\"font-weight:bold;\">$&</span>' );\n\t\t\t\t\t\thighlighted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( highlighted ) {\n\t\t\t\t\tlet showItem = true;\n\t\t\t\t\tfor (let displayLabel of this.labels) {\n\t\t\t\t\t\tif (!clone[displayLabel])\n\t\t\t\t\t\t\tshowItem = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (showItem)\n\t\t\t\t\t\tresult.push(clone);\n\t\t\t\t\thighlighted = false;\n\t\t\t\t}\n\t\t\t\tif ( result.length >= resultLimit ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tsuggest(e) {\n\t\tif(!this.isAttached)\n\t\t\treturn;\n\n\t\tswitch( e.keyCode ) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tthis.$.itemLabel.blur();\n\t\t\t\tif(this.hasList) {\n\t\t\t\t\tif (this.optionIndex === -1){\n\t\t\t\t\t\tthis.fire('enter-without-selection', {value: this.labelValue});\n\t\t\t\t\t\tthis.hideList();\n\t\t\t\t\t\tthis.optionIndex = 0;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tthis.updateItem(this.itemsList[this.optionIndex]);\n\t\t\t\t\tthis.noBlur = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.fire('enter-without-selection', {value: this.labelValue});\n\t\t\t\tthis.hide();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif(this.revertOnEscape) {\n\t\t\t\t\tthis.updateItem(this.originalSelected);\n\t\t\t\t\tthis.items = undefined;\n\t\t\t\t\tthis.hideList();\n\t\t\t\t\tthis.clearSelection();\n\t\t\t\t\tthis.fire('sb-type-blur');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\tcase 40: // down arrow - move trough matching list items\n\t\t\t\tthis.selectAdjacentItem( e.keyCode );\n\t\t\t\tbreak;\n\t\t\tcase 9: // tab key\n\t\t\tcase 16: // shift key\n\t\t\t\tbreak;\n\t\t\tdefault: // re-build itemsList\n\t\t\t\tthis.invalidLabel = false;\n\t\t\t\tif(this.itemsCallback) {\n\t\t\t\t\tthis.debounce('itemsCallback', function () {\n\t\t\t\t\t\tlet promise = this.itemsCallback(this.labelValue);\n\t\t\t\t\t\tpromise.then(\n\t\t\t\t\t\t\t(function (items) {\n\t\t\t\t\t\t\t\tif(items && items.length > 0)\n\t\t\t\t\t\t\t\t\tthis.showList();\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tthis.hideList();\n\t\t\t\t\t\t\t\tthis.items = items;\n\t\t\t\t\t\t\t}).bind(this),\n\t\t\t\t\t\t\t(function (error) {\n\t\t\t\t\t\t\t\tconsole.error(error && error.message ? error.message : error);\n\t\t\t\t\t\t\t\tthis.items = []\n\t\t\t\t\t\t\t}).bind(this));\n\t\t\t\t\t}, this.debounceDelay);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.showList();\n\t\t\t\t\tthis.itemsList = this.updateItemsList();\n\t\t\t\t\tif ( this.itemsList.length === 0 ) {\n\t\t\t\t\t\tif ( this.labelValue ) {\n\t\t\t\t\t\t\tthis.invalidLabel = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.hasLabel = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.hasList = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tshowList() {\n\t\tif(this.blurred) {\n\t\t\tthis.hideList();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.showListNoSuggestion || (this.labelValue != null && this.labelValue !== '')) {\n\t\t\tthis.hasList = true;\n\t\t\tthis.hasLabel = true;\n\t\t}\n\t}\n\n\thideList() {\n\t\tthis.hasList = false;\n\t\tthis.hasLabel = false;\n\t}\n\n\tclearSelection() {\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tfor(let option of options)\n\t\t\tthis.toggleAttribute('selected', false, option);\n\t}\n\n\ttabBlur(e) {\n\t\tif(e.keyCode === 9 ) // tab key\n\t\t\tthis.hasList = false;\n\t\tif(e.keyCode === 38) // up arrow\n\t\t\te.preventDefault(); // prevents the movement of the cursor in the text input to the beginning\n\t\tif(e.keyCode === 13 && this.hasList) // enter key\n\t\t\tthis.preventBlur();\n\t\tif(e.keyCode === 27 && !this.revertOnEscape) {\n\t\t\t// FF specific fix to prevent the esc from reverting back last selected value\n\t\t\tsetTimeout(function(labelValue) {\n\t\t\t\tthis.labelValue = labelValue;\n\t\t\t}.bind(this, this.labelValue), 0)\n\t\t}\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.focusDisabled)\n\t\t\treturn;\n\n\t\tthis.focusing = true;\n\t\tthis.$.itemLabel.focus();\n\t\tthis._showListOnFocus(forceSuggest);\n\t\tthis.focusing = false;\n\t}\n\n\tblur(e, force) {\n\t\tif(!force && (this.hasList || this.blurDisabled))\n\t\t\treturn;\n\n\t\tthis.hideList();\n\t\tthis.fire('sb-type-blur');\n\t\tthis.setOriginalSelected();\n\t}\n\n\tsetOriginalSelected() {\n\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem || {}));\n\t}\n\n\tpreventBlur() {\n\t\tthis.noBlur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noBlur = false;\n\t}\n\n\tfocused() {\n\t\tthis.fire('sb-type-focus', { value: this.labelValue } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_calculateListPosition() {\n\t\tif(this.calculateListPosition && this.hasList) {\n\t\t\tlet leftOffset = PageContainer.getContainer().getBoundingClientRect().left;\n\t\t\tlet left = this.$.itemLabel.getBoundingClientRect().left;\n\t\t\tthis.$.selector.style.left = (left - leftOffset) + 'px';\n\t\t}\n\t}\n\n\t_showListOnFocus(forceSuggest) {\n\t\tif(!this.showListOnFocus || this.hideInput || this.hasList)\n\t\t\treturn;\n\n\t\tif(forceSuggest || !this.items || this.items.length === 0 || this.hasFilter)\n\t\t\tthis.suggest({});\n\t\telse\n\t\t\tthis.showList();\n\t}\n\n\t_directInputFocus() {\n\t\tthis.blurred = false;\n\t\tif(!this.focusing)\n\t\t\tthis._showListOnFocus();\n\t}\n\n\t_directInputBlur() {\n\t\tthis.blurred = true;\n\t\tthis.blur(null, !this.noBlur);\n\t}\n}\n\nPolymer( Typeahead );\n","const NOT_GROUPED_NAME = 'Other';\n\nexport class RecordGrouper {\n\n\t/**\n\t * @param groupField the name of the field on the item's record used to group the items by\n\t * @param groupedRecordFields the name (or names) of the field(s) to assign the group value for the dummy item's grouper object (optional)\n\t * @param recordPath if the items to be grouped contain the record, then this is the path from the item to the record (optional)\n\t * @param itemProperties map of item properties to be added to all items when being grouped (optional)\n\t * @param itemPropertiesByGroup map of item properties by group to be added to matching items when being grouped (optional)\n\t * @param groupProperties map of group properties to be added to dummy item group object (optional)\n\t * @param groupCountPath if non nil contains the path in the dummy item group object where the grouped count should be stored (optional)\n\t */\n\tconstructor(groupField, groupedRecordFields, recordPath, itemProperties, itemPropertiesByGroup, groupProperties, groupCountPath, groupFieldType, groupFieldTypePath) {\n\t\tthis.groupField = groupField;\n\t\tif(groupedRecordFields)\n\t\t\tthis.groupedRecordFields = groupedRecordFields.constructor !== Array ? [groupedRecordFields] : groupedRecordFields;\n\t\tthis.recordPath = recordPath;\n\t\tthis.itemProperties = itemProperties;\n\t\tthis.itemPropertiesByGroup = itemPropertiesByGroup;\n\t\tthis.groupProperties = groupProperties;\n\t\tthis.groupCountPath = groupCountPath;\n\t\tthis.groupFieldType = groupFieldType;\n\t\tthis.groupFieldTypePath = groupFieldTypePath;\n\t}\n\n\t/**\n\t * Returns the provided items ordered by groups with an optional item object before each set of grouped items that contains the group details.\n\t *\n\t * @param items the list of objects that needs to be grouped assuming each item is, or contains, the record that contains the group value\n\t */\n\tgroup(items) {\n\t\tlet orderdGroups = [];\n\t\tlet itemsByGroup = {};\n\n\t\t// initialize ordered groups array and group map\n\t\tfor(let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i];\n\n\t\t\t// get the record within the item via its record path, if recordPath is nil then the item is the record\n\t\t\tlet record = this._get(item, this.recordPath);\n\n\t\t\t// determine the group name based on the record's value by that key\n\t\t\tlet group = record[this.groupField];\n\n\t\t\t// treat the record as not grouped if the group value is nil\n\t\t\tlet notGrouped = group === undefined || group === null || group === '';\n\n\t\t\t// ensure the group is a valid string even if not grouped\n\t\t\tgroup = notGrouped ? NOT_GROUPED_NAME : (group + '');\n\n\t\t\t// grab the existing items already organized by the current group\n\t\t\tlet groupedItems = itemsByGroup[group];\n\n\t\t\t// add the group to the groups list the first time the group is encountered\n\t\t\tif(!groupedItems && !notGrouped)\n\t\t\t\torderdGroups.push(group);\n\n\t\t\t// ensure we have a defined groupItems array in case first item in this group\n\t\t\tgroupedItems = groupedItems || [];\n\n\t\t\t// this item is now a groupie to this group, so lets indicate as much\n\t\t\titem.groupie = group;\n\t\t\titem.grouper = null;\n\t\t\tgroupedItems.push(item);\n\t\t\titemsByGroup[group] = groupedItems;\n\n\t\t\tthis._setProperties(item, this.itemProperties);\n\t\t\tthis._setProperties(item, this.itemPropertiesByGroup, group);\n\t\t}\n\n\t\t// if group map contains the non grouped name, then add the non grouped name at the end of the ordered list\n\t\tif(itemsByGroup[NOT_GROUPED_NAME])\n\t\t\torderdGroups.push(NOT_GROUPED_NAME);\n\n\t\treturn this._sortItemsByGroup(orderdGroups, itemsByGroup);\n\t}\n\n\t/**\n\t * Returns an ordered array of items by group with an optional grouper item before each group.\n\t *\n\t * @param orderedGroups the ordered grouped values\n\t * @param itemsByGroup the map that has ordered items by group value\n\t * @private\n\t */\n\t_sortItemsByGroup(orderedGroups, itemsByGroup) {\n\t\tlet response = [];\n\t\tfor(let i = 0, l = orderedGroups.length; i < l; i++) {\n\t\t\tlet group = orderedGroups[i];\n\t\t\tlet items = itemsByGroup[group];\n\t\t\tlet numItems = items.length;\n\t\t\tif(this.groupedRecordFields) {\n\t\t\t\tlet groupItem = { grouper : group, groupie: null };\n\t\t\t\tlet groupRecord = this._get(groupItem, this.recordPath);\n\t\t\t\tfor(let j = 0, ll = this.groupedRecordFields.length; j < ll; j++)\n\t\t\t\t\tgroupRecord[this.groupedRecordFields[j]] = group;\n\t\t\t\tif(this.groupCountPath) {\n\t\t\t\t\tlet groupCount = this._get(groupItem, this.groupCountPath.path);\n\t\t\t\t\tgroupCount[this.groupCountPath.property] = '(' + numItems + ')';\n\t\t\t\t}\n\t\t\t\tif(this.groupFieldType && this.groupFieldTypePath) {\n\t\t\t\t\tlet groupFieldMd = this._get(groupItem, this.groupFieldTypePath.path);\n\t\t\t\t\tgroupFieldMd[this.groupFieldTypePath.property] = group !== NOT_GROUPED_NAME ? this.groupFieldType : 'string';\n\t\t\t\t}\n\t\t\t\tthis._setProperties(groupItem, this.groupProperties);\n\t\t\t\tresponse.push(groupItem);\n\t\t\t}\n\t\t\tresponse = response.concat(items);\n\t\t}\n\t\treturn response;\n\t}\n\n\t_get(obj, path) {\n\t\tif (!path)\n\t\t\treturn obj;\n\n\t\tlet parts = path.split('.');\n\t\tfor (let i = 0, l = parts.length; i < l; i++) {\n\t\t\tif(!obj[parts[i]])\n\t\t\t\tobj[parts[i]] = {};\n\t\t\tobj = obj[parts[i]];\n\t\t}\n\t\treturn obj;\n\t}\n\n\t_setProperties(item, properties, propertiesKey) {\n\t\tif(!properties)\n\t\t\treturn;\n\n\t\tif(propertiesKey) {\n\t\t\tif (!properties[propertiesKey])\n\t\t\t\treturn;\n\t\t\tproperties = properties[propertiesKey];\n\t\t}\n\n\t\tfor(let key in properties)\n\t\t\titem[key] = properties[key];\n\t}\n}","export class FieldHider {\n\n\tconstructor(hidden, toggle) {\n\t\tthis.toggle = toggle;\n\t\tif(typeof hidden === 'boolean')\n\t\t\tthis.hide = { hidden: hidden, type: 'hide' };\n\t\telse if(typeof hidden === 'object')\n\t\t\tthis.hide = { hidden: !!(hidden.hidden), type: hidden.type || 'hide'};\n\t\telse\n\t\t\tthis.hide = { hidden: false, type: 'hide' };\n\t}\n\n\tget hidden() {\n\t\treturn this.hide.hidden;\n\t}\n\n\tget type() {\n\t\treturn this.hide.type;\n\t}\n\n\tapplyTo(field) {\n\t\tlet types = [this.hide];\n\t\tif(this.type === 'hide')\n\t\t\ttypes.push( { hidden: false, type: 'invisible' } );\n\t\telse\n\t\t\ttypes.push( { hidden: false, type: 'hide' } );\n\n\t\tfor(let type of types)\n\t\t\tthis.toggle.toggleClass(type.type, type.hidden, field);\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetHandler {\n\n\tconstructor(fieldSets, desktop, tablet, phone) {\n\t\tthis.fieldSets = fieldSets;\n\t\tthis.desktopFields = {name: desktop};\n\t\tif(tablet)\n\t\t\tthis.tabletFields = {name: tablet};\n\t\tif(phone)\n\t\t\tthis.phoneFields = {name: phone};\n\t}\n\n\tgetByViewport(viewport) {\n\t\tif(viewport && viewport.isPhone())\n\t\t\treturn this._getPhoneFieldSet();\n\n\t\tif(viewport && viewport.isTablet())\n\t\t\treturn this._getTabletFieldSet();\n\n\t\treturn this._getDesktopFieldSet();\n\t}\n\n\t_getPhoneFieldSet() {\n\t\tlet fieldSet = this.phoneFields ? this.fieldSets[this.phoneFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getTabletFieldSet();\n\n\t\tthis.phoneFields.fields = fieldSet;\n\t\treturn this.phoneFields;\n\t}\n\n\t_getTabletFieldSet() {\n\t\tlet fieldSet = this.tabletFields ? this.fieldSets[this.tabletFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getDesktopFieldSet();\n\n\t\tthis.tabletFields.fields = fieldSet;\n\t\treturn this.tabletFields;\n\t}\n\n\t_getDesktopFieldSet() {\n\t\tthis.desktopFields.fields = this.fieldSets[this.desktopFields.name];\n\t\treturn this.desktopFields;\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Actions {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-actions';\n\t\tthis.properties = {\n\t\t\trowActions: Array,\n\t\t\t/** position - determine the component's position */\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'left'\n\t\t\t},\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** viewport - to determine what viewport it is */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'disableActions(data.disabledData.disabled)'\n\t\t];\n\t}\n\n\t/**\n\t * To initialize some values in the component\n\t *\n\t */\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tshouldDisable(index) {\n\t\t// Sorting table rows causes this to reevaluate and throw an error if the length of rowActions are unequal\n\t\tif (!this.data || !this.rowActions || !this.rowActions[index])\n\t\t\treturn;\n\t\treturn this.rowActions[index].title == 'Delete' && ((this.data.required && !this.data.addedManually) || (!!this.data.disabledData && this.data.disabledData.disabled));\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To attach the tapEvent which is defined from the caller\n\t *\n\t * @param e\n\t */\n\ttapEvent(e) {\n\t\tif (this.rowActions[e.currentTarget.dataIndex].onTapFunction && !this.shouldDisable(e.currentTarget.dataIndex)) {\n\t\t\tthis.rowActions[e.currentTarget.dataIndex].onTapFunction.bind(this)();\n\t\t}\n\t}\n\n\t_isVisible(invisible) {\n\t\treturn invisible ? 'visibilityHidden' : '';\n\t}\n\n\tdisplayTitle(action, index) {\n\t\treturn this.shouldDisable(index) ? 'Disabled' : this.i18n.l(action.title);\n\t}\n\n\t_isDisabled(index) {\n\t\treturn this.shouldDisable(index) ? 'disabled' : '';\n\t}\n\n\tdisableActions() {\n\t\tif (!this.$$('.sb-action-icon') || !this.rowActions)\n\t\t\treturn;\n\t\tfor (let i = 0; i < this.rowActions.length; i++) {\n\t\t\tthis.toggleClass('disabled', this.shouldDisable(i), this.$$('#_' + i));\n\t\t}\n\t}\n\n\t_configurationRequired(iconTitle) {\n\t\tif(!this.isMobile || !!this.data.configured) {\n\t\t\treturn '';\n\t\t}\n\n\t\tfor(let i = 0; i < this.rowActions.length; i++) {\n\t\t\tif(iconTitle === 'Configure' && this.rowActions[i].configurationRequired) {\n\t\t\t\treturn 'configurationRequired';\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Actions );","export class Badge {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-badge';\n\n\t\tthis.properties = {\n\t\t\tfor: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: '_changedFor'\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: '_changedLabel'\n\t\t\t}\n\t\t}\n\t}\n\n\tget target() {\n\t\tvar ownerRoot = this.parentNode;\n\t\tvar target;\n\n\t\tif (this.for) {\n\t\t\ttarget = Polymer.dom(ownerRoot).querySelector('#' + this.for);\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tattached() {\n\t\tthis._updateTarget();\n\t\tthis._setVisibility();\n\t}\n\n\t_setVisibility() {\n\t\tif (!this.label && !this.getAttribute(\"hidden\")) {\n\t\t\tthis.setAttribute(\"hidden\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"hidden\");\n\t\t}\n\t}\n\n\t_updateTarget() {\n\t\tthis._target = this.target;\n\t\tthis.updatePosition();\n\t}\n\n\tattributeChanged(name) {\n\t\tif (name === 'hidden') {\n\n\t\t}\n\t}\n\n\t_changedFor() {\n\t\tif (!this.isAttached) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateTarget();\n\t}\n\n\t_changedLabel() {\n\t\tthis.setAttribute('aria-label', this.label);\n\t\tthis._setVisibility();\n\t}\n\n\tupdatePosition() {\n\t\tvar targetRect, thisRect;\n\n\t\tif (!this._target) {\n\t\t\treturn;\n\t\t}\n\n\t\ttargetRect = this._target.getBoundingClientRect();\n\t\tthisRect   = this.getBoundingClientRect();\n\n\t\tvar top = thisRect.top - targetRect.top;\n\t\tthis.style.top = 0 - (top + targetRect.height / 2) + \"px\";\n\n\t\tvar left = (targetRect.right - thisRect.left) + 1;\n\t\tthis.style.left = left + \"px\";\n\t}\n}\n\nPolymer(Badge);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\nimport { localizeContent } from 'common/core/AppContext.js';\n\nexport class Dialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dialog';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmodal: {\n\t\t\t\t// when set to true, it will add a mask when dialog is toggled on\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_hideHeader'\n\t\t\t},\n\t\t\tappendedClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tcancelText: {\n\t\t\t\tType: String,\n\t\t\t\tvalue: 'Cancel',\n\t\t\t},\n\t\t\tcloseDialog: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-dialog'\n\t\t\t},\n\t\t\thideCloseIcon: { //controls if the X close icon should show on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelButton: { //controls the Cancel button on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif (PageContainer.getViewport())\n\t\t\t\t\t\treturn PageContainer.getViewport().isMobile() ? true : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tmobileDropDown: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttapDialog: String, // Event fired when dialog is tapped (optional)\n\t\t\tignoreMaskTap: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\tready() {\n\t\tif (this.appendedClass)\n\t\t\tthis.$$('.sbDialog').classList.add(this.appendedClass);\n\t\tif (this.mobile) {\n\t\t\tthis._appendMobileClasses();\n\t\t\tPolymer.dom(this).observeNodes(function() {\n\t\t\t\tlet buttons = Polymer.dom(this).querySelectorAll('paper-button');\n\t\t\t\tlet title = this.$$('#title');\n\t\t\t\tif (buttons.length === 0) {\n\t\t\t\t\tlet title = this.$$('#title');\n\t\t\t\t\tthis.toggleClass('no-buttons', true, title);\n\t\t\t\t} else {\n\t\t\t\t\tthis.mobileDropDown = buttons.length > 1 ? true : false;\n\t\t\t\t\tlet mobileButtons = this.$$('#mobileButtons');\n\t\t\t\t\tlet dropDownButton = this.$$('#drop-down-button');\n\t\t\t\t\tthis.toggleClass('no-buttons', false, title);\n\t\t\t\t\tthis.toggleClass('drop-down-menu', this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('single-button', !this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('hidden', !this.mobileDropDown, dropDownButton);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.toggleClass('is-ie', AppContext.isIE(), this.$.footer);\n\t}\n\n\t_appendMobileClasses() {\n\t\t// adds class mobile to style the component if the format is mobile\n\t\tthis.toggleClass('mobile', true, this.$$('.sbDialog'));\n\t\tlet children = Polymer.dom(this).children,\n\t\t\tnumChildren = children.length;\n\t\tfor (let i=0; i < numChildren; i++) {\n\t\t\tthis.toggleClass('mobile', true, children[i]);\n\t\t}\n\t}\n\n\ttoggle() {\n\t\tthis.show = !this.show;\n\t\tif (this.show) {\n\t\t\tthis.fire('sb-open-dialog');\n\t\t}\n\t}\n\n\topen() {\n\t\tthis.show = true;\n\t}\n\n\tclose() {\n\t\tthis.show = false;\n\t}\n\n\ttoggleMenu() {\n\t\tlet dropDownMenu = this.$$('.drop-down-menu');\n\t\tif (dropDownMenu && dropDownMenu.classList.contains('open'))\n\t\t\tthis.toggleClass('open', false, dropDownMenu);\n\t\telse\n\t\t\tthis.toggleClass('open', true, dropDownMenu);\n\t}\n\n\tonCloseDialog() {\n\t\tfireEvent(Events.PANEL_CLOSED);\n\t\t// pass in the event name with attr 'close-dialog' for the message you want to fire to close the dialog\n\t\tthis.fire(this.closeDialog);\n\t}\n\n\tmaskTapped() {\n\t\tif (!this.ignoreMaskTap)\n\t\t\tthis.onCloseDialog();\n\t}\n\n\ttapEvent() {\n\t\tif (this.tapDialog) {\n\t\t\tthis.fire(this.tapDialog);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the localized cancel button text\n\t * @param cancelText - The Cancel text for the Dialog component\n\t * @return {String}\n\t */\n\tgetCancelText(cancelText) {\n\t\treturn localizeContent(cancelText);\n\t}\n\n\t/***\n\t *\n\t * Adjust the date picker so that it can display under the date picker input box\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer;\n\t\tlet datepicker = e.detail.datepicker;\n\t\tlet content = this.$.content;\n\n\t\tdatepicker.style.position = 'fixed';\n\t\tlet dateContainerBoundingClientRect = dateContainer.getBoundingClientRect();\n\t\tlet contentBoundingClientRect = content.getBoundingClientRect();\n\n\t\tif (AppContext.isIE()) {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left - contentBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height - this.$.header.getBoundingClientRect().top + 1 + 'px';\n\t\t}\n\t}\n\n\t_hideHeader() {\n\t\tthis.$.header.setAttribute('hidden', 'true');\n\t}\n}\n\nPolymer( Dialog );","import {AppContext} from '../../core/AppContext.js';\n\nexport class Div {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-div';\n\t\tthis.properties = {\n\t\t\tvalue: String,\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_setLabel(value)'\n\t\t\t}\n\t\t}\n\t}\n\n\t_setLabel() {\n\t\t// leaving this computed function here for backwards API compatibility even though it doesn't do anything anymore.\n\t\t// it could be removed in the future if we ensure no user of this component ever tries to access the \"label\" property\n\t\treturn this.value;\n\t}\n}\n\nPolymer(Div);\n","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class FieldItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldDataObserver(item, model)',\n\t\t'_dataChangedObserver(data, item)'];\n\t}\n\n\n\t_setFieldDataObserver (item, model) {\n\t\tif (item === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setFieldData(item, model);\n\t}\n\t\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tthis.md = this.model[this.item];\n\t\tthis.label = this.md.label;\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\tthis.$.field.editing = this.md.updateable;\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_dataChangedObserver (data, item) {\n\t\tif (data === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._dataChanged(data, item);\n\t}\n\t\n\t_dataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(FieldItem);\n","export class FieldTable {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-table';\n\t\tthis.properties = {\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: String,\n\t\t\tmd: Object,\n\t\t\tdisabled: Boolean\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_generateColumnsObserver(md, fieldNames)'];\n\t}\n\n\t_generateColumnsObserver (md, fieldNames) {\n\t\tif (md === undefined || fieldNames === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.generateColumns(md, fieldNames);\n\t}\n\t\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tlet numFields = this.fieldNames.length;\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(this.fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(this.fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(this.fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n}\n\nPolymer(FieldTable);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class FilterItem {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\thidden: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\t\t\tdisplay: String,\n\t\t\tfactoryData: Object\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleKeyPress();\n\t\tthis.addEventListener('lookup-value-changed', this.handleLabelChange);\n\t}\n\n\thandleLabelChange(e) {\n\t\tlet data = {\n\t\t\titem: this.item.split('.')[0],\n\t\t\tvalue: e.detail.refDisplay\n\t\t};\n\t\tthis.fire('filter-item-value-changed', data);\n\t}\n\n\thandleKeyPress() {\n\t\tthis.addEventListener('keypress', function (e) {\n\t\t\tlet item = this.item.split('.')[0];\n\t\t\tthis.fire('filter-item-field-keypress', {keyCode: e.keyCode, item: item, itemType: this.model[item].model.type})\n\t\t}.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setMdObserver(item, model)',\n\t\t\t'setHidden(data.*)',\n\t\t\t'_dataChangedObserver(data, item)',\n\t\t\t'_displayChangedObserver(value, display, item, data, md)'\n\t\t];\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n\n\t_setMdObserver (item, model) {\n\t\tif (item === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setMd(item, model);\n\t}\n\t\n\tsetMd() {\n\t\tlet prefix = AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\tlet item = this.item.split('.')[0];\n\t\tthis.md = this.model[item].model;\n\t\tthis.factoryData = {range: this.model[item].record[prefix + 'Operator__c'] === 'between'};\n\t\tthis.label = this.model[item].label ? this.model[item].label : this.model[item].record.Name;\n\n\t\t//if this is filtering on a boolean field, the default value needs to be of type boolean\n\t\tif (this.md.type && this.md.type === 'boolean' && typeof this.value === 'string')\n\t\t\tthis.setValue(this.item, this.value === 'true');\n\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = this.md;\n\t}\n\n\tsetHidden() {\n\t\tlet item = this.item;\n\t\tif (!this.data[item])\n\t\t\titem = this.item.split('.')[0];\n\n\t\tif (this.data[item]) {\n\t\t\tthis.hidden = this.data[item].hidden;\n\t\t}\n\t}\n\n\t_dataChangedObserver (data, item) {\n\t\tif (data === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.dataChanged(data, item);\n\t}\n\t\n\tdataChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tthis.display = this.data[id].label;\n\n\t\t// set the sb-field record property to this to enable dependent pick list functionality\n\t\t// this class satisfies the contract of a sb-field record property because it implements the following functions: getValue, setValue, and equals\n\t\tthis.$.field.record = this;\n\t}\n\n\t_displayChangedObserver (value, display, item, data, md) {\n\t\tif (value === undefined || display === undefined || item === undefined || data === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._displayChanged(value, display, item, data, md);\n\t}\n\t\n\t_displayChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tlet rfm = new RelationshipFieldManager(id, this.data);\n\t\tlet relationship = rfm.buildRelationship(this.value, this.display, this.md.referenceTo[0]);\n\t\tif(relationship)\n\t\t\tthis.data[id].label = relationship.value.Name;\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tif (this.data[name])\n\t\t\treturn this.data[name].value;\n\t\telse\n\t\t\tfor (let process in this.data) {\n\t\t\t\tif (this.data[process].field === name)\n\t\t\t\t\treturn this.data[process].value;\n\t\t\t}\n\n\t\treturn null;\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(filterItem) {\n\t\treturn this.data === filterItem.data;\n\t}\n}\n\nPolymer(FilterItem);\n","import {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\n\nexport class FilterLayout extends Page {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilterPath: { //path in the search model for the search filters\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'searchFilters'\n\t\t\t},\n\t\t\tfilterKey: String,\n\t\t\tfilterDelegator: Object, //logic handler (suggester, searcher, filterer)\n\t\t\tsearchFilterData: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchFilterModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true //this is required for Safari to sync values between modal and panel\n\t\t\t},\n\t\t\tserviceLoader: String,\n\t\t\tquote: Object,\n\t\t\tenterCallback: Object,\n\t\t\ttranslationCallback: Object,\n\t\t\tserviceCallback: Object,\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tresultLimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 2000\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsearchContext: String\n\t\t}, Page.properties)\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_searchModelReadyObserver(searchModel, filterDelegator)'\n\t\t]\n\t}\n\n\tready() {\n\t\tthis.mdResponse(); //handle the field metadata response\n\t\tthis.handleEnterKeyPressed();\n\t}\n\n\thandleEnterKeyPressed() {\n\t\tthis.addEventListener('filter-item-field-keypress', function (e) {\n\t\t\t//if key is not enter, the callback is not a function, or if the item type is a reference, return; don't run filter\n\t\t\tif (e.detail.keyCode !== 13 || typeof this.enterCallback !== 'function' || e.detail.itemType === 'reference')\n\t\t\t\treturn;\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.enterCallback();\n\t\t\t}.bind(this),0)\n\t\t}.bind(this));\n\t}\n\n\t_searchModelReadyObserver (searchModel, filterDelegator) {\n\t\tif (searchModel === undefined || filterDelegator === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.searchModelReady(searchModel, filterDelegator);\n\t}\n\t\n\tsearchModelReady() {\n\t\t//only need to run this once\n\t\tif (this.searchModelInitialized === true)\n\t\t\treturn;\n\t\tthis.searchModelInitialized = true;\n\t\tif (this.filterKey === undefined)\n\t\t\tthis.filterKey = this.searchModel.hasCustomSearchFilters ? 'Id' : 'Name';\n\t\tlet properties = this.filterPath.split('.');\n\t\tthis.path = 'this.searchModel';\n\t\tfor (let property of properties) {\n\t\t\tthis.path += '.' + property;\n\t\t}\n\n\t\tlet searchFilters = eval(this.path);\n\n\t\tif (Array.isArray(searchFilters) === false) return;\n\n\t\tthis.searchFilterModel = FilterLayout.setVisibleDynamicSearchFilters(searchFilters, this.filterDelegator);\n\n\t\t// sets fields to display to user in the filter panel\n\t\tlet visibleFields = FilterLayout.setSearchFilterFields(this.searchFilterModel, this.getSearchTable());\n\t\tthis.fields = this.filterDelegator.buildFields(visibleFields);\n\t}\n\n\t/**\n\t * Given a set of search filters, this method makes sure that certain Dynamic\n\t * Filters are set to visible if one of them in the group is visible.\n\t *\n\t * Fixes a bug where dynamic filters would always be hidden.\n\t * Now shows the filter if any instance of that filter is not hidden.\n\t *\n\t * @param searchFilters All the search filters, including dynamic ones\n\t * @param delegator The Filter delegator\n\t *\n\t * @returns an object containing all search filters with the correct 'hidden'\n\t * properties set.\n\t */\n\tstatic setVisibleDynamicSearchFilters(searchFilters, delegator) {\n\t\tlet updatedSearchFilters = {};\n\t\tfor (let filter of searchFilters) {\n\t\t\tlet groupKey = delegator.getGroupKey(filter);\n\t\t\tlet duplicateFilter = updatedSearchFilters[groupKey];\n\t\t\tupdatedSearchFilters[groupKey] = filter;\n\t\t\tif (duplicateFilter && duplicateFilter.hidden === false)\n\t\t\t\tupdatedSearchFilters[groupKey].hidden = false;\n\t\t}\n\t\treturn updatedSearchFilters;\n\t}\n\n\t/**\n\t * Given a set of search filters, this method returns an array of visible\n\t * search filter fields.\n\t *\n\t * @param searchFilterModel An object containing all the search filters\n\t * and their visibility.\n\t * @param searchTable The search table\n\t *\n\t * @returns an array of visible search fields\n\t */\n\tstatic setSearchFilterFields(searchFilterModel, searchTable) {\n\t\tlet fields = [];\n\t\tfor (let key in searchFilterModel) {\n\t\t\tif (searchFilterModel[key].hidden === true) continue;\n\t\t\tfields.push(searchTable + '.' + searchFilterModel[key].targetFieldName);\n\t\t}\n\t\treturn fields;\n\t}\n\n\tmdResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet mdResponse = e.detail.value;\n\t\t\tif (mdResponse === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.setFilterValueMap(mdResponse);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Given a metadata response from the server, this method updates the search\n\t * filter models with the models returned from the server response. This\n\t * method also updates the groupItems values.\n\t *\n\t * @param mdResponse The metadata response object returned from server.\n\t */\n\tsetFilterValueMap(mdResponse) {\n\t\tif (this.searchFilterModel === undefined) return;\n\n\t\tlet groupItems = [];\n\t\tlet groupKeys = [];\n\n\t\tfor (let i in this.searchFilterModel) {\n\t\t\tif (this.searchFilterModel[i].hidden === true) continue;\n\t\t\tlet fieldName = this.searchFilterModel[i].targetFieldName;\n\t\t\tgroupItems.push(i + '.value');\n\t\t\tgroupKeys.push(i);\n\t\t\tthis.searchFilterModel[i].model = mdResponse.fieldsByObject[this.getSearchTable()][fieldName];\n\t\t}\n\n\t\t// groupItems notifies up and will set off a chain reaction of rebuilding a group when it doesn't have to\n\t\t// simple safe check to see if the groupItems are the same and only set if they are not\n\t\tif (JSON.stringify(this.groupItems) !== JSON.stringify(groupItems))\n\t\t\tthis.groupItems = groupItems;\n\n\t\tif (this.filterDelegator.skipDefaults && this.searchFilterData) return;\n\n\t\tthis.filterDelegator.setDefaultFilterValues(groupKeys, this.searchFilterModel).then(function(searchFilterData) {\n\t\t\t// Don't reset property if it already exists to avoid firing observers on child fields\n\t\t\tif (!this.searchFilterData)\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\tthis.filterDelegator.searchFilterModel = this.searchFilterModel;\n\t\t\tthis.filterDelegator.groupItems = this.groupItems;\n\t\t}.bind(this));\n\t}\n\n\tgetSearchTable() {\n\t\tif (this.searchModel === undefined)\n\t\t\treturn;\n\n\t\treturn this.filterDelegator.getSearchTable();\n\t}\n\n\tfocusFirstField() {\n\t\tif(!this.isMobile())\n\t\t\tthis.$.panel.applyFocusToItem(0);\n\t}\n\n\trunService() {\n\t\tif (this.serviceLoader === undefined || this.quote === undefined)\n\t\t\treturn;\n\n\t\tif (!this.noSpinner)\n\t\t\tthis.spinner = true;\n\n\t\tlet builderModel = FilterLayout.buildSearchModel(\n\t\t\tthis.filterDelegator,\n\t\t\tthis.getSearchContext(),\n\t\t\tthis.actionId,\n\t\t\tthis.resultLimit\n\t\t);\n\n\t\tif (this.sendQuoteRecord) {\n\t\t\tbuilderModel.addObject('quote', this.quote.record);\n\t\t} else {\n\t\t\tbuilderModel.addQuote('quote', this.quote);\n\t\t}\n\n\t\tlet context = builderModel.build();\n\n\t\treturn this.$.service.client.load(\n\t\t\tthis.prefix,\n\t\t\tthis.serviceLoader,\n\t\t\tnull,\n\t\t\tcontext\n\t\t).then(function (result) {\n\t\t\tif (typeof this.serviceCallback === 'function')\n\t\t\t\tthis.serviceCallback(result);\n\t\t\telse\n\t\t\t\tthis.searchModel = this.localizer ? this.localizer.localizeSearchModel(result) : result;\n\n\t\t\tthis.spinner = false;\n\t\t}.bind(this)).catch(function(error){\n\t\t\tthis.error = formatError(error);\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Given the filter delegator, search context, action, and result limit,\n\t * this method constructs a search model to send to the server side with\n\t * search data.\n\t *\n\t * @param delegator The filter delegator (searcher, suggester)\n\t * @param searchContext Context for the search\n\t * @param actionId\n\t * @param resultLimit Number of returns to return\n\t *\n\t * @returns a DataBuilder object that can be composed to push to the server\n\t */\n\tstatic buildSearchModel(delegator, searchContext, actionId, resultLimit) {\n\t\tlet model = new DataBuilder()\n\t\t\t.addObject('filterContext', delegator.getFilterContext(), undefined, undefined, true)\n\t\t\t.add('searchContext', searchContext)\n\t\t\t.add('additional', delegator.getAdditionalProperties())\n\t\t\t.add('actionId',  actionId)\n\t\t\t.add('resultLimit',  resultLimit);\n\n\t\t// if delegator is the suggester, getFieldSet() function doesn't exist, so return\n\t\tif (typeof delegator.getFieldSet !== \"function\") return model;\n\n\t\tlet fieldSet = delegator.getFieldSet();\n\t\tif (!fieldSet) return model;\n\n\t\tmodel.addObject('fieldSet', fieldSet);\n\t\treturn model;\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * SOSL requires a minimum of 2 characters to search\n\t * @returns {Object}\n\t */\n\tgetSearchContext() {\n\t\tif(this.searchContext === undefined)\n\t\t\treturn null;\n\t\treturn this.searchContext.length > 1 ? this.searchContext : null;\n\t}\n}\n\nPolymer(FilterLayout);","import {AppContext} from 'common/core/AppContext.js';\nimport { Events } from 'common/core/Events.js';\n\nconst quiet = typeof Visualforce !== 'undefined';\n\nexport class Group {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group';\n\t\tthis.properties = {\n\t\t\titem: String, // name of the component that represents an item in the group\n\t\t\tgroup: Array, // array of strings that represents the group\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each group item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupClass: String, // class string to be added the div that wraps the group items\n\t\t\titemClass: String, // class string to be added to each group item\n\t\t\tgroupDisplay: Object, // map whose keys match the group array and value is used for display purposes\n\t\t\tprimaryItems: { // if defined these named items are added to the front of the group only if they exist in the group\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tnumPrimary: { // used to determine the number of initial group items have the 'primary' class even if primaryItems is not yet defined\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tincludePrimaryInSecondary: { // if true will repeat the primary items in the secondary item set\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // used to tell each item in group it is a \"selected\" group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateSelected'\n\t\t\t},\n\t\t\tdisabled: { // used to tell each item in group it is a disabled group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateDisabled'\n\t\t\t},\n\t\t\t//when an items value is not a property on data, but a deep property like data.record.value,\n\t\t\t//you can set this to record. as the path prefix so the item is updated when the host data changes\n\t\t\t//specifically it's used when looping through the elements to find the item\n\t\t\tpathPrefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusIndex: { // index of group item you want to apply \"focus\"\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: 'updateFocusIndex'\n\t\t\t},\n\t\t\titemClassMap: { // map of attributes to classNames (used for adding classes only to the item that have the attributes)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\titemEditableMap: Object,\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tsignaler: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'updateSignaler'\n\t\t\t},\n\t\t\tnoDataPropagation: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.NAVIGATION_CHANGED] = this.navigationChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildGroupObserver(model, item, group, data, primaryItems, itemClassMap, columnWidths)',\n\t\t\t'_handlePrimaryEventsObserver(template, _primaryItems)',\n\t\t\t'propagateFromParentToChild(data.*)',\n\t\t\t'toggleItemClass(itemClassMap.*)',\n\t\t\t'_toggleEditableObserver(itemEditableMap, elements)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\t/**\n\t * Compare existing itemClassMap in the template against the current one\n\t * @returns {boolean} True if itemClassMap has changed, false otherwise. For performance reason, item class map is considered different only when the number of keys has differed.\n\t * @private\n\t */\n\t_itemClassMapChanged() {\n\t\tif (!this.template) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.template.itemClassMap !== null && this.itemClassMap === null) ||\n\t\t\t(this.template.itemClassMap === null && this.itemClassMap !== null) ||\n\t\t\t(Object.keys(this.template.itemClassMap).length !== Object.keys(this.itemClassMap).length);\n\t}\n\n\t/**\n\t * Update the class of existing item when itemClassMap indicates that the style has changed\n\t * @private\n\t */\n\t_updateItemClasses() {\n\t\tif (!this.template || !this.itemClassMap) {\n\t\t\treturn;\n\t\t}\n\t\tconst oldMap = this.template.itemClassMap;\n\t\tconst newMap = this.itemClassMap;\n\t\tconst fields = new Set(Object.keys(oldMap).concat(Object.keys(newMap)));\n\t\tfields.forEach((field) => {\n\t\t\tif (oldMap[field] !== this.itemClassMap[field]) {\n\t\t\t\tlet item = Polymer.dom(this.$.g).querySelector(`${this.item}[item='${field}']`);\n\t\t\t\tif (item) {\n\t\t\t\t\tif (oldMap && oldMap[field]) {\n\t\t\t\t\t\tlet classList = oldMap[field].class || oldMap[field];\n\t\t\t\t\t\tif (classList && typeof classList === 'string') {\n\t\t\t\t\t\t\titem.classList.remove(...classList.split(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (newMap && newMap[field]) {\n\t\t\t\t\t\tlet classList = newMap[field].class || newMap[field];\n\t\t\t\t\t\tif (classList && typeof classList === 'string') {\n\t\t\t\t\t\t\titem.classList.add(...classList.split(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.template.itemClassMap = newMap;\n\t}\n\n\t// when data is changed we need to inform each element that the value may also have been changed\n\t_updateItemValues(data) {\n\t\tif (this.elements && data) {\n\t\t\tlet dataKeys = Object.keys(data);\n\t\t\tthis.elements.forEach(function (element) {\n\t\t\t\tif (element.item && dataKeys.indexOf(element.item) > -1) {\n\t\t\t\t\telement.value = data[element.item];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t_buildGroupObserver (model, item, group, data, primaryItems, itemClassMap, columnWidths) {\n\t\tif (model === undefined || item === undefined || group === undefined || data === undefined || \n\t\t\tprimaryItems === undefined || itemClassMap === undefined || columnWidths === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildGroup(model, item, group, data, primaryItems, itemClassMap, columnWidths);\n\t}\n\t\n\tbuildGroup(model, item, group, data, primaryItems, itemClassMap, columnWidths) {\n\t\tthis.initInternalGroupAndPrimaryItems();\n\t\tif (this.template) {\n\t\t\t// If the group is unchanged, we need to only reset the data and the model\n\t\t\tif (this.template.group === this._group) {\n\t\t\t\tthis.template.selected = this.selected;\n\t\t\t\tthis.template.disabled = this.disabled;\n\t\t\t\tthis.template.data = data;\n\t\t\t\tthis.template.model = model;\n\t\t\t\tthis._updateItemValues(data);\n\t\t\t\t// W-6308988 - in Edge browser we need to wait for DOM rendering before updating item class\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\t\tif (columnWidths && (this.template.columnWidths != columnWidths)) {\n\t\t\t\t\t\tthis._updateColumnWidths();\n\t\t\t\t\t}\n\t\t\t\t\tif (this._itemClassMapChanged()) {\n\t\t\t\t\t\tthis._updateItemClasses();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else if(!quiet)\n\t\t\t\tconsole.error(`Rebuilding a group is no longer supported. Called by ${this.domHost.tagName.toLowerCase()}: old group [${this.template.group}], new group [${this._group}]`);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.expanded = false;\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis.template.group = this._group;\n\t\tthis.template.selected = this.selected;\n\t\tthis.template.disabled = this.disabled;\n\t\tthis.template.signaler = this.signaler;\n\t\tthis.template.model = model;\n\t\tthis.template.data = data;\n\t\tthis.template.columnWidths = columnWidths;\n\t\tthis.template.tabIndex = this.tabIndex;\n\t\tthis.template.itemClassMap = this.itemClassMap;\n\t\tthis.buildItems(this.template);\n\t\tPolymer.dom(this.$.g).appendChild(this.template);\n\n\t\tif(this.noDataPropagation)\n\t\t\treturn;\n\n\t\t// observe for when the child elements are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.g).observeNodes(function (info) {\n\t\t\tif (info.addedNodes[0])\n\t\t\t\tthis.bindElementEvents(Polymer.dom(info.addedNodes[0]).childNodes);\n\t\t}.bind(this));\n\t}\n\n\tdestroyGroup() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis.elements = null;\n\t\t\tPolymer.dom(this.$.g).removeChild(this.template);\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.group = undefined;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_updateColumnWidths() {\n\t\tif(!this.columnWidths)\n\t\t\treturn;\n\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t// In Safari and FF, items are not yet rendered sometimes. Wait for rendering to complete, if that's the case.\n\t\tif (!items || items && items.length == 0) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t\t\tthis._setColumnWidths(items);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._setColumnWidths(items);\n\t\t}\n\n\t}\n\n\t_setColumnWidths(items) {\n\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i],\n\t\t\t\tfieldName = item.getAttribute('item');\n\t\t\tlet columnWidth = this.columnWidths[fieldName];\n\t\t\tif (columnWidth == null)\n\t\t\t\tcontinue;\n\n\t\t\tlet width = columnWidth.width || columnWidth;\n\t\t\tif(width == null)\n\t\t\t\tcontinue;\n\n\t\t\t// by default set min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\t\tlet props = columnWidth.properties || ['minWidth', 'maxWidth'];\n\t\t\tlet unit = columnWidth.unit || 'px';\n\t\t\tfor(let prop of props)\n\t\t\t\titem.style[prop] = width + unit;\n\t\t}\n\t}\n\n\t_createColumnWidthStyleHtml(columnWidth) {\n\t\tlet html = ' style' + '=\"';\n\t\tlet width = columnWidth.width || columnWidth;\n\t\t// Setting min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\tlet properties = columnWidth.properties || ['min-width', 'max-width'];\n\t\tlet unit = columnWidth.unit || 'px';\n\t\tfor(let property of properties)\n\t\t\thtml += property + ':' + width + unit + ';';\n\t\treturn html;\n\n\t}\n\n\tupdateSelected() {\n\t\tif (this.template)\n\t\t\tthis.template.selected = this.selected;\n\t}\n\n\tupdateDisabled() {\n\t\tif (this.template)\n\t\t\tthis.template.disabled = this.disabled;\n\t}\n\n\tupdateSignaler() {\n\t\tif (this.template)\n\t\t\tthis.template.signaler = this.signaler;\n\t}\n\n\tapplyFocusToItem(focusIndex) {\n\t\tthis.focusIndex = undefined;\n\t\tthis.focusIndex = focusIndex;\n\t}\n\n\tupdateFocusIndex() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tif(!this.elements)\n\t\t\treturn;\n\n\t\tif(this.focusIndex === undefined || this.focusIndex < 0)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.template.group.length; i < l; i++) {\n\t\t\tthis.template[`focus_${i}`] = false;\n\t\t\tif(this.focusIndex === i)\n\t\t\t\tthis.template[`focus_${i}`] = true;\n\t\t}\n\t}\n\n\tinitInternalGroupAndPrimaryItems() {\n\t\t// the internal group property is the provided group with any applicable primary items concatenated to the front of the group\n\t\tthis._group = this.group;\n\n\t\t// the internal primaryItems property is the provided primary items normalized against the group itself\n\t\tthis._primaryItems = undefined;\n\n\t\t// if primary items is not defined or an empty array then we are done\n\t\tif (!this.primaryItems || this.primaryItems.length === 0)\n\t\t\treturn;\n\n\t\tlet primaryItems = [].concat(this.primaryItems);\n\n\t\t// if first primary item is not on group, then use the first item in group instead\n\t\tif(this.group.indexOf(primaryItems[0]) === -1)\n\t\t\tprimaryItems[0] = this.group[0];\n\n\t\t// if second primary item is not on group, then just simply remove\n\t\t// we do not support more then 2 primary items\n\t\tif(primaryItems.length > 1) {\n\t\t\tif(this.group.indexOf(primaryItems[1]) === -1)\n\t\t\t\tprimaryItems = [primaryItems[0]];\n\t\t\telse\n\t\t\t\tprimaryItems = [primaryItems[0], primaryItems[1]];\n\t\t}\n\n\t\t// at least one provided primary item was in the group, so lets ensure the primary items are in the front of the group\n\t\tthis._primaryItems = primaryItems;\n\t\tif(this.includePrimaryInSecondary) {\n\t\t\t// if include primary in secondary, then simply append the primary to the group and we are done\n\t\t\tthis._group = primaryItems.concat(this.group);\n\t\t\tthis._normalizeWithTemplateGroup();\n\t\t\treturn;\n\t\t}\n\n\t\t// we do not want to repeat primary, so lets create secondary list from group by filtering out primaryItems\n\t\tlet secondary = this.group.filter(function (item) {\n\t\t\treturn primaryItems.indexOf(item) === -1;\n\t\t});\n\n\t\t// simply append primary with secondary and call it a day\n\t\tthis._group = primaryItems.concat(secondary);\n\t\tthis._normalizeWithTemplateGroup();\n\t}\n\n\tbuildItems(template) {\n\t\tvar doc = template.content.ownerDocument;\n\t\tvar root = doc.createElement('div');\n\t\tif (this.groupClass)\n\t\t\tPolymer.dom(root).setAttribute('class', this.groupClass);\n\n\t\tlet numPrimary = this.numPrimary > 0 ? this.numPrimary : (this._primaryItems ? this._primaryItems.length : 0);\n\t\tthis._group.forEach(function (item, index) {\n\t\t\tlet html = '<' + this.item + ' ' + 'item=\"' + item + '\" value=\"{{data.' + item + '}}\" model=\"[[model]]\" data=\"[[data]]\" disabled=\"[[disabled]]\" selected=\"[[selected]]\" focus=\"[[focus_' + index + ']]\" index=\"' + index + '\"';\n\n\t\t\tlet isPrimary = index < numPrimary;\n\n\t\t\tif (!isPrimary && this.groupDisplay && this.groupDisplay[item]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item] + '\"';\n\t\t\t} else if (!isPrimary && this.groupDisplay && this.groupDisplay[item.split(\".\")[1]]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item.split(\".\")[1]] + '\"';\n\t\t\t}\n\n\n\t\t\tlet classes = '';\n\t\t\tif (this.itemClass)\n\t\t\t\tclasses += this.itemClass + ' ';\n\n\t\t\tif (isPrimary) {\n\t\t\t\tclasses += index === 0 ? 'primary first' : 'primary multi';\n\t\t\t\tclasses += this.selected ? ' selected' : '';\n\t\t\t} else if (numPrimary > 0) {\n\t\t\t\tclasses += 'secondary';\n\t\t\t}\n\n\t\t\tif (this.itemClassMap && this.itemClassMap[item]) {\n\t\t\t\tclasses += ' ' + (this.itemClassMap[item].class || this.itemClassMap[item]);\n\t\t\t\tif(this.itemClassMap[item].style)\n\t\t\t\t\thtml += ` style=\"${this.itemClassMap[item].style}\"`;\n\t\t\t}\n\n\t\t\tif (classes)\n\t\t\t\thtml += ' class' + '=' + '\"' + classes + '\"';\n\n\t\t\tlet columnWidth = this.columnWidths ? this.columnWidths[item] : null;\n\t\t\tif (columnWidth != null)\n\t\t\t\thtml += this._createColumnWidthStyleHtml(columnWidth);\n\n\t\t\tif(this.tabIndex != null)\n\t\t\t\thtml += ' tab-index=\"[[tabIndex]]\"';\n\n\t\t\thtml += ' signaler=\"[[signaler]]\"></' + this.item + '>';\n\t\t\tlet div = doc.createElement('div');\n\n\t\t\tdiv.innerHTML = html;\n\n\t\t\tPolymer.dom(root).appendChild(Polymer.dom(div).firstChild);\n\t\t}.bind(this));\n\t\tPolymer.dom(template.content).appendChild(root);\n\t}\n\n\tbindElementEvents(elements) {\n\t\t//this is needed for Safari and FireFox to have a handle of this in the callbacks\n\t\tthis.elements = elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tthis.updateFocusIndex();\n\n\t\tthis.propagateValueToParent = this.propagateValueToParent || function (e) {\n\t\t\t\t//the internal property will protect against the parent observer if it has a parent property called data\n\t\t\t\tthis.internal = true;\n\t\t\t\tthis.set('data.' + e.target.item, e.detail.value);\n\t\t\t\tif(this.childToParentExtension)\n\t\t\t\t\tthis.childToParentExtension( { path: 'data.' + e.target.item, value: e.detail.value } );\n\t\t\t\tthis.internal = false;\n\t\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\telements[i].removeEventListener('value-changed', this.propagateValueToParent);\n\t\t\telements[i].addEventListener('value-changed', this.propagateValueToParent);\n\t\t}\n\t}\n\n\tpropagateFromParentToChild(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tif (e.path === 'data')\n\t\t\treturn;\n\n\t\tif(this.propagateFromParentToChildOverride) {\n\t\t\tthis.propagateFromParentToChildOverride(e);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._propagateFromParentToChild(e);\n\t}\n\n\t_propagateFromParentToChild(e) {\n\t\t//Chrome and FireFox do not have access to element or numElements outside this callback\n\t\tvar elements = this.elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\t//looking for the item in the elements to apply the value to\n\t\tvar parts = e.path.split('.');\n\t\tvar item = this.pathPrefix + parts[parts.length - 1];\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\tif (elements[i].item === item) {\n\t\t\t\telements[i].value = e.value;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t_handlePrimaryEventsObserver (template, _primaryItems) {\n\t\tif (template === undefined || _primaryItems === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.handlePrimaryEvents(template, _primaryItems);\n\t}\n\t\n\thandlePrimaryEvents() {\n\t\tif (this.primaryEventsResistered)\n\t\t\treturn;\n\n\t\tthis.addEventListener('group-selected', function (e) {\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item + '.primary');\n\t\t\tfor (var i = 0, l = items.length; i < l; i++)\n\t\t\t\tthis.toggleClass('selected', e.detail.selected, items[i]);\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('group-expanded', function (e) {\n\t\t\tlet primary = e.detail.path.filter(function (node) {\n\t\t\t\tlet el = Polymer.dom(node);\n\t\t\t\tlet tagName = el.node.tagName ? el.node.tagName.toLowerCase() : '';\n\t\t\t\treturn tagName === this.item && el.classList.contains('primary');\n\t\t\t}.bind(this));\n\n\t\t\tif (!primary || primary.length === 0)\n\t\t\t\treturn;\n\n\t\t\tthis.toggleClass('initial', false, primary[0]);\n\t\t\tthis.expanded = !this.expanded;\n\t\t\t// toggle the expanded property on the host in case it needs it\n\n\t\t\tif (this.domHost) {\n\t\t\t\tthis.domHost.expanded = !this.domHost.expanded;\n\t\t\t}\n\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item);\n\t\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\t\tlet itemField = items[i].$$('sb-field');\n\t\t\t\tif(itemField) itemField.renderReadOnly = false;\n\t\t\t\tthis.toggleClass('expanded', this.expanded, items[i]);\n\t\t\t}\n\t\t\t// Caught in swipe-container\n\t\t\tthis.fire('expanded-changed', {expanded: this.expanded});\n\t\t}.bind(this));\n\t\tthis.primaryEventsResistered = true;\n\t}\n\n\tnavigationChanged() {\n\t\tthis.fire('group-selected', {selected: false}, {bubbles: false});\n\t}\n\n\toverridePropagateFromParentToChild(propagateFromParentToChildOverride) {\n\t\tif (typeof propagateFromParentToChildOverride !== 'function')\n\t\t\treturn;\n\n\t\tthis.propagateFromParentToChildOverride = propagateFromParentToChildOverride;\n\t}\n\n\tsetFromChildToParentExtension(childToParentExtension) {\n\t\tif (typeof childToParentExtension !== 'function')\n\t\t\treturn;\n\n\t\tthis.childToParentExtension = childToParentExtension;\n\t}\n\n\t/**\n\t * \tObserve changes to this.itemClassMap.*\n\t * \te.value should be an array of objects with the properties \"class\" and \"value\"\n\t */\n\ttoggleItemClass(e) {\n\t\tlet parts = e.path.split('.');\n\t\tif(parts.length === 1)\n\t\t\treturn; // Don't care about changes to itemClassMap itself, just its members\n\n\t\tlet path = parts[1];\n\t\tfor(let element of this.elements) {\n\t\t\t\tif (element.item === path) {\n\t\t\t\t\tfor(let i = 0, l = e.value.length; i < l; i++)\n\t\t\t\t\t\telement.toggleClass(e.value[i].class, e.value[i].value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\t_toggleEditableObserver (itemEditableMap, elements) {\n\t\tif (itemEditableMap === undefined || elements === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.toggleEditable(itemEditableMap, elements);\n\t}\n\t\n\t/**\n\t * Observer for changes to this.itemEditableMap.* which is just a map of\n\t * field name to an 'editable' flag.\n\t *\n\t * @param {Object} editableMap - a map of editable object fields\n\t * @param {Array} elements - an array of child DOM elements\n\t */\n\ttoggleEditable(editableMap, elements) {\n\t\t// Don't care about changes to editableMap itself, just its members\n\t\tif (!editableMap || !elements) return;\n\n\t\telements.map(function(e) {\n\t\t\tif (editableMap[e.item] != null)\n\t\t\t\te.editable = editableMap[e.item]\n\t\t});\n\t}\n\n\t_normalizeWithTemplateGroup() {\n\t\tif(!this.template || !this.template.group)\n\t\t\treturn; // template.group not defined so bail\n\n\t\tif(this.template.group.length !== this._group.length)\n\t\t\treturn; // template.group not same length as _group so bail\n\n\t\tfor(var i = 0, l = this._group.length; i < l; i++) {\n\t\t\tif(this.template.group[i] !== this._group[i])\n\t\t\t\treturn; // we found an element that is not the same, so bail\n\t\t}\n\t\t// template.group is same as _group, so lets assign it as such\n\t\tthis._group = this.template.group;\n\t}\n\n\t/**\n\t * Readjust the date picker position while opening\n\t *\n\t * @param e\n\t * @private\n\t */\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker;\n\n\t\t// This line is required because datepicker is someone receiving an inline style position of fixed\n\t\tdatepicker.style.position = 'absolute';\n\t\tlet dateRow = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\n\t\t// If there isn't enough space to display the right-side of the calendar, we align it to the right\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\t}\n}\n\nPolymer(Group);\n","import {DEFAULT_WIDTH} from 'common/layout/tables/ImageCellSizer.js';\nimport {DEFAULT_HEIGHT} from 'common/layout/tables/ImageCellSizer.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst CHECKBOX = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC';\nconst CHECKBOX_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==';\n\nexport class Html {\n\n\tconstructor(component) {\n\t\tif(component) {\n\t\t\tthis.$ = component.$;\n\t\t\tthis.$$ = Polymer.dom(component.root).querySelector.bind(Polymer.dom(component));\n\t\t\tthis.viewport = PageContainer.getViewport();\n\t\t}\n\t}\n\n\tsanitizeAndSetInnerHTML() {\n\t\tif(this.isNil()) {\n\t\t\t// adding styles inline on image tag itself because in FF it did now work when added as CSS\n\t\t\tlet blankImage = '<img id=\"blank\" src=\"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" style=\"width:50%; height:17px\"/>';\n\t\t\tlet useImage = !this.link && !this.isMobile();\n\t\t\t// use blank image in desktop for editable empty cells to allow the empty cell to be clicked on for editing\n\t\t\tthis.$.me.innerHTML = useImage ? blankImage : '';\n\t\t\treturn;\n\t\t}\n\n\t\t// add checkbox image based on the boolean value if non null\n\t\tif(this.booleanValue != null) {\n\t\t\tlet checkboxBase64 = this.booleanValue ? CHECKBOX_CHECKED : CHECKBOX;\n\t\t\tif(this.isDirty)\n\t\t\t\tcheckboxBase64 = this.booleanValue ? CHECKBOX_CHECKED_DIRTY : CHECKBOX_DIRTY;\n\t\t\tthis.$.me.innerHTML = '<img id=\"checkbox\" src=\"data:image/png;base64,' + checkboxBase64 +'\"/>';\n\t\t\treturn;\n\t\t}\n\n\t\tif ((this.type === 'string' || this.type === 'textarea') && Html.containsMarkup(this.value) ) {\n\t\t\t// innerHTML is raw, we need to sanitize it ourselves\n\t\t\tthis.$.formatted.style.padding = \"2px 0\";\n\t\t\tthis.$.me.innerHTML = Html.sanitizeHtmlText((this.value + '').trim());\n\t\t} else {\n\t\t\t// textContent is sanitized by the browser\n\t\t\tthis.$.formatted.style.padding = \"2px 0\";\n\t\t\tthis.$.me.textContent = (this.value + '').trim();\n\t\t}\n\t\tthis.handleDefaultSizeIfImage();\n\t}\n\n\tstatic containsMarkup(value) {\n\t\treturn /(<[a-z][\\s\\S]*>)|(&[^\\s]*;)/.test(value);\n\t}\n\n\thandleDefaultSizeIfImage() {\n\t\t// width could either be on the image's style attribute or its width attribute\n\t\t// only if its not on either will we set the default width\n\t\tlet imageNoWidth = this.$$('#me img:not([style*=width])');\n\t\tif(imageNoWidth)  // width not on style attribute, so to be sure check if not on width attribute\n\t\t\timageNoWidth = this.$$('#me img:not([width])');\n\n\t\tif(imageNoWidth)\n\t\t\tPolymer.dom(imageNoWidth).setAttribute('width', DEFAULT_WIDTH);\n\n\t\t// height could either be on the image's style attribute or its height attribute\n\t\t// only if its not on either will we set the default height\n\t\tlet imageNoHeight = this.$$('#me img:not([style*=height])');\n\t\tif(imageNoHeight)  // height not on style attribute, so to be sure check if not on height attribute\n\t\t\timageNoHeight = this.$$('#me img:not([height])');\n\n\t\tif(imageNoHeight)\n\t\t\tPolymer.dom(imageNoHeight).setAttribute('height', DEFAULT_HEIGHT);\n\t}\n\n\tisNil() {\n\t\treturn (this.value == null || (this.value + '').trim() === '') && this.booleanValue == null;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tclearTabIndex() {\n\t\tthis._tabindex = this.tabindex;\n\t\tthis.tabindex = undefined;\n\t}\n\n\trestoreTabIndex() {\n\t\tthis.tabindex = this._tabindex;\n\t}\n\n\t/**\n\t * Sanitizes the innerHTML.\n\t * It only allows the Tags stated in allowedTags and attributes stated in allowedAttributes. Some tags and attributes\n\t * are allowed by default and they can be found in the HtmlSanitizer.js\n\t *\n\t * @param v\n\t * @return {String}\n\t */\n\tstatic sanitizeHtmlText(v) {\n\t\tif(!v) {\n\t\t\treturn v;\n\t\t}\n\t\treturn sanitizeHtml(v, {\n\t\t\tallowedTags: sanitizeHtml.defaults.allowedTags.concat(['div', 'img', 'span', 'sub', 'sup', 'u', 's', 'h1', 'h2', 'h3']),\n\t\t\tallowedAttributes: {\n\t\t\t\tdiv:['style', 'class'],\n\t\t\t\timg:['src', 'height', 'width', 'alt', 'border', 'align', 'style'],\n\t\t\t\ta:['href', 'name', 'target', 'title'],\n\t\t\t\tspan:['style'],\n\t\t\t\tp:['style'],\n\t\t\t\tli:['style'],\n\t\t\t\tem:['style'],\n\t\t\t\tu:['style'],\n\t\t\t\ts:['style'],\n\t\t\t\tsub:['style'],\n\t\t\t\tsup:['style'],\n\t\t\t\tstrong:['style'],\n\t\t\t},\n\t\t\tparser: {decodeEntities: false}\n\t\t});\n\t}\n}\n","import {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Component for creating a list from a SearchModel.\n *\n */\n\nconst MAX_NUM_RESULTS_TO_SELECT_ALL = 100;\n\nexport class LookupLayout {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior, Polymer.IronScrollTargetBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-layout';\n\t\tthis.properties = {\n\t\t\tselectedRows: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchModel: Object,\n\t\t\ttotalCount: { //let the host know the total count of rows\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasTotalCount: { //let the host know if there is a count because polymer can't evaluate expressions in bindings\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmaxSelectAll: Number,\n\t\t\tselectionIdDataPath: String, //the path passed to row for where the record ID is\n\t\t\tparentAttributesPath: String,\n\t\t\tadditionalFields: Array, //additional fields to show on list not in the SearchModel,\n\t\t\tfieldPrefix: { // TODO: add good comment\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tgroupByField: String, //results can be grouped by this field\n\t\t\tgroupByFieldType: String, //type of field that results are being grouped by\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tprimaryMobileCols: Array,\n\t\t\t_primaryMobileColumns: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_getPrimaryMobileCols(primaryMobileCols, fieldSet)'\n\t\t\t},\n\t\t\trowsByGrouper: Object,\n\t\t\tgroups: Array,\n\t\t\tviewResultsIndexById: Object,\n\t\t\tviewResultsIds: Object,\n\t\t\theaderSelectionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isDisableHeaderSelection(viewResults)'\n\t\t\t},\n\t\t\theaderSelectionTooltip: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_getHeaderSelectionTooltip(headerSelectionDisabled)'\n\t\t\t},\n\t\t\tmobileRowDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tkeyPressed:  {\n\t\t\t\tType: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlastClickedIndex: {\n\t\t\t\tType: Number\n\t\t\t},\n\t\t\tnoResultsMessage: String,\n\t\t\t_hasViewResults: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_computeHasViewResults(_viewResults)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setViewResultsObserver(searchModel, fieldSet, groupByFieldType)',\n\t\t\t'initFieldMetadata(searchModel)',\n\t\t\t'updateTotalCount(searchModel.totalCount)',\n\t\t\t'setDisplayResults(viewResults)',\n\t\t\t'indexViewResults(viewResults)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis._setupKeyPressListeners();\n\t\tthis.handleAllRowsSelected();\n\t\tthis.handleOneRowSelected();\n\t\tthis.handleMetaDataResponse();\n\t\tthis.addEventListener('sb-mobile-row-expanded', this.expandMobileRow.bind(this));\n\t\tthis.addEventListener('sb-mobile-row-selected', this.selectMobileRow.bind(this));\n\t\tthis.addEventListener('sb-row-group-tapped', this.expandRowEventHandler.bind(this));\n\t\t// mixed in IronScrollTargetBehavior will now delegate to _scrollHandler function when the element assigned to the below scrollTarget property is scrolled\n\t\tthis.scrollTarget = this.$.tbody;\n\t}\n\n\t_setupKeyPressListeners() {\n\t\t//check other browsers, try keyCode\n\t\twindow.addEventListener('keydown', function(e) {\n\t\t\tthis.keyPressed[e.keyCode] = true;\n\t\t}.bind(this));\n\n\t\twindow.addEventListener('keyup', function(e) {\n\t\t\tdelete this.keyPressed[e.keyCode];\n\t\t}.bind(this));\n\t}\n\n\t_computeHasViewResults(_viewResults) {\n\t\treturn _viewResults && _viewResults.length > 0;\n\t}\n\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.initRecordKeysFieldLabelsAndTypeMap(e.detail.value.fields);\n\t\t}.bind(this));\n\t}\n\n\tinitFieldMetadata() {\n\t\tthis.deSelectAll();\n\t\tif(this.fieldMetadataInitialized)\n\t\t\treturn;\n\t\tthis.$.md.object = this.searchModel.targetObjectName;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.searchModel, 'resultFieldNames', 'resultFieldNamesTablet', 'resultFieldNamesPhone');\n\t\tthis.setFieldMetadata();\n\t\tthis.fieldMetadataInitialized = true;\n\t}\n\n\tsetFieldMetadata() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.$.md.name === this.fieldSet.name)\n\t\t\treturn false;\n\n\t\tthis.$.md.fields = undefined;\n\t\tthis.$.md.name = this.fieldSet.name;\n\n\t\tlet metadataFields = this.fieldSet.fields;\n\n\t\t//caller provides fields from field set\n\t\tif (Array.isArray(this.additionalFields))\n\t\t\tmetadataFields = this.fieldSet.fields.concat(this.additionalFields);\n\n\t\tif(this.groupByField && metadataFields.indexOf(this.groupByField) === -1) {\n\t\t\t//adds the field to group by into the field set to get its metadata\n\t\t\tmetadataFields = [this.groupByField].concat(metadataFields);\n\t\t}\n\n\t\tthis.$.md.fields = metadataFields;\n\t}\n\n\tinitRecordKeysFieldLabelsAndTypeMap(fields) {\n\t\tlet recordKeys = [],\n\t\t\tfieldLabels = [],\n\t\t\tfieldLabelMap = {},\n\t\t\tmdMap = {},\n\t\t\tlabelTypeMap = {},\n\t\t\titemTypeMap = {},\n\t\t\tcolumnWidths = {},\n\t\t\tlabelWidths = {};\n\n\t\tfields.forEach(function (field, idx) {\n\t\t\tif(this.groupByField === field.name) {\n\t\t\t\tthis.groupByFieldType = field.type;\n\t\t\t\t//ignores the field to group by from the field set if it wasn't originally included\n\t\t\t\tif(this.fieldSet.fields.indexOf(field.name) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//TODO: this unit price thing isn't going to work...\n\t\t\tlet key = field.name === 'UnitPrice' ? field.name : (this.fieldPrefix + field.name);\n\t\t\trecordKeys.push(key);\n\t\t\tfieldLabels.push(field.label);\n\t\t\tfieldLabelMap[key] = field.label;\n\t\t\tmdMap[key] = field;\n\t\t\tif (field.type.toLowerCase() === 'currency')\n\t\t\t\tmdMap[key].CurrencyIsoCode = this.currencyIsoCode;\n\n\t\t\tlet type = field.type;\n\t\t\tif (!this.isMobileViewport()) {\n\t\t\t\t// returns undefined if cell is not an image\n\t\t\t\tlet imageWidth = new ImageCellSizer(field).getImageWidth(20);\n\t\t\t\tif (imageWidth) {\n\t\t\t\t\tlet width = { width: imageWidth, properties: ['width'] };\n\t\t\t\t\tcolumnWidths[key] = width;\n\t\t\t\t\tlabelWidths[idx] = width;  // use idx as key as that is what sb-table-header wants\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = type;\n\t\t\titemTypeMap[key] = type;\n\t\t}.bind(this));\n\n\t\tif(this.groupByFieldType === undefined) {\n\t\t\t//must define value to kick off setViewResults observer method\n\t\t\tthis.groupByFieldType = null;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap, null, true).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.columnWidths = columnWidths;\n\t\tthis.labelWidths = labelWidths;\n\t\tthis.mdMap = mdMap;\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\thandleAllRowsSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function (e) {\n\t\t\tthis.selectAllClicked = true;\n\t\t\tlet selected = e.detail.selected;\n\t\t\tthis.toggleRowSelections(selected);\n\t\t\tthis.selectAllClicked = false;\n\t\t}.bind(this));\n\t}\n\n\ttoggleRowSelections(selected, group, range) {\n\t\tlet processed = [];\n\n\t\t// toggle through all the rows stamped into the DOM and select them\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\t// lets record here that we have processed this record via its stamped in row in the DOM\n\t\t\t\tlet recordId = row.get('rowData.' + this.selectionIdDataPath);\n\t\t\t\tprocessed.push(recordId);\n\n\t\t\t\t//skip row is outside of multi-select range\n\t\t\t\tif (range && (row.index < range.start || row.index > range.end))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if toggling selections of a specific group, make sure this row is a groupie of the selected group\n\t\t\t\tif (group != null && (row.grouper || (row.groupie && row.groupie !== group)))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// filtered out rows are still in dom (even though not visible)\n\t\t\t\t// so need to make sure this row's record id matches a valid view result\n\t\t\t\tif(!this._isValidViewResultId(recordId))\n\t\t\t\t\tcontinue;\n\n\t\t\t\trow.selected = selected;\n\t\t\t}\n\t\t}\n\n\t\t// since some viewResults may not be stamped into the DOM as rows because of iron-list,\n\t\t// lets iterate over the applicable unprocessed viewResults and select them\n\t\tlet viewResults = group != null ? this.rowsByGrouper[group] : this.viewResults;\n\t\tif(viewResults == null)\n\t\t\treturn;\n\n\t\tif (!range)\n\t\t\trange = {start: 0, end: viewResults.length - 1};\n\n\t\tfor(let i = range.start; i <= range.end; i++) {\n\t\t\tlet viewResult = viewResults[i];\n\t\t\tlet recordId = this.get('record.' + this.selectionIdDataPath, viewResult);\n\n\t\t\t// first check if we already processed this record, if so continue\n\t\t\tif(processed.indexOf(recordId) !== -1)\n\t\t\t\tcontinue;\n\n\t\t\t// lets select this record manually\n\t\t\tlet attributes = this.parentAttributesPath === undefined ? undefined : this.get('record.' + this.parentAttributesPath, viewResult);\n\t\t\tthis.selectOneRow(selected, recordId, viewResult.record, attributes, viewResult.grouper);\n\t\t}\n\t}\n\n\thandleOneRowSelected() {\n\t\t// listen for selection changes to the list\n\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\t//removes text highlighting that happens when shift clicking in a document\n\t\t\tdocument.getSelection().removeAllRanges();\n\t\t\tif (!this.selectAllClicked)\n\t\t\t\tthis.handleRangeSelection(e);\n\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\t\t\tlet recordId = e.detail.Id; // the id of the record that was just selected or unselected\n\t\t\tlet group = e.detail.group;\n\t\t\tlet autoSelectGroupRows = e.detail.autoSelectGroupRows;\n\t\t\tthis.selectOneRow(selected, recordId, e.detail.rowData, e.detail.attributes, group);\n\t\t\tif (group != null && autoSelectGroupRows) // if grouped row was selected then select all of its expanded groupies\n\t\t\t\tthis.toggleRowSelections(selected, group);\n\t\t}.bind(this));\n\t}\n\n\thandleRangeSelection(e) {\n\t\t// Shift KeyCode is 16\n\t\tif (this.keyPressed[16] && this.lastClickedIndex != undefined && !this.internal && !this.groupByFieldType) {\n\t\t\tthis.internal = true;\n\t\t\tlet start = Math.min(this.lastClickedIndex, e.detail.index);\n\t\t\tlet end = Math.max(this.lastClickedIndex, e.detail.index);\n\t\t\tthis.toggleRowSelections(e.detail.selected, null, {start: start, end: end});\n\t\t\tthis.internal = false;\n\t\t}\n\t\tif (!Polymer.dom(e).rootTarget._selectedChangeByParent)\n\t\t\tthis.lastClickedIndex = e.detail.index;\n\t}\n\n\tselectOneRow(selected, recordId, rowData, attributes, group) {\n\t\tif (selected) {\n\t\t\tif (this.selectedRows === null)\n\t\t\t\tthis.selectedRows = {};\n\t\t\tthis.selectedRows[recordId] = {\n\t\t\t\trecord: {Id: recordId, attributes: attributes, UnitPrice: rowData.UnitPrice},\n\t\t\t\tindex: this.viewResultsIndexById[recordId],\n\t\t\t\tinvalid: (group != null)\n\t\t\t};\n\t\t}\n\t\tif (!selected && this.selectedRows)\n\t\t\tdelete this.selectedRows[recordId];\n\t}\n\n\tdeSelectAll() {\n\t\tif( this.$.header ) {\n\t\t\tthis.$.header.selected = undefined; //if the header checkbox already is false, this is required so that all the rows get updated.\n\t\t\tthis.$.header.selected = false;\n\t\t}\n\t}\n\n\t_setViewResultsObserver (searchModel, fieldSet, groupByFieldType) {\n\t\tif (searchModel === undefined || fieldSet === undefined || groupByFieldType === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setViewResults(searchModel, fieldSet, groupByFieldType);\n\t}\n\t\n\tsetViewResults() {\n\t\tthis.selectedRows = {};\n\t\tthis.viewResultsIds = null;\n\t\tthis.viewResultsIndexById = null;\n\t\tlet viewResults = this.getViewResults(this.searchModel.results);\n\t\tthis.hasGroupedField = !!(this.groupByField);\n\t\tif(this.isMobileViewport())\n\t\t\tthis._resetMobileDetails();\n\n\t\t// no group field, then the view results are the search model results\n\t\tif (!this.hasGroupedField) {\n\t\t\tthis.viewResults = viewResults;\n\t\t\treturn;\n\t\t}\n\n\t\t// if viewResult already exists, clone the entire searchModel.results object so the dom-repeat will behave properly\n\t\tif (this.viewResults)\n\t\t\tviewResults = JSON.parse(JSON.stringify(this.getViewResults(this.searchModel.results)));\n\n\t\t// again if in mobile then the view results are simply the search model results\n\t\tif (this.isMobileViewport()) {\n\t\t\tthis.viewResults = viewResults;\n\t\t\treturn;\n\t\t}\n\n\t\t// we have a group by field and we are not in mobile, so lets apply the grouping\n\t\tlet groupFieldNames = [this.fieldSet.fields[0], 'Id']; // used to create grouper viewResult item in front of each set of grouped viewResults\n\t\tlet recordPath = 'record.' + this.searchModel.targetObjectName; // path from the searchModel.result item to the record object that contains the group\n\t\tlet groupCountPath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] , property: 'suffix' };\n\t\tlet groupFieldTypePath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] + '.md', property: 'type' };\n\n\t\t// initialize the grouper instance and group the viewResults\n\t\tconst grouper = new RecordGrouper(\n\t\t\tthis.groupByField,\n\t\t\tgroupFieldNames,\n\t\t\trecordPath,\n\t\t\t{hidden: true},\n\t\t\t{},\n\t\t\t{hidden: false},\n\t\t\tgroupCountPath,\n\t\t\tthis.groupByFieldType,\n\t\t\tgroupFieldTypePath);\n\n\t\tviewResults = grouper.group(viewResults);\n\n\t\tthis.rowsByGrouper = {};\n\t\tthis.groups = [];\n\t\tthis.viewResultsIds = [];\n\t\tthis.viewResultsIndexById = {};\n\t\tlet viewResultIndex = 0;\n\t\tfor (let viewResult of viewResults) {\n\t\t\tthis._indexViewResult(viewResult, viewResultIndex++);\n\t\t\tif (viewResult.grouper) {\n\t\t\t\tthis.rowsByGrouper[viewResult.grouper] = [];\n\t\t\t\tthis.groups.push(viewResult);\n\t\t\t}\n\t\t\telse if (this.rowsByGrouper[viewResult.groupie])\n\t\t\t\tthis.rowsByGrouper[viewResult.groupie].push(viewResult);\n\t\t}\n\n\t\tthis.viewResults = viewResults;\n\n\t\t// Reset the expand/collapse state of our product groups\n\t\tthis.expandedGroupState = {};\n\n\t\t// If only one group in the results, then expand it by default\n\t\tconst hasSingleGroup = (this.viewResults.length === this.searchModel.results.length + 1)\n\t\tif (!hasSingleGroup) return;\n\n\t\tconst groupName = this.viewResults[0].grouper;\n\t\tthis.expandRowEventHandler({\n\t\t\tpath: [{ index: 0 }],\n\t\t\tdetail: { group: groupName }\n\t\t});\n\t}\n\n\tgetViewResults(products) {\n\t\tlet prefix = this.org.prefix ? this.org.prefix + '__' : '';\n\t\tlet results = [];\n\t\tfor (let product of products || []) {\n\t\t\tlet result = {record: {}};\n\t\t\tfor (let field in product.record) {\n\t\t\t\tif (field === 'UnitPrice' && product.record.Product2 && product.record.Product2[prefix + 'HidePriceInSearchResults__c']) {\n\t\t\t\t\tresult.record[field] = ''; // blank it out.  If we skip this field altogether the search results will show incorrect values.\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tresult.record[field] = product.record[field];\n\t\t\t\t}\n\t\t\t}\n\t\t\tresults.push(result);\n\t\t}\n\t\treturn(results);\n\t}\n\n\tsetDisplayResults() {\n\t\tif (this.isMobileViewport() || !this.groupByField)\n\t\t\tthis._viewResults = this.viewResults;\n\t\telse {\n\t\t\tthis._viewResults = this.groups;\n\t\t}\n\t}\n\n\tisSelected(row) {\n\t\tif (!this.selectedRows)\n\t\t\treturn false;\n\t\tlet id = this.get(this.selectionIdDataPath, row);\n\t\treturn !!(this.selectedRows[id]);\n\t}\n\n\tisExpanded(groupName, expandedGroupState) {\n\t\tif (!groupName || !expandedGroupState) return false;\n\t\treturn !!expandedGroupState[groupName];\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t//when the searchModel.totalCount was 0, Polymer was not automatically updating the value through 2 way binding W-013313\n\t//additionally, we want the count to hide when it is 0 so we also update hasTotalCount\n\tupdateTotalCount() {\n\t\tif (this.searchModel.totalCount !== null)\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\tthis.hasTotalCount = this.totalCount > 0;\n\t}\n\n\t_getPrimaryMobileCols() {\n\t\tlet primaryMobileCols = [].concat(this.primaryMobileCols);\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone')) {\n\t\t\tlet parts = primaryMobileCols[0].split('.');\n\t\t\tlet prefix = parts.length > 1 ? (parts[0] + '.') : '';\n\t\t\tprimaryMobileCols[0] = prefix + this.fieldSet.fields[0];\n\t\t}\n\n\t\treturn primaryMobileCols;\n\t}\n\n\texpandMobileRow(e) {\n\t\tlet list = this.$$('#list');\n\t\tthis._setMobileExpandDetails(list, e.detail);\n\t\tlist.notifyResize();\n\t}\n\n\tselectMobileRow(e) {\n\t\tlet list = this.$$('#list');\n\t\tthis._setMobileSelectedDetails(list, e.detail);\n\t}\n\n\t_setMobileExpandDetails(list, expandDetails) {\n\t\tlet index = expandDetails.index;\n\t\tlet id = expandDetails.id;\n\t\tlet expanded = expandDetails.expanded;\n\t\tlet path = expandDetails.path;\n\t\tthis._setMobileDetails(list, index, id, 'expanded', expanded, path);\n\t}\n\n\t_setMobileSelectedDetails(list, selectedDetails) {\n\t\tlet index = selectedDetails.index;\n\t\tlet id = selectedDetails.id;\n\t\tlet selected = selectedDetails.selected;\n\t\tthis._setMobileDetails(list, index, id, 'selected', selected);\n\t}\n\n\t_setMobileDetails(list, index,id,  key, value, path) {\n\t\tlet virtualIndex = list._computeVidx(index) % list._physicalCount;\n\t\tif(!this.mobileRowDetails[virtualIndex])\n\t\t\tthis.mobileRowDetails[virtualIndex] = {};\n\t\tlet details = this.mobileRowDetails[virtualIndex];\n\t\tif(path)\n\t\t\tdetails.path = path;\n\t\tif(!details.ids)\n\t\t\tdetails.ids = {};\n\t\tif(!details.ids[id])\n\t\t\tdetails.ids[id] = {};\n\t\tdetails.ids[id][key] = value;\n\t}\n\n\t/**\n\t * Event handler for splicing in and out table rows for expand/collapse of\n\t * product groups.\n\t *\n\t * @param {Object} event - the event data object.\n\t */\n\texpandRowEventHandler(event) {\n\t\tconst groupName = event.detail.group;\n\t\tconst eventPath = event.path || Polymer.dom(event).path;\n\t\tconst groupStartIndex = eventPath[0].index + 1;\n\t\tconst newState = this.expandedGroupState[groupName] = !this.expandedGroupState[groupName];\n\t\tthis._expandRow(newState, groupName, this.rowsByGrouper, groupStartIndex);\n\t}\n\n\t/**\n\t * Given a boolean toggling the group as expanded or collapsed, this function\n\t * splices in or out table rows from the DOM for a particular group.\n\t *\n\t * @param {Boolean} newState - to expand if true, to collapse if false.\n\t * @param {String} groupName - the group name to expand or collapse.\n\t * @param {Object} rowsByGrouper - a map of table row DOM elements to group name.\n\t * @param {Integer} groupStartIndex - the index of the group DOM element.\n\t */\n\t_expandRow(newState, groupName, rowsByGrouper, groupStartIndex) {\n\t\tlet scrollToIndex = null;\n\t\tconst list = this.$$('#list');\n\t\tconst elements = rowsByGrouper[groupName] || [];\n\t\tif (newState) {\n\t\t\tconst args = [groupStartIndex, 0].concat(elements);\n\n\t\t\t// Using the array's native splice function here, so will need to do an\n\t\t\t// explicy notify below. Polymer's splice function is not able to splice\n\t\t\t// IN elements, only remove elements hence why we use the native splice\n\t\t\t// function.\n\t\t\tthis._viewResults.splice.apply(this._viewResults, args);\n\n\t\t\t// This notify will invoke iron-list._itemsChanges observer function\n\t\t\t// which will in turn call its _render function.\n\t\t\tthis._notifySplice(this._viewResults, '_viewResults', groupStartIndex, args.length - 1, []);\n\t\t} else {\n\t\t\t// Round scroll position up so that the firstVisibleIndex calculation is\n\t\t\t// done properly.\n\t\t\tlist._scrollPosition = Math.ceil(list._scrollPosition);\n\n\t\t\t// We will scroll to this index after we removed collapsed rows to ensure\n\t\t\t// collapsed group remains in same place post collapse as it did pre\n\t\t\t// collapse.\n\t\t\tscrollToIndex = list.firstVisibleIndex;\n\n\t\t\t// using polymer's splice function here will invoke\n\t\t\t// iron-list._itemsChanges observer function which will in turn call its\n\t\t\t// _render function.\n\t\t\tthis.splice('_viewResults', groupStartIndex, elements.length);\n\t\t}\n\n\t\t// force update scroller size after next render to handle iron-list bug\n\t\t// or if scrollToIndex is non null (like in the collapsed use case) simply\n\t\t// scroll to that index which will implicitly update the scroller size\n\t\tPolymer.RenderStatus.afterNextRender(this, this._adjustScrollAfterExpandRow.bind(this, list, scrollToIndex));\n\t}\n\n\t_adjustScrollAfterExpandRow(list, scrollToIndex) {\n\t\tif(scrollToIndex != null)\n\t\t\tlist.scrollToIndex(scrollToIndex);\n\t\telse\n\t\t\tlist._updateScrollerSize(true);\n\t}\n\n\tindexViewResults() {\n\t\tif(this.viewResultsIds != null)\n\t\t\treturn;\n\n\t\tthis.viewResultsIds = [];\n\t\tthis.viewResultsIndexById = {};\n\n\t\tlet index = 0;\n\t\tfor(let viewResult of this.viewResults)\n\t\t\tthis._indexViewResult(viewResult, index++);\n\n\t}\n\n\t_indexViewResult(viewResult, index) {\n\t\tlet id = this.get('record.' + this.selectionIdDataPath, viewResult);\n\t\tthis.viewResultsIds.push(id);\n\t\tthis.viewResultsIndexById[id] = index;\n\t}\n\n\t_isValidViewResultId(id) {\n\t\treturn this.viewResultsIds.indexOf(id) !== -1\n\t}\n\n\t_getMaxResultsToSelectAll() {\n\t\treturn this.maxSelectAll || MAX_NUM_RESULTS_TO_SELECT_ALL;\n\t}\n\n\t_isDisableHeaderSelection() {\n\t\treturn this.viewResults.length > this._getMaxResultsToSelectAll();\n\t}\n\n\t_getHeaderSelectionTooltip() {\n\t\tif(this.headerSelectionDisabled)\n\t\t\treturn this.i18n.l(`Reduce search results to fewer than {0} to enable select all`, [this._getMaxResultsToSelectAll()]);\n\t}\n\n\t_getExpandedDetails(row, index) {\n\t\treturn this._getMobileDetails(row, index, 'expanded', true);\n\t}\n\n\t_getSelectedDetails(row, index) {\n\t\treturn this._getMobileDetails(row, index, 'selected');\n\t}\n\n\t_getMobileDetails(row, index, key, includePath) {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn null;\n\n\t\tlet list = this.$$('#list');\n\t\tlet virtualIndex = list._computeVidx(index) % list._physicalCount;\n\t\tlet details = this.mobileRowDetails[virtualIndex] || null;\n\t\tif(!details)\n\t\t\treturn null;\n\n\t\tlet id = this.get(this.selectionIdDataPath, row);\n\t\tlet value = !!(details.ids[id] && details.ids[id][key]);\n\n\t\tlet response = {};\n\t\tresponse[key] = value;\n\n\t\tif(includePath)\n\t\t\tresponse.path = details.path;\n\t\treturn response;\n\t}\n\n\t_resetMobileDetails() {\n\t\tfor(let index in this.mobileRowDetails) {\n\t\t\tlet details = this.mobileRowDetails[index];\n\t\t\tfor(let id in details.ids)\n\t\t\t\tdetails.ids[id] = {};\n\t\t}\n\t}\n\n\t_scrollHandler() {\n\t\tif (!this.isMobileViewport())\n\t\t\treturn;\n\n\t\t// disabled expand while scrolling\n\t\tthis.expandDisabled = true;\n\t\tif(this._enabledExpand)\n\t\t\tclearTimeout(this._enabledExpand);\n\n\t\t// queue a timeout to enable expand when scrolling has stopped\n\t\tthis._enabledExpand = setTimeout(function() {\n\t\t\tthis.expandDisabled = false;\n\t\t}.bind(this), 200);\n\t}\n\n\t// used by web automation test harness, so do not remove\n\n\ttest_scrollToTarget(target) {\n\t\tif(!target)\n\t\t\treturn;\n\n\t\tlet index = target.index;\n\t\tif(index == null)\n\t\t\tindex = this._findRowIndex(target);\n\n\t\tif(index < 0)\n\t\t\treturn;\n\n\t\tthis.$$('#list').scrollToIndex(index);\n\t}\n\n\t_findRowIndex(target) {\n\t\tif(!target)\n\t\t\treturn -1;\n\n\t\tlet keys = Object.keys(target);\n\t\tlet numKeys = keys.length;\n\t\tif(numKeys === 0)\n\t\t\treturn -1;\n\n\t\tfor(let i = 0, l = this.viewResults.length; i < l; i++) {\n\t\t\tlet record = this.viewResults[i].record;\n\t\t\tlet match = true;\n\t\t\tfor(let j = 0; j < numKeys; j++)\n\t\t\t\tmatch = match && record[keys[j]] === target[keys[j]];\n\n\t\t\tif(match)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn -1;\n\t}\n}\n\nPolymer(LookupLayout);\n","import { Events, fireEvent } from 'common/core/Events.js';\n\nexport class Popup {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-popup';\n\t\tthis.properties = {\n\t\t\turl: String,\n\t\t\tmessenger: Object,\n\t\t\tchannel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sbQQ'\n\t\t\t},\n\t\t\tresponseMessage: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclosePopup: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-popup'\n\t\t\t},\n\t\t\tautoLaunched: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tredirectOnCancelOrClose: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_appendLargeClass'\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.close.bind(this));\n\t}\n\n\topen() {\n\t\tPolymer.RenderStatus.afterNextRender(this, this._open);\n\t}\n\n\t_open() {\n\t\tthis._initRpc();\n\t\tthis._sendMessage();\n\t\tthis._handleAutoLaunch();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tclose() {\n\t\tthis._close(this._getRedirectDetails(false));\n\t}\n\n\t_close(redirectDetails) {\n\t\tif(this.rpc) this.rpc.destroy();\n\t\tthis.$.dialog.toggle();\n\t\tlet frame = this.$.dialog.$$('#content').querySelector(`#easyXDM_${this.channel}_provider`);\n\t\tlet detail = { redirect: redirectDetails };\n\t\tif(frame) frame.remove();\n\t\tif(this.responseMessage) { // if iframe is closed, no response message is sent\n\t\t\tdetail.featureOptionIds = this.responseMessage.featureOptionIds;\n\t\t\tdetail.dynamicOptions = this.responseMessage.dynamicOptions;\n\t\t}\n\t\tfireEvent(Events.NAVIGATION_CHANGED);  // closes the action menu\n\t\tthis.fire(this.closePopup, detail);\n\t}\n\n\t_initRpc() {\n\t\tif(!this.url)\n\t\t\treturn;\n\n\t\tthis.rpc = new easyXDM.Rpc(\n\t\t\t{ remote: this.url, container: this.$.dialog.$$('#content'), channel: this.channel },\n\t\t\t{ remote: { postMessage: {} }, local: { postMessage: this._receiveMessage.bind(this) }\n\t\t});\n\t}\n\n\t_sendMessage() {\n\t\tlet outgoing = {};\n\t\tif(this.messenger && typeof this.messenger.getRequest === 'function')\n\t\t\toutgoing = this.messenger.getRequest();\n\n\t\toutgoing.redirect = this._getRedirectDetails(this.autoLaunched);\n\t\tthis.rpc.postMessage(JSON.stringify(outgoing));\n\t}\n\n\t_handleAutoLaunch() {\n\t\tif(this.autoLaunched)\n\t\t\tfireEvent(Events.AUTO_LAUNCH_POPUP);\n\t}\n\n\t_receiveMessage(incoming) {\n\t\tthis.debounce('_receiveMessage', function () {\n\t\t\tif(!this.messenger || typeof this.messenger.getResponse !== 'function') {\n\t\t\t\tthis.close();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet received = JSON.parse(incoming);\n\t\t\tthis._logReceivedMessage(received);\n\t\t\tthis.responseMessage = this.messenger.getResponse(received);\n\t\t\tlet redirectDetails = received.redirect ? received.redirect : this._getRedirectDetails(this.autoLaunched);\n\t\t\tthis._close(redirectDetails);\n\t\t}.bind(this), 100);\n\t}\n\n\t_logReceivedMessage(received) {\n\t\tconsole.log('RPC Received Message:');\n\t\tconsole.log(received);\n\t}\n\n\t_getRedirectDetails(redirect) {\n\t\treturn { auto: this.redirectOnCancelOrClose || !!(redirect), save: !!(redirect) };\n\t}\n\n\t_appendLargeClass() {\n\t\tthis.toggleClass(\n\t\t\t'largeView',\n\t\t\tthis.redirectOnCancelOrClose,\n\t\t\tPolymer.dom(this.$$('sb-dialog').root).querySelector('.sbDialog')\n\t\t);\n\t}\n}\nPolymer(Popup);","import {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class RowDrawer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-row-drawer';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thighlightOnFocus: {\n\t\t\t\ttype:Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlistMode: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_generateColumnsObserver(fieldNames, model, richTextFields)',\n\t\t\t'_highlightOnFocusObserver(highlightOnFocus, item)'\n\t\t];\n\t}\n\n\t_generateColumnsObserver (fieldNames, model, richTextFields) {\n\t\tif (fieldNames === undefined || model === undefined || richTextFields === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.generateColumns(fieldNames, model, richTextFields);\n\t}\n\t\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [],\n\t\t\tnumFields = this.fieldNames.length,\n\t\t\tfields = this.fieldNames.slice(0);\n\t\tlet columnGroups;\n\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif (this.richTextFields.indexOf(fields[i]) !== -1)\n\t\t\t\tcontinue;\n\t\t\telse if (this.listMode) {\n\t\t\t\tcolumn1Group.push(fields[i]);\n\t\t\t} else {\n\t\t\t\tif ( i % 3 == 0) {\n\t\t\t\t\tcolumn1Group.push(fields[i]);\n\t\t\t\t}\n\t\t\t\telse if ( i % 3 == 1) {\n\t\t\t\t\tcolumn2Group.push(fields[i]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcolumn3Group.push(fields[i]);\n\t\t\t\t}\n\t\t\t\t// set columnWidth so that width styling is applied to each column\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.listMode) {\n\t\t\tcolumnGroups = [this.richTextFields, column1Group];\n\t\t} else {\n\t\t\tthis.columnWidth = 'drawer';\n\t\t\tcolumnGroups = [this.richTextFields, column1Group, column2Group, column3Group];\n\t\t}\n\n\t\tthis.setColumns(columnGroups);\n\t}\n\n\tsetColumns(columnGroups) {\n\t\tlet columns = [this.$$('#rteColumn'), this.$$('#firstColumn')];\n\t\tif (!this.listMode) {\n\t\t\tcolumns.push(this.$$('#secondColumn'), this.$$('#thirdColumn'));\n\t\t}\n\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\tif (columnGroups[i].length > 0) {\n\t\t\t\tcolumns[i].destroyGroup();\n\t\t\t\tcolumns[i].model = this.model;\n\t\t\t\tcolumns[i].itemClass = 'drawerCell';\n\t\t\t\tcolumns[i].group = columnGroups[i];\n\t\t\t}\n\t\t}\n\t}\n\n\t_highlightOnFocusObserver (highlightOnFocus, item) {\n\t\tif (highlightOnFocus === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._highlightOnFocus(highlightOnFocus, item);\n\t}\n\t\n\t_highlightOnFocus(highlightOnFocus, item) {\n\t\tlet columnsForSignaler = ['rteColumn', 'firstColumn', ];\n\t\tif (!this.listMode) {\n\t\t\tcolumnsForSignaler.push('secondColumn', 'thirdColumn');\n\t\t}\n\t\tthis.signaler = new RowFocusSignaler(this, columnsForSignaler, item);\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !highlightOnFocus);\n\t}\n\n\t_getGroupListClass(listMode) {\n\t\treturn this.listMode ? 'listMode' : '';\n\t}\n\n\t_getRTEGroupListClass(listMode) {\n\t\treturn this.listMode ? 'rteListMode' : '';\n\t}\n\n}\n\nPolymer(RowDrawer);","export class SidePanel{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-side-panel';\n\t\tthis.properties = {\n\t\t\trenderHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ticon: String,\n\t\t\tarrows: String,\n\t\t\t/**\n\t\t\t * Label for the side panel\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tsideText: String,\n\t\t\t/**\n\t\t\t * Boolean that hides and shows the panel slideout button\n\t\t\t * @type {Boolean}\n\t\t\t */\n\t\t\trightSideButton: Boolean\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setIcon(isOpen)']\n\t}\n\n\tcloseDrawer() {\n\t\tthis.fire('x-clicked');\n\t}\n\n\tkeyCheck(event) {\n\t\tif (event.keyCode == 13) {\n\t\t\tthis.fire('enter-keypress');\n\t\t}\n\t}\n\n\ttoggleDrawer() {\n\t\tthis.fire('side-toggle-clicked');\n\t}\n\n\tsetIcon() {\n\t\tif (this.isOpen === \"open\") {\n\t\t\tthis.icon = 'sf-icon-left';\n\t\t}\n\t\telse {\n\t\t\tthis.icon = 'sf-icon-right';\n\t\t\tthis.arrows = 'closedArrows';\n\t\t}\n\t}\n}\n\nPolymer( SidePanel );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from \"../../core/AppContext.js\";\n\nexport class SwipeContainer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-swipe-container';\n\n\t\tthis.listeners = {\n\t\t\t'expanded-changed': 'onGroupExpanded'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpreventSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisRequiredRowNotSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tgroupExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_expansionChanged'\n\t\t\t},\n\t\t\tswipeHeader: Object,\n\t\t\tswipeMenu: Object,\n\t\t\tswipeItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tswipeItemWidth: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 58\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tvariant: String,\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_preventSwipe(isRequiredRowNotSelected)'\n\t\t];\n\t}\n\n\t_preventSwipe() {\n\t\tthis.preventSwipe = this.isRequiredRowNotSelected || this.groupExpanded;\n\t}\n\n\tonGroupExpanded(e) {\n\t\tthis.groupExpanded = e.detail.expanded;\n\t\tthis._preventSwipe();\n\t}\n\n\tattached() {\n\t\tlet isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tif (!isMobile || this.disableSwipe) {\n\t\t\tthis.style.minWidth = \"100%\";\n\t\t\tthis.style.position = \"static\";\n\t\t\treturn;\n\t\t}\n\n\t\tPolymer.dom(this.$.content).observeNodes(\n\t\t\tfunction(mutations) {\n\t\t\t\tfor (var i = 0; i < mutations.addedNodes.length; i++) {\n\t\t\t\t\tthis._findSwipeHeaderAndMenu(mutations.addedNodes[i]);\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\t}\n\n\t_expansionChanged(groupExpanded) {\n\t\tif(this.variant === \"ui3qle\") {\n\t\t\t//this will toggle the prevent swipe flag\n\t\t\tthis._preventSwipe();\n\t\t}\n\t}\n\n\t_findSwipeHeaderAndMenu(node) {\n\t\tif (node.nodeType === Node.TEXT_NODE || node.nodeType === Node.COMMENT_NODE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.id === 'swipe-header') {\n\t\t\tthis._initSwipeHeader(node);\n\t\t\treturn;\n\t\t}\n\t}\n\n\n\t_initSwipeHeader(node) {\n\t\tvar swipeHeader = this.swipeHeader = node;\n\t\tvar swipeHeaderStyle = swipeHeader.style;\n\n\t\t// this.viewport is a necessary operand to pass a test in table-row that requires a viewport\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tswipeHeaderStyle.maxWidth = '100%';\n\t\t\tswipeHeaderStyle.display = 'table';\n\n\t\t\treturn;\n\t\t}\n\n\t\t if(this.variant !== \"ui3qle\"){\n\t\t\tswipeHeaderStyle.maxWidth = '50%';\n\t\t\tswipeHeaderStyle.position = 'relative';\n\t\t}\n\n\t\tthis.listen(node, 'track', '_onTrack');\n\t\tthis.setScrollDirection('y', node);\n\t}\n\n\t_closeMenuWhenTapped(swipeMenu, swipeContainer) {\n\t\tswipeMenu.addEventListener('tap', function() {\n\t\t\tswipeContainer._animate(100, 1, swipeContainer.swipeHeader);\n\t\t});\n\t}\n\t_initSwipeMenu(node) {\n\t\tnode.style.maxWidth = '50%';\n\t\tthis._closeMenuWhenTapped(node, this);\n\n\t\tif (this.swipeItems && this.swipeItems.length) {\n\t\t\tfor (var k = 0; k < this.swipeItems.length; k++) {\n\t\t\t\tvar swipeItem = this.swipeItems[k];\n\t\t\t\tswipeItem.style.position = '';\n\t\t\t\tswipeItem.style.width = '0px';\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeMenu = node;\n\t\tvar allNodesOfSwipeMenu = [],\n\t\t\tswipeMenuItems = [];\n\n\t\t// if the browser supports shadowRoot (Chrome)\n\t\tif (node.children[0].shadowRoot) {\n\t\t\tPolymer.dom(node.children[0].shadowRoot).flush();\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS') {\n\t\t\t\tPolymer.dom(node.children[0].shadowRoot).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].shadowRoot.children;\n\t\t\t} else if (node.children[0].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t// else the browser doesn't support shadowRoot (Safari, Firefox)\n\t\t} else {\n\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS' || node.children[0].nodeName === 'SF-LINE-ACTIONS') {\n\t\t\t\t// Necessary for when one action is displayed\n\t\t\t\tPolymer.dom(node.children[0]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].children;\n\t\t\t} else if (node.children[1].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tPolymer.dom(node.children[1]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (var i = 0, len = allNodesOfSwipeMenu.length; i < len; i++) {\n\t\t\tvar currentNode = allNodesOfSwipeMenu[i];\n\n\t\t\tif (this._isValidSwipeMenuItem(currentNode)) {\n\t\t\t\tswipeMenuItems.push(currentNode);\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeItems = swipeMenuItems;\n\n\t\tvar width = this.swipeItemWidth * this.swipeItems.length;\n\n\t\tnode.style.width = width + 'px';\n\n\t\tfor (var j = 0, swipeItemsLen = this.swipeItems.length; j < swipeItemsLen; j++) {\n\t\t\tlet swipeItem  = this.swipeItems[j];\n\n\t\t\tthis.toggleClass('swipe-menu-item', true, swipeItem);\n\n\t\t\tvar speed = ((200 - ((swipeItemsLen - 1) * 20)) * swipeItemsLen);\n\n\t\t\tthis.style.transition  = 'transform ' + speed + 'ms ease-out';\n\t\t\tthis._setSwipeItemStyles(swipeItem.style, speed, width);\n\t\t}\n\t}\n\n\t_setSwipeItemStyles(swipeItemStyle, speed, width) {\n\t\tswipeItemStyle.transition               = 'transform ' + speed + 'ms ease-out';\n\t\tswipeItemStyle.webkitBackfaceVisibility = 'hidden';\n\t\tswipeItemStyle.borderRadius             = 0;\n\t\tswipeItemStyle.position                 = 'absolute';\n\t\tswipeItemStyle.left                     = 0;\n\t\tswipeItemStyle.height                   = '100%';\n\t\tswipeItemStyle.width                    = '57px';\n\t}\n\n\t_onTrack(event) {\n\t\tif(!this.swipeMenu) {\n\t\t\tvar node = this.querySelector('#swipe-menu');\n\t\t\tif(node) {\n\t\t\t\tthis._initSwipeMenu(node);\n\t\t\t}\n\t\t}\n\n\t\tif (this.preventSwipe || !this.swipeItems.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar target = event.currentTarget,\n\t\t\ttrack = event.detail;\n\n\t\tif (track.state === 'track') {\n\t\t\tthis._trackMove(track, target);\n\t\t}\n\t}\n\n\t_trackMove(event, target) {\n\t\tthis._animate(event.dx, event.dy, target);\n\t}\n\n\t_animate(dx, dy, blah) {\n\t\tvar direction = dx > 0 ? 1 : -1;\n\n\t\tif (direction === -1 && Math.abs(dy) < 20 && dx < -60) {\n\t\t\tthis.fire('row-swiped', {'isOpen': true });\n\n\t\t\tvar cho = parseFloat(getComputedStyle(this.swipeItems[0]).width);\n\t\t\tvar nag = cho.toPrecision(5) * this.swipeItems.length;\n\n\t\t\tvar distance = nag * direction;\n\t\t\tthis.style.transform = 'translate3d(' + (distance) + 'px, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\n\t\t\tfor (var i = this.swipeItems.length - 1; i >= 0; i--) {\n\t\t\t\tvar dist = i * cho.toPrecision(5);\n\t\t\t\tthis.swipeItems[i].style.width = cho.toPrecision(5) + 'px';\n\t\t\t\tthis.swipeItems[i].style.transform = 'translate3d(' + dist + 'px, 0, 0)';\n\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (direction === 1 && Math.abs(dy) < 20 && dx > 25) {\n\t\t\tthis.fire('row-swiped', {'isOpen': false });\n\n\t\t\tvar originalPosition  = 0;\n\t\t\tthis.style.transform = 'translate3d(' + originalPosition + '%, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\t\t\tfor (var i = 0; i < this.swipeItems.length; i++) {\n\t\t\t\tvar trans = 'translate3d(' + originalPosition + '%, 0, 0)';\n\n\t\t\t\tthis.swipeItems[i].style.transform = trans;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_isValidSwipeMenuItem(currentNode) {\n\t\tif (this.variant === \"ui3qle\") {\n\t\t\treturn currentNode.nodeName.toLowerCase() === 'button';\n\t\t} else {\n\t\t\tif ((currentNode.nodeName.toLowerCase() === 'span' || (currentNode.$$ && currentNode.$$('span'))) && !currentNode.classList.contains('ignore-in-mobile')) {\n\t\t\t\tif (currentNode.$$ && currentNode.$$('span')) {\n\t\t\t\t\tvar fav = currentNode.$$('span');\n\n\t\t\t\t\tif ((fav.id === 'removeFromFavBtn' || fav.id === 'addToFavBtn') && (fav.style.display === 'none')) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!currentNode.classList.contains('visibilityHidden')) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tcurrentNode.style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nPolymer(SwipeContainer);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thide: Object, // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildCellObserver(item, value, model, data)',\n\t\t\t'setDisabled(data.disabled)',\n\t\t\t'setRecordId(data.Id)',\n\t\t\t'overrideWidth(data.fullWidthItem)',\n\t\t\t'_dataChangedObserver(data, item)'\n\t\t];\n\t}\n\n\t_buildCellObserver (item, value, model, data) {\n\t\tif (item === undefined || value === undefined || model === undefined || data === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildCell(item, value, model, data);\n\t}\n\t\n\tbuildCell() {\n\t\tthis.setDisabled();\n\t\tthis.setHidden();\n\t\tthis.setRecordId();\n\t\tthis.setSuffix();\n\n\t\tif (this.model && this.model[this.item] && this.model[this.item].type) {\n\t\t\tthis.setFieldMetadataFromModel();\n\t\t\treturn;\n\t\t}\n\t\t// if no model then infer the type based on the item name\n\t\tlet type = 'string';\n\t\tthis.md = this.md || {type: type};\n\t}\n\n\tsetDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\tsetHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tthis.hide = new FieldHider(hidden).hide;\n\t}\n\n\tsetRecordId() {\n\t\tthis.recordId = this.data ? this.data.Id : null;\n\t}\n\n\tsetSuffix() {\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'suffix']) != null)\n\t\t\tthis.suffix = this.get(['data', '_transient_', this.item, 'suffix']);\n\t\telse\n\t\t\tthis.suffix = undefined;\n\t}\n\n\toverrideWidth() {\n\t\tif (this.data && this.data.fullWidthItem && this.classList.contains(this.data.fullWidthItem)) this.style.width = '100%';\n\t\telse if (this.style.width == '100%') this.style.width = null;\n\t}\n\n\tsetFieldMetadataFromModel() {\n\t\tlet md = this.model[this.item];\n\t\t// lets check if the data has an override metadata property for this particular item, if so lets use it\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'md']) != null)\n\t\t\tmd = this.get(['data', '_transient_', this.item, 'md']);\n\t\t// set this programmatically before assigning md to ensure they are set in FF before the render function\n\t\tthis.$.field.link = !!(md.link);\n\t\tthis.$.field.readOnly = true;\n\t\t// now we set the metadata to trigger the sb-field processing\n\t\tthis.md = md;\n\t}\n\n\t_dataChangedObserver (data, item) {\n\t\tif (data === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.dataChanged(data, item);\n\t}\n\t\n\tdataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(TableCell);","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCellSelect {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell-select';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tisRadio: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isRadio(item)'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'init'\n\t\t\t}\n\t\t}\n\t}\n\n\tinit() {\n\t\tif(this._attached) {\n\t\t\tthis._setDisabled();\n\t\t\tthis._setHidden();\n\t\t\treturn;\n\t\t}\n\t\tPolymer.dom(this.$.s).observeNodes(function () {\n\t\t\tthis._setDisabled();\n\t\t\tthis._setHidden();\n\t\t\tthis._attached = true;\n\t\t}.bind(this));\n\t}\n\n\t_isRadio() {\n\t\treturn this.item === 'radio';\n\t}\n\n\t_setDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\t_setHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tlet hider = new FieldHider(hidden, Polymer.Base);\n\t\thider.applyTo(this.$$('#' + this.item));\n\t}\n}\n\nPolymer(TableCellSelect);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class TableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-header';\n\t\tthis.properties = {\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tselectable: Boolean, // true if the row's left most column selectable\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectionTooltip: String,\n\t\t\theaderClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\theaderActions: Array,\n\t\t\thideHiddenSelectable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tget observers() {\n\t\treturn [ '_buildLabelsObserver(cols, headerClassMap, columnWidths)',\n\t\t\t'_setSelectableObserver(selectable, selectionType)',\n\t\t\t'_setSelectedObserver(selected, selectable, selectionType)'];\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_buildLabelsObserver (cols, headerClassMap, columnWidths) {\n\t\tif (cols === undefined || headerClassMap === undefined || columnWidths === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildLabels(cols, headerClassMap, columnWidths);\n\t}\n\t\n\tbuildLabels() {\n\t\tvar data = {};\n\t\tvar group = [];\n\n\n\t\t// Refer to work record W-3821512, W-4323895\n\t\t// Polymer binding cannot dereference Japanese unicode characters e.g. {{data.商品コード}}, so manually clean it up here\n\t\t// Track polymer issue here: https://github.com/Polymer/polymer/issues/4723\n\t\t// use a simple integer-based name as Polymer 1.x can't handle non-ascii characters in data binding expressions\n\t\tlet counter = 0;\n\t\tthis.cols.forEach(function (col) {\n\t\t\tif (!col)\n\t\t\t\treturn;\n\n\t\t\tgroup.push(counter);\n\t\t\tdata[counter++] = col;\n\t\t});\n\n\t\tthis.$.header.data = undefined;\n\t\tthis.$.header.itemClassMap = this.headerClassMap;\n\t\tthis.$.header.columnWidths = this.columnWidths;\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = group;\n\t\tthis.$.header.data = data;\n\t}\n\n\t_setSelectableObserver (selectable, selectionType) {\n\t\tif (selectable === undefined || selectionType === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelectable(selectable, selectionType);\n\t}\n\t\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tif(this.registeredDataChangedHandler)\n\t\t\treturn;\n\n\t\tthis.registeredDataChangedHandler = true;\n\t\tPolymer.RenderStatus.afterNextRender(this, this.registerSelectionChangedHandler.bind(this));\n\t}\n\n\tregisterSelectionChangedHandler() {\n\t\tthis.$.selection.addEventListener('data-changed', this.selectionChangedHandler.bind(this));\n\t}\n\n\tselectionChangedHandler(e) {\n\t\t// in Chrome this is event is fired twice, so return early for the root target we don't care about\n\t\tif(Polymer.dom(e).rootTarget.nodeName.toLowerCase() === 'template')\n\t\t\treturn;\n\n\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\tthis.internal = false;\n\t\tthis.fire('header-selection-changed', {selected: this.selected});\n\t}\n\n\t_setSelectedObserver (selected, selectable, selectionType) {\n\t\tif (selected === undefined || selectable === undefined || selectionType === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelected(selected, selectable, selectionType);\n\t}\n\t\n\tsetSelected() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tlet key = this.selectionType === 'radio' ? 'radio' : 'checkbox';\n\t\tif(!this.$.selection.group)\n\t\t\tthis.$.selection.group = [key];\n\t\tlet selectionData = { disabled: this.selectionDisabled };\n\n\t\tlet value = this.selected;\n\t\tselectionData[key] = value;\n\t\tlet hidden = new FieldHider(!this.selectable).hide;\n\t\thidden.type = 'invisible';\n\t\tselectionData.hidden = hidden;\n\t\tthis.$.selection.data = selectionData;\n\n\t\tlet hideSelection = this.hideHiddenSelectable ? !this.selectable : false;\n\t\tthis.toggleClass('hidden', hideSelection, this.$.selection);\n\t}\n\n\t_showHeaderActions(position) {\n\t\tif (!this.headerActions || this.headerActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.headerActions.length; i < l; i++) {\n\t\t\tif (this.headerActions[i].position == position && !this.headerActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\nPolymer(TableHeader);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class TableRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tcell: String, // name of the component that represents an table cell in the row\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tcolsDisplay: Object,// map whose keys match the cols array items and value is used for display purposes\n\t\t\trowActions: Array, // array of strings that represents actions for the options\n\t\t\trouteSource: String,\n\t\t\trowData: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each cell item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trequiresModel: { // set to true if model in your use case is not optional and you do not want to build rows until model is not null\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectable: {// true if the row's left most column is selectable\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tdisabledData: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\t'disabled': false,\n\t\t\t\t\t'constrained': false\n\t\t\t\t}\n\t\t\t},\n\t\t\tselectionIdDataPath: { // path on the data object that contains the selection id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Id'\n\t\t\t},\n\t\t\tparentIdDataPath: { // path on the data object that contains the parent's id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Parent'\n\t\t\t},\n\t\t\tparentAttributesPath: String, // if on selection you want the data attribute property, specify the path\n\t\t\tprimaryMobileCols: { // columns whose value will be primary display for this row when in the mobile viewport\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\trepeatPrimaryMobileCols: { // if true then the primary columns should be repeated in the mobile drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: 'setIsMobile(viewport)'\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setActionId(isMobile)'\n\t\t\t},\n\t\t\tgrouper: String, // if non nil then this row represents a group and can show/hide its groupie rows.\n\t\t\tgrouperExpanded: Boolean, // if true then the grouper row should default in the expanded state\n\t\t\tgroupie: String, // if non nil indicates what group this row is a groupie of and therefore can be shown or hidden by its grouper row\n\t\t\tignoreViewportChange: Boolean,\n\t\t\trowClassMap: {\n\t\t\t\ttype: Object, // map of field to its type\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\teditFirstWhenSelected: { // enables editing to the provided child element of the first cell when the row is selected\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tindex: {\n\t\t\t\ttype: Number, // the index of the row in the context of its table container\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_broadcastMobileExpanded'\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trowSwiped: {\n\t\t\t\ttype:Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideSelection: { // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tselectionClass: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tleftClass: { // class to adjust red line on required configurations for selection method of not add\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tcomputed: 'setLeftClass(routeSource, rowData, selected)'\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t},\n\t\t\tdeferGrouping: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectionOnLoad: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tforceColumnWidths: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobileExpandedDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'expandMobileRow'\n\t\t\t},\n\t\t\tmobileSelectedDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'selectMobileRow'\n\t\t\t},\n\t\t\tdisableSelectionTabFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdisableAllFields: Boolean,\n\t\t\thasTogglePlaceholder: Boolean,\n\t\t\thasToggle: Boolean,\n\t\t\ttogglePlaceholder: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_hasTogglePlaceholder(hasTogglePlaceholder, hasToggle)'\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRowObserver(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths)',\n\t\t\t '_setSelectableObserver(selectable, selectionOnLoad)',\n\t\t\t'_setSelectedObserver(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass)',\n\t\t\t'_setGrouperObserver(rowData, grouper)',\n\t\t\t'_setGrouperClassesObserver(grouperExpanded, rowData, grouper)',\n\t\t\t'_disableAllTableFieldsObserver(rowData.record, disableAllFields)'\n\t\t];\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.rowSwiped = e.detail.isOpen;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tsetActionId(isMobile) {\n\t\treturn isMobile ? 'swipe-menu' : '';\n\t}\n\n\t_buildRowObserver (cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths) {\n\t\tif (cell === undefined || cols === undefined || colsDisplay === undefined || rowData === undefined || model === undefined ||\n\t\t\t primaryMobileCols === undefined || repeatPrimaryMobileCols === undefined || requiresModel === undefined || rowClassMap === undefined || columnWidths === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildRow(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths);\n\t}\n\t\n\tbuildRow() {\n\t\tif(this.requiresModel && !this.model)\n\t\t\treturn; // bail if requires model and model is not yet non nil\n\n\t\tthis.$.row.item = undefined;\n\t\tthis.$.row.groupDisplay = undefined;\n\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t\tthis.setFullWidthIfGroupRow();\n\t\tthis.$.row.columnWidths = this.forceColumnWidths ? this._cloneColumnWidths() : this.columnWidths;\n\t\tthis.$.row.itemClassMap = this.rowClassMap;\n\t\tthis.$.row.groupDisplay = this.colsDisplay;\n\t\tif(!this.$.row.group)\n\t\t\tthis.$.row.group = this.cols;\n\t\tthis.$.row.item = this.cell;\n\t}\n\n\t_setSelectableObserver (selectable, selectionOnLoad) {\n\t\tif (selectable === undefined || selectionOnLoad === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelectable(selectable, selectionOnLoad);\n\t}\n\t\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tif(this.registeredDataChangedHandler)\n\t\t\treturn;\n\n\t\tthis.registeredDataChangedHandler = true;\n\n\t\tif(this.selectionOnLoad)\n\t\t\tthis.registerSelectionChangedHandler();\n\t\telse\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this.registerSelectionChangedHandler.bind(this));\n\t}\n\n\tregisterSelectionChangedHandler() {\n\t\tthis.$.selection.addEventListener('data-changed', this.selectionChangedHandler.bind(this));\n\t}\n\n\tselectionChangedHandler(e) {\n\t\t// in Chrome this is event is fired twice, so return early for the root target we don't care about\n\t\tif(Polymer.dom(e).rootTarget && Polymer.dom(e).rootTarget.nodeName.toLowerCase() === 'template')\n\t\t\treturn;\n\n\t\tlet selected = this.selected;\n\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\tthis.$.row.selected = this.selected;\n\t\tthis.internal = false;\n\n\t\tlet changed = selected !== this.selected;\n\t\tlet path = e.detail.path === 'data.checkbox' || e.detail.path == 'data.radio';\n\t\tif(this.editFirstWhenSelected && this.selected && changed)\n\t\t\tthis.editFirst();\n\n\t\tif(this.selectionOnLoad && this._selectedChangeByParent)\n\t\t\t// afterNextRender ensures row is built out before firing the selection event\n\t\t\t//// product rules should only fire when path originates from selection group.\n\t\t\t//// check is made in ProductConfig handleChangeEvents\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this.fireSetSelectionEvent.bind(this, changed, path));\n\t\telse\n\t\t\tthis.fireSetSelectionEvent(changed, path);\n\t}\n\n\t_disableAllTableFieldsObserver (record, disableAllFields) {\n\t\tif (record === undefined || disableAllFields === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.disableAllTableFields(record, disableAllFields);\n\t}\n\t\n\t/**\n\t * W-5868974\n\t *\n\t * If 'disableAllFields' is toggled, then all fields cannot be\n\t * editable. 'itemEditableMap' is a mapping of fields to booleans that\n\t * indicate if they are editable or not. In this scenario we disable every\n\t * record field.\n\t *\n\t * @param {Object} record - an SObject record\n\t * @param {Boolean} disableAllFields - toggle for disabling fields \n\t */\n\tdisableAllTableFields(record, disableAllFields) {\n\t\tif (!disableAllFields || !record) return;\n\n\t\tconst fieldMap = {};\n\t\tObject.keys(record).map((key) => fieldMap[\"record.\" + key] = false);\n\t\tthis.$.row.itemEditableMap = fieldMap;\n\t}\n\n\teditFirst() {\n\t\tlet itemToEdit = this.$.row.$$(this.cell).$$(this.editFirstWhenSelected);\n\t\tif(itemToEdit && typeof itemToEdit.edit === 'function')\n\t\t\titemToEdit.edit()\n\t}\n\n\tfireSetSelectionEvent(changed, path) {\n\t\tthis.fire('selection-changed', {\n\t\t\tselected: this.selected,\n\t\t\tselectionType: this.selectionType,\n\t\t\tId: this.get('rowData.' + this.selectionIdDataPath),\n\t\t\tbundleId: this.get('rowData.' + this.parentIdDataPath),\n\t\t\tattributes: this.parentAttributesPath === undefined ? undefined : this.get('rowData.' + this.parentAttributesPath),\n\t\t\tgroup: this.grouper,\n\t\t\tchanged: changed,\n\t\t\tpath: path,\n\t\t\tindex: this.index,\n\t\t\trowData: this.rowData,\n\t\t\tautoSelectGroupRows: !this._selectedChangeByParent\n\t\t});\n\t}\n\n\t_setSelectedObserver (selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass) {\n\t\tif (selected === undefined || selectable === undefined || selectionType === undefined || rowActions === undefined ||\n\t\t\t routeSource === undefined || disabledData === undefined || hideSelection === undefined || selectionClass === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelected(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass);\n\t}\n\t\n\tsetSelected() {\n\t\tif (!this.selectable || this.internal)\n\t\t\treturn;\n\n\t\t// flag that we are changing the selection state because bound properties were changed by this component's parent\n\t\t// in this case we will not set the group when firing the selection-changed event as a group's groupies (i.e. child rows)\n\t\t// should only be auto selected if the grouper row selection was triggered by the user (clicking the checkbox) and not by the parent component\n\t\tthis._selectedChangeByParent = true;\n\t\tthis._setSelected(this.selected);\n\t\tthis._selectedChangeByParent = false;\n\t}\n\n\t_setSelected(selected) {\n\t\tif (this.disabledData.constrained && selected === true) {\n\t\t\tthis.internal = true;\n\t\t\tthis.$.row.fire('group-selected', {selected: false});\n\t\t\tselected = false;\n\t\t\tthis.internal = false;\n\t\t}\n\n\t\tlet defaultHidden = new FieldHider(this.routeSource === 'Configurator' && this.hasDeleteAction()).hide;\n\t\tif(this.hideSelection != null) {\n\t\t\tlet hidden = new FieldHider(this.hideSelection).hide;\n\t\t\tPolymer.Base.extend(defaultHidden, hidden); // union this components hideSelection with the default\n\t\t}\n\n\t\tif(this.disableSelectionTabFocus)\n\t\t\tthis.$.selection.tabIndex = \"-1\";\n\n\t\tthis.selectionData = { hidden: defaultHidden };\n\t\tthis.selectionData[this.selectionType] = selected;\n\t\tthis.selectionData.disabled = this.disabledData.disabled || this.disabledData.constrained;\n\t\tthis.$.selection.data = this.selectionData;\n\t\t//W-013831: select all was taking 1-2 seconds because we were rebuilding the group every time\n\t\t//there is no known use case at this time for rebuilding the group so adding this if check\n\t\tif(this.$.selection.group === undefined)\n\t\t\tthis.$.selection.group = [this.selectionType];\n\t\tthis.toggleClass('td', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selectionContainer);\n\t\tthis.toggleClass('innerTd', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tthis.toggleClass('selection', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tif(this.selectionClass)\n\t\t\tthis.toggleClass(this.selectionClass, true, this.$.selection);\n\t}\n\n\tselect(e) {\n\t\tif(this.selectionData !== undefined && this.selectionData.disabled === true)\n\t\t\treturn;\n\t\tlet rootTarget = Polymer.dom(e).rootTarget;\n\t\tlet tagName = rootTarget && rootTarget.tagName ? rootTarget.tagName.toLowerCase() : '';\n\t\tif(tagName === 'sb-group')\n\t\t\tthis._setSelected(!this.selected);\n\n\t\tthis._broadcastGroupSelected(this.selected);\n\t\tthis._broadcastMobileSelected();\n\t}\n\n\t_broadcastGroupSelected(selected) {\n\t\tthis._groupSelected = selected;\n\t\tthis.$.row.fire('group-selected', {\n\t\t\tselected: selected,\n\t\t\tselectionDisabled: this.selectionDisabled,\n\t\t\ttableRow: this\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tif(this.expandDisabled || this.rowSwiped) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expandPath = e.detail && e.detail.preventer ? Polymer.dom(e.detail.preventer).path : Polymer.dom(e).path;\n\t\tthis.$.row.fire('group-expanded', {path: this.expandPath});\n\t}\n\n\tsetPrimaryMobileColumnsIfMobileViewport() {\n\t\tthis.$.row.numPrimary = this.primaryMobileCols.length;\n\t\tthis.$.row.primaryItems = this.isMobileViewport() ? this.primaryMobileCols : null;\n\t\tthis.$.row.includePrimaryInSecondary = this.isMobileViewport() ? this.repeatPrimaryMobileCols :false;\n\t}\n\n\texpandMobileRow() {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn;\n\n\t\tif(!this.mobileExpandedDetails)\n\t\t\treturn;\n\n\t\tif(this.mobileExpandedDetails.expanded === this.expanded)\n\t\t\treturn;\n\n\t\tthis.internalExpand = true;\n\t\tthis.$.row.fire('group-expanded', { path: this.mobileExpandedDetails.path });\n\t\tthis.internalExpand = false;\n\t}\n\n\tselectMobileRow() {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn;\n\n\t\tif(!this.mobileSelectedDetails)\n\t\t\treturn;\n\n\t\tlet mobileSelected = this.mobileSelectedDetails.selected;\n\t\tif(mobileSelected !== this.selected || mobileSelected !== this._groupSelected)\n\t\t\tthis._broadcastGroupSelected(mobileSelected);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tif (this.ignoreViewportChange)\n\t\t\treturn;\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t}\n\n\t_setGrouperObserver (rowData, grouper) {\n\t\tif (rowData === undefined || grouper === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setGrouper(rowData, grouper);\n\t}\n\t\n\tsetGrouper() {\n\t\tlet isGrouper = !this.isMobileViewport() && !!(this.grouper);\n\t\tthis.toggleClass('groupTr', isGrouper, this);\n\t\tthis.toggleClass('groupTd', isGrouper, this.$.row);\n\t\tthis.toggleClass('groupExpandTd', isGrouper, this.$.rowDiv);\n\t\tthis.setGrouperToggle(isGrouper);\n\t}\n\n\tsetGrouperToggle(isGrouper) {\n\t\tthis._toggleGroupHandler = this._toggleGroupHandler || this.toggleGroupEventHandler.bind(this);\n\t\tthis.$.rowDiv.removeEventListener('tap', this._toggleGroupHandler);\n\t\tif (isGrouper) this.$.rowDiv.addEventListener('tap', this._toggleGroupHandler);\n\t}\n\n\ttoggleGroupEventHandler(e) {\n\t\t// NOTE: we need to explicitly toggle the expanded class on click because\n\t\t// iron-list won't re-render this table row properly.\n\t\tthis.$.row.toggleClass('expanded');\n\t\tthis.toggleClass('expanded');\n\t\tthis.fire('sb-row-group-tapped', { group: this.grouper });\n\t}\n\n\t_setGrouperClassesObserver (grouperExpanded, rowData, grouper) {\n\t\tif (grouperExpanded === undefined || rowData === undefined ||\tgrouper === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setGrouperClasses(grouperExpanded, rowData, grouper);\n\t}\n\t\n\tsetGrouperClasses(expanded) {\n\t\tthis.toggleClass('expanded', expanded, this.$.row);\n\t\tthis.toggleClass('expanded', expanded, this);\n\t}\n\n\ttoggleRowDrawer() {\n\t\tthis.set('rowData._transient_.optionDrawerExpanded', !this.rowData._transient_.optionDrawerExpanded);\n\t\tthis.set('rowData._transient_.drawerIconClass',\n\t\t\tthis.rowData._transient_.optionDrawerExpanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright');\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tdisplayRowActions(position) {\n\t\tif (!position) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!this.rowActions || this.rowActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.rowActions.length; i < l; i++) {\n\t\t\tif (this.rowActions[i].position == position && !this.rowActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\thasDeleteAction() {\n\t\tfor (let action of this.rowActions) {\n\t\t\tif (action.title === 'Delete')\n\t\t\t\treturn true;\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetFullWidthIfGroupRow() {\n\t\t// only set if grouper row, assuming if grouper row then rowData does not represent an SObject record\n\t\t// as adding fullWidthItem to an SObject record will result in a serialization error when the data is shipped up to the server\n\t\tif(this._isGrouperRow())\n\t\t\tthis.rowData.fullWidthItem = 'firstInnerTd';\n\t}\n\n\t_configurationRequired() {\n\t\tif(this.routeSource !== 'Configurator' || !this.rowData.configurationRequired || !this.selected || !!this.rowData.configured) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetLeftClass() {\n\t\tif(this._configurationRequired()) {\n\t\t\tif(!this.rowData.added) {\n\t\t\t\treturn 'left';\n\t\t\t}\n\t\t}\n\t}\n\n\t_hasTogglePlaceholder() {\n\t\treturn this.hasTogglePlaceholder && !this.hasToggle;\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', this.cell, 'swipe-header');\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n\n\t_isGrouperRow() {\n\t\treturn !this.isMobileViewport() && !!(this.grouper);\n\t}\n\n\t_cloneColumnWidths() {\n\t\tif(!this.columnWidths)\n\t\t\treturn null;\n\n\t\tif(!this._isGrouperRow())\n\t\t\treturn JSON.parse(JSON.stringify(this.columnWidths));\n\n\t\t// if grouper row we override the first column's width (if specified) with 100%\n\t\tif(this.columnWidths[this.cols[0]] != null) {\n\t\t\tlet columnWidths = JSON.parse(JSON.stringify(this.columnWidths));\n\t\t\tlet firstColumnWidth = columnWidths[this.cols[0]];\n\t\t\tfirstColumnWidth.width = 100;\n\t\t\tfirstColumnWidth.unit = '%';\n\t\t\treturn columnWidths;\n\t\t}\n\t\treturn null;\n\t}\n\n\t_broadcastMobileExpanded() {\n\t\tif(!this.internalExpand && this.domHost && this.isMobileViewport() && this.expandPath)\n\t\t\tthis.domHost.fire('sb-mobile-row-expanded', {\n\t\t\t\texpanded: this.expanded,\n\t\t\t\tpath: [].concat(this.expandPath),\n\t\t\t\tindex: this.index,\n\t\t\t\tid: this.get('rowData.' + this.selectionIdDataPath)\n\t\t\t});\n\t}\n\n\t_broadcastMobileSelected() {\n\t\tif(this.domHost && this.isMobileViewport())\n\t\t\tthis.domHost.fire('sb-mobile-row-selected', {\n\t\t\t\tselected: this.selected,\n\t\t\t\tindex: this.index,\n\t\t\t\tid: this.get('rowData.' + this.selectionIdDataPath)\n\t\t\t});\n\t}\n\n\tnotify(paths) { // called by option table to notify changes to added rows from an external configuration\n\t\tif (!this.rowData)\n\t\t\treturn;\n\t\tfor(let path of paths) {\n\t\t\tlet value = this.get('rowData.' + path);\n\t\t\t// call notifyPath with value and 'fromAbove' defined to prevent change from notifying back up\n\t\t\tthis.notifyPath(`rowData.${path}`, value, true);\n\t\t}\n\t}\n}\nPolymer(TableRow);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class Tabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-tabs';\n\t\tthis.properties = {\n\t\t\t// array of tab objects with the following properties\n\t\t\t// \t\tname: String - name of the tab\n\t\t\t// \t\tlabel: String - display label of the tab\n\t\t\t// \t\tpageComponent: String - page component of the tab, if undefined use sb-tabs.pageComponent\n\t\t\t// \t\tbind: Array - list of sb-tabs properties to be bound to this tab's pageComponent, if undefined use sb-tabs.bind\n\t\t\t//      iconId: icon Id\n\t\t\t//      iconClass: name of clickable icon next to the tab\n\t\t\t//      iconEvent: event name when icon is ontap\n\t\t\ttabs: Array,\n\t\t\tpageComponent: { // name of dynamic page component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tpageData: { // object with keys that match the tab.name so each page can get page specific data\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcommonData: { // object that will be passed through to all pages\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tselectedTabIndex: { // the index of the current selected tab\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tselectedPageIndex: { // the index of the current selected page\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\ttabsClass: { // class value of the paper-tabs sub component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tusePagination: { // if true use pagination widget to navigate through tabs\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpaginationClass: { // class value of the div wrapper of sb-pagination if usePagination is true\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttabLimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\trendered: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toverflowTab: Object,\n\t\t\toverflowTabClass: String,\n\t\t\toverflowTabMenuClass: String,\n\t\t\tmenuMaskClass: String,\n\t\t\tbindingData: { // object of key value pairs that represent 2-way bound data between page components and this host component\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tbind: { // array of sb-tabs bound properties that should be bound to each page component, unless overridden for a given page via the tab object in the sb-tabs.tabs array\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tattributes: { // array of objects in which each object has an name and value property that represents static attributes to bind to the page component\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\thideTabs: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcontentContainerClass: String,\n\t\t\ttabContainerClass: String,\n\t\t\tpageElements: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\toverflowTabMenuDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toverflowTabMenuLabelDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_renderObserver(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes)',\n\t\t\t'setPaginationListener(usePagination)',\n\t\t\t'updateData(pageData.*)',\n\t\t\t'updateData(commonData.*)',\n\t\t\t'_handleSelectedChangedObserver(selectedPageIndex, pageElements)'\n\t\t];\n\t}\n\n\t_renderObserver (tabs, pageComponent, pageData, commonData, bindingData, bind, attributes) {\n\t\tif (tabs === undefined || pageComponent === undefined || pageData === undefined || commonData === undefined ||\n\t\t\t bindingData === undefined || bind === undefined || attributes === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.render(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes);\n\t}\n\t\n\trender() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis._buildTabs();\n\t\tPolymer.dom(this.$.paperTabs).observeNodes(function () {\n\t\t\tthis.rendered = true;\n\t\t\tif (!this.tabs || this.tabs.length <= 0) return;\n\t\t\tthis._viewportChanged();\n\t\t}.bind(this));\n\t}\n\n\tdestroyTabs() {\n\t\tif (!this.template)\n\t\t\treturn;\n\t\t// the tabs have change, so we must remove the previous tabs set and rebuild the tabs\n\t\ttry {\n\t\t\tlet pages = Polymer.dom(this.$.pages);\n\t\t\tlet childNodes = pages.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tpages.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.selectedTabIndex = 0;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_enforceValidTabSelected() {\n\t\tif (isNaN(this.selectedPageIndex) || this.tabs && this.tabs.length <= this.selectedPageIndex || this.selectedPageIndex < 0 || this.selectedPageIndex % 1 !== 0) {\n\t\t\tthis.selectedPageIndex = 0;\n\t\t}\n\t}\n\n\t_buildTabs() {\n\t\tif(this.template) {\n\t\t\tthis._initTemplateData(this.template);\n\t\t\treturn;\n\t\t}\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis._buildPages(this.template);\n\t\tthis._initTemplateData(this.template);\n\t\tPolymer.dom(this.$.pages).appendChild(this.template);\n\t\t// Run a dom flush to update page after appending child\n\t\tPolymer.dom.flush();\n\t\t// observe for when the page components are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.pages).observeNodes(function (info) {\n\t\t\tfor (let i = 0, l = info.addedNodes.length; i < l; i++)\n\t\t\t\tthis.pageElements = this.pageElements.concat(Polymer.dom(info.addedNodes[i]).childNodes)\n\n\t\t\tthis.bindElementEvents(this.pageElements);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @param elements - the page elements\n\t */\n\tsetPageElements(elements) {\n\t\tfor(let element of elements || [])\n\t\t\tthis.pageElements.push(element)\n\t}\n\n\t_initTemplateData(template) {\n\t\ttemplate.pageData = this.pageData;\n\t\ttemplate.commonData = this.commonData;\n\t\tfor (let key in this.bindingData)\n\t\t\ttemplate[key] = this.bindingData[key];\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tthis.templateBindData(template);\n\t}\n\n\t_buildPages(template) {\n\t\tlet doc = template.content.ownerDocument;\n\t\tthis._bind = [];\n\t\tthis.tabs.forEach(function (tab, index) {\n\t\t\tlet page = tab.pageComponent || this.pageComponent;\n\t\t\tif(!page) return;\n\t\t\tlet d = doc.createElement('div');\n\t\t\tlet elem = doc.createElement(page);\n\t\t\tPolymer.dom(elem).setAttribute('name', tab.name);\n\t\t\tPolymer.dom(elem).setAttribute('label', tab.label);\n\t\t\tPolymer.dom(elem).setAttribute('tab-index', index); // lets a component know it was stamped in from a tab, and at what index\n\t\t\tPolymer.dom(elem).setAttribute('key', tab.key);\n\t\t\tPolymer.dom(elem).setAttribute('page-data', '[[pageData.' + tab.name + ']]');\n\t\t\tPolymer.dom(elem).setAttribute('common-data', '[[commonData]]');\n\t\t\tfor(let key in this.bindingData)\n\t\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\n\t\t\t// set any static attributes provided\n\t\t\tlet attributes = tab.attributes || this.attributes || {};\n\t\t\tfor(let attr of attributes)\n\t\t\t\tPolymer.dom(elem).setAttribute(attr.name, attr.value);\n\n\t\t\t// force set disabled to true if usePagination\n\t\t\tif(this.usePagination)\n\t\t\t\tthis.set('tabs.' + index + '.disabled', true);\n\n\t\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\t\tthis.appendBindData(tab, elem);\n\t\t\tPolymer.dom(d).appendChild(elem);\n\t\t\tPolymer.dom(template.content).appendChild(d);\n\t\t}.bind(this));\n\t}\n\n\tappendBindData(tab, elem) {\n\t\tlet bind = tab.bind || this.bind;\n\t\tif(!bind) return;\n\n\t\tthis._bind = this._bind.concat(bind.filter(function (item) {\n\t\t\treturn this._bind.indexOf(item) < 0;\n\t\t}.bind(this)));\n\n\t\tfor(let key of bind) {\n\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\t\t\t// this forces direct assignments of bound data to delegate through _propertyChanged because the property now has an effector\n\t\t\tthis._addComplexObserverEffect(`updateData(${key})`);\n\t\t}\n\t}\n\n\ttemplateBindData(template) {\n\t\tthis.requiresTemplateBindData = this._bind && this._bind.length > 0;\n\t\tfor(let bind of this._bind) {\n\t\t\tif(this.__data__[bind] && (this.__data__[bind] !== this[bind]) || this[bind] === undefined) {\n\t\t\t\t// calling _addComplexObserverEffect in top level tabs requires this trick in lower level tabs for same binding\n\t\t\t\tthis[bind] = this.__data__[bind];\n\t\t\t}\n\n\t\t\tif(this[bind] !== undefined) {\n\t\t\t\tthis.requiresTemplateBindData = false;\n\t\t\t\ttemplate[bind] = this[bind];\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayPage(selectedTabIndex) {\n\t\tlet selectedTab = Polymer.dom(this.$.paperTabs).querySelectorAll('paper-tab')[selectedTabIndex];\n\n\t\tif (selectedTab != null) {\n\t\t\tif (selectedTab.id === 'overflowTab' && selectedTabIndex != 0) {\n\t\t\t\treturn this.selectedPageIndex;\n\t\t\t}\n\t\t}\n\t\tthis.selectedPageIndex = +selectedTabIndex;\n\t\treturn selectedTabIndex;\n\t}\n\n\tsetPaginationListener() {\n\t\tif (this.usePagination)\n\t\t\tthis.addEventListener('pagination-changed', this.changeTab.bind(this));\n\t}\n\n\tchangeTab(e) {\n\t\tthis._changeTab(e.detail.index);\n\t}\n\n\t_changeTab(pageIndex) {\n\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\tlet tabLimit = this.tabLimit;\n\t\tlet tabLength = this.tabs.length;\n\n\t\tthis.selectedTabIndex = pageIndex;\n\n\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\n\t\t// ensure the appropriate overflow selection is marked as selected\n\t\tthis._ensureOverflowSelection();\n\n\t\t//If an overflowed tab is selected when there is overflow\n\t\tif (this.selectedTabIndex >= tabLimit && tabLength - 1 > tabLimit) {\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[this.selectedTabIndex].label);\n\t\t\t// Fixed this to use the getElementsByTagName so that it can add additional elements inside the paper tabs so that it will grab element correctly.\n\t\t\tpaperTabs.selected = paperTabs.getElementsByTagName('paper-tab').length - 1;\n\t\t\tif(this.usePagination) {\n\t\t\t\tthis.$$('#pagination').pageIndex = pageIndex;\n\t\t\t\t// if we are using pagination and an overflow tab page is selected, then the single overflow tab menu (and its label) must not be disabled\n\t\t\t\tthis.overflowTabMenuDisabled = false;\n\t\t\t\tthis.overflowTabMenuLabelDisabled = false;\n\t\t\t}\n\t\t\t//if there is overflow and a non-overflowed tab is selected\n\t\t} else if (tabLength - 2 > tabLimit) {\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t}\n\t}\n\n\t_ensureOverflowTabMenuDisabled(overflowTabMenu) {\n\t\t// first see if the overflow tab menu itself is disabled which is true only if all of its overflow tab pages are disabled\n\t\tlet overflowTabMenuDisabled = true;\n\t\tfor(let i = this.tabLimit, l = this.tabs.length; i < l; i++) {\n\t\t\tif(!this.tabs[i].disabled) {\n\t\t\t\toverflowTabMenuDisabled = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.overflowTabMenuDisabled = overflowTabMenuDisabled;\n\n\t\t// if the entire overflow tab menu is disabled, then the tab menu label is definitely disabled\n\t\tif(this.overflowTabMenuDisabled) {\n\t\t\tthis.overflowTabMenuLabelDisabled = true;\n\t\t\treturn;\n\t\t}\n\n\t\t// since at least one overflow tab page that is NOT disabled,\n\t\t// lets see if the overflow tab menu label itself represents a disabled tab page\n\t\t// if so we want it to appear disabled even though the overflow tab menu itself is enabled so the enabled overflow tab pages can be selected\n\t\tlet overflowTabMenuLabel = Polymer.dom(overflowTabMenu).firstChild.textContent;\n\t\tlet overflowTabIndex = this._getTabIndexByLabel(overflowTabMenuLabel);\n\t\tif(overflowTabIndex >= 0)\n\t\t\tthis.overflowTabMenuLabelDisabled = this.tabs[overflowTabIndex].disabled;\n\t}\n\n\t_ensureOverflowSelection() {\n\t\tlet overflowMenuItems = Polymer.dom(this.root).querySelectorAll('li');\n\t\tfor(let i = 0, l = overflowMenuItems.length; i < l; i++) {\n\t\t\tlet selected = this.selectedPageIndex === i && overflowMenuItems[i].classList.contains('overflow');\n\t\t\tlet classes = this.tabs[i].className.replace(' selected', '');\n\t\t\tif(selected) classes += ' selected';\n\t\t\tthis.set('tabs.' + i + '.className', classes);\n\t\t}\n\t}\n\n\tcloseMenu(isMenuItemSelected) {\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tthis.overflowTabMenuClass = '';\n\t\tthis.menuMaskClass = '';\n\n\t\t//If a tab in the overflowTabMenu is not selected and the currently selected page is not from an overflow tab\n\t\tif (isMenuItemSelected !== true && selectedPage < this.tabLimit) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t}\n\t}\n\n\tupdateData(e) {\n\t\tif (this.template && e && e.path)\n\t\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tselectTab(e) {\n\t\tlet index = parseInt(e.currentTarget.id);\n\t\tif(Number.isInteger(index) && this.tabs[index].disabled)\n\t\t\treturn;\n\n\t\tlet overflowTab = Polymer.dom(this.$.paperTabs.querySelector('#overflowTab')).node;\n\t\tlet tabLimit = this.tabLimit;\n\n\t\t//If a tab in the overflowTabMenu is selected\n\t\tif (Number.isInteger(index)) {\n\t\t\tthis.selectedPageIndex = index;\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tPolymer.dom(this.$.pages).node.selected = index;\n\t\t\tthis.set('tabs.' + index + '.className', 'overflow selected');\n\t\t\tthis.overflowTab = this.tabs[index];\n\t\t\tif ( this.tabs[index].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[index].iconId + '-overflow');\n\t\t\t\tthis.toggleClass('hideIconClass', false, iconSpan);\n\t\t\t}\n\n\t\t\tthis._displayOverflowTabName(overflowTab, e.currentTarget.textContent);\n\t\t\tthis.overflowTabClass = 'overflowTab';\n\t\t\tthis.closeMenu(true);\n\t\t} else if (this.tabs.length - 1 > tabLimit) {\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\t\t}\n\t}\n\n\t/**\n\t * Handle the icon is being clicked on the tab\n\t * Fire an event\n\t *\n\t * @param e - event details with the dialog and tab id info\n\t * @event event_name + '-tapped'. Event is fired with the dialog and tab id info\n\t *\n\t * @private\n\t */\n\t_handleEvent(e) {\n\t\tlet event = e.currentTarget.getAttribute('data-tap-event');\n\t\tlet id = e.currentTarget.getAttribute('id');\n\t\tlet firedEventName = (event != null) ? event : ('tab-' + Polymer.CaseMap.camelToDashCase(id));\n\t\tthis.fire ( firedEventName +'-tapped', {\n\t\t\tevent: event,\n\t\t\tId: id\n\t\t});\n\t}\n\n\tshowMenu() {\n\t\tthis.overflowTabMenuClass = 'showOverflowTabMenu';\n\t\tthis.menuMaskClass = 'showMenuMask';\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_displayOverflowTabName(overflowTab, tabToDisplay) {\n\t\tPolymer.dom(overflowTab).firstChild.textContent = tabToDisplay;\n\t\tthis.overflowTabClass = 'overflowTab';\n\t}\n\n\t_handleOverFlow() {\n\t\t//todo: Handle hiding filtered overflow tabs\n\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\tlet pagination = Polymer.dom(this.$$('#pagination')).node;\n\t\tlet tabLimit = this.tabLimit;\n\t\tlet tabLength = this.tabs.length;\n\t\tlet tabClassName, tabIndex;\n\n\t\tthis.overflowTabClass = '';\n\n\t\tfor (let i = 0; i < tabLength; i++) {\n\t\t\ttabClassName = 'noOverflow';\n\t\t\ttabIndex = tabLimit;\n\n\t\t\tif (i >= tabLimit) {\n\t\t\t\t//if there is overflow\n\t\t\t\tif (tabLength - 1 > tabLimit) {\n\t\t\t\t\t// If at last tab (the last tab is the overflow tab - a place holder tab for the tabMenu)\n\t\t\t\t\tif (i === tabLength - 1) {\n\t\t\t\t\t\tif (selectedPage >= tabLimit) {\n\t\t\t\t\t\t\ttabIndex = selectedPage;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.overflowTab = this.tabs[tabIndex];\n\t\t\t\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabIndex].label);\n\t\t\t\t\t}\n\t\t\t\t\ttabClassName = 'overflow';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(tabLength >= tabLimit) {\n\t\t\t\ttabClassName += \" widthWithOverflow\";\n\t\t\t}\n\n\t\t\t// Icon should be shown in the following scenario:\n\t\t\t// 1. Not at overflow tab\n\t\t\t// 2. On overflow tab and the first one on the list\n\t\t\tif (this.tabs[i].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[i].iconId);\n\t\t\t\tlet hideIcon =  (!(tabClassName == 'noOverflow' || (tabClassName == 'overflow' && i >= tabLimit && i != tabLength - 1)));\n\t\t\t\tthis.toggleClass('hideIconClass', hideIcon, iconSpan);\n\n\t\t\t\tif (tabClassName == 'overflow' && i === selectedPage) {\n\t\t\t\t\tlet overflowIconSpan = this.$$('#' + this.tabs[i].iconId + '-overflow');\n\t\t\t\t\tthis.toggleClass('hideIconClass', false, overflowIconSpan);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(this.tabs[i].disabled)\n\t\t\t\ttabClassName += ' disabled';\n\t\t\tthis.set('tabs.' + i + '.className', i === selectedPage ? tabClassName + ' iron-selected' : tabClassName);\n\t\t}\n\n\t\t// If there is overflow and a non overflowed tab is selected or if ther e is no overflow and the last tab is selected\n\t\tif (selectedPage < tabLimit || (tabLength - 1 === tabLimit && selectedPage === tabLimit)) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t\tthis.set('tabs.' + selectedPage + '.className', this.tabs[selectedPage].className.replace(' selected', ''));\n\t\t\t// If there is overflow and a overflowed tab is selected\n\t\t} else if (selectedPage >= tabLimit) {\n\t\t\tpaperTabs.selected = tabLength;\n\t\t\tthis.overflowTabClass = 'overflowTab';\n\t\t\tthis.set('tabs.' + selectedPage + '.className', 'overflow selected');\n\t\t}\n\n\t\tif (this.usePagination) {\n\t\t\tif (pagination != null) {\n\t\t\t\tpagination.pageIndex = selectedPage;\n\t\t\t}\n\t\t}\n\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\t}\n\n\t_handleSelectedChangedObserver (selectedPageIndex, pageElements) {\n\t\tif (selectedPageIndex === undefined || pageElements === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._handleSelectedChanged(selectedPageIndex, pageElements);\n\t}\n\t\n\t_handleSelectedChanged() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis.fire('selected-page-changed', this.selectedPageIndex);\n\t\tthis.fireTabSelected();\n\t}\n\n\tfireTabSelected() {\n\t\t//if there is a page for the selected tab, fire an event that the tab has been clicked\n\t\tif(this.pageElements.length > this.selectedPageIndex)\n\t\t\tthis.pageElements[this.selectedPageIndex].fire('sb-tab-selected');\n\t}\n\n\t_deselectPreviouslySelectedTab() {\n\t\tlet tabIndex = parseInt(Polymer.dom(this.$.overflowTabMenu.querySelector('.selected')).node.id);\n\n\t\tif (Number.isInteger(tabIndex)) {\n\t\t\tthis.set('tabs.' + tabIndex + '.className', this.tabs[tabIndex].className.replace(' selected', ''));\n\t\t}\n\t}\n\n\t_viewportChanged() {\n\t\tif (this.rendered) {\n\t\t\tif (this.viewport && this.viewport.XL.up) {\n\t\t\t\tthis.tabLimit = 7;\n\t\t\t} else if (this.viewport && this.viewport.L.up) {\n\t\t\t\tthis.tabLimit = 5;\n\t\t\t} else if (this.viewport && this.viewport.M.up) {\n\t\t\t\tthis.tabLimit = 4;\n\t\t\t} else if (this.viewport && this.viewport.S.up) {\n\t\t\t\tthis.tabLimit = 3;\n\t\t\t} else if (this.viewport && this.viewport.XS.up) {\n\t\t\t\tthis.tabLimit = 2;\n\t\t\t}\n\t\t\tthis._handleOverFlow();\n\t\t}\n\t}\n\n\tbindElementEvents(elements) {\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tif (numElements == 0)\n\t\t\treturn;\n\n\t\tthis.fireTabSelected();\n\t\tfor (let key in this.bindingData) {\n\t\t\tlet dashKey = Polymer.CaseMap.camelToDashCase(key);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components (if notify: true) up to parent component\n\t\t\t\telements[i].addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\t// propagates value changes from parent component down to each page component\n\t\t\tthis.domHost.addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\tif (!e.detail.path)\n\t\t\t\t\treturn;\n\t\t\t\tfor (let i = 0; i < numElements; i++)\n\t\t\t\t\telements[i].set(e.detail.path, e.detail.value);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tfor (let bind of this._bind) {\n\t\t\tlet dashBind = Polymer.CaseMap.camelToDashCase(bind);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components to the parent of this sb-tabs component\n\t\t\t\t// only works if the bound data of the page component and parent component are associated to the same name\n\t\t\t\telements[i].addEventListener(dashBind + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\n\t\t// In FF do this here to ensure each page has all of its dynamic bindings applied\n\t\tif(this.requiresTemplateBindData)\n\t\t\tthis.templateBindData(this.template);\n\t}\n\n\t// listens to changes from the sb-tabs parent and propagates them to the sb-tabs page component(s)\n\t_propertyChanged(property, value) {\n\t\tif(this.template && this._bind.indexOf(property.split('.')[0]) !== -1)\n\t\t\tthis.template.set(property, value);\n\t}\n\n\t// pages of this tabs component should call this function to indicate the content of the page has been filtered\n\t// if the filter applied has no visible content, then the tab matching the provided label will be disabled\n\t// if the filter applied has visible content, then the tab matching the provided label will be enabled\n\t// finally, force navigate to the \"next\" tab that has visible content to prevent being on a \"disabled\" tab\n\tcontentFilteredHandler(label, hasVisibleContent) {\n\t\tif(label == null)\n\t\t\treturn; // we need a label to move on\n\n\t\t// find the index and internal disabled state of the tab with the provided label\n\t\tlet tabIndex = this._getTabIndexByLabel(label);\n\t\tif(tabIndex < 0)\n\t\t\treturn; // we are done if the we cannot find a valid tabIndex for the provided label\n\n\t\t// update the tab's disabled state bound to the UI...so if usePagination is true its always disabled\n\t\tthis.set('tabs.' + tabIndex + '.disabled', !hasVisibleContent || this.usePagination);\n\n\t\t// update the tabs internal disabled flag (which is not bound to UI) and does not care if usePagination is true\n\t\t// the tab in this use case is disabled if its content is hidden\n\t\tthis.tabs[tabIndex]._disabled = !hasVisibleContent;\n\n\t\t// clear previously queued change to next enabled tab if called in same event loop\n\t\tif(this._changeToNextEnabledTabQueued)\n\t\t\tclearTimeout(this._changeToNextEnabledTabQueued);\n\n\t\t// Change to the next enabled tab in next event loop to ensure only called once\n\t\tthis._changeToNextEnabledTabQueued = setTimeout(this._changeToNextEnabledTab.bind(this), 1);\n\t}\n\n\t_getTabIndexByLabel(label) {\n\t\tfor (let i = 0, l = this.tabs.length; i < l; i++) {\n\t\t\tif (this.tabs[i].label === label)\n\t\t\t\treturn i\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_changeToNextEnabledTab() {\n\t\tlet nextEnabledPageIndex = this._getNextEnabledPageIndex();\n\t\tthis._changeTab(nextEnabledPageIndex);\n\t}\n\n\t_getNextEnabledPageIndex() {\n\t\t// find the next tab that is enabled\n\t\tfor(let i = this.selectedPageIndex , l = this.tabs.length; i < l; i++) {\n\t\t\tif(!this.tabs[i]._disabled)\n\t\t\t\treturn i;\n\t\t}\n\n\t\t// no next enabled tab was found, so cycle back to front of tab list to find a previous enabled tab\n\t\tfor(let ii = 0, ll = this.selectedPageIndex; ii < ll; ii++) {\n\t\t\tif(!this.tabs[ii]._disabled)\n\t\t\t\treturn ii;\n\t\t}\n\n\t\t// no tab is enabled, so stay on the current page\n\t\treturn this.selectedPageIndex\n\t}\n}\n\nPolymer(Tabs);","import {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {Util} from 'common/Util.js';\n\nexport class TableLayoutBuilder {\n\n\tconstructor(parentElWidth, columns, md, actionsOnTheLeft, hasSelection, hasStandardDrawer, columnMetadata, columnConstants, isColumnResizingEnabled, fieldsetName, newColumnMdSizesMap, dimensionType, isResetAction = false) {\n\t\tthis.parentElWidth = parentElWidth;\n\t\tthis.md = md;\n\t\tthis.columns = columns;\n\t\tthis.actionsOnTheLeft = actionsOnTheLeft;\n\t\tthis.hasSelection = hasSelection;\n\t\tthis.hasStandardDrawer = hasStandardDrawer;\n\t\tthis.columnMetadata = columnMetadata;\n\t\tthis.columnConstants = columnConstants;\n\t\tthis.isColumnResizingEnabled = isColumnResizingEnabled;\n\t\tthis.fieldsetName = fieldsetName;\n\t\tthis.newColumnMdSizesMap = newColumnMdSizesMap;\n\t\tthis.dimensionType = dimensionType;\n\t\tthis.isResetAction = isResetAction;\n\t}\n\n\t/**\n\t * Builds an object that stores width by field name\n\t * @returns {object}\n\t */\n\tbuild() {\n\t\tthis.layout = {};\n\t\tthis.availableWidth = this._getAvailableWidth();\n\t\tthis.totalColsWidth = 0;\n\n\t\tlet totalWidth = 0,\n\t\t\tminWidth = 150,\n\t\t\tnumOfCols = this.columns.length,\n\t\t\twidthPerCol = this.availableWidth / numOfCols,\n\t\t\timageCols = [];\n\t\tlet fieldsLeft = this._buildLayoutWithColumnSizing(Util.deepClone(this.columns), numOfCols);\n\t\t// Either column sizes hasn't been set or pref is off\n\t\tif(numOfCols === fieldsLeft.length) {\n\t\t\t// first pass - assign column widths and calculate the total width\n\t\t\tfor (let i = 0; i < numOfCols; i++) {\n\t\t\t\tlet col = fieldsLeft[i],\n\t\t\t\t\tcolWidth = minWidth; // ensure the smallest column is 150px wide\n\n\t\t\t\t// if an image column, then size the column with to the image width + 25 if that total size is greater the the minimum width\n\t\t\t\tlet imageWidth = new ImageCellSizer(this.md[col], 0).getImageWidth(25);\n\t\t\t\tif (imageWidth > minWidth) {\n\t\t\t\t\tcolWidth = imageWidth;\n\t\t\t\t\timageCols.push(col);\n\t\t\t\t}\n\t\t\t\t// use weighted widths only when widthPerCol is greater than min width\n\t\t\t\t// this means there is enough space to use weighted widths.\n\t\t\t\telse if (widthPerCol > minWidth) {\n\t\t\t\t\tcolWidth = Math.ceil(widthPerCol * this._getMultiplier(col));\n\t\t\t\t}\n\t\t\t\tthis.layout[col] = colWidth;\n\t\t\t\ttotalWidth += colWidth;\n\t\t\t}\n\n\t\t\tthis.totalColsWidth += totalWidth;\n\n\t\t\t// second-pass: if widthPerCol is greater than minWidth, total weighted width is greater then available width.\n\t\t\t// To make sure we don't scroll in large screens, subtract the difference equally from each column\n\t\t\t// and make sure that each column is still at least 150px wide.\n\t\t\tif (widthPerCol > minWidth) {\n\t\t\t\tlet diff = totalWidth - this.availableWidth,\n\t\t\t\t\tnumberOfColsDivisor = numOfCols - imageCols.length, // do not adjust image column widths so subtract them from total\n\t\t\t\t\ttotalAdjustedWidth = 0;\n\t\t\t\tthis.totalColsWidth = 0;\n\t\t\t\tfor (let j = 0; j < numOfCols; j++) {\n\t\t\t\t\tlet col = fieldsLeft[j];\n\t\t\t\t\tlet isImageColumn = imageCols.indexOf(col) !== -1;\n\t\t\t\t\t// adjust width if not an image column, otherwise use the image width determined in first pass\n\t\t\t\t\tlet adjustedWidth = !isImageColumn ? Math.ceil(this.layout[col] - (diff / numberOfColsDivisor)) : this.layout[col];\n\t\t\t\t\ttotalAdjustedWidth += adjustedWidth;\n\t\t\t\t\t// adjust last column for the rounding differences\n\t\t\t\t\tif (j == numOfCols - 1) {\n\t\t\t\t\t\tadjustedWidth -= totalAdjustedWidth - this.availableWidth;\n\t\t\t\t\t}\n\t\t\t\t\tthis.layout[col] = adjustedWidth;\n\t\t\t\t\tthis.totalColsWidth += adjustedWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.layout;\n\t}\n\n\t/**\n\t * If column resizing is enabled and the user action is not reset we will use the records (columnMetadata) to setup the table's layout if no adjustments\n\t * has been made in current session.\n\t * If any column sizes has been adjusted on the UI in current session, we update the layout by using the newColumnMdSizesMap\n\t * @param fieldsLeft\n\t * @returns {*}\n\t * @private\n\t */\n\t_buildLayoutWithColumnSizing(fieldsLeft) {\n\t\tif (this.isColumnResizingEnabled && !this.isResetAction) {\n\t\t\tlet knownColumnSizes = {};\n\t\t\tconst defaultSize = 150;\n\t\t\tif (this.columnMetadata && this.columnMetadata.length > 0 && this.newColumnMdSizesMap == null) {\n\t\t\t\tthis.columnMetadata.forEach((colData) => {\n\t\t\t\t\tif (colData[this.columnConstants.FieldSetMasterDetail][this.columnConstants.FieldSet] === this.fieldsetName) {\n\t\t\t\t\t\t// user have NOT resized in current session, we wil have to iterate over fields in columnMetadata\n\t\t\t\t\t\tknownColumnSizes[colData[this.columnConstants.FieldName]] = colData[this.columnConstants.FieldColumnSize];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (this.newColumnMdSizesMap != null && this.newColumnMdSizesMap[this.dimensionType]) {\n\t\t\t\t// user have resized in current session, we wil have to iterate over fields in newColumnMdSizesMap\n\t\t\t\tknownColumnSizes = Util.deepClone(this.newColumnMdSizesMap[this.dimensionType]);\n\t\t\t}\n\t\t\tfieldsLeft.forEach((field) => {\n\t\t\t\tif (knownColumnSizes[field]) {\n\t\t\t\t\tthis.layout[field] = knownColumnSizes[field];\n\t\t\t\t\tthis.totalColsWidth += knownColumnSizes[field];\n\t\t\t\t} else {\n\t\t\t\t\tthis.layout[field] = defaultSize;\n\t\t\t\t\tthis.totalColsWidth += defaultSize;\n\t\t\t\t}\n\t\t\t});\n\t\t\tfieldsLeft = fieldsLeft.filter((field) => { return !knownColumnSizes[field] });\n\t\t}\n\t\treturn fieldsLeft;\n\t}\n\n\t/**\n\t * Calculates available width within the parent element by adjusting for static columns\n\t * @returns {Number}\n\t * @private\n\t */\n\t_getAvailableWidth() {\n\t\t// take out total width for static columns and td padding for the group\n\t\treturn this.parentElWidth - this._getStaticColsWidth() - 12;\n\t}\n\n\tgetTotalWidth() {\n\t\t// td padding minus borders for the group\n\t\treturn this.totalColsWidth + this._getStaticColsWidth() + 10;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns - row number, actions, multi-select\n\t * @returns {number}\n\t * @private\n\t */\n\t_getStaticColsWidth() {\n\t\t// start with the width of the number col and the actions col\n\t\tlet width = 40 + 95;\n\t\tif (this.hasSelection) {\n\t\t\twidth += 30;\n\t\t}\n\t\tif (this.hasStandardDrawer) {\n\t\t\twidth += 40;\n\t\t}\n\t\treturn width;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns on the left\n\t * It can be different depending on the settings\n\t * @returns {number}\n\t */\n\tgetLeftOffset() {\n\t\t// start with the width of the number col\n\t\tlet offset = 40;\n\t\tif(this.actionsOnTheLeft) {\n\t\t\toffset += 95;\n\t\t}\n\t\tif (this.hasSelection) {\n\t\t\toffset += 30;\n\t\t}\n\t\treturn offset;\n\t}\n\n\t/**\n\t * Returns multiplier by field type\n\t * @param col - field name\n\t * @returns {number}\n\t * @private\n\t */\n\t_getMultiplier(col) {\n\t\t// if column is not in the metadata file, use the net total field as segments are net total columns\n\t\tlet type = this.md[col] ? this.md[col].type : 'currency';\n\n\t\tswitch(type.toUpperCase()) {\n\t\t\tcase 'STRING':\n\t\t\t\treturn 1.5;\n\t\t\t\tbreak;\n\t\t\tcase 'BOOLEAN':\n\t\t\t\treturn 1;\n\t\t\t\tbreak;\n\t\t\tcase 'DATE':\n\t\t\t\treturn 1.3;\n\t\t\t\tbreak;\n\t\t\tcase 'DOUBLE':\n\t\t\tcase 'CURRENCY':\n\t\t\tcase 'PERCENT':\n\t\t\tcase 'NUMBER':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'PICKLIST':\n\t\t\tcase 'MULTIPICKLIST':\n\t\t\t\treturn 1.4;\n\t\t\t\tbreak;\n\t\t\tcase 'REFERENCE':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'TEXTAREA':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\n","export const DEFAULT_WIDTH = 60;\nexport const DEFAULT_HEIGHT = 60;\n\nexport class ImageCellSizer {\n\n\tconstructor(metadata, labelMultiplier) {\n\t\tthis.metadata = metadata;\n\t\tthis.labelMultiplier = labelMultiplier != null ? labelMultiplier : 9;\n\t}\n\n\tgetImageWidth(padding) {\n\t\t// get the width of the first IMAGE() function in the calculatedFormula\n\t\tlet imageWidth = this._getImageWidth(padding, 0);\n\t\tif(imageWidth == null)\n\t\t\treturn; // not a formula field or does not contain any IMAGE() functions, then we are done\n\n\t\t// we found at least one IMAGE() function in the formula,\n\t\t// so lets look for other IMAGE() functions and use the max width between them\n\t\tlet width = -1;\n\t\tdo {\n\t\t\twidth = Math.max(width, imageWidth.width);\n\t\t\timageWidth = this._getImageWidth(padding, imageWidth.end);\n\t\t} while(imageWidth != null);\n\n\t\t// if while parsing the IMAGE() function(s) we found at least one width parameter that was not a hardcoded number,\n\t\t// then log a warning as without a hardcoded width for a given IMAGE() function, the default width was used instead which may not be right\n\t\tif(this.hasInvalidWidth)\n\t\t\tthis._warnInvalidWidthParameter();\n\n\t\t// returns the max width across all the IMAGE() function(s) in the formula\n\t\treturn width;\n\t}\n\n\t_getImageWidth(padding, start) {\n\t\tif(!this.metadata)\n\t\t\treturn;\n\n\t\tlet imageFunctionStartIndex = this._getImageFunctionStart(start);\n\t\t// return early if no formula or the formula does not contain the IMAGE() function\n\t\tif(imageFunctionStartIndex === -1)\n\t\t\treturn;\n\n\t\t// we have an IMAGE() function start index, so use it to get the index of its closing parenthesis\n\t\tlet imageFunctionEndIndex = this._getImageFunctionEnd(imageFunctionStartIndex);\n\n\t\t// get the IMAGE() function from the formula\n\t\tlet imageFunction = this.metadata.calculatedFormula.substring(imageFunctionStartIndex, imageFunctionEndIndex);\n\n\t\t// get the arguments passed into the IMAGE() function\n\t\tlet args = imageFunction.split(',');\n\n\t\t// width is either the a hardcoded number in the 4th argument of the IMAGE() function,\n\t\t// or DEFAULT_WIDTH will be returned if the width argument is omitted or its an non number input like a field reference\n\t\tlet imageWidth = this._getWidthFromImageFunctionArgs(args);\n\n\t\t// return the max between the image width or the width of the image's table header plus padding\n\t\tpadding = padding != null ? padding : 0;\n\t\tlet headerWidth = this.metadata.label.length * this.labelMultiplier;\n\n\t\t// return the width of the IMAGE() from its function, and return the end index to find the next IMAGE() function if applicable\n\t\treturn { width:  Math.max(imageWidth, headerWidth) + padding, end: imageFunctionEndIndex };\n\t}\n\n\t_getImageFunctionStart(start) {\n\t\treturn this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase().indexOf('image(', start) : -1\n\t}\n\n\t_getImageFunctionEnd(start) {\n\t\tlet formula = this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase() : null;\n\t\tif(!formula)\n\t\t\treturn -1;\n\n\t\t// loop through each character of the IMAGE() function and return when at least one open parenthesis,\n\t\t// and the number of open parenthesis equal the number of closed parenthesis\n\t\tlet numOpenParenthesis = 0;\n\t\tlet numClosedParenthesis = 0;\n\t\tfor(let i = start, l = formula.length; i < l; i++) {\n\t\t\tif (formula.substring(i, i + 1) === '(')\n\t\t\t\tnumOpenParenthesis++;\n\t\t\telse if (formula.substring(i, i + 1) === ')')\n\t\t\t\tnumClosedParenthesis++;\n\n\t\t\tif (numOpenParenthesis > 0 && numOpenParenthesis === numClosedParenthesis)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_getWidthFromImageFunctionArgs(args) {\n\t\t// the image width is the 4th argument in the IMAGE() function, so if not 4 arguments return the default width\n\t\tif(args.length <= 3)\n\t\t\treturn DEFAULT_WIDTH;\n\n\t\tlet width;\n\t\ttry {\n\t\t\twidth = parseInt(args[3].trim())\n\t\t} catch (e) {\n\t\t\t// cannot parse the 4th argument as an integer then mark as invalid and return the default width\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// if parsed width is not a number, then mark as invalid and return the default width\n\t\tif(isNaN(width)) {\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// return the valid numeric width provided in the 4th argument of the IMAGE() function\n\t\treturn width;\n\t}\n\n\t_warnInvalidWidthParameter() {\n\t\tconsole.warn('May not have properly sized the column to fit the image specified by this formula: \"' + this.metadata.calculatedFormula + '\"\\n' +\n\t\t\t'REASON: At least one of the formula\\'s IMAGE function(s) has its width parameter (4th argument) defined from a field.\\n' +\n\t\t\t'SOLUTION: All of the formula\\'s IMAGE function(s) should have its width parameter either omitted or hardcoded to a number.');\n\t}\n}","export class RowFieldSelector {\n\n\tconstructor(row, fields, rowIndex, rowIndexAttribute) {\n\t\tthis.row = row;\n\t\tthis.fields = fields;\n\t\tthis.rowIndex = rowIndex;\n\t\tthis.rowIndexAttribute = rowIndexAttribute || 'index';\n\t}\n\n\tselectFirstEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectNextEditableField(editable, 0);\n\t}\n\n\tselectLastEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectPreviousEditableField(editable, editable.length - 1);\n\t}\n\n\tselectNextEditableField(field) {\n\t\tlet editable = this._selectEditableFields();\n\t\tlet currentIndex = editable.indexOf(field);\n\t\tlet targetIndex = currentIndex >=0 ? currentIndex + 1 : -1;\n\t\treturn this._selectNextEditableField(editable, targetIndex);\n\t}\n\n\tselectPreviousEditableField(field) {\n\t\tlet editable = this._selectEditableFields();\n\t\tlet currentIndex = editable.indexOf(field);\n\t\tlet targetIndex = currentIndex >=0 ? currentIndex - 1 : -1;\n\t\treturn this._selectPreviousEditableField(editable, targetIndex);\n\t}\n\n\t_selectEditableFields() {\n\t\tlet editable = this.fields.filter(function(field) {\n\t\t\treturn field.isEditable();\n\t\t});\n\t\treturn editable || [];\n\t}\n\n\t_selectNextEditableField(editable, targetIndex) {\n\t\tif(targetIndex >= 0 && targetIndex < editable.length)\n\t\t\treturn editable[targetIndex];\n\n\t\treturn this._selectFirstEditableNextRow();\n\t}\n\n\t_selectPreviousEditableField(editable, targetIndex) {\n\t\tif(targetIndex >= 0 && targetIndex < editable.length)\n\t\t\treturn editable[targetIndex];\n\n\t\treturn this._selectLastEditablePreviousRow();\n\t}\n\n\t_selectFirstEditableNextRow() {\n\t\tlet nextRow = this._selectRowByIndex(this.rowIndex + 1);\n\t\tlet nextRowSelector = nextRow ? nextRow.selector : null;\n\t\tif(nextRowSelector)\n\t\t\treturn nextRowSelector.selectFirstEditableField();\n\t}\n\n\t_selectLastEditablePreviousRow() {\n\t\tlet previousRow = this._selectRowByIndex(this.rowIndex - 1);\n\t\tlet previousRowSelector = previousRow ? previousRow.selector : null;\n\t\tif(previousRowSelector)\n\t\t\treturn previousRowSelector.selectLastEditableField();\n\t}\n\n\tselectFirstEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectNextEditableField(editable, 0);\n\t}\n\n\tselectLastEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectPreviousEditableField(editable, editable.length - 1);\n\t}\n\n\t_selectRowByIndex(index) {\n\t\treturn RowFieldSelector._selectTableRowByIndex(this.row.domHost, this.row.tagName.toLowerCase(), this.rowIndexAttribute, index);\n\t}\n\n\tstatic selectFirstEditableFieldInFirstRow(table, rowName, rowIndexAttribute) {\n\t\tlet firstRow = RowFieldSelector._selectTableRowByIndex(table, rowName, rowIndexAttribute, 0);\n\t\tlet selector = firstRow ? firstRow.selector : null;\n\t\tif(selector)\n\t\t\treturn selector.selectFirstEditableField();\n\t}\n\n\tstatic selectLastEditableFieldInLastRow(table, rowName, rowNum, rowIndexAttribute) {\n\t\tlet lastRow = RowFieldSelector._selectTableRowByIndex(table, rowName, rowIndexAttribute, rowNum - 1);\n\t\tlet selector = lastRow ? lastRow.selector : null;\n\t\tif(selector)\n\t\t\treturn selector.selectLastEditableField();\n\t}\n\n\tstatic _selectTableRowByIndex(table, rowName, rowIndexAttribute, index) {\n\t\treturn table.$$(`${rowName}[${rowIndexAttribute}=\"${index}\"]`);\n\t}\n}","export class TableClassBuilder {\n\n\t/**\n\t * Constructor\n\t * @param {Object} columns array of columns to internally iterate over when constructing the map\n\t * @param {String} firstLastClassSuffix the CSS class suffix to append to the first and last column\n\t * @param {Object} typeByColumnMap Map of columns to data types.  Keys must match values in columns parameter\n\t * @param {String} allColumnClasses CSS class names to apply to all columns\n\t * @param {Boolean} useColumnsIndexAsKey When true, use the columns parameter array index as the Map key, otherwise use value in columns array as key\n\t */\n\tconstructor(columns, firstLastClassSuffix, typeByColumnMap, allColumnClasses, useColumnsIndexAsKey) {\n\t\tthis.columns = columns;\n\t\tthis.firstLastClassSuffix = firstLastClassSuffix;\n\t\tthis.typeByColumnMap = typeByColumnMap;\n\t\tthis.allColumnClasses = allColumnClasses || [];\n\t\tthis.useColumnsIndexAsKey = useColumnsIndexAsKey || false;\n\t}\n\n\t/**\n\t * Builds a Map of column keys to CSS class names (as a single string) to apply to each column (cell).\n\t */\n\tbuild() {\n\t\tlet classMap = {};\n\t\tthis._appendTypeClass(classMap);\n\t\tthis._appendFirstAndLastColumnClasses(classMap);\n\t\tthis._appendAllColumnClasses(classMap);\n\t\tthis._addWidthStyles(classMap);\n\t\treturn classMap;\n\t}\n\n\t_appendTypeClass(classMap) {\n\t\tif (!this.typeByColumnMap)\n\t\t\treturn;\n\n\t\tlet prevNumeric = false;\n\t\tlet index = 0;\n\t\tfor (let col of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[col];\n\t\t\tlet isNumeric = this._isNumericType(type);\n\t\t\tlet isBoolean = this._isBooleanType(type);\n\t\t\tlet key = this.useColumnsIndexAsKey ? index++ : col;\n\n\t\t\tif (isNumeric)\n\t\t\t\tthis._appendClass(classMap, key, 'numericCell');\n\t\t\telse if (isBoolean)\n\t\t\t\tthis._appendClass(classMap, key, 'checkboxCell');\n\t\t\telse if (prevNumeric)\n\t\t\t\tthis._appendClass(classMap, key, 'afterNumericCell');\n\n\t\t\tprevNumeric = isNumeric;\n\t\t}\n\t}\n\n\t_appendFirstAndLastColumnClasses(classMap) {\n\t\tlet firstInnerClass = 'firstInner' + this.firstLastClassSuffix;\n\t\tlet lastInnerClass = 'lastInner' + this.firstLastClassSuffix;\n\t\tlet secondInnerClass = 'secondInner' + this.firstLastClassSuffix;\n\n\t\tthis._appendClass(classMap, this.useColumnsIndexAsKey ? 0 : this.columns[0], firstInnerClass);\n\t\tthis._appendClass(classMap, this.useColumnsIndexAsKey ? this.columns.length - 1 : this.columns[this.columns.length - 1], lastInnerClass);\n\t\tif (this.columns.length > 1)\n\t\t\tthis._appendClass(classMap, this.useColumnsIndexAsKey ? 1 : this.columns[1], secondInnerClass);\n\t}\n\n\t_appendAllColumnClasses(classMap) {\n\t\tfor (let column of this.columns) {\n\t\t\tfor (let columnClass of this.allColumnClasses)\n\t\t\t\tthis._appendClass(classMap, column, columnClass);\n\t\t}\n\t}\n\n\t_addWidthStyles(classMap) {\n\t\tlet index = 0;\n\t\tfor (let column of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[column];\n\t\t\tlet typeAndWidth = type.split(':'); // check to see if the type is in the format type:width\n\t\t\tif (typeAndWidth.length === 2) {\n\t\t\t\tthis._setWidthStyle(classMap, this.useColumnsIndexAsKey ? index : column, typeAndWidth[1]);\n\t\t\t}\n\t\t\tindex++;\n\t\t}\n\t}\n\n\t_isNumericType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'double' || type === 'number' || type === 'currency' || type === 'percent';\n\t}\n\n\t_isBooleanType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'boolean' || type === 'checkbox'\n\t}\n\n\t_appendClass(classMap, key, classToAppend) {\n\t\tif (!classMap[key])\n\t\t\tclassMap[key] = {};\n\n\t\tlet existingClass = classMap[key].class;\n\t\tclassMap[key].class = existingClass ? (existingClass + ' ' + classToAppend) : classToAppend;\n\t}\n\n\t_setWidthStyle(classMap, key, width) {\n\t\tif (!classMap[key])\n\t\t\tclassMap[key] = {};\n\t\tclassMap[key].style = `width:${width}px`;\n\t}\n}","export class OpContains {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tvar fStr = String(fieldValue).toLowerCase();\n\t\tvar tStr = String(testValue).toLowerCase();\n\t\treturn fStr.indexOf(tStr) !== -1;\n\t}\n}","export class OpEndsWith {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif (fieldValue == null || testValue == null) {\n\t\t\treturn false;\n\t\t}\n\t\tvar fStr = String(fieldValue).toLowerCase();\n\t\tvar tStr = String(testValue).toLowerCase();\n\t\treturn fStr.indexOf(tStr, fStr.length - tStr.length) !== -1;\n\t}\n}","export class OpEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.testValueCache = {};\n\t\tthis.fieldValueCache = {};\n\t}\n\n\n\tevaluate(fieldValue, testValue) {\n\t\t// if either is null, check if both are null\n\t\tif (fieldValue == null || testValue == null) {\n\t\t\treturn fieldValue == testValue;\n\t\t}\n\t\tif (fieldValue instanceof Date) {\n\t\t\t// TODO: YOU MIGHT NEED TO IMPLEMENT SOMETHING FOR DATETIME!\n\t\t\t// if the field value is a date, the testValue, which is a string, needs to be converted to a date\n\t\t\treturn fieldValue.getTime() === (new Date(testValue)).getTime();\n\t\t} else if (typeof fieldValue === \"boolean\") {\n\t\t\t// Likewise, if fv is a boolean, tv needs to be one as well\n\t\t\treturn fieldValue === (String(testValue).toLowerCase() === \"true\");\n\t\t} else if (typeof fieldValue === \"string\" && typeof testValue === \"string\") {\n\t\t\t// This value needs to be stored in the testvalue cache so comma-separated values can be handled\n\t\t\tvar lowerCaseTest = testValue.toLowerCase();\n\t\t\tvar lowerCaseField = fieldValue.toLowerCase();\n\t\t\tif (this.testValueCache[lowerCaseTest] == null) {\n\t\t\t\tthis.testValueCache[lowerCaseTest] = this.valueFor(lowerCaseTest);\n\t\t\t}\n\t\t\t// Same as above\n\t\t\tif (this.fieldValueCache[lowerCaseField] == null) {\n\t\t\t\tthis.fieldValueCache[lowerCaseField] = this.valueFor(lowerCaseField);\n\t\t\t}\n\t\t\treturn this.testValueCache[lowerCaseTest].equals(this.fieldValueCache[lowerCaseField]);\n\t\t} else if (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() == testValue;\n\t\t}\n\t\t// If it's none of those types, return false\n\t\treturn false;\n\t}\n\n\n\tvalueFor(value) {\n\t\tif ((value.indexOf(',') > -1) && (value.indexOf('\"') != 0) && (value.lastIndexOf('\"') != value.length - 1)) {\n\t\t\t// Return a MultipleValue object\n\t\t\treturn {\n\t\t\t\tvalueType: 'Multi',\n\t\t\t\tvalueSet: value.split(',').map(function(v) {return v.trim()}),\n\t\t\t\tequals: function(otherValue) {\n\t\t\t\t\tif (otherValue.valueType === 'Multi') {\n\t\t\t\t\t\tvar otherVals = otherValue.valueSet;\n\t\t\t\t\t\treturn otherVals.some(function(v) {return this.valueSet.indexOf(v) != -1}, this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.valueSet.indexOf(otherValue.value) != -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Return a Value object\n\t\t\treturn {\n\t\t\t\tvalueType: 'Single',\n\t\t\t\tvalue: value,\n\t\t\t\tequals: function(otherValue) {\n\t\t\t\t\treturn this.value === otherValue.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}","export class OpGreaterThan {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() > testValue;\n\t\t} else if (fieldValue instanceof Date) {\n\t\t\treturn fieldValue > new Date(testValue);\n\t\t} else if (typeof fieldValue == 'string') {\n\t\t\tvar fieldTime = Date.parse(fieldValue);\n\t\t\tvar testTime = Date.parse(testValue);\n\t\t\tif ((fieldTime === fieldTime) && (testTime === testTime)) {\n\t\t\t\t// If they're both numbers...\n\t\t\t\treturn fieldTime > testTime;\n\t\t\t}\n\t\t\treturn fieldValue.toLowerCase() > testValue.toLowerCase();\n\t\t}\n\t\treturn false;\n\t}\n}","export class OpGreaterThanEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() >= testValue;\n\t\t} else if (fieldValue instanceof Date) {\n\t\t\treturn fieldValue >= new Date(testValue);\n\t\t} else if (typeof fieldValue == 'string') {\n\t\t\tvar fieldTime = Date.parse(fieldValue);\n\t\t\tvar testTime = Date.parse(testValue);\n\t\t\tif ((fieldTime === fieldTime) && (testTime === testTime)) {\n\t\t\t\t// If they're both numbers...\n\t\t\t\treturn fieldTime >= testTime;\n\t\t\t}\n\t\t\treturn fieldValue >= testValue;\n\t\t}\n\t\treturn false;\n\t}\n}","import {OpGreaterThanEquals} from 'common/rules/operators/OpGreaterThanEquals.js';\n\nexport class OpLessThan {\n\t// If fieldValue is not greater than or equal to testValue, it's less than.\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.gte = new OpGreaterThanEquals();\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null) || (typeof fieldValue !== \"number\" && typeof fieldValue !== 'string' && !(fieldValue instanceof Date || fieldValue instanceof Number))) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.gte.evaluate(fieldValue, testValue);\n\t}\n}","import {OpGreaterThan} from 'common/rules/operators/OpGreaterThan.js';\n\nexport class OpLessThanEquals {\n\t// If fieldValue is not greater than testValue, it's less than or equal\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.gt = new OpGreaterThan();\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null) || (typeof fieldValue !== \"number\" && typeof fieldValue !== 'string' && !(fieldValue instanceof Date || fieldValue instanceof Number))) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.gt.evaluate(fieldValue, testValue);\n\t}\n}","import {OpEquals} from 'common/rules/operators/OpEquals.js';\n\nexport class OpNotEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.equals = new OpEquals();\n\t}\n\n\n\tevaluate(fieldValue, testValue) {\n\t\treturn !this.equals.evaluate(fieldValue, testValue);\n\t}\n}","export class OpStartsWith {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn (String(fieldValue).toLowerCase()).indexOf(String(testValue).toLowerCase()) === 0;\n\t}\n}","/**\n * PORTED OVER FORM COMMON/CALC FOR USE IN RULES ENGINE\n */\nimport {OpEquals} from 'common/rules/operators/OpEquals.js';\nimport {OpNotEquals} from 'common/rules/operators/OpNotEquals.js';\nimport {OpLessThan} from 'common/rules/operators/OpLessThan.js';\nimport {OpLessThanEquals} from 'common/rules/operators/OpLessThanEquals.js';\nimport {OpGreaterThan} from 'common/rules/operators/OpGreaterThan.js';\nimport {OpGreaterThanEquals} from 'common/rules/operators/OpGreaterThanEquals.js';\nimport {OpStartsWith} from 'common/rules/operators/OpStartsWith.js';\nimport {OpEndsWith} from 'common/rules/operators/OpEndsWith.js';\nimport {OpContains} from 'common/rules/operators/OpContains.js';\n\nexport class OperatorsUtils {\n\t/**\n\t * Creates an OperatorsUtils instance to return the appropriate subclass\n\t * @param {String} key The operation desired\n\t */\n\n\tconstructor(key) {\n\t\tthis.key = key;\n\t\tthis.OP_EQ = \"equals\";\n\t\tthis.OP_NEQ = \"not equals\";\n\t\tthis.OP_LT = \"less than\";\n\t\tthis.OP_LTE = \"less or equals\";\n\t\tthis.OP_GT = \"greater than\";\n\t\tthis.OP_GTE = \"greater or equals\";\n\t\tthis.OP_SW = \"starts with\";\n\t\tthis.OP_EW = \"ends with\";\n\t\tthis.OP_CONT = \"contains\";\n\t}\n\n\t/**\n\t * Returns an object that can perform the desired comparison between two values\n\t * @returns {Object} An object that is guaranteed to have a method \"evaluate(a, b)\"\n\t */\n\tgetInstance() {\n\t\tswitch (this.key) {\n\t\t\tcase this.OP_EQ:\n\t\t\t\treturn new OpEquals(this.key);\n\t\t\tcase this.OP_NEQ:\n\t\t\t\treturn new OpNotEquals(this.key);\n\t\t\tcase this.OP_LT:\n\t\t\t\treturn new OpLessThan(this.key);\n\t\t\tcase this.OP_LTE:\n\t\t\t\treturn new OpLessThanEquals(this.key);\n\t\t\tcase this.OP_GT:\n\t\t\t\treturn new OpGreaterThan(this.key);\n\t\t\tcase this.OP_GTE:\n\t\t\t\treturn new OpGreaterThanEquals(this.key);\n\t\t\tcase this.OP_SW:\n\t\t\t\treturn new OpStartsWith(this.key);\n\t\t\tcase this.OP_EW:\n\t\t\t\treturn new OpEndsWith(this.key);\n\t\t\tcase this.OP_CONT:\n\t\t\t\treturn new OpContains(this.key);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Returns an object that can perform the inverse of the desired comparison between two values.\n\t * i.e. The operator that returns the same result when the order of the arguments is reversed.\n\t * @returns {Object} An object that is guaranteed to have a method \"evaluate(a, b)\"}\n\t */\n\n\tgetInverseInstance() {\n\t\tswitch (this.key) {\n\t\t\tcase this.OP_EQ:\n\t\t\t\treturn new OpEquals(this.key);\n\t\t\tcase this.OP_NEQ:\n\t\t\t\treturn new OpNotEquals(this.key);\n\t\t\tcase this.OP_LT:\n\t\t\t\treturn new OpGreaterThan(this.key);\n\t\t\tcase this.OP_LTE:\n\t\t\t\treturn new OpGreaterThanEquals(this.key);\n\t\t\tcase this.OP_GT:\n\t\t\t\treturn new OpLessThan(this.key);\n\t\t\tcase this.OP_GTE:\n\t\t\t\treturn new OpLessThanEquals(this.key);\n\t\t\tcase this.OP_SW:\n\t\t\t\treturn new OpStartsWith(this.key);\n\t\t\tcase this.OP_EW:\n\t\t\t\treturn new OpEndsWith(this.key);\n\t\t\tcase this.OP_CONT:\n\t\t\t\treturn new OpContains(this.key);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldMetadata {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-md';\n\t\tthis.properties = {\n\t\t\tfields: Array,\n\t\t\tobject: String,\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdoNotFixObjectName : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\tget observers() {\n\t\treturn ['initFieldSetDescribe(fields)']\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function (e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldNames = e.detail.value.fields,\n\t\t\t\tfields = [],\n\t\t\t\tfieldsByObject = {};\n\t\t\tfor (let i = 0, l = fieldNames.length; i < l; i++) {\n\t\t\t\tif (!md[fieldNames[i]])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet object = fieldNames[i].split('.')[0],\n\t\t\t\t\tfield = fieldNames[i].split('.')[1];\n\t\t\t\tif(!fieldsByObject[object])\n\t\t\t\t\tfieldsByObject[object] = {};\n\n\t\t\t\tfields.push(md[fieldNames[i]]);\n\t\t\t\tfieldsByObject[object][field] = md[fieldNames[i]];\n\t\t\t}\n\t\t\t//Array or map of maps for object{fields allowing the caller to pick and choose\n\t\t\tthis.md = {fields: fields, fieldsByObject: fieldsByObject};\n\t\t}.bind(this));\n\t\tthis.$.describe.addEventListener('error-changed', function (e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this))\n\t}\n\n\tinitFieldSetDescribe() {\n\t\tlet fields = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tlet fieldSplit = field.split('.');\n\t\t\tif(fieldSplit.length === 2)\n\t\t\t\tfields.push(this.buildFieldList(fieldSplit[0], fieldSplit[1]));\n\t\t\telse\n\t\t\t\tfields.push(this.buildFieldList(this.object, field));\n\t\t}.bind(this));\n\t\tthis.$.describe.fields = fields;\n\t}\n\n\tbuildFieldList(target, field) {\n\t\t//Adding the prefix programmatically so that callers don't need to figure this out\n\t\t//Should the caller add it, we won't add it again\n\t\tif (!this.doNotFixObjectName && target.endsWith('__c') && !target.startsWith(this.prefix))\n\t\t\treturn this.prefix + target + '.' + field;\n\n\t\treturn target + '.' + field;\n\t}\n}\n\nPolymer(FieldMetadata);","import {put, clear} from 'quotes/models/SafeClientCache.js';\n\n// Constant status which are used for checking if it's failed or completed\nconst COMPLETED  = 'Completed';\nconst FAILED = 'Failed';\nconst ABORTED = 'Aborted';\n\n/**\n *  <sb-job-checker> To send out the asynchronize call back to the server using <sb-service>\n *\n *  Features:\n *      - Minimum requirement to call this component to set the data property correctly. Format is included in the property.\n *      - Return the following result:\n *          - Status - Job Status from the server.\n *          - Result - Final result from the server\n *      - Loading Spinner:\n *          If you do not need to use it, you can set the useSpinner as false when you call this component. By default, it's true\n *\n **/\nexport class JobChecker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-job-checker';\n\t\tthis.properties = {\n\n\t\t\t/** This property is enabled to ensure that spinner is loaded when the component is ready */\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * This property is to allow the caller to determine whether we should the spinner or not.\n\t\t\t * If the caller prefers to disable the spinner, it can set it as false to disable the spinner\n\t\t\t * */\n\t\t\tuseSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * [Required] To use to pass information to server (Format: {recordId: recordId_num, jobId: jobId_num, jobType: QuoteCalculator})\n\t\t\t */\n\t\t\tdata: Object,\n\n\t\t\t/** [Result] Status from server */\n\t\t\tstatus: String,\n\n\t\t\t/** [Result] Final result from the server */\n\t\t\tresult: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\n\t\t\t/** [Result] Error from the server */\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\n\t\t\t/** A handle list which is used for cancelSync once the task is completed */\n\t\t\tasyncNumList: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\n\t\t\t/** First time when the component is being used from the caller */\n\t\t\tfirstStatusTime: Number,\n\n\t\t\t/** latest time when the component is being used from the caller. Mainly from the asych */\n\t\t\tlastStatusTime: Number\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_ping(data)'];\n\n\t}\n\n\t/**\n\t *\n\t * @private:        To determine whether the loading spinner should be shown or not.\n\t *\n\t * @returns {boolean|*|JobChecker.properties.useSpinner|{type, value}}\n\t */\n\t_useSpinner(){\n\t\treturn this.spinner && this.useSpinner;\n\t}\n\n\tready() {\n\t\tthis.firstStatusTime = Date.now();\n\t\tthis.lastStatusTime = Date.now();\n\t\tthis._setLoadingSpinner(false);\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis._checkStatus(e);\n\t\t}.bind(this));\n\n\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t\t// Turn off the spinner if there's error occurred\n\t\t\tthis._setLoadingSpinner(false);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @private         To control whether we should use the loading spinner in this component\n\t *\n\t * @param {Boolean} value\n\t */\n\t_setLoadingSpinner(value) {\n\t\tthis.spinner = value;\n\t\tput('RootState', 'showSpinnerMessage', value);\n\n\t\t// clear the status messaging from the spinner\n\t\tif (value === false) {\n\t\t\tclear('RootState', 'spinnerStatus');\n\t\t}\n\t\tthis.$.loadingSpinner.show = this._useSpinner();\n\t}\n\n\t/**\n\t *\n\t * @private: To ping the server via sb-service to get the response\n\t *\n\t * @param data\n\t */\n\t_ping(data) {\n\t\tthis._setLoadingSpinner(true);\n\t\t// Turn off the sb-service loading spinner. Use the sb-job-checker's one\n\t\tthis.$.service.background = true;\n\t\tthis.$.service.model = undefined;\n\t\tthis.$.service.model = data;\n\t}\n\n\t/**\n\t * @private:    To check the status from the Queueable checker class in Apex. This will deteremine whether the job is completed or not.\n\t *              To the check the status of the job\n\t *              - Send out the job asynch via sb-service component\n\t *              - Get the latest status received time.\n\t *              - Store the return result from the server to the component\n\t *              - Console log the status on the brower for developer to debug ( This can be removed in the future\n\t *              - Fire an event job-completed when the status is finished\n\t *\n\t * @param e     event detail coming from the response\n\t * @event job-completed\n\t */\n\t_checkStatus(e) {\n\t\tlet result = e.detail.value;\n\t\tif ( result != null) {\n\t\t\tlet jobId = result.job.Id || result.jobId;\n\t\t\tthis._setJobStatus(result.job.Status);\n\t\t\tif (!this._isFinished()) {\n\t\t\t\tthis.lastStatusTime = Date.now();\n\t\t\t\tthis.data.jobId = jobId;\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tlet asyncNum = this.async(function () {\n\t\t\t\t\tthis._ping(this.data);\n\t\t\t\t}.bind(this), 1000);\n\t\t\t\tthis.asyncNumList.push(asyncNum);\n\t\t\t}\n\t\t \telse if(this._isFailure()) {\n\t\t\t\tthis.error = {message: result.job.ExtendedStatus};\n\t\t\t\tthis._setLoadingSpinner(false);\n\t\t\t}\n\t\t\telse { // COMPLETED\n\n\t\t\t\t// The first time which the job is completed, it will get the result from the payload\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.result = result;\n\t\t\t\t\tfor (let i = 0; i < this.asyncNumList.length; i++) {\n\t\t\t\t\t\tthis.cancelAsync(this.asyncNumList[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tthis._setLoadingSpinner(false);\n\t\t\t\t// To fire an event that the job completed so that the caller knows and they can execute other operations that they need\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.fire('job-completed');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * A setter method for the async job's current status.\n\t *\n\t * @param {string} status - The status of the current async job.\n\t */\n\t_setJobStatus(status) {\n\t\tthis.status = status;\n\t\tlet convertedStatus = this._convertJobStatus(status);\n\t\tput('RootState', 'spinnerStatus', convertedStatus);\n\t}\n\n\t/**\n\t * Given a job status from the server, this method translates it into\n\t * a human readable format by mapping technical values to friendly\n\t * values.\n\t *\n\t * @param {string} status - The job status currently.\n\t *\n\t * @returns a human-readable job status.\n\t */\n\t_convertJobStatus(status) {\n\t\t// only add to the values that need to be changed, other statuses\n\t\t// will just pass through normally\n\t\tconst statusMap = {\n\t\t\t\"Queued\": \"Waiting\",\n\t\t\t\"Holding\": \"Waiting\",\n\t\t\t\"Aborted\": \"Cancelled\"\n\t\t}\n\t\treturn statusMap[status] || status;\n\t}\n\n\t/**\n\t * @private:    This status message can be removed in the future\n\t */\n\t_getStatusMessages() {\n\t\tlet waitTime = Date.now() - this.lastStatusTime;\n\t\t// Display this status message in the console log so that we know what job is running in the background\n\t\tconsole.log('Record Id: ' + this.data.recordId + ' Job Type: ' + this.data.jobType + ' [Job Id: ' + this.data.jobId + ' - Status:' + this.status + '] Time : ' + (this.lastStatusTime - this.firstStatusTime) + ' [Wait Time: ' + waitTime + ']');\n\t}\n\n\n\t/**\n\t *\n\t * @private         To determine if the status from the status is failure status\n\t * @return {Boolean}\n\t * */\n\t_isFailure() {\n\t\treturn this.status  && (this.status == ABORTED || this.status == FAILED);\n\t}\n\n\t/**\n\t * @private     To determine if the status from the status is completed or not. It can be succesful or failed.\n\t * @return  {Boolean}\n\t * */\n\t_isFinished() {\n\t\treturn (this.status && (this.status == COMPLETED || this._isFailure()));\n\t}\n}\n\nPolymer( JobChecker );\n","import {Cache} from 'common/data/cache/Cache.js';\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nfunction loadNewModel(quoteId, prefix) {\n\tlet connClient = new ConnectionClient(prefix);\n\tlet modelRequest = connClient.getConnection()\n\t\t.then(connection => new window.SB.QuoteDAO(prefix, connection))\n\t\t.then(quoteDAO => quoteDAO.loadEditorModel(quoteId));\n\n\tCache.add('LineEditor', quoteId, modelRequest, 'promise');\n\treturn modelRequest;\n}\n\nfunction loadModel(quoteId, prefix) {\n\tlet loadingModel = Cache.get('LineEditor', quoteId, 'promise');\n\n\tif(loadingModel) {\n\t\treturn loadingModel;\n\t} else {\n\t\treturn loadNewModel(quoteId, prefix);\n\t}\n}\n\nfunction trim(quoteId) {\n\treturn (quoteId).substring(0,15);\n}\n\nexport class LineEditorReader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor-read';\n\t\tthis.properties = {\n\t\t\tquoteId: String,\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlineEditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_updateObserver(quoteId, background)'];\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix : '';\n\t}\n\n\t_updateObserver (quoteId, background) {\n\t\tif (quoteId === undefined || background === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._update(quoteId, background);\n\t}\n\t\n\t/**\n\t * Updates params.lineEditorModel the the model for a given quoteId\n\t * hardReload = true will clear the cache, forcing the model to be queried from the server.\n\t * @param hardReload\n\t */\n\tupdate(hardReload) {\n\t\tif(hardReload) this.clearCache();\n\t\tthis._update(this.quoteId);\n\t}\n\n\t_update(quoteId) {\n\t\tthis.$.loadingSpinner.show = true;\n\t\tlet trimmedQuoteId = trim(quoteId);\n\t\tlet cachedModel = Cache.get('LineEditor', trimmedQuoteId);\n\n\t\tif(cachedModel) {\n\t\t\t// async is currently required so product lookup had a chance to set up event listener\n\t\t\tthis.async(() => {\n\t\t\t\tthis.lineEditorModel = cachedModel;\n\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t});\n\t\t} else {\n\t\t\tloadModel(trimmedQuoteId, this.prefix)\n\t\t\t\t.then(model => {\n\t\t\t\t\t// 'Incomplete' means the background job isn't complete.\n\t\t\t\t\tif(model === 'Incomplete') {\n\t\t\t\t\t\tthis._retryUpdateLater(trimmedQuoteId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cache(trimmedQuoteId, model);\n\t\t\t\t\t\tthis.lineEditorModel = model;\n\t\t\t\t\t\tthis._setIsLastReadQuoteUnopened();\n\t\t\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t\t\t\tthis.startingPolling = null;\n\t\t\t\t\t}\n\t\t\t\t}).catch(function(e) {\n\t\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t\t\tthis.fire('toggle-page-loaded', {pageLoaded: true});\n\t\t\t\t\tthis.error = [e.message || e];\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tclearCache() {\n\t\tlet quoteId = trim(this.quoteId);\n\t\tthis._clearedLineEditor = Cache.get('LineEditor', quoteId);\n\t\tCache.remove('LineEditor', quoteId, 'promise');\n\t\tCache.remove('LineEditor', quoteId, 'value');\n\t}\n\n\trestoreCache() {\n\t\tif(!this._clearedLineEditor) return;\n\t\tlet quoteId = trim(this.quoteId);\n\t\tthis.cache(quoteId, this._clearedLineEditor);\n\t\tthis._clearedLineEditor = null;\n\t}\n\n\tcache(quoteId, lineEditorModel) {\n\t\tCache.add('LineEditor', trim(quoteId), lineEditorModel, 'value', this);\n\t}\n\n\t_setIsLastReadQuoteUnopened() {\n\t\tthis.isLastReadQuoteUnopened = this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix + 'Unopened__c'];\n\t\tthis.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix + 'Unopened__c'] = false;\n\t}\n\n\t_retryUpdateLater(quoteId) {\n\t\tthis.startedPolling = this.startedPolling || Date.now();\n\t\tconst waitTime = Date.now() - this.startedPolling;\n\n\t\tthis.async(() => {\n\t\t\tconsole.log(`Reading Quote Id: ${quoteId} [Wait Time: ${waitTime}]`);\n\t\t\tthis.update(true); // Force request for line editor model\n\t\t}, 1000);\n\t}\n}\n\nPolymer(LineEditorReader);\n","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteMinimizer} from 'common/data/minimize/QuoteMinimizer.js';\nimport {QuoteAggregator} from 'common/aggregate/quote-aggregator/QuoteAggregator.js';\n\nexport class ProductRulesQuoteLineAdder {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-rules-quote-line-adder';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproductIds: Array,\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlinesAddedByRules: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ '_addLinesObserver(quote, productIds)' ];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.linesAddedByRules = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t_addLinesObserver (quote, productIds) {\n\t\tif (quote === undefined || productIds === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.addLines(quote, productIds);\n\t}\n\t\n\taddLines() {\n\t\tlet builder = new DataBuilder();\n\t\tbuilder.add('productIds', this.productIds);\n\t\tif (this.quote.targetGroupKey != null && this.quote.targetGroupKey >= 0)\n\t\t\tbuilder.add('groupKey', this.quote.targetGroupKey);\n\n\t\tlet min = new QuoteMinimizer(this.quote, this.productIds, this.quote.targetGroupKey);\n\t\tthis.quote = min.reduceQuote(false);\n\n\t\tbuilder.addQuote('quote', this.quote);\n\t\tthis.$.service.model = builder.build();\n\t\t// Now that we've sent the quote, we should remove all of the temporary attributes we added to it.\n\t\tthis.quote = min.revertQuote();\n\t}\n}\nPolymer(ProductRulesQuoteLineAdder);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class SearchModelLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-load';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlineAggregationMethod: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tprocessId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilters: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_loadObserver(quote, processId, actionId)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t_loadObserver (quote, processId, actionId) {\n\t\tif (quote === undefined || processId === undefined || actionId === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.load(quote, processId, actionId);\n\t}\n\t\n\tload() {\n\t\tthis.$.service.uid = null;\n\t\tvar dataModel = new DataBuilder()\n\t\t\t.add('processId', this.processId)\n\t\t\t.add('actionId', this.actionId)\n\t\t\t.add('filters', this.filters)\n\t\t\t.add('fieldSet', this.fieldSet);\n\t\tif (this.sendQuoteRecord) {\n\t\t\tdataModel.addObject('quote', this.quote.record);\n\t\t} else {\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t}\n\t\t// If there's a method specified by which we should aggregate line data, make sure that the aggregation method actually\n\t\t// exists, and then use it to aggregate the data over all the quote lines. If any data is returned, attach\n\t\t// it to the data model.\n\t\tif (this.lineAggregationMethod) {\n\t\t\tlet aggregator = new QuoteLineAggregator(this.quote);\n\t\t\tif (aggregator[this.lineAggregationMethod]) {\n\t\t\t\tlet aggregatedData = aggregator[this.lineAggregationMethod]();\n\t\t\t\tif (aggregatedData) {\n\t\t\t\t\tdataModel.addObject('aggregateLineData', aggregatedData, undefined, undefined, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.$.service.context = dataModel.build();\n\t}\n\n}\nPolymer(SearchModelLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class SearchModelSelector {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-select';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tstripQuoteLines: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedProductList: Array,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresult: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ttargetGroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquoteProcess: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsaver: String,\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tuseCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tusesClientCalculator: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_invokeSaverObserver(selectedProducts, quote)',\n\t\t\t'_invokeSaver(selectedProductList)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.result = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t_invokeSaverObserver (selectedProducts, quote) {\n\t\tif (selectedProducts === undefined || quote === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.invokeSaver(selectedProducts, quote);\n\t}\n\t\n\tinvokeSaver() {\n\t\tlet selectionArray = [];\n\t\tfor (let val in this.selectedProducts)\n\t\t\tselectionArray.push(this.selectedProducts[val]);\n\t\tthis.selectedProductList = selectionArray;\n\t}\n\n\t_invokeSaver() {\n\t\tif(this.useCache === true) //we almost always want to cache this response, but not always\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tlet lines = this.quote.lineItems;\n\t\tvar dataModel = new DataBuilder()\n\t\t\t.addObject('products', this.selectedProductList)\n\t\t\t.add('targetGroupKey', this.targetGroupKey)\n\t\t\t.addObject('quoteProcess', this.quoteProcess);\n\t\tif (this.sendQuoteRecord) {\n\t\t\tdataModel.addObject('quoteRecord', this.quote.record);\n\t\t}\n\t\t// If using JSQC, send the Quote without its lines to maximize scalability\n\t\telse if (this.stripQuoteLines && this.usesClientCalculator) {\n\t\t\tthis.quote.lineItems = [];\n\t\t\tthis.quote.partialVO = lines.length != 0;\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t} else{\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t}\n\t\tthis.$.service.model = dataModel.build();\n\t\t// Add the Quote Lines back to the Quote\n\t\tthis.quote.lineItems = lines;\n\t\tthis.quote.partialVO = false;\n\t}\n}\nPolymer(SearchModelSelector);","import {ProductViewModel} from 'products/config/viewmodel/ProductViewModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class ProductMessenger {\n\n\tconstructor(quote, product, prefix, currencyIsoCode, extender) {\n\t\tthis.quote = quote;\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.extender = extender;\n\t\tthis.currencyIsoCode = currencyIsoCode;\n\t\tthis.dynamicOptions = [];\n\t\tthis.featureOptionIds = [];\n\t\tif(this.product && !this.product.initialized)\n\t\t\tthis._initializeProduct(this.product);\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.product.optionFieldSets, 'OptionConfiguration',\n\t\t\t'OptionConfigurationTablet', 'OptionConfigurationPhone');\n\t\tthis.defaultOptionPaths = ['selected', `record.${this.prefix}Quantity__c`];\n\t\tthis.additionalOptionPaths = [];\n\t}\n\n\tgetRequest() {\n\t\tlet message = {quote: this.quote.record};\n\n\t\tif(!this.product)\n\t\t\treturn message;\n\n\t\tmessage.product = {\n\t\t\tconfiguredProductId: this.product.configuration.configuredProductId,\n\t\t\tlineItemId: this.product.configuration.lineItemId,\n\t\t\tlineKey: this.product.configuration.lineItemKey,\n\t\t\tconfigurationAttributes: this._createConfigAttributesMap(),\n\t\t\toptionConfigurations: this._createFeatureOptionsMap(),\n\t\t\tconfigurationData: {} // Empty object which ultimately maps to externalConfigurationData\n\t\t};\n\t\tmessage.products = [];\n\n\t\tthis._appendReadOnlyProperties(message, this.product.configuration);\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif(!message)\n\t\t\treturn;\n\n\t\tlet clones = [];\n\t\t// reset properties that track what dynamic options to add\n\t\tthis.dynamicOptions = [];\n\t\tthis.featureOptionIds = [];\n\t\tif(message.products) {\n\t\t\t// create the appropriate number of clones from the base product before merging changes into the base product\n\t\t\tfor(let i = 0, l = message.products.length; i < l; i++)\n\t\t\t\tclones.push(this._cloneProduct(i));\n\t\t}\n\n\t\tthis._extendResponseQuote(message.quote);\n\t\tthis._extendResponseProduct(this.product, message.product);\n\t\tlet response = {\n\t\t\tquote: this.quote,\n\t\t\tproduct: this.product,\n\t\t\tproducts: this._extendResponseProducts(message.products, clones),\n\t\t\toptionNotifications: this._getResponseOptionPaths()\n\t\t};\n\n\t\tif (this.dynamicOptions.length > 0 && this.featureOptionIds.length > 0) {\n\t\t\tresponse.dynamicOptions = this.dynamicOptions;\n\t\t\tresponse.featureOptionIds = this.featureOptionIds;\n\t\t}\n\n\t\treturn response;\n\t}\n\n\t/** getRequest helper methods **/\n\n\t_appendReadOnlyProperties(obj, config) {\n\t\tobj.readOnly = {};\n\t\tlet line = this._getMatchingQuoteLine(config);\n\t\tif(line) obj.readOnly.line = line.record;\n\t}\n\n\t_getMatchingQuoteLine(config) {\n\t\tif(config == null || config.lineItemKey == null)\n\t\t\treturn null;\n\n\t\tlet lines = this.quote.lineItems.filter(function(line) {\n\t\t\treturn line.key === config.lineItemKey;\n\t\t}.bind(this));\n\n\t\treturn lines.length === 1 ? lines[0] : null;\n\t}\n\n\t_createConfigAttributesMap() {\n\t\tvar map = {};\n\t\tfor (let i = 0, l = this.product.configurationAttributes.length; i < l; i++)\n\t\t\tmap[this.product.configurationAttributes[i].targetFieldName] = null;\n\n\t\tthis.extender.extend(map, this.product.configuration.configurationData);\n\t\treturn map;\n\t}\n\n\t// This doesn't support nested bundles\n\t_createFeatureOptionsMap() {\n\t\tlet featuresMap = {};\n\t\tlet features = this.product.features;\n\t\tfor (let i = 0, l= features.length; i < l; i++) {\n\t\t\tvar featureName = features[i].record.Name;\n\t\t\tfeaturesMap[featureName] = [];\n\t\t\tlet optionConfigurations = features[i]._transient_.optionConfigurations;\n\t\t\tdelete features[i]._transient_.changedExternally;\n\t\t\tif (features[i].optionSelectionMethod === 'Add')\n\t\t\t\tthis._mixInUnselectedOptionsToAdd(featuresMap[featureName], features[i].record.Id, optionConfigurations);\n\t\t\telse if (optionConfigurations)\n\t\t\t\tthis._pushOptionConfigurations(featuresMap[featureName], optionConfigurations, features[i].optionSelectionMethod === 'Click');\n\t\t}\n\t\treturn featuresMap;\n\t}\n\n\t_pushOptionConfigurations(featureOptions, optionConfigurations, isClick) {\n\t\tfor (let i = 0, l = optionConfigurations.length; i < l; i++) {\n\t\t\tlet index = isClick ? undefined : optionConfigurations[i].index;\n\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(optionConfigurations[i], index));\n\t\t}\n\t\tif (!isClick)\n\t\t\tfeatureOptions.push({\n\t\t\t\t'productId': null,\n\t\t\t\t'Quantity': 1,\n\t\t\t\t'configurationData': {}\n\t\t\t});\n\t}\n\n\t_createPseudoOptionConfiguration(optionConfiguration, index) {\n\t\tlet pseudoOptionConfig =  {\n\t\t\toptionId: optionConfiguration.record.Id,\n\t\t\tselected: optionConfiguration.selected,\n\t\t\tProductCode: optionConfiguration.record[this.prefix + 'ProductCode__c'],\n\t\t\tProductName: optionConfiguration.record[this.prefix + 'ProductName__c'],\n\t\t\tQuantity: optionConfiguration.record[this.prefix + 'Quantity__c'],\n\t\t\tconfigurationData: {}\n\t\t};\n\t\tif (index !== undefined) // this is set on selection method Add/Dynamic features only\n\t\t\tpseudoOptionConfig.index = index;\n\t\tthis._appendReadOnlyProperties(pseudoOptionConfig, optionConfiguration);\n\t\treturn pseudoOptionConfig;\n\t}\n\n\t_mixInUnselectedOptionsToAdd(featureOptions, featureId, optionConfigurations) {\n\t\tthis.product.options.forEach( option => {\n\t\t\tlet optionFeature = option.record[this.prefix + 'Feature__c'] || \"Other\";\n\t\t\tif (optionFeature !== featureId)\n\t\t\t\treturn;\n\n\t\t\tlet addedOptions = optionConfigurations.filter( addedOption => { return addedOption.record.Id === option.record.Id; });\n\t\t\tif (addedOptions.length) { // if options has been added, include it in the option configs array\n\t\t\t\tfor (let i = 0; i < addedOptions.length; i++)\n\t\t\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(addedOptions[i], addedOptions[i].index || i));\n\t\t\t} else {  // if option has not been added, include it in the options configs array\n\t\t\t\toption.selected = false;\n\t\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(option, 0));\n\t\t\t}\n\t\t});\n\t}\n\n\t/** getResponse helper methods **/\n\n\t_extendResponseQuote(responseQuote) {\n\t\tif(responseQuote != null)\n\t\t\tthis.extender.extend(this.quote.record, this._sanitizeObject(responseQuote));\n\t}\n\n\t_extendResponseProduct(product, responseProduct, productKey) {\n\t\tif(!responseProduct)\n\t\t\treturn;\n\n\t\tthis._extendResponseConfigurationData(product, responseProduct.configurationData);\n\t\tthis._extendResponseConfigurationAttributes(product, responseProduct.configurationAttributes);\n\t\tthis._extendResponseOptionConfigurations(product, responseProduct.optionConfigurations, productKey);\n\t}\n\n\t_extendResponseConfigurationData(product, responseConfigurationData) {\n\t\tif(responseConfigurationData != null)\n\t\t\tthis.extender.extend(product.configuration.externalConfigurationData, this._sanitizeObject(responseConfigurationData));\n\t}\n\n\t_extendResponseConfigurationAttributes(product, responseConfigurationAttributes) {\n\t\tif(responseConfigurationAttributes != null)\n\t\t\tthis.extender.extend(product.configuration.configurationData, this._sanitizeObject(responseConfigurationAttributes));\n\t}\n\n\t_extendResponseOptionConfigurations(product, responseOptionConfigurations, parentProductKey) {\n\t\tlet fieldSetFields;\n\t\t// first build map by option Id of the response options\n\t\tlet responseOptionConfigurationsByOptionId = {};\n\t\tfor(let feature in responseOptionConfigurations) {\n\t\t\tlet featureOptionConfigurations = responseOptionConfigurations[feature];\n\t\t\tfor(let optionConfiguration of featureOptionConfigurations) {\n\t\t\t\tlet optionId = optionConfiguration.optionId;\n\t\t\t\tif(optionId) { // if optionId exists, map over to product option\n\t\t\t\t\tresponseOptionConfigurationsByOptionId[optionId] = responseOptionConfigurationsByOptionId[optionId] || [];\n\t\t\t\t\tresponseOptionConfigurationsByOptionId[optionId].push(optionConfiguration);\n\t\t\t\t} else if (optionConfiguration.productId) { // if productId exists, create data to dynamically create product options\n\t\t\t\t\tthis._createDynamicOption(optionConfiguration, feature);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// now loop over the product options and update quantity, selected, and external config data from the response options\n\t\tlet options = product.options;\n\t\tfor(let option of options) {\n\t\t\tlet sourceOptions = responseOptionConfigurationsByOptionId[option.record.Id];\n\t\t\tif(!sourceOptions)\n\t\t\t\tcontinue;\n\n\t\t\tsourceOptions.forEach(sourceOption => {\n\t\t\t\t// first option with configurationData, let's get the fields in the field set\n\t\t\t\tif(!fieldSetFields && sourceOption.configurationData != null)\n\t\t\t\t\tfieldSetFields = this.fieldSetHandler.getByViewport(PageContainer.getViewport()).fields;\n\t\t\t\tthis._extendResponseOptionConfiguration(product, option, sourceOption, fieldSetFields, parentProductKey);\n\t\t\t})\n\t\t}\n\t}\n\n\t_createDynamicOption(sourceData, featureName) {\n\t\t// create dynamicOption and featureOptionIds data based on customer response\n\t\t// this will be used for creating the dynamicOptions in the productConfigurator\n\t\tlet feature = this.product.features.find( feature => { return feature.record.Name === featureName; });\n\t\tthis.featureOptionIds.push(feature.record.Id + ':' + sourceData.productId);\n\t\tthis.dynamicOptions.push({\n\t\t\t'productId': sourceData.productId,\n\t\t\t'featureId': feature.record.Id,\n\t\t\t'Quantity': isNaN(sourceData.Quantity) ? 1 : sourceData.Quantity,\n\t\t\t'configurationData' : sourceData.configurationData\n\t\t});\n\t}\n\n\t_extendResponseOptionConfiguration(product, option, sourceOption, fieldSetFields, parentProductKey) {\n\t\tif(parentProductKey)\n\t\t\toption.parentProductKey = parentProductKey;\n\n\t\tlet optionFeature = option.record[this.prefix + 'Feature__c'] || \"Other\";\n\t\tlet feature = product.features.find( feature => { return feature.record.Id === optionFeature });\n\t\tif (feature.optionSelectionMethod === 'Click')\n\t\t\tthis._setOptionDataForClickFeature(option, sourceOption, fieldSetFields);\n\t\telse\n\t\t\tthis._setOptionDataForNonClickFeature(option, sourceOption, fieldSetFields, feature);\n\t}\n\n\t_setOptionDataForClickFeature(option, sourceOption, fieldSetFields) {\n\t\tif (sourceOption.selected != null)\n\t\t\toption.selected = sourceOption.selected;\n\n\t\tthis._extendQuantityAndConfigurationDataToOption(option, sourceOption, fieldSetFields);\n\t}\n\n\t_setOptionDataForNonClickFeature(option, sourceOption, fieldSetFields, feature) {\n\t\t// check to see if option is already added to feature\n\t\tlet optionConfiguration = feature._transient_.optionConfigurations.find( opt => { return opt.record.Id === sourceOption.optionId && opt.index === sourceOption.index; });\n\t\tif (sourceOption.selected) {\n\t\t\tif (!optionConfiguration) { // previously un-added option should create a new option configuration\n\t\t\t\t// clone the original option to create option configuration and new option row\n\t\t\t\tlet clone = this._createOptionConfigurationFromOption(option, sourceOption.index);\n\t\t\t\t// add data to configuration and add configuration to optionConfigurations array\n\t\t\t\tthis._extendQuantityAndConfigurationDataToOption(clone, sourceOption, fieldSetFields);\n\t\t\t\tfeature._transient_.optionConfigurations.push(clone);\n\t\t\t\t// notify feature that it has changed externally to render changes\n\t\t\t\tfeature._transient_.changedExternally = true;\n\t\t\t} else { // previously added option should update its data\n\t\t\t\tthis._extendQuantityAndConfigurationDataToOption(optionConfiguration, sourceOption, fieldSetFields);\n\t\t\t}\n\t\t} else if (!sourceOption.selected && optionConfiguration) { // previously added and un-selected option should be removed\n\t\t\toptionConfiguration.selected = false; // un-select option\n\t\t\tfeature._transient_.changedExternally = true; // notify feature that it has changed externally to render changes\n\t\t}\n\t}\n\n\t_createOptionConfigurationFromOption(option, index) {\n\t\tlet clone = JSON.parse(JSON.stringify(option));\n\t\t// set properties required for added options\n\t\tclone.index = index;\n\t\tclone.addedManually = true;\n\t\tclone.selected = true;\n\t\tclone.configured = false;\n\t\treturn clone;\n\t}\n\n\t_extendQuantityAndConfigurationDataToOption(option, sourceOption, fieldSetFields) {\n\t\tif (sourceOption.Quantity != null && option.selected)\n\t\t\toption.record[this.prefix + 'Quantity__c'] = sourceOption.Quantity;\n\n\t\tif (sourceOption.configurationData != null)\n\t\t\tthis._extendConfigurationDataToOption(option, sourceOption, fieldSetFields);\n\t}\n\n\t_extendConfigurationDataToOption(option, sourceOption, fieldSetFields) {\n\t\t// get the sanitized configurationData from the source option\n\t\tlet configurationData = this._sanitizeObject(sourceOption.configurationData);\n\n\t\t// if the field exists in the field set, map that configurationData value to the option record\n\t\t// however, if the field is not in the field set, map the configurationData value to the externalConfigurationData object\n\t\tlet externalConfigurationData = {};\n\t\tfor (let key in configurationData) {\n\t\t\tlet value = configurationData[key];\n\t\t\tif (fieldSetFields.indexOf(key) === -1) {\n\t\t\t\texternalConfigurationData[key] = value;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\toption.record[key] = value;\n\t\t\tlet additionalOptionPath = `record.${key}`;\n\t\t\tif (this.additionalOptionPaths.indexOf(additionalOptionPath) === -1)\n\t\t\t\tthis.additionalOptionPaths.push(additionalOptionPath);\n\t\t}\n\t\t// merge in the new externalConfigurationData to the option\n\t\toption.externalConfigurationData = option.externalConfigurationData || {};\n\t\tthis.extender.extend(option.externalConfigurationData, externalConfigurationData);\n\t}\n\n\t_extendResponseProducts(responseProducts, clones) {\n\t\tif(!responseProducts || responseProducts.length === 0)\n\t\t\treturn [];\n\n\t\tlet products = [];\n\t\tfor(let i = 0, l = responseProducts.length; i < l; i++) {\n\t\t\tlet product = clones[i];\n\t\t\tthis._extendResponseProduct(product, responseProducts[i], product.productKey);\n\t\t\tthis._resetFeatureOptionConfiguration(product);\n\t\t\tproducts.push(product);\n\t\t}\n\t\treturn products;\n\t}\n\n\t_cloneProduct(index) {\n\t\tlet clone = JSON.parse(JSON.stringify(this.product)); // clones the product\n\t\t// assign the clone a unique product key to distinguish this cloned product in the configurator from its source product\n\t\t// as the source product and its clone will always have the same record Id\n\t\tclone.productKey = this._buildProductKey(this.product.record.Id, index);\n\t\tthis._enableSaveToLineEditor(clone);\n\t\treturn clone;\n\t}\n\n\t_buildProductKey(productId, index) {\n\t\tlet prefix = index < 10 ? '00' : (index < 100 ? '0' : '');\n\t\tlet suffix = prefix + index;\n\t\treturn productId.substring(0, 15) + suffix;\n\t}\n\n\t_enableSaveToLineEditor(clone) {\n\t\t// in order to save this cloned product to the line editor, we must nil out the lineItemKey and the lineItemId\n\t\tclone.configuration.lineItemKey = null; // simply null this out since its a Integer type on server\n\t\tdelete clone.configuration.lineItemId; // must delete this as its an Id type on server (so can't null it out)\n\t}\n\n\t_resetFeatureOptionConfiguration(product) {\n\t\t// first clear all feature option configurations\n\t\tlet features = product.features || [];\n\t\tfor(let feature of features)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\t// now sync the feature option configurations by simply instantiating a ProductViewModel\n\t\t// if we don't do this and this cloned product is never selected in the configurator, then the cloned product will not save properly\n\t\tthis._initializeProduct(product);\n\t}\n\n\t_initializeProduct(product) {\n\t\tlet prefix = this.prefix.endsWith('__') ? this.prefix.substring(0, this.prefix.length - 2) : this.prefix;\n\t\tnew ProductViewModel(this.quote.record.Id, product, prefix, this.quote.record.CurrencyIsoCode);\n\t}\n\n\t_getResponseOptionPaths() {\n\t\tlet responseOptionPaths = this.defaultOptionPaths.concat(this.additionalOptionPaths);\n\t\tthis.additionalOptionPaths = [];\n\t\treturn responseOptionPaths;\n\t}\n\n\t_sanitizeObject(object) {\n\t\treturn JSON.parse(JSON.stringify(object, function(key, value) {\n\t\t\tif(key.endsWith('__c') && value instanceof Object) // custom fields cannot have an object value\n\t\t\t\treturn JSON.stringify(value);\n\t\t\treturn value;\n\t\t}));\n\t}\n}\n","export class ConfiguratorSearch {\n\tconstructor(searchFilters, prefix, fieldTypes) {\n\t\tthis.searchFilters = searchFilters;\n\t\tthis.prefix = prefix;\n\t\tthis.fieldTypes = fieldTypes;\n\t}\n\n\tcontainsFeature(feature) {\n\t\tlet featureInput = this.searchFilters[this.prefix + 'Feature__c'];\n\t\tif (featureInput !== null && featureInput !== undefined)\n\t\t\treturn ((feature.record.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 )||\n\t\t\t\t\t(feature.untranslatedRecord !== undefined && feature.untranslatedRecord.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 ));\n\t\treturn true;\n\t}\n\n\thasVisibleOptions(options, showOptions) {\n\t\tif (options.length > 0) {\n\t\t\tfor (let i = 0, numOptions = options.length; i < numOptions; i++) {\n\t\t\t\tif (!options[i].hidden)\n\t\t\t\t\treturn true;\n\t\t\t\telse if(showOptions && showOptions[options[i].record.Id])\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.hasFilterValues();\n\t}\n\n\tallOptionsHiddenByRule(options) {\n\t\tfor (let option of options) {\n\t\t\tif (option.hiddenByRule === false || option.hiddenByRule == null)\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\thasRequiredConfigAttributes(feature, model) {\n\t\tlet configAttributes = model.configAttributesByFeatureId[feature.record.Id];\n\t\tif (configAttributes) {\n\t\t\tfor (let configAttr of configAttributes)\n\t\t\t\tif (configAttr.required)\n\t\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thasConfigAttributes(feature, model) {\n\t\treturn model.configAttributesByFeatureId[feature.record.Id] ? true : false;\n\t}\n\n\tsetOptionVisibility(options) {\n\t\t// some field types have value '' instead of null, so sanitize everything here\n\t\tfor (let filterKey in this.searchFilters) {\n\t\t\tif (this.searchFilters[filterKey] === '')\n\t\t\t\tthis.searchFilters[filterKey] = null;\n\t\t}\n\n\t\tlet _options = JSON.parse(JSON.stringify(options));\n\t\tfor (let i = 0, numOptions = _options.length; i < numOptions; i++) {\n\t\t\tif(_options[i].record[this.prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\t_options[i].hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(_options[i].isUpgrade) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet searchKeys = Object.keys(this.searchFilters);\n\t\t\tconst filtered = searchKeys.some((filterField) => {\n\t\t\t\tlet filterValue = this.searchFilters[filterField];\n\n\t\t\t\t// custom fields that don't have values are not on the option record, so we need to explicitly check if it is defined.\n\t\t\t\t// if a filter has a value, any options that don't have values for the matching field should be filtered out\n\t\t\t\tlet optionValue = _options[i].record[filterField];\n\t\t\t\treturn filterValue == null || filterField === this.prefix + 'Feature__c' ? false\n\t\t\t\t\t: optionValue == null ? true\n\t\t\t\t\t: typeof optionValue === 'number' ? this.checkNumber(filterValue, optionValue)\n\t\t\t\t\t: this.fieldTypes[filterField] === 'multipicklist' ? this.checkMultiPicklist(filterValue, optionValue)\n\t\t\t\t\t: this.checkDefault(filterValue, String(optionValue), _options[i].untranslatedRecord, filterField)\n\t\t\t});\n\t\t\t_options[i].hidden = _options[i].hiddenByRule || filtered;\n\t\t}\n\t\treturn _options;\n\t}\n\n\thasFilterValues() {\n\t\tfor (let filter in this.searchFilters) {\n\t\t\tif (this.searchFilters[filter] !== null)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Compares option field values to search filter input, checks whether each option value contains the filter value as a substring\n\t * @param {string} filterValue - the value entered into the search filter input\n\t * @param {string} optionValue - the value of the corresponding field on the product option record (in this function, it will always be a string)\n\t * @param {object?} untranslated - when working with data translated by CPQ localization, this will be the untranslated data\n\t * @param {string?} filterField - the API name of the field being filtered\n\t * @returns {boolean} - whether or not to filter out the option; when the option value does not contain the filter input, then we return true\n\t */\n\tcheckDefault(filterValue, optionValue, untranslated, filterField) {\n\t\treturn optionValue.toLowerCase().indexOf(filterValue.toLowerCase()) === -1 &&\n\t\t\t(!untranslated || !untranslated[filterField] || untranslated[filterField].toLowerCase().indexOf(filterValue.toLowerCase()) === -1);\n\t}\n\n\t/**\n\t * Compares option fields of type Number to search filter input, checks if the filter and option values are equal\n\t * @param {string} filterValue - the value entered into the search filter input (only numbers represented as strings are valid, any other input will always filter out all options)\n\t * @param {number} optionValue - the value of the corresponding field on the product option record (in this function, it will always be a number)\n\t * @returns {boolean} - whether or not to filter out the option; when the option value does not equal the filter input, then we return true\n\t */\n\tcheckNumber(filterValue, optionValue) {\n\t\tconst numberValue = Number(filterValue);\n\t\tif(Number.isNaN(numberValue) || filterValue === '')\n\t\t\treturn true;\n\t\treturn optionValue !== numberValue;\n\t}\n\n\t/**\n\t * Compares option fields of type Picklist (Multi-Select) to search filter input, checks whether any of the values on the option contain any of the values in the filter\n\t * @param {string} filterValue - semicolon-delimited string representing the multi-picklist values selected in the search filter\n\t * @param {string} optionValue - semicolon-delimited string representing the multi-picklist values selected on the product option record\n\t * @returns {boolean} - whether or not to filter out the option; true if none of the values selected in the filter are contained within values on the option\n\t */\n\tcheckMultiPicklist(filterValue, optionValue) {\n\t\tlet multiFilterValues = filterValue.split(';');\n\t\tlet multiOptionValues = optionValue.split(';');\n\t\treturn multiFilterValues.every((fv) => {\n\t\t\treturn multiOptionValues.every((ov) => this.checkDefault(fv, ov))\n\t\t});\n\t}\n}","import {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class ProductViewModel {\n\tconstructor(qId, product, prefix, currencyIsoCode, fId) {\n\t\tthis.init(product, qId, prefix, currencyIsoCode, fId);\n\t}\n\n\tinit(product, qId, prefix, currencyIsoCode, fId) {\n\t\tthis.product = product || this.product;\n\t\tthis.qId = qId || this.qId; // Quote Id\n\t\tthis.prefix = prefix ? (prefix + '__') : (this.prefix || '');\n\t\tthis.currencyIsoCode = currencyIsoCode || this.currencyIsoCode;\n\t\tthis.featureLookupId =  fId || this.featureLookupId; // refers to the Feature that drives the Option Lookup Page\n\t\tthis.optionsById = {}; // Map that organizes Options by Option Id\n\t\tthis.optionIndexById = {}; // Map that organizes option-indeces by Id\n\t\tthis.optionsByFeatureId = {}; // Map that organizes Options by Feature Id\n\t\tthis.featuresWithOptionsOrConfigAttr = []; // List of Features with at least one Option or a Configuration Attribute\n\t\tthis.featureIdsWithOptionsOrConfigAttr = {};\n\t\tthis.featureIdsWithSelectionMethodAdd = {}; // List of Feature Ids for features with optionSelectionMethod 'Add'\n\t\tthis.featureIdsWithSelectionMethodClick = {}; // List of Feature Ids for features with optionSelectionMethod 'Click'\n\t\tthis.featureIdsWIthSelectionMethodDynamic = {}; // List of Feature Ids for features with optionSelectionMethod 'Dynamic'\n\t\tthis.configAttributesByFeatureId = {}; // Map that organizes Configuration Attributes by Feature Id\n\t\tthis.configurationAttributeValueMap = {}; // Map that stores configuration attributes to values\n\t\tthis.configurationAttributeModelMap = {}; //Map that organizes useful information about Configuration Attributes\n\t\tthis.configurationAttributeTargetFieldMap = {}; // Map of target fields to its list of configuration attributes ids\n\t\tthis.configurationAttributeApplyToOptionMap = {}; // Map of the configuration attributes that apply to product options for the bundle\n\t\tthis.attributeValueMap = {}; // Map of Configuration Attributes by field name so that value is shared across common fields\n\t\tthis.productRulesActions = {}; // Map of required actions generated by product rules\n\t\tthis.originalDataByOptionIds = {}; //Map of optionIds to its original price, discount amount, and discount rate\n\t\tthis.optionDataByOptionIds = {}; // Map of optionIds to its updated optionData\n\t\tthis.featureIdByOptionId = {}; //Map of optionIds to their corresponding featureIds\n\t\tthis.productOptionConfigurationsMap = {}; //Map of the product.configuration.optionConfigurations by option Id\n\t\tthis.initializeProduct();\n\t\tthis.product.initialized = true;\n\t}\n\n\tgetFeature(featureId) {\n\t\tif (featureId === undefined || featureId === 'null')\n\t\t\tfeatureId = null;\n\t\treturn this.product.features.find(feature => feature.record.Id === featureId);\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.optionsById[optionId];\n\t}\n\n\tgetOptionsByFeatureId(featureId) { // Used by the Product Option Table to display the options insides each Feature Table\n\t\tif (featureId === null || featureId === 'null')\n\t\t\tfeatureId = 'Other';\n\n\t\tif (this.isOptionLookupViewModel()) {\n\t\t\t//option lookup doesn't need to bind to the original object. this allows us to bind directly to the selected property in the configurator\n\t\t\t//if slow, strip fieldSet data & id into new object instead of cloning\n\t\t\tvar options = [];\n\t\t\tthis.optionsByFeatureId[featureId].forEach( option => {\n\t\t\t\tlet dummy = JSON.parse(JSON.stringify(option));\n\t\t\t\tdummy.selected = false;\n\t\t\t\toptions.push(dummy);\n\t\t\t});\n\t\t\treturn options;\n\t\t}\n\n\t\tlet feature = this.getFeature(featureId);\n\n\t\tfor (let option of feature._transient_.optionConfigurations) {\n\t\t\tif (!this.isClickFeature(feature))\n\t\t\t\toption.selected = true;\n\t\t}\n\n\t\treturn feature._transient_.optionConfigurations;\n\t}\n\n\tgetFeatureByOptionId(id) {\n\t\tconst featureId = this.featureIdByOptionId[id];\n\t\treturn this.getFeature(featureId);\n\t}\n\n\tmaxOptionsMet(feature) {\n\t\tlet maxOptions = this.prefix + 'MaxOptionCount__c';\n\t\treturn feature._transient_.optionConfigurations.length >= feature.record[maxOptions];\n\t}\n\n\tsetOptionSelected(optionId, selected) {\n\t\tlet option = this.optionsById[optionId],\n\t\t\tisClick = this.featureIdsWithSelectionMethodClick[this.featureIdByOptionId[optionId]];\n\t\tif (isClick && !option.record[this.prefix + 'Required__c'] ) // This code is hacked in because TableRow fired a selection change during initialization that sets selected to false\n\t\t\toption.selected = selected;\n\t}\n\n\tsetConfigurationAttributesToOptions(option) {\n\t\tfor(let attribute in this.configurationAttributeApplyToOptionMap)\n\t\t\toption.record[attribute] = this.product.configuration.configurationData[attribute]\n\t}\n\n\tgetOptionLayout() {\n\t\tlet optionLayout = this.prefix + 'OptionLayout__c';\n\t\treturn this.product.record[optionLayout] || 'Sections';\n\t}\n\n\tgetTabFeaturesMap() {\n\t\tlet featureCategoryLabels = this.product.featureCategoryLabels;\n\n\t\tlet featuresWithoutCategory = this.featuresWithOptionsOrConfigAttr.filter(feature => {\n\t\t\treturn feature.record[this.prefix + 'Category__c'] === undefined;\n\t\t});\n\t\tlet tabFeaturesMap = {};\n\t\t//Displays features as tabs (tabs without categories).\n\t\tlet featuresLength = this.featuresWithOptionsOrConfigAttr.length;\n\n\t\tif (featuresLength === featuresWithoutCategory.length) {\n\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\ttabFeaturesMap[feature.record.Name] = [feature];\n\t\t\t});\n\t\t} else {\n\t\t\t// loop through categories to ensure we add category names as keys to the tabFeaturesMap in the correct order\n\t\t\t// ordering matters as an Object.keys call on this map upstream will return an array of keys in the same order\n\t\t\t// in which the keys were added to the object - W-3534213\n\t\t\tthis.product.featureCategories.forEach(category => {\n\t\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\t\tlet featureCategory = feature.record[this.prefix + 'Category__c'];\n\n\t\t\t\t\tif (featureCategory === undefined)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif (featureCategory === featureCategoryLabels[category])\n\t\t\t\t\t\ttabFeaturesMap[category] !== undefined ? tabFeaturesMap[category].push(feature) : tabFeaturesMap[category] = [feature];\n\t\t\t\t});\n\t\t\t});\n\t\t\tif (featuresWithoutCategory.length !== 0) {\n\t\t\t\ttabFeaturesMap[\"Other\"] = (tabFeaturesMap[\"Other\"] || []);\n\t\t\t\ttabFeaturesMap[\"Other\"] = tabFeaturesMap[\"Other\"].concat(featuresWithoutCategory);\n\t\t\t}\n\t\t}\n\t\treturn tabFeaturesMap;\n\t}\n\n\tcheckAtLeastOneFeatureHasCategory() {\n\t\treturn !!this.featuresWithOptionsOrConfigAttr.find(feature =>\n\t\t\tfeature.record[this.prefix + 'Category__c'] != null && feature.record[this.prefix + 'Category__c'] !== 'Other'\n\t\t);\n\t}\n\n\tisAppliedImmediately(optionId) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c';\n\t\treturn this.getOption(optionId).record[appliedImmediately];\n\t}\n\n\tinitializeProduct() {\n\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\tthis.product = this.localizer.localizeProduct(this.product);\n\t\tthis.product.configuration.configurationEntered = true;\n\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tselectedOptions = [];\n\n\t\tif (!this.featureLookupId) {\n\t\t\tthis.initConfigAttributesById();\n\t\t\tthis.initConfigurationAttributeMap();\n\t\t}\n\n\t\tfor (let option of this.product.options)\n\t\t\tthis.initOptionInfo(option, selectedOptions);\n\n\t\tthis.buildOptionConfigurationMap();\n\n\t\tfor (let feature of this.product.features) {\n\t\t\tfeature.optionSelectionMethod = this.getOptionSelectionMethod(feature);\n\t\t\tif (!feature._transient_)\n\t\t\t\tfeature._transient_ = {};\n\t\t\tthis.initFeatureOptionConfigurations(feature);\n\t\t\tthis.addFeaturesWithOptionsOrConfigAttr(feature);\n\t\t}\n\n\t\tfor (let option of selectedOptions) { // set added and disabledData for added options\n\t\t\tlet feature = this.getFeature(option.record[featureLabel] || 'Other'), configuredOption;\n\t\t\tif (option.selectionType === 'radio' && option.hidden && feature.visibleSelected)\n\t\t\t\t\toption.selected = false; // don't selected hidden options in radio feature if visible option selected\n\t\t\tif (this.isAddFeature(feature)) {\n\t\t\t\tconfiguredOption = feature._transient_.optionConfigurations.find(function (opt) { return opt.record.Id === option.record.Id; });\n\t\t\t\tif (!configuredOption) {\n\t\t\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\t\t} else {// On reconfigure, following data needs to be defined for duplicate added option in configurator as well as in option lookup\n\t\t\t\t\tconfiguredOption.added = true;\n\t\t\t\t\tconfiguredOption.configured = option.configured;\n\t\t\t\t\tthis.setOptionDisabledData(configuredOption);\n\t\t\t\t}\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tthis.setOptionDisabledData(option);\n\t\t}\n\t}\n\n\tinitOptionInfo(option, selectedOptions) {\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tquantityLabel = this.prefix + 'Quantity__c',\n\t\t\tminQuantityLabel = this.prefix + 'MinQuantity__c',\n\t\t\trecordSelected = this.prefix + 'Selected__c',\n\t\t\trecordRequired = this.prefix + 'Required__c',\n\t\t\tunitPrice = this.prefix + 'UnitPrice__c',\n\t\t\tproductName = this.prefix + 'ProductName__c',\n\t\t\tfeatureId = option.record[featureLabel] || 'Other';\n\n\t\t//configuration attributes can be configured so that the value in them is applied to all the options\n\t\tthis.setConfigurationAttributesToOptions(option);\n\t\toption.valueChanged = false;\n\t\toption.record[unitPrice] = option.record[unitPrice] == null ? undefined : option.record[unitPrice];\n\t\toption.hidden = (option.hiddenByRule && option.hidden) || option.record[unitPrice] === undefined;\n\t\toption.removed = option.removed || option.selected === false && option.record[recordSelected];\n\t\toption.selected = option.selected === undefined ? ( (option.record[recordSelected] && !option.removed) || option.record[recordRequired] ) : option.selected;\n\t\toption.name = option.record[productName];\n\n\t\tif (!option._transient_)\n\t\t\toption._transient_ = {};\n\n\t\tif (!option.selected)\n\t\t\tthis.setOptionDisabledData(option);\n\t\telse if (selectedOptions != null)\n\t\t\tselectedOptions.push(option); // disabledData may be derived differently for some selected options\n\n\t\tif(option.isUpgrade === true)\n\t\t\toption.hidden = true;\n\t\tif (!option.record[featureLabel] && !this.product.mappedFeaturelessOptions) {\n\t\t\tthis.product.features.push(this.createOtherOptionsFeature(this.product.virtualFeatureTitle));\n\t\t\tthis.product.mappedFeaturelessOptions = true;\n\t\t}\n\t\tif (option.record[quantityLabel] === undefined) {\n\t\t\toption.recordHasQuantity = false;\n\t\t\toption.record[quantityLabel] = option.record[minQuantityLabel] === undefined ? 1 : option.record[minQuantityLabel];\n\t\t}\n\t\tif (option.record[recordRequired])\n\t\t\toption.required = true; // do this so Actions.js can know to disable trashcan without needing the prefix\n\n\t\tif (this.product._transient_ && this.product._transient_.attributeSet && this.product._transient_.attributeSet.attributeItemIdsByOptionId[option.record.Id]) {\n\t\t\tthis.product._transient_.hasAttributeItems = true;\n\t\t\tthis.addAttributeItems(option, this.product._transient_.attributeSet);\n\t\t}\n\n\t\tthis.optionsById[option.record.Id] = option;\n\t\tthis.featureIdByOptionId[option.record.Id] = featureId;\n\t\tthis.addToOptionByFeatureId(featureId, option);\n\t\tthis.originalDataByOptionIds[option.record.Id] = {\n\t\t\tunitPrice: option.record[this.prefix+'UnitPrice__c'],\n\t\t\tdiscountAmount: option.record[this.prefix+'DiscountAmount__c'],\n\t\t\tdiscountRate: option.record[this.prefix+'Discount__c'],\n\t\t\tquantity: option.record[quantityLabel]\n\t\t};\n\t}\n\n\tcreateOtherOptionsFeature(name) {\n\t\treturn {\n\t\t\taddOptionButtonLabel: \"Add Option\",\n\t\t\taddOptionDialogTitle: \"Add Option\",\n\t\t\tinstructionsText: null,\n\t\t\trecord: {\n\t\t\t\tId: 'Other',\n\t\t\t\tName: name\n\t\t\t},\n\t\t\tsearchFilters: null\n\t\t}\n\t}\n\n\taddAttributeItems(option, attributeSet) {\n\t\toption._transient_.attributeItems = {};\n\t\tfor (let id of attributeSet.attributeItemIdsByOptionId[option.record.Id]) {\n\t\t\tlet targetFieldName = attributeSet.attributeItemById[id].targetFieldName;\n\t\t\toption._transient_.attributeItems[targetFieldName] = option.record[targetFieldName];\n\t\t}\n\t\toption._transient_.optionDrawerExpanded = false;\n\t\toption._transient_.drawerIconClass = 'sf-icon-chevronright';\n\t}\n\n\tgetOptionSelectionMethod(feature) { // change to init since you are setting it in beginning\n\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn feature.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\tif (this.product.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn this.product.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\t//Defaults to Option Selection Method 'Click' if unspecified.\n\t\treturn 'Click';\n\t}\n\n\tsetOptionDisabledData(option, duplicate) {\n\t\t//Both properties disable manual selection. 'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t//Only non-duplicate required options or system options are DISABLED\n\t\t//Only options affected by option constraints are CONSTRAINED, which is set altered after initialization\n\t\toption.disabledData = option.disabledData || {\n\t\t\t'disabled':  ((!!option.record[this.prefix + 'Required__c'] && !option.added) || !!option.record[this.prefix + 'System__c']),\n\t\t\t'constrained': false\n\t\t};\n\t\tif (duplicate) { //Needs to run on reconfigure to allow duplicates of added required options to be deleted/selected\n\t\t\tlet original = this.optionsById[option.record.Id];\n\t\t\toriginal.disabledData = {'disabled': false, 'constrained': false};\n\t\t\toption.disabledData.disabled = false;\n\t\t}\n\t}\n\n\tinitFeatureOptionConfigurations(feature) {\n\t\tif (feature._transient_.optionConfigurations == null)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\tif (this.optionsByFeatureId[feature.record.Id] == null)\n\t\t\treturn;\n\n\t\tlet displayRadio = feature.record[this.prefix + 'MaxOptionCount__c'] === 1;\n\t\tlet notInitialized = feature._transient_.optionConfigurations.length === 0;\n\t\tlet featureId = feature.record.Id || 'Other';\n\t\tlet unsortedOptionConfigs = [];\n\t\tfor (let option of this.optionsByFeatureId[featureId]) {\n\t\t\toption.index = 0; //index tracks uniqueness when the same option is added more than once (selection method add and dynamic)\n\t\t\tfeature.visibleSelected = feature.visibleSelected || (!option.hidden && option.selected);\n\t\t\toption.selectionType = displayRadio ? 'radio' : 'checkbox';\n\t\t\toption.record[this.prefix + 'ConfiguredSKU__c'] = this.product.record.Id;\n\t\t\tconst optUnitPrice = option.record[this.prefix + 'UnitPrice__c'];\n\t\t\t// listPrice should default to UnitPrice\n\t\t\tif (option.listPrice === undefined && optUnitPrice !== \"\" && optUnitPrice != null) {\n\t\t\t\toption.listPrice = optUnitPrice;\n\t\t\t}\n\t\t\tif (this.isDynamicFeature(feature) && !feature._transient_.changedExternally) { // TODO: Look into this and see why these properties can be set in OptionLookup but not Dynamic Lookup\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tif (this.featureLookupId) {\n\t\t\t\toption._transient_.rowActions = []; // define this as we have downstream observers on this property even in option lookup\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// Create option actions for each option unless the page is in Dynamic/Option Lookup\n\t\t\tif (option._transient_.rowActions == null || option._transient_.rowActions.length === 0 || feature._transient_.changedExternally)\n\t\t\t\tthis.initOptionActions(option, !this.isClickFeature(feature));\n\t\t\tthis.initReconfiguredOption(option, feature, notInitialized, unsortedOptionConfigs);\n\t\t}\n\n\t\tif (unsortedOptionConfigs.length>0)\n\t\t\tthis.sortAndAddOptionConfigs(feature, unsortedOptionConfigs);\n\t}\n\n\tbuildOptionConfigurationMap() {\n\t\tif (!this.product.features[0])\n\t\t\treturn;\n\t\tif (this.product.features[0]._transient_ != null && this.product.features[0]._transient_.optionConfigurations != null) {\n\t\t\tthis._syncOptionConfigurations();\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let optionConfiguration of this.product.configuration.optionConfigurations) {\n\t\t\tlet id = optionConfiguration.optionId;\n\t\t\tthis.productOptionConfigurationsMap[id] = this.productOptionConfigurationsMap[id] || [];\n\t\t\tthis.productOptionConfigurationsMap[id].push(optionConfiguration);\n\t\t}\n\t}\n\n\tinitOptionActions(option, isNotClick) {\n\t\tlet actions = [];\n\t\tif (isNotClick)\n\t\t\tactions.push(this.createOptionAction('sf-icon-delete', 'Delete', 'left', true, false, false, 'delete-tapped'));\n\t\t// if (this.hasConfigurableOptions) // TODO: Move this back after figuring out how to properly put the actions then hiding them inside row headers (Look at POT)\n\t\tthis.addOptionConfigurationAction(option, actions);\n\n\t\toption._transient_.rowActions = actions;\n\t}\n\n\taddOptionConfigurationAction(option, actions) { //Must add an invisible action here to allocate proper spacing for each product option line\n\t\tlet required = option.configurable ? option.configurationRequired : undefined;\n\t\tactions.push(this.createOptionAction('sf-icon-custom_apps', 'Configure', 'left', false, false, false, 'configure-tapped', required));\n\t}\n\n\tcreateOptionAction(icon, title, position, mobileDisabled, hidden, invisible, fireEvent, configurationRequired) {\n\t\treturn {\n\t\t\ticon: icon, title: title, position: position, mobileDisabled: mobileDisabled, hidden: hidden, invisible: invisible, configurationRequired: configurationRequired,\n\t\t\tonTapFunction: function () { this.fire(fireEvent, { Id: this.data.record.Id, index: this.index }); }\n\t\t}\n\t}\n\n\taddToOptionByFeatureId(featureId, option) {\n\t\tthis.optionsByFeatureId[featureId] = this.optionsByFeatureId[featureId] || [];\n\t\tthis.optionsByFeatureId[featureId].push(option);\n\t}\n\n\tinitConfigAttributesById() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tif (attr[i].featureId === null) {\n\t\t\t\tif (!this.configAttributesByFeatureId.featureless)\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless.push(attr[i]);\n\t\t\t} else {\n\t\t\t\tif (!this.configAttributesByFeatureId[attr[i].featureId])\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId] = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId].push(attr[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitConfigurationAttributeMap() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tlet configData = this.product.configuration.configurationData;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tlet fieldName = attr[i].targetFieldName;\n\t\t\t//Providing a map for values since attributes for a single field need to reference the same value\n\t\t\tthis.attributeValueMap[attr[i].targetFieldName] = '';\n\t\t\tlet configurationAttributeReferencedFieldValue = new RelationshipFieldManager(fieldName, configData).getRelationshipName();\n\t\t\tlet configurationAttributeValue =  configData[fieldName];\n\t\t\t// never assign an undefined value here or the configuration attribute will not display\n\t\t\tthis.configurationAttributeValueMap[attr[i].myId] = configurationAttributeValue !== undefined ? configurationAttributeValue : null;\n\t\t\t// the bundleId is the product's product key if a cloned product, otherwise just the product's record Id\n\t\t\tlet bundleId = this.product.productKey || this.product.record.Id;\n\t\t\tthis.configurationAttributeModelMap[attr[i].myId] = {\n\t\t\t\ttargetFieldName: attr[i].targetFieldName,\n\t\t\t\tvalue: configurationAttributeValue,\n\t\t\t\trequired: attr[i].required,\n\t\t\t\thidden: attr[i].hidden,\n\t\t\t\tmyId: attr[i].myId,\n\t\t\t\tbundleId: bundleId,\n\t\t\t\tautoSelect: attr[i].autoSelect,\n\t\t\t\tshownValues: attr[i].shownValues,\n\t\t\t\thiddenValues: attr[i].hiddenValues,\n\t\t\t\treferencedFieldValue: configurationAttributeReferencedFieldValue\n\t\t\t};\n\t\t\tlet ids = this.configurationAttributeTargetFieldMap[attr[i].targetFieldName] || [];\n\t\t\tids.push(attr[i].myId);\n\t\t\tthis.configurationAttributeTargetFieldMap[attr[i].targetFieldName] = ids;\n\t\t\t//set a map of attributes that will be applied to options\n\t\t\tif(attr[i].applyToProductOptions === true && this.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] === undefined)\n\t\t\t\tthis.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] = true;\n\t\t}\n\t}\n\n\tinitReconfiguredOption(option, feature, notInitialized, unsortedOptionConfigs) {\n\t\tconst configsArray = this.productOptionConfigurationsMap[option.record.Id];\n\t\tif (!configsArray || option.removed) {\n\t\t\tif (notInitialized && this.isClickFeature(feature))\n\t\t\t\treturn feature._transient_.optionConfigurations.push(option);\n\t\t\treturn;\n\t\t}\n\t\t// Add options from a feature that uses option selection method add\n\t\tif (this.isAddFeature(feature)) {\n\t\t\tthis.cloneOptionAndSyncConfiguration(option, unsortedOptionConfigs);\n\t\t\treturn;\n\t\t}\n\n\t\tlet config = configsArray[0];\n\t\tthis.syncOptionToConfigData(option);\n\t\tthis.setPropertiesWithConfig(option, config);\n\n\t\tif (notInitialized) {\n\t\t\tif (this.isClickFeature(feature))\n\t\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\telse\n\t\t\t\tunsortedOptionConfigs.push(option);\n\t\t}\n\t}\n\n\tcloneOptionAndSyncConfiguration(option, unsortedOptionConfigs) {\n\t\tlet configsArray = this.productOptionConfigurationsMap[option.record.Id],\n\t\t\trequiredOptionAdded = {};\n\n\t\tfor (let i=0;i<configsArray.length;i++) {\n\t\t\tlet config = configsArray[i],\n\t\t\t\tclonedOption = JSON.parse(JSON.stringify(option));\n\t\t\tclonedOption._transient_.rowActions = option._transient_.rowActions; //we lose the rowActions when we stringify, so adding them back\n\t\t\tif (requiredOptionAdded[clonedOption.record.Id] === true)\n\t\t\t\tclonedOption.required = false; // Actions.js uses this property to disable trashcan without needing the prefix\n\t\t\telse\n\t\t\t\trequiredOptionAdded[clonedOption.record.Id] = true;\n\n\t\t\tclonedOption.index = i;\n\t\t\tthis.syncOptionToConfigData(clonedOption);\n\t\t\tthis.setPropertiesWithConfig(clonedOption, config);\n\t\t\tunsortedOptionConfigs.push(clonedOption);\n\t\t}\n\t}\n\n\t//the product stores some attributes that are not available on the option\n\t//specifically for options that have already been configured additional properties exist under the product.optionConfigurations array\n\t//this does a mixin for all the properties\n\tsyncOptionToConfigData(option) {\n\t\tlet config = this.getProductOptionConfigurationData(option.record.Id, option.index);\n\t\tif (config === undefined)\n\t\t\treturn;\n\n\t\tfor (let key in config) {\n\t\t\tif (option.hasOwnProperty(key) )\n\t\t\t\tcontinue;\n\n\t\t\toption[key] = config[key];\n\t\t}\n\t}\n\n\t//the product has an array of options with data that is not available on the option itself\n\t//here we setup a map for accessing that data\n\tgetProductOptionConfigurationData(id, index) {\n\t\tif (this.productOptionConfigurationsMap[id][index] === undefined)\n\t\t\tthis.buildOptionConfigurationMap();\n\n\t\treturn this.productOptionConfigurationsMap[id][index];\n\t}\n\n\t/**\n\t * Given a Product Option object and a config object, this method copies\n\t * over values from the config object to the product option record. This\n\t * method also maintains localizations of product options.\n\t *\n\t * @param {Object} option - the product option object\n\t * @param {Object} config - the configuration object with configurations\n\t */\n\tsetPropertiesWithConfig(option, config) {\n\t\tconst isTranslated = (option.untranslatedRecord && Object.keys(option.untranslatedRecord).length > 0);\n\n\t\tfor (const key in config.optionData) {\n\t\t\tif (key === 'attributes') continue;\n\n\t\t\t// W-6060038 - Maintain localized values on option.record unless\n\t\t\t// configuration values are changed.\n\t\t\tif (isTranslated && option.untranslatedRecord[key] !== undefined) {\n\t\t\t\tconst untranslatedValue = option.untranslatedRecord[key];\n\t\t\t\tif (untranslatedValue === config.optionData[key]) continue;\n\t\t\t}\n\n\t\t\toption.record[key] = config.optionData[key];\n\t\t}\n\n\t\toption.dynamicOptionKey = config.dynamicOptionKey;\n\t\toption.selected = option.selected !== false;\n\t}\n\n\tgetHasUpgradeOptions(feature) {\n\t\tif(feature.record.Id === 'Other') {\n\t\t\tfor (let i = 0; i < feature._transient_.optionConfigurations.length; i++) {\n\t\t\t\tif (feature._transient_.optionConfigurations[i].isUpgrade === true) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn feature.containsUpgrades;\n\t\t}\n\t}\n\n\tsortAndAddOptionConfigs(feature, unsorted) {\n\t\tlet duplicate;\n\t\tfor (let optionConfig of unsorted) {\n\t\t\tif (!!optionConfig) {\n\t\t\t\tif (this.isAddFeature(feature)) {\n\t\t\t\t\toptionConfig.added = true;\n\t\t\t\t\tduplicate = !!feature._transient_.optionConfigurations.filter(o => {return o.record.Id === optionConfig.record.Id;});\n\t\t\t\t}\n\t\t\t\tthis.setOptionDisabledData(optionConfig, duplicate);\n\t\t\t\tfeature._transient_.optionConfigurations.push(optionConfig);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcreateConstraintsHoverMessages(constraintsByConstrained) {\n\t\tthis.optionConstraintsByConstrained = constraintsByConstrained;\n\t\tfor (let option of this.product.options) {\n\t\t\tthis.createConstraintHoverMessage(option);\n\t\t}\n\t}\n\n\tcreateConstraintHoverMessage(option) {\n\t\tif (!this.optionConstraintsByConstrained[option.record.Id])\n\t\t\treturn;\n\n\t\tlet constraint = this.optionConstraintsByConstrained[option.record.Id],\n\t\t\tmessage = {'Requires': [], 'Excludes': []},\n\t\t\tconstraintMessage = [];\n\n\t\tconstraint.ungroupedConstraints.forEach(function(ungrouped) {\n\t\t\tlet type = ungrouped.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = ungrouped.type === 'Dependency' ? 'or ' : 'and ',\n\t\t\t\tconnector = message[type].length ? operator : type + ': ',\n\t\t\t\tconstrainingOption = this.optionsById[ungrouped.option].record[this.prefix + 'ProductName__c'];\n\t\t\tmessage[type].push(connector + constrainingOption);\n\t\t}.bind(this));\n\n\t\tObject.keys(constraint.groups).forEach(function(groupName, i) {\n\t\t\tlet group = constraint.groups[groupName],\n\t\t\t\ttype = group.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = message[type].length ? (i == 0 && constraint.ungroupedConstraints[0] ? 'and ' : 'or ') : type + ': ',\n\t\t\t\tstatement = '';\n\n\t\t\tgroup.options.forEach(function(groupedOption, index) {\n\t\t\t\tlet constraining = this.optionsById[groupedOption].record[this.prefix + 'ProductName__c'];\n\t\t\t\toperator = index === 0 ? operator : ' and ';\n\t\t\t\tstatement += (operator + constraining);\n\t\t\t}.bind(this));\n\n\t\t\tmessage[type].push(statement);\n\t\t}.bind(this));\n\n\t\tif (message.Requires.length)\n\t\t\tfor (let requirement of message.Requires) { constraintMessage.push(requirement); }\n\t\tif (message.Excludes.length)\n\t\t\tfor (let exclusion of message.Excludes) { constraintMessage.push(exclusion); }\n\n\t\toption.constraintMessage = constraintMessage;\n\t}\n\n\toptionSystemOrRequired(id) {\n\t\tlet option = this.optionsById[id];\n\t\treturn option.record[this.prefix + 'System__c'] || option.record[this.prefix + 'Required__c'];\n\t}\n\n\tisOptionLookupViewModel() {\n\t\treturn !!this.featureLookupId;\n\t}\n\n\tisClickFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Click';\n\t}\n\n\tisAddFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Add';\n\t}\n\n\tisDynamicFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Dynamic';\n\t}\n\n\taddFeaturesWithOptionsOrConfigAttr(feature) {\n\t\tif (!this.optionsByFeatureId[feature.record.Id] && !this.configAttributesByFeatureId[feature.record.Id] && !this.isDynamicFeature(feature))\n\t\t\treturn;\n\t\tthis.featuresWithOptionsOrConfigAttr.push(feature);\n\t\tthis.featureIdsWithOptionsOrConfigAttr[feature.record.Id] = feature;\n\t\tif (this.isClickFeature(feature))\n\t\t\tthis.featureIdsWithSelectionMethodClick[feature.record.Id] = true;\n\t\telse if (this.isAddFeature(feature))\n\t\t\tthis.featureIdsWithSelectionMethodAdd[feature.record.Id] = true;\n\t\telse if (this.isDynamicFeature(feature))\n\t\t\tthis.featureIdsWIthSelectionMethodDynamic[feature.record.Id] = true;\n\t}\n\n\t/**\n\t * Syncs the current configuration level's nested option's configurations\n\t * @private\n\t */\n\t_syncOptionConfigurations() {\n\t\tconst optionConfig = this._getPreviouslyConfiguredBundle();\n\t\tif (optionConfig === null)\n\t\t\treturn;\n\n\t\tconst id = optionConfig.optionData.Id || optionConfig.optionId;\n\t\tconst feature = this.getFeatureByOptionId(id);\n\t\tfor (let option of feature._transient_.optionConfigurations) {\n\t\t\tif (option.record.Id === id && option.index === optionConfig.index) {\n\t\t\t\toption.optionConfigurations = optionConfig.optionConfigurations;\n\t\t\t\toption.configurationData = optionConfig.configurationData;\n\t\t\t\tdelete optionConfig.tag;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Gets the previously configured nested configuration\n\t * @private\n\t */\n\t_getPreviouslyConfiguredBundle() {\n\t\tfor (const config of this.product.configuration.optionConfigurations) {\n\t\t\tif (config.tag === 'saved')\n\t\t\t\treturn config;\n\t\t}\n\t\treturn null;\n\t}\n}\n","export class OptionConstraintsHandler {\n\tconstructor(product, prefix) {\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.messages = {};\n\t\tthis.setOptionConstraints();\n\t}\n\n\tsetOptionConstraints() {\n\t\tif (!this.product.constraints)\n\t\t\treturn null;\n\n\t\tlet constraintType = this.prefix + 'Type__c',\n\t\t\tconstrainedOption = this.prefix + 'ConstrainedOption__c',\n\t\t\tconstrainingOption = this.prefix + 'ConstrainingOption__c',\n\t\t\tconstraintGroup = this.prefix + 'OptionConstraintGroup__c',\n\t\t\tconstraints = {\n\t\t\t\tbyConstraining: {},\n\t\t\t\tbyConstrained: {},\n\t\t\t\tconstrainingByConstrained: {}\n\t\t\t};\n\n\t\tthis.product.constraints.forEach(constraint => {\n\t\t\tlet type = constraint.record[constraintType],\n\t\t\t\tconstrainedId = constraint.record[constrainedOption],\n\t\t\t\tconstrainingId = constraint.record[constrainingOption],\n\t\t\t\tgroups = constraint.record[constraintGroup] ? constraint.record[constraintGroup].split(', ') : null;\n\n\t\t\t//1- .byConstraining to reference constrained option and type on selection\n\t\t\tthis.setByConstraining(constraints, type, constrainedId, constrainingId);\n\n\t\t\t//2- .byConstrained to reference all constraining options on reference to constrained\n\t\t\tthis.setByConstrained(constraints, type, constrainedId, constrainingId, groups);\n\n\t\t\t//3- Ungrouped exclusion constraints are reflexive\n\t\t\tif (type === 'Exclusion' && !groups) {\n\t\t\t\tthis.setByConstraining(constraints, type, constrainingId, constrainedId);\n\t\t\t\tthis.setByConstrained(constraints, type, constrainingId, constrainedId);\n\t\t\t}\n\n\t\t\t//4- All constraining options by constrained only\n\t\t\tlet constraining = constraints.constrainingByConstrained[constrainedId] || [];\n\t\t\tconstraining.push(this.getOption(constrainingId));\n\t\t\tconstraints.constrainingByConstrained[constrainedId] = constraining;\n\t\t});\n\n\t\tthis.optionConstraints = constraints;\n\t}\n\n\thandleOptionConstraints(changedOptionId, selected) {\n\t\tif (!this.optionConstraints || !this.optionConstraints.byConstraining[changedOptionId])\n\t\t\treturn;\n\n\t\tlet result = [],\n\t\t\taddedOrSelected = selected || this.getOption(changedOptionId).added;\n\t\t// Can't depend on option selection always firing before constraints handling\n\t\tthis.getOption(changedOptionId).selected = selected;\n\n\t\tthis.optionConstraints.byConstraining[changedOptionId].forEach(constraint => {\n\t\t\tlet disabledState = this.optionIsConstrained(constraint, changedOptionId, addedOrSelected);\n\t\t\tlet constrainedOption = this.getOption(constraint.option);\n\t\t\tlet selected = constrainedOption.selected;\n\t\t\tlet rendered = constrainedOption._transient_ && constrainedOption._transient_.rendered;\n\t\t\tresult.push({optionId: constraint.option, disabledState: disabledState, selected: selected, rendered: rendered});\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetUnrenderedConstraining(constrained) {\n\t\tlet constraining = this.optionConstraints.constrainingByConstrained[constrained] || [];\n\t\treturn constraining.filter(constraint => {\n\t\t\t// filter out options marked as rendered\n\t\t\treturn !constraint._transient_ || !constraint._transient_.rendered;\n\t\t});\n\t}\n\n\toptionIsConstrained(constraint, changedOptionId, selected) {\n\t\tlet constraintType = constraint.type,\n\t\t\tconstrainedOption = this.optionConstraints.byConstrained[constraint.option],\n\t\t\thasGroupConstraints = Object.keys(constrainedOption.groups).length > 0,\n\t\t\tconstraintObj = this.isConstrainedByUngrouped(constrainedOption);\n\n\t\tif (constraintObj.constrained)\n\t\t\treturn true;\n\n\t\tif (hasGroupConstraints)\n\t\t\treturn this.isConstrainedByGrouped(constrainedOption.groups);\n\n\t\treturn this.getUnaffectedDisabledState(changedOptionId, selected, constraintType === 'Dependency', constraintObj.requiredConditionMet);\n\t}\n\n\tisConstrainedByUngrouped(constrainedOption) {\n\t\tlet excludedConstrained = false,\n\t\t\trequiredConstrained = false,\n\t\t\trequiredConditionMet = false,\n\t\t\tungroupedConstraints = constrainedOption.ungroupedConstraints,\n\t\t\tlen = ungroupedConstraints ? ungroupedConstraints.length : -1,\n\t\t\ti = 0;\n\n\t\twhile (!excludedConstrained && i < len) {\n\t\t\tlet associatedOption = this.getOption(ungroupedConstraints[i].option),\n\t\t\t\tassociatedType = ungroupedConstraints[i].type;\n\n\t\t\tif (associatedType === 'Exclusion') {\n\t\t\t\texcludedConstrained = this.isSelected(associatedOption);\n\t\t\t} else if (associatedType === 'Dependency' && !requiredConditionMet) {\n\t\t\t\trequiredConditionMet = this.isSelected(associatedOption);\n\t\t\t\trequiredConstrained = !requiredConditionMet;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn {'constrained': excludedConstrained || requiredConstrained, 'requiredConditionMet': requiredConditionMet};\n\t}\n\n\tisConstrainedByGrouped(groups) {\n\t\tlet constrained = false,\n\t\t\tconstrainedByDependency = true,\n\t\t\tconstrainedByExclusion = false,\n\t\t\tlen = Object.keys(groups).length,\n\t\t\ti = 0;\n\n\t\twhile (i < len) {\n\t\t\tlet constrainedWithinGroup = false,\n\t\t\t\tgroup = groups[Object.keys(groups)[i]],\n\t\t\t\ttype = group.type,\n\t\t\t\toptions = group.options,\n\t\t\t\tlen2 = options.length,\n\t\t\t\tj = 0;\n\n\t\t\tif (type === 'Dependency' && constrainedByDependency && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1)\n\t\t\t\t\t\tconstrainedByDependency = false;\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByDependency;\n\t\t\t}\n\n\t\t\tif (type === 'Exclusion' && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1) {\n\t\t\t\t\t\tconstrainedByExclusion = true;\n\t\t\t\t\t}\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByExclusion;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn constrained;\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.product.options.find(option => option.record.Id === optionId);\n\t}\n\n\tisSelected(option) {\n\t\treturn (option && (option.selected || option.added || !!option.priorOptionExists));\n\t}\n\n\tgetUnaffectedDisabledState(optId, selected, isDependency, requiredConditionMet) {\n\t\tif (isDependency) {\n\t\t\treturn requiredConditionMet ? false : !(selected || !!this.getOption(optId).priorOptionExists);\n\t\t}\n\t\telse\n\t\t\treturn selected || !!this.getOption(optId).priorOptionExists;\n\t}\n\n\toptionShouldBeDisabled(optId) {\n\t\tlet constrainedOption = this.optionConstraints.byConstrained[optId],\n\t\t\thasUngroupedConstraints, hasGroupedConstraints, constrainingId, selected, constraint;\n\n\t\tif (!constrainedOption)\n\t\t\treturn false;\n\n\t\thasUngroupedConstraints = constrainedOption.ungroupedConstraints.length >= 1;\n\t\thasGroupedConstraints = Object.keys(constrainedOption.groups).length >= 1;\n\n\t\t// Just need one applicable constrainingId to examine all related constraints via optionIsConstrained()\n\t\tif (hasUngroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.ungroupedConstraints[0].option;\n\t\t} else if (hasGroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.groups[Object.keys(constrainedOption.groups)[0]].options[0];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\tselected = this.isSelected(this.getOption(constrainingId));\n\t\tconstraint = this.optionConstraints.byConstraining[constrainingId].find( c => { return c.option === optId; });\n\n\t\treturn this.optionIsConstrained(constraint, constrainingId, selected);\n\t}\n\n\tsetByConstraining(constraints, type, constrainedId, constrainingId) {\n\t\tconstraints.byConstraining[constrainingId] = constraints.byConstraining[constrainingId] || [];\n\t\tconstraints.byConstraining[constrainingId].push({\n\t\t\ttype: type,\n\t\t\toption: constrainedId\n\t\t});\n\t}\n\n\tsetByConstrained(constraints, type, constrainedId, constrainingId, groups) {\n\t\tconstraints.byConstrained[constrainedId] = constraints.byConstrained[constrainedId] ||\n\t\t\t{ ungroupedConstraints: [], groups: {} };\n\t\tif (groups) {\n\t\t\tthis.setConstrainedForGroups(constraints, type, constrainedId, constrainingId, groups);\n\t\t} else {\n\t\t\tthis.setConstrainedForUngrouped(constraints, type, constrainedId, constrainingId);\n\t\t}\n\t}\n\n\tsetConstrainedForGroups(constraints, type, constrainedId, constrainingId, groups) {\n\t\tfor (let group of groups) {\n\t\t\tconstraints.byConstrained[constrainedId].groups[group] = constraints.byConstrained[constrainedId].groups[group] ||\n\t\t\t\t{ type: type, options: [] };\n\t\t\tconstraints.byConstrained[constrainedId].groups[group].options.push(constrainingId);\n\t\t}\n\t}\n\n\tsetConstrainedForUngrouped(constraints, type, constrainedId, constrainingId) {\n\t\tconstraints.byConstrained[constrainedId].ungroupedConstraints.push({\n\t\t\ttype: type,\n\t\t\toption: constrainingId\n\t\t});\n\t}\n\n\tgetConstrainingByConstrained() {\n\t\treturn Object.values(this.optionConstraints.constrainingByConstrained);\n\t}\n}","export class OptionUpgradeHandler {\n\n\tconstructor(prefix, options, option) {\n\t\tthis.prefix = prefix;\n\t\tthis.options = options;\n\t\tthis.option = option;\n\t}\n\n\tisSourceLine() {\n\t\treturn this.option.priorBundledQuantity != null;\n\t}\n\n\tgetLine() {\n\t\treturn this.option;\n\t}\n\n\tgetLines() {\n\t\treturn this.options;\n\t}\n\n\tgetSourceOrUpgrade(sourceOp, upgradeOp) {\n\t\tfor(let i = 0; i < this.options.length; i++) {\n\t\t\tlet sourceOption = sourceOp || this.options[i];\n\t\t\tlet upgradeOption = upgradeOp || this.options[i];\n\n\t\t\tif(upgradeOption.sourceProductIds && (upgradeOption.sourceProductIds.indexOf(sourceOption.record[this.prefix + 'OptionalSKU__c']) != -1)) {\n\t\t\t\treturn this.options[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSourceAndUpgrade(sourceOption, upgradeOption) {\n\t\tthis.sourceOption = sourceOption;\n\t\tthis.upgradeOption = upgradeOption;\n\t}\n\n\tgetSourceIdField() {\n\t\treturn this.prefix + 'OptionalSKU__c';\n\t}\n\n\tgetUpgradeConversionRateField() {\n\t\treturn this.prefix + 'UpgradeConversionRate__c';\n\t}\n\n\tgetSourceCurrentQuantityField(sourceOption) {\n\t\treturn sourceOption.selected ? sourceOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetUpgradeCurrentQuantityField(upgradeOption) {\n\t\treturn upgradeOption.selected ? upgradeOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetSourcePriorQuantity(sourceOption) {\n\t\treturn sourceOption.priorBundledQuantity;\n\t}\n\n\tdidSourceQuantityChange(didUserChangeSourceOption, sourceOption, upgradeOption) {\n\t\treturn upgradeOption.selected && (didUserChangeSourceOption || !sourceOption.selected);\n\t}\n\n\tdidUpgradeQuantityChange(didUserChangeSourceOption, sourceOption) {\n\t\treturn sourceOption.selected && !didUserChangeSourceOption\n\t}\n\n\tisSelected(option) {\n\t\treturn option.selected;\n\t}\n\n\tsetUpdatedQuantity(sourceOption, upgradeOption, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n\t\tif(sourceOption.selected) {\n\t\t\tsourceOption.record[this.prefix + 'Quantity__c'] = sourceQtyAfterUpdate;\n\t\t}\n\n\t\tif(upgradeOption.selected) {\n\t\t\tupgradeOption.record[this.prefix + 'Quantity__c'] = upgradeQtyAfterUpdate;\n\t\t}\n\t}\n\n\tgetSourceOption() {\n\t\treturn this.sourceOption;\n\t}\n\n\tgetUpgradeOption() {\n\t\treturn this.upgradeOption;\n\t}\n\n\tsetUpgradedAssetId() {\n\t\tlet sourceOption = this.getSourceOrUpgrade(null, this.option);\n\t\tthis.option.upgradedAssetId = sourceOption.upgradedAssetId;\n\t}\n}\n","import {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class ProductReconfigurer {\n\treconfigure(product, configuration) {\n\t\tlet selectedOptions = {};\n\t\t// attaches nestedOptionModel on initial reconfigure over the product's loaded configuration\n\t\t// if loading from cache, it continues over the passed-in configuration object\n\t\tif (!configuration)\n\t\t\tproduct.nestedOptionModel = product.nestedOptionModel || new NestedOptionsModel(product.configuration, true);\n\t\telse\n\t\t\tproduct.configuration = configuration;\n\t\t// port pertinent data from configuration VO to option VO on initialization\n\t\tif (!!product.configuration.optionConfigurations.length) {\n\t\t\tthis.buildOptionConfiguration(product, product.configuration.optionConfigurations, selectedOptions);\n\t\t\tfor (let option of product.options) {\n\t\t\t\tthis._addSelectedDataToOption(selectedOptions[option.record.Id], option);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let option of product.options) {\n\t\t\t\tif (option.configuration)\n\t\t\t\t\tdelete option.configuration;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildOptionConfiguration(product, optionConfigs, selectedOptions) {\n\t\tlet segmentedMap = {};\n\t\tfor (let i=0;i<optionConfigs.length;i++) {\n\t\t\tlet config = optionConfigs[i];\n\t\t\t//W-013982: optionConfigurations lists each segmented line and this was causing duplicate options to show up\n\t\t\tif(segmentedMap[config.optionId] === true)\n\t\t\t\tcontinue;\n\t\t\tif(config.isSegmented)\n\t\t\t\tsegmentedMap[config.optionId] = true; //keeping track of segmented options\n\n\t\t\tselectedOptions[config.optionId] = this.buildStrippedOptionData(product, config, i);\n\t\t}\n\t}\n\n\tbuildStrippedOptionData(product, config, index) {\n\t\tif (config.optionConfigurations.length === 0) {\n\t\t\tlet productConfiguration = this.newConfiguration(config.optionId, config.optionData, config.isDynamicOption, index);\n\t\t\tproductConfiguration.configured = config.configured;\n\t\t\tif (product.quoteType === 'Amendment') {\n\t\t\t\tproductConfiguration.upgradedAssetId = config.upgradedAssetId;\n\t\t\t\tproductConfiguration.priorBundledQuantity = config.priorBundledQuantity;\n\t\t\t}\n\t\t\treturn productConfiguration;\n\t\t}\n\n\t\tlet optionConfigurations = config.optionConfigurations.length > 0;\n\t\treturn { optionId: config.optionId, optionData: config.optionData, optionConfigurations: optionConfigurations, index: index };\n\t}\n\n\tnewConfiguration(optionId, optionData, isDynamicOption, index) {\n\t\treturn { optionId: optionId, optionData: optionData, isDynamicOption: isDynamicOption, index: index };\n\t}\n\n\t// This seems like a wrong headed function but it is too risky to get rid of it\n\t_addSelectedDataToOption(selected, option) {\n\t\tif (selected) {\n\t\t\toption.isDynamicOption = selected.isDynamicOption;\n\t\t\toption.priorBundledQuantity = selected.priorBundledQuantity;\n\t\t\toption.configured = option.configured || selected.configured === true\n\t\t\t\t|| selected.optionConfigurations;\n\t\t} else\n\t\t\toption.selected = option.selected === true;\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class RuleProcessor {\n\tconstructor(data, product) {\n\t\tthis.prefix = AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\tthis.data = data;\n\t\tthis.product = product;\n\t\tthis.validationMessages = [];\n\t\tthis.productRulesActions = {};\n\t\tthis.optionDataByOptionIdAndIndex = {};\n\t}\n\n\tgetValidationMessages() {\n\t\treturn this.validationMessages;\n\t}\n\n\tgetProductRulesActions() {\n\t\treturn this.productRulesActions;\n\t}\n\n\tgetOptionDataByOptionIdAndIndex() {\n\t\treturn this.optionDataByOptionIdAndIndex;\n\t}\n\n\tinit(nestedOptionModel) {\n\t\tthis.initValidationMessages();\n\n\t\tif (this.product) {\n\t\t\tthis.initProductRulesActions();\n\t\t\tthis.initDescendantTree(nestedOptionModel); // creates index properties on optionConfigurations needed by next function call\n\t\t\tthis.initOptionDataByOptionIdAndIndex();\n\t\t}\n\t}\n\n\tinitValidationMessages() {\n\t\tif (this.data.validationMessages) {\n\t\t\tfor (var message of this.data.validationMessages)\n\t\t\t\tthis.validationMessages.push(message);\n\t\t} else {\n\t\t\tfor (let product of this.data.configuredProducts) {\n\t\t\t\tfor (var message of product.configuration.validationMessages)\n\t\t\t\t\tthis.validationMessages.push(message);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitProductRulesActions(onLoad) {\n\t\tlet selectedOptionIds = {}, disabledOptionIds = {}, hiddenOptionIds = {}; // Actions returned from server\n\t\tlet selectOptions = {}, deselectOptions = {}, showOptions = {}, hideOptions = {}, enableOptions = {}, disableOptions = {}; // Actions required for client side\n\t\tfor (var serverOption of this.data.optionConfigurations)\n\t\t\t\tselectedOptionIds[serverOption.optionData.Id || serverOption.optionId] = true;\n\t\tif (this.data.disabledOptionIds != null) {\n\t\t\tfor (var disabledOption of this.data.disabledOptionIds)\n\t\t\t\tdisabledOptionIds[disabledOption] = true;\n\t\t}\n\t\tif (this.data.hiddenOptionIds != null) {\n\t\t\tfor (var hiddenOption of this.data.hiddenOptionIds)\n\t\t\t\thiddenOptionIds[hiddenOption] = true;\n\t\t}\n\n\t\tif (onLoad)\n\t\t\treturn this.assignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds);\n\n\t\tfor (var option of this.product.options) {\n\t\t\t// use 'hiddenByRule' instead of 'hidden' to ignore options hidden by applying a configuration filter\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\tthis.handleProductActions(hiddenOptionIds, option, showOptions, hideOptions, 'hiddenByRule');\n\t\t\tthis.handleProductActions(disabledOptionIds, option, enableOptions, disableOptions, 'disabled');\n\t\t\tthis.handleProductActions(selectedOptionIds, option, deselectOptions, selectOptions, 'selected');\n\t\t}\n\n\t\tthis.productRulesActions = {\n\t\t\tshowOptions: showOptions, hideOptions: hideOptions, selectOptions: selectOptions,\n\t\t\tdeselectOptions: deselectOptions, enableOptions: enableOptions, disableOptions: disableOptions\n\t\t};\n\t}\n\n\tinitOptionDataByOptionIdAndIndex() {\n\t\tlet optionConfigurations = this.data.optionConfigurations;\n\n\t\tfor(let i=0; i<optionConfigurations.length; i++) {\n\t\t\tlet config = optionConfigurations[i];\n\t\t\tif(this.optionDataByOptionIdAndIndex[config.optionId] === undefined){\n\t\t\t\tthis.optionDataByOptionIdAndIndex[config.optionId] = {};\n\t\t\t}\n\t\t\tthis.optionDataByOptionIdAndIndex[config.optionId][config.index] = {\n\t\t\t\toptionData: config.optionData,\n\t\t\t\tlistPrice: config.listPrice\n\t\t\t}\n\t\t}\n\t}\n\n\thandleProductActions(ids, option, positiveAction, negativeAction, action) {\n\t\tif (action === 'disabled') {\n\t\t\tif (ids[option.record.Id] && (option.disabledData && !option.disabledData.disabled))\n\t\t\t\treturn negativeAction[option.record.Id] = true;\n\t\t\tif (!ids[option.record.Id] && (option.disabledData && option.disabledData.disabled))\n\t\t\t\treturn positiveAction[option.record.Id] = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (ids[option.record.Id] && !option[action])\n\t\t\treturn negativeAction[option.record.Id] = true;\n\t\tif (!ids[option.record.Id] && option[action])\n\t\t\treturn positiveAction[option.record.Id] = true;\n\t}\n\n\tassignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds) {\n\t\tlet systemLabel = this.prefix + 'System__c';\n\t\tthis.product.rulesProcessed = true;\n\t\tfor (var option of this.product.options) {\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\t// always define selected property, allows disabling of record-selected product on load\n\t\t\toption.selected = option.selectedByRule = !!selectedOptionIds[option.record.Id];\n\t\t\tif (disabledOptionIds[option.record.Id])\n\t\t\t\t//Both properties disable manual selection.\n\t\t\t\t//'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t\t\toption.disabledData = {\n\t\t\t\t\t'disabled': true,\n\t\t\t\t\t'constrained': false\n\t\t\t\t};\n\t\t\tif (hiddenOptionIds[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t}\n\t}\n\tinitDescendantTree(nestedOptionModel = this.product.nestedOptionModel) {\n\t\tif(!nestedOptionModel) {\n\t\t\t// we should never get here, but instead of generating a javascript reference error lets just log a warning\n\t\t\tif(console.log) console.warn('Skipped descendant level rules', this.product);\n\t\t\treturn;\n\t\t}\n\n\t\t //Descendant Product Rules overwrite any nested option configurations if the rule because these rules are invoked after the manual configurations\n\t\tlet indices = {};\n\t\tfor (var i=0;i<this.data.optionConfigurations.length;i++) {\n\t\t\tlet optionConfig = this.data.optionConfigurations[i];\n\t\t\tindices[optionConfig.optionId] = indices[optionConfig.optionId] === undefined ? 0 : (indices[optionConfig.optionId] + 1);\n\n\t\t\tlet parentInfo = {'optionId': this.data.optionId, 'index' : this.data.index || 0},\n\t\t\t\tchildInfo = {'optionId': optionConfig.optionId, 'index': indices[optionConfig.optionId]};\n\t\t\toptionConfig.index = indices[optionConfig.optionId];\n\t\t\tnestedOptionModel.handleDescendantRules(\n\t\t\t\t[parentInfo, childInfo],\n\t\t\t\toptionConfig.optionConfigurations,\n\t\t\t\toptionConfig.hiddenOptionIds,\n\t\t\t\toptionConfig.disabledOptionIds,\n\t\t\t\toptionConfig.changedByProductActions\n\t\t\t);\n\t\t}\n\t}\n\n\toptionNotInPricebook(option) {\n\t\treturn option.record[this.prefix + 'UnitPrice__c'] === undefined || option.record[this.prefix + 'UnitPrice__c'] == null;\n\t}\n}","export class ProductAlert {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-alert';\n\t\tthis.properties = {\n\t\t\talerts: Array,\n\t\t\tcontinueCB: Object,\n\t\t\tcancelCB: Object,\n\t\t\tdisplayContinueButton: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t\tcancelText: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Cancel',\n\t\t\t},\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this._onCancel.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn ['init(alerts)'];\n\t}\n\n\tinit() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonRevise() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\ttoggle() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonContinue() {\n\t\tif (typeof this.continueCB === 'function')\n\t\t\tthis.continueCB();\n\t}\n\n\t_onCancel() {\n\t\tif (typeof this.cancelCB === 'function') {\n\t\t\tthis.cancelCB();\n\t\t}\n\t\tthis.$.dialog.toggle();\n\t}\n}\n\nPolymer(ProductAlert);","export class ConfigTree {\n\tconstructor(root /* unstructured tree Object */) {\n\t\tthis.root = root;\n\t\tthis.idProperties = ['optionId', 'index', 'tag'];\n\t\tthis.buildSubtree(this.root);\n\t}\n\n\t/**\n\t * Builds a sub tree with necessary information that can be attached to the main tree\n\t * @param obj {Object} Configuration the user wants to add to the tree\n\t */\n\tbuildSubtree(obj) { //adds index property to configuration as it is built\n\t\tlet indices = {};\n\t\tthis._buildNode(obj);\n\t\tobj.getChildren(obj).forEach( child => {\n\t\t\tindices[child.optionId] = indices[child.optionId] || child.index || 0;\n\t\t\tif (child.index === undefined || indices[child.optionId] === child.index) {\n\t\t\t\tchild.index = indices[child.optionId];\n\t\t\t\tindices[child.optionId]++;\n\t\t\t}\n\t\t\tthis.buildSubtree(child);\n\t\t});\n\t}\n\n\t/**\n\t * Finds the object level that an action affects\n\t * @param path {Array} List containing information of the sub tree's path\n\t * @returns {Object} Configuration specified by the path\n\t */\n\tgetFromPath(path) {\n\t\tlet currentLevel = this.root;\n\t\tfor (let i = 0, l = path.length; i<l; i++) {\n\t\t\t// As we traverse down the path, we are looking for the cloned configuration created by clicking on the wrench icon\n\t\t\t// We only want to find the cloned configuration created from the save action at the last level\n\t\t\tlet id = this._buildId(path[i]);\n\t\t\tcurrentLevel = this._findOnLevel(id, currentLevel);\n\t\t}\n\t\treturn currentLevel;\n\t}\n\n\t/**\n\t * Creates a node that connects it to the root of the tree\n\t * @param obj {Object} Configuration the user wants to add to the tree\n\t * @private\n\t */\n\t_buildNode(obj) {\n\t\tobj.nodeId = this._buildId(obj);\n\t\tobj.getChildren = function () {\n\t\t\treturn this.optionConfigurations;\n\t\t}.bind(obj);\n\t}\n\n\t/**\n\t * Builds Id of the node\n\t * @param properties {Object} Map of unique properties of an option\n\t * @returns {string} Id of the node\n\t * @private\n\t */\n\t_buildId(properties) {\n\t\tlet id = '';\n\t\tfor (let key of this.idProperties) {\n\t\t\tif (key !== 'tag' || key === 'tag' && properties[key] != null)\n\t\t\t\tid += '_' + properties[key];\n\t\t}\n\t\treturn id;\n\t}\n\n\t_findOnLevel(idProperties, obj) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\tobj = obj || this.root;\n\t\treturn obj.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {Page} from 'common/core/Page.js';\n\nexport class CloneToGroupDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-clone-to-group-dialog';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tquoteModel: Object\n\t\t}, Page.properties );\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.addEventListener('sb-cancel-clone-to-group', this.onCancel);\n\t\t});\n\t}\n\n\topen() {\n\t\tthis.lineGroups = this.quoteModel.lineGroups;\n\t\tthis.$.dialog.toggle();\n\t\t// For each line group build an object that contains groupKey (marked as value), name (marked as label),\n\t\t// defaults to unselected\n\t\tlet arr = [];\n\t\tfor (let i = 0, l = this.lineGroups.length; i < l; i++) {\n\t\t\tarr.push({\n\t\t\t\tvalue: this.lineGroups[i].groupKey,\n\t\t\t\tlabel: this.lineGroups[i].groupVO.record.Name,\n\t\t\t\tselected: false\n\t\t\t});\n\t\t}\n\t\tthis.groups = arr;\n\t\tif (!this.isMobile) {\n\t\t\tthis.availableGroupTitle = AppContext.properties.i18n.value().l('Available Groups');\n\t\t\tthis.chosenGroupTitle = AppContext.properties.i18n.value().l('Selected Groups');\n\t\t}\n\t}\n\n\tonSave() {\n\t\tif (!this.isMobile) {\n\t\t\t// In Desktop Selected groups two way data bound to value in the dual-list-box component,\n\t\t\t// when save button is tapped dual-list-box sends the selected options (in our case groups) back\n\t\t\tthis.fire('sb-clone-to-group-selected', this.selectedGroups);\n\t\t} else {\n\t\t\tthis.selectedGroups = this._getSelectedGroups();\n\t\t\tthis.fire('sb-clone-to-group-selected', this.selectedGroups);\n\t\t\tthis.groups = undefined;\n\t\t}\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t\tif (this.isMobile) {\n\t\t\tthis.groups = undefined;\n\t\t}\n\t}\n\n\t_getSelectedGroups() {\n\t\tlet selectedGroups = [];\n\t\tfor (let i = 0, l = this.groups.length; i < l; i++) {\n\t\t\tif (this.groups[i].selected) {\n\t\t\t\tselectedGroups.push(this.groups[i]);\n\t\t\t}\n\t\t}\n\t\treturn selectedGroups;\n\t}\n\n\ttoggleSelectedClass(e) {\n\t\tlet currentTarget = e.currentTarget;\n\t\tlet isContainerHighlighted = currentTarget.classList.contains('backgroundContainer');\n\t\tlet dataIndex = currentTarget.dataIndex;\n\t\tthis.set(`groups.${dataIndex}.selected`, !isContainerHighlighted);\n\t\tthis.toggleClass('backgroundContainer', !isContainerHighlighted, currentTarget);\n\t}\n}\n\nPolymer( CloneToGroupDialog );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events } from 'common/core/Events.js';\n\nconst GHOST_X_OFFSET = 410;\nconst GHOST_Y_OFFSET = 180;\nconst visibilityHidden = ' visibilityHidden';\nexport class CustomSegmentDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-segment-dialog';\n\t\tthis.properties = {\n\t\t\t// dataLineModels is incoming data, and set by the caller\n\t\t\tdataLineModels: Array,\n\t\t\t// Local variable so that the component can modify the data\n\t\t\tlineModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// GroupModel is being set by the lineModels\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// deletedLineKeys is used for the backend so that it is tracking when it's tracking lines which should be deleted\n\t\t\tdeletedLineKeys: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\t// errors to display when errors from server or errors from validation logic\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Header Actions - this is just for UI alignment purpose at this moment.\n\t\t\theaderActions: Array,\n\t\t\t// header selection checkbox\n\t\t\theaderSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-cancel-custom-segment': '_onCancel',\n\t\t\t'add-tapped': '_onAddByLine',\n\t\t\t'delete-tapped': '_onDeleteByLine'\n\t\t};\n\t}\n\n\t// Getters\n\tget observers() {\n\t\treturn ['_dataChanged(dataLineModels)',\n\t\t\t\t'_lineModelChanged(lineModels)',\n\t\t\t\t'_handleCustomSegmentsResponseChanged(updateCustomSegmentsResponse)',\n\t\t\t\t'_handleErrorResponseChanged(errorResponse)',\n\t\t\t\t'_toggleAllCheckBoxes(headerSelected)'\n\t\t];\n\t}\n\n\t/**\n\t * Get constants which are being used in the logic\n\t *\n\t * @returns {*}\n\t */\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Get quote line metadata from the editorModel.md\n\t *\n\t * @returns {*}\n\t */\n\tget quoteLineMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t}\n\n\t/**\n\t * Get the custom labels from the editorModel\n\t *\n\t * @returns {*}\n\t */\n\tget customLabels() {\n\t\treturn this.editorModel.data.customLabels;\n\t}\n\n\t/**\n\t * Helper method to find the appropriate table row to drop to.\n\t *\n\t * @param\n\t * @returns {*}\n\t * @private\n\t */\n\t_findTableRowValidTarget(el) {\n\t\tif (!el) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._ifParentIsValidTarget(el)) {\n\t\t\treturn el;\n\t\t}\n\t\tif (el.parentNode) {\n\t\t\treturn this._findTableRowValidTarget(el.parentNode);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to determine whether the element being passed is a valid target.\n\t * Criteria is whether the element's parent has a css class we're looking for.\n\t * @param {Element} element.\n\t * @private\n\t */\n\n\t_ifParentIsValidTarget(element) {\n\t\tif (!element.parentElement) return false;\n\t\tif (element.parentElement.id == 'swipe-header') {\n\t\t\tthis.targetRowElement = element.parentElement.parentElement;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * To deteremine whether it's viewport changed\n\t *\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tlet rows = this.dragDrop ? this.dragDrop.segmentRows : null;\n\t\tif (rows) {\n\t\t\tif (this._isMobileViewport() || !AppContext.isDesktop) { \n\t\t\t\tfor ( let i = 0, l = rows.length; i < l; i++) { \n\t\t\t\t\trows[i].removeEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let j = 0, l = rows.length; j < l; j++) {\n\t\t\t\t\trows[j].addEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To copy the incoming data into local data so that it can manipulate.\n\t *\n\t *\n\t * @private\n\t */\n\t_dataChanged() {\n\t\tif ( !this.dataLineModels ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.groupModel = this.dataLineModels[0].groupModel;\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\n\t\t// To create a new copies so that it can be used in every pop-up session without affecting the actual lineModels at the quote.\n\t\tlet lineModels = [];\n\t\tlet i, l = this.dataLineModels.length;\n\t\tlet lineModelByStartDate = {};\n\n\t\tfor (i=0; i < l; i++ ) {\n\t\t\tlet currentLineModel = this.dataLineModels[i];\n\t\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\t\t\tnewLineModel.selected = false;\n\t\t\tlineModelByStartDate[newLineModel.lineVO.record[this.constants.START_DATE_FIELD]] = newLineModel;\n\t\t}\n\n\t\t// Need to sort lineModels by Start Date because the incoming lineModels was not in the correct order. They were re-sorted after saving to the quote\n\t\tlet startDates = Object.keys(lineModelByStartDate).sort();\n\t\tfor(i=0; i <l; i++) {\n\t\t\tlineModels.push(lineModelByStartDate[startDates[i]]);\n\t\t}\n\n\t\tthis.lineModels = lineModels;\n\t}\n\n\t/**\n\t *  To determine if it's line model changed and reset the data\n\t *\n\t * @private\n\t */\n\t_lineModelChanged() {\n\t\tif ( this.lineModels && this.lineModels.length > 0 ) {\n\t\t\tthis.deletedLineKeys = [];\n\t\t\tthis.errors = [];\n\t\t\tthis._buildDialog();\n\t\t}\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment response, it needs to run _updateQuote so that it will update the UI\n\t *\n\t * @private\n\t */\n\t_handleCustomSegmentsResponseChanged(e) {\n\t\tif (e.partialVO) {\n\t\t\t// If the response quote is a partial VO, we need to reconcile its partial data against the full quote's data.\n\t\t\te = this._combinePartialQuoteWithFullQuote(e);\n\t\t}\n\t\tthis.fire('segmented-changed', {quoteVO: e});\n\t\t// Need to reset all data so that it won't carry from the previous session.\n\t\tthis.resetData();\n\t}\n\n\t_combinePartialQuoteWithFullQuote(partialQuote) {\n\t\tlet fullQuote = this.groupModel.quoteModel.quoteVO;\n\n\t\t// First, we should sort the received line items by their segment key, as well as map them by their key.\n\t\tlet lineSetsBySegmentKey = new Map();\n\t\tlet linesByKey = new Map();\n\t\tpartialQuote.lineItems.forEach((line) => {\n\t\t\t// Map the line by its key, and if its Segment Key is one we sent to be updated, add it to the list of lines\n\t\t\t// sharing that segment key.\n\t\t\tlinesByKey.set(line.key, line);\n\t\t\tlet segKey = line.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\tif (segKey && this._sentMDQKeys.has(segKey)) {\n\t\t\t\tlet linesSharingKey = lineSetsBySegmentKey.get(segKey) || [];\n\t\t\t\tlineSetsBySegmentKey.set(segKey, [...linesSharingKey, line]);\n\t\t\t}\n\t\t});\n\n\t\t// Now, we loop over the line items on the original quote to populate our final list\n\t\tlet combinedList = [];\n\t\tfullQuote.lineItems.forEach((line) => {\n\t\t\tlet segKey = line.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\tlet dimType = line.dimensionType;\n\t\t\tif (segKey && this._sentMDQKeys.has(segKey) && dimType && dimType.toLowerCase() === 'custom') {\n\t\t\t\t// If the line's one of the segments we sent to the server to be updated, how we handle it depends\n\t\t\t\t// on what index it is.\n\t\t\t\t// If it's the first index, we add all of the updated lines for that segment group together, in order to\n\t\t\t\t// make sure they stay together.\n\t\t\t\t// Otherwise, we ignore it, since we'll be adding its updated version (if one exists) together with the first\n\t\t\t\t// segment anyway, and we don't want to add it twice.\n\t\t\t\tlet segIndex = line.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tif (segIndex == 1) {\n\t\t\t\t\tcombinedList = [...combinedList, ...lineSetsBySegmentKey.get(segKey)];\n\t\t\t\t}\n\t\t\t} else if (linesByKey.has(line.key)) {\n\t\t\t\t// If the line isn't part of a segment we were updating, but it was still a line that we sent,\n\t\t\t\t// we use the updated version.\n\t\t\t\tcombinedList.push(linesByKey.get(line.key));\n\t\t\t} else {\n\t\t\t\t// If we didn't send the line at all, we keep the original.\n\t\t\t\tcombinedList.push(line);\n\t\t\t}\n\t\t});\n\n\t\t// Now we assign the full list to the partial quote and mark it as a full quote.\n\t\tpartialQuote.lineItems = combinedList;\n\t\tpartialQuote.partialVO = false;\n\t\treturn partialQuote;\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment error response, it will populate the backend errors to the frontend\n\t *\n\t * @private\n\t */\n\t_handleErrorResponseChanged() {\n\t\tlet errors = this.errors || [];\n\t\tthis.set(`errors`, errors.push(this.errorResponse));\n\t}\n\n\n\t/**\n\t * To add a group of element at the end of specific index\n\t *\n\t *\n\t * @param e     format: information is stored in the e.detail (index: index Which is generated by the component\n\t * @private\n\t */\n\t_onAddByLine(e) {\n\t\tthis._onAddByIndex(e.detail.index);\n\t}\n\n\t/**\n\t * To add a new custom segments and it supports to add at the end of the segment list or at a specific location below the line\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onAdd(e) {\n\t\tthis.$.dialog.toggleMenu();\n\t\t// Add from action; otherwise, add from the line level\n\t\tlet index = this.lineModels.length - 1;\n\t\tthis._onAddByIndex(index)\n\t}\n\n\t/**\n\t * To add line by index. This will be used for the line and action which is at the end of the dialog\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onAddByIndex(index) {\n\t\t// Copy the existing lines from the clicked index\n\t\tlet currentLineModel = this.lineModels[index];\n\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\tnewLineVO.record = {};\n\t\tnewLineVO.record[this.constants.SEGMENT_LABEL_FIELD] = '';\n\t\tnewLineVO.record[this.constants.START_DATE_FIELD] = null;\n\t\tnewLineVO.record[this.constants.END_DATE_FIELD] = null;\n\n\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\n\t\t// reset the line record info\n\t\tnewLineModel.lineVO.record.Id = null;\n\t\tnewLineModel.lineVO.key = null;\n\t\tnewLineModel.selected = false;\n\n\t\tthis.splice('lineModels', index+1, 0, newLineModel);\n\t\tthis.headerSelected = false;\n\t\tthis.$.segmentGroup.addEventListener(\"dom-change\", function(e) {\n\t\t\tlet newRows = this.$.segmentRows.querySelectorAll('#segmentRow');\n\t\t\tif(newRows[newRows.length - 1].model.lineVO.key === null) {\n\t\t\t\tnewRows[newRows.length - 1].$.row.click();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\n\t/**\n\t * To delete a group of element at the end of specific index\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onDeleteByLine(e) {\n\t\tthis._onDeleteLineData(e.detail.index);\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete all custom segments\n\t *\n\t * @private\n\t */\n\t_onDelete(){\n\t\tlet i, l=this.lineModels.length;\n\t\tfor (i=l-1; i > 0; i--) {\n\t\t\tlet lineModel = this.lineModels[i];\n\t\t\tif ( lineModel.selected ) {\n\t\t\t\tthis._onDeleteLineData(i);\n\t\t\t}\n\t\t}\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete the lineModel on the frontend\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onDeleteLineData(index) {\n\t\tlet lineModel = this.lineModels[index];\n\t\tif (lineModel.lineVO.key != null) {\n\t\t\tthis.deletedLineKeys.push(lineModel.lineVO.key);\n\t\t}\n\t\tthis.splice('lineModels', index, 1);\n\t}\n\n\t/**\n\t * Upon onSave:\n\t *      - Reset all the internal properties for validation checks\n\t *      - Run the validation check\n\t *          - if everything pass, it will send it to backend and fire a CustomEvent to update the quote\n\t *          - if one of them fails, the error message will be displayed on on the frontend\n\t *\n\t * @private\n\t */\n\t_onSave() {\n\t\t// Reset all properties before running any validation\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis._validateCustomSegmentLabels();\n\t\tthis._validateCustomSegmentDates();\n\t\tlet errors = [];\n\t\tif (this.hasInvalidSegmentDates) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasInvalidSegmentLabels ) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_labels);\n\t\t}\n\n\t\tif ( this.hasNonConsecutiveDates ) {\n\t\t\terrors.push(this.customLabels.msg_nonsequential_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasOverlappingSegments ) {\n\t\t\terrors.push(this.customLabels.msg_overlapping_custom_segment_dates);\n\t\t}\n\n\t\t// Reset all the errors from the previous click on Save\n\t\tthis.set('errors', []);\n\t\tthis.set('errors', errors);\n\n\n\t\t// Gather a list of information which are needed for update custom segments in the backend\n\t\tif (  errors.length == 0 ) {\n\t\t\tlet updateSegmentMap = this._getCustomSegmentUpdates();\n\t\t\tupdateSegmentMap.updateCustomSegments = true;\n\t\t\tlet minimizedQuote = this._createQuoteWithoutUnaffectedLines(this.groupModel.groupKey);\n\t\t\tlet model = {\n\t\t\t\tquote: minimizedQuote,\n\t\t\t\tupdateCustomSegments: updateSegmentMap.updateCustomSegments,\n\t\t\t\tupdatedLineKeys: updateSegmentMap.updatedLineKeys,\n\t\t\t\tdeletedLineKeys: this.deletedLineKeys,\n\t\t\t\tstartDates: updateSegmentMap.startDates,\n\t\t\t\tendDates: updateSegmentMap.endDates,\n\t\t\t\tsegmentLabels: updateSegmentMap.segmentLabels\n\t\t\t};\n\t\t\tthis.$.UpdateCustomSegmentsService.model = model;\n\t\t}\n\t}\n\n\t_createQuoteWithoutUnaffectedLines(groupKey) {\n\t\tlet quote = this.groupModel.quoteModel.quoteVO;\n\t\tif (!this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// If the JSQC isn't enabled, we have to send all of the lines, because the server's going to try to recalculate.\n\t\t\treturn quote;\n\t\t}\n\t\t// If the JSQC's enabled, we don't need to send all of the lines. In fact, the only lines we need to send are the\n\t\t// Custom-segmented lines with the targeted group key, and any lines that reference the one of those lines\n\t\t// as a source line.\n\t\t// Before we do anything else, we need to send the quote through a JSON roundtrip in order to make it a separate object.\n\t\tquote = JSON.parse(JSON.stringify(quote));\n\t\tlet necessaryLineKeys = new Set();\n\t\tlet necessaryLineIds = new Set();\n\t\tlet sentMDQKeys = new Set();\n\t\t// If the line is in the right group and it has a custom dimension, record its key and ID. Also record its segment\n\t\t// key so that we can have a list of all of the MDQ keys we sent to the server.\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.parentGroupKey == groupKey && line.dimensionType == this.constants.TYPE_CUSTOM_DIMENSION) {\n\t\t\t\tnecessaryLineKeys.add(line.key);\n\t\t\t\tsentMDQKeys.add(line.record[this.constants.SEGMENT_KEY_FIELD]);\n\t\t\t\tif (line.record.Id) {\n\t\t\t\t\tnecessaryLineIds.add(line.record.Id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Store the segment keys on 'this' so we can access them later.\n\t\tthis._sentMDQKeys = sentMDQKeys;\n\t\t// Now we need to record the keys of any lines whose Source ID is one of the necessary lines.\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tlet sourceId = line.record[this.constants.SOURCE_FIELD];\n\t\t\tif (sourceId && necessaryLineIds.has(sourceId)) {\n\t\t\t\tnecessaryLineKeys.add(line.key);\n\t\t\t}\n\t\t});\n\t\t// Now we loop over the lines one last time and keep only the necessary ones.\n\t\tlet necessaryLines = [];\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (necessaryLineKeys.has(line.key)) {\n\t\t\t\tnecessaryLines.push(line);\n\t\t\t}\n\t\t});\n\t\tquote.lineItems = necessaryLines;\n\t\tquote.partialVO = true;\n\t\treturn quote;\n\t}\n\n\t/**\n\t * Reset the data\n\t * To close the dialog and reset the data back to the original\n\t *\n\t * @private\n\t */\n\t_onCancel() {\n\t\t// Before closing the dialog, clearing those data\n\t\tthis.errors = undefined;\n\t\tthis.groupModel = undefined;\n\t\tthis.deletedLineKeys = [];\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t/**\n\t * To toggle the checkbox from select all\n\t *  - First lineModel cannot be updated with selected checkbox\n\t *\n\t * @private\n\t */\n\t_toggleAllCheckBoxes() {\n\t\t// listen for when the selection list selects all of the items\n\t\tif ( this.lineModels) {\n\t\t\tlet i, l = this.lineModels.length;\n\t\t\t// Update the data model\n\t\t\tfor (i = l-1; i > 0; i--) {\n\t\t\t\tthis.set(`lineModels.${i}.selected`, this.headerSelected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset all data\n\t *\n\t */\n\tresetData() {\n\t\tthis.errors = undefined;\n\t\tthis.deletedLineKeys = [];\n\t\tthis._sentMDQKeys = undefined;\n\t}\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To build the dialog\n\t *\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tthis._buildFieldsMD();\n\t\tthis._toggleAllCheckBoxes();\n\t\tthis._buildRowData();\n\t\tthis._buildHeaderActions();\n \t}\n\n\n\t/***\n\t * Build fields metadata based on the fields that we need for the custom segment table\n\t *\n\t * @private\n\t */\n\t_buildFieldsMD() {\n\t\tlet quoteLineMD = this.quoteLineMD;\n\t\tlet fields = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet fieldsMD = [];\n\t\tfor (let i=0; i < fields.length; i++) {\n\t\t\tfieldsMD.push(quoteLineMD[fields[i]]);\n\t\t}\n\t\tthis.fields = fields;\n\t\tthis.fieldsMD = fieldsMD;\n\t}\n\n\n\t/**\n\t * To build the row data so that it can be used in the sb-table-row\n\t *\n\t * @private\n\t */\n\t_buildRowData() {\n\t\tlet recordKeys = [];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet fieldsLength = this.fields.length;\n\t\tfor (let i=0; i < fieldsLength; i++) {\n\t\t\tlet field = this.fields[i];\n\t\t\tlet fieldMD = this.fieldsMD[i];\n\t\t\tlet key = fieldMD.name;\n\t\t\trecordKeys.push(key);\n\t\t\tlet label = fieldMD.label;\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[key] = fieldMD.type;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap, null, true).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\n\t/**\n\t * To build a header actions to occupy the space in the table to make columns align correctly.\n\t *\n\t * @private\n\t */\n\t_buildHeaderActions() {\n\t\tlet rightAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: true\n\t\t};\n\t\tthis.headerActions = [rightAction, rightAction];\n\t}\n\n\n\t/**\n\t * Build the action so that it can be attached to each row when it's using the sb-table-row\n\t * - Special condition:\n\t *      - For index = 0, it doesn't have the delete method\n\t *\n\t * @param index\n\t * @returns {Array}\n\t * @private\n\t */\n\t_buildRowActions(index) {\n\t\tlet actions = [];\n\t\tlet addAction = {\n\t\t\ticon: 'sb-icon-plus',\n\t\t\ttitle: this.customLabels.lbl_add_segment,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: this.groupModel.quoteModel.isAmendmentOrChangeQuote,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\n\t\tlet deleteAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\ttitle: this.customLabels.lbl_delete_custom_segments,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: (index == 0 || this.groupModel.quoteModel.isAmendmentOrChangeQuote),\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\t\tactions.push(addAction);\n\t\tactions.push(deleteAction);\n\n\t\treturn actions;\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t/**\n\t * Update the data path with value based on the parameter data map\n\t *\n\t * @param dataMap: {key - property, value - value to update }\n\t * @private\n\t */\n\t_updateData(/*Map*/ dataMap) {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor ( let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet keys = Object.keys(dataMap);\n\t\t\tfor ( let j=0; j < keys.length; j++ ) {\n\t\t\t\tlet key = keys[j];\n\t\t\t\tlet value = dataMap[key];\n\t\t\t\tlet path = `lineModels.${i}.${key}`;\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the segment table to reflect the rendering\n\t *\n\t * @private\n\t */\n\t_updateSegmentTable(){\n\t\tlet dataMap = {'selected': false};\n\t\tthis._updateData(dataMap);\n\t}\n\n\t/**\n\t * Generate a list information which is required for custom segment updates.\n\t *\n\t * @returns {{updatedLineKeys: Array, startDates: Array, endDates: Array, segmentLabels: Array}}\n\t * @private\n\t */\n\t_getCustomSegmentUpdates() {\n\t\tlet updates = {updatedLineKeys: [], startDates: [], endDates: [], segmentLabels: []};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++ ) {\n\t\t\tlet lineVO = this.lineModels[i].lineVO;\n\t\t\tlet record = this.lineModels[i].lineVO.record;\n\t\t\tupdates.updatedLineKeys.push(lineVO.key);\n\t\t\tupdates.segmentLabels.push(record[this.constants.SEGMENT_LABEL_FIELD]);\n\t\t\tupdates.startDates.push(record[this.constants.START_DATE_FIELD]);\n\t\t\tupdates.endDates.push(record[this.constants.END_DATE_FIELD]);\n\t\t}\n\t\treturn updates;\n\t}\n\n\t/**\n\t * To valid the custom segment labels for all segments. All custom segment labels should be unique.\n\t * To set hasInvalidSegmentLabels property so that it can be used for saving\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentLabels() {\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tlet customSegmentLabels = {};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet segmentLabel = this.lineModels[i].lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\tif (segmentLabel == null || segmentLabel.trim() === '') {\n\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (!customSegmentLabels[segmentLabel]) {\n\t\t\t\t\tcustomSegmentLabels[segmentLabel] = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * To validate custom segment dates\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentDates() {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++) {\n\t\t\tlet segment = this.lineModels[i].lineVO;\n\t\t\tlet segmentStartDate = segment.record[this.constants.START_DATE_FIELD];\n\t\t\tlet segmentEndDate = segment.record[this.constants.END_DATE_FIELD];\n\n\t\t\tlet segStartDate = new Date(segmentStartDate);\n\t\t\tlet segEndDate = new Date(segmentEndDate);\n\t\t\tif (segmentStartDate == null || segmentEndDate == null) {\n\t\t\t\tthis.hasInvalidDateFormat = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (segStartDate > segEndDate) {\n\t\t\t\t\tthis.hasInvalidSegmentDates = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (i - 1 >= 0) {\n\t\t\t\t\tlet prevSegment = this.lineModels[i - 1].lineVO;\n\t\t\t\t\tlet endDate = new Date(prevSegment.record[this.constants.END_DATE_FIELD]);\n\t\t\t\t\tlet dayAfterEndDate = Date.parse(new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate() + 1));\n\t\t\t\t\tlet startDate = Date.parse(new Date(segStartDate.getFullYear(), segStartDate.getMonth(), segStartDate.getDate()));\n\n\t\t\t\t\tif (this.editorModel.data.settings.allowsNonConsecutiveCustomSegments) {\n\t\t\t\t\t\t// allow non consecutive custom segments\n\t\t\t\t\t\t// start date of one segment must be greater than the end date of the previous segment\n\t\t\t\t\t\tif (segStartDate <= endDate) {\n\t\t\t\t\t\t\tthis.hasOverlappingSegments = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // validate logical order\n\t\t\t\t\t\t// validate consecutive start and end dates between segments\n\t\t\t\t\t\t// start date of a custom segment must be a day after the end of a previous custom segment\n\t\t\t\t\t\tif (dayAfterEndDate != startDate) {\n\t\t\t\t\t\t\tthis.hasNonConsecutiveDates = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset the properties which are relevant for saving the custom segments\n\t *\n\t * @private\n\t */\n\t_resetProperties() {\n\t\tthis.set(`errors`, []);\n\t\tthis.headerSelected = false;\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tthis.hasInvalidSegmentDates = false;\n\t\tthis.hasNonConsecutiveDates = false;\n\t\tthis.hasOverlappingSegments = false;\n\t\tthis.hasInvalidDateFormat = false;\n\t}\n}\n\nPolymer( CustomSegmentDialog );","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {DiscountTierModel} from 'quotes/models/DiscountTierModel.js';\nimport {DiscountTiersValidator} from 'quotes/models/DiscountTiersValidator.js';\nimport {Cache} from 'common/data/cache/Cache.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nexport class DiscountScheduleDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount-schedule-dialog';\n\t\tthis.properties = {\n\t\t\tdiscountSchedule: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdiscountUnit: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tlineModel: Object,\n\t\t\tschedule: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdialogTapped: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.SCHEDULE_ACTION] = this._handleIconAction;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() {\n\t\treturn ['_retrieveSchedule(discountScheduleId)',\n\t\t\t'_buildDialog(schedule)',\n\t\t\t'_discountScheduleResponseChanged(discountScheduleResponse)',\n\t\t\t'_discountScheduleChanged(discountSchedule.*)',\n\t\t\t'_createErrorHandler(error)',\n\t\t\t'_toggleEditableClasses(dialogTapped)',\n\t\t\t'_selectCheckboxes(model.selected)']\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget listeners() {\n\t\treturn { 'delete-tapped' : 'onDeleteLines',\n\t\t\t'add-tapped' : 'onAddLine' }\n\t}\n\n\tready() {\n\t\t// The dialog fires 'sb-cancel-ds' whenever the dialog is closed\n\t\tthis.addEventListener('sb-cancel-ds', this.onCancel);\n\t\t// Handle mobile discount unit changed\n\t\tthis.addEventListener('data-changed', function(e) {\n\t\t\tif (e.detail && e.detail.path == `data.${this.discountUnitField}`) {\n\t\t\t\t// Only rebuild and recalculate if the discountUnit has actually changed\n\t\t\t\tif (this.discountUnit != e.detail.value) {\n\t\t\t\t\tthis.discountUnit = e.detail.value;\n\t\t\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\t\t\tthis.buildRowData();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._handleDialogTap();\n\t\tthis._handleDialogMouseEvents();\n\t}\n\n\t/**\n\t * Service errors get routed through here and displayed in the error message toast\n\t * @private\n\t */\n\t_createErrorHandler() {\n\t\tif (this.error) {\n\t\t\tthis.errors = [this.error.message];\n\t\t}\n\t}\n\n\t/**\n\t * Creates context for discount schedule query and retrieves the quoteline's discount schedule\n\t * @param Id\n\t * @private\n\t */\n\t_retrieveSchedule(Id) {\n\t\tif (!Id) {\n\t\t\treturn;\n\t\t}\n\t\tthis.showSpinner = true;\n\t\tthis.context = {\n\t\t\tcurrencyCode: this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,\n\t\t\tfieldSetName : 'DiscountScheduleModal'\n\t\t};\n\t\tthis.$.loadDiscountScheduleService.uid = undefined;\n\t\tthis.$.loadDiscountScheduleService.context = this.context;\n\t\tthis.$.loadDiscountScheduleService.uid = Id;\n\t\t// Deactivate service spinner because modal has its own spinner\n\t\tthis.$.loadDiscountScheduleService.spinner = false;\n\t}\n\n\t/**\n\t * Instantiates discountTiers and kicks off building all of the data required to render the discountTiers\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tif (!this.schedule) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setConstants(this.constants);\n\t\tthis.discountTiers = undefined;\n\t\tthis.currencyCode = this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\tthis.editable = !this.schedule[this.overrideBehaviorField] ? false : true;\n\t\tthis.savedTiers = [];\n\t\tthis.discountSchedule = JSON.parse(JSON.stringify(this.schedule));\n\t\tthis.data = this.discountSchedule;\n\t\tthis.discountSchedule[this.discountUnitField] = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis._setDSFields();\n\t\tthis.showRevertBtn = this.discountSchedule[this.originalScheduleField] ? true : false;\n\t\tthis.discountUnit = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis.buildRowData();\n\t\tlet tierModels = this.buildTiers();\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis.buildFieldData();\n\t\tthis.discountTiers = tierModels;\n\t\tthis._createActions();\n\t\tthis._toggleEditableClasses();\n\t\tif (this.isMobile) {\n\t\t\tthis._buildTabData();\n\t\t}\n\t\tthis.showSpinner = false;\n\t}\n\n\t/**\n\t * The response of cloning or updating a discount schedule goes here\n\t * Updates the lineModel's discount schedule Id\n\t * Runs a calculate to update formula field values if the user happens to add a formula field to the discount tier fieldset\n\t * @private\n\t */\n\t_discountScheduleResponseChanged() {\n\t\tlet newScheduleId = this.discountScheduleResponse.Id;\n\t\tthis.lineModel.lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\tif (this.lineModel.lineVO.record[this.segmentKeyField]) {\n\t\t\tlet segments = this.lineModel.segments;\n\t\t\tfor (let i = 0, l = segments.length; i < l; i++) {\n\t\t\t\tsegments[i].lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\t\t}\n\t\t}\n\t\tif (this.action === 'save') {\n\t\t\tthis.onCancel();\n\t\t} else {\n\t\t\t// Rebuild rows to update with formula field values and remove dirty\n\t\t\tthis.schedule = this.discountScheduleResponse;\n\t\t\tthis.showRevertBtn = this.discountScheduleResponse[this.originalScheduleField];\n\t\t}\n\t\tthis.domHost.onFlagCalculate();\n\t}\n\n\t/**\n\t * If discount unit field has changed, it will recreate row data and display the correct discount column\n\t * @param changedRecord\n\t * @private\n\t */\n\t_discountScheduleChanged(changedRecord) {\n\t\tif (changedRecord.path == `discountSchedule.${this.discountUnitField}`) {\n\t\t\tthis.discountUnit = changedRecord.value;\n\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\tthis.buildRowData();\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves visible discount tier records, then turns them into DiscountTierModels\n\t * @returns {Array}\n\t */\n\tbuildTiers() {\n\t\tlet tiers = [];\n\t\tlet discountTierRecords = this._retrieveRecords();\n\t\tthis.previousLowerBound = undefined;\n\t\tdiscountTierRecords.forEach(function(tier) {\n\t\t\t// Tier lowerbound will be undefined if there are no tiers defined in the database\n\t\t\t// Creates a row so the user never sees a blank discount tier section\n\t\t\tif (tier[this.lowerBoundField] == null) {\n\t\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.discountUnit == \"Percent\" && this.previousLowerBound != tier[this.lowerBoundField]) {\n\t\t\t\tthis.previousLowerBound = tier[this.lowerBoundField];\n\t\t\t} else if (this.discountUnit == \"Percent\" || tier.CurrencyIsoCode != this.currencyCode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t}.bind(this));\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Creates field data for discount schedule name input and discount unit picklist\n\t */\n\tbuildFieldData() {\n\t\tif (this.fieldNames) {\n\t\t\treturn;\n\t\t}\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.discountScheduleField];\n\t\tfieldsMD[this.discountUnitField].required = true;\n\t\tthis.fieldTableData = fieldsMD;\n\t\tthis.fieldNames = ['Name', this.discountUnitField];\n\t}\n\n\t/**\n\t * Creates maps that populate and style table rows\n\t */\n\tbuildRowData() {\n\t\tif (this.fieldsArray) {\n\t\t\tfireEvent(Events.DELETE_GROUPS);\n\t\t}\n\t\tlet fields = this.editorModel.data.discountScheduleModalFieldNames;\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.tierField];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet priceLabel = this.editorModel.data.customLabels.lbl_price;\n\t\tlet prefixedFieldsByFields = {};\n\t\tfields.forEach(function(field) {\n\t\t\tprefixedFieldsByFields[field] = 'template.' + field;\n\t\t}.bind(this));\n\t\tif (this.discountUnit === 'Price') {\n\t\t\tprefixedFieldsByFields[priceLabel] = 'template.' + priceLabel;\n\t\t\tfieldsMD[priceLabel] = JSON.parse(JSON.stringify(fieldsMD[this.discountAmountField]));\n\t\t\tfieldsMD[priceLabel].label =  priceLabel + '(' + (this.currencyCode || this.editorModel.data.currencySymbol) + ')';\n\t\t\tfieldsMD[priceLabel].name = priceLabel;\n\t\t}\n\t\tthis.fieldsArray = Object.keys(prefixedFieldsByFields);\n\t\tlet prefixedFieldsArray = [];\n\t\tthis.fieldsArray.forEach(function(field) {\n\t\t\tif (!this._isFieldShown(field)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fieldMD = fieldsMD[field];\n\t\t\tvar key = fieldMD.name;\n\t\t\tvar label;\n\t\t\tif (fieldMD.type === 'currency')\n\t\t\t\tfieldMD.scale = this._getPriceScale();\n\t\t\tif (field === this.numberField) {\n\t\t\t\tlabel = '#';\n\t\t\t} else if (field === this.discountAmountField) {\n\t\t\t\tlabel = fieldMD.label.replace('{0}', (this.currencyCode || this.editorModel.data.currencySymbol));\n\t\t\t\tfieldMD.label = label;\n\t\t\t} else {\n\t\t\t\tlabel = fieldMD.label;\n\t\t\t}\n\t\t\tprefixedFieldsArray.push(prefixedFieldsByFields[field]);\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[prefixedFieldsByFields[field]] = fieldMD.type;\n\t\t}.bind(this));\n\t\tthis.set('model.fieldsMD', fieldsMD);\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.selected', false);\n\t\t\tthis.set('model.headerClassMap', new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap, null, true).build());\n\t\t\tthis.set('model.fieldLabels', fieldLabels);\n\t\t}\n\t\tthis.set('model.rowClassMap', new TableClassBuilder(prefixedFieldsArray, 'Td', itemTypeMap).build());\n\t\tthis.set('model.fieldLabelMap', fieldLabelMap);\n\t\tthis.set('model.recordKeys', prefixedFieldsArray);\n\t}\n\n\t// Discount Schedule Modal Actions\n\n\t/**\n\t * Retrieves the original discount schedule\n\t */\n\tonRevert() {\n\t\tthis._retrieveSchedule(this.discountSchedule[this.originalScheduleField]);\n\t}\n\n\t/**\n\t * Called by clicking row level add action or by clicking add\n\t * Add will always push a new tier to the very end\n\t * @param e\n\t */\n\tonAddLine(e) {\n\t\tlet record = this._createBlankTierRecord();\n\t\tlet tierModel = new DiscountTierModel(record, this.discountSchedule);\n\t\ttierModel.rowActions = this._createRowActions();\n\t\tif (e.detail && e.detail.index !== undefined) {\n\t\t\tthis.splice('discountTiers', e.detail.index + 1, 0, tierModel);\n\t\t} else {\n\t\t\tthis.push('discountTiers', tierModel);\n\t\t}\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Called by clicking row level delete action or by selecting tiers and clicking Delete\n\t * @param e\n\t */\n\tonDeleteLines(e) {\n\t\tif (e.detail && e.detail.index) {\n\t\t\tthis.splice('discountTiers', e.detail.index, 1);\n\t\t} else {\n\t\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\t\tif (!this.discountTiers[i]) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this.discountTiers[i].selected) {\n\t\t\t\t\tthis.splice('discountTiers', i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.set('model.selected', false);\n\t\t}\n\t\tthis._selectCheckboxes(false);\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Assigns important values on discount schedule and saves to the server\n\t * @param e\n\t */\n\tonSave(e) {\n\t\tthis.errors = undefined;\n\t\tthis.tiers = this._processForSaving();\n\t\tif (!this.tiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis.errors = undefined;\n\t\tthis.action = e.currentTarget.attributes.id.value;\n\t\tlet model;\n\n\t\tif (this.discountSchedule[this.userDefinedField] && this.lineModel.lineVO.record.Id === this.discountSchedule[this.quoteLineField]) {\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleUpdaterService.uid = this.discountSchedule.Id;\n\t\t\tthis.$.discountScheduleUpdaterService.model = model;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.quoteLineField] = this.lineModel.lineVO.record.Id;\n\t\t\tthis.discountSchedule[this.userDefinedField] = true;\n\t\t\tthis.discountSchedule[this.originalScheduleField] = this.discountSchedule.Id;\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleClonerService.model = model;\n\t\t}\n\t}\n\n\t/**\n\t * Called on mouse-out or when dialog is closed\n\t * Attempts to clean out dialog so transition is clean between viewing other discount schedules\n\t */\n\tonCancel() {\n\t\tfireEvent(Events.DELETE_GROUPS);\n\t\tthis.dialogTapped = false;\n\t\tthis.dialogOverlapping = false;\n\t\tthis.set('model.fieldsEditable', false);\n\t\tthis.errors = undefined;\n\t\tthis.schedule = undefined;\n\t\tthis.discountSchedule = undefined;\n\t\tthis.discountTiers = undefined;\n\t\tthis.discountScheduleId = undefined;\n\t\tthis.$.dialog.close();\n\t}\n\n\t// Helper Functions\n\n\t/**\n\t * Combines all tiers that are visible or saved from current tier only behavior\n\t * Then renumbers, sorts, calculates discounts, creates multi-currency records,\n\t * runs front end validation, and then sets discount unit field\n\t * @returns {*}\n\t * @private\n\t */\n\t_processForSaving() {\n\t\t// Combine saved tiers from 'current tier only' behavior and tiers shown in the modal\n\t\tlet hiddenTiers = this._sortTiers(this.savedTiers);\n\t\tlet visibleTiers = this._sortTiers(this.discountTiers);\n\t\tif (!hiddenTiers || !visibleTiers) {\n\t\t\treturn null;\n\t\t}\n\t\tlet tierModels = hiddenTiers.concat(visibleTiers);\n\t\tthis._renumberLines(tierModels, false);\n\t\tthis.set('discountTiers', visibleTiers);\n\t\tthis._updateActions();\n\t\t// Calculate discount amounts and sort before validating\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis._createTiers(tierModels);\n\t\tlet validator = new DiscountTiersValidator(this.discountSchedule, this.editorModel);\n\t\tlet errors = validator.validate(tierModels);\n\t\tif (errors.size > 0) {\n\t\t\tthis._createError(errors);\n\t\t\treturn null;\n\t\t}\n\t\tlet tiers = [];\n\t\ttierModels.forEach(function(tierModel) {\n\t\t\ttierModel.tiers.forEach(function(tier) {\n\t\t\t\ttiers.push(tier);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t\tthis.discountSchedule[this.tiersField].records = tiers;\n\t\tthis.discountSchedule[this.tiersField].totalSize = tiers.length;\n\t\tif (this.discountUnit === \"Price\") {\n\t\t\tthis.discountSchedule[this.discountUnitField] = \"amount\";\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = true;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = false;\n\t\t}\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Renames all of the constants used because it is cleaner without caps\n\t * @param constants\n\t * @private\n\t */\n\t_setConstants(constants) {\n\t\tthis.discountAmountField = constants.DISCOUNT_AMOUNT_FIELD;\n\t\tthis.discountScheduleField = constants.DISCOUNT_SCHEDULE_FIELD;\n\t\tthis.discountRateField = constants.ADDITIONAL_DISCOUNT_RATE_FIELD;\n\t\tthis.discountUnitField = constants.DISCOUNT_UNIT_FIELD;\n\t\tthis.lowerBoundField = constants.LOWER_BOUND_FIELD;\n\t\tthis.numberField = constants.NUMBER_FIELD;\n\t\tthis.originalScheduleField = constants.ORIGINAL_SCHEDULE_FIELD;\n\t\tthis.overrideBehaviorField = constants.OVERRIDE_BEHAVIOR_FIELD;\n\t\tthis.quantityField = constants.QUANTITY_FIELD;\n\t\tthis.quoteLineField = constants.QUOTE_LINE;\n\t\tthis.segmentKeyField = constants.SEGMENT_KEY_FIELD;\n\t\tthis.specialPriceField = constants.SPECIAL_PRICE_FIELD;\n\t\tthis.tierField = constants.DISCOUNT_TIER_FIELD;\n\t\tthis.tiersField = constants.DISCOUNT_TIERS_FIELD;\n\t\tthis.upperBoundField = constants.UPPER_BOUND_FIELD;\n\t\tthis.usePriceForAmountField = constants.USE_PRICE_FOR_AMOUNT_FIELD;\n\t\tthis.userDefinedField = constants.USER_DEFINED_FIELD;\n\t}\n\n\t_createError(errors) {\n\t\tlet errorsArray = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowNumber = this.discountTiers[i].template[this.numberField];\n\n\t\t\t// Create error message Array\n\t\t\tif (errors && errors.get(rowNumber)) {\n\t\t\t\terrorsArray.push(errors.get(rowNumber))\n\t\t\t};\n\t\t}\n\n\t\tif (errorsArray.length > 0) {\n\t\t\tthis.errors = errorsArray;\n\t\t}\n\n\t}\n\n\t/**\n\t * Creates error icons on the left\n\t * Creates Add (plus icon) and Delete (trash can) on the right\n\t * @param errors\n\t * @private\n\t */\n\t_createActions() {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet headerActions = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowActions = this._createRowActions(i);\n\n\t\t\t// Update the UI with new rowActions\n\t\t\tthis.set(`discountTiers.${i}.rowActions`, rowActions);\n\t\t}\n\t\t// Add to filler icons to the right side of header so actions are aligned correctly\n\t\theaderActions.push({icon : 'sb-icon-plus', position: 'right', hidden: true, invisible: true});\n\t\theaderActions.push({icon : 'sf-icon-delete', position: 'right', hidden: true, invisible: true});\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.headerActions', headerActions);\n\t\t}\n\t}\n\n\t/**\n\t * Set default index to 1.  This is used for adding a new row, the index is irrelevant in this case\n\t * @param index\n\t * @returns {*[]}\n\t * @private\n\t */\n\t_createRowActions(index = 1) {\n\t\treturn [{icon : 'sb-icon-plus',\n\t\t\ttitle: 'Add',\n\t\t\tposition: 'right',\n\t\t\tinvisible: false,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t}, {icon : 'sf-icon-delete',\n\t\t\ttitle: 'Delete',\n\t\t\tposition: 'right',\n\t\t\tinvisible: index == 0,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t}];\n\t}\n\n\t/**\n\t * Only runs if override behavior is 'current tier only'\n\t * Finds the matching tier for the line's current quantity and will save tiers that come prior\n\t * to matching tier which will be added back before saving to server\n\t * If DS is user defined, it will show all tiers after the current matching tier as well\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveVisibleRecords(tiers) {\n\t\tlet visibleTiers = [];\n\t\tlet currentQuantity = this.lineModel.lineVO.record[this.quantityField];\n\t\ttiers.forEach( function(tier) {\n\t\t\tlet lowerBound = tier[this.lowerBoundField];\n\t\t\tlet upperBound = tier[this.upperBoundField];\n\t\t\tlet userDefined = this.discountSchedule[this.userDefinedField];\n\t\t\t// User defined discount schedules will show tiers above currently matching tier\n\t\t\tif (!upperBound) {\n\t\t\t\treturn (currentQuantity >= lowerBound || userDefined) ? visibleTiers.push(tier) : visibleTiers;\n\t\t\t}\n\t\t\t// Saves tiers where current quantity is greater than lower and upper bound\n\t\t\tif (currentQuantity >= lowerBound && currentQuantity >= upperBound) {\n\t\t\t\tthis.savedTiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\t// Finds the tier where the current quantity is between the lower and upper bound\n\t\t\t} else if (lowerBound <= currentQuantity && currentQuantity < upperBound) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t\t// Display all tiers following the matching tier if discount schedule is user defined\n\t\t\t} else if (userDefined && lowerBound > currentQuantity) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t}\n\t\t}.bind(this));\n\t\t// Special Corner Case for when there is no matching tier\n\t\t// Ex: There exists only Discount Tier which is 1-11\n\t\t// Quantities below 1 will create a blank discount tier and not save the 1-11 tier\n\t\t// Quantities above 11 will create a tier where the lower bound is locked to 11 and tier 1-11 will be saved\n\t\tif (visibleTiers.length == 0 && tiers.length > 0) {\n\t\t\tlet lastPositionIndex = tiers.length - 1;\n\t\t\tlet lowestBound = tiers[0][this.lowerBoundField];\n\t\t\tlet highestBound = tiers[lastPositionIndex][this.upperBoundField];\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\tif (currentQuantity < lowestBound) {\n\t\t\t\trecord[this.numberField] = 1;\n\t\t\t} else if (currentQuantity >= highestBound) {\n\t\t\t\trecord[this.numberField] = tiers[lastPositionIndex][this.numberField] + 1;\n\t\t\t\trecord[this.lowerBoundField] = highestBound;\n\t\t\t}\n\t\t\tvisibleTiers.push(record);\n\t\t}\n\t\treturn visibleTiers;\n\t}\n\n\t/**\n\t * Creates a blank record if the discount doesn't have any\n\t * Otherwise, it will return the records that are used for displaying and editing purposes\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveRecords() {\n\t\tlet records = [];\n\t\tif (!this.discountSchedule[this.tiersField]) {\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\trecord[this.numberField] = 1;\n\t\t\trecords.push(record);\n\t\t} else {\n\t\t\trecords = this.discountSchedule[this.tiersField].records;\n\t\t\tif (this.discountSchedule[this.overrideBehaviorField] === 'Current Tier Only') {\n\t\t\t\t// current tier only setting will save all tiers before the tier that matches the line item quantity\n\t\t\t\t// and append them back right before the record is saved\n\t\t\t\trecords = this._retrieveVisibleRecords(records);\n\t\t\t\t// used in DSTableCell to disable first lower bound so it can't be edited\n\t\t\t\t// Only disable the field if there are tiers that are hidden because of current tier only functionality\n\t\t\t\tif (this.savedTiers.length > 0) {\n\t\t\t\t\tthis.editorModel.disabledDiscountTier = records[0][this.numberField];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.editorModel.disabledDiscountTier = undefined;\n\t\t\t}\n\t\t}\n\t\treturn records;\n\t}\n\n\t/**\n\t * Calculates and sets price, discount and discount amount fields\n\t * Will set them to zero if the value is undefined\n\t * Also sets the upperbound to null if undefined so it will display as an editble field\n\t * @param tiers\n\t * @private\n\t */\n\t_calculateDiscountAmounts(tiers) {\n\t\tif (!tiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet specialPrice = this.lineModel.lineVO.record[this.specialPriceField];\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet row = tier.template;\n\t\t\tif (this.discountUnit === 'Price') {\n\t\t\t\t// discount amount is equal to special price minus the price entered by the user\n\t\t\t\trow.Price = !row.Price && row.Price !== 0 ? (specialPrice - row[this.discountAmountField]) : row.Price;\n\t\t\t\trow[this.discountAmountField] = (specialPrice - row.Price);\n\t\t\t} else {\n\t\t\t\trow[this.discountRateField] = row[this.discountRateField] || 0;\n\t\t\t\trow[this.discountAmountField] = row[this.discountAmountField] || 0;\n\t\t\t}\n\t\t\t// Upper Bound may not always be defined so set it to null so field is editable\n\t\t\tif (!row[this.constants.UPPER_BOUND_FIELD] && row[this.constants.UPPER_BOUND_FIELD] != 0) {\n\t\t\t\trow[this.constants.UPPER_BOUND_FIELD] = null;\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Renumbers line starting from 1 if override behavior is not 'current tier only'\n\t * otherwise start from the first tier that is visible\n\t * Do a notifyPath so UI is updated for all cases except for when we sort all tiers\n\t * in the 'current tier only' scenario where there might be tiers not in the UI\n\t * @param tiers\n\t * @param notify\n\t * @private\n\t */\n\t_renumberLines(tiers, notify) {\n\t\tlet behavior = this.discountSchedule[this.overrideBehaviorField];\n\t\t// current tier only could have a visible tier that should start at a number that isn't 1\n\t\tlet number = behavior === 'Current Tier Only' && this.savedTiers.length > 0 ? tiers[0].template[this.numberField] : 1;\n\t\tfor (let i = 0, l = tiers.length; i < l; i ++) {\n\t\t\tif (tiers[i].template[this.numberField] != number) {\n\t\t\t\tif (notify) {\n\t\t\t\t\tthis.set(`discountTiers.${i}.template.${this.numberField}`, number);\n\t\t\t\t} else {\n\t\t\t\t\ttiers[i].template[this.numberField] = number;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnumber++;\n\t\t}\n\t}\n\n\t/**\n\t * Sorts tiers based on lowerbound value\n\t * Creates an error if there are matching lowerbounds\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_sortTiers(tiers) {\n\t\tlet lowerBoundList = [];\n\t\tlet tiersByLowerBound = {};\n\t\tlet sortedTiers = [];\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet lowerBound = tier.template[this.lowerBoundField];\n\t\t\tif (tiersByLowerBound[lowerBound]) {\n\t\t\t\tthis.errors = [this.editorModel.data.customLabels.msg_identical_lower_bounds];\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tlowerBoundList.push(lowerBound);\n\t\t\ttiersByLowerBound[lowerBound] = tier;\n\t\t}.bind(this));\n\t\tlowerBoundList.sort(function (a, b) {\n\t\t\treturn a - b\n\t\t});\n\t\tlowerBoundList.forEach(function(lowerBound) {\n\t\t\tlet tier = tiersByLowerBound[lowerBound];\n\t\t\tsortedTiers.push(tier);\n\t\t}.bind(this));\n\t\treturn sortedTiers;\n\t}\n\n\t/**\n\t * Loops through all the displayed discount tiers to populate tiers array and clones displayed tiers if multi-currency is enabled\n\t * @param tiers\n\t * @private\n\t */\n\t_createTiers(tiers) {\n\t\tlet isoCodes = this.editorModel.data.settings.currencyIsoCodes;\n\t\t// discount tiers for all currencies, including the quote's currency\n\t\ttiers.forEach(function(row) {\n\t\t\trow.tiers = [];\n\t\t\tif (!isoCodes) {\n\t\t\t\trow.tiers.push(row.template);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisoCodes.forEach(function(isoCode) {\n\t\t\t\tif (isoCode == this.currencyCode) {\n\t\t\t\t\trow.template.CurrencyIsoCode = isoCode;\n\t\t\t\t\trow.tiers.push(row.template);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (this.discountUnit === 'Percent') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trow.tiers.push(this._createMultiCurrencyRecord(row.template, isoCode));\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Loops through all of the tiers and sets the selected property\n\t * @param selected\n\t * @private\n\t */\n\t_selectCheckboxes(selected) {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 1, l = this.discountTiers.length; i < l; i++) {\n\t\t\tif (this.discountTiers[i]) {\n\t\t\t\tthis.set(`discountTiers.${i}.selected`, selected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Copies Discount Tier record to create more tiers but with different currency codes\n\t * @param tier\n\t * @param isoCode\n\t * @private\n\t */\n\t_createMultiCurrencyRecord(tier, isoCode) {\n\t\tlet record = JSON.parse(JSON.stringify(tier));\n\t\trecord['CurrencyIsoCode'] = isoCode;\n\t\trecord[this.discountAmountField] = 0;\n\t\trecord[this.discountRateField] = record[this.discountRateField] || 0;\n\t\t// Price needs to be removed before sending data to the server\n\t\tdelete record.Price;\n\t\treturn record;\n\t}\n\n\t/**\n\t * Creates a blank record for when a new line is added\n\t * @returns {{}}\n\t * @private\n\t */\n\t_createBlankTierRecord() {\n\t\tlet record = {};\n\t\tthis.fieldsArray.forEach(function(fieldName) {\n\t\t\trecord[fieldName] = null;\n\t\t\trecord['CurrencyIsoCode'] = this.currencyCode;\n\t\t\trecord[this.discountAmountField] = 0;\n\t\t\trecord[this.discountRateField] = 0;\n\t\t}.bind(this));\n\t\treturn record;\n\t}\n\n\t/**\n\t * Called each time mouse-over, mouse-out, on-tap is called on the discount schedule icon\n\t * Initiates the query for discount schedule and toggles dialog boxShadow\n\t * Assigns dialogTapped which determines if full modal view is shown and toggles field editability if valid\n\t * @param e\n\t * @private\n\t */\n\t_handleIconAction(e) {\n\t\tlet event = e.detail.event;\n\t\tlet type = event.type;\n\t\tlet model = e.detail.model;\n\t\tthis.lineModel = this.editorModel.quoteModel.lineModelsByKey[model.serviceModel.keys[0]];\n\t\tthis.discountScheduleId = model.serviceModel.scheduleId;\n\t\tswitch(type) {\n\t\t\tcase 'mouseenter':\n\t\t\t\tif (!this.isMobile && !this.dialogTapped) {\n\t\t\t\t\tthis._toggleDialogClasses(true);\n\t\t\t\t\tthis.$.dialog.open();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'mouseleave':\n\t\t\t\t// Adding to the debounce gives the event listener attached to the dialog's mouseenter a chance to determine dialog is overlapping\n\t\t\t\tthis.debounce('closeDialog',function() {\n\t\t\t\t\tif (!this.isMobile && !this.dialogTapped && !this.dialogOverlapping) {\n\t\t\t\t\t\tthis.onCancel();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), 1);\n\t\t\t\tbreak;\n\t\t\tcase 'tap':\n\t\t\t\tthis._openDialog();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_openDialog() {\n\t\tif (this.dialogTapped) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dialogTapped = true;\n\t\tthis.$.dialog.open();\n\t\tthis._toggleDialogClasses(false);\n\t}\n\n\t_toggleDialogClasses(applyClasses) {\n\t\tlet dialog = Polymer.dom(this.$.dialog.root);\n\t\tlet sbDialog = dialog.querySelector('.sbDialog');\n\t\tthis.toggleClass('boxShadow', applyClasses, sbDialog);\n\t\tthis.toggleClass('noMarginBottom', applyClasses, dialog.querySelector('#content'));\n\t}\n\n\t_handleDialogTap() {\n\t\tthis.addEventListener('sb-tap-ds', function() {\n\t\t\tif (this.isMobile || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._openDialog();\n\t\t}.bind(this));\n\t}\n\n\t_handleDialogMouseEvents() {\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tlet dialog = Polymer.dom(this.$.dialog.root).querySelector('.sbDialog');\n\t\tdialog.addEventListener('mouseenter', function() {\n\t\t\tif (this.dialogTapped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.dialogOverlapping = true;\n\t\t}.bind(this));\n\n\t\tdialog.addEventListener('mouseleave', function() {\n\t\t\tif (this.dialogTapped || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onCancel();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Called each time dialogTapped is triggered (when icon is clicked)\n\t * @private\n\t */\n\t_toggleEditableClasses() {\n\t\tthis.set('model.fieldsEditable', this.editable && this.dialogTapped);\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setDisabled();\n\t\tthis._updateActions();\n\t}\n\n\t_updateActions() {\n\t\tfor ( let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tlet rowActions = this.discountTiers[i].rowActions;\n\t\t\tif (!rowActions) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let j = 0, k = rowActions.length; j < k; j++) {\n\t\t\t\tlet invisible = i == 0 && rowActions[j].icon == 'sf-icon-delete';\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.hidden`, !this.model.fieldsEditable);\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.invisible`, invisible);\n\t\t\t}\n\t\t}\n\t\tif (!this.isMobile && this.model.headerActions) {\n\t\t\tfor ( let m = 0, n = this.model.headerActions.length; m < n; m ++) {\n\t\t\t\tthis.set(`model.headerActions.${m}.hidden`, !this.model.fieldsEditable);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Toggles field edibility\n\t * @private\n\t */\n\t_setDisabled() {\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tthis.set(`discountTiers.${i}.disabled`, !this.model.fieldsEditable);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the Quote and Account fields for the discount schedule with the correct value\n\t * @private\n\t */\n\t_setDSFields() {\n\t\tlet quote = this.editorModel.quoteModel.quoteVO;\n\t\tthis.discountSchedule[this.constants.QUOTE] = quote.record.Id;\n\t\tlet accountId;\n\t\tif (quote.record[this.constants.ACCOUNT_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.ACCOUNT_FIELD].Id;\n\t\t} else if (quote.record[this.constants.OPPORTUNITY_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.OPPORTUNITY_FIELD].AccountId;\n\t\t}\n\t\tthis.discountSchedule[this.constants.ACCOUNT_ID_FIELD] = accountId;\n\t}\n\n\t/**\n\t * Used as a filter when looping over the discount tier field set so the correct discount unit field is shown\n\t * @param field\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_isFieldShown(field) {\n\t\tif (this.discountUnit === 'Percent' && field === this.discountAmountField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Amount' && field === this.discountRateField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Price' && (field === this.discountRateField || field === this.discountAmountField)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Builds the tab data used for mobile user defined discount schedule\n\t * @private\n\t */\n\t_buildTabData() {\n\t\tlet tabs = [],\n\t\t\tlabels = ['Details', 'Tiers'];\n\n\t\tif (this.tabs === tabs) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0, len = labels.length; i < len; i++) {\n\t\t\tlet label = labels[i];\n\t\t\tlet tId = \"t\" + i;\n\t\t\tlet bind;\n\t\t\tlet pageComponent;\n\t\t\tif (label === 'Details') {\n\t\t\t\tbind = ['data', 'fieldNames', 'md', 'numColumns', 'disabled'];\n\t\t\t\tpageComponent = 'sb-field-table';\n\t\t\t} else if (label === 'Tiers') {\n\t\t\t\tbind = ['discountTiers', 'model', 'editorModel'];\n\t\t\t\tpageComponent = 'sb-ds-tiers';\n\t\t\t}\n\t\t\ttabs.push({name: tId, label: label, bind: bind, pageComponent: pageComponent});\n\t\t}\n\t\tthis.tabs = tabs;\n\t}\n\n\t/**\n\t * Gets the price scale to be used for rounding in the QLE for discount tiers\n\t * Uses the price scale on discount schedule and if that is null falls back to the org level price scale setting\n\t * @private\n\t */\n\t_getPriceScale() {\n\t\tconst dsPriceScaleField = this.discountSchedule[this.constants.PRICE_SCALE_FIELD];\n\t\treturn dsPriceScaleField != null ? dsPriceScaleField : this.editorModel.data.settings.priceScale;\n\t}\n\n\t/**\n\t * Sets the isMobile variable as the viewport changes\n\t */\n\tviewportChanged() {\n\t\tthis.isMobile = (this.viewport && this.viewport.isMobile()) ? true : false;\n\t}\n}\n\nPolymer( DiscountScheduleDialog );","export class FavoriteDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-dialog';\n\t\tthis.properties = {\n\t\t\tfavName: String\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-fav', this.onCancel);\n\t}\n\n\tonSave() {\n\t\tif (this.favName == \"\" || this.favName === undefined) {\n\t\t\tthis.errors = ['Favorite name cannot be left blank.'];\n\t\t\treturn;\n\t\t}\n\t\tlet favoriteKeys = [];\n\t\tif (this.favoritedGroup) {\n\t\t\t// saves each line within the group to send up\n\t\t\tlet numGroupLines = this.groupLines.length;\n\t\t\tfor (let i=0; i<numGroupLines; i++) {\n\t\t\t\tif (!this.groupLines[i].component) {\n\t\t\t\t\tfavoriteKeys.push(this.groupLines[i].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfavoriteKeys.push(this.favoritedLine[0]);\n\t\t}\n\n\t\tthis.fire('sb-favorite-saved', {keys: favoriteKeys, name: this.favName, groupKey: this.favoritedGroup} );\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n}\n\nPolymer( FavoriteDialog );","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {Events, fireEvent} from 'common/core/Events.js';\n\nexport class PricebookDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pricebook-dialog';\n\t\tthis.properties = {\n\t\t\tpricebooks: Array,\n\t\t\tselectedPricebook: String,\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_onError'\n\t\t\t},\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.select.addEventListener('change', function(e) {\n\t\t\tif(e.detail) {\n\t\t\t\tthis.selectedPricebook = e.detail.value; // Change in pricebook picklist selection\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this.onCancel.bind(this));\n\t}\n\n\t// notify parent component about error\n\t_onError() {\n\t\tif (this.error) {\n\t\t\tfireEvent(Events.GENERIC_ERROR, {errorMessage: this.error.message || this.error});\n\t\t}\n\t}\n\n\topen() {\n\t\tthis.$.pricebookLoaderService.addEventListener('response-changed', function(e) {\n\t\t\tlet pricebooks = [],\n\t\t\t\tresults = e.detail.value,\n\t\t\t\tnumResults = results.length;\n\n\t\t\tif (results.success === false) {\n\t\t\t\tthis.error = results.error;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (let i =0; i < numResults; i++) {\n\t\t\t\tpricebooks.push({ value: results[i].Id, label: results[i].Name, selected: false});\n\t\t\t}\n\n\t\t\tpricebooks[0].selected = true; // Auto-select the first pricebook\n\t\t\tthis.selectedPricebook = pricebooks[0].value;\n\n\t\t\t// Sets up the user's pricebook list in a select\n\t\t\tthis.$.select.value = this.selectedPricebook;\n\t\t\tthis.$.select.isRequired = true;\n\t\t\tthis.pricebooks = pricebooks;\n\n\t\t\tthis.$.dialog.toggle();\n\t\t}.bind(this));\n\n\t\t// ServiceLoader requires uid and context, but no values are needed\n\t\tthis.$.pricebookLoaderService.uid = '';\n\t\tthis.$.pricebookLoaderService.context = '';\n\t}\n\n\tonSave() {\n\t\tthis.$.pricebookSaverService.addEventListener('response-changed', function(e) {\n\t\t\tthis.fire('pricebook-saved', e.detail.value); // Response is the quoteVOResponse\n\t\t}.bind(this));\n\n\t\tthis.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD] = this.selectedPricebook;\n\t\tthis.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_LOOKUP_ID_FIELD] = this.selectedPricebook;\n\t\tthis.$.pricebookSaverService.model = new DataBuilder()\n\t\t\t.add('pricebookId', this.selectedPricebook)\n\t\t\t.add('quoteId', this.editorModel.quoteModel.quoteVO.record.Id)\n\t\t\t.add('oppId', this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.OPPORTUNITY_ID_FIELD])\n\t\t\t.build();\n\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: 'onCancel'}\n\t\t});\n\t}\n}\n\nPolymer( PricebookDialog );","export class PricingGuidanceDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pricing-guidance-dialog';\n\t\tthis.properties = {\n\t\t\tlineVO: Object,\n\t\t\tisPricingRecommendationAvailable: Boolean,\n\t\t\tpricingGuidanceArray: Array,\n\t\t\tisPricingGuidanceAvailable: Boolean,\n\t\t\tisMobileDevice: Boolean,\n\t\t\tquoteLineObjectArray: Array\n\t\t}\n\t};\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-fav', this.onCancel);\n\t}\n\n\tonAcceptPricingGuidance() {\n\t\tthis.fire('sb-accept-pricing-guidance', {\n\t\t\tlineVO: this.lineVO,\n\t\t\theaderValues: this.headerValues,\n\t\t\tlineItemValues: this.lineItemValues\n\t\t});\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t\tthis.properties.lineVO = {};\n\t\tthis.properties.isPricingRecommendationAvailable=false;\n\t\tthis.properties.pricingGuidanceArray = [];\n\t\tthis.properties.isPricingGuidanceAvailable = false;\n\t\tthis.properties.isMobileDevice = false;\n\t\tthis.properties.quoteLineObjectArray = [];\n\t}\n\n\tgetPricingGuidanceValue(obj, propertyName) {\n\t\treturn obj[propertyName];\n\t}\n}\n\nPolymer(PricingGuidanceDialog);","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class CSETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-cse-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trender: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildCellObserver(item, value, model, data)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.groupModel.editorModel.constants;\n\t}\n\n\t_buildCellObserver (item, value, model, data) {\n\t\tif (item === undefined ||\tvalue === undefined || model === undefined || data === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildCell(item, value, model, data);\n\t}\n\t\n\tbuildCell() {\n\t\tlet tableCols = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet quoteLineFieldsMD = this.model.groupModel.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t\tlet fieldsMD = [];\n\n\t\tfor (let i = 0; i < tableCols.length; i++) {\n\t\t\tlet fieldMD = quoteLineFieldsMD[tableCols[i]];\n\t\t\tfieldsMD[tableCols[i]] = fieldMD;\n\t\t}\n\n\t\t//if (fieldsMD && fieldsMD[this.item] && fieldsMD[this.item].type) {\n\t\tthis.editing = true;\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.viewport && this.viewport.isMobile() ) {\n\t\t\tthis.render = true;\n\t\t\tif (this.index === 0) {\n\t\t\t\tthis.editing = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.disabled = false;\n\t\tthis.md = fieldsMD[this.item];\n\t}\n}\n\nPolymer(CSETableCell);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\n/**\n *  <sb-custom-action>\n *\n *  Features:\n *\n **/\nexport class CustomAction {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-action';\n\t\tthis.properties = {\n\t\t\tcustomAction: Object,\n\t\t\tmodel: Object,\n\t\t\tactionHidden: Boolean,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbutton: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tspan: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tgroupAction: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tallOptional: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\te[Events.TOGGLE_QUICKSAVE] = this.toggleQuickSaveButton;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn ['_toggleQuoteButton(model.allOptional)', '_toggleLineButton(model.favorite)'];\n\t}\n\n\tready() {\n\t\tif (this.customAction && this.customAction.isSeparator) {\n\t\t\tthis.button = false;\n\t\t\tthis.span = true;\n\t\t}\n\t\t\n\t\t// for the case of closing a menu inside a menu\n\t\tthis.addEventListener('paper-dropdown-close', function(e) {\n\t\t\tif (this.$$('#menuButton'))\n\t\t\t\tthis.$$('#menuButton').close();\n\t\t});\n\n\t\tif (!this.horizontalAlign) {\n\t\t\tthis.horizontalAlign = this.span ? \"left\" : \"right\";\n\t\t}\n\t\tthis.horizontalOffset = this.span ? 18 : 0;\n\t\tthis.verticalOffset = this.span ? -30 : 0;\n\t}\n\n\ttriggerCustomAction(e) {\n\t\t// If event is showDSModal, fire event for mouseover, mouseout and tap; otherwise, the event\n\t\t// must be type == 'tap' and will fire normal tap event\n\t\tif (this.customAction.eventHandlerName === \"showDSModal\") {\n\n\t\t\t// If mobile and not a tap gesture, we want to return early\n\t\t\tif (this.classList.contains('swipe-menu-item') && e.type !== 'tap') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfireEvent(Events.SCHEDULE_ACTION, { event: e, model: this.model });\n\t\t\treturn;\n\n\t\t} else if (e.type !== 'tap') {\n\t\t\treturn;\n\t\t}\n\t\t// disable the quicksave button until quick save is complete\n\t\tif (this.customAction.eventHandlerName === 'onQuickSave') {\n\t\t\tfireEvent(Events.TOGGLE_QUICKSAVE, { enable: false } );\n\t\t}\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: this.customAction,\n\t\t\tmodel: this.model\n\t\t});\n\t\tthis.fire('paper-dropdown-close');\n\t}\n\n\t_showAction(customAction, model) {\n\t\treturn !customAction.isHidden(model);\n\t}\n\n\t_getLabel(customAction, viewport) {\n\t\treturn (!customAction.icon || (viewport && (viewport.isMobile() || viewport.S.down) ))\n\t\t\t\t&& customAction.renderLocation !== 'Line'\n\t\t\t? customAction.label : null;\n\t}\n\n\t_hasMenu(customAction, viewport, button, span) {\n\t\treturn (!button && !span) || (customAction.hasMenu && !(viewport && (viewport.isMobile() || viewport.S.down)));\n\t}\n\n\t_hasMenuButton(customAction, viewport, button, span) {\n\t\treturn this._hasMenu(customAction, viewport, button, span) && !span;\n\t}\n\n\t_getButtonClass(customAction, viewport, button, span, groupAction) {\n\t\treturn (groupAction ? 'groupButton ' : '')\n\t\t\t+ (customAction.icon && !this._getLabel(customAction, viewport) ? customAction.icon : '')\n\t\t\t+ (customAction.first ? '':' notFirst')\n\t\t\t+ (customAction.last && !this._hasMenu(customAction, viewport, button, span) ? '':' notLast')\n\t\t\t+ (customAction.primary ? ' primary':'');\n\t}\n\n\t_getMenuClass(customAction, button, groupAction) {\n\t\treturn !button && groupAction ? 'mobileGroupMenu'\n\t\t\t: (groupAction ? 'groupMenu ' : '') + (customAction.last ? '' : 'notLast');\n\t}\n\n\t_toggleQuoteButton(allOptional = false) {\n\t\tthis.allOptional = allOptional;\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleLineButton() {\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleButton() {\n\t\t// Logic that swaps fav swipeItems after the first time\n\t\tif (this.viewport && this.viewport.isMobile() && !this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.style.transform) {\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n\t_setButtonClassAndLabel() {\n\t\t// Logic that swaps fav swipeItems for the first time\n\t\tif (this.viewport && this.viewport.isMobile() && this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.parentElement) {\n\t\t\tPolymer.dom(this.parentElement).flush();\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n\ttoggleQuickSaveButton(e) {\n\t\tif (this.customAction.eventHandlerName === 'onQuickSave') {\n\t\t\tthis.$$('#mainButton').disabled = !e.detail.enable;\n\t\t}\n\t}\n}\n\nPolymer( CustomAction );","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class DSTableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildCellObserver(item, model, data, index, viewport)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.constants;\n\t}\n\n\t_buildCellObserver (item, model, data, index, viewport) {\n\t\tif (item === undefined || model === undefined || data === undefined || index === undefined || viewport === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildCell(item, model, data, index, viewport);\n\t}\n\t\n\tbuildCell() {\n\t\tlet fieldsMD = this.model.md.fieldsMap[this.constants.DISCOUNT_TIER_FIELD];\n\t\tlet field = this.item.replace('template.', '');\n\t\tif (this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\t\tthis.handleOriginalValues();\n\t\tthis.editing = this.isEditable(field, fieldsMD);\n\t\tlet md = fieldsMD[field];\n\t\tmd.CurrencyIsoCode = this.model.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\tthis.md = md\n\t}\n\n\tisEditable(field, fieldsMD) {\n\t\tif(field === this.constants.NUMBER_FIELD)\n\t\t\treturn false;\n\n\t\tif(field === this.constants.LOWER_BOUND_FIELD && this.data.template[this.constants.NUMBER_FIELD] === this.model.disabledDiscountTier)\n\t\t\treturn false;\n\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif(this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\treturn false;\n\n\t\treturn fieldsMD[field].updateable;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data.original && this.data.template) {\n\t\t\tthis.data.original = {};\n\t\t\tthis.data.original.template = JSON.parse(JSON.stringify(this.data.template));\n\t\t}\n\t\tif(this.data.original)\n\t\t\tthis.$.field.originalValue = this.get('data.original.' + this.item);\n\t}\n}\n\nPolymer(DSTableCell);","import { Events } from 'common/core/Events.js';\n\nexport class DSTiers {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-tiers';\n\t\tthis.properties = {\n\t\t\tdiscountTiers: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.DELETE_GROUPS] = this._deleteGroups;\n\t\treturn e;\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 && this.model.fieldsEditable ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t_deleteGroups() {\n\t\t// Used when switching between different discount units\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\trows.forEach(function(row) {\n\t\t\t// Guarantees that the groups are re-rendered properly\n\t\t\trow.cols = undefined;\n\t\t\trow.$.row.destroyGroup();\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( DSTiers );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class FieldSetTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tobjectName: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodel: Object,\n\t\t\titemEditableMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tdefault: {}\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.generateColumns;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_generateColumnsObserver(editorModel, objectName, viewport, model)',\n\t\t\t'modelChanged(model.*)'\n\t\t];\n\t}\n\n\t_generateColumnsObserver (editorModel, objectName, viewport, model) {\n\t\tif (editorModel === undefined || objectName === undefined || viewport === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.generateColumns(editorModel, objectName, viewport, model);\n\t}\n\t\n\tgenerateColumns() {\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tlet fieldNames = [];\n\t\tlet numFields;\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tif (this.objectName == this.editorModel.constants.QUOTE_LINE_GROUP ) {\n\t\t\tlet groupFieldNames = this.editorModel.fieldsetMap.groupFieldNames.slice();\n\t\t\t// Name and Description fields are handled else where\n\t\t\tfor (let i = 0, l = groupFieldNames.length; i < l; i++) {\n\t\t\t\tif (!this.isMobile && (this.editorModel.constants.DESCRIPTION_FIELD == groupFieldNames[i] ||  'Name' == groupFieldNames[i])) {\n\t\t\t\t\tgroupFieldNames.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfieldNames = groupFieldNames;\n\t\t\tnumFields = groupFieldNames.length;\n\t\t} else if (this.objectName == this.editorModel.data.quoteObjectName) {\n\t\t\tfieldNames = this.editorModel.fieldsetMap.quoteFieldNames;\n\t\t\tnumFields = this.editorModel.fieldsetMap.quoteFieldNames.length;\n\t\t}\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.model;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.model;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.model;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n\n\tmodelChanged(e) {\n\t\t// Confirm model is of type quoteModel\n\t\tif ((this.objectName && this.editorModel && this.objectName !== this.editorModel.data.quoteObjectName) || this.model.modelType === 'GroupModel') {\n\t\t\treturn;\n\t\t}\n\t\tif (e.path === 'model.quoteVO.fieldVisibility') { // Path comes from calculate\n\t\t\tthis._visibilityChanged();\n\t\t} else if (e.path === 'model.quoteVO.fieldEditability') { // Path comes from calculate\n\t\t\tthis._editabilityChanged();\n\t\t} else if (e.path === 'model') { // Path comes from load or add products\n\t\t\tif (this.model.quoteVO != null && this.model.quoteVO.fieldVisibility != null && Object.keys(this.model.quoteVO.fieldVisibility).length > 0) {\n\t\t\t\tthis._visibilityChanged();\n\t\t\t}\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tif (!this.model.setHiddenFromPSPClass) {\n\t\t\treturn;\n\t\t}\n\t\tlet itemClassMap = this.model.setHiddenFromPSPClass();\n\t\t// itemClassMap can be an empty object for non-editable -> editable case\n\t\tif (itemClassMap) {\n\t\t\tthis.itemClassMap = itemClassMap;\n\t\t}\n\t}\n\n\t// Used to set editable property on FieldSetTableItem.js component via Group.js\n\t// Only called via calculate, for load or add products see _isEditable() in FieldSetTableItem _setFieldData\n\t_editabilityChanged() {\n\t\tlet fieldNames = this.model.editorModel.fieldsetMap.quoteFieldNames;\n\t\tif (!fieldNames || !this.model.quoteVO.fieldEditability || Object.keys(this.model.quoteVO.fieldEditability).length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet editability = {};\n\t\tfor (let fieldName of fieldNames) {\n\t\t\tif (this.model.quoteVO.fieldEditability.hasOwnProperty(fieldName)) {\n\t\t\t\t// Group.js toggleEditable treats null as a no-op, convert to true for non-editable -> editable case (consistent with quote line psp)\n\t\t\t\teditability[fieldName] = this.model.quoteVO.fieldEditability[fieldName] == null ? true : this.model.quoteVO.fieldEditability[fieldName];\n\t\t\t}\n\t\t}\n\t\tthis.itemEditableMap = editability;\n\t}\n}\n\nPolymer(FieldSetTable);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetTableItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t},\n\t\t\trenderReadOnly: {\n\t\t\t\tvalue: false,\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\ttype: String,\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\teditable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_editableChanged'\n\t\t\t}\n\t\t}\n\t}\n\n\tattached() {\n\t\tif (this.renderReadOnly) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\t_datePickerOpened(e) {\n\t\t// True if in multi-group view\n\t\t// This code should eventually not be needed\n\t\tif (this.renderReadOnly) {\n\t\t\treturn;\n\t\t}\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdateInput = Polymer.dom(dateContainer).querySelector('input'),\n\t\t\tdatepicker = e.detail.datepicker,\n\t\t\tdatepickerHeight = e.detail.datepicker.offsetHeight,\n\t\t\tdatepickerWidth = e.detail.datepicker.offsetWidth,\n\t\t\twindowHeight = window.innerHeight,\n\t\t\twindowWidth = window.innerWidth,\n\t\t\tdateContainerBoundingClientRect = dateContainer.getBoundingClientRect(),\n\t\t\tdistanceFromBottom = windowHeight - dateContainerBoundingClientRect.bottom - datepickerHeight,\n\t\t\tdistanceFromRight = windowWidth - dateContainerBoundingClientRect.left - datepickerWidth;\n\n\t\tdatepicker.style.position = 'fixed';\n\n\t\t// Style depending on distance from right side of screen to position appropriately\n\t\tif (distanceFromRight < 0) {\n\t\t\t// Use date input here instead of container so that the datepicker is aligned with the input box\n\t\t\tdatepicker.style.left = dateInput.getBoundingClientRect().right - datepickerWidth + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t}\n\n\t\t// Style depending on distance from bottom of screen to position appropriately\n\t\tif (distanceFromBottom < 0) {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top - datepickerHeight + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.bottom + 'px';\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldDataObserver(item, model, data)',\n\t\t\t\t'_displayChangedObserver(value, display, item, data, md)',\n\t\t\t\t'_valueChangedObserver(value, md)',\n\t\t\t\t'_updateOriginalValueObserver(model, item)'];\n\t}\n\n\t_setFieldDataObserver (item, model, data) {\n\t\tif (item === undefined || model === undefined || data === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setFieldData(item, model, data);\n\t}\n\t\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tthis.md = this.model.getFieldMD(this.item);\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// Mobile RTE's should be null if there is no value, ie Group Description\n\t\tthis.label = (this.value == null && this.md.extraTypeInfo === 'richtextarea' && this.isMobile) ? null : this.md.label;\n\t\t\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\t// To set the field is editable because it's required for the sb-field.\n\t\t// Calculated and roll-up summary fields should not be editable\n\n\t\t// Update CurrencyIsoCode for quote and group level fields\n\t\tif (this.data.CurrencyIsoCode) {\n\t\t\tthis.md['CurrencyIsoCode'] = this.data.CurrencyIsoCode;\n\t\t}\n\n\t\tthis.$.field.editing = this._isEditable();\n\t\tthis.$.field.disabled = this._isDisabled();\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_isEditable() {\n\t\t// If field is readOnly from the beginning no need to continue with quote level psp\n\t\tif (!this.md.updateable) {\n\t\t\treturn false;\n\t\t} else if (this.model.quoteVO.fieldEditability != null && this.model.quoteVO.fieldEditability[this.item] != null) {\n\t\t\treturn this.model.quoteVO.fieldEditability[this.item];\n\t\t} else {\n\t\t\treturn !!this.md.updateable; //true if this.md.updateable == true\n\t\t}\n\t}\n\n\t_isDisabled() {\n\t\t// If field is a checkbox aka 'boolean' type, the disabled property is what formFactory -> checkboxFactory uses\n\t\t// to determine field editability. So if psp script wants to change editability for checkbox we must set disabled\n\t\tlet editabilityMap = this.model.quoteVO.fieldEditability;\n\t\tif (this.md.updateable && this.md.type === 'boolean' && editabilityMap != null && editabilityMap[this.item] != null) {\n\t\t\treturn !editabilityMap[this.item];\n\t\t}\n\n\t\treturn !this.md.updateable;\n\t}\n\n\t_valueChangedObserver (value, md) {\n\t\tif (value === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._valueChanged(value, md);\n\t}\n\t\n\t_valueChanged() {\n\t\tthis._updateLookupDisplayValue();\n\t\tthis.$.field.value = this.value;\n\t\tif (this.data && this.item) {\n\t\t\tthis.data[this.item] = this.value;\n\t\t}\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tif (!this.data) {\n\t\t\treturn;\n\t\t}\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_handleFieldValueChanged(e) {\n\t\tlet suppressImmediateCalculation = e.detail ? e.detail.suppressImmediateCalculation : false;\n\t\tif (this.calculateImmediately && !suppressImmediateCalculation) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t}\n\n\t_displayChangedObserver (value, display, item, data, md) {\n\t\tif (value === undefined || display === undefined || item === undefined || data === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._displayChanged(value, display, item, data, md);\n\t}\n\t\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.md.referenceTo[0]);\n\t}\n\n\t_updateOriginalValueObserver (model, item) {\n\t\tif (model === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateOriginalValue(model, item);\n\t}\n\t\n\t_updateOriginalValue() {\n\t\tif (!this.type) {\n\t\t\treturn;\n\t\t}\n\t\t// Avoids data marked as dirty when front end operation (i.e. delete lines, sort lines, etc) from displaying dirty when they shouldn't be\n\t\tthis.model[this.type]._transient_ = this.model[this.type]._transient_ || {};\n\t\tthis.model[this.type]._transient_.original = this.model[this.type]._transient_.original || JSON.parse(JSON.stringify(this.model[this.type].record));\n\t\tlet originalRecord = this.get(`model.${this.type}._transient_.original`);\n\t\tthis.$.field.originalValue = originalRecord[this.item];\n\t}\n\n\t_editableChanged() {\n\t\tif (this.md.updateable) {\n\t\t\tthis.$.field.toggleEditing(this.editable);\n\t\t}\n\t}\n\n}\n\nPolymer(FieldSetTableItem);\n","import {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class LEDrawer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-drawer';\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array,\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ '_initObserver(fieldNames, lineModel)',\n\t\t\t\t '_lineRecordChanged(lineModel.*)'];\n\t}\n\n\t_initObserver (fieldNames, lineModel) {\n\t\tif (fieldNames === undefined || lineModel === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.init(fieldNames, lineModel);\n\t}\n\t\n\tinit() {\n\t\t//initial creation of drawer happens when drawer is toggled in UI3 and\n\t\t//  _lineRecordChanged is not triggered\n\t\tthis._visibilityChanged();\n\t\tthis._editabilityChanged();\n\n\t\tlet richTextFields = [];\n\t\tfor (let field of this.fieldNames) {\n\t\t\tif (this._isRichTextField(field)) {\n\t\t\t\trichTextFields.push(field);\n\t\t\t}\n\t\t}\n\t\tthis.richTextFields = richTextFields;\n\t}\n\n\t_isRichTextField(field) {\n\t\treturn this.lineModel.getFieldMD(field).extraTypeInfo === 'richtextarea';\n\t}\n\n\t_lineRecordChanged(e) {\n\t\tif (e.path === 'lineModel.lineVO.fieldVisibility') {\n\t\t\tthis._visibilityChanged();\n\t\t} else if (e.path === 'lineModel.lineVO.fieldEditability') {\n\t\t\tthis._editabilityChanged();\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tthis.lineModel.setItemClassMap();\n\t\tthis.itemClassMap = this.lineModel.itemClassMap;\n\t}\n\n\t_editabilityChanged() {\n\t\tif (!this.fieldNames || !this.lineModel.lineVO.fieldEditability || Object.keys(this.lineModel.lineVO.fieldEditability).length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet editability = {};\n\t\tfor (let fieldName of this.fieldNames) {\n\t\t\tif (this.lineModel.lineVO.fieldEditability.hasOwnProperty(fieldName)) {\n\t\t\t\t// Group.js toggleEditable treats null as a no-op\n\t\t\t\teditability[fieldName] = this.lineModel.isEditable(fieldName);\n\t\t\t}\n\t\t}\n\t\tthis.itemEditableMap = editability;\n\t}\n\n\t_showLineMultiActions(editorModel) {\n\t\treturn (editorModel.actionsOnTheLeft ? 'actionsOnTheLeft ' : '')\n\t\t\t+ (editorModel.data.settings.multiLineDeleteEnabled ? 'multiDeleteEnabled' : '');\n\t}\n\n\t_isListMode() {\n\t\treturn !!AppContext.isCompactModeEnabled;\n\t}\n}\n\nPolymer(LEDrawer);","import { Events } from 'common/core/Events.js';\n\nexport class LEFooter {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-footer';\n\t\tthis.properties = {\n\t\t\tquoteModel: Object,\n\t\t\tquoteTotal: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\tquoteTotalMd: Object,\n\t\t\teditorModel: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.COL_WIDTHS_CHANGED] = this.colWidthsChanged;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn ['_showQuoteTotal(quoteModel.quoteVO.*)',\n\t\t\t\t'_setTotalWidth(quoteModel.editorModel.layout)'];\n\t}\n\n\tget settings() {\n\t\treturn this.quoteModel.editorModel.data.settings;\n\t}\n\n\tget quoteFields() {\n\t\treturn this.quoteModel.editorModel.md.fieldsMap[this.settings.developerPrefix + 'Quote__c'];\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_setTotalWidth() {\n\t\tif(this.showQuoteTotal) {\n\t\t\tlet editorModel = this.quoteModel.editorModel;\n\t\t\tthis.toggleClass('largeQuote', editorModel.largeQuoteExperienceEnabled, this.$.container);\n\t\t\tthis.labelClass = editorModel.deviceContext.isMobile ? 'hidden' : '';\n\t\t\tif (!editorModel.layout || editorModel.deviceContext.isMobile || editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.totalWidth = this.quoteModel.editorModel.layout.totalWidth + 'px';\n\t\t}\n\t}\n\n\t_showQuoteTotal() {\n\t\tthis.grouped = this.quoteModel.grouped ? 'grouped' : '';\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tthis.showQuoteTotal = this.settings.lineEditorTotalsField != 'doNotDisplay' && this.quoteVO.lineItems && this.quoteVO.lineItems.length > 0;\n\t\tthis._setQuoteTotal();\n\t}\n\n\t_setQuoteTotal() {\n\t\tlet total,\n\t\t\tpriceScale,\n\t\t\tconstants = this.quoteModel.editorModel.constants,\n\t\t\ttotalsField = this.settings.lineEditorTotalsField; // Quote total field to be displayed. If the user has never saved this setting, its value would be null\n\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tif (!totalsField || totalsField == 'Default') { // Default or unchanged totals field\n\t\t\tif (this.settings.isMultiCurrencyOrg) {\n\t\t\t\tpriceScale = this.quoteVO.currencyDecimalScale;\n\t\t\t} else {\n\t\t\t\tif (this.quoteVO.applyAdditionalDiscountLast) {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.CUSTOMER_AMOUNT_FIELD].scale;\n\t\t\t\t} else {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.NET_AMOUNT_FIELD].scale;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttotal = this.quoteVO.applyAdditionalDiscountLast ? this.quoteVO.customerTotal : this.quoteVO.netTotal;\n\t\t} else { // Custom totals field\n\t\t\tpriceScale = this.settings.isMultiCurrencyOrg ? this.quoteVO.currencyDecimalScale :\n\t\t\t\tthis.quoteFields[totalsField] ? this.quoteFields[totalsField].scale : 0;\n\t\t\ttotal = this.quoteVO.record[totalsField] || 0; // If totalsField is not found, default to 0\n\t\t}\n\t\tif (!this.quoteTotalMd) {\n\t\t\tthis.quoteTotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.quoteTotal = total.toFixed(priceScale);\n\t}\n}\n\nPolymer( LEFooter );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport { AppContext } from 'common/core/AppContext.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\n\n/**\n * <sb-le-group>\n *\n * Features:\n *\n */\nexport class LEGroup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - hosts the GroupVO information and line items */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_groupModelChanged'\n\t\t\t},\n\t\t\tgroupClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tsubtotal: Number,\n\t\t\tsubtotalMd: Object,\n\t\t\t/** Description, labeled value to interact properly with sb-field */\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_descriptionChanged'\n\t\t\t},\n\t\t\tdescriptionMd: Object,\n\t\t\tgroupLevelTabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfavorited: Boolean,\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.COL_WIDTHS_CHANGED] = this.colWidthsChanged;\n\t\te[Events.RENDER_NEW_TAB] = this.renderNewTab;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() {\n\t\treturn [\n\t\t\t'_groupRecordChanged(groupModel.groupVO.record.*)',\n\t\t\t'_toggleGrouping(groupModel.groupVO)',\n\t\t\t'_segmentedPrimaryMobileColsChanged(groupModel.editorModel.segmentedPrimaryMobileCols)',\n\t\t\t'_linesChanged(groupModel.standardLines.splices)',\n\t\t\t'_linesChanged(groupModel.segmentedLinesByDimension.*)',\n\t\t\t'_createDragDropModel(editorModel)',\n\t\t\t'_groupCustomActionsChanged(groupModel.editorModel.groupCustomActions)',\n\t\t\t'_showSubtotal(groupModel.groupVO.record.*)',\n\t\t\t'_updateColumnWidths(groupHasSegmentedProducts)',\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.groupExpanded = false;\n\t\tthis.showSpinner = false;\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'cseDialog-tapped': '_handleCSEDialogTapped',\n\t\t\t'segmented-changed': '_customSegmentedUpdated',\n\t\t\t'upgrade-asset-quantity-changed': '_setUpgradeQuantity'\n\t\t};\n\t}\n\n\t/**\n\t * Need to update the column widths to resize to the width of the standard table\n\t * when the last MDQ line is deleted if column resizing is on\n\t */\n\t_updateColumnWidths() {\n\t\tif (!this.groupHasSegmentedProducts && AppContext.isColumnResizingEnabled) {\n\t\t\tfireEvent(Events.MDQ_LINE_DELETED);\n\t\t}\n\t}\n\n\t_createDragDropModel() {\n\t\tlet validTargets = new Set(['sb-droppable-mdqRows', 'sb-droppable-emptyTable',\n\t\t\t'sb-droppable-emptyMDQTable', 'sb-droppable-emptyMDQSegmentTab',\n\t\t\t'sb-droppable-sidePanelGroups', 'emptyTableMessage']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sf-le-table-row',\n\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\t/**\n\t *  To determine whether the lines are changed\n\t *\n\t * @private\n\t */\n\t_groupModelChanged() {\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\t\tthis._updateTableProperties();\n\t\tthis._updatePageData(this._getTabs(this.groupModel));\n\t\tthis._setIsButton();\n\t\tthis.isMobile = this.viewport ? this.viewport.isMobile() : false;\n\t\tif (this.isMobile || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.set('groupModel.groupExpanded', this.groupExpanded);\n\t\t\tthis.buildGroupTabs();\n\t\t}\n\t\t// Always show buttons in desktop\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tthis.set('groupModel.groupExpanded', true);\n\t\t\tthis._setTotalWidth();\n\t\t}\n\n\t\tthis.containerClass = this.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\t}\n\n\t_setIsButton() {\n\t\tthis.isButton = this.viewport ? (this.viewport.isDesktop() && this.viewport.M.up) : true;\n\t}\n\n\t_setTotalWidth() {\n\t\tif (!this.editorModel.layout || this.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.totalWidth = this.editorModel.layout.totalWidth + 2 + 'px';\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_linesChanged() {\n\t\tthis._updateTableProperties();\n\t\tconst tabs = this._getTabs(this.groupModel);\n\t\tif (tabs.length !== this.tabs.length) {\n\t\t\tthis._updatePageData(tabs);\n\t\t}\n\t}\n\n\t_updateTableProperties() {\n\t\tthis.groupHasStandardProducts = this.groupModel._groupHasStandardProducts();\n\t\tthis.groupHasSegmentedProducts = this.groupModel._groupHasSegmentedProducts();\n\t\tthis.groupedAndHasNoLineItems = this.groupModel.quoteModel.grouped && !this._groupHasLineItems();\n\t\tthis.groupHasBothProducts = this._groupHasBothProducts();\n\t\tthis._showSubtotal();\n\t\tthis._setGroupDescription();\n\t}\n\n\t_segmentedPrimaryMobileColsChanged() {\n\t\tthis._updatePageData(this._getTabs(this.groupModel));\n\t}\n\n\t/**\n\t * To update the page data so that it will be rendered\n\t *\n\t * @private\n\t */\n\t_updatePageData(tabs) {\n\t\tif (this.$$('#leGroupTabs')) {\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t}\n\t\tthis.tabs = tabs;\n\t\tif (!this.groupMDQTabs) {\n\t\t\tthis.groupMDQTabs = tabs;\n\t\t}\n\t}\n\n\t_getTabs(groupModel) {\n\t\tconst tabs = [];\n\t\tconst dimensions = groupModel.dimensions;\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\n\t\t\tif (groupModel.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: groupModel.quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + groupModel.groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseDialog';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\treturn tabs;\n\t}\n\n\t/**\n\t * Open the Custom Segment Dialog with the custom segment information from the quote\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_handleCSEDialogTapped(e) {\n\t\tthis.fire('cse-tapped', {\n\t\t\tdialog: 'cseDialog',\n\t\t\tgroupModelKey: this.groupModel.groupKey\n\t\t});\n\t}\n\n\t_groupHasBothProducts() {\n\t\treturn this.groupModel._groupHasStandardProducts() && this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupHasLineItems() {\n\t\treturn this.groupModel._groupHasStandardProducts() || this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupRecordChanged(changedRecord) {\n\t\tif (changedRecord.path == `groupModel.groupVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`) {\n\t\t\tfireEvent(Events.TOGGLE_OPTIONAL_CLICKED, { toggleOptionalBoolean: changedRecord.value, groupKey: this.groupModel.groupKey });\n\t\t}\n\t\tlet groupRecord = this.groupModel.groupVO.record\n\t\tthis.favorited = !!(groupRecord && groupRecord[this.editorModel.constants.FAVORITE_ID_FIELD]);\n\t}\n\n\t_setGroupDescription() {\n\t\tif (!this.groupModel.groupVO.record) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.value = this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tif (this.groupModel && this.editorModel.md && this.editorModel.constants) {\n\t\t\tthis._getDescriptionMd();\n\t\t}\n\t\tif (this.value) {\n\t\t\treturn;\n\t\t}\n\t\t// If there is no description, give value a placeholder string\n\t\tthis.value = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t}\n\n\t_descriptionChanged() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tif (this.value !== description) {\n\t\t\tthis.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD] = this.value;\n\t\t}\n\t}\n\n\t_getDescriptionMd() {\n\t\tlet groupObjMd = this.editorModel.md.fieldsMap[this.groupModel.groupObjectName];\n\t\tthis.descriptionMd = groupObjMd[this.editorModel.constants.DESCRIPTION_FIELD];\n\t}\n\n\t_getSegmentKeys() {\n\t\treturn Object.keys(this.groupModel.segmentedLinesBySegmentKey);\n\t}\n\t\n\ttriggerCustomAction(e) {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: e.currentTarget.attributes.eventHandlerName.value},\n\t\t\tmodel: this.groupModel\n\t\t});\n\t}\n\n\t// Helper Functions\n\n\tshowGroupNameEditor(e) {\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\te.stopPropagation();\n\t\tthis.toggleClass('hidden', true, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', false, this.$$('#groupNameInput'));\n\t\tthis.$$('#groupNameInput').focus();\n\t\tthis.$$('#groupNameInput').setSelectionRange(0, this.groupModel.groupVO.record.Name.length);\n\t}\n\n\tcheckInputValue(e) {\n\t\te.stopPropagation();\n\t\tif (e.target.value != \"\") {\n\t\t\tthis.set('groupModel.groupVO.record.Name', e.target.value);\n\t\t}\n\t\tthis.toggleClass('hidden', false, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', true, this.$$('#groupNameInput'));\n\t}\n\n\tcloseGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (e.keyCode == '13') {\n\t\t\tthis.$$('#groupNameInput').blur();\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.groupModel.groupVO.record)\n\t\t\treturn;\n\n\t\tlet settings = this.groupModel.quoteModel.editorModel.data.settings;\n\t\tif (this.groupModel.quoteModel.grouped && settings.lineEditorGroupSubtotalsField != 'doNotDisplay' && ((this.groupModel.segmentedLines.length > 0 && this.groupModel._groupHasStandardProducts()) || (this.viewport && this.viewport.isMobile()) || this.groupModel.editorModel.largeQuoteExperienceEnabled)) {\n\t\t\tthis._getSubtotal(); // if subtotal is shown, set subtotal to the correct value\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tif (!this.groupModel.quoteModel.grouped) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorModel = this.groupModel.quoteModel.editorModel,\n\t\t\tsettings = editorModel.data.settings,\n\t\t\tpriceScale,\n\t\t\tsubtotal;\n\n\t\tlet subtotalField = settings.lineEditorGroupSubtotalsField;\n\t\t// Determine which Org Settings field to use for subtotals\n\t\tif (subtotalField == 'Default' || subtotalField == null) {\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.groupModel.quoteModel.quoteVO.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\tsubtotal = this.groupModel.groupVO.record[editorModel.constants.NET_TOTAL_FIELD] || 0;\n\t\t} else { // Custom subtotals field\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.groupModel.quoteModel.quoteVO.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][subtotalField].scale;\n\t\t\tsubtotal = this.groupModel.groupVO.record[settings.lineEditorGroupSubtotalsField] || 0; // If subtotalsField is not found, default to 0\n\t\t}\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.subtotal = subtotal;\n\t}\n\n\t_toggleGrouping(){\n\t\t// Necessary for IE to update when toggling between grouped and ungrouped\n\t\tthis.notifyPath('groupModel.quoteModel.grouped', this.groupModel.quoteModel.grouped);\n\t\tthis.set('groupClass', this.groupModel.quoteModel.grouped ? 'group' : 'virtualGroup');\n\t}\n\n\tbuildGroupTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForGroupLayout = [];\n\t\tif (this.editorModel.fieldsetMap.groupFieldNames.length > 0 && this._groupHasLineItems() && !this.editorModel.largeQuoteExperienceEnabled)\n\t\t\tnamesForGroupLayout.push('details');\n\t\tif (this.groupModel._groupHasSegmentedProducts())\n\t\t\tnamesForGroupLayout.push('segmented');\n\t\tif (this.groupModel._groupHasStandardProducts())\n\t\t\tnamesForGroupLayout.push('standard');\n\n\t\tlet tabs = [];\n\t\t// Used in sb-group-tabs to create mdq tabs\n\t\tthis.groupModel.groupMDQTabs = this.tabs;\n\n\t\tif (!this._renderTabs(namesForGroupLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#groupTabs')) {\n\t\t\tthis.$$('#groupTabs').destroyTabs();\n\t\t}\n\n\t\tfor (let i = 0, l = namesForGroupLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForGroupLayout[i];\n\n\t\t\ttabs.push({name: tId, label: tabName});\n\t\t}\n\t\tthis.groupLevelTabs = undefined;\n\t\tthis.bind = ['groupModel', 'editorModel'];\n\t\tthis.groupMDQTabs = this.groupModel.groupMDQTabs;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.groupLevelTabs = tabs;\n\t}\n\n\t_renderTabs(namesForGroupLayout) {\n\t\tif (this.groupLevelTabs.length !== namesForGroupLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModel.groupMDQTabs && this.groupMDQTabs.length !== this.groupModel.groupMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.groupLevelTabs.length; i < l; i++) {\n\t\t\tif (this.groupLevelTabs[i].label !== namesForGroupLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\texpandGroup(e) {\n\t\tif (!e.target.hasAttribute('triggersExpandGroup') || !this.isMobile || this.showSpinner){\n\t\t\treturn;\n\t\t}\n\n\t\t// if the mobile group tabs are rendered, then there should be no lag to show/hide the tabs, so a spinner shouldn't appear.\n\t\tif (!this.$$('#mobileGroupTabs')) {\n\t\t\tthis.showSpinner = true;\n\t\t}\n\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.set('groupModel.groupExpanded', !this.groupModel.groupExpanded);\n\t\t\tthis.groupExpanded = this.groupModel.groupExpanded;\n\t\t\t\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tthis.showSpinner = false;\n\t\t\t});\n\t\t});\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setIsButton();\n\t\tif (this.viewport && this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\trenderNewTab(e) {\n\t\tlet groupKey = e.detail.groupKey;\n\t\tif (groupKey === this.groupModel.groupKey) {\n\t\t\tthis._updatePageData(this._getTabs(this.groupModel));\n\t\t\tif (this.isMobile || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis.buildGroupTabs();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * @param {Object} e - event object\n\t * @private\n\t */\n\t_setUpgradeQuantity(e) {\n\t\tlet sourceIndex = e.detail.sourceIndex;\n\t\tlet upgradeIndex = e.detail.upgradeIndex;\n\t\tlet sourceLineVO = e.detail.sourceLineVO;\n\t\tlet upgradeLineVO = e.detail.upgradeLineVO;\n\n\t\tthis.debounce('Handle user input for automatic upgrade asset quantity changed', () => {\n\t\t\tif (sourceLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex, sourceLineVO, true);\n\t\t\t} else if (upgradeLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(upgradeIndex, sourceIndex, upgradeLineVO, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex);\n\t\t\t}\n\t\t\tsourceLineVO.invalidQuantity = null;\n\t\t\tupgradeLineVO.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * Fires validate-quantity-changed event listened for in LineEditor.js for use of toast\n\t * @param {Number} index1 - index to update for either the source or upgrade\n\t * @param {Number} index2 - index to update for the opposite of index1\n\t * @param {Object} lineVO - either the source or upgrade lineVO containing the record to be updated\n\t * @param {Boolean} invalidQuantity - flag for whether the user entered an invalidQuantity or not, added to avoid case where invalidQuantity is set to a number that evaluates to truthy\n\t */\n\t_notifyQuantityChanged(index1, index2, lineVO, invalidQuantity) {\n\t\tlet invalidQuantityCheck;\n\t\tlet validQuantityCheck;\n\t\tthis.groupModel.standardLines[index1].internalUpdate = true;\n\t\tthis.groupModel.standardLines[index2].internalUpdate = true;\n\n\t\t// Adds boolean check for invalidQuantity in case invalidQuantity is set to a number that evaluates to truthy\n\t\tif (invalidQuantity) {\n\t\t\tinvalidQuantityCheck = lineVO.invalidQuantity;\n\t\t\tvalidQuantityCheck = lineVO.validQuantity;\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.invalidQuantity;\n\t\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index1].internalUpdate = false;\n\t\tthis.notifyPath(`groupModel.standardLines.${index2}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index2].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index2].internalUpdate = false;\n\n\t\t// Event must be at end of function and gets called in invalidQuantity on lineVO\n\t\tthis.fire('validate-quantity-changed', {\n\t\t\tinvalidQuantity: invalidQuantityCheck,\n\t\t\tvalidQuantity: validQuantityCheck\n\t\t});\n\t}\n\n\taddSegmentedLineToEmptyTable(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tif (!this.groupModel.hasVisibleSegmentedLines) {\n\t\t\tthis.groupModel.hasVisibleSegmentedLines = {};\n\t\t}\n\n\t\t//Create all segment tabs to allow for drag and dropping on all segments\n\n\t\tthis.groupModel.setDimensionProperties(dimension);\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t// Update multisegment columns to render the row properly, using the column data on quote since it will still be there\n\t\tthis.groupModel.groupVO.multiSegmentColumns[dimension] = lineModel.editorModel.data.quote.multiSegmentColumns[dimension];\n\t\tthis.groupModel.groupVO.localizedMultiSegmentColumns[dimension] = lineModel.editorModel.data.quote.localizedMultiSegmentColumns[dimension];\n\t\tthis.groupModel.colWidth[dimension] = lineModel.groupModel.colWidth[dimension];\n\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\t\t// Rebuild Tabs\n\t\tthis._updatePageData(this._getTabs(this.groupModel));\n\t}\n\n\taddSegmentedLineToExistingTab(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\n\t}\n\n\t// Removes segmented line from previous group\n\tremoveSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.groupModel.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.groupModel.quoteVO.multiSegmentKeys) ? this.groupModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tthis.groupModel.segmentedLines.splice(this.groupModel.segmentedLines.indexOf(lineModel), 1);\n\t\tdelete this.groupModel.segmentedLinesBySegmentKey[segmentKey];\n\t\tthis.splice(`groupModel.segmentedLinesByDimension.${dimension}`, this.groupModel.segmentedLinesByDimension[dimension].indexOf(lineModel), 1);\n\t\tif (this.groupModel.segmentedLinesByDimension[dimension].length === 0) {\n\t\t\tthis.groupModel.removeDimensionProperties(dimension);\n\t\t\tdelete this.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t\tdelete this.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t\t// Rebuild Tabs\n\t\t\tthis._updatePageData(this._getTabs(this.groupModel));\n\t\t}\n\t}\n\n\t_onTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tthis.dragDrop.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tthis.linesByParentKey = this.editorModel.quoteModel.linesByParentItemKey;\n\t\tthis.indexByGroupKey = this.groupModel.quoteModel.indexByGroupKey;\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\t\tthis.dragDrop.dragLineModel = [];\n\t\tthis.dragDrop.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tthis.dragDrop.dragKey = dragElement.lineModel.lineVO.key;\n\t\tthis.dragDrop.dragLineModel = dragElement.lineModel;\n\t\tthis.dragDrop.segment = dragElement.domHost.dimension;\n\t\tthis.dragDrop.dragIndex = this.groupModel.segmentedLinesByDimension[this.dragDrop.segment].indexOf(dragElement.lineModel);\n\n\t\t//Toggle true the 'hidden' attribute to hide rows being dragged from page.\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dragDrop.segment}.${this.dragDrop.dragIndex}.hidden`, true);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) return;\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.getAttribute('ref') === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tswitch(dd.targetClass) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tdd._updateMDQTableRowHoverOverObject(dd.sourceElement, hoverElement);\n\t\t\t\tif (!dd.hoverOver) return;\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = false;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (dd.keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (dd.keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tthis.dragDrop.dropKey = null;\n\t\tthis.dragDrop.dropIndex = null;\n\t\tthis.dragDrop.dropGroupModel = null;\n\t\tlet segment = this.dragDrop.segment,\n\t\t\tdropLeGroup,\n\t\t\tdropSegLinesTable,\n\t\t\tdragLineModel = this.dragDrop.dragLineModel;\n\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${segment}.${this.dragDrop.dragIndex}.hidden`, false);\n\n\t\tif (!dropElement) return;\n\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\tthis.dragDrop.dragGroupModel._updateSegmentedSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tdragElement.domHost.fieldNames = dragElement.domHost._getFields();\n\t\t\tdragElement.domHost._setColumnWidths();\n\t\t}\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tlet dropGroupModel = dropElement.lineModel.groupModel;\n\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost.domHost;\n\t\t\t\tdropSegLinesTable = dropElement.domHost;\n\n\t\t\t\tthis.dragDrop.dropGroupModel = dropGroupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\t\t\t\t//Get index of where drop will occur on array of segmentedLinesByDimension after line has been spliced\n\t\t\t\t//from it's original groupModel.\n\t\t\t\tlet dropIndex = dropGroupModel.segmentedLinesByDimension[segment].indexOf(dropElement.lineModel);\n\t\t\t\t//Adjust index of drop depending on whether it's dropped before or after.\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdropIndex = dropIndex >= 0 ? dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dropIndex;\n\t\t\t\t}\n\t\t\t\t//Update relevant lineModel properties to maintain it's group information\n\t\t\t\tdragLineModel.groupModel = dropGroupModel;\n\t\t\t\tdragLineModel.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\tdragLineModel.segments.forEach(function(seg){\n\t\t\t\t\tseg.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\t\tseg.groupModel = dropGroupModel;\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\t//Splice line into it's new position/group.\n\t\t\t\tconst segmentedKey = dragLineModel.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD];\n\t\t\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentedKey] = dragLineModel;\n\t\t\t\tthis.groupModel.segmentedLines.splice(dropIndex, 0, dragLineModel);\n\t\t\t\tdropLeGroup.splice(`groupModel.segmentedLinesByDimension.${segment}`, dropIndex, 0, dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\tcase 'emptyTableMessage':\n\t\t\t\tdropLeGroup = Polymer.dom(dropElement).getOwnerRoot().host;\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = this.dragDrop._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\tif (!this.dragDrop.dropGroupModel.dimensions.includes(this.dragDrop.segment)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dragLineModel);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (className === 'sb-droppable-mdqRows') {\n\t\t\tlet model = dropLeGroup.groupModel.segmentedLinesByDimension[segment];\n\t\t\tdropElement.domHost.notifyPath(`groupModel.segmentedLinesByDimension.${segment}`, model.slice());\n\t\t\tdropElement.domHost.notifyPath('lineModels', model.slice());\n\t\t}\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t\t// post drop refreshing\n\t\tvar dragTable = dragElement.domHost;\n\t\tvar dropTable = dropElement.domHost;\n\t\tif (dragTable && dragTable.tagName === 'SF-SEGMENTED-TABLE') {\n\t\t\tdragTable._prepareUIData();\n\t\t}\n\t\tif (dropTable && dropTable.tagName === 'SF-SEGMENTED-TABLE' && dragTable !== dropTable) {\n\t\t\tdropTable._prepareUIData();\n\t\t}\n\t}\n\n\t_groupCustomActionsChanged(e) {\n\t\tlet l = e ? e.length : 0;\n\t\tfor(let i = 0; i < l; i++)\n\t\t\tthis.notifyPath(`editorModel.groupCustomActions.${i}.children`);\n\t}\n}\n\nPolymer( LEGroup );","import {AppContext} from 'common/core/AppContext.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {removeTopBottomBorderClass} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\nimport { saveColumnObjects, resetColumnSizes } from 'quotes/column-sizing-dao/ColumnSizingDao.js';\nimport {put, get, del} from 'quotes/models/ClientCache.js';\nimport {Cache} from 'common/data/cache/Cache.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\nconst STANDARD_DIM = 'Standard';\nexport class LEGroupLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group-layout';\n\t\tthis.properties = {\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlayoutLink: String,\n\t\t\tlayoutWidth: Number,\n\t\t\tlayoutLeft: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '24px'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tlastSelectedGroup: Object,\n\t\t\tselectedGroupKey: { /* Selected group's key in Single Group View (Large Quote Experience)*/\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\teditorModel: Object,\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.TOGGLE_PANEL_CLICKED] = this.toggle;\n\t\te[Events.CLOSE_GROUP_PANEL] = this.closePanel;\n\t\te[Events.GROUP_PANEL_CREATED] = this.groupPanelCreated;\n\t\te[Events.BUILD_LAYOUT] = this.buildLayout;\n\t\te[Events.GROUP_ADDED] = this.groupAdded;\n\t\te[Events.GROUP_DELETED] = this.groupDeleted;\n\t\te[Events.PAGE_RESIZED] = this.pageResized;\n\t\te[Events.RESET_COL_SIZES] = this.resetToDefault;\n\t\te[Events.MDQ_LINE_DELETED] = this.resizeColumnsOnLineItemDelete;\n\t\treturn e;\n\t}\n\n\tget listeners() {\n\t\treturn {'side-toggle-clicked' : 'toggle',\n\t\t\t'sf-col-size-adjusted': 'sizeAdjusted',\n\t\t\t'sf-reset-col-sizes': 'resetToDefault'};\n\t}\n\n\tget observers() {\n\t\treturn ['_groupModelsAreChangedObserver(editorModel, groupModels, rightSideButton)',\n\t\t'_spliceObserver(groupModels.splices)', \n\t\t'_createDragDropModel(groupModels)'];\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis._resize = function() {\n\t\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\t\tthis.buildLayout();\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\t\tfireEvent(Events.COL_WIDTHS_CHANGED, { layout: this.editorModel.layout, groupKey: this.selectedGroupKey });\n\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t}.bind(this);\n\t\t\twindow.addEventListener('resize', this._resize);\n\t\t});\n\t}\n\n\tdetached() {\n\t\twindow.removeEventListener('resize', this._resize);\n\t}\n\n\tget isMobile() {\n\t\treturn this.editorModel.deviceContext.isMobile;\n\t}\n\n\t_spliceObserver(splicedRecords) {\n\t\tif (!splicedRecords || splicedRecords.indexSplices[0].addedCount == 0)\n\t\t\treturn;\n\t\tthis.addedIndex = splicedRecords.indexSplices[0].index;\n\t\tthis.addedKey = splicedRecords.indexSplices[0].object[this.addedIndex].groupVO.key;\n\t\tif (!this.observersAttached) {\n\t\t\tthis._attachObservers();\n\t\t}\n\t}\n\n\t/**\n\t * Event for when a columns size has been adjusted.\n\t * Update the fields width and rebuild the layout, then fire COL_WIDTHS_CHANGED evt to update the tables\n\t * @param e\n\t */\n\tsizeAdjusted(e) {\n\t\tif (e.detail && e.detail.field && e.detail.fieldsWidth && e.detail.fieldSet) {\n\t\t\tconst fieldSet = e.detail.fieldSet;\n\t\t\tconst resizedField = e.detail.field;\n\t\t\tconst colWidthKey = e.detail.dimension ? e.detail.dimension : STANDARD_DIM;\n\t\t\tif (this.editorModel && this.editorModel.quoteModel && this.editorModel.quoteModel.lineGroups) {\n\t\t\t\tthis.editorModel.quoteModel.lineGroups.forEach((groupModel) => {\n\t\t\t\t\tif (groupModel.colWidth && groupModel.colWidth[colWidthKey] &&\n\t\t\t\t\t\tgroupModel.colWidth[colWidthKey][resizedField]) {\n\t\t\t\t\t\tgroupModel.colWidth[colWidthKey][resizedField] = e.detail.fieldsWidth;\n\t\t\t\t\t\tput('columnSizes', [], groupModel.colWidth);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst context = {\n\t\t\t\t\tfieldSetName: fieldSet,\n\t\t\t\t\tcolumnSizes: get('columnSizes')[colWidthKey],\n\t\t\t\t\tshouldBeDefault: false,\n\t\t\t\t\tobjectType: this.editorModel.constants.QUOTE_LINE,\n\t\t\t\t};\n\t\t\t\tsaveColumnObjects(context, e.detail.field);\n\t\t\t\tthis.buildLayout(); // rebuild the layout\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tfireEvent(Events.COL_WIDTHS_CHANGED, {layout: this.editorModel.layout});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * When reseting column sizes back to default we need to remove the map\n\t * update the layout, and fire the evt to update the table(s)\n\t */\n\tresetToDefault(e) {\n\t\tif (this.editorModel && this.editorModel.layout && e.detail && e.detail.fieldSet) {\n\t\t\tdel('columnSizes');\n\t\t\t// reset column sizes in Cache to avoid stale data\n\t\t\tlet cachedData = Cache.get('LineEditor', this.editorModel.quoteModel.quoteVO.record.Id.substring(0,15));\n\t\t\tif (cachedData.columnMetadata) {\n\t\t\t\tcachedData.columnMetadata = [];\n\t\t\t}\n\t\t\tthis.editorModel.columnMetadata = [];\n\n\t\t\tconst context = {\n\t\t\t\tfieldSetName: e.detail.fieldSet,\n\t\t\t\tshouldBeDefault: false,\n\t\t\t\tobjectType: this.editorModel.constants.QUOTE_LINE,\n\t\t\t};\n\t\t\tresetColumnSizes(context);\n\t\t\tthis.buildLayout(null, /* isResetAction */ true); // rebuild the layout\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tfireEvent(Events.COL_WIDTHS_CHANGED, {layout: this.editorModel.layout});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Assigns 'hiddenGroup' class to groups that are not displayed in Single Group View.\n\t * Only the selected group gets flex:1 css property so that it fills the entire screen.\n\t * @param groupKey\n\t * @returns {}\n\t */\n\tgetGroupClass(groupKey) {\n\t\tif (!this.editorModel) {\n\t\t\treturn;\n\t\t}\n\t\tlet groupClass = '';\n\t\tif (this.selectedGroupKey != groupKey) {\n\t\t\tgroupClass += 'hiddenGroup';\n\t\t}\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tgroupClass += ' largeQuote';\n\t\t}\n\t\treturn groupClass;\n\t}\n\n\tgetContainerClass() {\n\t\treturn this.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\t}\n\n\ttoggle() {\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.closePanel();\n\t\t} else {\n\t\t\tthis.openPanel();\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tfireEvent(Events.GROUP_PANEL_TOGGLED, { drawerState: this.drawerState, groupKey: this.selectedGroupKey });\n\t\t});\n\t}\n\n\topenPanel() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.$.drawerPanel.style.left = '0px';\n\t\t\tthis.$.mainPanel.style.paddingLeft = '280px';\n\t\t} else {\n\t\t\tthis.$.drawerPanel.style.display = 'block';\n\t\t}\n\t\tthis.drawerState = 'open';\n\t}\n\n\tclosePanel() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.$.drawerPanel.style.left = '-256px';\n\t\t} else {\n\t\t\tthis.$.drawerPanel.style.display = 'none';\n\t\t}\n\t\tthis.$.mainPanel.style.paddingLeft = !this.isMobile && this.rightSideButton ? '24px' : '0px';\n\t\tthis.drawerState = 'closed';\n\t}\n\n\tgroupPanelCreated() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\tthis.buildLayout();\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tfireEvent(Events.COL_WIDTHS_CHANGED, { layout: this.editorModel.layout });\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\t/**\n\t * Catches groupAdded event fired from LECustoActionServices when a new group is added to the quote and navigates to the new group\n\t * @param e\n\t */\n\tgroupAdded(e) {\n\t\tthis.navTo(e);\n\t}\n\n\t/**\n\t * Catches groupDeleted event fired from LECustoActionServices when a group is deleted from the quote and navigates to the first group\n\t * @param e\n\t */\n\tgroupDeleted(e) {\n\t\tthis.navTo(e);\n\t}\n\n\t/**\n\t * Catches pageResized event from the line editor when quote details section is toggled. Fires 2 events:\n\t * iron-list-resized: to adjust for the height update on the page\n\t * sf-col-widths-changed: to adjust for the width update on the screen\n\t */\n\tpageResized(e) {\n\t\t// adjust columnWidths as total width on the screen might have changed with the full screen\n\t\tif (e.detail.isFullScreenToggleEvent) {\n\t\t\tthis.buildLayout();\n\t\t\tfireEvent(Events.COL_WIDTHS_CHANGED, { layout: this.editorModel.layout, groupKey: this.selectedGroupKey });\n\t\t}\n\t}\n\n\t/**\n\t * When a quote does not have segmented lines and column sizing is enabled, we fire an event to resize the column\n\t * widths to the widths of the standard Table\n\t */\n\tresizeColumnsOnLineItemDelete() {\n\t\tthis.buildLayout();\n\t\tfireEvent(Events.COL_WIDTHS_CHANGED, { layout: this.editorModel.layout });\n\t} \n\n\t/**\n\t * Returns true if any of the groups on the Quote has a segmented product\n\t * @param {Object} groupModels - GroupModel for all the Group on the Quote\n\t */\n\t_hasSegmentedProduct(groupModels) {\n\t\treturn groupModels.find((group) => group._groupHasSegmentedProducts()) !== undefined;\n\t}\n\n\t_groupModelsAreChangedObserver (editorModel, groupModels, rightSideButton) {\n\t\tif (editorModel === undefined || groupModels === undefined || rightSideButton === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._groupModelsAreChanged(editorModel, groupModels, rightSideButton);\n\t}\n\t\n\t_groupModelsAreChanged() {\n\t\t// Set default drawer state and position\n\t\tif (!this.drawerState) {\n\t\t\tthis.closePanel();\n\t\t} else if (this.drawerState == \"closed\") {\n\t\t\t// Necessary when adding or removing the second group\n\t\t\tthis.$.mainPanel.style.paddingLeft = !this.isMobile && this.rightSideButton ? '24px' : '0px';\n\t\t}\n\n\t\tthis.buildLayout();\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tif (!this.observersAttached)\n\t\t\t\tthis._attachObservers();\n\t\t});\n\t}\n\n\tbuildLayout(event = null, isResetAction = false) {\n\t\tif (this.isMobile) return;\n\t\tlet group = event ? event.detail.group : null;\n\t\tlet layout = {},\n\t\t\tmd = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],\n\t\t\tactionsOnTheLeft = this.editorModel.actionsOnTheLeft,\n\t\t\tmultiDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled,\n\t\t\thasLines = this.editorModel.quoteModel.quoteVO.lineItems.length > 0,\n\t\t\thasStandardDrawer = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0,\n\t\t\tcolumnMetadata = this.editorModel.columnMetadata,\n\t\t\tcolConstants = this.editorModel.constants.COLUMN_METADATA,\n\t\t\tisColumnResizingEnabled = AppContext.isColumnResizingEnabled;\n\n\t\tlayout.totalWidth = hasLines ? this._getMaxTableWidth(this._getAvailableWidth(), md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, isResetAction) : this._getAvailableWidth();\n\t\t// Update layout for a single group\n\t\tif (group) {\n\t\t\tgroup.colWidth = this._calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, group, hasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, isResetAction);\n\t\t} else {\n\t\t\tthis.editorModel.quoteModel.lineGroups.forEach((groupModel) => {\n\t\t\t\tgroupModel.colWidth = this._calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, groupModel, hasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, isResetAction);\n\t\t\t});\n\t\t\tthis.set('editorModel.layout', layout);\n\t\t}\n\t}\n\n\t_getAvailableWidth() {\n\t\tlet pageContainer = document.getElementById('sbPageContainer');\n\t\t// return early for tests to not fail as there is no pageContainer\n\t\tif (!pageContainer) return;\n\t\tlet availableWidth = Polymer.dom(pageContainer.root).querySelector('sb-line-editor').clientWidth;\n\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tavailableWidth -= 30 + 2; // group padding and borders\n\t\t\tif (this.editorModel.quoteModel.lineGroups.length > 1) {\n\t\t\t\tavailableWidth -= 24; //closed side panel width\n\t\t\t\tif (this.drawerState && this.drawerState == 'open') {\n\t\t\t\t\tavailableWidth -= 256; // expanded side panel width\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn availableWidth;\n\t}\n\n\t_getMaxTableWidth(availableWidth, md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, isResetAction) {\n\t\tconst newColumnMdSizesMap = get('columnSizes');\n\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, this._getQuoteStandardFields(), md, actionsOnTheLeft, multiDeleteEnabled,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, this.fieldSetName, newColumnMdSizesMap, STANDARD_DIM, isResetAction);\n\t\tthis.tableLayoutBuilder.build();\n\t\tlet maxWidth = this.tableLayoutBuilder.getTotalWidth();\n\t\t/**\n\t\t * There is an issue wherer this.editorModel.quoteModel.quoteVO.multiSegmentColumns might still \n\t\t * be stale when we delete a MDQ line. Therefore, we check the groupModel to see if there are \n\t\t * any MDQ products in the Quote. \n\t\t * If none, we don't count the deleted MDQ product's columns in our width calculations\n\t\t */\n\t\tconst cols = this._hasSegmentedProduct(this.groupModels) ? this.editorModel.quoteModel.quoteVO.multiSegmentColumns : [];\n\t\tlet multiSegmentFieldNames = this._getQuoteSegmentedFields();\n\t\tfor (let dimension in cols) {\n\t\t\tif (!cols.hasOwnProperty(dimension)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet fieldNames = multiSegmentFieldNames.concat(cols[dimension]).concat('total');\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, fieldNames, md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolumnMetadata, colConstants, isColumnResizingEnabled, this.fieldSetName, newColumnMdSizesMap, dimension, isResetAction);\n\t\t\tthis.tableLayoutBuilder.build();\n\t\t\tlet totalWidth = this.tableLayoutBuilder.getTotalWidth();\n\t\t\tif (totalWidth > maxWidth) {\n\t\t\t\tmaxWidth = totalWidth;\n\t\t\t}\n\t\t}\n\t\treturn maxWidth;\n\t}\n\n\t_calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, groupModel, hasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, isResetAction) {\n\t\tconst newColumnMdSizesMap = get('columnSizes');\n\t\tlet groupKey = groupModel.groupKey,\n\t\t\tcols = groupModel.quoteModel.grouped ? groupModel.groupVO.multiSegmentColumns : groupModel.quoteModel.quoteVO.multiSegmentColumns,\n\t\t\tgroupLayout = {};\n\t\t/**\n\t\t * There is an issue wherer this.editorModel.quoteModel.quoteVO.multiSegmentColumns might still \n\t\t * be stale when we delete a MDQ line. Therefore, we check the groupModel to see if there are \n\t\t * any MDQ products in the Quote. \n\t\t * If none, we don't count the deleted MDQ product's columns in our width calculations\n\t\t */\n\t\tif (!this._hasSegmentedProduct(this.groupModels)) {\n\t\t\tcols = [];\n\t\t}\n\t\t// Line Editor hard coded wont work if they use a custom quote line fs. Since we get back the fieldset they use\n\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getGroupStandardFields(groupKey), md, actionsOnTheLeft, multiDeleteEnabled,\n\t\t\thasStandardDrawer, columnMetadata, colConstants, isColumnResizingEnabled, this.fieldSetName, newColumnMdSizesMap, STANDARD_DIM, isResetAction);\n\t\tlayout.leftOffset = this.tableLayoutBuilder.getLeftOffset();\n\n\t\tgroupLayout['Standard'] = this.tableLayoutBuilder.build();\n\t\tthis._updateMaxWidth(layout, this.tableLayoutBuilder.getTotalWidth());\n\n\t\tfor (let dim in cols) {\n\t\t\tif (!cols.hasOwnProperty(dim)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getSegmentedFieldNames(groupModel, cols[dim]), md,\n\t\t\t\tactionsOnTheLeft, multiDeleteEnabled, false, columnMetadata, colConstants, isColumnResizingEnabled, this.fieldSetName, newColumnMdSizesMap, dim, isResetAction);\n\t\t\tgroupLayout[dim] = this.tableLayoutBuilder.build();\n\t\t\tthis._updateMaxWidth(layout, this.tableLayoutBuilder.getTotalWidth());\n\t\t}\n\t\treturn groupLayout;\n\t}\n\n\t/**\n\t * If total width changes from _getMaxTableWidth to _calculateGroupWidth,\n\t * layout the column sizes will be larger. So we need to update the layout totalWidth\n\t * to the correct width.\n\t * @param layout\n\t * @param width\n\t * @private\n\t */\n\t_updateMaxWidth(layout, width) {\n\t\tif (width > layout.totalWidth) {\n\t\t\tlayout.totalWidth = width;\n\t\t}\n\t}\n\n\t_getQuoteStandardFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].standardSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this._getStandardFields(subsScope);\n\t}\n\n\t_getGroupStandardFields(groupKey) {\n\t\tlet group = this.editorModel.quoteModel.groupsByKey[groupKey];\n\t\treturn this._getStandardFields(group.standardSubscriptionScopeEditable);\n\t}\n\n\t_getStandardFields(subsScope) {\n\t\tlet fieldSetKey = 'lineFieldNames';\n\t\tthis._updateFieldSetName(fieldSetKey);\n\t\tlet fields = this.editorModel.fieldsetMap[fieldSetKey];\n\t\tif (subsScope) {\n\t\t\tfields = [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields);\n\t\t}\n\t\treturn fields;\n\t}\n\n\t_getQuoteSegmentedFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups,\n\t\t\tfieldSetKey = 'multiSegmentLineSummaryFieldNames';\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].segmentedSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._updateFieldSetName(fieldSetKey);\n\t\tlet multiSegmentSummaryFieldNames = this.editorModel.data[fieldSetKey];\n\t\treturn subsScope ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(multiSegmentSummaryFieldNames) : multiSegmentSummaryFieldNames;\n\t}\n\n\t_getSegmentedFieldNames(groupModel, colNames) {\n\t\tlet fieldSetKey = 'multiSegmentLineSummaryFieldNames';\n\t\tthis._updateFieldSetName(fieldSetKey);\n\t\tlet summaryFields = this.editorModel.data[fieldSetKey],\n\t\t\tfieldNames = groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(summaryFields) : summaryFields.slice();\n\t\tfor (let i = 0, len = colNames.length; i < len; i++) {\n\t\t\tfieldNames.push(colNames[i].replace(/\\W/g, ''));\n\t\t}\n\t\tfieldNames.push('total');\n\t\treturn fieldNames;\n\t}\n\n\t_updateFieldSetName(fieldSetKey) {\n\t\tif (this.editorModel.fieldSetNames && this.editorModel.fieldSetNames[fieldSetKey]) {\n\t\t\tthis.fieldSetName = this.editorModel.fieldSetNames[fieldSetKey];\n\t\t} else {\n\t\t\tthis.fieldSetName = null;\n\t\t}\n\t}\n\n\t_attachObservers() {\n\t\tif (this.rightSideButton || (this.isMobile)) {\n\t\t\tthis.observersAttached = true;\n\t\t\t// Observe child nodes to see when a group is added or removed\n\t\t\tthis._observeNodes = Polymer.dom(this.$$('#groups')).observeNodes(function (info) {\n\t\t\t\tlet addedNodes = info.addedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\" && node.groupModel.groupVO.key == this.addedKey)\n\t\t\t\t}.bind(this));\n\t\t\t\tlet removedNodes = info.removedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\")\n\t\t\t\t});\n\t\t\t\tif (addedNodes[0] === removedNodes[0]) return;\n\t\t\t\tthis.processNewGroups(addedNodes);\n\t\t\t\tthis.processRemovedGroups(removedNodes);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tprocessNewGroups(addedNodes) {\n\t\tif (this.addedKey && addedNodes.length > 0) {\n\t\t\t// Only runs this code if add group is clicked\n\t\t\tlet groupKey = this.addedKey;\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.closePanel();\n\t\t\t}\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\tPolymer.dom(this.$$('#groups')).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t\tthis.addedKey = null;\n\t\t}\n\t}\n\n\tprocessRemovedGroups(removedNodes) {\n\t\tif (this.lastSelectedGroup && removedNodes.length == 1) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t\tthis.lastSelectedGroup = undefined;\n\t\t\tPolymer.dom(this.$$('#groups')).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t}\n\t}\n\n\ttoggleSelectedAndScroll(key) {\n\t\tlet groupElement = this.$$('#_' + key);\n\t\tif (this.lastSelectedGroup) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t}\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.toggleClass('selected-tab', true, groupElement);\n\t\t\tthis.lastSelectedGroup = groupElement;\n\t\t}\n\t\tif (!this.$$('#Group_' + key))\n\t\t\treturn;\n\t\tthis._scrollIntoView(this.$$('#Group_' + key));\n\t\tthis.$$('#_' + key).scrollIntoView(false);\n\t\tif (this.isMobile) {\n\t\t\tthis.$$('#Group_' + key).set('groupModel.groupExpanded', true);\n\t\t\tthis.$$('#Group_' + key).groupExpanded = true;\n\t\t}\n\t}\n\n\t_scrollIntoView(target) {\n\t\tthis.$$('#mainPanel').scrollTop = this.isMobile ? target.offsetTop : target.offsetTop - 15;\n\t}\n\n\tnavTo(e) {\n\t\te.stopPropagation();\n\n\t\tif (this.isMobile) {\n\t\t\tvar loadingSpinner = e.target.querySelector('.loadingSpinner');\n\t\t\tloadingSpinner.toggleClass('invisible', false);\n\t\t}\n\t\t\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tlet groupKey = e.detail.groupKey || Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\t// update selectedGroupKey for large quotes (Single Group VIew)\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tlet prevGroupKey = this.selectedGroupKey,\n\t\t\t\t\tcurrentGroupKey = parseInt(groupKey);\n\t\t\t\tthis.set('selectedGroupKey', currentGroupKey);\n\t\t\t\tif (currentGroupKey != prevGroupKey) {\n\t\t\t\t\tfireEvent(Events.GROUP_TOGGLED, {groupKey: this.selectedGroupKey});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.isMobile){\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tloadingSpinner.toggleClass('invisible', true);\n\t\t\t\t});\n\t\t\t\tthis.toggle();\n\t\t\t}\n\t\t});\n\t}\n\n\t_createDragDropModel() {\n\t\t// No editorModel means not mobile.\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet validTargets = new Set(['sb-droppable-sidePanelGroups']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'div', validTargets,\n\t\t\tthis.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\tonTrack(e) {\n\t\tif (this.isMobile || !AppContext.isDesktop || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tlet dd = this.dragDrop;\n\t\tdd.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tdd.dragIndex = dragElement.dataIndex;\n\t\tdd.dragGroupModel = this.groupModels[dd.dragIndex];\n\t\tlet groupLayout = this.$$('#groupLayout');\n\t\tthis.toggleAttribute('hidden', true, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = this.dragDrop._findSidePanelGroupValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.ref === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tdd.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\tdd.targetHost = this;\n\t\tdd.highlightableElements = [];\n\t\tdd.highlightableElements.push(dd.hoverOver.comp); // Get the exact element whose border can be highlighted based on path from hoverOver\n\t\tdd.usePlaceholder = true;\n\t\tdd.enableHighLight = false;\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dd = this.dragDrop;\n\t\tthis.toggleAttribute('hidden', false, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);   // Unhide the drag element\n\t\tif (!dropElement) {return;}     // Return early if dropElement does not exist\n\t\tlet sideGrp = this.$.sbDroppableSidePanelGroups;\n\t\tlet maxIndex = sideGrp.querySelectorAll('.nav-item').length - 1;\n\n\t\tdd.dropIndex = dropElement.dataIndex;\n\t\tif (dropElementBefore){\n\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t} else{\n\t\t\t++dd.dropIndex;\n\t\t}\n\n\t\tremoveTopBottomBorderClass(dropElement);    // Remove highlighting if any on the drop element\n\t\tthis.splice('groupModels', dd.dragIndex, 1);\n\t\tif (dd.dropIndex < maxIndex){\n\t\t\tthis.splice('groupModels', dd.dropIndex, 0, dd.dragGroupModel);\n\t\t} else {\n\t\t\tthis.push('groupModels', dd.dragGroupModel);\n\t\t}\n\n\t\tdd.lineEditor.renumber();\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tdd.lineEditor.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n\n\t/**\n\t * When right side button is open (showing the group switcher), we want to have a slightly wider size so that it works on iPad desktop mode as well (W-6766436)\n\t * @param rightSideButton\n\t * @returns {string}\n\t */\n\tcomputeDrawerPanelClass(rightSideButton) {\n\t\treturn rightSideButton ? 'open' : '';\n\t}\n}\n\nPolymer(LEGroupLayout);\n","import {registerComponent} from 'quotes/models/UiNotifier.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class LEList {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.EventBehavior];\n\t}\n\t\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list';\n\n\t\tthis.properties = {\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.COL_WIDTHS_CHANGED] = this.colWidthsChanged;\n\t\treturn e;\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this);\n\t\tsetTimeout(this._ironListResize.bind(this), 100);\n\t}\n\n\tready() {\n\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\tthis.ironList = this.$$('iron-list');\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.$$('iron-list').items.length + 10 - idx;\n\t}\n\n\t/**\n\t * LEGroupLayout.js has fired the 'sf-col-widths-changed' event, which means that the page has been resized\n\t * As a result, the iron-list needs to be resized as well - previously this done by StandardLines.js and SegmentedLines.js.\n\t */\n\tcolWidthsChanged() {\n\t\tthis._ironListResize();\n\t}\n\n\t_ironListResize() {\n\t\tthis.$$('iron-list').fire('iron-resize');\n\t}\n}\n\nPolymer( LEList );\n","export class LEListGroupFooterRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-group-footer-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object\n\t\t};\n\t}\n}\n\nPolymer( LEListGroupFooterRow );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class LEListGroupHeaderRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-group-header-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object, /* GroupModel */\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: Number,\n\t\t\tsubtotalMd: Object,\n\t\t\t/** Description, labeled value to interact properly with sb-field */\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_descriptionChanged'\n\t\t\t},\n\t\t\tdescriptionMd: Object,\n\t\t\tfavorited: Boolean,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\tisStandard: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(model)',\n\t\t\t'_groupCustomActionsChanged(editorModel.groupCustomActions)',\n\t\t\t'_groupRecordChanged(model.groupVO.record.*)'\n\t\t]\n\t}\n\n\t_showTabs(tabs) {\n\t\treturn tabs && tabs.length > 0;\n\t}\n\n\t_buildRow() {\n\t\tthis.editorModel = this.model.quoteModel.editorModel;\n\t\tthis.isStandard = this.model.lineType === 'Standard' && this.model.standardLines.length > 0; // Ensures no standard row header is built for empty group\n\n\t\tthis._setSubtotal();\n\t\tthis._setGroupDescription();\n\n\t\tif (this.isStandard) {\n\t\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\t\tthis.settings = this.editorModel.data.settings;\n\t\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\t\tthis._setFieldNames();\n\t\t\t// Column names is only populated when there are segmented lines\n\t\t\tthis.columnNames = null;\n\t\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\t\tthis.columnWidths = {};\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this.getFields();\n\t}\n\n\tgetFields() {\n\t\treturn this.model.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tthis.columnWidths = this.model.standardLineColumnWidths;\n\t}\n\n\tgetStandardColWidths() {\n\t\treturn this.editorModel.deviceContext.isMobile || !this.editorModel.layout ? undefined\n\t\t\t: this.model.colWidth.Standard;\n\t}\n\n\t_groupRecordChanged() {\n\t\tlet groupRecord = this.model.groupVO.record;\n\t\tthis.favorited = !!(groupRecord && groupRecord[this.editorModel.constants.FAVORITE_ID_FIELD]);\n\t}\n\n\t// Helper Functions\n\n\tshowGroupNameEditor(e) {\n\t\te.stopPropagation();\n\n\t\tthis.toggleClass('hidden', true, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', false, this.$$('#groupNameInput'));\n\t\tthis.$$('#groupNameInput').focus();\n\t\tthis.$$('#groupNameInput').setSelectionRange(0, this.model.groupVO.record.Name.length);\n\t}\n\n\tcheckInputValue(e) {\n\t\te.stopPropagation();\n\t\tif (e.target.value != \"\") {\n\t\t\tthis.set('model.groupVO.record.Name', e.target.value);\n\t\t}\n\t\tthis.toggleClass('hidden', false, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', true, this.$$('#groupNameInput'));\n\t}\n\n\tcloseGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (e.keyCode == '13') {\n\t\t\tthis.$$('#groupNameInput').blur();\n\t\t}\n\t}\n\n\ttriggerCustomAction(e) {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: e.currentTarget.attributes.eventHandlerName.value},\n\t\t\tmodel: this.model\n\t\t});\n\t}\n\n\t_setSubtotal() {\n\t\tif (!this.model.quoteModel.grouped) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet settings = this.editorModel.data.settings,\n\t\t\tpriceScale,\n\t\t\tsubtotal;\n\n\t\tlet subtotalField = settings.lineEditorGroupSubtotalsField;\n\t\t// Determine which Org Settings field to use for subtotals\n\t\tif (subtotalField == 'Default' || subtotalField == null) {\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.model.quoteModel.quoteVO.currencyDecimalScale : this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\tsubtotal = this.model.groupVO.record[this.editorModel.constants.NET_TOTAL_FIELD] || 0;\n\t\t} else { // Custom subtotals field\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.model.quoteModel.quoteVO.currencyDecimalScale : this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][subtotalField].scale;\n\t\t\tsubtotal = this.model.groupVO.record[settings.lineEditorGroupSubtotalsField] || 0; // If subtotalsField is not found, default to 0\n\t\t}\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.model.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.subtotal = subtotal;\n\t}\n\n\t_setGroupDescription() {\n\t\tif (!this.model.groupVO.record) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.value = this.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tif (this.model && this.editorModel.md) {\n\t\t\tlet groupObjMd = this.editorModel.md.fieldsMap[this.model.groupObjectName];\n\t\t\tthis.descriptionMd = groupObjMd[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\t}\n\t\tif (this.value) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If there is no description, give value a placeholder string\n\t\tthis.value = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t}\n\n\t_descriptionChanged() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tif (this.value !== description) {\n\t\t\tthis.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD] = this.value;\n\t\t}\n\t}\n\n\t_getRecordValue(fieldName) {\n\t\treturn this.model.groupVO.record[fieldName];\n\t}\n\n\t_groupCustomActionsChanged(e) {\n\t\tlet l = e ? e.length : 0;\n\t\tfor(let i = 0; i < l; i++)\n\t\t\tthis.notifyPath(`editorModel.groupCustomActions.${i}.children`);\n\t}\n}\n\nPolymer( LEListGroupHeaderRow );\n","import {registerComponent} from 'quotes/models/UiNotifier.js';\n\nconst factoryMap = {\n\tGroupModel: {\n\t\tGROUP_HEADER: \"sb-le-list-group-header-row\",\n\t\tGROUP_FOOTER: \"sb-le-list-group-footer-row\",\n\t},\n\tLineModel: {\n\t\tSTANDARD_LINE: \"sb-le-list-standard-line-row\",\n\t\tSEGMENTED_LINE: \"sb-le-list-segmented-line-row\",\n\t},\n}\n\nexport class LEListRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-row';\n\n\t\tthis.properties = {\n\t\t\trowType: String,\n\t\t\tmodel: Object,\n\t\t\tindex: Number,\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_dataChangedObserver(rowType, model, index)',\n\t\t]\n\t}\n\n\t_dataChangedObserver (rowType, model, index) {\n\t\tif (rowType === undefined || model === undefined || index === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._dataChanged(rowType, model, index);\n\t}\n\t\n\t_dataChanged(rowType, model, index) {\n\t\tconst wrapper = this.$.wrapper;\n\t\tconst targetName = factoryMap[model.constructor.name][rowType];\n\t\tconst currentEl = wrapper.children[0];\n\t\tlet targetEl = currentEl;\n\t\tif (currentEl && currentEl.localName === targetName) {\n\t\t\tcurrentEl.set('model', model);\n\t\t} else {\n\t\t\tif (currentEl) {\n\t\t\t\twrapper.removeChild(currentEl);\n\t\t\t}\n\t\t\ttargetEl = document.createElement(targetName);\n\t\t\ttargetEl.model = model;\n\t\t\ttargetEl.index = index;\n\t\t\twrapper.appendChild(targetEl);\n\t\t}\n\t\tregisterComponent(this);\n\t\tregisterComponent(targetEl);\n\t}\n}\n\nPolymer( LEListRow );\n","export class LEListSegmentedLineRow {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-segmented-line-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object\n\t\t};\n\t}\n\n}\n\nPolymer( LEListSegmentedLineRow );\n","export class LEListStandardLineRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-standard-line-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object, /* LineModel */\n\t\t\tindex: Number,\n\t\t};\n\t}\n}\n\nPolymer( LEListStandardLineRow );\n","import { Events } from 'common/core/Events.js';\n\n/**\n * A table row meant for displaying summary data.\n */\nexport class LESummaryRow {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-row';\n\t\tthis.properties = {\n\t\t\t// The model where all the data *should* belong.\n\t\t\tmodel: { type: Object, observer: '_modelChanged' },\n\n\t\t\t// The fields to display summaries for.\n\t\t\tfieldNames: Array,\n\n\t\t\t// The summaries for the table.\n\t\t\tsummaries: Object,\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.COL_WIDTHS_CHANGED] = this._colWidthsChanged;\n\t\treturn e;\n\t}\n\n\t_modelChanged(model) {\n\t\tthis.toggleClass('largeQuote', model.editorModel.largeQuoteExperienceEnabled, this.$.container);\n\t}\n\n\t_colWidthsChanged(e) {\n\t\tthis.notifyPath('model');\n\t}\n}\n\nPolymer( LESummaryRow );\n","import {setThenNotify} from 'quotes/models/UiNotifier.js';\n\nexport function getUnitAndDisplayValue(model, item) {\n\tif (isAdditionalDiscountField(model, item)) {\n\t\tconst units = model.editorModel.data.additionalDiscountUnitOptions;\n\t\tif (model.lineVO.targetCustomerAmount !== null && model.lineVO.targetCustomerAmount !== undefined) {\n\t\t\treturn { units, unit: 'UnitOverride', displayValue: model.getLineVOProperty('targetCustomerAmount') }\n\t\t} else if (model.lineVO.targetCustomerTotal !== null && model.lineVO.targetCustomerTotal !== undefined) {\n\t\t\treturn { units, unit: 'TotalOverride', displayValue: model.getLineVOProperty('targetCustomerTotal') }\n\t\t} else if (model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) != null) {\n\t\t\treturn { units, unit: 'Amount', displayValue: model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) }\n\t\t} else if (model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) != null) {\n\t\t\treturn { units, unit: 'Percent', displayValue: model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) }\n\t\t} else {\n\t\t\treturn { units, unit: model.editorModel.data.defaultAdditionalDiscountUnit.replace(/ /g,''), displayValue: null }\n\t\t\t}\n\t} else {\n\t\tconst units = model.editorModel.data.markupUnitOptions;\n\t\treturn model.getField(model.constants.MARKUP_AMOUNT_FIELD) != null\n\t\t\t? { units, unit: 'Amount', displayValue: model.getField(model.constants.MARKUP_AMOUNT_FIELD) }\n\t\t\t: model.getField(model.constants.MARKUP_RATE_FIELD) != null\n\t\t\t\t? { units, unit: 'Percent', displayValue: model.getField(model.constants.MARKUP_RATE_FIELD) }\n\t\t\t\t: { units, unit: model.editorModel.data.defaultMarkupUnit.replace(/ /g,''), displayValue: null }\n\t}\n}\n\nexport function updateUnitIfAmountInactive(model, fieldName) {\n\tlet { units, unit, displayValue } = getUnitAndDisplayValue(model, fieldName);\n\t// We need to see if amount is even activated as units\n\tif (model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) && !units.some((u) => u.value ==='Amount')) {\n\t\tlet nextActiveUnitValue = model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)\n\t\t&& units.some((u) => u.value === 'Percent')\n\t\t\t? 'Percent' : units[0].value;\n\n\t\tconvertDiscountValue(model, fieldName, nextActiveUnitValue);\n\t}\n}\n\nexport function setDiscountValue(model, item, value) {\n\tlet { unit, displayValue } = getUnitAndDisplayValue(model, item);\n\tconst record = model.lineVO.record;\n\tlet setAdditionalDiscountValues = () => {\n\t\tif (unit === 'Percent') {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = value;\n\t\t} else if (unit === 'Amount') {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = value;\n\t\t} else if (unit === 'UnitOverride') {\n\t\t\tmodel.lineVO.targetCustomerAmount = value;\n\t\t} else if (unit === 'TotalOverride') {\n\t\t\tmodel.lineVO.targetCustomerTotal = value;\n\t\t}\n\t\tdisplayValue = getUnproratedDiscount(model)/(model.lineVO.amountDiscountProrated ? record[model.constants.PRORATE_MULTIPLIER_FIELD] : 1);\n\t}\n\tlet setMarkupValues = () => {\n\t\tif (unit === 'Percent') {\n\t\t\trecord[model.constants.MARKUP_RATE_FIELD] = value;\n\t\t} else if (unit === 'Amount') {\n\t\t\trecord[model.constants.MARKUP_AMOUNT_FIELD] = value;\n\t\t}\n\t\tdisplayValue = record[model.constants.MARKUP_AMOUNT_FIELD] || (record[model.constants.UNIT_COST_FIELD] ? record[model.constants.UNIT_COST_FIELD] * value / 100 : null);\n\t}\n\n\tif (isAdditionalDiscountField(model, item)){\n\t\tsetAdditionalDiscountValues();\n\t} else {\n\t\tsetMarkupValues();\n\t}\n\n\t// if value is not a number, then simply set it to zero\n\tsetThenNotify(model, ['lineVO', 'record', model.constants.ADDITIONAL_DISCOUNT_FIELD], isNaN(displayValue) ? 0 : displayValue);\n}\n\nfunction getUnproratedDiscount(model) {\n\tlet price = model.getField(model.constants.REGULAR_PRICE_FIELD);\n\t// The raw discount is calculated directly from the relevant discount field, and may need to be changed to undo\n\t// proration effects\n\tlet rawDiscount;\n\t// Modifier is what we need to multiply the raw discount by to get the true discount. Under normal use cases, it should be 1,\n\t// but it can be other values if we need to un-prorate the discount\n\tlet modifier;\n\tif (model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)) {\n\t\trawDiscount = price * (model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) / 100);\n\t\t// Percent discounts don't give a hoot about proration, so there's no modifier\n\t\tmodifier = 1;\n\t} else if (model.lineVO.targetCustomerAmount) {\n\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t// For Unit Target Amount, the raw discount is calculated as the difference between the overridden price\n\t\t// and the regular price. As such, the multiplier is 1\n\t\trawDiscount = price - model.lineVO.targetCustomerAmount;\n\t\tmodifier = 1;\n\t} else if (model.lineVO.targetCustomerTotal) {\n\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t// For Total Target Amount, the raw discount is the difference between the overridden unit price and the regular price,\n\t\t// so the multiplier is 1\n\t\trawDiscount = price - (model.lineVO.targetCustomerTotal / getEffectiveQuantity(model));\n\t\tmodifier = 1;\n\t} else if (model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)) {\n\t\trawDiscount = model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD);\n\t\t// If amountDiscountProrated is active, then our multiplier is our ProrateMultiplier, otherwise it's 1\n\t\tmodifier = model.lineVO.amountDiscountProrated ? model.getField(model.constants.PRORATE_MULTIPLIER_FIELD) : 1;\n\t}\n\telse {\n\t\trawDiscount = 0;\n\t\tmodifier = 1;\n\t}\n\t// The adjusted discount is the actual difference between the regular unit price and the discounted price\n\treturn rawDiscount * modifier;\n}\n\nfunction getEffectiveQuantity(model) {\n\t// This method is duplicated from QuoteLineVO.cls\n\tconst record = model.lineVO.record;\n\tlet quantity = record[model.constants.QUANTITY_FIELD];\n\tlet priorQuantity = record[model.constants.PRIOR_QUANTITY_FIELD];\n\tlet actualQuantity = record[model.constants.EXISTING_FIELD] ? quantity - priorQuantity : quantity;\n\tif ((record[model.constants.PRICING_METHOD_FIELD] == 'Block' || record[model.constants.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab') && record[model.constants.EXISTING_FIELD] && priorQuantity != null && quantity - priorQuantity == 0) {\n\t\treturn 0;\n\t}\n\telse if ((record[model.constants.PRICING_METHOD_FIELD] == 'Block' || record[model.constants.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab')) {\n\t\treturn 1;\n\t}\n\telse if (record[model.constants.EXISTING_FIELD] && model.dynamicSubscription && record[model.constants.LIST_PRICE_FIELD] != 0 && actualQuantity == 0) {\n\t\treturn quantity;\n\t}\n\telse if (model.groupModel.quoteModel.quoteVO.record[model.constants.TYPE_FIELD] == 'Amendment' && !model.subscription && actualQuantity < 0) {\n\t\treturn 0;\n\t} else {\n\t\treturn actualQuantity;\n\t}\n}\n\nexport function convertDiscountValue(model, item, discountUnit) {\n\tconst { displayValue: previousDisplayValue } = getUnitAndDisplayValue(model, item);\n\tif (!discountUnit) {\n\t\treturn;\n\t}\n\tconst record = model.lineVO.record;\n\tlet changeAdditionalDiscountUnit = () => {\n\t\tlet price = record[model.constants.REGULAR_PRICE_FIELD];\n\t\tlet nullifyAll = () => {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\tif (model.lineVO.targetCustomerAmount || model.lineVO.targetCustomerAmount === 0) {\n\t\t\t\tmodel.lineVO.targetCustomerAmount = null;\n\t\t\t}\n\t\t\tif (model.lineVO.targetCustomerTotal || model.lineVO.targetCustomerTotal === 0) {\n\t\t\t\tmodel.lineVO.targetCustomerTotal = null;\n\t\t\t}\n\t\t};\n\n\t\tif (price === null || price === undefined)  {\n\t\t\tnullifyAll();\n\t\t\treturn;\n\t\t}\n\n\t\tlet unproratedDiscount = getUnproratedDiscount(model);\n\n\t\t// Null out all the discount fields so we don't end up with conflicts.\n\t\tnullifyAll();\n\n\t\t// Assign the discount to the selected unit field\n\t\tif (discountUnit == 'Percent') {\n\t\t\t// The discount percent isn't affected by proration\n\t\t\treturn record[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = (unproratedDiscount / price) * 100;\n\t\t} else if (discountUnit == 'Amount') {\n\t\t\t// Amount discount can be affected by proration, so we need to check that. If amountDiscount is prorated, then\n\t\t\t// we divide the discount by the prorate multiplier\n\t\t\tlet amountMultiplier = model.lineVO.amountDiscountProrated ? record[model.constants.PRORATE_MULTIPLIER_FIELD] : 1;\n\t\t\treturn record[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = unproratedDiscount / amountMultiplier;\n\t\t} else if (discountUnit == 'UnitOverride') {\n\t\t\t// Unit Override uses the unprorated discount\n\t\t\treturn model.lineVO.targetCustomerAmount = price - unproratedDiscount;\n\t\t} else if (discountUnit == 'TotalOverride') {\n\t\t\t// Total Override uses the unprorated discount for each unit\n\t\t\treturn model.lineVO.targetCustomerTotal = (price - unproratedDiscount) * getEffectiveQuantity(model);\n\t\t}\n\t};\n\tlet changeMarkupUnit = () => {\n\t\tlet cost = record[model.constants.UNIT_COST_FIELD];\n\t\tif (discountUnit === 'Percent') {\n\t\t\tlet markup = record[model.constants.MARKUP_AMOUNT_FIELD];\n\t\t\tif (markup == null) {\n\t\t\t\tmarkup = 0;\n\t\t\t}\n\t\t\trecord[model.constants.MARKUP_AMOUNT_FIELD] = null;\n\t\t\treturn record[model.constants.MARKUP_RATE_FIELD] = (cost != null) ? (markup / cost * 100) : null;\n\t\t} else {\n\t\t\tlet markup = record[model.constants.MARKUP_RATE_FIELD];\n\t\t\tif (markup == null) {\n\t\t\t\tmarkup = 0;\n\t\t\t}\n\t\t\trecord[model.constants.MARKUP_RATE_FIELD] = null;\n\t\t\treturn record[model.constants.MARKUP_AMOUNT_FIELD] = (cost != null) ? (cost * (markup / 100)) : null;\n\t\t}\n\t}\n\n\tconst displayValue = isAdditionalDiscountField(model, item) ? changeAdditionalDiscountUnit() : changeMarkupUnit();\n\tconst unit = discountUnit;\n\n\t// if display value is not a number, simply set it back to the previous display value\n\treturn { unit,\n\t\tdisplayValue: !isNaN(displayValue) ? displayValue\n\t\t\t: !isNaN(previousDisplayValue) ? previousDisplayValue\n\t\t\t: null\n\t};\n}\n\nexport function isAdditionalDiscountField(model, item) {\n\treturn item === model.constants.ADDITIONAL_DISCOUNT_FIELD;\n}\n","import {Localizer} from '../sb-le-table-cell/Localizer.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\nimport {QuoteLineUpgradeHandler} from '../sb-le-table-cell/QuoteLineUpgradeHandler.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport { isAdditionalDiscountField, getUnitAndDisplayValue } from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\n\nlet classNames = {\n\tICON: 'sf-icon-chevrondown',\n\tTOP_LEVEL: 'top-level',\n\tOPTION: 'option',\n\tINDENT: 'sbIndent',\n\tRIGHT: 'right',\n\tCENTER: 'center',\n\tOVERRIDDEN: 'overridden'\n}\n\n\nexport class LETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-cell';\n\n\t\tthis.properties = {\n\t\t\titem: String, /** required - field name */\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { /** optional - data to be bound by the sb-group component */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldClass: String,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tindex: Number,\n\t\t\tdetailsOnHover: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trenderTooltip: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\teditable: Boolean,\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\n\t_onTap() {\n\t\t// this event must exist to expand rows on Android devices\n\t}\n\n\tget observers() {\n\t\treturn ['_modelIsChangedObserver(model, index, viewport)',\n\t\t\t\t'_displayChanged(display)',\n\t\t\t\t'_dataOrValueChangedObserver(data, value, item)',\n\t\t\t\t'_updateOriginalValueObserver(model, item)',\n\t\t\t\t'_editableChangedObserver(editable, model, item)']; // TODO Why include model and item here?\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'tap': '_onTap',\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\t\tthis.scopeSubtree(this.$.field, true);\n\t\tif(this.wasModelIsChangedCalledBeforeAttached)\n\t\t\tthis._modelIsChanged();\n\n\t\tif (this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] && this.model.groupModel.quoteModel.isAmendmentOrChangeQuote && this.item === this.constants.QUANTITY_FIELD) {\n\t\t\t// Logic for automatic upgrade source quantity ratio enforcement lives in separate class UpgradeAssetQuantityCalculator\n\t\t\tthis.quoteLineUpgradeHandler = new QuoteLineUpgradeHandler(this.model);\n\t\t\tif (this.quoteLineUpgradeHandler.getSourceLineVO() && this.quoteLineUpgradeHandler.getUpgradeLineVO()) {\n\t\t\t\tthis.addEventListener('value-changed', this._quantityChanged);\n\t\t\t\tthis.assetUpgradeQuantityCalculator = new AssetUpgradeQuantityCalculator(this.quoteLineUpgradeHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Listeners\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker,\n\t\t\tdateRow       = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\t// W-4333506: when quote is grouped and large quote experience is off ensure datePicker table lines up with date table cell by skipping if block\n\t\tlet quoteModel = this.model.groupModel.quoteModel;\n\t\tif (!quoteModel.grouped && quoteModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\t\t}\n\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\n\t\t// We shouldn't stop propagation; however, not stopping it will cause the positions to be set, again\n\t\t// TODO: Find the source of the the positions being reset if propagation isn't stopped.\n\t\te.stopPropagation();\n\t}\n\n\t_modelIsChangedObserver (model, index, viewport) {\n\t\tif (model === undefined || index === undefined || viewport === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._modelIsChanged(model, index, viewport);\n\t}\n\t\n\t// Observers\n\t_modelIsChanged() {\n\t\t// cannot call this before attached because this method may change this.value if a discount field\n\t\t// and that change gets overwritten to the bound value by standard Polymer processing if done before this component is attached\n\t\tthis.wasModelIsChangedCalledBeforeAttached = !this.isAttached;\n\t\tif(!this.isAttached || !this.model)\n\t\t\treturn;\n\n\t\tif (this.item === this.constants.SUBSCRIPTION_SCOPE_FIELD && !this.model.subscriptionScopeEditable) {\n\t\t\tthis.fieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// TODO: Custom segments editor should render segment labels editable without breaking primary mobile columns in segmented detail row\n\n\t\t// primary class attaches to any cell rendered in main card in mobile (ie. Segment Label and Net Total)\n\t\tthis.overrideEditable = this.classList.contains('mdqSummaryRow') || this.classList.contains('primary');\n\t\tlet editable = this._setEditable();\n\n\t\tlet fieldMD = this._setFieldMD();\n\t\tif (this._setFieldClassAndFieldContent(fieldMD))\n\t\t\treturn;\n\n\t\tif (fieldMD.defaultValue && this.value == null && !(fieldMD.controllingPicklist || fieldMD.dependentPicklist))\n\t\t\tthis.value = fieldMD.defaultValue;\n\n\t\t// Use case: Quote Subscription Term change calls updateQuote and creates new models\n\t\t// The usual JSQCNotifier isn't ran in this case so fields are never updated\n\t\tif (this.data && this.value != this.data[this.item]) {\n\t\t\tthis.value = this.data[this.item];\n\t\t}\n\n\t\tif (this.value === undefined) {\n\t\t\tthis.value = null;\n\t\t}\n\n\t\tthis.label = fieldMD.label;\n\t\tthis.$.field.editing = editable;\n\t\tthis.$.field.md = fieldMD;\n\t\tthis.$.field.property = this.item;\n\n\t\tif(this.model.segmented && !(/__c$/.test(this.item)) && (this.item != 'total')) {\n\t\t\t// Remove event listeners first to ensure there are no duplicates when this method is called\n\t\t\tthis.removeEventListener('mouseenter', this._showDetails);\n\t\t\tthis.removeEventListener('mouseleave', this._showDetails);\n\t\t\tthis.renderTooltip = true;\n\t\t\tthis.addEventListener('mouseenter', this._showDetails);\n\t\t\tthis.addEventListener('mouseleave', this._showDetails);\n\t\t}\n\t}\n\n\t_updateOriginalValueObserver (model, item) {\n\t\tif (model === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateOriginalValue(model, item);\n\t}\n\t\n\t_updateOriginalValue() {\n\t\t// Avoids data marked as dirty when front end operation (i.e. delete lines, sort lines, etc) from displaying dirty when they shouldn't be\n\t\tif (this.model.lineVO)\n\t\t\tthis.model.lineVO.ui_original_record = this.model.lineVO.ui_original_record || JSON.parse(JSON.stringify(this.model.lineVO.record));\n\t\tconst originalRecord = this.get('model.lineVO.ui_original_record');\n\t\t// Setting originalValue will trigger observer in Field.js which updates its originalFormattedValue for dirty check\n\t\t// In case this.item is additional discount field we must divide by quantity to ensure that dirty check in Field.js works correctly\n\t\tthis.$.field.originalValue = originalRecord[this.item];\n\t}\n\n\t_dataOrValueChangedObserver (data, value, item) {\n\t\tif (data === undefined || value === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._dataOrValueChanged(data, value, item);\n\t}\n\t\n\t_dataOrValueChanged(data, value, item) {\n\t\t// Make sure these match, group.js will update data first and trigger this before value has been updated\n\t\t// This will ensure the following logic is ran once with the correct information\n\t\tif (value != data[item])\n\t\t\treturn;\n\n\t\tthis.internal = true;\n\t\tif (this.userChangedLookupValue) { // Update __r field on data so it persists on navigation or sort\n\t\t\tthis._updateRelationshipName();\n\t\t} else { // Update formatted display value\n\t\t\tthis._updateLookupDisplayValue();\n\t\t}\n\n\t\tthis.$.field.value = this.model && isAdditionalDiscountField(this.model, item)\n\t\t\t? getUnitAndDisplayValue(this.model, item).displayValue\n\t\t\t: value;\n\t\tthis.internal = false;\n\t\tthis.userChangedLookupValue = false;\n\t}\n\n\t_updateRelationshipName() {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.model.getFieldMD(this.item).referenceTo[0]);\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship()) {\n\t\t\tthis.display = rfm.getRelationshipName();\n\t\t} else { // Re-evalulate display so rows without a lookup value don't inherit incorrect display when sorting\n\t\t\tthis.display = undefined;\n\t\t}\n\t}\n\n\t_displayChanged() {\n\t\tthis.userChangedLookupValue = !this.internal;\n\t}\n\n\t_setEditable() {\n\t\treturn this.overrideEditable ? false : this.model.isEditable(this.item);\n\t}\n\n\t_editableChangedObserver (editable, model, item) {\n\t\tif (editable === undefined || model === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._editableChanged(editable, model, item);\n\t}\n\t\n\t_editableChanged() {\n\t\tthis.$.field.editing = this.overrideEditable ? false : this.model.isEditable(this.item);\n\t}\n\n\t_setFieldMD() {\n\t\t// substitute Net Total field metadata in case a segment label is passed into sb-field instead of a field label (ie. SBQQ__ProductName__c)\n\t\tlet fieldMD = this.model.getFieldMD(this.item) ? this.model.getFieldMD(this.item) : this.model.getFieldMD(this.constants.NET_TOTAL_FIELD);\n\t\tfieldMD.CurrencyIsoCode = this.model.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\t// Applying quantity scale to quantity fields in order of priority (product qs -> package settings qs -> default field qs)\n\t\tif (this.constants.QUANTITY_FIELDS && this.constants.QUANTITY_FIELDS.has(this.item)) {\n\t\t\tif (this.model.lineVO.productQuantityScale != null) {\n\t\t\t\tfieldMD = Object.assign({}, fieldMD, {scale: this.model.lineVO.productQuantityScale});\n\t\t\t}\n\t\t}\n\t\treturn fieldMD;\n\t}\n\n\t/**\n\t * Sets class and content of the field container.\n\t * @param {Object} fieldMD MD of the field to determine text-alignment\n\t * @return {Boolean} returns true if the field is overriden and should not continue to set sb-field properties\n\t */\n\t_setFieldClassAndFieldContent(fieldMD) {\n\t\tlet fieldClass = '';\n\t\tif (this.model.editorModel.data.settings.productHierarchyVisualized && !this.model.segmented) {\n\t\t\tif (!this.isMobile) {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD) {\n\t\t\t\t\tif (this.model.isBundle) {\n\t\t\t\t\t\tfieldClass += `${classNames.ICON} `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.model.component) {\n\t\t\t\t\t\t\tfieldClass += `${classNames.TOP_LEVEL} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.model.component) {\n\t\t\t\t\t\tif (!this.model.isBundle) {\n\t\t\t\t\t\t\tfieldClass += `${classNames.OPTION} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfieldClass += `${classNames.INDENT}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD || this.item === this.constants.NET_TOTAL_FIELD) {\n\t\t\t\t\tfieldClass += `${classNames.INDENT}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._isSegmentedDrawer() || (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency')) {\n\t\t\tfieldClass += ` ${classNames.RIGHT}`;\n\t\t\tif (this.classList.contains('drawerCell'))\n\t\t\t\tthis._togglePreventNumericAlignment();\n\n\t\t\tif (this._isSegmentedDrawer())\n\t\t\t\tthis._toggleSegmentedAlignment();\n\t\t}\n\n\n\t\tif (!this._isSegmentedDrawer() && fieldMD.type === 'boolean') {\n\t\t\tfieldClass += ` ${classNames.CENTER}`;\n\t\t}\n\n\t\tif (this.model.bundled && this.item === this.constants.LIST_PRICE_FIELD) {\n\t\t\tthis.overrideValue = AppContext.properties.i18n.value().l('Included');\n\t\t\tfieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tlet localizedValue = Localizer.getLocalizedValue(this.model, this.item);\n\t\tif (localizedValue) {\n\t\t\tthis.overrideValue = localizedValue;\n\t\t\tfieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tthis.fieldClass = fieldClass;\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Used to align table cell value to ensure pencil or lock icon show up on correct side of cell field value,\n\t * relevant primarily for LEDrawer components\n\t */\n\t_togglePreventNumericAlignment() {\n\t\tthis.$.field.preventNumericAlignment = !this.$.field.preventNumericAlignment;\n\t}\n\n\t_toggleSegmentedAlignment() {\n\t\tthis.$.field.segmentedAlignment = true;\n\t}\n\n\t_isSegmentedDrawer() {\n\t\treturn this.model.itemClassMap.attributes === 'mdqSummaryRow' && !this.classList.contains('mdqSummaryRow');\n\t}\n\n\t/**\n\t * Invoked on the 'value-changed' event for automatic upgrade source quantity ratio enforcement\n\t * Fires 'upgarde-asset-quantity-changed' with index of line that needs its quantity re-rendered based upon change to target line. Listened for in LEGroup.js\n\t * @param {object} e - event object\n\t */\n\t_quantityChanged(e) {\n\t\tif (this.model.internalUpdate) {\n\t\t\treturn;\n\t\t}\n\t\tthis.assetUpgradeQuantityCalculator.setQuantitiesByRatio();\n\t\tlet indexes = this.quoteLineUpgradeHandler.getIndexes();\n\n\t\tlet sourceLineVO = this.quoteLineUpgradeHandler.getSourceLineVO();\n\t\tlet upgradeLineVO = this.quoteLineUpgradeHandler.getUpgradeLineVO();\n\n\t\t// index is the position in standardLines array that the line which needs its quantity to be updated based upon the change to the target line\n\t\tthis.fire('upgrade-asset-quantity-changed', {\n\t\t\tsourceIndex: indexes[\"sourceIndex\"],\n\t\t\tupgradeIndex: indexes[\"upgradeIndex\"],\n\t\t\tsourceLineVO: sourceLineVO,\n\t\t\tupgradeLineVO: upgradeLineVO\n\t\t});\n\t}\n\n\t_handleFieldValueChanged(e) {\n\t\tif (!e.detail.suppressImmediateCalculation && this.calculateImmediately) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t\t//fire events based on the changed item\n\t\tlet data = { value: this.item };\n\t\tthis.fire('field-updated', data);\n\t}\n\n\t_showDetails(e) {\n\t\tlet type = e.type;\n\t\tthis.detailsOnHover = type == 'mouseenter';\n\t}\n\n\t_getLineModel() {\n\t\tif ( this.item != 'total' && this.model.segmentsByLabel != null ) {\n\t\t\tlet lineModelKeys = Object.keys(this.model.segmentsByLabel);\n\t\t\tlet lineModelKeysLength = lineModelKeys.length;\n\t\t\tfor (let i = 0; i < lineModelKeysLength; i++ ) {\n\t\t\t\t// Need to take out the white space from the lineModelkeys\n\t\t\t\tlet key = lineModelKeys[i].replace(/\\W/g, '');\n\t\t\t\tif ( key == this.item ) {\n\t\t\t\t\treturn this.model.segmentsByLabel[lineModelKeys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.model;\n\t}\n\n\t_getRecord() {\n\t\treturn this._getLineModel().lineVO.record;\n\t}\n\n\t// Getters\n\tget constants() {\n\t\treturn this.model.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.model.lineVO.record;\n\t}\n\n\tset record(val) {\n\t\tthis.model.lineVO.record = val;\n\t}\n}\n\nPolymer( LETableCell );\n","export class Localizer {\n\n\t/**\n\t * Retrives the localized value of a field if it exists.\n\t * @return {String} - Localized value if it exists.\n\t */\n\tstatic getLocalizedValue(model, item, lookupNameField) {\n\t\tlet constants = model.editorModel.constants;\n\t\tlet productLocalization = model.groupModel.quoteModel.quoteVO.localizationByFieldByProductId[model.getField(constants.PRODUCT)];\n\t\tlet fieldMD = model.getFieldMD(item);\n\t\tif (!productLocalization || !fieldMD) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prefix = model.editorModel.data.developerPrefix;\n\t\tlet fieldName = (fieldMD && fieldMD.calculatedFormula && fieldMD.calculatedFormula.indexOf(`${prefix}Product__r`) === 0) ? fieldMD.calculatedFormula.split('.')[1].replace(prefix, '') : fieldMD.name;\n\n\t\tlet productFieldLocalization = lookupNameField ? productLocalization[fieldName][lookupNameField] : productLocalization[fieldName];\n\t\tif (!productFieldLocalization) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn productFieldLocalization.record[constants.TEXT_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.LONG_TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.RICH_TEXT_AREA_FIELD];\n\t}\n\n}\n\n\n","export class QuoteLineUpgradeHandler {\n\n\tconstructor(model) {\n\t\tthis.model = model;\n\t\tthis.indexes = {};\n\t}\n\n\tisSourceLine() {\n\t\treturn this.model.existing;\n\t}\n\n\tgetLine() {\n\t\treturn this.model.lineVO;\n\t}\n\n\tgetLines() {\n\t\treturn this.model.groupModel.standardLines;\n\t}\n\n\t/**\n\t * Takes into account bundleKeptTogether setting in case source or upgrade option is moved from one group to another\n\t * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line\n\t * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n\t */\n\tgetSourceOrUpgrade(source) {\n\t\tlet sourceOrUpgradeLineVO;\n\t\tif (this.model.editorModel.data.settings.bundleKeptTogether) {\n\t\t\tsourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, this.model.groupModel);\n\t\t} else {\n\t\t\tlet groups = this.model.groupModel.quoteModel.lineGroups;\n\t\t\tfor (let i = 0, groupCount = groups.length; i < groupCount; i++) {\n\t\t\t\tif (sourceOrUpgradeLineVO) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, groups[i]);\n\t\t\t}\n\t\t}\n\t\treturn sourceOrUpgradeLineVO;\n\t}\n\n\t/**\n\t * Sets the index that will be sent to LEGroup.js for the correct lineVO's quantity that should be re-rendered\n\t * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line, if null should be set to source\n\t * @param {groupModel} group - ensures that bundleKeptTogether setting works for source and upgrade options that will be moved from one group to another\n\t * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n\t */\n\t_findLineWithTargetAssetId(source, group) {\n\t\tlet seekExistingLine = source ? false : true;\n\t\tlet lineVO; // Either the source or the target lineVO (the opposite of the one that is updated by the user)\n\t\tlet targetAssetId = this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD];\n\n\t\tfor (let i = 0, lineCount = group.standardLines.length; i < lineCount; i++) {\n\t\t\tlet line = group.standardLines[i];\n\t\t\tif (line.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] === targetAssetId && line.lineVO.record[this.constants.EXISTING_FIELD] === seekExistingLine) {\n\t\t\t\tlet key = seekExistingLine ? \"sourceIndex\" : \"upgradeIndex\";\n\t\t\t\tthis.indexes[key] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n\t\t\t\tlineVO = line.lineVO;\n\t\t\t}\n\t\t\tif (this.model.lineVO.key === line.lineVO.key) {\n\t\t\t\tlet key2 = (!this.indexes[\"sourceIndex\"] && this.model.existing) ? \"sourceIndex\" : \"upgradeIndex\";\n\t\t\t\tthis.indexes[key2] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n\t\t\t}\n\t\t}\n\t\treturn lineVO;\n\t}\n\n\tsetSourceAndUpgrade(sourceLineVO, upgradeLineVO) {\n\t\tthis.sourceLineVO = sourceLineVO;\n\t\tthis.upgradeLineVO = upgradeLineVO;\n\t}\n\n\tgetSourceIdField() {\n\t\treturn this.constants.PRODUCT;\n\t}\n\n\tgetUpgradeConversionRateField() {\n\t\treturn this.constants.UPGRADE_CONVERSION_RATE;\n\t}\n\n\tgetSourceCurrentQuantityField(sourceLineVO) {\n\t\treturn sourceLineVO.record[this.constants.QUANTITY_FIELD];\n\t}\n\n\tgetUpgradeCurrentQuantityField(upgradeLineVO) {\n\t\treturn upgradeLineVO.record[this.constants.QUANTITY_FIELD];\n\t}\n\n\tgetSourcePriorQuantity(sourceLineVO) {\n\t\treturn sourceLineVO.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t}\n\n\tdidSourceQuantityChange(didUserChangeSourceLine) {\n\t\treturn didUserChangeSourceLine;\n\t}\n\n\tdidUpgradeQuantityChange(didUserChangeSourceLine) {\n\t\treturn !didUserChangeSourceLine;\n\t}\n\n\tisSelected() {\n\t\treturn true;\n\t}\n\n\tsetUpdatedQuantity(sourceLineVO, upgradeLineVO, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n\t\tsourceLineVO.record[this.constants.QUANTITY_FIELD] = sourceQtyAfterUpdate;\n\t\tupgradeLineVO.record[this.constants.QUANTITY_FIELD] = upgradeQtyAfterUpdate;\n\t}\n\n\tgetIndexes() {\n\t\treturn this.indexes;\n\t}\n\n\tgetSourceLineVO() {\n\t\treturn this.sourceLineVO;\n\t}\n\n\tgetUpgradeLineVO() {\n\t\treturn this.upgradeLineVO;\n\t}\n\n\t// Getters\n\tget constants() {\n\t\treturn this.model.fieldNames;\n\t}\n}\n","const SWIPE_DISTANCE = 75;\nconst OPEN_DISTANCE = -185; // Must be in sync with sb-group.less .swipe{left}\nconst SWIPE_MARGIN = 50; // Must be in sync with sb-group.less .swipe{left}\nlet swiping = false;\n\nexport class Swiper {\n\tconstructor(cell) {\n\t\tthis.cell = cell;\n\t\tthis.primaryCells = cell.parentElement.querySelectorAll('.primary');\n\t}\n\n\t/**\n\t * Mobile swipe action\n\t * @param  {object} detail - event detail\n\t */\n\tswipe(detail) {\n\t\tif (!this.leTableRow)\n\t\t\tthis.leTableRow = this.cell.domHost.domHost;\n\t\tlet open = this.cell.classList.contains('open'); /** mobile state that determines if the line item has been swiped opened to access line actions */\n\n\t\tswitch( detail.state ) {\n\t\t\tcase 'start':\n\t\t\t\tif (Math.abs(detail.dy) > SWIPE_MARGIN || ((!open && detail.dx > 0) || (open && detail.dx < 0)))\n\t\t\t\t\treturn;\n\t\t\t\tswiping = true;\n\t\t\t\tthis.leTableRow.classFollows('open', null, this.leTableRow.$$('.tr'));\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.position = 'relative';\n\t\t\t\tbreak;\n\t\t\tcase 'track':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.left = `${(open ? OPEN_DISTANCE : 0) + detail.dx}px`;\n\t\t\t\tbreak;\n\t\t\tcase 'end':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tswiping = false;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < this.primaryCells.length; i++) {\n\t\t\t\t\tthis.primaryCells[i].style.left = '';\n\t\t\t\t\tthis.primaryCells[i].style.position = '';\n\t\t\t\t\tif (detail.dx < -SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', this.primaryCells[i]);\n\t\t\t\t\t\topen = true;\n\t\t\t\t\t} else if (detail.dx > SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', null, this.primaryCells[i]);\n\t\t\t\t\t\topen = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (open)\n\t\t\t\t\tthis.leTableRow.classFollows('open', this.leTableRow.$$('.tr'));\n\t\t}\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {setThenNotify} from 'quotes/models/UiNotifier.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class LETableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header';\n\t\tthis.properties = {\n\t\t\tlineModels: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tfieldClasses: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconstants: Object,\n\t\t\tfields: Object,\n\t\t\tsettings: Object,\n\t\t\tactionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false,\n\t\t\t\tcomputed: '_getActionsPlacement(settings)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.DESELECT_CHECKBOX] = this.deselectCheckbox;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRowsObserver(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t]\n\t}\n\n\t_getActionsPlacement() {\n\t\treturn this.settings.actionsColumnPlacement == 'Left';\n\t}\n\n\t_buildRowsObserver (fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings) {\n\t\tif (fieldNames === undefined || columnNames === undefined || fieldLabelsMap === undefined || fields === undefined ||\n\t\t\t constants === undefined || columnWidths === undefined || settings === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._buildRows(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings);\n\t}\n\t\n\t/**\n\t * Loops through field and column names and updates group array for both standard and segmented table header row\n\t * @private\n\t */\n\t_buildRows() {\n\t\tlet group = [],\n\t\t\tfieldsRenderedAsNumber = {};\n\n\t\t// loop through standard line field names to update group and identify the fields that are rendered as number\n\t\tfor (let i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\tgroup.push(fieldName);\n\n\t\t\t// create a map of field labels to indicate the fields that are rendered as number - for styling purposes on the cell level\n\t\t\tlet fieldMD = this.fields[fieldName];\n\t\t\tif (fieldMD && (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency')) {\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[fieldName]] = true;\n\t\t\t} else if (fieldMD && fieldMD.type == 'boolean') {\n\t\t\t\tthis.fieldClasses[fieldMD.name] = 'center';\n\t\t\t}\n\t\t}\n\n\t\t// loop through column names (there are column names only when the quote/group has segmented lines) to update group and identify the fields that are rendered as number\n\t\tif (this.columnNames) {\n\t\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\t\tgroup.push(columnName);\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[columnName]] = true;\n\t\t\t}\n\t\t\t// TODO: Localize this string\n\t\t\tgroup.push('total');\n\t\t\tthis.fieldClasses[this.constants.SEGMENT_LABEL_FIELD] = 'hiddenInMobile';\n\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap['total']] = true;\n\t\t}\n\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\t\tif (this.header && this.header.group.length != group.length) {\n\t\t\tthis.header.destroyGroup();\n\t\t}\n\n\t\t// model needs to be assigned before the group; otherwise the model will not be attached to the elements sb-group creates\n\t\tthis.header = this.$.header;\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.header.model = fieldsRenderedAsNumber;\n\t\tthis.header.model.isStandard = !(this.columnNames && this.columnNames.length > 0);\n\t\tthis.header.model.settings = this.settings;\n\t\tthis.header.itemClassMap = this.fieldClasses;\n\t\tthis.header.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.header.columnWidths = this.columnWidths;\n\t\tif(!this.header.group) // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\t\tthis.header.group = group;\n\t\tthis.data = this.fieldLabelsMap;\n\n\t\tthis.displayDrawerIcon = this.editorModel && this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0 && !this.columnNames;\n\n\t\tif (this.columnNames) {\n\t\t\tthis.expansionIconClass = 'sf-icon-right';\n\t\t}\n\t\tif (this.displayDrawerIcon) {\n\t\t\tthis.lineItemDrawerIconClass = 'sf-icon-chevronright';\n\t\t}\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.header || this.viewport && this.viewport.isMobile()) return;\n\t\tthis.header.columnWidths = this.columnWidths;\n\t}\n\n\t/**\n\t * Expands all lines in the table to display segment details or the standard line item drawer\n\t */\n\ttoggleAllLinesExpansion() {\n\t\tif (this.columnNames) {\n\t\t\tlet expanded = this.expansionIconClass != 'sf-icon-right';\n\t\t\tthis.expansionIconClass = !expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\t\tthis.set('lineModels.' + i + '.lineVO.expanded', !expanded);\n\t\t\t\tthis.set('lineModels.' + i + '.expandedIconClass', this.expansionIconClass);\n\t\t\t}\n\t\t} else if (this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0) {\n\t\t\tlet expanded = this.lineItemDrawerIconClass != 'sf-icon-chevronright';\n\t\t\tthis.lineItemDrawerIconClass = !expanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright';\n\t\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\t\tthis.set('lineModels.' + i + '.lineVO.expanded', !expanded);\n\t\t\t\tthis.set('lineModels.' + i + '.lineItemDrawerIconClass', this.lineItemDrawerIconClass);\n\t\t\t}\n\n\t\t}\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.fire('line-toggled', {index: null});\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of each line in this table in order to toggle the \"checked\" state of each line item\n\t */\n\ttoggleAllCheckBoxes() {\n\t\tfor (let i = 0; i < this.lineModels.length; i++) {\n\t\t\tsetThenNotify(this.lineModels[i], ['selected'], this.selected);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of the multi delete checkbox to false after action that causes updateQuote to run in LineEditor.js\n\t */\n\tdeselectCheckbox() {\n\t\tthis.set('selected', false);\n\t}\n}\n\nPolymer( LETableHeader );","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\nexport class LETableHeaderCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header-cell';\n\t\tthis.properties = {\n\t\t\tbyOrder: String,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tshowSortableHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showSortableHeader(model)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tthis.constants = new Constants(AppContext.org.prefix + '__');\n\t\t\t\t\treturn AppContext.org.prefix;\n\t\t\t\t}\n\t\t\t},\n\t\t\toverflowTrue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\t_modelChanged() {\n\t\tPolymer.dom(this.$.headerCell).observeNodes(function() {\n\t\t\tlet headerNode = this.$$('#header');\n\t\t\tthis.toggleClass('right', this.model[this.value], headerNode);\n\t\t\tlet bundlesVisualized = (this.model.settings && this.model.settings.productHierarchyVisualized && this.model.isStandard && this.getAttribute('item') === this.constants.PRODUCT_NAME_FIELD);\n\t\t\tthis.toggleClass('bundlesVisualized', bundlesVisualized, headerNode);\n\t\t}.bind(this));\n\t}\n\n\tsortLines(e) {\n\t\tlet newSort = \"\";\n\n\t\tlet headers = this.parentElement.children;\n\n\t\tfor(let i = 0; i < headers.length; i++) {\n\t\t\theaders[i].toggleClass('asc', false, headers[i].$$('#header'));\n\t\t\theaders[i].toggleClass('desc', false, headers[i].$$('#header'));\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowup', true, headers[i].$$('#arrow')) : null;\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowdown', false, headers[i].$$('#arrow')) : null;\n\t\t\tPolymer.dom(headers[i]).classList.remove('column-selected');\n\t\t}\n\n\t\tif (!this.byOrder){\n\t\t\tnewSort = 'asc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'asc'){\n\t\t\tnewSort = 'desc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', false, this.$$('#arrow'));\n\t\t\tthis.toggleClass('sf-icon-arrowdown', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'desc') {\n\t\t\tnewSort = '';\n\t\t}\n\n\t\tthis.sortByField = newSort ? this._getKeyByValue(this.value, this.data) : null;\n\t\tthis.toggleClass('column-selected', newSort);\n\t\tthis.byOrder = newSort;\n\t\tif (newSort){\n\t\t\tthis.toggleClass(newSort, true, this.$$('#header'));\n\t\t}\n\t\tthis.fire('table-header-sort-clicked', {order: this.byOrder, field: this.sortByField});\n\t}\n\n\t_showSortableHeader() {\n\t\t//Make sure segmented line detail and 'Additional Disc.' field headers are not sortable.\n\t\tif (this.model.lineVO || this.getAttribute('item') === this.constants.ADDITIONAL_DISCOUNT_FIELD || this.classList.contains('hoverFieldHeader')) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t_getKeyByValue(value, object) {\n\t\tfor(let prop in object ) {\n\t\t\tif( object.hasOwnProperty( prop ) ) {\n\t\t\t\tif( object[ prop ] === value )\n\t\t\t\t\treturn prop;\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( LETableHeaderCell );","import {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from '../../../common/core/AppContext.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class LETableRow {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped',\n\t\t\t'field-updated' : 'handleFieldValueChanged'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tdata: Object,\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tcolumnNames: Array,\n\t\t\tcolumnWidths: Object,\n\t\t\tmobileCols: Array,\n\t\t\tlineNumber: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t},\n\t\t\tisDesktopAndHasNoActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisDesktopAndHasActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmdqFields: {\n\t\t\t\ttype: Set,\n\t\t\t\tvalue: new Set()\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowCheckbox: Boolean,\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.GROUP_PANEL_TOGGLED] = this._toggleSelection;\n\t\te[Events.TOGGLE_OPTIONAL_CLICKED] = this.toggleOptional;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRowObserver(fieldNames, columnNames, lineModel, columnWidths, viewport, dataIndex)',\n\t\t\t'_lineRecordChanged(lineModel.*)',\n\t\t\t'_columnWidthsChanged(columnWidths)',\n\t\t\t'_expanded(expanded)',\n\t\t\t'_toggleSelectionObserver(lineModel, expandDisabled)'];\n\t}\n\n\tattached() {\n\t\tif (!this.isMobile) {\n\t\t\tlet ironList;\n\t\t\t// We pass in an ironList to this component when Multi Group View is enabled\n\t\t\tif (this.ironList) {\n\t\t\t\tironList = this.ironList;\n\t\t\t} else if (this.lineModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tironList = this.domHost.$$('iron-list');\n\t\t\t} else {\n\t\t\t\tironList = null;\n\t\t\t}\n\t\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', 'sb-le-table-cell', 'root', this.dataIndex, 'data-index', ironList);\n\t\t\tthis.signaler.signalOnFocus('sb-row-focus-signal');\n\t\t}\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.expandDisabled = e.detail.isOpen;\n\t}\n\n\t_buildRowObserver (fieldNames, columnNames, lineModel, columnWidths, viewport, dataIndex) {\n\t\tif (fieldNames === undefined || columnNames === undefined || lineModel === undefined || columnWidths === undefined ||\n\t\t\t viewport === undefined || dataIndex === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._buildRow(fieldNames, columnNames, lineModel, columnWidths, viewport, dataIndex);\n\t}\n\t\n\t/**\n\t * Loops through field sets and segments and updates data map and group array for both standard and segmented table row\n\t * @private\n\t */\n\t_buildRow() {\n\t\tif (!this.lineModel.lineVO.key) return;\n\n\t\t// data and group objects are consumed by <sb-group> component in forming the group of cells in the table\n\t\tlet data = {},\n\t\t\tgroup = [],\n\t\t\titemClassMap = {};\n\n\t\tif (!this.columnNames) {\n\t\t\t// standard lines\n\t\t\tdata = this.lineModel.lineVO.record;\n\t\t\tgroup = this.fieldNames;\n\t\t} else {\n\t\t\t// segmented lines\n\t\t\t// update data and group for the field names in the summary quote line field set\n\t\t\tfor (var i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\t\tdata[fieldName] = this.record[fieldName];\n\t\t\t\tgroup.push(fieldName);\n\t\t\t}\n\n\t\t\t// create a map to store net totals by columns and populate the columnLabels array\n\t\t\tlet totalsByColumns = {};\n\t\t\tfor (var j = 0, len = this.lineModel.segments.length; j < len; j++) {\n\t\t\t\tlet segment = this.lineModel.segments[j],\n\t\t\t\t\tlabel = segment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, '');\n\t\t\t\ttotalsByColumns[label] = segment.lineVO.record[this.constants.NET_TOTAL_FIELD];\n\t\t\t}\n\n\t\t\t// update data and group for the columns (one-time and time-based segments)\n\t\t\tif (!this.isMobile) {\n\t\t\t\tfor (var k = 0, len = this.columnNames.length; k < len; k++) {\n\t\t\t\t\tlet label = this.columnNames[k].replace(/\\W/g, '');\n\t\t\t\t\t// if a line item does not have a column, pass in null and that is displayed as a blank cell\n\t\t\t\t\tdata[label] = totalsByColumns[label] !== undefined ? totalsByColumns[label] : null;\n\t\t\t\t\tgroup.push(label);\n\t\t\t\t\tthis.mdqFields.add(label);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata['total'] = this.quoteVO.multiSegmentRowTotals[this.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\tgroup.push('total');\n\t\t\tthis.mdqFields.add('total');\n\t\t}\n\n\t\t// Set lineNumber on initial render\n\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\n\t\t// Flag to determine whether to display drawer icon cell\n\t\t// Based on whether there are fields on the field set, that this table row is not a segmented line, and that we're in desktop\n\t\tthis.displayDrawerIconCell = (this.lineModel.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0) && !this.columnNames && !this.isMobile;\n\t\t// If we should display the drawer icon, but in a line that should not have/display a drawer\n\t\tthis.toggleClass('rowWithoutDrawerIcon', this.displayDrawerIconCell && !this.lineModel.hasStandardLineItemDrawer, this);\n\n\t\t// Flags to display invalid pricebook/opportunity messages\n\t\t// If the opportunity line item does not exist and the quote is a primary quote, then we need the tooltip warning, check for == false in case of null or undefined\n\t\tthis.invalidPricebookEntry = this.lineModel.lineVO.validPricebookEntryExists == false;\n\t\tthis.opportunityWarning = this.lineModel.groupModel.quoteModel.isPrimary && this.lineModel.lineVO.opportunityLineItemExists == false && this.invalidPricebookEntry;\n\t\t// If there is not a valid pricebook entry for the line item and the opportunity warning is not already displayed,\n\t\t// display the invalid pricebook entry warning\n\t\tthis.invalidEntryWarning = this.invalidPricebookEntry && !this.opportunityWarning;\n\t\tthis.isDesktopAndHasActionsOnTheLeft   = !this.isMobile && this.lineModel.editorModel.actionsOnTheLeft;\n\t\tthis.isDesktopAndHasNoActionsOnTheLeft = !this.isMobile && !this.lineModel.editorModel.actionsOnTheLeft;\n\n\t\t// Make sure the \"open\" class isn't there when the row is built.\n\t\tif (this.$$('.tr').classList.contains('open'))\n\t\t\tthis.classFollows('open', null, this.$$('.tr'));\n\n\t\tthis.row = this.$$('#row');\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\n\t\tif (this.row && this.row.group !== undefined && this.row.group.length != group.length) {\n\t\t\tthis.row.destroyGroup();\n\t\t}\n\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.itemClassMap = this.lineModel.itemClassMap;\n\t\tthis.widths = this.columnWidths;\n\t\tthis.model = this.lineModel;\n\t\tif(this.row && this.row.template) // since our model is actually a data wrapper, we need to ensure its assigned to template before data\n\t\t\tthis.row.template.model = this.lineModel;\n\t\tthis.primaryItems = this.mobileCols || [];\n\t\tthis.groupDisplay = this.fieldLabelsMap;\n\t\tif (!this.row || !this.row.group)\n\t\t\tthis.group = group;  // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\tthis.data = data;\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tif (this.isMobile && this.row && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\t// If expanded is not already set, set the lineVO so that the MDQ drawers are closed when navigating from somewhere else\n\t\t\tif (this.expanded == null) {\n\t\t\t\tthis.lineModel.lineVO.expanded = false;\n\t\t\t} else {\n\t\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\t\tevt.initEvent('tap', true, false);\n\t\t\t\tlet cell = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (!this.isMobile && !this.lineModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.listen(this, 'track', 'onTrack')\n\t\t}\n\n\t\t// update rowIndex on the signaler to make sure signaler has accurate data-index when iron-list recycles rows\n\t\tif (this.lineModel.editorModel.largeQuoteExperienceEnabled && this.signaler) {\n\t\t\tthis.signaler.rowIndex = this.dataIndex;\n\t\t}\n\n\t\tthis.toggleClass('largeQuote', this.lineModel.editorModel.largeQuoteExperienceEnabled, this.$.root);\n\t\tthis.toggleClass(this.lineModel.lineTypeClass, true);\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.row || this.row.model.editorModel.deviceContext.isMobile) return;\n\t\tthis.widths = this.columnWidths;\n\t}\n\n\n\t//Redirect to segmented lines or standard lines component\n\tonTrack(e) {\n\t\tif ((this.viewport && this.viewport.isMobile()) || !AppContext.isDesktop) {\n\t\t\treturn;\n\t\t}\n\t\t// ignore track event when resizing of dialog or textarea\n\t\tlet path = Polymer.dom(e).path;\n\t\tfor (let a = 0, l = path.length; a < l; a ++){\n\t\t\tlet nodeName = path[a].nodeName;\n\t\t\tif (nodeName === 'SB-DIALOG' || nodeName === 'TEXTAREA') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.domHost.onTrack(e);\n\t}\n\n\t// Getters\n\tget quoteVO() {\n\t\treturn this.lineModel.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.lineModel.lineVO.record;\n\t}\n\n\t// Helper methods\n\t\n\t_lineRecordChanged(e) {\n\t\tif(e.path === 'lineModel.lineVO.fieldVisibility')\n\t\t\tthis._visibilityChanged();\n\t\telse if(e.path === 'lineModel.lineVO.fieldEditability')\n\t\t\tthis._editabilityChanged();\n\t\telse if(e.path === 'lineModel.selected')\n\t\t\tthis._selectedChanged();\n\t\telse {\n\t\t\tlet path = e.path.split('.')[e.path.split('.').length - 1];\n\t\t\tif (!e.path.endsWith('__c') && !e.path.endsWith('__r') && !this.mdqFields.has(path)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._handleFieldValueChanged(path);\n\t\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\t\t\tthis.set(`data.${path}`, e.value);\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tthis.lineModel.setItemClassMap();\n\t\tthis.row.itemClassMap = this.lineModel.itemClassMap;\n\t}\n\n\t_editabilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tthis.row.itemEditableMap = this.lineModel.lineVO.fieldEditability;\n\t}\n\n\t_selectedChanged() {\n\t\tif (this.lineModel.selected) {\n\t\t\tthis.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key] = this.lineModel;\n\t\t} else {\n\t\t\tdelete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key];\n\t\t}\n\t}\n\n\texpand(e) {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$$('#row').fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\t_expanded() {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableEditableFields();\n\t\tthis.toggleLineExpansion();\n\t}\n\n\t/**\n\t * Expands line to display segment details (uses the Segmented Line Field Set)\n\t */\n\ttoggleLineExpansion(e) {\n\t\t// Only change this value if expanded on component does not match so it doesn't override it during a server call\n\t\tif (this.lineModel.lineVO.expanded != this.expanded) {\n\t\t\tthis.set('lineModel.lineVO.expanded', !this.lineModel.lineVO.expanded);\n\t\t}\n\t\tif (this.lineModel.segmented) {\n\t\t\tthis.set('lineModel.expandedIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-right' : 'sf-icon-down');\n\t\t} else {\n\t\t\tif (this.lineModel.hasStandardLineItemDrawer) {\n\t\t\t\tthis.set('lineModel.lineItemDrawerIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-chevronright' : 'sf-icon-chevrondown');\n\t\t\t}\n\t\t}\n\t\tif(this.lineModel.editorModel.largeQuoteExperienceEnabled || this.lineModel.editorModel.isMultiGroupViewEnabled) {\n\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t}\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\thandleFieldValueChanged(evt) {\n\t\tlet path = evt.detail.value;\n\t\tthis._handleFieldValueChanged(path);\n\t}\n\n\t_handleFieldValueChanged(path) {\n\t\tconst fields = [];\n\t\tswitch (path) {\n\t\t\t// handle change based on the path\n\t\t\tcase this.constants.PRICE_EDITABLE_FIELD:\n\t\t\t\tfields.push(this.constants.LIST_PRICE_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.PRICING_METHOD_FIELD:\n\t\t\t\tfields.push(this.constants.MARKUP_FIELD);\n\t\t\t\tfields.push(this.constants.LIST_PRICE_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.PRICING_METHOD_EDITABLE_FIELD:\n\t\t\t\tfields.push(this.constants.PRICING_METHOD_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.NON_DISCOUNTABLE_FIELD:\n\t\t\t\tfields.push(this.constants.ADDITIONAL_DISCOUNT_FIELD);\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._handleFieldEditability(fields);\n\t}\n\n\t_handleFieldEditability(fields) {\n\t\tfor (var field of fields) {\n\t\t\t// If fieldEditability is defined, it means that the page security plugin has already determined field editability, so don't override it\n\t\t\tif (!this.lineModel.lineVO.fieldEditability) {\n\t\t\t\tthis.row = this.row || this.$$('#row');\n\t\t\t\tlet editableMap = {};\n\t\t\t\tlet editable = this.lineModel.isEditable(field);\n\t\t\t\teditableMap[field] = editable;\n\t\t\t\tthis.row.itemEditableMap = editableMap;\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// toggle optional is handled separately in standard lines so that it affects optional whether it is in a drawer or on the line's fieldset\n\t\tif (!this.columnNames) {\n\t\t\treturn;\n\t\t}\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.lineModel.groupModel.groupVO.key) {\n\t\t\tthis.set(`data.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_toggleSelectionObserver (lineModel, expandDisabled) {\n\t\tif (lineModel === undefined || expandDisabled === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._toggleSelection(lineModel, expandDisabled);\n\t}\n\t\n\t_toggleSelection(e) {\n\t\tlet multiLineDeleteEnabled = this.lineModel ? this.lineModel.editorModel.data.settings.multiLineDeleteEnabled : true;\n\t\tlet mobileDrawerOpened = this.isMobile && e.detail && e.detail.drawerState === 'open';\n\t\tthis.showCheckbox = multiLineDeleteEnabled && !this.expandDisabled && !mobileDrawerOpened;\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this, \"lineModel\");\n\t}\n\n\tget selector() {\n\t\treturn this.signaler ? this.signaler.selector : null;\n\t}\n}\n\nPolymer( LETableRow );\n","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class SegmentedDetailRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-detail-row';\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcolumnName: String,\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t},\n\t\t\tindex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_lineRecordChanged(lineModel.segments.*)',\n\t\t\t\t'_lineModelChanged(lineModel, columnName)',\n\t\t\t\t'_setGroupObserver(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\tget selector() {\n\t\treturn this.signaler ? this.signaler.selector : null;\n\t}\n\n\tget isMobile() {\n\t\tthis.viewport && this.viewport.isMobile();\n\t}\n\n\tready() {\n\t\tthis.expanded = false;\n\t}\n\n\texpand(e) {\n\t\tif(this.isMobile) this.enableEditableFields();\n\t\tthis.$.column.fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$.column.root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\t/**\n\t * Propagates value changes on each segment separately so sb-group can update the UI correctly\n\t * @param e\n\t * @private\n\t */\n\t_lineRecordChanged(e) {\n\t\tif (!e.path) return;\n\n\t\t// Isolate the segment number from the path to notify the correct segment child\n\t\tvar firstIndex = e.path.indexOf('#');\n\t\tvar lastIndex = e.path.indexOf('.',firstIndex);\n\t\tvar segmentNumber = e.path.substring(firstIndex + 1, lastIndex);\n\t\tif (!this._pathRefersToMySegmentRecord(segmentNumber)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet pathList = e.path.split('.');\n\t\tlet property = pathList[pathList.length - 1];\n\t\tif (property == 'fieldEditability') {\n\t\t\tthis._editabilityChanged();\n\t\t} else if (property == 'fieldVisibility') {\n\t\t\tthis._visibilityChanged();\n\t\t} else {\n\t\t\tthis.set(`segmentRecord.${property}`, e.value);\n\t\t}\n\t}\n\n\t_lineModelChanged() {\n\t\tthis.dimension = this.lineModel.lineVO.dimensionType;\n\t\tthis.segmentModel = this.lineModel.segmentsByLabel[this.columnName]\n\t\t\t? this.lineModel.segmentsByLabel[this.columnName]\n\t\t\t: new LineModel({key: null, record: {}}, this.lineModel.groupModel);\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tlet column = this.$$('#column');\n\t\tif (this.isMobile && column && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\tevt.initEvent('tap', true, false);\n\t\t\tlet cell = Polymer.dom(column.root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\tif (cell) {\n\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t}\n\t\t}\n\t}\n\n\t_setGroupObserver (detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap) {\n\t\tif (detailFieldNames === undefined || segmentRecord === undefined || segmentModel === undefined || \n\t\t\tmobileCols === undefined || fieldLabelsMap === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setGroup(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap);\n\t}\n\t\n\t_setGroup() {\n\t\tif(!this.$.column.group) {\n\t\t\tthis._initializeFieldVisibility();\n\t\t\tthis.$.column.group = this.detailFieldNames;\n\t\t}\n\t}\n\n\t_initializeFieldVisibility() {\n\t\tlet itemClassMap = {};\n\t\tthis.detailFieldNames.forEach( fieldName => {\n\t\t\tif (!this.segmentModel.isFieldRendered(fieldName, this.isMobile)) {\n\t\t\t\titemClassMap[fieldName] = this.isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t}\n\t\t});\n\t\tthis.$.column.itemClassMap = itemClassMap;\n\t}\n\n\t_visibilityChanged() {\n\t\tif (!this.segmentModel.lineVO.fieldVisibility) {\n\t\t\treturn;\n\t\t}\n\t\tthis.detailFieldNames.forEach( fieldName => {\n\t\t\tlet visible = this.segmentModel.isFieldRendered(fieldName, this.isMobile);\n\t\t\tlet classes = [ { class: 'hiddenInMobile', value: !visible}, { class: 'hiddenInDesktop', value: !visible} ];\n\t\t\tthis.$.column.set('itemClassMap.' + fieldName, classes );\n\t\t});\n\t}\n\n\t_editabilityChanged() {\n\t\tif (!this.segmentModel.lineVO.fieldEditability || !this.detailFieldNames) {\n\t\t\treturn;\n\t\t}\n\t\tlet editability = {};\n\t\tthis.detailFieldNames.forEach( fieldName => {\n\t\t\tif (this.segmentModel.lineVO.fieldEditability.hasOwnProperty(fieldName)) {\n\t\t\t\teditability[fieldName] = this.lineModel.isEditable(fieldName, this.segmentModel.lineVO.fieldEditability);\n\t\t\t}\n\t\t});\n\t\tthis.$.column.itemEditableMap = editability;\n\t}\n\n\t_pathRefersToMySegmentRecord(segmentNumber) {\n\t\tif (!this.segmentRecord) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.lineModel.segments && !this.lineModel.segments[segmentNumber]) {\n\t\t\treturn false;\n\t\t}\n\t\tvar referencedSegmentVO = this.lineModel.segments[segmentNumber].lineVO;\n\t\tvar referencedKey = referencedSegmentVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar referencedIndex = referencedSegmentVO.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar referencedLabel = referencedSegmentVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\tvar mySegmentKey = this.segmentRecord[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar mySegmentIndex = this.segmentRecord[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar mySegmentLabel = this.segmentRecord[this.constants.SEGMENT_LABEL_FIELD];\n\t\treturn (referencedKey === mySegmentKey) && (referencedIndex === mySegmentIndex) && (referencedLabel === mySegmentLabel);\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'column', 'sb-le-table-cell', null, this.index);\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n}\n\nPolymer( SegmentedDetailRow );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {toFieldName} from \"common/Util.js\";\n\nexport class SegmentedLineDetails {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-line-details';\n\t\tthis.properties = {\n\t\t\tlineModel: { /** required - lineModel that is being rendered */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array, /** required - names of the fields in the summary field set*/\n\t\t\tdetailFieldNames: Array, /** required - names of the fields in the segmented line field set*/\n\t\t\tfieldLabelsMap: Object, /** required - map of field names to labels*/\n\t\t\tcolumnNames: Array, /** required - names of the segment columns in the group*/\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: '_initTabIndex(viewport)'\n\t\t\t}\n\t\t};\n\t\tthis.listeners = {\n\t\t\t'change': '_onChange',\n\t\t\t'rte-value-changed': '_onChange',\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRowObserver(detailFieldNames, fieldNames, lineModel, columnWidths)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t];\n\t}\n\n\n\tattached() {\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.detailFieldNames.forEach((field) => {\n\t\t\t\tthis._adjustDetailFieldHeights(field);\n\t\t\t})\n\t\t});\n\t}\n\n\t// Due to the fact that each detail row is rendered more like a list than a table, there's no guarantee that each cell in the same row will have the same height\n\t// this method traverses through all cells for the given field and set their heights to the maximum height in the row.\n\t_adjustDetailFieldHeights(field) {\n\t\t// field height adjustment is only needed for textarea fields, all other fields have uniform heights\n\t\tconst fieldMD = this.lineModel.getFieldMD(field);\n\t\tif (fieldMD && (fieldMD.type === 'textarea' || fieldMD.type === 'string' || fieldMD.type === 'currency')) {\n\t\t\tconst fieldNodeList = this.querySelectorAll(`sb-le-table-cell[item='${field}'] #field`);\n\t\t\tif (fieldNodeList) {\n\t\t\t\tconst fieldElems = Array.from(fieldNodeList);\n\t\t\t\tconst max = Math.max(...fieldElems.map(e => e.scrollHeight));\n\t\t\t\tfieldElems.forEach((elem) => {\n\t\t\t\t\tif (elem.offsetHeight < max) {\n\t\t\t\t\t\telem.style.height = max + 'px';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst header = this.querySelector(`sb-le-table-header-cell[item='${field}'] #header`);\n\t\t\t\tif (header && header.offsetHeight < max) {\n\t\t\t\t\theader.style.height = max + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_onChange(e) {\n\t\t// when a detail field is changed, adjust the row height when necessary\n\t\tif (e.detail) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tconst cellElem = Polymer.dom(e).path.find((pathElem) => {\n\t\t\t\t\treturn pathElem.tagName === 'SB-LE-TABLE-CELL';\n\t\t\t\t});\n\t\t\t\tif (cellElem) {\n\t\t\t\t\tthis._adjustDetailFieldHeights(cellElem.item);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile()\n\t}\n\n\t/**\n\t * Returns the lineVO.record of the segment. If the line does not have that segment, it returns an empty lineVO.record for rendering purposes.\n\t * @param label\n\t * @returns {lineVO.record}\n\t */\n\tgetSegmentRecord(label) {\n\t\treturn this.lineModel.segmentsByLabel[label]\n\t\t\t? this.lineModel.segmentsByLabel[label].lineVO.record\n\t\t\t: new LineModel({key: null, record: {}}, this.lineModel.groupModel).lineVO.record;\n\t}\n\n\tsegmentExists(columnName) {\n\t\treturn !this.lineModel.segmentsByLabel[columnName] ? 'desktopOnly' : '';\n\t}\n\n\tforwardFocusDown(e) {\n\t\tif(e.keyCode === 9 && !e.shiftKey) // tab key\n\t\t\tRowFocusSignaler.signalFirstEditableTargetFirstRow(this, 'sb-segmented-detail-row', 'index');\n\t}\n\n\tforwardFocusUp(e) {\n\t\tif (e.keyCode === 9 && e.shiftKey) // shift+tab key\n\t\t\tRowFocusSignaler.signalLastEditableTargetLastRow(this, 'sb-segmented-detail-row', this.columnNames.length, 'index');\n\t}\n\n\t_buildRowObserver (detailFieldNames, fieldNames, lineModel, columnWidths) {\n\t\tif (detailFieldNames === undefined || fieldNames === undefined ||\tlineModel === undefined || columnWidths === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._buildRow(detailFieldNames, fieldNames, lineModel, columnWidths);\n\t}\n\t\n\t_buildRow() {\n\t\tthis._setColumnWidths();\n\t\tthis.$.header.itemClassMap = this.itemClassMap;\n\t\t// need to assign sb-group component's group attribute from here otherwise the itemClassMap will not be taken into account\n\t\t// because itemClassMap is optional for sb-group\n\t\tthis.detailFieldNamesWithLabel = this.isMobile()\n\t\t\t? [this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD].concat(this.detailFieldNames)\n\t\t\t: this.detailFieldNames;\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = this.detailFieldNamesWithLabel;\n\t}\n\n\t_isActionsOnTheLeft(editorModel) {\n\t\treturn editorModel.actionsOnTheLeft;\n\t}\n\n\t/**\n\t * Sets column widths within segmented line drawers. Runs at every window resize\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tif (this.isMobile()) return;\n\t\tlet colWidths = this.columnWidths;\n\t\tif (!colWidths || !this.columnNames) {\n\t\t\treturn;\n\t\t}\n\t\t// get the width of the label column which should align with the last summary line field\n\t\tlet labelColWidth = 0;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += colWidths[field];\n\t\t}\n\t\tthis.fieldNamesColWidth = labelColWidth + 'px';\n\t\t// set width of the total column\n\t\tthis.totalColWidth = colWidths['total'] + 'px';\n\t}\n\n\t_segDetailColWidth(columnName, columnWidths) {\n\t\tconst colName = toFieldName(columnName);\n\t\treturn columnWidths[colName] + 'px';\n\t}\n\n\t/**\n\t * Updates column widths based on window resizing or group side panel toggling\n\t * @private\n\t */\n\t_columnWidthsChanged() {\n\t\tthis._setColumnWidths();\n\t}\n\n\t_initTabIndex() {\n\t\treturn this.isMobile() ? -1 : 0;\n\t}\n}\n\nPolymer( SegmentedLineDetails );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DeviceBehavior} from 'common/behaviors/DeviceBehavior.js';\nimport {TemplatizationBehavior} from 'common/behaviors/TemplatizationBehavior.js';\nimport {setThenNotify} from 'quotes/models/UiNotifier.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFTableHeaderBehavior} from 'quotes/tables/SFTableHeaderBehavior.js';\nimport { Events } from 'common/core/Events.js';\n\n/**\n * QLE Header level component for templatizing and stamping HTML\n *\n * @author rlobo\n * @since 216\n */\nexport class SFLETableHeader {\n\n\tget behaviors() {\n\t\treturn [Polymer.Templatizer, window.CommonBehaviors.TemplatizationBehavior, window.CommonBehaviors.SFTableHeaderBehavior, window.CommonBehaviors.EventBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-le-table-header';\n\n\t\tthis.properties = Polymer.Base.extend({\n\n\t\t\tlineModels: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\n\t\t\tfields: Object,\n\n\t\t}, TemplatizationBehavior.properties);\n\n\t\tthis.properties = Polymer.Base.extend(this.properties, SFTableHeaderBehavior.properties);\n\n\t\tthis.listeners = {\n\t\t\ttap: 'onTap',\n\t\t\tmouseover: 'onHover',\n\t\t\tmousedown: 'startResize',\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.DESELECT_CHECKBOX] = this.deselectCheckbox;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\t}\n\n\t/**\n\t * @override Override SFTableHeaderBehavior#onTap_hook\n\t * @param evt\n\t */\n\tonTap_hook(evt) {\n\t\tlet bundleCaret = this.findElementForEvent(evt, 'bundle-caret');\n\t\tif (bundleCaret) {\n\t\t\tthis._toggleBundleExpansion(bundleCaret);\n\t\t\treturn true;\n\t\t}\n\t\tlet drawerContainer = this.findElementForEvent(evt, 'drawerIcon');\n\t\tif (drawerContainer) {\n\t\t\tthis._toggleStandardDrawers(drawerContainer);\n\t\t\treturn true;\n\t\t}\n\t\tlet segmentedDrawerContainer = this.findElementForEvent(evt, 'segmentedDrawer');\n\t\tif (segmentedDrawerContainer) {\n\t\t\tthis._toggleSegmentedDrawers(segmentedDrawerContainer);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t_toggleBundleExpansion(bundleCaret) {\n\t\tlet currentlyExpanded = this.uiData._caretContent === TemplateGenerator.classNames.CHEVRON_DOWN_CONTENT;\n\t\tthis._restampField('_caretContent', currentlyExpanded ?\n\t\t\tTemplateGenerator.classNames.CHEVRON_RIGHT_CONTENT :\n\t\t\tTemplateGenerator.classNames.CHEVRON_DOWN_CONTENT);\n\t\tthis.fire('bundle-toggled', { expanded: !currentlyExpanded });\n\t}\n\n\t/**\n\t * Toggle selection for all quote lines\n\t * @param cbContainer\n\t * @override\n\t */\n\ttoggleSelection(cbContainer) {\n\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\tcb.checked = !cb.checked;\n\t\tif (this.lineModels) {\n\t\t\tfor (let i = 0; i < this.lineModels.length; i++) {\n\t\t\t\tsetThenNotify(this.lineModels[i], ['selected'], cb.checked);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Deselect checkbox\n\t */\n\tdeselectCheckbox() {\n\t\tlet cbContainer = this.querySelector('div.selection div.checkboxcontainer');\n\t\tif (cbContainer) {\n\t\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\t\tcb.checked = false;\n\t\t}\n\t}\n\n\t/**\n\t * Toggle drawers for standard lines\n\t * @param drawerContainer\n\t * @private\n\t */\n\t_toggleStandardDrawers(drawerContainer) {\n\t\tlet iconSpan = drawerContainer.querySelector('span');\n\t\tif (iconSpan) {\n\t\t\tthis._toggleDrawers(iconSpan, TemplateGenerator.classNames.CHEVRON_RIGHT_ICON, TemplateGenerator.classNames.CHEVRON_DOWN_ICON, 'lineItemDrawerIconClass');\n\t\t}\n\t}\n\n\t/**\n\t * Toggle drawers for segmented lines\n\t * @param drawerContainer\n\t * @private\n\t */\n\t_toggleSegmentedDrawers(drawerContainer) {\n\t\tlet iconSpan = drawerContainer.querySelectorAll('span')[1];\n\t\tif (iconSpan) {\n\t\t\tthis._toggleDrawers(iconSpan, TemplateGenerator.classNames.RIGHT_ICON, TemplateGenerator.classNames.DOWN_ICON, 'expandedIconClass');\n\t\t}\n\t}\n\n\t/**\n\t * Common method to toggle expansion of drawers\n\t * @param iconSpan\n\t * @param closeIcon\n\t * @param expandIcon\n\t * @param lineModelIconAttr\n\t * @private\n\t */\n\t_toggleDrawers(iconSpan, closeIcon, expandIcon, lineModelIconAttr) {\n\t\tlet expanded = !iconSpan.classList.contains(closeIcon);\n\t\tlet newIconClass = expanded ? closeIcon : expandIcon;\n\t\ticonSpan.classList.remove(closeIcon, expandIcon);\n\t\ticonSpan.classList.add(newIconClass);\n\t\tif (this.lineModels) {\n\t\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\t\tthis.set(`lineModels.${i}.lineVO.expanded`, !expanded);\n\t\t\t\tthis.set(`lineModels.${i}.${lineModelIconAttr}`, newIconClass);\n\t\t\t}\n\t\t}\n\t\tthis.fire('line-toggled');\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetContentNode() {\n\t\treturn Polymer.dom(this.$.content);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetTooltipContent(field) {\n\t\treturn this.uiData[field] || '';\n\t}\n}\n\nPolymer( SFLETableHeader );","/**\n * Abstract class for a field that controls the values of other fields based on value selected\n * on the controlling field\n */\nexport class ControllingField {\n\n\t/**\n\t * Returns the field name of the controlling field\n\t */\n\tgetFieldName() {}\n\n\t/**\n\t * Updates all of the fields that this field is controlling\n\t *\n\t * @param tableRow\n\t * @param controllingFieldValue\n\t */\n\tupdateControlledFields(tableRow, controllingFieldValue) {}\n\n}\n","import {DeviceDelegate} from 'quotes/layout/sf-le-table-row/DeviceDelegate.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\nexport class DesktopDelegate extends DeviceDelegate {\n\n\t/**\n\t * @override\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t * @param row\n\t * @param suppressCalculateImmediately\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row, suppressCalculateImmediately) {\n\t\tlet writeElem = container.querySelector('.w');\n\t\tlet readElem = container.querySelector('.r');\n\t\tlet isRichTextArea = metadata.extraTypeInfo === \"richtextarea\";\n\t\trow.toggleCellClass('hidden', isEdit && !isRichTextArea, readElem, field);\n\t\trow.toggleCellClass(TemplateGenerator.classNames.EDIT_MODE, isEdit && !isRichTextArea, container, field);\n\t\t// add / remove edit field component\n\t\tif (isEdit) {\n\t\t\tif (!writeElem) {\n\t\t\t\twriteElem = row._createWritableElement(field, container);\n\t\t\t}\n\t\t\t// focus on first input within cell if it exists but give current event loop chance to finish first\n\t\t\t// sb-rte.focus is also needed for IE11 to trigger the firing of sf-open-rte-dialog event\n\t\t\tlet input = writeElem.querySelector( 'input:not([type=\"hidden\"]), checkbox, select, textarea, sb-rte' );\n\t\t\tif( input ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tinput.focus();\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t} else if (writeElem) { // nothing to toggle back to if writeElem doesn't already exist\n\t\t\tif (!isRichTextArea) {\n\t\t\t\tcontainer.removeChild(writeElem);\n\t\t\t}\n\t\t\tif (row.commitPendingEdit(suppressCalculateImmediately)) {\n\t\t\t\tlet newValue = row._formatNewValue(field, metadata);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\trow.fire('line-toggled', {index: row.dataIndex});\n\t\t\t\t});\n\t\t\t\trow._toggleDirtyClass(newValue, field, readElem);\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(event, row) {\n\t\tlet stopPropagation = false;\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase 27: // escape\n\t\t\t\tstopPropagation = this._onEscapePress(event, row);\n\t\t\t\tbreak;\n\t\t\tcase 32: // space\n\t\t\t\t// Space toggles checkbox field and row selection\n\t\t\t\tstopPropagation = this._onSpaceBarPress(event, row);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn stopPropagation;\n\t}\n\n\t/**\n\t * Handle key event for space bar when it's on an editable boolean field or a row selection CB\n\t * @param event\n\t * @param row\n\t * @return whether the event should stop further processing on the parent (SFAbstractTable) level\n\t * @private\n\t */\n\t_onSpaceBarPress(event, row) {\n\t\tlet element = Polymer.dom(event).path[0];\n\t\tif ((element.classList.contains(TemplateGenerator.classNames.EDITABLE) && element.classList.contains(TemplateGenerator.classNames.BOOLEAN)) ||\n\t\t\telement.classList.contains(TemplateGenerator.classNames.SELECTION)) {\n\t\t\tlet cbContainer = element.querySelector('.checkboxcontainer');\n\t\t\tif (cbContainer) {\n\t\t\t\trow.toggleCheckbox(cbContainer);\n\t\t\t\t// stop event propagation so we don't invoke toggleInlineEdit for checkbox fields\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Handle key event for escape key press. This will prevent pending inline edit from being committed, or reset AdditionalDiscount field to its original value\n\t * @param event\n\t * @param row\n\t * @returns {boolean} whether the event should stop further processing on the parent (SFAbstractTable) level\n\t * @private\n\t */\n\t_onEscapePress(event, row) {\n\t\t// discard inline edit change if it comes from a field being inline edited\n\t\tlet container = row.findElementForEvent(event, TemplateGenerator.classNames.EDIT_MODE);\n\t\tif (container && container.getAttribute('field')) {\n\t\t\t// additional discount field is special (of course) and we need to invoke resetToOriginal directly\n\t\t\tif (row._getEditorModel && container.getAttribute('field') === row._getEditorModel().constants.ADDITIONAL_DISCOUNT_FIELD) {\n\t\t\t\tlet discountComp = container.querySelector('sb-discount');\n\t\t\t\tif (discountComp) {\n\t\t\t\t\tdiscountComp.resetToOriginal();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trow.setDiscardPendingEdit(true);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Device-aware logic for applying focus\n\t * @param container\n\t * @param evt\n\t * @param row, the table row\n\t * @private\n\t */\n\tapplyFocus(container, evt, row) {\n\t\tlet table = row.getTableComponent(evt);\n\t\tif (table) {\n\t\t\ttable.applyCellFocus(container);\n\t\t}\n\t}\n\n\t/**\n\t *  Mobile Specific\n\t */\n\tupdateTemplate() {}\n\n\t/**\n\t * Mobile Specific\n\t */\n\t_updateEditableField() {}\n}\n","/**\n * Abstract class for concrete, device-aware table row implementation\n */\nexport class DeviceDelegate {\n\n\t/**\n\t * Initialize device-aware listeners for the row\n\t * @param row Row for which listeners are initialized\n\t */\n\tinitListeners(row) {}\n\n\t/**\n\t * Device-aware onTap handling\n\t * @param evt The tap event\n\t * @param row Row being tapped\n\t */\n\tonTap(evt, row) {}\n\n\t/**\n\t * Device-aware logic for when row is expanded, (mobile row or drawer on desktop)\n\t * @param newValue New value of expansion\n\t * @param oldValue Old value of expansion\n\t * @param row The row for which the expansion state is changing\n\t */\n\texpansionChanged(newValue, oldValue, row) {}\n\n\t/**\n\t * Device-aware logic for toggling inline edit\n\t * @param container The container div for the edited field\n\t * @param isEdit Whether inline edit is being turned on or off\n\t * @param field Name of field being edited\n\t * @param metadata Metadata for the field being edited\n\t * @param row The row for which inline edit is being toggled\n\t * @param suppressCalculateImmediately Some situations need to suppress calculation immediately\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row, suppressCalculateImmediately) {}\n\n\t/**\n\t * Device-aware keydown handler\n\t * @param event\n\t * @param row\n\t */\n\tonKeyDown(event, row) {}\n\n\t/**\n\t * Device-aware logic for applying focus\n\t * @param container\n\t * @param evt\n\t * @param row, the table row\n\t */\n\tapplyFocus(container, evt, row) {}\n}\n\n\n","import {ControllingField} from 'quotes/layout/sf-le-table-row/ControllingField.js';\n\n/**\n * Represents a controlling field that updates the editability of its controlled fields\n */\nexport class EditabilityControllingField extends ControllingField {\n\n\tupdateControlledFields(tableRow, controllingFieldValue) {\n\t\tlet toggledEditable = false;\n\t\tif (this._getEditableFieldValues().includes(controllingFieldValue)) {\n\t\t\tthis._getControlledFields().forEach((field) => {\n\t\t\t\tif (tableRow.lineModel.isFieldRendered(field) && tableRow.lineModel.isEditable(field)) {\n\t\t\t\t\tvar tableCell = tableRow.querySelector('div[field=\\'' + field + '\\']');\n\t\t\t\t\tif (tableCell) {\n\t\t\t\t\t\tlet cellClassList = tableCell.classList;\n\t\t\t\t\t\tif (!cellClassList.contains('editable')) {\n\t\t\t\t\t\t\ttoggledEditable = true;\n\t\t\t\t\t\t\tcellClassList.add('editable');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (toggledEditable) {\n\t\t\t\t// if anything was switched to editable, we need to load hover pencils for this row if necessary\n\t\t\t\ttableRow._handleEditableCellsHover(true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._getControlledFields().forEach((field) => {\n\t\t\t\tif (tableRow.lineModel.isFieldRendered(field)) {\n\t\t\t\t\tvar tableCell = tableRow.querySelector('div[field=\\'' + field + '\\']');\n\t\t\t\t\tif(tableCell) {\n\t\t\t\t\t\ttableCell.classList.remove('editable');\n\t\t\t\t\t}\n\t\t\t\t\tif (this._shouldClearFieldValue()) {\n\t\t\t\t\t\ttableRow._clearFieldValue(field);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\ttoggledEditable = true;\n\t\t}\n\n\t\t// Update controlled field values\n\t\tthis._getControlledFields().forEach((field) => {\n\t\t\tlet controlledFieldValue = this._getControlledFieldValue(field, controllingFieldValue, toggledEditable);\n\t\t\tif (controlledFieldValue !== undefined) {\n\t\t\t\ttableRow._updateFieldValue(field, controlledFieldValue);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns list of controlled fields\n\t *\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getControlledFields() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Returns the values of the controlling field in which controlled fields should\n\t * be marked editable.  Otherwise, they should be marked uneditable.\n\t *\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getEditableFieldValues() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Returns the default value of a specified controlled field.\n\t *\n\t * @param controlledField {String}\n\t * @param controllingFieldValue {Object}\n\t * @param toggledEditable {Boolean}\n\t * @returns {Object}\n\t * @private\n\t */\n\t_getControlledFieldValue(controlledField, controllingFieldValue, toggledEditable) {\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if the controlled field value should be cleared when it is\n\t * marked undeditable\n\t *\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_shouldClearFieldValue() {\n\t\treturn true;\n\t}\n}\n\n\n","import {DeviceDelegate} from 'quotes/layout/sf-le-table-row/DeviceDelegate.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\nexport class MobileDelegate extends DeviceDelegate {\n\n\tstatic getInstance() {\n\t\tif (!this._instance) {\n\t\t\tthis._instance = new MobileDelegate();\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * @override\n\t * @param row\n\t */\n\tinitListeners(row) {\n\t\trow.listeners['row-swiped'] = 'onRowSwiped';\n\t}\n\n\t/**\n\t * @override\n\t * @param evt\n\t * @param row\n\t */\n\tonTap(evt, row) {\n\t\tif(evt && !row.expansionDisabled && row.findElementForEvent(evt, 'primary')){\n\t\t\tvar expanded = row.toggleExpanded();\n\t\t\tvar swipeCont = row.querySelector('sb-swipe-container');\n\t\t\tif(swipeCont !== null) {\n\t\t\t\tswipeCont.groupExpanded = expanded;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * If row is swiped in Mobile, the expansion of the row should be disabled\n\t * @override\n\t * @param e - row swipe event\n\t * @param row\n\t */\n\tonRowSwiped(e, row) {\n\t\tif(e && e.detail) {\n\t\t\trow.expansionDisabled = e.detail.isOpen;\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param newValue\n\t * @param oldValue\n\t * @param row\n\t */\n\texpansionChanged(newValue, oldValue, row) {\n\t\tif(!row.expansionDisabled) {\n\t\t\tlet spanElem = row.$$('.container.first');\n\t\t\tif (spanElem) {\n\t\t\t\tlet secondaryContainer = row.$$('.secondary');\n\t\t\t\tif (!secondaryContainer) {\n\t\t\t\t\t//secondary container hasn't been loaded yet\n\t\t\t\t\tthis._loadSecondaryFields(row);\n\t\t\t\t\tsecondaryContainer = row.$$('.secondary'); // container exists now\n\t\t\t\t}\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.EXPANDED, newValue); // toggle chevron\n\t\t\t\tsecondaryContainer.classList.toggle(TemplateGenerator.classNames.EXPANDED, newValue); // toggle container\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the secondary template instance\n\t * The primary template instance gets updated from _stamp()\n\t * @param row\n\t */\n\tupdateTemplate(row) {\n\t\t// Not all secondary rows may be open\n\t\tif (row.secondaryTemplateInstance) {\n\t\t\t// node is already templatized, just update its content\n\t\t\tObject.keys(row.uiData).forEach((key) => {\n\t\t\t\trow.secondaryTemplateInstance[key] = row.uiData[key];\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Lazy Load the secondary fields by hydrating and applying instance to the dom.\n\t * @private\n\t */\n\t_loadSecondaryFields(row) {\n\t\trow.secondaryTemplateInstance = row.hydrateTemplateFromNode(row.secondaryRowTemplate.cloneNode(true), row.uiData);\n\t\tPolymer.dom(row.$.content).appendChild(row.secondaryTemplateInstance.root);\n\t\t//Setup editable fields\n\t\tlet fields = Array.from(row.$$('.secondary').children);\n\t\tfields.forEach((field) => {\n\t\t\tif(field.classList.contains(TemplateGenerator.classNames.EDITABLE) &&\n\t\t\t\t!field.classList.contains(TemplateGenerator.classNames.BOOLEAN)) {\n\t\t\t\t// hide all read elements on first time when secondary fields are loaded\n\t\t\t\tlet readElem = field.querySelector('.r');\n\t\t\t\tif (readElem) {\n\t\t\t\t\trow.toggleClass('hidden', true, readElem);\n\t\t\t\t}\n\t\t\t\trow.toggleInlineEdit(field, true);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t * @param row\n\t * @param suppressCalculateImmediately\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row, suppressCalculateImmediately) {\n\t\tlet writeElem = container.querySelector('.w');\n\t\trow.toggleCellClass(TemplateGenerator.classNames.EDIT_MODE, isEdit, container, field);\n\t\t// add / remove edit field component\n\t\tif (isEdit) {\n\t\t\tif (!writeElem) {\n\t\t\t\trow._createWritableElement(field, container);\n\t\t\t}\n\t\t} else if (writeElem)  {\n\t\t\trow.commitPendingEdit(suppressCalculateImmediately);\n\t\t}\n\t}\n\n\t/**\n\t * Update the editable field\n\t *\n\t * Recreate the write element so that it can be populated with the newly formatted value\n\t */\n\t_updateEditableField(container, row, field, metadata, writeElem) {\n\t\trow._formatNewValue(field, metadata);\n\t\tif (writeElem.firstChild) {\n\t\t\twriteElem.removeChild(writeElem.firstChild); // remove div element\n\t\t\trow._createEditField(writeElem, container.getAttribute('index'), field);\n\t\t}\n\t}\n}","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class NonDiscountableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.NON_DISCOUNTABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD,\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [false];\n\t}\n}\n\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PriceEditableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICE_EDITABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.LIST_PRICE_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [true];\n\t}\n\n\t_shouldClearFieldValue() {\n\t\treturn false;\n\t}\n\n}\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PricingMethodControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICING_METHOD_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.MARKUP_FIELD,\n\t\t\tQuoteContext.constants.MARKUP_AMOUNT_FIELD,\n\t\t\tQuoteContext.constants.MARKUP_RATE_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn ['Cost'];\n\t}\n}\n\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PricingMethodEditableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICING_METHOD_EDITABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.PRICING_METHOD_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [true];\n\t}\n\n\t_shouldClearFieldValue() {\n\t\treturn false;\n\t}\n\n}\n\n\n","import { DesktopDelegate } from 'quotes/layout/sf-le-table-row/DesktopDelegate.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\nexport class QLEDesktopDelegate extends DesktopDelegate {\n\n\tstatic getInstance() {\n\t\tif (!this._instance) {\n\t\t\tthis._instance = new QLEDesktopDelegate();\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * @override\n\t * @param row\n\t */\n\tinitListeners(row) {\n\t\trow.listeners.mouseover = 'onHovered';\n\t\trow.listeners.mouseout = 'onUnhovered';\n\t\trow.listeners['rte-esc'] = 'onRteCancel';\n\t}\n\n\t/**\n\t * @override\n\t * @param newValue\n\t * @param oldValue\n\t * @param row\n\t */\n\texpansionChanged(newValue, oldValue, row) {\n\t\tif (!row.isSegmented) {\n\t\t\tlet spanElem = row.$$('.drawerContainer span');\n\t\t\tif (spanElem) {\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.CHEVRON_DOWN_ICON, newValue);\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.CHEVRON_RIGHT_ICON, !newValue);\n\t\t\t}\n\t\t} else {\n\t\t\tlet spanElem = row.$$('.segmentedContainer');\n\t\t\tif(spanElem) {\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.DOWN_ICON, newValue);\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.RIGHT_ICON, !newValue);\n\t\t\t\tif (row.uiData && row.uiData._cellClasses) {\n\t\t\t\t\trow.uiData._cellClasses._expansionIcon = newValue ? TemplateGenerator.classNames.DOWN_ICON : TemplateGenerator.classNames.RIGHT_ICON;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {SFComponentFactory} from 'quotes/sf-component-factory/SFComponentFactory.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {SFTableRowBehavior} from 'common/behaviors/SFTableRowBehavior.js';\nimport {SFInlineEditBehavior} from 'common/behaviors/SFInlineEditBehavior.js';\nimport {TemplatizationBehavior} from 'common/behaviors/TemplatizationBehavior.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\nimport {DependentPicklistBuilder} from \"common/forms/DependentPicklistBuilder.js\";\nimport {AppContext} from 'common/core/AppContext.js';\nimport {DeviceBehavior} from 'common/behaviors/DeviceBehavior.js';\nimport {QLEDesktopDelegate} from 'quotes/layout/sf-le-table-row/QLEDesktopDelegate.js';\nimport {MobileDelegate} from 'quotes/layout/sf-le-table-row/MobileDelegate.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {ControllingField} from 'quotes/layout/sf-le-table-row/ControllingField.js';\nimport {PricingMethodControllingField} from 'quotes/layout/sf-le-table-row/PricingMethodControllingField.js';\nimport {NonDiscountableControllingField} from 'quotes/layout/sf-le-table-row/NonDiscountableControllingField.js';\nimport {PricingMethodEditableControllingField} from 'quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js';\nimport {PriceEditableControllingField} from 'quotes/layout/sf-le-table-row/PriceEditableControllingField.js';\nimport {SubscriptionTypeControllingField} from 'quotes/layout/sf-le-table-row/SubscriptionTypeControllingField.js';\nimport {getUnitAndDisplayValue} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport { get as readFromCache, put as updateCache } from 'quotes/models/ClientCache.js';\n\n/**\n * Row level component for templatizing and stamping row HTML\n *\n * @author kzheng\n * @since 212\n */\nexport class SFLETableRow {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.SFTableRowBehavior, window.CommonBehaviors.TemplatizationBehavior, window.CommonBehaviors.SFInlineEditBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-le-table-row';\n\n\t\tthis.properties = Polymer.Base.extend({\n\n\t\t\t// line model contains raw data and UI data\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\n\t\t\t// whether the row represents a segmented line\n\t\t\tisSegmented: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\n\t\t\t// column width for resizing\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: \"_columnsResized\"\n\t\t\t},\n\n\t\t\t//Template for mobile's secondary fields\n\t\t\tsecondaryRowTemplate: {\n\t\t\t\ttype: Object\n\t\t\t},\n\n\t\t\t// flag to track whether this row has be marked dirty (as in any cell was edited)\n\t\t\tisDirty: Boolean,\n\n\t\t\t// row index\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\n\t\t\t//flag for disabling secondary drawer from opening when row is swiped\n\t\t\texpansionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, TemplatizationBehavior.properties);\n\n\t\tthis.listeners = {\n\t\t\t'tap': 'onTap',\n\t\t\t'change': 'onChange',\n\t\t\t'selected-date-changed': 'onChange',\n\t\t\t'rte-value-changed': 'onChange',\n\t\t\t'lookup-value-changed': 'onChange'\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_recordChanged(lineModel.lineVO.record.*)',        \t// for global events such as calculate\n\t\t\t'_expansionChanged(lineModel.lineVO.expanded)',     \t// table-wide drawer expand / collapse\n\t\t\t'_selectionChanged(lineModel.selected)',            \t// table-wide select all\n\t\t\t'_bundleExpansionChanged(lineModel.bundleCollapsed)',\t// line's expanded or collapsed\n\t\t];\n\t}\n\n\tcreated() {\n\t\tthis._deviceDelegate = AppContext.isMobile ? MobileDelegate.getInstance() : QLEDesktopDelegate.getInstance();\n\t\tthis._deviceDelegate.initListeners(this);\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\n\t\tthis.deviceClasses = '';\n\t\tlet devices = new DeviceBehavior().getDeviceClasses();\n\t\tfor (let device of devices) {\n\t\t\tthis.deviceClasses += device + ' ';\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetContentNode() {\n\t\treturn Polymer.dom(this.$.content);\n\t}\n\n\tgetControllingFields() {\n\t\treturn [\n\t\t\tnew PricingMethodControllingField(),\n\t\t\tnew NonDiscountableControllingField(),\n\t\t\tnew PricingMethodEditableControllingField(),\n\t\t\tnew PriceEditableControllingField(),\n\t\t\tnew SubscriptionTypeControllingField()\n\t\t];\n\t}\n\n\t/**\n\t * Invoked from TemplatizationBehavior._populateContent\n\t * @override\n\t */\n\tpostPopulateContent() {\n\t\t// Update Template for Mobile\n\t\tthis._deviceDelegate.updateTemplate(this);\n\t\tthis._resetPencilLoaded();\n\t\tthis._refreshDirtyIndicators();\n\t\t// line warning is lazily added when applicable\n\t\tif (this.uiData.hasLineWarning) {\n\t\t\tthis._loadLineWarning();\n\t\t}\n\t}\n\n\t/**\n\t * Lazy load line warning\n\t * @private\n\t */\n\t_loadLineWarning() {\n\t\tlet container = this.querySelector('#itemNumber .warning');\n\t\tif (container && !container.hasChildNodes()) {\n\t\t\tlet elem = document.createElement('sf-line-warning');\n\t\t\telem.key = this.uiData.lineWarningKey;\n\t\t\telem.message = this.uiData.lineWarningMsg;\n\t\t\tcontainer.appendChild(elem);\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when the underlying record has changed, such as when user clicks calculate\n\t * @param newValue the new record\n\t * @param oldValue the old record\n\t * @private\n\t */\n\t_recordChanged(newValue, oldValue) {\n\t\t// we're only interested in record change when template has been hydrated\n\t\tif (this.templateInstance) {\n\t\t\tlet path = newValue.path;\n\t\t\tif (path !== LineModel.recordPath) {\n\t\t\t\t// individual field changed\n\t\t\t\tlet field = path.substring(LineModel.recordPath.length + 1);\n\t\t\t\tlet rawData = newValue.value;\n\t\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\t\tif(metadata) {\n\t\t\t\t\tlet uiDatum = Formatter.formatFieldData(this.lineModel, rawData, metadata, this._getRecord());\n\t\t\t\t\tthis._restampField(field, uiDatum);\n\t\t\t\t\tthis._handleChangeControllingField(metadata.name, newValue.value);\n\t\t\t\t\tconst writeElem = this.querySelector(`div.td[field=\"${field}\"] div.w`);\n\t\t\t\t\tif (writeElem) {\n\t\t\t\t\t\tthis._deviceDelegate._updateEditableField(writeElem.parentElement, this, field, metadata, writeElem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// entire line has changed\n\t\t\t\tthis.templateInstance.lineModel = this.lineModel;\n\t\t\t}\n\t\t}\n\t}\n\n\tonRteCancel(evt) {\n\t\tlet container = SFAbstractTable.findCell(evt);\n\t\tthis.toggleInlineEdit(container, false);\n\t\t//removing the child for rte before calling toggleInlineEdit bc we don't remove it in\n\t\t// toggleInlineEdit\n\t\tcontainer.removeChild(container.querySelector('.w'));\n\t\t// put focus back on the read element\n\t\tthis._applyFocus(container, evt);\n\t}\n\n\t/**\n\t * when a controlling picklist's value has changed,\n\t * clear out the dependent picklist's value if necessary\n\t * @private\n\t */\n\t_updateDependentPicklist(controllerField) {\n\t\tlet depFields = this._getEditorModel().getDependentFields(controllerField);\n\t\tif (depFields && depFields.length > 0) {\n\t\t\tdepFields.forEach((field) => {\n\t\t\t\tlet value = this._getFieldValue(field);\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\t\t\tlet newOptions = new DependentPicklistBuilder(metadata, this._getFieldValue(controllerField)).build();\n\t\t\t\t\tlet values = metadata.type === 'multipicklist' ? value.split(';') : [value];\n\t\t\t\t\t// iterate through the values list, break when a value is not found in the new options list and dependent picklist is cleared\n\t\t\t\t\tvalues.some((v) => {\n\t\t\t\t\t\tlet validOption = newOptions.some((option) => {\n\t\t\t\t\t\t\treturn option.value === v;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!validOption) {\n\t\t\t\t\t\t\t// no valid option matches the current value so clear it out\n\t\t\t\t\t\t\tthis._clearFieldValue(field);\n\t\t\t\t\t\t\t// propagate the update further downstream when there's a dependency chain\n\t\t\t\t\t\t\tthis._updateDependentPicklist(field);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t_handleChangeControllingField(controllingFieldName, controllingFieldValue) {\n\t\tthis.getControllingFields().forEach((controllingField) => {\n\t\t\tif (controllingField.getFieldName() == controllingFieldName) {\n\t\t\t\tcontrollingField.updateControlledFields(this, controllingFieldValue);\n\t\t\t}\n\t\t});\n\t}\n\n\n\t/**\n\t * Format the new value that the user has inputted.\n\t * And add it to the field's template instance\n\t * @param field\n\t * @param metadata\n\t * @implements SFInlineEditBehavior._formatNewValue\n\t * @returns newValue\n\t * @private\n\t */\n\t_formatNewValue(field, metadata) {\n\t\tlet newValue = this._getFieldValue(field);\n\n\t\tlet updatedMetadata;\n\t\t// Deep copy metadata so as not to effect the integrity of metadata elsewhere and override it with correct scale for quantity\n\t\tif (field === QuoteContext.constants.QUANTITY_FIELD && metadata.scale !== this.lineModel.lineVO.productQuantityScale && this.lineModel.lineVO.productQuantityScale != null) {\n\t\t\tupdatedMetadata = JSON.parse(JSON.stringify(metadata));\n\t\t\tupdatedMetadata.scale = this.lineModel.lineVO.productQuantityScale;\n\t\t}\n\t\t\n\t\tlet metadataToUse = updatedMetadata ? updatedMetadata : metadata;\n\t\tlet formattedValue = Formatter.formatFieldData(this.lineModel, newValue, metadataToUse, this._getRecord());\n\t\tthis._restampField(field, formattedValue);\n\t\treturn newValue;\n\t}\n\n\thook_onHovered(evt) {\n\t\tif (this.isSegmented) {\n\t\t\tthis._handleSegmentedCellHover(evt);\n\t\t}\n\t\tthis._handleEditableCellsHover();\n\t}\n\n\t// QLE table only tap handling\n\thook_onTap(evt, handled, containerEditable) {\n\t\tlet editorModel = this._getEditorModel();\n\t\tthis._deviceDelegate.onTap(evt, this);\n\n\t\t// checkbox selection or boolean field edit\n\t\tlet cbContainer = this.findElementForEvent(evt, 'checkboxcontainer');\n\t\tif (cbContainer) {\n\t\t\tthis.toggleCheckbox(cbContainer);\n\t\t}\n\n\t\tif (!handled) {\n\t\t\t// drawer icon\n\t\t\tif (editorModel.hasDrawerFields()) {\n\t\t\t\tlet drawerContainer = this.findElementForEvent(evt, 'drawerContainer');\n\t\t\t\tif (drawerContainer) {\n\t\t\t\t\tthis.toggleDrawer();\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Segmented line drawer\n\t\t\tif (this.lineModel.segments) {\n\t\t\t\tlet segmentedContainer = this.findElementForEvent(evt, 'segmentedContainer');\n\t\t\t\tif (segmentedContainer) {\n\t\t\t\t\tthis.toggleDrawer();\n\t\t\t\t}\n\t\t\t}\n\t\t\t// collapsible bundle\n\t\t\tif (AppContext.isBundleCollapsible(this._getEditorModel())) {\n\t\t\t\tlet caret = this.findElementForEvent(evt, 'collapsible-bundle');\n\t\t\t\tif (caret) {\n\t\t\t\t\tthis.toggleBundleExpansion();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(event) {\n\t\tthis._deviceDelegate.onKeyDown(event, this);\n\t}\n\n\tonRowSwiped(event) {\n\t\tthis._deviceDelegate.onRowSwiped(event, this);\n\t}\n\n\t/**\n\t * Toggle the value of a checkbox/boolean field or row select checkbox\n\t * This also causes lineModel.selected (for row selection) or lineModel.lineVO.record.[field] value (for boolean field) to change and triggers event listener to react if applicable\n\t * @param cbContainer The div with 'checkboxcontainer' class\n\t * @private\n\t */\n\ttoggleCheckbox(cbContainer) {\n\t\tif (cbContainer && cbContainer.parentElement) {\n\t\t\tlet grandParentElem = cbContainer.parentElement.parentElement;\n\t\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\t\tif (grandParentElem && cb) {\n\t\t\t\tif (grandParentElem.classList.contains(TemplateGenerator.classNames.EDITABLE)) {\n\t\t\t\t\tlet fieldName = grandParentElem.getAttribute('field');\n\t\t\t\t\tif (fieldName) {\n\t\t\t\t\t\t// it's an editable boolean field\n\t\t\t\t\t\tthis.set(`lineModel.lineVO.record.${fieldName}`, !cb.checked);\n\t\t\t\t\t\tif (this._calculateImmediately(fieldName)) {\n\t\t\t\t\t\t\tthis.fire('calculate-immediately');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (cbContainer.parentElement.classList.contains(TemplateGenerator.classNames.SELECTION) && this._getEditorModel().data.settings.multiLineDeleteEnabled) {\n\t\t\t\t\t// row selection checkbox\n\t\t\t\t\tthis.set('lineModel.selected', !cb.checked);\n\t\t\t\t\tif (cb.checked) {\n\t\t\t\t\t\tthis.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key] = this.lineModel;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Toggle drawer component for this row\n\t */\n\ttoggleDrawer() {\n\t\t// toggle data model, this causes the drawer to expand/collapse via 2-way binding\n\t\tthis.toggleExpanded();\n\t\t// extra event to tell iron-list to resize when LQE is enabled\n\t\tif(this._getEditorModel().largeQuoteExperienceEnabled || this._getEditorModel().isMultiGroupViewEnabled) {\n\t\t\tthis.fire('line-toggled', {index: this._getLineNumber() - 1});\n\t\t}\n\t}\n\n\ttoggleExpanded() {\n\t\tlet expanded = !this.lineModel.lineVO.expanded;\n\t\tthis.set('lineModel.lineVO.expanded', expanded);\n\t\treturn expanded;\n\t}\n\n\t/**\n\t * Invoked when line's expanded state changes\n\t * @param newValue the new value for lineModel.lineVO.expanded\n\t * @param oldValue the old value for lineModel.lineVO.expanded\n\t * @private\n\t */\n\t_expansionChanged(newValue, oldValue) {\n\t\tthis._deviceDelegate.expansionChanged(newValue, oldValue, this);\n\t}\n\n\t/**\n\t * Toggle a parent line's expansion state\n\t */\n\ttoggleBundleExpansion() {\n\t\tconst isCollapsed = !this.lineModel.bundleCollapsed;\n\t\tthis.set('lineModel.bundleCollapsed', isCollapsed);\n\t}\n\n\t/**\n\t * Invoked when bundle's caret is clicked to toggle expansion/collapse state of this line's children\n\t * Fires a bundle-toggled event for the table component to expand/collapse the children lines\n\t * @private\n\t */\n\t_bundleExpansionChanged(newValue) {\n\t\tif (newValue === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tconst cacheKey = 'l' + this.lineModel.lineVO.key;\n\t\tconst cachedCollapsed = readFromCache('BundleCollapsed', [cacheKey]);\n\t\t// line data is spliced when lines are sorted,\n\t\t// so we want to make sure if new value hasn't changed we don't do anything\n\t\tif (cachedCollapsed === newValue) {\n\t\t\treturn;\n\t\t}\n\t\tthis._restampField('_caretContent', newValue ?\n\t\t\tTemplateGenerator.classNames.CHEVRON_RIGHT_CONTENT :\n\t\t\tTemplateGenerator.classNames.CHEVRON_DOWN_CONTENT);\n\t\t// it's necessary to postpone the event firing til after the current tick\n\t\t// since this method may be invoked as a result of handling bundle-toggled\n\t\t// and polymer seems to ignore the event firing when it's in the same event cycle\n\t\tsetTimeout(() => {\n\t\t\tthis.fire('bundle-toggled', { key: this.lineModel.lineVO.key, expanded: !newValue });\n\t\t});\n\t\t// preserve bundle collapse state in client cache\n\t\tupdateCache('BundleCollapsed', ['l' + this.lineModel.lineVO.key], newValue);\n\t}\n\n\t/**\n\t * Invoked when line's selection state changes\n\t * @private\n\t */\n\t_selectionChanged() {\n\t\tlet cbContainer = this.$$('.checkboxcontainer');\n\t\tif (cbContainer && !cbContainer.classList.contains(TemplateGenerator.classNames.DISABLED)) {\n\t\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\t\tcb.checked = this.lineModel.selected;\n\t\t}\n\t}\n\n\t_getFieldMetadata(field, quoteRecord) {\n\t\treturn this._getEditorModel().getFieldMetadata(field, quoteRecord);\n\t}\n\n\t_getEditorModel() {\n\t\treturn this.lineModel.editorModel;\n\t}\n\n\t_getLineNumber() {\n\t\treturn this.uiData.lineNumber;\n\t}\n\n\t_getRecord() {\n\t\treturn this.uiData.lineModel.lineVO.record;\n\t}\n\n\t_getOriginalRecord() {\n\t\treturn this.uiData.lineModel.lineVO.ui_original_record;\n\t}\n\n\t_isEditable(field) {\n\t\treturn this.uiData.lineModel.isEditable(field);\n\t}\n\n\t_getFieldValue(field) {\n\t\treturn this._getRecord()[field];\n\t}\n\n\t/**\n\t * Clear record's field value via Polymer API\n\t * @param field\n\t * @private\n\t */\n\t_clearFieldValue(field) {\n\t\tthis.set(`lineModel.lineVO.record.${field}`, null);\n\t\tif (this.templateInstance) {\n\t\t\tthis._restampField(field, null);\n\t\t}\n\t}\n\n\t/**\n\t * Update record's field value via Polymer API\n\t * @param field\n\t * @param value\n\t * @private\n\t */\n\t_updateFieldValue(field, value) {\n\t\tthis.set(`lineModel.lineVO.record.${field}`, value);\n\t}\n\n\t/**\n\t * Event bus registration\n\t * @param model\n\t * @private\n\t */\n\t_modelChanged() {\n\t\tregisterComponent(this, 'lineModel');\n\t\t// register DnD track listener\n\t\tthis.unlisten(this, 'track', 'onTrack');\n\t\tif (this._isDragAndDropEnabled()) {\n\t\t\tthis.listen(this, 'track', 'onTrack');\n\t\t}\n\t}\n\n\t/**\n\t * DnD is enabled only for non-LQE desktop\n\t * @returns {*|boolean}\n\t * @private\n\t */\n\t_isDragAndDropEnabled() {\n\t\treturn AppContext.isDesktop && !this.lineModel.editorModel.largeQuoteExperienceEnabled;\n\t}\n\n\t/**\n\t * Lazy load segmented cell tooltip\n\t * @private\n\t */\n\t_handleSegmentedCellHover(evt) {\n\t\tlet fieldContainer = this.findElementForEvent(evt, 'container');\n\t\tif (fieldContainer) {\n\t\t\tlet field = fieldContainer.getAttribute('field');\n\t\t\tif (field && !field.endsWith('__c') && field !== 'total') {\n\t\t\t\tif (!fieldContainer.querySelector('paper-tooltip')) {\n\t\t\t\t\tlet tooltipCmp = document.createElement('paper-tooltip');\n\t\t\t\t\ttooltipCmp.position = 'bottom';\n\t\t\t\t\ttooltipCmp.animationDelay = 0;\n\t\t\t\t\tfieldContainer.appendChild(tooltipCmp);\n\t\t\t\t\tlet tooltipBody = document.createElement('sf-segmented-cell-tooltip');\n\t\t\t\t\ttooltipBody.lineModel = this.lineModel;\n\t\t\t\t\ttooltipBody.field = field;\n\t\t\t\t\tPolymer.dom(tooltipCmp).appendChild(tooltipBody);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Lazy load pencil icons for editable cells\n\t * @private\n\t */\n\t_handleEditableCellsHover(forceLoad) {\n\t\tif (!this._pencilLoaded || forceLoad) {\n\t\t\tlet editableCells = this.querySelectorAll('.container.editable');\n\t\t\tif (editableCells && editableCells.length > 0) {\n\t\t\t\tlet cellsArr = Array.from(editableCells);\n\t\t\t\tlet resizeRow = false;\n\t\t\t\tcellsArr.forEach((cell) => {\n\t\t\t\t\tif (!cell.querySelector('span.pencil')) {\n\t\t\t\t\t\tresizeRow = true;\n\t\t\t\t\t\tlet pencilSpan = document.createElement('span');\n\t\t\t\t\t\tpencilSpan.classList.add(TemplateGenerator.classNames.EDIT_ICON);\n\t\t\t\t\t\tif (cell.classList.contains(TemplateGenerator.classNames.RIGHT) ||\n\t\t\t\t\t\t\tcell.classList.contains(TemplateGenerator.classNames.CENTER)) {\n\t\t\t\t\t\t\tlet readElem = cell.querySelector('div.r');\n\t\t\t\t\t\t\treadElem.insertBefore(pencilSpan, readElem.firstChild);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcell.querySelector('div.r').appendChild(pencilSpan);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t\t\t});\n\n\t\t\t}\n\t\t\tthis._pencilLoaded = true;\n\t\t}\n\t}\n\n\t/**\n\t * Whether AdditionalDiscount field has new value\n\t * @param originalValues\n\t * @param field\n\t * @private\n\t */\n\t_isAdditionalDiscountUpdated(originalValues, field) {\n\t\tlet originalModel = {\n\t\t\teditorModel: this._getEditorModel(),\n\t\t\tconstants: this.uiData.lineModel.constants,\n\t\t\tlineVO: this.uiData.lineModel.lineVO,\n\t\t\tgetField: (f) => {\n\t\t\t\treturn originalValues[f];\n\t\t\t},\n\t\t\tgetLineVOProperty: (f) => {\n\t\t\t\treturn originalValues[f];\n\t\t\t}\n\t\t};\n\t\tconst original = getUnitAndDisplayValue(originalModel, field);\n\t\tconst current = getUnitAndDisplayValue(this.uiData.lineModel, field);\n\t\treturn original.displayValue !== current.displayValue || original.unit !== current.unit;\n\t}\n\n\t/**\n\t * Invoked when column width valuees are changed\n\t * @param newValue\n\t * @param oldValue\n\t * @private\n\t */\n\t_columnsResized(newValue, oldValue) {\n\t\t// only interested in resizing, i.e., when old value is already set\n\t\tif (newValue != null && oldValue != null) {\n\t\t\tObject.keys(newValue).forEach((field) => {\n\t\t\t\tlet container = this.$$(`div.container[field='${field}']`);\n\t\t\t\tif (container) {\n\t\t\t\t\tcontainer.style.minWidth = newValue[field] + 'px';\n\t\t\t\t\tcontainer.style.maxWidth = newValue[field] + 'px';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonTrack(e) {\n\t\tif (e) {\n\t\t\tif (this.querySelector(\"div.w\")) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// ignore track event when resizing of dialog or textarea\n\t\t\tlet path = Polymer.dom(e).path;\n\t\t\tfor (let a = 0, l = path.length; a < l; a++) {\n\t\t\t\tlet nodeName = path[a].nodeName;\n\t\t\t\tif (nodeName === 'SB-DIALOG' || nodeName === 'TEXTAREA') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.domHost.onTrack(e);\n\t\t}\n\t}\n\n\t/**\n\t * Provide a deep clone of this node for drag & drop (see DragDropModel#_clonePolyerElement)\n\t * This method strictly clones DOM elements, without any component property or listeners\n\t * @returns {*} A deep clone of this node with all its child elements.\n\t */\n\tdeepCloneNode() {\n\t\tlet clone = this.cloneNode(true);\n\t\tlet contentChild = this.$$('#content div:first-child').cloneNode(true);\n\t\tclone.querySelector('#content').appendChild(contentChild);\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Apply focus on the given container cell in some special cases\n\t * @param container\n\t * @param evt\n\t * @private\n\t */\n\t_applyFocus(container, evt) {\n\t\tthis._deviceDelegate.applyFocus(container, evt, this);\n\t}\n\n\t/**\n\t *  Determine if we should calculate immediately\n\t *\n\t *  A Discount type cannot be changed and doesn't need calculating\n\t *  when Target Customer Total is active\n\t * @param field\n\t * @returns {*}\n\t * @private\n\t */\n\t_calculateImmediately(field) {\n\t\tif (!AppContext.org.calculateImmediately) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tlet hasCustomerTotalValue = this.lineModel.quoteModel.quoteVO.record[QuoteContext.constants.TARGET_CUSTOMER_AMOUNT] != null;\n\t\t\tif (!hasCustomerTotalValue) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst discountConstants = [QuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD,\n\t\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,\n\t\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD];\n\n\t\t\tfor (let i = 0; i < discountConstants.length; i++) {\n\t\t\t\tif (discountConstants[i] === field) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\ttoggleCellClass(cellClass, value, container, field) {\n\t\tthis.toggleClass(cellClass, value, container);\n\t\tif (this.lineModel) {\n\t\t\tconst fieldClasses = this.lineModel.cellClasses[field] || { };\n\t\t\tfieldClasses[cellClass] = value;\n\t\t\tthis.lineModel.cellClasses[field] = fieldClasses;\n\t\t}\n\t}\n\n\t/**\n\t * Gets the field metadata used for inline edit\n\t * Called by SFInlineEditBehavior.js\n\t * @param field\n\t * @return fieldMetadata\n\t */\n\t_getFieldMetadataForInlineEdit(field) {\n\t\treturn this._getFieldMetadata(field, this.lineModel.quoteModel.quoteVO.record);\n\t}\n\n\t/**\n\t * Toggle inline edit on device delegate\n\t * Called by SFInlineEditBehavior.js\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t * @param suppressCalculateImmediately\n\t */\n\ttoggleInlineEditForDeviceDelegate(container, isEdit, field, metadata, suppressCalculateImmediately) {\n\t\tthis._deviceDelegate.toggleInlineEdit(container, isEdit, field, metadata, this, suppressCalculateImmediately);\n\t}\n\n\t/**\n\t * Determine if calculate immediately should be fired for inline edit\n\t * Called by SFInlineEditBehavior.js\n\t * @param field\n\t */\n\tfireCalculateImmediately(field) {\n\t\tif (this._calculateImmediately(field)) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the field value has changed and takes into account additional discount field\n\t * Called by SFInlineEditBehavior.js\n\t * @param newValue - the new record value\n\t * @param originalValues - the old record values\n\t * @param field - the field in question\n\t */\n\tcheckIsDirty(newValue, originalValues, field) {\n\t\treturn QuoteContext.isDiscountField(field) ?\n\t\t\tthis._isAdditionalDiscountUpdated(originalValues, field) :\n\t\t\tnewValue !== originalValues[field];\n\t}\n\n\t/**\n\t * Checks if the field has controlling picklist or fields\n\t * Called by SFInlineEditBehavior.js\n\t * @param metadata\n\t * @param field\n\t * @param eventType\n\t * @param eventDetail\n\t */\n\thandleControllingPicklistAndFields(metadata, field, eventType, eventDetail) {\n\t\tif (metadata.controllingPicklist) {\n\t\t\t// dependent picklist handling\n\t\t\tthis._updateDependentPicklist(field);\n\t\t} else if (metadata.relationshipName && eventType === 'lookup-value-changed') {\n\t\t\t// reference field also need updating of its relationship field (__r)\n\t\t\tthis._getRecord()[metadata.relationshipName] = eventDetail.value == null ? undefined : {\n\t\t\t\tId: eventDetail.value,\n\t\t\t\tName: eventDetail.refDisplay\n\t\t\t}\n\t\t} else {\n\t\t\tthis._handleChangeControllingField(metadata.name, eventDetail.value);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the edit field\n\t * Called by SFInlineEditBehavior.js\n\t * @param metadata\n\t * @param index\n\t */\n\t_getEditField(metadata, index) {\n\t\treturn SFComponentFactory.getFieldComponent(metadata, this.lineModel, index);\n\t}\n\n\t/**\n\t * @implements SFTableRowBehavior.getCellClass\n\t * @returns {string}\n\t */\n\tgetCellClass() {\n\t\treturn 'sf-le-table-cell';\n\t}\n}\n\nPolymer( SFLETableRow );\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class SubscriptionTypeControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.SUBSCRIPTION_TYPE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.SUBSCRIPTION_TERM_FIELD,\n\t\t\tQuoteContext.constants.END_DATE_FIELD,\n\t\t\tQuoteContext.constants.EFFECTIVE_END_DATE_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn ['', 'Renewable', 'One-time'];\n\t}\n\n\t_getControlledFieldValue(/*String*/ controlledField, /*Object*/ controllingFieldValue, /*Boolean*/ toggledEditable) {\n\t\tif (controlledField === QuoteContext.constants.SUBSCRIPTION_TERM_FIELD) {\n\t\t\tif (controllingFieldValue === 'Evergreen') {\n\t\t\t\treturn 1;\n\t\t\t} else if (toggledEditable) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\t_shouldClearFieldValue() {\n\t\treturn true;\n\t}\n}\n\n\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n/**\n * Line action component that encapsulates the info icon as well as visible actions for the given line\n * Note that for simplified usability and better performance, menu is no longer supported in line actions\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFLineActions {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-line-actions';\n\n\t\tthis.properties = {\n\t\t\tlineModel: {          // line model\n\t\t\t\tObject,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tactions: Array,       // list of actions to be displayed\n\t\t\tshowInfoIcon: {       // whether info icon should be displayed\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isShowInfoIcon(lineModel)'\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.REFRESH_LINE_ACTIONS] = this._modelChanged;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\tthis.toggleClass('mobile', AppContext.isMobile);\n\t}\n\n\tattached() {\n\t\tthis._actionHandler = this.handleAction.bind(this);\n\t\tthis.addEventListener('tap', this._actionHandler, { passive: true });\n\t\t// Discount Schedule button also listens to mouseenter and mouseleave\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tconst dsModalBtn = this.querySelector('button.showDSModal');\n\t\t\tif (dsModalBtn) {\n\t\t\t\tdsModalBtn.addEventListener('mouseenter', this._actionHandler, {passive: true});\n\t\t\t\tdsModalBtn.addEventListener('mouseleave', this._actionHandler, {passive: true});\n\t\t\t}\n\t\t});\n\t}\n\n\tdetached() {\n\t\tif (this._actionHandler) {\n\t\t\tthis.removeEventListener('tap', this._actionHandler);\n\t\t\tconst dsModalBtn = this.querySelector('button.showDSModal');\n\t\t\tif (dsModalBtn) {\n\t\t\t\tdsModalBtn.removeEventListener('mouseenter', this._actionHandler);\n\t\t\t\tdsModalBtn.removeEventListener('mouseleave', this._actionHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update list of actions after lineModel is populated, so that only visible actions are rendered\n\t * @private\n\t */\n\t_modelChanged() {\n\t\tif (this.lineModel && this.lineModel instanceof LineModel) {\n\t\t\tthis.actions = this.lineModel.editorModel.lineCustomActions.filter((action) => {\n\t\t\t\treturn !action.isHidden(this.lineModel);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when action is tapped, or hovered when it's show discount schedule\n\t */\n\thandleAction(e) {\n        const actionName = e.target.name;\n        if (actionName) {\n            const action = this.actions.find((a) => {\n                return a.name === actionName;\n            });\n            if (action) {\n                if (action.eventHandlerName === \"showDSModal\") {\n                \tfireEvent(Events.SCHEDULE_ACTION, { event: e, model: this.lineModel });\n                } else if (e.type === 'tap') {\n                \tconst eventFunc = () => {\n\t\t\t\t\t\tthis.fire('le-action-tapped', {\n\t\t\t\t\t\t\tcustomAction: action,\n\t\t\t\t\t\t\tmodel: this.lineModel\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n                \tif (action.eventHandlerName === 'onCloneLine') {\n\t\t\t\t\t\t// debounce clone action firing to prevent continuous rapid click\n\t\t\t\t\t\tif (this._timeout) {\n\t\t\t\t\t\t\tclearTimeout(this._timeout);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._timeout = setTimeout(() => {\n\t\t\t\t\t\t\teventFunc();\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t} else {\n                \t\teventFunc();\n\t\t\t\t\t}\n                }\n            }\n        }\n    }\n\n\t/**\n\t * Info icon is displayed when line has parent and in desktop mode\n\t * @param lineModel\n\t * @returns {boolean|*}\n\t * @private\n\t */\n\t_isShowInfoIcon(lineModel) {\n\t\treturn !AppContext.isMobile && lineModel && lineModel.hasParent;\n\t}\n\n}\n\nPolymer( SFLineActions );","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n/**\n * Light-weight component for line warning icon and tooltip\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFLineWarning {\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-line-warning';\n\n\t\tthis.properties = {\n\n\t\t\tkey: String,        // warning message i18n key\n\n\t\t\tmessage: String,    // warning message (default)\n\t\t}\n\t}\n}\n\nPolymer (SFLineWarning);","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport { TemplatizationBehavior } from 'common/behaviors/TemplatizationBehavior.js';\nimport { ListItemTemplateGenerator } from 'quotes/layout/template-generator/ListItemTemplateGenerator.js';\nimport { Formatter } from 'common/formatter/Formatter.js';\n\n/**\n * Generic purpose preview panel\n *\n * @author kzheng\n * @since 216\n *\n */\nexport class PreviewPanel {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.TemplatizationBehavior ];\n\t}\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-preview-panel';\n\n\t\tthis.properties = Polymer.Base.extend({\n\n\t\t\t// css class for the title icon\n\t\t\ticonClass: String,\n\n\t\t\t// title content\n\t\t\ttitle: String,\n\n\t\t\t// array of label and value, e.g., {field: 'account', value: 'Acme Inc'}\n\t\t\tdata: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserver: '_dataChanged'\n\t\t\t},\n\n\t\t\t// map of field -> metadata ( e.g., {price: {type: 'currency', label: 'Account'}})\n\t\t\tmetadata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_dataChanged'\n\t\t\t},\n\t\t\t\n\t\t\t// extra options for template generator\n\t\t\ttemplateOptions: Object,\n\t\t\t\n\t\t\t// extra ui data\n\t\t\tadditionalUIData: Object,\n\t\t\t\n\t\t}, TemplatizationBehavior.properties);\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.querySelector('.dataList'), true);\n\t\t}\n\t}\n\n\t_dataChanged() {\n\t\tif (this.data && this.metadata) {\n\t\t\tlet fields = Object.keys(this.metadata);\n\t\t\tlet labelsMap = Object.keys(this.metadata).reduce((acc, field) => {\n\t\t\t\tacc[field] = this.metadata[field].label;\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\tthis.templateHTML = new ListItemTemplateGenerator(this.metadata, this.templateOptions).generate(fields, labelsMap);\n\t\t\tlet uiData = Object.keys(this.metadata).reduce((acc, field) => {\n\t\t\t\tlet datum = this.data.find((datum) => datum.field === field);\n\t\t\t\tlet value = datum ? datum.value : '';\n\t\t\t\tacc[field] = Formatter.formatFieldData(null, value, this.metadata[field], this.data);\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\tif (this.additionalUIData) {\n\t\t\t\tuiData = Object.assign(uiData, this.additionalUIData);\n\t\t\t}\n\t\t\tthis.uiData = uiData;\n\t\t}\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#getContentNode\n\t */\n\tgetContentNode() {\n\t\treturn this.querySelector('.dataList');\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#isTemplatizeWithRootDivNode\n\t */\n\tisTemplatizeWithRootDivNode() {\n\t\treturn false;\n\t}\n}\n\nPolymer( PreviewPanel );","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {SFTableRowBehavior} from 'common/behaviors/SFTableRowBehavior.js';\nimport {TemplatizationBehavior} from 'common/behaviors/TemplatizationBehavior.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n/**\n * Tooltip content for segmented table cells\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFSegmentedCellTooltip {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.SFTableRowBehavior, window.CommonBehaviors.TemplatizationBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-segmented-cell-tooltip';\n\n\t\tthis.properties = {\n\n\t\t\tlineModel: Object,          // the line model\n\n\t\t\tfield: String,              // the field for which the tooltip content is to be rendered\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_initObserver(lineModel, field)'\n\t\t];\n\t}\n\n\tready() {\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\t}\n\n\t_initObserver (lineModel, field) {\n\t\tif (lineModel === undefined || field === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._init(lineModel, field);\n\t}\n\t\n\t/**\n\t * Initialize the tooltip content by finding the segmented lineModel, then constructing the table content\n\t * @private\n\t */\n\t_init() {\n\t\tif (this.lineModel && this.field) {\n\t\t\tlet segmentedModel = this._getSegmentedLine();\n\n\t\t\tlet editorModel = this.lineModel.editorModel;\n\t\t\tlet fields = editorModel.data.multiSegmentLineFieldNames;\n\t\t\tlet quoteLineFields = editorModel.md.fieldsMap[editorModel.data.quoteLineObjectName];\n\t\t\tlet fieldLabels = editorModel.md.fieldLabelsMap;\n\n\t\t\t// build the data table\n\t\t\tlet uiData = this._prepareLineData(segmentedModel, fields, quoteLineFields);\n\t\t\tlet template = new TemplateGenerator().generateSegmentedTooltipFieldSetTemplate(fields, fieldLabels, editorModel);\n\t\t\tthis.templateInstance = this.hydrateTemplate(template, uiData);\n\t\t\tPolymer.dom(this.$.content).appendChild(this.templateInstance.root);\n\t\t}\n\t}\n\n\t_prepareLineData(segmentedModel, fields, quoteLineFields) {\n\t\treturn UIDataManager.prepareLineData([segmentedModel], fields, quoteLineFields)[0];\n\t}\n\n\t/**\n\t * Find the segmented line model for the field\n\t * @return {*}\n\t * @private\n\t */\n\t_getSegmentedLine() {\n\t\tlet segmentedModel = this.lineModel;\n\t\tif (this.lineModel && this.lineModel.segmentsByLabel != null) {\n\t\t\tlet key = Object.keys(this.lineModel.segmentsByLabel).find((key) => {\n\t\t\t\tif (/^\\d/.test(key)) {\n\t\t\t\t\t// If field name starts with a number we prepend _ (underscore) to allow for a valid variable name\n\t\t\t\t\t// when stamping data, account for that in our comparison (W-6479671)\n\t\t\t\t\tkey = \"_\" + key;\n\t\t\t\t}\n\t\t\t\treturn this.field === key.replace(/\\W/g, '');\n\t\t\t});\n\t\t\tif (key) {\n\t\t\t\tsegmentedModel = this.lineModel.segmentsByLabel[key];\n\t\t\t}\n\t\t}\n\t\treturn segmentedModel;\n\t}\n}\n\nPolymer(SFSegmentedCellTooltip);","import {TemplatizationBehavior} from 'common/behaviors/TemplatizationBehavior.js';\nimport {SFTableHeaderBehavior} from 'quotes/tables/SFTableHeaderBehavior.js';\nimport {TableHeaderTemplateGenerator} from \"quotes/layout/template-generator/TableHeaderTemplateGenerator.js\";\nimport { pathGet } from 'common/Util.js';\n\n/**\n * Header level component for templatizing and stamping HTML\n *\n * @author rlobo\n * @since 216\n */\nexport class SFTableHeader {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.TemplatizationBehavior, window.CommonBehaviors.SFTableHeaderBehavior ];\n\t}\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-table-header';\n\n\t\tthis.properties = Polymer.Base.extend({\n\n\t\t\t// this is an alias of TemplatizationBehavior.uiData\n\t\t\tfieldLabels: Object,\n\n\t\t\tfields: Object,\n\n\t\t\t// options for template generation\n\t\t\toptions: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t}\n\n\t\t}, TemplatizationBehavior.properties);\n\n\t\tthis.properties = Polymer.Base.extend(this.properties, SFTableHeaderBehavior.properties);\n\n\t\tthis.listeners = {\n\t\t\ttap: 'onTap',\n\t\t\tmouseover: 'onHover'\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_initObserver(fields, fieldLabels, options)'\n\t\t];\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\t}\n\n\t_initObserver (fields, fieldLabels, options) {\n\t\tif (fields === undefined || fieldLabels === undefined || options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._init(fields, fieldLabels, options);\n\t}\n\t\n\t_init(fields, fieldLabels) {\n\t\tthis.templateHTML = new TableHeaderTemplateGenerator(this.options).generate(fields);\n\t\tthis.uiData = fieldLabels;\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#getContentNode\n\t */\n\tgetContentNode() {\n\t\treturn Polymer.dom(this.$.content);\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#isTemplatizeWithRootDivNode\n\t */\n\tisTemplatizeWithRootDivNode() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetTooltipContent(field) {\n\t\treturn pathGet(this.uiData, field.split('.')) || '';\n\t}\n\n}\n\nPolymer( SFTableHeader );","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TableHeaderTemplateGenerator} from 'quotes/layout/template-generator/TableHeaderTemplateGenerator.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Template generator for QLE table header\n *\n * @author kzheng\n * @since 216\n *\n **/\n\nexport class LETableHeaderTemplateGenerator extends TableHeaderTemplateGenerator {\n\n\tconstructor(editorModel, columnWidths, segmentedColumns, allowColumnResizing = false) {\n\t\tlet options = {\n\t\t\thasSelectionColumn: editorModel.isMultiLineDeleteEnabled(),\n\t\t\thasItemNumberColumn: true,\n\t\t\tcolumnWidths: columnWidths,\n\t\t\tallowColumnResizing: allowColumnResizing,\n\t\t};\n\n\t\tsuper(options);\n\t\tthis.editorModel = editorModel;\n\t\tthis.segmentedColumns = segmentedColumns;\n\t\tthis.isSegmented = segmentedColumns ? true : false;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetLeadingColumns() {\n\t\treturn this.editorModel.actionsOnTheLeft ? '<div class=\"th lineActions\"></div>' : '';\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgetTrailingColumns() {\n\t\tlet template = this.editorModel.actionsOnTheLeft ? '' : '<div class=\"th lineActions\"></div>';\n\t\tif (!this.isSegmented && this.editorModel.hasDrawerFields()) {\n\t\t\ttemplate += this._getDrawerColumnTemplate();\n\t\t}\n\t\treturn template;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tgenerateItemNumberColumn() {\n\t\tif (this.isSegmented) {\n\t\t\treturn `<div class=\"th itemNumber segmentedDrawer\"><span>#</span><span class=\"${TemplateGenerator.classNames.RIGHT_ICON}\"></span></div>`;\n\t\t} else {\n\t\t\treturn super.generateItemNumberColumn();\n\t\t}\n\t}\n\n\t/**\n\t * Generate a column for drawer icon\n\t * @private\n\t */\n\t_getDrawerColumnTemplate() {\n\t\treturn `<div class=\"th drawerIcon\"><span class=\"${TemplateGenerator.classNames.CHEVRON_RIGHT_ICON}\"></span></div>`;\n\t}\n\n\t/**\n\t * Map of fields to text alignment\n\t * @returns left, right, or center\n\t */\n\tgetColumnAlignment(field) {\n\t\tlet fieldMd = this.editorModel.getFieldMetadata(field);\n\t\tlet segments = []\n\t\tif(this.isSegmented) {\n\t\t\tsegments = this.buildRowSegmentFieldSet(this.segmentedColumns);\n\t\t}\n\n\t\tif ((fieldMd && (fieldMd.type === 'number' || fieldMd.type === 'double' || fieldMd.type === 'percent' ||\n\t\t\tfieldMd.type === 'currency')) || segments.indexOf(field) >= 0) {\n\t\t\treturn \"rightAligned\";\n\t\t} else if (fieldMd && fieldMd.type === 'boolean') {\n\t\t\treturn \"centerAligned\";\n\t\t} else {\n\t\t\treturn \"leftAligned\";\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tisSortable(field) {\n\t\t// all fields are sortable except add'l discount field\n\t\treturn field !== this.editorModel.constants.ADDITIONAL_DISCOUNT_FIELD;\n\t}\n\n\t/**\n\t * @override\n\t * @param field\n\t */\n\tgetBeforeFieldTemplate(field) {\n\t\t// extra caret for bundle expand collapse\n\t\tif (QuoteContext.isProductNameField(field) && AppContext.isBundleCollapsible(this.editorModel) && !this.isSegmented) {\n\t\t\treturn `<span class=\"bundle-caret\" inner-h-t-m-l=\"[[_caretContent]]\"></span>`;\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Template generator for line editor\n *\n * @author kzheng\n * @since 212\n *\n **/\nexport class LETemplateGenerator extends TemplateGenerator {\n\n\tconstructor(editorModel, groupModel, segmentedColumns, dimension, isSecondary) {\n\t\tsuper();\n\t\tthis.editorModel = editorModel;\n\t\tthis.groupModel = groupModel;\n\t\tthis.segmentedColumns = segmentedColumns;\n\t\tthis.dimension = dimension;\n\t\tthis.isSecondary = isSecondary;\n\t}\n\n\t/**\n\t * Generate template for a row\n\t * @param fields\n\t * @return {string}\n\t */\n\tgenerateRow(fields) {\n\t\tlet fieldSetTemplate;\n\t\tlet isSegmented = false;\n\t\tif (!this.segmentedColumns){\n\t\t\tfieldSetTemplate = super.generateFieldSetTemplate(fields, this.groupModel, this.editorModel, this.isSecondary);\n\t\t} else {\n\t\t\t// Build field set for row segments\n\t\t\tisSegmented = true;\n\t\t\tlet segments = this.buildRowSegmentFieldSet(this.segmentedColumns);\n\t\t\tfieldSetTemplate = super.generateSegmentedFieldSetTemplate(fields, segments, this.dimension, this.groupModel, this.editorModel, this.isSecondary);\n\t\t}\n\n\t\tlet actionsTemplate = this.generateActionsTemplate();\n\n\t\tlet itemNumTemplate = this.generateItemNumberTemplate(isSegmented);\n\n\t\tlet checkboxTemplate = this.generateCheckboxTemplate('');\n\n\t\tlet drawerCellTemplate = this.generateDrawerCellTemplate();\n\n\t\tlet result = '';\n\n\t\tresult += checkboxTemplate + itemNumTemplate + fieldSetTemplate;\n\t\tresult = this.addLineActionsToTemplate(result, actionsTemplate);\n\n\t\tresult += drawerCellTemplate;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Generate action widget (info icon + action buttons)\n\t * @return {string}\n\t */\n\tgenerateActionsTemplate() {\n\t\tconst positionClass = this.editorModel.actionsOnTheLeft ? LETemplateGenerator.classNames.LEFT_ALIGNED : LETemplateGenerator.classNames.RIGHT_ALIGNED;\n\t\treturn '<div id=\"swipe-menu\" class=\"td sf-le-table-cell actionsContainer lineActions sf-le-table-row\">' +\n\t\t\t\t\t`<sf-line-actions class=\"${positionClass}\" line-model=\"[[lineModel]]\"></sf-line-actions>` +\n\t\t\t\t'</div>';\n\t}\n\n\t/**\n\t * Generate item number column\n\t * @return {string}\n\t */\n\tgenerateItemNumberTemplate(isSegmented) {\n\t\t// Build field set template for segmented columns\n\t\tconst itemNumSegmentedTemplate = isSegmented ? `<span id=\"expandCollapseIcon\" class$=\"{{computeCellClass(rowIndex, '_expansionIcon', _cellClasses)}} segmentedContainer\" ></span>` : '';\n\t\treturn `<div tabindex=\"0\" class=\"td sf-le-table-cell focusable sf-le-table-row\" id=\"itemNumber\"><span>[[lineNumber]]</span><span class=\"warning\"></span>${itemNumSegmentedTemplate}</div>`;\n\t}\n\n\t/**\n\t * Generate drawer cell column when applicable\n\t */\n\tgenerateDrawerCellTemplate() {\n\t\tconst shouldRender = !this.segmentedColumns && this.editorModel.hasDrawerFields();\n\t\tif (shouldRender) {\n\t\t\tconst collapsible = LETemplateGenerator.classNames.TAPPABLE;\n\t\t\treturn `<div tabindex=\"0\" class=\"td sf-le-table-cell focusable drawerContainer sf-le-table-row ${collapsible}\">` +\n\t\t\t\t'<span class=\"sf-icon-chevronright\"></span>' +\n\t\t\t\t'</div>';\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param field\n\t * @return {null|string}\n\t */\n\tgetColumnClass(field) {\n\t\tlet fieldMetadata = this.editorModel.getFieldMetadata(field);\n\t\t// In the case of segmented lines, fields like \"Year1\" or \"Month1\" will resolve to null/undefined\n\t\t// but the metadata should resemble that of NetTotal__c\n\t\tconst useNetTotal = fieldMetadata == null && this.segmentedColumns;\n\t\tlet fieldClass = '';\n\t\tlet type = fieldMetadata ? fieldMetadata.type : null;\n\t\tlet classNames = TemplateGenerator.classNames;\n\n\t\tif (type == 'number' || type == 'double' || type == 'percent' || type == 'currency' || useNetTotal) {\n\t\t\tfieldClass = `${classNames.RIGHT} `;\n\t\t} else if (type == 'boolean') {\n\t\t\tfieldClass = `${classNames.CENTER} ${classNames.BOOLEAN} `;\n\t\t}\n\n\t\treturn fieldClass;\n\t}\n\n\taddLineActionsToTemplate(template, actionsTemplate) {\n\t\tif(this.editorModel.actionsOnTheLeft) {\n\t\t\treturn actionsTemplate + template;\n\t\t} else {\n\t\t\treturn template + actionsTemplate;\n\t\t}\n\t}\n\n\t/**\n\t * Generate template for selection checkbox\n\t * Use computeCellClass to disable the CB on row level, for example, when the line is part of a bundled product\n\t * @param field\n\t * @return {*}\n\t */\n\tgenerateCheckboxTemplate(field) {\n\t\tlet classNames = TemplateGenerator.classNames;\n\t\tlet checkboxTemplate = '';\n\t\t//Make sure if mld is enabled, field is empty and its not a secondary field.\n\t\tif (field !== '' || (this.editorModel.isMultiLineDeleteEnabled() && field === '' && !this.isSecondary)) {\n\t\t\tif (field !== '') {\n\t\t\t\tcheckboxTemplate = super.generateCheckboxTemplate(field);\n\t\t\t} else {\n\t\t\t\tcheckboxTemplate = `<div tabindex=\"0\" class=\"td sf-le-table-cell focusable ${classNames.SELECTION} sf-le-table-row\">` +\n\t\t\t\t\t`<div class$=\"checkboxcontainer sf-le-table-row {{computeCellClass(rowIndex, '_selectionCB', _cellClasses)}}\">` +\n\t\t\t\t\tthis.generateInnerCheckboxTemplate('lineModel.selected') +\n\t\t\t\t\t'</div></div>';\n\t\t\t}\n\t\t}\n\t\treturn checkboxTemplate;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string}\n\t * @private\n\t *\n\t */\n\tgenerateProductCell(field) {\n\t\tlet template = '';\n\t\tif (!this.segmentedColumns) {\n\t\t\tlet collapsibleCls = '', isAriaButton = '';\n\t\t\tif (AppContext.isBundleCollapsible(this.editorModel)) {\n\t\t\t\tcollapsibleCls = 'collapsible-bundle ' + TemplateGenerator.classNames.TAPPABLE + ' sf-le-table-cell';\n\t\t\t\tisAriaButton = 'button';\n\t\t\t}\n\t\t\t// Create the Caret Span\n\t\t\ttemplate += `<span tabindex=\"0\" class$=\"bundle-caret ${collapsibleCls} {{computeCellClass(rowIndex, '_isFocusable', _cellClasses)}} sf-le-table-row\" role=\"${isAriaButton}\" aria-label=\"Product Name Bundle Caret\" inner-h-t-m-l=\"[[_caretContent]]\"></span> `;\n\t\t\t// If Is Bundle Collapsible create a span for the Product Name\n\t\t\tif (collapsibleCls) {\n\t\t\t\treturn template + ` <span tabindex=\"0\" class$=\"{{computeCellClass(rowIndex, '_isFocusable', _cellClasses)}} sf-le-table-cell sf-le-table-row\">[[${field}]]</span>`;\n\t\t\t}\n\t\t}\n\t\treturn template + `[[${field}]]`;\n\t}\n\n}\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\n/**\n * Template generator for items based on an unordered list (ul)\n *\n * @author kzheng\n * @since 216\n *\n **/\n\nexport class ListItemTemplateGenerator extends TemplateGenerator {\n\n\t/**\n\t * @param metadata a hash of field -> metadata or a function that fetches metadata for a given field\n\t */\n\tconstructor(metadata, options) {\n\t\tsuper();\n\t\tthis.metadata = metadata;\n\t\tthis.options = options || {};\n\t}\n\n\tgenerate(fields, fieldLabelsMap) {\n\t\tlet templateHTML = '';\n\t\tfields.forEach((field) => {\n\t\t\tlet label = fieldLabelsMap[field] || '';\n\t\t\ttemplateHTML +=\n\t\t\t\t'<li class=\"detail-block\" role=\"listitem\">' +\n\t\t\t\t\t`<div class=\"truncate\" title=\"${label}\">${label}</div>` +\n\t\t\t\t\t`<div ${this._getAttributes(field)}>` +\n\t\t\t\t\t\tthis.generateInnerFieldTemplate(field, this._getMetadata(field)) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</li>';\n\t\t});\n\t\treturn templateHTML;\n\t}\n\n\t_getMetadata(field) {\n\t\tif (typeof this.metadata === 'function') {\n\t\t\treturn this.metadata(field);\n\t\t} else {\n\t\t\treturn this.metadata[field];\n\t\t}\n\t}\n\t\n\t_getAttributes(field) {\n\t\treturn (this.options.attributes || 'class=\"truncate body\"').replace('$field', field);\n\t}\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\n\n/**\n * Mobile template generator for line editor\n *\n * @author jhang\n * @since 212\n *\n **/\nexport class MobileLETemplateGenerator extends LETemplateGenerator {\n\n\tgetPrimaryClass(colIndex, isSecondary) {\n\t\tif(!isSecondary) {\n\t\t\treturn colIndex === 0 ? 'primary first' : 'primary multi';\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * @override\n\t * override to include extra div around primary fields for mobile\n\t * @param fields\n\t * @param colWidths\n\t * @param editorModel\n\t * @param isSecondary\n\t * @param startIndex\n\t * @returns {*}\n\t */\n\tgenerateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary, startIndex = 0) {\n\t\tif(!isSecondary) {\n\t\t\treturn \"<div id='swipe-header'>\" +\n\t\t\t\tsuper.generateInnerFieldSetTemplate(fields,colWidths,editorModel,isSecondary, startIndex) + '</div>';\n\t\t} else {\n\t\t\treturn super.generateInnerFieldSetTemplate(fields,colWidths,editorModel,isSecondary, startIndex);\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * override to include swipe-container for mobile\n\t * @param fields\n\t * @returns {string}\n\t */\n\tgenerateRow(fields) {\n\t\tif(!this.isSecondary) {\n\t\t\treturn '<sb-swipe-container variant=\"ui3qle\">' + super.generateRow(fields) + '</sb-swipe-container>';\n\t\t} else {\n\t\t\treturn super.generateRow(fields);\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * override to prevent actions from showing on the left in mobile\n\t * @param template - table row template\n\t * @param actionsTemplate\n\t * @returns {*}\n\t */\n\taddLineActionsToTemplate(template, actionsTemplate) {\n\t\treturn template + actionsTemplate;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string}\n\t */\n\tgenerateActionsTemplate() {\n\t\tif(this.isSecondary) {\n\t\t\treturn '';\n\t\t} else {\n\t\t\treturn super.generateActionsTemplate();\n\t\t}\n\t}\n\n\tgetFieldLabel(fieldMetadata, isSecondary) {\n\t\tif (isSecondary && fieldMetadata) {\n\t\t\t// Mobile's Secondary fields needs a field-label to show.\n\t\t\treturn `<span class=\"field-label\">${fieldMetadata.label}</span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tgetColWidths(groupModel, dimension) {\n\t\treturn null;\n\t}\n\n\tgenerateItemNumberTemplate(isSegmented) {\n\t\treturn '';\n\t}\n\n\tgenerateDrawerCellTemplate() {\n\t\treturn '';\n\t}\n\n\t/**\n\t * @Override\n\t * @returns {string}\n\t * @private\n\t */\n\tgenerateProductCell(field) {\n\t\treturn `[[${field}]]`;\n\t}\n\n}\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {AppContext} from \"common/core/AppContext.js\";\n/**\n * Generic template generator for table header\n *\n * @author kzheng\n * @since 216\n *\n **/\nexport class TableHeaderTemplateGenerator extends TemplateGenerator {\n\n\t/**\n\t * Available options params:\n\t * columnWidths: field -> integer column width map in pixels\n\t * hasSelectionColumn: whether a checkbox select all column should be rendered\n\t * hasItemNumberColumn: whether an item number column should be rendered\n\t * isSortable: a function that takes a field to determine if a field should be sortable\n\t *\n\t * @param options\n\t */\n\tconstructor(options) {\n\t\tsuper();\n\t\tthis.options = options || {};\n\t}\n\n\t/**\n\t * Generate a div element with innerHTML populated with field template\n\t * @param fields\n\t * @param attributes\n\t * @return a div node with generated template as innerHTML\n\t */\n\tgenerateHeaderNode(fields, attributes) {\n\t\tif(this.isSegmented) {\n\t\t\tfields = fields.concat(this.buildRowSegmentFieldSet(this.segmentedColumns));\n\t\t}\n\t\tlet src = this.generate(fields);\n\t\tlet node = document.createElement('div');\n\t\tif (attributes) {\n\t\t\tObject.keys(attributes).forEach((attr) => {\n\t\t\t\tnode.setAttribute(attr, attributes[attr]);\n\t\t\t});\n\t\t}\n\t\tnode.innerHTML = src;\n\t\treturn node;\n\t}\n\n\t/**\n\t * Generate HTML template for table header for the given list of fields\n\t * @param fields\n\t * @override\n\t */\n\tgenerate(fields) {\n\t\tlet template = this.getLeadingColumns();\n\t\t// selection column\n\t\ttemplate += this.hasSelectionColumn() ? this.generateSelectionColumn() : '';\n\t\t// item number column\n\t\ttemplate += this.hasItemNumberColumn() ? this.generateItemNumberColumn() : '';\n\t\tlet colWidths = this.getColumnWidths();\n\t\tlet widthUnit = this.getColumnWidthUnit();\n\t\t// field columns\n\t\tfields.forEach((field) => {\n\t\t\tconst colAdjBar = this.generateColAdjBar();\n\t\t\t//get text alignment based on field type\n\t\t\tlet colAlignment = this.getColumnAlignment(field);\n\t\t\tlet sortableCls = '';\n\t\t\tlet sortArrow = '';\n\t\t\tif (this.isSortable(field)) {\n\t\t\t\tsortableCls = 'sortable';\n\t\t\t\tsortArrow = '<i class=\"arrow sf-icon-arrowup\"></i>';\n\t\t\t}\n\t\t\ttemplate += `<div field=\"${field}\" class=\"th ${colAlignment} arrow-on-hover ${sortableCls}\"`;\n\t\t\tif (colWidths && colWidths[field]) {\n\t\t\t\tif (widthUnit === 'px') {\n\t\t\t\t\ttemplate += ` style=\"min-width:${colWidths[field]}px;max-width:${colWidths[field]}px\"`;\n\t\t\t\t} else {\n\t\t\t\t\ttemplate += ` style=\"width:${colWidths[field]}${widthUnit}\"`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet beforeFieldTemplate = this.getBeforeFieldTemplate(field) || '';\n\t\t\ttemplate += `>${beforeFieldTemplate}[[${field}]]${sortArrow}${colAdjBar}</div>`;\n\t\t});\n\t\ttemplate += this.getTrailingColumns();\n\t\ttemplate += this.generateColumnIndicator();\n\t\treturn template;\n\t}\n\n\t/**\n\t * Optional template to be supplied by implementing classes\n\t * @returns {string}\n\t */\n\tgetBeforeFieldTemplate(field) {\n\t\treturn ''\n\t}\n\n\t/**\n\t * @param field\n\t * @returns {boolean} True when a column is sortable\n\t */\n\tisSortable(field) {\n\t\tif (typeof this.options.isSortable === 'function') {\n\t\t\treturn this.options.isSortable(field);\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Extra column alignment class\n\t * @param field\n\t * @returns {string}\n\t */\n\tgetColumnAlignment(field) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Extra column template HTML preceding selection, item number and field columns\n\t * @returns {string}\n\t */\n\tgetLeadingColumns() {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Extra column template HTML after field columns\n\t * @returns {string}\n\t */\n\tgetTrailingColumns() {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Map of column widths for fixed-width column rendering\n\t * @returns {{}}\n\t */\n\tgetColumnWidths() {\n\t\treturn this.options.columnWidths || {};\n\t}\n\n\t/**\n\t * @returns {*|string} column width unit, default to px\n\t */\n\tgetColumnWidthUnit() {\n\t\treturn this.options.columnWidthUnit || 'px';\n\t}\n\n\thasSelectionColumn() {\n\t\treturn this.options.hasSelectionColumn === true;\n\t}\n\n\thasItemNumberColumn() {\n\t\treturn this.options.hasItemNumberColumn === true;\n\t}\n\n\tgenerateSelectionColumn() {\n\t\tconst cbTemplate = this.generateInnerCheckboxTemplate(null);\n\t\treturn `<div class=\"th selection\"><div class=\"checkboxcontainer\">${cbTemplate}</div></div>`;\n\t}\n\n\t/**\n\t * Column Adjustment Divider that spans vertically to display what\n\t * the new column size will look like\n\t * @returns {string}\n\t */\n\tgenerateColumnIndicator() {\n\t\tif (AppContext.isColumnResizingEnabled && !AppContext.isMobile && this.options.allowColumnResizing) {\n\t\t\tconst colDivider = '<span id=\"col-adj-divider\"></span>';\n\t\t\treturn '<div id=\"col-resize-indicator\">' + colDivider + '</div>';\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * Generate item number column\n\t * @returns {string}\n\t */\n\tgenerateItemNumberColumn() {\n\t\treturn '<div class=\"th itemNumber\"><span>#</span></div>';\n\t}\n\n\n}","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\n/**\n * Table Row Template generator\n *\n * @author thane.fenton\n * @since 216\n *\n **/\n\nexport class TableRowTemplateGenerator extends TemplateGenerator {\n\n\tconstructor(metadata, options) {\n\t\tsuper();\n\t\tthis.metadata = metadata;\n\t\tthis.options = options || {};\n\t}\n\n\t/**\n\t * Generate template for a row\n\t * @param fields\n\t * @return {string}\n\t */\n\tgenerateRow(fields) {\n\t\tlet template = '';\n\t\tlet colWidths = this.getColumnWidths();\n\t\tlet widthUnit = this.getColumnWidthUnit();\n\t\tfor (let i = 0; i < fields.length; i ++) {\n\t\t\ttemplate += `<div tabindex=\"0\" ${this.getAttributes(fields[i])}`;\n\t\t\tif (colWidths && colWidths[fields[i]]) {\n\t\t\t\tif (widthUnit === 'px') {\n\t\t\t\t\ttemplate += ` style=\"min-width:${colWidths[fields[i]]}px;max-width:${colWidths[fields[i]]}px\"`;\n\t\t\t\t} else {\n\t\t\t\t\ttemplate += ` style=\"width:${colWidths[fields[i]]}${widthUnit}\"`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemplate += ` index=\"${i}\" field=\"${fields[i]}\" >`;\n\t\t\ttemplate += '<div class=\"r\">';\n\t\t\ttemplate += this.generateInnerFieldTemplate(fields[i], this.metadata[i]);\n\t\t\ttemplate += '</div>'; // end of r div\n\t\t\ttemplate += '</div>';\n\t\t}\n\t\treturn template;\n\t}\n\n\t/**\n\t * Map of column widths for fixed-width column rendering\n\t * @returns {{}}\n\t */\n\tgetColumnWidths() {\n\t\treturn this.options.columnWidths || {};\n\t}\n\n\t/**\n\t * @returns {*|string} column width unit, default to px\n\t */\n\tgetColumnWidthUnit() {\n\t\treturn this.options.columnWidthUnit || 'px';\n\t}\n\n\tgetAttributes(field) {\n\t\treturn (this.options.attributes || '').replace(/\\$field/g, field);\n\t}\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {toFieldName} from 'common/Util.js';\n\n/**\n * Template generator for QLE table row\n *\n * @author kzheng\n * @since 212\n *\n */\n\nconst CLASS_NAMES = {\n\tCHEVRON_DOWN_ICON: 'sf-icon-chevrondown',       // Desktop drawer chevron expanded\n\tCHEVRON_RIGHT_ICON: 'sf-icon-chevronright',     // Desktop drawer chevron collapsed\n\tCHEVRON_DOWN_CONTENT: '&#xe86b;',\t\t\t\t// Icon content for chevron expanded\n\tCHEVRON_RIGHT_CONTENT: '&#xe86a;',\t\t\t\t// Icon content for chevron collapsed\n\tRIGHT_ICON: 'sf-icon-right',                    // Segmented line chevron collapsed\n\tDOWN_ICON: 'sf-icon-down',                      // Segmented line chevron expanded\n\tOPTION: 'option',                               // Child level non-bundle product\n\tRIGHT: 'right',                                 // Cell content right alignment\n\tCENTER: 'center',                               // Cell content center alignment\n\tOVERRIDDEN: 'overridden',                       // Cell content override with \"Include\" (is this being used?)\n\tTOP_LEVEL: 'top-level',                         // Top level bundle product\n\tINDENT: 'sbIndent',                             // Indentation level for hierarchical product names\n\tEDITABLE: 'editable',                           // Denote an editable field cell\n\tDISABLED: 'disabled',                           // Disabled checkbox (row selection for child product)\n\tBOOLEAN: 'boolean',                             // Boolean field cell class\n\tHAS_FOCUS: 'sf-has-focus',                      // When a cell has focus\n\tEDIT_ICON: 'pencil',                            // Pencil edit icon\n\tSECONDARY: 'secondary',                         // Secondary field container for mobile\n\tEXPANDED: 'expanded',                           // When mobile secondary field container is expanded\n\tEDIT_MODE: 'editMode',                          // When a field is being inline edited\n\tSELECTION: 'selection',                         // Row selection cell\n\tDIRTY: 'dirty',\t\t\t\t\t\t\t\t\t// Field is now Dirty\n\tHIDE_CHECKBOX: 'hideCheckbox',                  // Hide checkbox field (via Page Security Plugin)\n\tTAPPABLE: 'tappable',\t\t\t\t\t\t\t// When a cell can be tapped for an onTap event\n\tLEFT_ALIGNED: 'left-aligned',\t\t\t\t\t// line action button left alignment\n\tRIGHT_ALIGNED: 'right-aligned'\t\t\t\t\t// line action button right alignment\n};\n\nexport class TemplateGenerator {\n\n\n\t/**\n\t * Generate a div element with innerHTML populated with field template\n\t * @param fields\n\t * @param attributes\n\t * @return a div node with generated template as innerHTML\n\t */\n\tgenerateRowNode(fields, attributes) {\n\t\tlet src = this.generateRow(fields);\n\t\tlet node = document.createElement('div');\n\t\tif (attributes) {\n\t\t\tObject.keys(attributes).forEach((attr) => {\n\t\t\t\tnode.setAttribute(attr, attributes[attr]);\n\t\t\t});\n\t\t}\n\t\tnode.innerHTML = src;\n\t\treturn node;\n\t}\n\n\t/**\n\t * To be implemented by extending class\n\t * Generate template for a row\n\t * @param fields\n\t * @return {string}\n\t */\n\tgenerateRow(fields) {\n\t\tthrow new Error(\"generateRow() must be implemented!\");\n\t}\n\n\t/**\n\t * Generate template for given set of fields\n\t * @param fields\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param isSecondary for mobile use, whether the template is secondary fields\n\t * @return {string}\n\t */\n\tgenerateFieldSetTemplate(fields, groupModel, editorModel, isSecondary) {\n\t\t// we do not calculate column widths for mobile\n\t\tconst colWidths = this.getColWidths(groupModel);\n\t\treturn this.generateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary); // fieldSetTemplate\n\t}\n\n\t/**\n\t * Generate vertical table template for segmented cell tooltip\n\t * @param fields\n\t */\n\tgenerateSegmentedTooltipFieldSetTemplate(fields, fieldLabels, editorModel) {\n\t\tlet fieldSetTemplate = '<table><tbody>';\n\t\tfields.forEach((field) => {\n\t\t\tfieldSetTemplate += `<tr><th>${fieldLabels[field]}</th><td>`;\n\t\t\tlet metadata = editorModel.getFieldMetadata(field);\n\t\t\tfieldSetTemplate += this.generateInnerFieldTemplate(field, metadata);\n\t\t\tfieldSetTemplate += '</td>';\n\t\t});\n\t\tfieldSetTemplate += '</tbody></table>';\n\t\treturn fieldSetTemplate;\n\t}\n\n\t/**\n\t * Generate template for given set of fields and segments\n\t * @param fields\n\t * @param segments\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param isSecondary for mobile use, whether the template is secondary fields\n\t * @return {string}\n\t */\n\tgenerateSegmentedFieldSetTemplate(fields, segments, dimension, groupModel, editorModel, isSecondary) {\n\t\t// we do not calculate column widths for mobile\n\t\tconst colWidths = this.getColWidths(groupModel, dimension);\n\t\tlet fieldSetTemplate = this.generateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary);\n\t\tif (!AppContext.isMobile) {\n\t\t\t// include template for segmented fields\n\t\t\tfieldSetTemplate += this.generateInnerFieldSetTemplate(segments, colWidths, editorModel, isSecondary, fields.length);\n\t\t}\n\t\treturn fieldSetTemplate;\n\t}\n\n\t/**\n\t * Generate template for given set of fields\n\t * @param fields\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param startIndex\n\t * @return {string}\n\t */\n\tgenerateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary, startIndex = 0) {\n\t\tlet template = '';\n\t\tlet colIndex = startIndex;\n\t\tfields.forEach((field) => {\n\t\t\tlet metadata = editorModel.getFieldMetadata(field);\n\t\t\tlet columnClass = this.getColumnClass(field);\n\t\t\tlet primary = this.getPrimaryClass(colIndex, isSecondary);\n\t\t\tlet focusable = (!QuoteContext.isProductNameField(field) || !AppContext.isBundleCollapsible(editorModel)) ? 'focusable' : '';\n\t\t\ttemplate += `<div tabindex=\"0\" class$=\"container td sf-le-table-cell sf-le-table-row ${primary} ${focusable} ${columnClass} {{computeCellClass(rowIndex, '${field}', _cellClasses)}}\"`;\n\t\t\tif (colWidths) {\n\t\t\t\ttemplate += `style=\"min-width:${colWidths[field]}px;max-width:${colWidths[field]}px\"`;\n\t\t\t}\n\t\t\ttemplate += ` index=\"${colIndex}\" field=\"${field}\" >`;\n\t\t\ttemplate += this.getFieldLabel(metadata, isSecondary);\n\t\t\ttemplate += '<div class=\"r\">'; // beginning of r div\n\t\t\tif (QuoteContext.isProductNameField(field) && editorModel.isProductHierarchyVisualized()) {\n\t\t\t\ttemplate += this.generateProductCell(field);\n\t\t\t} else {\n\t\t\t\ttemplate += this.generateInnerFieldTemplate(field, editorModel.getFieldMetadata(field));\n\t\t\t}\n\t\t\ttemplate += '</div>'; // end of r div\n\t\t\ttemplate += '</div>';\n\t\t\tcolIndex++;\n\t\t});\n\t\treturn template;\n\t}\n\n\t/**\n\t * Generate the Caret for a bundle product as well as the Product Name, which is implemented by its subclass\n\t * @returns {string}\n\t * @private\n\t */\n\tgenerateProductCell(field) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Generate individual field template based on metadata\n\t * @param field\n\t * @param metadata\n\t * @param isSecondary\n\t * @returns {*}\n\t */\n\tgenerateInnerFieldTemplate(field, metadata) {\n\t\tlet dataType = metadata ? metadata.type : null;\n\t\tif( metadata && metadata.extraTypeInfo === 'richtextarea' ) {\n\t\t\tdataType = 'richtextarea';\n\t\t}\n\t\tif( metadata && metadata.calculatedFormula && metadata.calculatedFormula.includes(\"IMAGE\")) {\n\t\t\tdataType = 'image';\n\t\t}\n\t\tif( metadata && metadata.calculated && metadata.htmlFormatted ) {\n\t\t\tdataType = 'formulaHtml';\n\t\t}\n\n\t\tswitch( dataType ) {\n\t\t\tcase 'boolean':\n\t\t\t\treturn this.generateCheckboxTemplate(field);\n\t\t\tcase 'image':\n\t\t\t\treturn `<div class=\"imgFormula\" inner-h-t-m-l=\"[[${field}]]\"></div>`;\n\t\t\tcase 'richtextarea':\n\t\t\tcase 'formulaHtml':\n\t\t\t\treturn `<div class=\"htmlField\" inner-h-t-m-l=\"[[${field}]]\"></div>`; // data is sanitized in Formatter\n\t\t\tcase 'url':\n\t\t\t\treturn `<a href=\"[[${field}]]\" target=\"_blank\">[[${field}]]</a>`; // data is sanitized in Formatter\n\t\t\tdefault:\n\t\t\t\treturn `[[${field}]]`;\n\t\t}\n\t}\n\n\t/**\n\t * Generate template for selection checkbox\n\t * Use computeCellClass to disable the CB on row level, for example, when the line is part of a bundled product\n\t * @param field\n\t * @return {*}\n\t */\n\tgenerateCheckboxTemplate(field) {\n\t\treturn '<div class=\"checkboxcontainer\">' + this.generateInnerCheckboxTemplate(field) + '</div>';\n\t}\n\n\tgenerateInnerCheckboxTemplate(field) {\n\t\tlet defaultCheck = field ? `checked=\"[[${field}]]\"` : '';\n\t\treturn `<input type=\"checkbox\" class=\"hidden\" ${defaultCheck}>` +\n\t\t\t'<div class=\"paper-checkbox\">' +\n\t\t\t\t'<div class=\"checkmark\"></div>' +\n\t\t\t'</div>'; // paper-checkbox\n\t}\n\n\t/**\n\t * Column Adjustment Bar that indicate column resizing\n\t * @returns {string}\n\t */\n\tgenerateColAdjBar() {\n\t\tif (AppContext.isColumnResizingEnabled && !AppContext.isMobile && this.options.allowColumnResizing) {\n\t\t\treturn '<span class=\"col-adj-bar\"></span>';\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get extra css class for this column, to be overriden by subclass\n\t * @param field for which the column is display\n\t * @return {string}\n\t */\n\tgetColumnClass(field) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the primary class for a field, typically only needed for mobile\n\t * @param colIndex column index of this field\n\t * @param isSecondary true if this one of the a secondary field\n\t * @returns {string}\n\t */\n\tgetPrimaryClass(colIndex, isSecondary) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the template html for field label, typically only needed for mobile\n\t * @param fieldMetadata metadata for this field\n\t * @param isSecondary true if this one of the a secondary field\n\t * @returns {string}\n\t */\n\tgetFieldLabel(fieldMetadata, isSecondary) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the column widths for this row\n\t * @param the group model\n\t * @param dimension the segment dimension, for segmented rows\n\t */\n\tgetColWidths(groupModel, dimension) {\n\t\tif (dimension) {\n\t\t\treturn groupModel.getDimensionColWidths(dimension);\n\t\t}\n\t\treturn groupModel.colWidth.Standard;\n\t}\n\n\tbuildRowSegmentFieldSet(segmentedColumns) {\n\t\t// Build field set for row segments\n\t\tlet segments = segmentedColumns.map(toFieldName);\n\t\tsegments.push('total');\n\t\treturn segments;\n\t}\n\n\tstatic get classNames() {\n\t\treturn CLASS_NAMES;\n\t}\n}\n","import { DesktopDelegate } from 'quotes/layout/sf-le-table-row/DesktopDelegate.js';\n\nexport class UBPDesktopDelegate extends DesktopDelegate {\n\n\tstatic getInstance() {\n\t\tif (!this._instance) {\n\t\t\tthis._instance = new UBPDesktopDelegate();\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * @override\n\t * @param row\n\t */\n\tinitListeners(row) {\n\t\trow.listeners.mouseover = 'onHovered';\n\t\trow.listeners.mouseout = 'onUnhovered';\n\t}\n\n}","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\nimport {TemplatizationBehavior} from 'common/behaviors/TemplatizationBehavior.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {UBPDesktopDelegate} from 'quotes/layout/ubp-rate-row/UBPDesktopDelegate.js';\nimport {SFInlineEditBehavior} from 'common/behaviors/SFInlineEditBehavior.js';\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {pathGet, pathMutate, Util} from 'common/Util.js';\nimport {get} from 'quotes/models/ClientCache.js';\nimport {DataHandlerBehavior} from 'quotes/models/DataHandlerBehavior.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport { getDataFromCache, getDataFromCacheAsync, loadRateCardSummary, overrideRecValues } from 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js';\nimport {SFComponentFactory} from 'quotes/sf-component-factory/SFComponentFactory.js';\nimport { Events } from 'common/core/Events.js';\n\n/**\n * UBP Usage Rate Row Component\n *\n * This component is used for displaying the Usage Rate Card's rates\n * @author thane.fenton\n * @since 216\n */\nexport class UBPRateRow {\n\t\n\tget behaviors() {\n\t\treturn [Polymer.Templatizer, window.CommonBehaviors.TemplatizationBehavior, window.CommonBehaviors.SFTableRowBehavior, window.CommonBehaviors.SFInlineEditBehavior, DataHandlerBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'ubp-rate-row';\n\t\t\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\t\n\t\t\tcategoryId: String,\n\t\t\t\n\t\t\trateId: String,\n\t\t\t\n\t\t\t// calculation results that's not yet persisted\n\t\t\tunsavedUbpChanges: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UnsavedUbpChanges',\n\t\t\t\t\tpath: []\n\t\t\t\t},\n\t\t\t},\n\n\t\t\t// manual edit that hasn't been applied\n\t\t\tinlineEditChanges: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UbpInlineEditChanges',\n\t\t\t\t\tpath: [ 'rates' ]\n\t\t\t\t},\n\t\t\t},\n\n\t\t\t// array of categories that contains inline edits\n\t\t\tinlineEditedCategories: Array,\n\n\t\t\trateRecord: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'rateId',\n\t\t\t\t\tpath: [ 'record' ]\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfields: Array,\n\n\t\t\t// flag to track whether this row has be marked dirty (as in any cell was edited)\n\t\t\tisDirty: Boolean\n\t\t}, TemplatizationBehavior.properties);\n\t\t\n\t\tthis.listeners = {\n\t\t\t'tap': 'onTap',\n\t\t\t'change': 'onChange',\n\t\t}\n\t}\n\n\tcreated() {\n\t\tthis._deviceDelegate = UBPDesktopDelegate.getInstance();\n\t\tthis._deviceDelegate.initListeners(this);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_updateUiDataObserver(rateRecord, fields, rateId, unsavedUbpChanges)',\n\t\t\t'_inlineEditedCategoriesChanged(inlineEditedCategories.splices)'\n\t\t];\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.UBP_ROW_REFRESH] = this._refreshRow;\n\t\treturn e;\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(Polymer.dom(this.root).querySelector('.content'), true);\n\t\t}\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#getContentNode\n\t */\n\tgetContentNode() {\n\t\treturn Polymer.dom(this.root).querySelector('.content');\n\t}\n\t\n\t/**\n\t * @override overrides TemplatizationBehavior#postPopulateContent\n\t */\n\tpostPopulateContent() {\n\t\t// After the row fully rendered, fire 'iron-resize' for iron-list\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.fire('rate-row-rendered');\n\t\t});\n\t\tthis._resetPencilLoaded();\n\t\tthis._refreshDirtyIndicators();\n\t}\n\t\n\t/**\n\t * Lazy Load Rate Card Preview Component\n\t * @param evt\n\t */\n\thook_onHovered(evt) {\n\t\tlet rateField = this.findCell(evt);\n\t\tif (rateField && rateField.getAttribute('field') === `${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.Name`) {\n\t\t\tthis.showTooltip = true;\n\t\t\tthis._displayPreviewTooltip(rateField);\n\t\t}\n\t\tthis._handleEditableCellsHover();\n\t}\n\n\thook_onUnhovered(evt) {\n\t\tlet rateField = this.findCell(evt);\n\t\tif (rateField && rateField.getAttribute('field') === `${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.Name`) {\n\t\t\tthis.showTooltip = false;\n\t\t\tthis.fire('toggle-tooltip', {show: false});\n\t\t}\n\t}\n\n\tfindCell(e, clazz = 'td') {\n\t\treturn Polymer.dom(e).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(clazz);\n\t\t});\n\t}\n\n\t/**\n\t * Make a copy of the incoming data and populate the master fields based on existing custom field values\n\t * @param data\n\t * @param rateCardFields\n\t * @returns {*}\n\t * @private\n\t */\n\t_mapToMasterUbpChanges(data, rateCardFields) {\n\t\tif (rateCardFields) {\n\t\t\tdata = Util.deepClone(data);\n\t\t\trateCardFields.forEach((field) => {\n\t\t\t\tdata[field.fieldPath] = data[`${QuoteContext.constants.prefix}${field.fieldPath}__c`];\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\t/**\n\t * Display tooltip with preview panel\n\t * @param rateField the field for which the tooltip is displayed and anchored\n\t * @private\n\t */\n\t_displayPreviewTooltip(rateField) {\n\t\tif (!this._previewPanel) {\n\t\t\tlet rateCardPreview = document.createElement('sf-preview-panel');\n\t\t\tlet rateRecord = getDataFromCache(this.rateId, ['record']);\n\t\t\tlet scheduleId = rateRecord[QuoteContext.constants.UBP_FIELDS.ConsumptionScheduleId];\n\t\t\t// first get metadata, load it if necessary\n\t\t\tgetDataFromCacheAsync(this.categoryId, ['rateCardFields'], () => {\n\t\t\t\treturn loadRateCardSummary(scheduleId);\n\t\t\t}).then((rateCardFields) => {\n\t\t\t\tlet metadata = rateCardFields.reduce((acc, x) => {\n\t\t\t\t\tacc[x.fieldPath] = {type: x.type, label: x.label};\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\t\t\t\t// then get data, load it if necessary\n\t\t\t\tgetDataFromCacheAsync(scheduleId, ['record'], () => {\n\t\t\t\t\treturn loadRateCardSummary(scheduleId);\n\t\t\t\t}).then((rateCardData) => {\n\t\t\t\t\t// override unsaved changes if it's available\n\t\t\t\t\tlet dirtyFields = {};\n\t\t\t\t\tif (this.unsavedUbpChanges && this.unsavedUbpChanges.schedules && this.unsavedUbpChanges.schedules[scheduleId]) {\n\t\t\t\t\t\tlet changes = this.unsavedUbpChanges.schedules[scheduleId];\n\t\t\t\t\t\t// For when displaying override on master schedule, we need to fill in master fields on the unsaved changes in order for merge to work\n\t\t\t\t\t\t// i.e., BillingTerm = 24 as well as SBQQ__BillingTerm__c = 24 (W-6821804)\n\t\t\t\t\t\tif (rateCardData.attributes && rateCardData.attributes.type === 'ConsumptionSchedule') {\n\t\t\t\t\t\t\tchanges = this._mapToMasterUbpChanges(this.unsavedUbpChanges.schedules[scheduleId], rateCardFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet overrideData = overrideRecValues(rateCardData, changes, rateCardFields);\n\t\t\t\t\t\tObject.keys(metadata).forEach((field) => {\n\t\t\t\t\t\t\tif (!Util.deepEquals(overrideData[field], rateCardData[field])) {\n\t\t\t\t\t\t\t\tdirtyFields[field] = 'dirty';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\trateCardData = overrideData;\n\t\t\t\t\t}\n\t\t\t\t\tlet data = [];\n\t\t\t\t\tObject.keys(rateCardData).forEach((field) => {\n\t\t\t\t\t\tdata.push({\n\t\t\t\t\t\t\tfield: field,\n\t\t\t\t\t\t\tvalue: rateCardData[field]\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t// populate rateCardPreview component\n\t\t\t\t\trateCardPreview.additionalUIData = {_cellClasses: dirtyFields};\n\t\t\t\t\trateCardPreview.templateOptions = {attributes: `class$=\"truncate body {{_cellClasses.$field}}\"`};\n\t\t\t\t\trateCardPreview.data = data;\n\t\t\t\t\trateCardPreview.metadata = metadata;\n\t\t\t\t\trateCardPreview.title = pathGet(rateRecord, `${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.Name`.split('.'));\n\t\t\t\t\t\n\t\t\t\t\trateCardPreview.iconClass = 'sf-icon-paired-lines';\n\t\t\t\t\t\n\t\t\t\t\t// create the DOM elements now that we have all the data\n\t\t\t\t\tthis._rateCardPreview = rateCardPreview;\n\t\t\t\t\t// only fire the event to show the tooltip if the mouse is still over a Name cell\n\t\t\t\t\tif (this.showTooltip) {\n\t\t\t\t\t\tthis.fire('toggle-tooltip', {target: rateField, content: rateCardPreview, show: true});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t} else {\n\t\t\tthis.fire('toggle-tooltip', {target: rateField, content: this._rateCardPreview, show: true});\n\t\t}\n\t}\n\t\n\t_updateUiDataObserver (rateRecord, fields, rateId, unsavedUbpChanges) {\n\t\tif (rateRecord === undefined || fields === undefined || rateId === undefined || unsavedUbpChanges === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateUiData(rateRecord, fields, rateId, unsavedUbpChanges);\n\t}\n\t\n\t/**\n\t * Get presentation ready data\n\t * inline and unsaved edits must be merged, in that order, with data stored in Client Cache\n\t * before formatting and displaying\n\t * Unsaved edits overrides data in Client Cache is there is a conflict\n\t * @param rateId\n\t * @param fields\n\t * @return Object, presentation ready data\n\t * @private\n\t */\n\t_updateUiData(rateRecord, fields, rateId, unsavedUbpChanges) {\n\t\tconst unsavedRate = this._computeUnsavedEditForRate(rateId, unsavedUbpChanges);\n\t\tlet uiData = unsavedRate ? overrideRecValues(rateRecord, unsavedRate, fields) : rateRecord;\n\t\tthis.uiData = this._formatUiData(uiData, fields, rateId, unsavedRate);\n\t}\n\n\t/**\n\t * @implements SFInlineEditBehavior.commitInlineEdit\n\t * Manual updates are stored in inlineEditChanges until user clicks the applied button, which commits them into unsavedChanges, or cancel\n\t * @param field\n\t * @param parsedValue\n\t */\n\tcommitInlineEdit(field, value) {\n\t\tthis.inlineEditChanges[this.rateId] = this.inlineEditChanges[this.rateId] || {};\n\t\tthis.inlineEditChanges[this.rateId][field] = value;\n\t\tthis.fire('inline-edit-commit');\n\t}\n\n\t/**\n\t * Retrieve the inline edit changes for the given rate\n\t * @param rateId\n\t * @returns {{}|*}\n\t * @private\n\t */\n\t_getInlineEditChangesForRate(rateId) {\n\t\tif (this.inlineEditChanges) {\n\t\t\treturn this.inlineEditChanges[rateId] || {};\n\t\t}\n\t\treturn {};\n\t}\n\n\t/**\n\t * Format the UI Data\n\t * @param rates\n\t * @returns {{}}\n\t * @private\n\t */\n\t_formatUiData(rateRecord, fields, rateId, unsavedRate) {\n\t\tlet formattedData = {};\n\t\tfor (let field of fields) {\n\t\t\tlet path = field.fieldPath.split('.');\n\t\t\tif (AppContext.org.isMultiCurrencyOrg && field.type === 'currency' && !field.CurrencyIsoCode) {\n\t\t\t\tfield.CurrencyIsoCode = get(get('UBPClientState', [ 'quoteLineOrProdId' ]), [ 'record', 'CurrencyIsoCode' ]);\n\t\t\t}\n\t\t\tlet formattedDatum = Formatter.formatFieldData(null, pathGet(rateRecord, path), field, rateRecord);\n\t\t\tpathMutate(formattedData, path, formattedDatum);\n\t\t}\n\t\tformattedData.rateId = rateId;\n\t\tformattedData.unsavedEdits = unsavedRate;\n\t\treturn formattedData;\n\t}\n\n\t/**\n\t * Populate unsavedEditsForRates for the given rateId\n\t * First make a deep clone of the JSQC changes, then merge it with a copy of the inline edit changes\n\t * Then add schedule-level changes in a flattened structure\n\t * The computed result is fixed with transaction object fields (e.g., SBQQ__Price__c)\n\t * @param rateId\n\t * @private\n\t */\n\t_computeUnsavedEditForRate(rateId, unsavedUbpChanges) {\n\t\tlet result = {};\n\t\tlet rateRecord = get(rateId, ['record']);\n\t\tif (rateRecord) {\n\t\t\tif (unsavedUbpChanges) {\n\t\t\t\tlet scheduleId = rateRecord[QuoteContext.constants.UBP_FIELDS.ConsumptionScheduleId];\n\t\t\t\t// populate schedule overrides such as ConsumptionSchedule.Price__c or QuoteLineConsumptionSchedule__r.Price__c in unsaved changes\n\t\t\t\tif (scheduleId && unsavedUbpChanges.schedules && unsavedUbpChanges.schedules[scheduleId]) {\n\t\t\t\t\tlet scheduleOverrides = unsavedUbpChanges.schedules[scheduleId];\n\t\t\t\t\tObject.keys(scheduleOverrides).forEach((field) => {\n\t\t\t\t\t\tif (field !== 'Id' && field !== 'attributes') {\n\t\t\t\t\t\t\tresult[`${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.${field}`] = scheduleOverrides[field];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.appliedChanges && this.appliedChanges[rateId]) {\n\t\t\t\tresult = overrideRecValues(result, this.appliedChanges[rateId], this.fields);\n\t\t\t} else if (unsavedUbpChanges && unsavedUbpChanges.rates && unsavedUbpChanges.rates[rateId]) {\n\t\t\t\tresult = overrideRecValues(result, unsavedUbpChanges.rates[rateId], this.fields);\n\t\t\t}\n\n\t\t\tif (this.inlineEditChanges) {\n\t\t\t\tresult = overrideRecValues(result, this._getInlineEditChangesForRate(rateId), this.fields);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tget appliedChanges() {\n\t\tconst context = get('UBPClientState');\n\t\tconst key = `AppliedUbpChanges_${context.quoteLineOrProdId}_${context.lineKey}`;\n\t\treturn get(key, ['rates']);\n\t}\n\n\t/**\n\t * @see ubp-rate-row.html\n\t * @returns {string}\n\t */\n\tcomputeClasses() {\n\t\treturn AppContext.isManualEditsForUBPEnabled ? 'inlineEditable' : '';\n\t}\n\n\t/**\n\t * @implements SFTableRowBehavior.getContentNode\n\t * @returns {*}\n\t */\n\tgetContentNode() {\n\t\treturn this.querySelector('div.content');\n\t}\n\n\t/**\n\t * @implements SFTableRowBehavior.getCellClass\n\t * @returns {string}\n\t */\n\tgetCellClass() {\n\t\treturn 'sf-ubp-table-cell';\n\t}\n\n\t/**\n\t * @implements SFInlineEditBehavior._getFieldMetadataForInlineEdit\n\t * @param field\n\t * @private\n\t */\n\t_getFieldMetadataForInlineEdit(field) {\n\t\treturn this.fields.find((f) => {\n\t\t\treturn f.fieldPath === field;\n\t\t});\n\t}\n\n\t_getFieldMetadata(field) {\n\t\treturn this._getFieldMetadataForInlineEdit(field);\n\t}\n\n\t/**\n\t * Toggle inline edit on device delegate\n\t * Called by SFInlineEditBehavior.js\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t */\n\ttoggleInlineEditForDeviceDelegate(container, isEdit, field, metadata) {\n\t\tthis._deviceDelegate.toggleInlineEdit(container, isEdit, field, metadata, this);\n\t}\n\n\ttoggleCellClass(cellClass, value, container, field) {\n\t\tthis.toggleClass(cellClass, value, container);\n\t}\n\n\t/**\n\t * @implements SFInlineEditBehavior._getEditField\n\t * @param metadata\n\t * @param index\n\t */\n\t_getEditField(metadata, index) {\n\t\treturn SFComponentFactory.getFieldComponent(metadata, null, index, this._getRecord());\n\t}\n\n\t/**\n\t * Depending on whether user has applied changes for this line,\n\t * return either the applied changes or the original record\n\t * @returns {*}\n\t * @private\n\t */\n\t_getOriginalRecord() {\n\t\tif (this.appliedChanges && this.appliedChanges[this.rateId]) {\n\t\t\treturn overrideRecValues(this.rateRecord, this.appliedChanges[this.rateId], this.fields);\n\t\t} else {\n\t\t\treturn this.rateRecord;\n\t\t}\n\t}\n\n\t_isEditable(field) {\n\t\treturn QuoteContext.isUbpFieldInlineEditable(field, get('ConsumptionRateMetadata', ['rateEditable']));\n\t}\n\n\t/**\n\t * Return the data model that drives the uiData, e.g., what's being displayed\n\t * @returns {*}\n\t * @private\n\t */\n\t_getRecord() {\n\t\tconst unsavedRate = this._computeUnsavedEditForRate(this.rateId, this.unsavedUbpChanges);\n\t\treturn overrideRecValues(this.rateRecord, unsavedRate, this.fields);\n\t}\n\n\tcheckIsDirty(newValue, originalValues, field) {\n\t\treturn newValue !== originalValues[field];\n\t}\n\n\t/**\n\t * @implements SFInlineEditBehavior._formatNewValue\n\t * @param field\n\t * @param metadata\n\t * @returns {*}\n\t * @private\n\t */\n\t_formatNewValue(field, metadata) {\n\t\tconst unsavedRate = this._computeUnsavedEditForRate(this.rateId, this.unsavedUbpChanges);\n\t\tlet formattedValue = Formatter.formatFieldData(null, unsavedRate[field], metadata, this.rateRecord);\n\t\tthis._restampField(field, formattedValue);\n\t\treturn unsavedRate[field];\n\t}\n\n\t/**\n\t * Invoked when inlineEditedCategories changed, due to user clicking cancel button\n\t * @param e\n\t * @private\n\t */\n\t_inlineEditedCategoriesChanged(e) {\n\t\tif (e && e.indexSplices) {\n\t\t\te.indexSplices.forEach((mutation) => {\n\t\t\t\tif (mutation.removed) {\n\t\t\t\t\t// check if the spliced category covers this rateId\n\t\t\t\t\t// unfortunately we can't just compare this.categoryId with the spliced categoryId due to the way iron-list recycles DOM elements\n\t\t\t\t\t// which causes out of sync categoryId and rateId in recycled rows\n\t\t\t\t\tlet shouldRemove = false;\n\t\t\t\t\tfor (let catId of mutation.removed) {\n\t\t\t\t\t\tlet catRates = get(catId, ['orderedRates']);\n\t\t\t\t\t\tif (catRates && catRates.indexOf(this.rateId) > -1) {\n\t\t\t\t\t\t\tshouldRemove = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (shouldRemove) {\n\t\t\t\t\t\t// refresh UI now that all inline edit in this category is canceled or applied\n\t\t\t\t\t\tthis._updateUiData(this.rateRecord, this.fields, this.rateId, this.unsavedUbpChanges);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tonKeyDown(event) {\n\t\tthis._deviceDelegate.onKeyDown(event, this);\n\t}\n\n\t_refreshRow(e) {\n\t\tif (e && e.detail && e.detail.id === this.rateId) {\n\t\t\tthis._updateUiData(this.rateRecord, this.fields, this.rateId, this.unsavedUbpChanges);\n\t\t}\n\t}\n}\n\nPolymer( UBPRateRow );\n","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class LEFieldMD {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-field-md';\n\t\tthis.properties = {\n\t\t\tdata: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['getFieldNames(data)'];\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function(e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldsMap = {},// map of fields {objectName: {fieldNames: field}}\n\t\t\t\tfieldLabelsMap = {}; // map of fieldLabels {fieldName: fieldLabel} for easy access for the <sb-group> component\n\n\t\t\tif (!this.constants)\n\t\t\t\tthis.constants = new Constants(this.prefix);\n\n\t\t\tlet unitPriceFields = this.constants.UNIT_PRICE_FIELDS;\n\t\t\tlet quantityFields = this.constants.QUANTITY_FIELDS;\n\t\t\tfor (let item in md) {\n\t\t\t\tlet parts = item.split(\".\"),\n\t\t\t\t\tobjName = parts[0],\n\t\t\t\t\tfieldName = parts[1];\n\n\t\t\t\tif (!fieldsMap[objName]) {\n\t\t\t\t\tfieldsMap[objName] = {};\n\t\t\t\t}\n\t\t\t\tif (!fieldLabelsMap[objName]) {\n\t\t\t\t\tfieldLabelsMap[objName] = {};\n\t\t\t\t}\n\t\t\t\t// Unit Price Fields always follow the package level unit price scale\n\t\t\t\t// Otherwise, if the field is type currency and the org is multi-currency, the scale will use currencyDecimalScale (defined by CurrencyType table)\n\t\t\t\tif (unitPriceFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.priceScale;\n\t\t\t\t} else if (md[item].type == 'currency' && this.settings.isMultiCurrencyOrg) {\n\t\t\t\t\tmd[item].scale = this.currencyDecimalScale;\n\t\t\t\t} else if (quantityFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.quantityScale || this.settings.quantityScale === 0 ? this.settings.quantityScale : md[item].scale;\n\t\t\t\t}\n\n\t\t\t\tfieldsMap[objName][fieldName] = md[item];\n\t\t\t\t//Quote Line is the only component that consumes a map, so only create a map for Quote Line\n\t\t\t\tif (objName === this.prefix + 'QuoteLine__c'){\n\t\t\t\t\tfieldLabelsMap[objName][fieldName] = md[item].label;\n\t\t\t\t}\n\t\t\t\tfieldLabelsMap[fieldName] = md[item].label;\n\t\t\t}\n\n\t\t\tthis.md = {fieldsMap : fieldsMap, fieldLabelsMap: fieldLabelsMap};\n\t\t}.bind(this));\n\n\t\tthis.$.describe.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\tgetFieldNames() {\n\t\t// Create an array of objectName.fieldName for retrieving field metadata\n\t\tlet fieldNames = [];\n\t\tfor (let obj in this.data) {\n\t\t\t// prefix object names only - field names are returned prefixed from the server\n\t\t\tfor (var i = 0, l = this.data[obj].length; i < l; i++) {\n\t\t\t\tlet fieldName = this.data[obj][i];\n\t\t\t\tfieldNames.push(obj + '.' + fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// describe call is initiated when fields are bound here - they are not passed in through the html\n\t\tthis.$.describe.fields = fieldNames;\n\t}\n\n}\n\nPolymer( LEFieldMD );","import {AppContext} from 'common/core/AppContext.js';\nimport {localizeContent} from 'common/core/AppContext.js';\nimport {Events, fireEvent} from 'common/core/Events.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {Page} from 'common/core/Page.js';\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {QuoteRuleExecutor} from 'common/rules/QuoteRuleExecutor.js';\nimport QuoteLogger from 'quoteLogger/QuoteLogger.js';\nimport WindowChannel from 'quoteLogger/WindowChannel.js';\nimport {ListItemTemplateGenerator} from 'quotes/layout/template-generator/ListItemTemplateGenerator.js';\nimport { get, put } from 'quotes/models/ClientCache.js';\nimport { UBPClientState } from 'quotes/models/ClientModels.js';\nimport {EditorModel} from 'quotes/models/EditorModel.js';\nimport { merge } from 'quotes/models/SafeClientCache.js';\nimport {JSQCPrecacheWorkerManager} from 'quotes/precaching/JSQCPrecacheWorkerManager.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport { loadUbp } from 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js';\nimport { AppLogger, LOG_TYPE } from 'logging/AppLogger.js';\n\n/**\n *  <sb-line-editor>\n *\n *  Features:\n *\n **/\nexport class LineEditor extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\t/** raw data - coming from the server */\n\t\t\trawData: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t/** data - initialized and sanitized */\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_dataIsChanged'  //creates the fieldNamesByObjectNames map to retrieve metadata in one combined query\n\t\t\t},\n\t\t\t/** md - metadata requested from the metadata */\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** editorModel - created by the EditorModel from the data */\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** groupModels - created by the groupModels from the data */\n\t\t\tgroupModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tquoteLevelTabs : {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tpageLoaded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcalculateGetCacheArray: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\trules: Array,\n\t\t}, Page.properties);\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.TOGGLE_OPTIONAL_CLICKED] = this.toggleOptional;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\te[Events.COL_SIZE_ERR] = this._onError;\n\t\te[Events.GENERIC_ERROR] = this._onError;\n\t\treturn e;\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'le-action-tapped': '_executeCustomAction',\n\t\t\t'cseMobile-tapped': '_handleMobileCSE',         // Need to have special handler for mobile because of the tab is different\n\t\t\t'cse-tapped': '_handleCSE',\n\t\t\t'segmented-changed': '_handleCSEResponse',\n\t\t\t'change-ghost' : '_handleGhostChanges',\n\t\t\t'renumber-lines' : 'renumber',\n\t\t\t'validate-quantity-changed': '_displayUpgradeQuantityToast',\n\t\t\t'field-change-validated': '_updateFieldValidations',\n\t\t\t'calculate-immediately': '_calculateImmediately',\n\t\t\t'rte-saved': '_updateIronList',\n\t\t\t'calculate-cache-get': '_setCalculateCached',\n\t\t\t'toggle-ubp-editor': '_toggleUbpEditor',\n\t\t\t'toggle-page-loaded': '_togglePageLoaded'\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_createEditorModelObserver(data, md)',\n\t\t\t'_errorEventHandled(error)',\n\t\t\t'_loadObjectMD(app.org)',\n\t\t\t'_groupModelsChanged(groupModels.*)',\n\t\t\t'_initObserver(rawData, rules)'\n\t\t];\n\t}\n\n\t_isColumnResizingEnabled() {\n\t\treturn AppContext.org.isColumnResizingEnabled && !AppContext.isMobile;\n\t}\n\n\t/**\n\t * Fires an iron signal which will trigger resize for iron-lists in the line editor.\n\t */\n\t_updateIronList() {\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tfireEvent(Events.UPDATE_IRON_LIST, { index: null });\n\t\t}\n\t}\n\n\t_loadObjectMD() {\n\t\tlet prefix = this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t\tthis.mdObjects = [prefix + 'QuoteLineGroup__c', prefix + 'QuoteLine__c', prefix + 'Quote__c', prefix + 'DiscountTier__c', prefix + 'DiscountSchedule__c'];\n\t}\n\n\t_loadProductRules() {\n\t\tlet getFromService = AppContext.org.hasQuoteSelectionProductRules && AppContext.org.isJSProductRulesEnabled;\n\t\tif (getFromService === false) this.rules = {}; // need to set rules object if we aren't loading rules from the service\n\t\treturn getFromService;\n\t}\n\n\t/**\n\t * @param { detail } - The details of the event\n\t * @private\n\t */\n\t_executeCustomAction({ detail }) {\n\t\tconst customActionName = detail.customAction.eventHandlerName;\n\n\t\tif (customActionName === 'onFlagCalculate') {\n\t\t\tthis.calculateGetCacheArray = []; // reset the calculate get cache array\n\t\t}\n\n\t\tif (!this._doesUserHavePermissionForAction(customActionName)) {\n\t\t\tthis.errors = [this.i18n.l('Insufficient privileges to perform that action')];\n\t\t\treturn;\n\t\t}\n\n\t\t// Open diagnostic tool if enabled when 'Calculate' pressed\n\t\tif (customActionName === 'onFlagCalculate' && this.data.settings.diagnosticToolEnabled) {\n\t\t\tthis._openDiagnosticTool();\n\t\t}\n\n\t\tthis.eventDetail = detail;\n\t}\n\n\t/**\n\t * Checks if the user has persission for the action he/she is performing\n\t * @param {String} action - Name of the action\n\t * @return {boolean} true if the user has access\n\t * @private\n\t */\n\t_doesUserHavePermissionForAction(action = '') {\n\t\tconst actionsRequiringPermCheck = new Set(['onAddProducts', 'onSave', 'onQuickSave', 'onFlagCalculate']);\n\t\tif (actionsRequiringPermCheck.has(action)) {\n\t\t\tif (AppContext.user.hasQuoteEditPermission === false) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tattached() {\n\t\tdocument.addEventListener('LineEditor-cached', function() {\n\t\t\tthis.needsInit = true;\n\t\t}.bind(this));\n\t\t// log QLE load event\n\t\tconst quoteId = (this.ctx && this.ctx.params) ? this.ctx.params.qId : null;\n\t\tnew AppLogger().log(quoteId, LOG_TYPE.LOAD_QLE, null);\n\t}\n\n\t_createEditorModelObserver (data, md) {\n\t\tif (data === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._createEditorModel(data, md);\n\t}\n\n\t/**\n\t * Creates EditorModel (which contains the QuoteModel, GroupModels, and LineModels) from the server object,\n\t * Attaches Metadata that is queried separately onto the EditorModel\n\t * @param: data     - raw data from the server\n\t * @param: md       - metadata which will pull information from server to the client\n\t * @private\n\t */\n\t_createEditorModel(data, md) {\n\t\tif (data.settings.largeQuoteThreshold > 0) {\n\t\t\t// cache fields needed to run validation rules\n\t\t\tif(data.settings.enableLQTValidations)\n\t\t\t\tthis._cacheProductRuleFields('validationErrorConditionDependencies');\n\t\t\t// cache fields needed to run selection rules\n\t\t\tif (data.settings.enableLQTSelectionRules)\n\t\t\t\tthis._cacheProductRuleFields('selectionErrorConditionDependencies');\n\t\t}\n\n\t\tif (this.ctx.params && this.ctx.params.cmd == 'onFlagCalculate') {\n\t\t\t// Special nastiness for running calculate command.\n\t\t\tdata.quote.calculationRequired = true;\n\t\t\tthis.ctx.params.cmd = null;\n\t\t}\n\n\t\tif (data.quote.calculationRequired) {\n\t\t\tthis.$.customActionServices.onFlagCalculate(this.pageLoaded);\n\t\t\treturn;\n\t\t}\n\t\tthis.editorModel = new EditorModel(data, md, this); // Ideally would only pass in 'this' but do not want to destabilize the app before the release\n\n\t\t// Attach metadata to the editorModel and add the segmented column labels\n\t\tthis._updateFieldLabelsMap();\n\n\t\tthis._handleGroupCustomActions(); // Ideally would be handled in the editorModel.\n\n\t\tthis.groupModels = this._getGroupModels();\n\t\tthis.rightSideButton = !this.editorModel.deviceContext.isMobile && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.quoteId = this.editorModel.quoteModel.quoteVO.record.Id;\n\n\t\tthis.hasQuoteFieldSet = (this.editorModel.fieldsetMap.quoteFieldNames.length > 0);\n\n\t\t// Assuming this.viewport is only not present during testing, in that case assume desktop\n\t\tthis._viewportChanged(this.editorModel.deviceContext.isMobile);\n\n\t\tthis.renumber();\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.ctx.params && this.ctx.params.cmd != null) {\n\t\t\tthis._executeCmd(this.ctx.params.cmd);\n\t\t\tthis.ctx.params.cmd = null;\n\t\t} else if(this.$.sbLineEditorRead.isLastReadQuoteUnopened && this.editorModel.quoteModel.quoteVO.isCoTermPrompted) {\n\t\t\tthis._navigateToContractLookupPage();\n\t\t} else if (!this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]) {\n\t\t\t// Should be the last part of _createEditorModel\n\t\t\tthis._handleMissingPricebook();\n\t\t} else {\n\t\t\t// Run default custom actions if there are any\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}\n\n\t\t//run js product rules after model finishes initializing\n\t\tif(this._loadProductRules() && this._redirectToLineEditor())\n\t\t\tthis.executeProductRules();\n\t\telse\n\t\t\tthis.pageLoaded = true;\n\n\t\tif (this.editorModel.deviceContext.isMobile || this.editorModel.largeQuoteExperienceEnabled)\n\t\t\tthis.quoteTotalDisplayed = true;\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.quoteDetailsIconClass = 'sf-icon-chevrondown';\n\t\t\t// When selectedGroupKey is obtained from the url, make sure groupKey can be referenced from the groupsByKey map.\n\t\t\t// On quick save, the currently selected group key is assigned to returnGroupKeyAfterQuickSave property\n\t\t\t// If returnGroupKeyAfterQuickSave is not defined, look at the groupKey in the actual URL which is populated during navigation\n\t\t\tlet groupKeyInUrl = this.returnGroupKeyAfterQuickSave ? this.returnGroupKeyAfterQuickSave : this.ctx.params.groupKey;\n\t\t\tvar selectedGroupKey = groupKeyInUrl && this.editorModel.quoteModel.groupsByKey[groupKeyInUrl] ? groupKeyInUrl : this.groupModels[0].groupKey;\n\t\t}\n\n\t\tthis.selectedGroupKey = this.editorModel.largeQuoteExperienceEnabled ? selectedGroupKey : null;\n\n\t\tthis._isSubtitleCombined();\n\t}\n\n\t_cacheProductRuleFields(serviceName) {\n\t\tconst serviceComponent = this.$[serviceName];\n\t\tconst callback = (response) => {\n\t\t\tconst obj = {};\n\t\t\tobj[serviceName] = response;\n\t\t\treturn merge(obj);\n\t\t};\n\t\tserviceComponent.read({ uid: serviceName })\n\t\t\t.then(fields => callback({ fields }))\n\t\t\t.catch(errors => callback({ errors }));\n\t}\n\n\t/**\n\t * Updates subtitleCombined property which determines whether the page title is diplayed next to the Quote # or in the row\n\t * @private\n\t */\n\t_isSubtitleCombined() {\n\t\tthis.subtitleCombined = this.editorModel.largeQuoteExperienceEnabled && this.data.settings.lineEditorTotalsField != 'doNotDisplay' && (this.data.quote.lineItems.length > 0);\n\t}\n\n\t_handleGroupCustomActions(notify) {\n\t\tif(!this.editorModel)\n\t\t\treturn;\n\n\t\tlet isExpanded = this.viewport && this.viewport.isDesktop() && this.viewport.M.up;\n\t\tthis.editorModel.groupCustomActions = !isExpanded ? [this.editorModel.groupMobileMenuButtonAction] : this.editorModel.customActionsByLocation.Group;\n\n\t\tif(!notify && !isExpanded) {\n\t\t\t// this ensures that in desktop when the viewport causes the group buttons to expand, that the first button have a label and correct borders\n\t\t\tthis.editorModel.groupCustomActions[0].label = this.editorModel.customActionsByLocation.Group[0].label;\n\t\t\tthis.editorModel.groupCustomActions[0].first = this.editorModel.customActionsByLocation.Group[0].first;\n\t\t\tthis.editorModel.groupCustomActions[0].eventHandlerName = this.editorModel.customActionsByLocation.Group[0].eventHandlerName;\n\t\t\tthis.editorModel.groupCustomActions[0].record = this.editorModel.customActionsByLocation.Group[0].record;\n\t\t}\n\n\t\tif(!notify || !this.groupModels)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.groupModels.length; i < l; i++)\n\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.groupCustomActions`);\n\t}\n\n\t_handleMissingPricebook() {\n\t\tthis.addEventListener('pricebook-saved', function(e) {\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}.bind(this));\n\n\t\tlet retUrl = window.location.href;\n\t\tif (retUrl.indexOf('cp=1') > -1) {\n\t\t\tdocument.location.assign(this.editorModel.communityPrefix + '/' + this.editorModel.quoteModel.quoteVO.record.Id);\n\t\t\treturn;\n\t\t}\n\t\tlet userType = this.data.userType;\n\t\t// Only Standard and PowerPartner users can edit pricebooks\n\t\tif (userType != \"Standard\" && userType != \"PowerPartner\") {\n\t\t\tthis.errors = [localizeContent(\"msg_missing_pricebook_id\")];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$.pricebookDialog.open();\n\t}\n\n\t_updateFieldLabelsMap() {\n\t\tlet fieldLabelsMap = this.editorModel.md.fieldLabelsMap,\n\t\t\tlocalizedDimensions = this.editorModel.data.quote.localizedMultiSegmentColumns,\n\t\t\tdimensions = this.editorModel.data.quote.multiSegmentColumns;\n\n\t\tfor (let dim in dimensions) {\n\t\t\tlet segments = dimensions[dim];\n\t\t\tlet localizedSegments = localizedDimensions[dim];\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\n\t\t\t\tfieldLabelsMap[segments[i].replace(/\\W/g, '')] = localizedSegments[i];\n\t\t\t}\n\t\t}\n\t\tfieldLabelsMap['total'] = localizeContent('Total');\n\t}\n\n\t_navigateToContractLookupPage() {\n\t\tthis.nav('#', {'qId': this.editorModel.quoteModel.quoteVO.record.Id}, ['contract', 'lookup'], false);\n\t}\n\n\t/**\n\t * Updates number field on each lineVO.record\n\t */\n\trenumber() {\n\t\tthis.editorModel.quoteModel.renumber();\n\t\tfireEvent(Events.ROWS_RENUMBERED);\n\t}\n\n\t_updateFieldValidations(e) {\n\t\tthis.errors = e.detail.error ? [e.detail.error] : null;\n\t}\n\n\t_calculateImmediately(e) {\n\t\tconst showSpinner = e.detail.showSpinner === undefined ? true : e.detail.showSpinner;\n\t\tconst setPageLoaded = e.detail.setPageLoaded === undefined ? true : e.detail.setPageLoaded;\n\t\t// Prevent dependent pick-list value changes from triggering multiple calculates\n\t\tthis.debounce('calculateImmediately', function() {\n\t\t\tthis.$.customActionServices.onFlagCalculate(showSpinner, false, function(quote) {\n\t\t\t\tif(setPageLoaded) {\n\t\t\t\t\tthis.pageLoaded = true;\n\t\t\t\t}\n\t\t\t\tif (e.detail.callback && typeof e.detail.callback === 'function') {\n\t\t\t\t\te.detail.callback(quote);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this), 50);\n\t}\n\n\t_executeCmd(cmd) {\n\t\tlet quoteActions = this.editorModel.customActionsByLocation.Quote;\n\t\tif (!quoteActions|| quoteActions.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tfor (let i = 0, l = quoteActions.length; i < l; i++) {\n\t\t\tif (quoteActions [i].eventHandlerName === cmd) {\n\t\t\t\tthis._executeCustomAction({\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tcustomAction: quoteActions[i],\n\t\t\t\t\t\tmodel: this.editorModel.quoteModel\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns a list of valid default custom actions.\n\t * Ensure that the Custom Actions conditions are met and the event handler name is correct\n\t * @param allDefaultCustomActions - List of all the default custom action\n\t * @returns {*[]} - List of valid custom actions\n\t * @private\n\t */\n\t_getValidDefaultCustomAction(allDefaultCustomActions = []) {\n\t\tif (!allDefaultCustomActions  || allDefaultCustomActions.length === 0 || this.data.quote.lineItems.length > 0 || this.data.quote.lineItemGroups.length > 1 || this.editorModel.quoteModel.grouped) {\n\t\t\treturn [];\n\t\t}\n\t\tconst eventHandlerName = this.editorModel.quoteModel.isRenewal ? \"onRenewSubscriptions\" : \"onAddProducts\";\n\t\treturn allDefaultCustomActions.filter(customAction => customAction._customActionsConditionsMet && customAction.eventHandlerName === eventHandlerName)\n\n\t}\n\n\t_executeDefaultCustomAction() {\n\t\tthis._getValidDefaultCustomAction(this.editorModel.defaultCustomActions).forEach(customAction => {\n\t\t\t\tthis._executeCustomAction({ detail: { customAction, model: this.editorModel.quoteModel }});\n\t\t\t});\n\t}\n\n\tviewportChanged() {\n\t\tthis._handleGroupCustomActions(true);\n\t\tif (this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\tbuildQuoteTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForQuoteLayout = [];\n\t\tif (this.editorModel.fieldsetMap.quoteFieldNames.length > 0)\n\t\t\tnamesForQuoteLayout.push('details');\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis.toggleClass('maxHeight', true, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels.length > 0) {\n\t\t\t\tnamesForQuoteLayout.push('groups');\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.groupModels.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.toggleClass('maxHeight', false, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels[0]._groupHasSegmentedProducts()) {\n\t\t\t\tthis.buildUngroupedSegmentedTabs();\n\t\t\t\tnamesForQuoteLayout.push('segmented');\n\t\t\t}\n\t\t\tif (this.groupModels[0]._groupHasStandardProducts()) {\n\t\t\t\tnamesForQuoteLayout.push('standard');\n\t\t\t}\n\t\t}\n\n\t\tif (!this._renderTabs(namesForQuoteLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#quoteTabs')) {\n\t\t\tthis.$$('#quoteTabs').destroyTabs();\n\t\t}\n\n\t\tlet tabs = [];\n\n\t\tfor (let i = 0, l = namesForQuoteLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForQuoteLayout[i],\n\t\t\t\tbind;\n\t\t\tswitch (tabName) {\n\t\t\t\tcase 'details':\n\t\t\t\t\tbind = ['groupModels','editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'groups':\n\t\t\t\t\tbind = ['groupModels', 'rightSideButton', 'editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'standard':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'segmented':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttabs.push({name: tId, label: tabName, bind: bind});\n\t\t}\n\t\tthis.ungroupedMDQTabs = this.groupModels[0] ? this.groupModels[0].quoteMDQTabs : null;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.quoteLevelTabs = tabs;\n\t}\n\n\t/**\n\t * Determines whether or not the quote level tabs need to be rendered by comparing quoteLevelTabs and namesForQuoteLayout\n\t * @param namesForQuoteLayout\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_renderTabs(namesForQuoteLayout) {\n\t\tif (this.quoteLevelTabs.length !== namesForQuoteLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModels[0] && this.groupModels[0].quoteMDQTabs && this.ungroupedMDQTabs.length !== this.groupModels[0].quoteMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.quoteLevelTabs.length; i < l; i++) {\n\t\t\tif (this.quoteLevelTabs[i].label !== namesForQuoteLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Generic error handling\n\t * present the error toast\n\t * @param e\n\t */\n\t_onError(e) {\n\t\tif (e && e.detail && e.detail.errorMessage) {\n\t\t\tthis.errors = [e.detail.errorMessage];\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @returns {Array}         - Return a line groups array based on the QuoteModel\n\t * @private\n\t */\n\t_getGroupModels() {\n\t\treturn this.editorModel.quoteModel.lineGroups;\n\t}\n\n\t/**\n\t * Determines whether the quote is ungrouped and has no lines - used to display the empty quote message\n\t * @returns {boolean}\n\t * @private\n\t */\n\tquoteHasNoLines() {\n\t\tif (this.data.quote.lineItems.length == 0) {\n\t\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\t\tthis.groupedQuoteHasNoGroups =  (quoteModel.grouped  && quoteModel.lineGroups.length == 0);\n\t\t\tthis.ungroupedQuoteHasNoLines =  !quoteModel.grouped;\n\n\t\t}\n\t}\n\n\t/**\n\t * Based on the parameter quoteVO, it will update the following things\n\t *  1. Update the data.quote with the update of the data.quote. It will automatically trigger an update to the EditorModel\n\t *  2. Update the groupModels so that it will get the update reference because it doesn't update this property automatically.\n\t *\n\t * @param quote      - QuoteVO\n\t * @param {Function} recombineFn - (serverQuote, originalQuote) => combinedQuote\n\t * @private\n\t */\n\tupdateQuote(quote, recombineFn) {\n\t\tif (quote != undefined) {\n\t\t\tif (quote.partialVO && this.data.quote && recombineFn) {\n\t\t\t\tquote = recombineFn(quote, this.data.quote);\n\t\t\t\tquote.partialVO = false;\n\t\t\t}\n\t\t\t// Wait for jsqc calculate to finish before running the code below\n\t\t\tthis.set('data.quote', quote);\n\t\t\tif (this.data.settings.usesClientCalculator && this.data.quote.calculationRequired) {\n\t\t\t\tthis.$.customActionServices.onFlagCalculate(true, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// create the editor model just in case it hasn't been created yet\n\t\t\tif(!this.editorModel)\n\t\t\t\tthis._createEditorModel(this.data, this.md);\n\n\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\t\tlet groupModels = this._getGroupModels();\n\t\t\tthis._updateFieldLabelsMap();\n\n\t\t\tthis.set('groupModels', groupModels);\n\n\t\t\tthis.rightSideButton = (this.viewport && !this.viewport.isMobile()) && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\n\t\t\t// Update Group Count for badge\n\t\t\tthis.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\t\t\tthis.set('editorModel.quoteModel', this.editorModel.quoteModel); // Used for quote totals\n\t\t\tthis.renumber();\n\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\t// QuoteModel creates an empty group when the quote is grouped (no line items yet).\n\t\t\t\t// We need to update the selectedGroupKey to this empty group's key so that the page does not blank out\n\t\t\t\tlet quoteModel = this.editorModel.quoteModel,\n\t\t\t\t\tgroups = quoteModel.lineGroups;\n\t\t\t\tif (quoteModel.grouped && groups.length == 1 && this.selectedGroupKey != groups[0].groupKey) {\n\t\t\t\t\tthis.selectedGroupKey = groups[0].groupKey;\n\t\t\t\t}\n\t\t\t\tthis._isSubtitleCombined();\n\t\t\t}\n\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.buildQuoteTabs();\n\t\t\t}\n\t\t}\n\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.data.settings.multiLineDeleteEnabled) {\n\t\t\t// Fire event for deselecting multi line delete checkbox listened for in LETableHeader\n\t\t\tfireEvent(Events.DESELECT_CHECKBOX);\n\t\t}\n\t}\n\n\t/**\n\t * Goes through all of the paths collected in JSQCNotifier and will update UI if the value doesn't match the original value.\n\t * @param notifier\n\t */\n\tupdateAfterJSQC(notifier, sortRequired) {\n\t\tif (!notifier) {\n\t\t\treturn;\n\t\t}\n\t\tconst updateInner = (paths, callback) => {\n\t\t\tfor (let path in paths) {\n\t\t\t\tlet originalValue = notifier.originalPathValues[path];\n\t\t\t\tlet value = paths[path].value;\n\t\t\t\t// QuoteLineModel paths will be updated through the sort method which creates brand new objects\n\t\t\t\tlet shouldNotify = !sortRequired || paths[path].root != 'QuoteLineModel';\n\t\t\t\tif((originalValue != value || path.endsWith(this.editorModel.constants.ADDITIONAL_DISCOUNT_FIELD))\n\t\t\t\t\t\t&& shouldNotify) {\n\t\t\t\t\tcallback(path, undefined);\n\t\t\t\t\tcallback(path, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tupdateInner(notifier.pathsToNotify, this.notifyPath.bind(this));\n\t\tupdateInner(notifier.pathsToSet, this.set.bind(this));\n\n\t\tif (AppContext.isPricingGuidanceEnabled) {\n\t\t\tfireEvent(Events.REFRESH_LINE_ACTIONS);\n\t\t}\n\t}\n\n\t_initObserver (rawData, rules) {\n\t\tif (rawData === undefined || rules === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._init(rawData, rules);\n\t}\n\n\t_init() {\n\t\tif (this.needsInit) {\n\t\t\t// Only perform needs-init actions once, the first time rawData is set.\n\t\t\tlet inVFPage = typeof Visualforce !== 'undefined';\n\t\t\tif (inVFPage && this.rawData.settings.usesClientCalculator && this.rawData.settings.orgUrl && window.Worker) {\n\t\t\t\t// Currently, precaching is only supported in VF pages.\n\t\t\t\tnew JSQCPrecacheWorkerManager(this.rawData).beginPrecaching();\n\t\t\t}\n\t\t\tthis.needsInit = false;\n\t\t}\n\n\t\t// Perform Page Security Plugin action every time rawData is updated.\n\t\t// Avoid calling PSP if we will be calling calculate right after this so that we avoid calling PSP multiple times\n\t\tif (this.rawData.settings.usesClientCalculator && typeof SB !== 'undefined' && SB.JSQC && !this.rawData.quote.calculationRequired) {\n\t\t\tlet client = new ConnectionClient(this.app.org.prefix);\n\t\t\tlet qc = new SB.JSQC(this.rawData.settings, this.rawData.quote, null);\n\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\tlet connectionPromiseArray = [client.getConnection(), client.getConnection()];\n\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\tqc.setLogger(QuoteLogger);\n\t\t\t\tthis.rawData.settings.displayedLookupMap = this.$.customActionServices.getDisplayedLookupNames(this.rawData);\n\t\t\t\tlet promise = qc.onLoad();\n\t\t\t\tpromise.then(function() {\n\t\t\t\t\tthis.data = this.rawData;\n\t\t\t\t}.bind(this), this._setError.bind(this))\n\t\t\t\t.catch(this._setError.bind(this));\n\t\t\t}.bind(this), this._setError.bind(this));\n\t\t}\n\t\telse {\n\t\t\tthis.data = this.rawData;\n\t\t}\n\t}\n\n\texecuteProductRules() {\n\t\tlet ruleExecutor = new QuoteRuleExecutor(this.rawData.quote, this.rules, this.rawData.settings.developerPrefix, this.rawData.settings.jsprLabels),\n\t\t\truleResponse;\n\n\t\ttry {\n\t\t\truleResponse = ruleExecutor.execute();\n\t\t} catch (e) {\n\t\t\tlet errors;\n\t\t\tif (typeof e === 'object' && e.type === 'info') {\n\t\t\t\t//expected errors\n\t\t\t\terrors = [e];\n\t\t\t} else {\n\t\t\t\t//unexpected errors\n\t\t\t\terrors = [{'msg': e.toString(), 'type': 'warning'}];\n\t\t\t}\n\t\t\t// Don't know why but we need to do this\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tthis.errors = errors;\n\t\t\t});\n\t\t}\n\n\t\tif (ruleResponse && ruleResponse.requiredProductIds.length > 0) {\n\t\t\tthis.handleLinesAddedByProductRules();\n\t\t\tthis.$.quoteLineAdder.quote = this.rawData.quote;\n\t\t\tthis.$.quoteLineAdder.productIds = ruleResponse.requiredProductIds;\n\t\t} else {\n\t\t\tthis.pageLoaded = true;\n\t\t}\n\t}\n\n\t_setError(err) {\n\t\tthis.error = {message: err.message || err};\n\t}\n\n\t/**\n\t * When data (quoteEditorModel) is returned from the server, creates a map of object names to field names\n\t * in order to query objects with the fields on their related fieldsets (instead of all fields on the objects)\n\t * When fieldNamesByObjectNames if bound, <sb-le-field-md> component will make the server call\n\t * @private\n\t */\n\t_dataIsChanged() {\n\t\t// fire a custom event on document to alert other services (like MetricsService) that the data has changed\n\t\tvar e = new CustomEvent('sf-qle-data-changed', {bubbles: false, detail: this.data});\n\t\tdocument.dispatchEvent(e);\n\n\t\t// MD is fetched everytime because the field set might have changed (Quote Line View functionality)\n\t\t// Currently, precaching is only supported in VF pages. If at some point we add support for Localhost, this will\n\t\t// change.\n\t\tlet prefix = this.data.developerPrefix;\n\t\tlet fieldNamesByObjectNames = {}; // obj to store fields by object name {'SBQQ__QuoteLine__c': ['SBQQ__ProductCode__c',...],'SBQQ__QuoteLineGroup__c': ['SBQQ__Optional__c',...] }\n\n\t\tthis._removeDuplicateLineFieldsInDrawer();\n\n\t\t// combine all quote line field sets avoiding duplicates\n\t\tlet fieldNames = [],\n\t\t\tfieldNameSet = new Set(),\n\t\t\tfieldSets = ['lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone', 'standardLineItemDrawerFieldNames', 'multiSegmentLineFieldNames', 'multiSegmentLineSummaryFieldNames'];\n\t\tfor (let i = 0, len = fieldSets.length; i< len; i++) {\n\t\t\tlet fieldSet = this.data[fieldSets[i]],\n\t\t\t\tnumOfFields = fieldSet && fieldSet.length;\n\t\t\tif (numOfFields) {\n\t\t\t\tfor (let j= 0; j< numOfFields; j++) {\n\t\t\t\t\tlet name = fieldSet[j];\n\t\t\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\t\t\tfieldNameSet.add(name);\n\t\t\t\t\t\tfieldNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// add fields that are not part of a field set but needed in the UI\n\t\tlet additionalFields = [`${prefix}SubscriptionScope__c`, `${prefix}SegmentLabel__c`, `${prefix}StartDate__c`, `${prefix}EndDate__c`, `${prefix}PriceEditable__c`];\n\t\tfor (let k = 0, ln = additionalFields.length;k < ln; k++) {\n\t\t\tlet name = additionalFields[k];\n\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\tfieldNameSet.add(name);\n\t\t\t\tfieldNames.push(name);\n\t\t\t}\n\t\t}\n\t\t// Concat with empty array to avoid pushing unwanted fields into field set array\n\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName] = [].concat(fieldNames);\n\t\tlet lineEditorSubtotalsField = this.data.settings.lineEditorSubtotalsField;\n\t\tif (!lineEditorSubtotalsField || lineEditorSubtotalsField == 'Default' || lineEditorSubtotalsField == 'doNotDisplay') {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(lineEditorSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorSubtotalsField);\n\t\t}\n\n\t\t// add quote level fields\n\t\tfieldNamesByObjectNames[this.data.quoteObjectName] = [].concat(this.data.quoteFieldNames);\n\t\tfor (let m = 0, n = this.data.quoteFieldNames.length; m < n; m++) {\n\t\t\tfieldNameSet.add(this.data.quoteFieldNames[m]);\n\t\t}\n\t\tlet lineEditorTotalsField = this.data.settings.lineEditorTotalsField;\n\t\t if (!lineEditorTotalsField || lineEditorTotalsField == 'Default') {\n\t\t\tif (this.data.quote.applyAdditionalDiscountLast) {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}CustomerAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}CustomerAmount__c`);\n\t\t\t} else {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}NetAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}NetAmount__c`);\n\t\t\t}\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(lineEditorTotalsField);\n\t\t\tfieldNameSet.add(lineEditorTotalsField);\n\t\t}\n\n\t\t// add group level fields\n\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`] = [].concat(this.data.groupFieldNames);\n\t\tfor (let o = 0, p = this.data.groupFieldNames.length; o < p; o++) {\n\t\t\tfieldNameSet.add(this.data.groupFieldNames[o]);\n\t\t}\n\t\tlet lineEditorGroupSubtotalsField = this.data.settings.lineEditorGroupSubtotalsField;\n\t\tif (!lineEditorGroupSubtotalsField || lineEditorGroupSubtotalsField == 'Default') {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(lineEditorGroupSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorGroupSubtotalsField);\n\t\t}\n\n\t\t// add discount tier and discount schedule fields\n\t\tfieldNamesByObjectNames[`${prefix}DiscountTier__c`] = this.data.discountScheduleModalFieldNames;\n\t\tfieldNamesByObjectNames[`${prefix}DiscountSchedule__c`] = ['Name', `${prefix}DiscountUnit__c`];\n\n\t\tthis.fieldNameSet = fieldNameSet;\n\t\tthis.$.md.data = fieldNamesByObjectNames;\n\n\t\tthis._notifyPSLAssignment();\n\t}\n\n\t_removeDuplicateLineFieldsInDrawer() {\n\t\tlet drawerFields = this.data.standardLineItemDrawerFieldNames;\n\t\tif (!drawerFields || drawerFields.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prefix = this.data.developerPrefix;\n\t\tlet deviceContext = this.app.deviceContext;\n\n\t\tlet removeDuplicates = function(primary, secondary) {\n\t\t\tlet primarySet = new Set(primary);\n\t\t\tfor (let i = 0, l = secondary.length; i < l; i++) {\n\t\t\t\t// if primary array contains this fieldName, splice it out of secondary array to avoid repeating fields\n\t\t\t\t// Number field is always shown in the UI even if it isn't in the field set, always strip it out of the line item drawer\n\t\t\t\tif (primarySet.has(secondary[i]) || secondary[i] == prefix + 'Number__c') {\n\t\t\t\t\tsecondary.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (this.data.lineFieldNamesPhone && deviceContext.isPhone) {\n\t\t\tremoveDuplicates(this.data.lineFieldNamesPhone, drawerFields);\n\t\t} else if ( this.data.lineFieldNamesTablet && (deviceContext.isTablet || deviceContext.isPhone) ) {\n\t\t\tremoveDuplicates(this.data.lineFieldNamesTablet, drawerFields);\n\t\t} else {\n\t\t\tremoveDuplicates(this.data.lineFieldNames, drawerFields);\n\t\t}\n\t}\n\n\t/**\n\t * General error event handler for line editor page.\n\t * @private\n\t */\n\t_errorEventHandled() {\n\t\tif (this.error) {\n\t\t\tif (this.error.validations) {\n\t\t\t\t// Handles validation exceptions coming from server\n\t\t\t\tthis.errors = this.error.validations;\n\t\t\t\t// Ensures that the UI updates after a validation error to update any fields that may need updating\n\t\t\t\tthis.$.customActionServices.updateUIAfterCalculate(this.editorModel.quoteModel.quoteVO);\n\t\t\t} else {\n\t\t\t\t// Handles standard error messages coming from server, in array format in case of multiple errors\n\t\t\t\tthis.errors = [this.error.message];\n\t\t\t}\n\t\t}\n\t\tthis.$.customActionServices.showSpinner = false;\n\t\tfireEvent(Events.TOGGLE_QUICKSAVE, { enable: true } );\n\t\t// cache was cleared at beginning of quick save (LECustomActionServices.onQuickSave),\n\t\t// but since the save failed lets add back the cleared cached item\n\t\tthis.$.sbLineEditorRead.restoreCache();\n\t}\n\n\t/**\n\t * Display notification for PSL assignment, which will go away automatically if not dismissed\n\t * The notification will not show again unless user has refreshed or re-entered QLE\n\t * @private\n\t */\n\t_notifyPSLAssignment(duration = 10000) {\n\t\tif (this.data && this.data.notifyPSLAssignment && !get('PSLAssignmentNotified')) {\n\t\t\tconst notification = {msg: this.i18n.l('pesterPSLAssignment'), type: 'warning'};\n\t\t\tif (this.errors) {\n\t\t\t\tthis.errors.push(notification)\n\t\t\t} else {\n\t\t\t\tthis.errors = [notification];\n\t\t\t}\n\t\t\tput('PSLAssignmentNotified', [], true);\n\t\t\tsetTimeout(() => {\n\t\t\t\tlet existing = this.errors;\n\t\t\t\tif (existing && existing.indexOf(notification) > -1) {\n\t\t\t\t\texisting.splice(existing.indexOf(notification), 1);\n\t\t\t\t\tthis.errors = Array.from(existing);\n\t\t\t\t}\n\t\t\t}, duration);\n\t\t}\n\t}\n\n\t_handleMobileCSE(e) {\n\t\tthis._openDialog({dialog: 'cseDialog', groupModelKey: null});\n\t}\n\n\t_handleCSE(e) {\n\t\tthis._openDialog(e.detail);\n\t}\n\n\t_handleCSEResponse(e) {\n\t\tthis.updateQuote(e.detail.quoteVO);\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t_openDialog(action) {\n\t\tif (action.dialog === 'cseDialog') {\n\t\t\tlet cseDialog = this.$.cseDialog;\n\t\t\tlet segments = this.editorModel.quoteModel.groupsByKey[action.groupModelKey].segmentedLinesByDimension.Custom[0].segmentsByLabel;\n\t\t\tlet segmentsArray = [];\n\t\t\tObject.keys(segments).forEach(function(key) {\n\t\t\t\tlet lineModel = segments[key];\n\t\t\t\tif (lineModel.lineVO.dimensionType == lineModel.groupModel.editorModel.constants.CUSTOM_VALUE) {\n\t\t\t\t\tsegmentsArray.push(lineModel);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcseDialog.dataLineModels = segmentsArray;\n\t\t}\n\t\tthis.$[action.dialog].$.dialog.toggle();\n\t}\n\n\ttoggleGroupPanel() {\n\t\tif (this.viewport.isMobile()) {\n\t\t\tfireEvent(Events.TOGGLE_PANEL_CLICKED);\n\t\t}\n\t}\n\n\tresetColumnWidths() {\n\t\tconst fieldSetName = this.editorModel.fieldSetNames.lineFieldNames;\n\t\tfireEvent(Events.RESET_COL_SIZES, {fieldSet: fieldSetName});\n\t\tthis.querySelector('#cogDropdown').close();\n\t}\n\n\t/**\n\t * Toggles quoteDetailsHidden status when quote details section is toggled directly\n\t */\n\tupdateQuoteDetails() {\n\t\tthis.quoteDetailsHidden = !this.quoteDetailsHidden;\n\t\tthis.toggleQuoteDetails(false);\n\t}\n\n\t/**\n\t * Toggles quote details icon class and fires a page resized event which will trigger resize for iron-lists on the selected group\n\t */\n\ttoggleQuoteDetails(isFullScreenToggleEvent) {\n\t\tthis.set('quoteDetailsIconClass', this.quoteDetailsHidden ? 'sf-icon-chevronright' : 'sf-icon-chevrondown');\n\t\tfireEvent(Events.PAGE_RESIZED, { isFullScreenToggleEvent: isFullScreenToggleEvent });\n\t}\n\n\t/**\n\t * Updates quoteDetailsHidden status, toggles quote details section, and fires browser's requestFullScreen on our page container\n\t * to the page container to position itself accordingly.\n\t */\n\ttoggleFullScreenMode(e) {\n\t\tthis._toggleFullscreen(e);\n\t\tthis.quoteDetailsHidden = this.inFullScreenMode;\n\t\tthis.toggleQuoteDetails(true);\n\t}\n\n\t/**\n\t * Fires requestFullScreen on the browser and updates the inFullScreenMode status\n\t * @param e\n\t * @private\n\t */\n\t_toggleFullscreen(e) {\n\t\tif (this.inFullScreenMode) {\n\t\t\tthis.exitFullScreenMode();\n\t\t} else {\n\t\t\tthis.enterFullScreenMode();\n\t\t}\n\n\t\t//  stop bubbling so we don't get bounce back\n\t\te.stopPropagation();\n\t}\n\n\tenterFullScreenMode() {\n\t\tlet elm = document.querySelector('sb-page-container');\n\t\tif (elm.requestFullScreen) { // Edge\n\t\t\telm.requestFullscreen();\n\t\t} else if (elm.msRequestFullscreen) { // IE\n\t\t\telm.msRequestFullscreen();\n\t\t} else if (elm.mozRequestFullScreen) { // Firefox\n\t\t\telm.mozRequestFullScreen();\n\t\t} else if (elm.webkitRequestFullscreen) { // Chrome,Safari\n\t\t\telm.webkitRequestFullscreen();\n\t\t}\n\t\tthis.inFullScreenMode = true;\n\t}\n\n\texitFullScreenMode() {\n\t\tlet elm = document.querySelector('sb-page-container');\n\t\tif (elm.requestFullScreen) { // Edge\n\t\t\tdocument.cancelFullScreen();\n\t\t} else if (elm.msRequestFullscreen) { // IE\n\t\t\tdocument.msExitFullScreen();\n\t\t} else if (elm.mozRequestFullScreen) { // Firefox\n\t\t\tdocument.mozCancelFullScreen();\n\t\t} else if (elm.webkitRequestFullscreen) { // Chrome,Safari\n\t\t\tdocument.webkitCancelFullScreen();\n\t\t}\n\t\tthis.inFullScreenMode = false;\n\t}\n\n\t/**\n\t * Changes the primary columns used for mobile and desktop.\n\t * @param  {Boolean} isMobile -flag for whether viewport.XS.only is true (mobile) or false (desktop).\n\t */\n\t_viewportChanged(isMobile) {\n\t\tif (!this.editorModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('hidden', !isMobile, Polymer.dom(this.root).querySelector('.fixedActions'));\n\t\t// Use primitive to ensure that the primaryMobileCols array actually changed\n\t\tlet standardPrimaryMobileColsLength = this.editorModel.standardPrimaryMobileCols.length;\n\t\tthis.editorModel.standardPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tlet segmentedPrimaryMobileColsLength = this.editorModel.segmentedPrimaryMobileCols.length;\n\t\tthis.editorModel.segmentedPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, 'total'] : [];\n\t\tthis.editorModel.segmentedDetailsPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.SEGMENT_LABEL_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tif (this.groupModels &&\n\t\t\t(standardPrimaryMobileColsLength !== this.editorModel.standardPrimaryMobileCols.length ||\n\t\t\tsegmentedPrimaryMobileColsLength !== this.editorModel.segmentedPrimaryMobileCols.length)) { // Avoid loops if primaryMobileCols did not change\n\t\t\tfor (let i = 0; i < this.groupModels.length; i++) {\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.standardPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedDetailsPrimaryMobileCols`);\n\t\t\t}\n\t\t}\n\n\t\tif (isMobile) {\n\t\t\tthis.buildQuoteTabs();\n\t\t}\n\n\t\tthis.isMobileRendered = isMobile;\n\t\tthis.isDesktopRendered = !isMobile;\n\t}\n\n\tbuildUngroupedSegmentedTabs() {\n\t\tif (!this.groupModels || this.groupModels.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet tabs = [],\n\t\t\tdimensions = this.groupModels[0].dimensions;\n\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\t\t\tif (this.groupModels[0].hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: this.groupModels[0].quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + this.groupModels[0].groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseMobile';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.groupModels[0].quoteMDQTabs = tabs;\n\t\tif(!this.ungroupedMDQTabs) {\n\t\t\tthis.ungroupedMDQTabs = tabs;\n\t\t}\n\t}\n\n\t_openCSE() {\n\t\tlet e = {\n\t\t\tdialog: event.currentTarget.attributes.dialog.value\n\t\t};\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t/**\n\t * Displays toast warning if user enters a number greater than the max quantity of either the upgrade or source for auto quanitty ratio enforcement.\n\t * @param  {Object} e - event object containing the valid and invalid quantity to notify user of max quantity enforcement.\n\t */\n\t_displayUpgradeQuantityToast(e) {\n\t\tlet invalidQuantity = e.detail.invalidQuantity;\n\t\tlet validQuantity = e.detail.validQuantity;\n\n\t\t// Set to null to avoid toast messages stacking on top of each other in UI\n\t\tthis.errors = null;\n\n\t\tif(invalidQuantity > 0) {\n\t\t\tlet errorMessage = this.i18n.l('Exceeded maximum quantity available. Value has been reduced to {0}', [validQuantity]);\n\t\t\tthis.errors = [{\n\t\t\t\ttype: 'warning',\n\t\t\t\tmsg: errorMessage\n\t\t\t}];\n\t\t}\n\t}\n\n\tdestampGroups() {\n\t\tthis.isMobileRendered = false;\n\t\tthis.isDesktopRendered = false;\n\t}\n\n\t/**\n\t * Displays guided messages product alert modal during save or quickSave event called from LECustomActionServices.js\n\t * @param serviceType {String} - determines whether the save or quickSave service action was performed\n\t * @param response {Object} - An object representing the response returned from a service call\n\t * @param response.guidedMessages {Array} - contains strings with the product alert guided messages\n\t */\n\thandleProductRuleAlertModal(serviceType, response) {\n\t\tlet guidedMessages = response.guidedMessages;\n\t\tif (!guidedMessages || guidedMessages.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (serviceType === 'saveService') {\n\t\t\t// If the alerts are being displayed after a Save, then we need to define a cancel callback method to update\n\t\t\t// the data based on the changd performed by the server.\n\t\t\t// We define the method as a variable instead of as a property of of the productAlertModel because we need the\n\t\t\t// method's scope and its 'this' to be the current scope and 'this', instead of that of the productAlertModal.\n\t\t\tlet cancelCB = () => {\n\t\t\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t\t\t// If the JSQC is enabled, then the server's result doesn't contain the entire quoteVO, but instead\n\t\t\t\t\t// a separate object containing only the properties of the QuoteVO that could have changed. As such,\n\t\t\t\t\t// we must apply those changes.\n\t\t\t\t\tlet originalQuote = this.editorModel.data.quote;\n\t\t\t\t\tlet quoteChanges = response.quote;\n\t\t\t\t\t// Apply line changes.\n\t\t\t\t\tlet lineCount = originalQuote.lineItems.length;\n\t\t\t\t\t// A simple method for copying properties from the updated version of an object back to the original,\n\t\t\t\t\t// defined here to spare repeated code.\n\t\t\t\t\tlet copyChanges = (originalObj, objChanges) => {\n\t\t\t\t\t\tfor (let prop in objChanges) {\n\t\t\t\t\t\t\toriginalObj[prop] = objChanges[prop];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\t\tlet originalLine = originalQuote.lineItems[i];\n\t\t\t\t\t\tlet updatedLine = quoteChanges.lineItems[i];\n\t\t\t\t\t\t// Saving may have created an ID for the line item, so copy that property.\n\t\t\t\t\t\toriginalLine.record.Id = updatedLine.record.Id;\n\t\t\t\t\t\t// Delete the record from the change object so it doesn't interfere with copying\n\t\t\t\t\t\tdelete updatedLine.record;\n\t\t\t\t\t\tcopyChanges(originalLine, updatedLine);\n\t\t\t\t\t}\n\t\t\t\t\t// Apply group changes\n\t\t\t\t\tlet groupCount = originalQuote.lineItemGroups.length;\n\t\t\t\t\tfor (let i = 0; i < groupCount; i++) {\n\t\t\t\t\t\tlet originalGroup = originalQuote.lineItemGroups[i];\n\t\t\t\t\t\tlet updatedGroup = quoteChanges.lineItemGroups[i];\n\t\t\t\t\t\t// Saving may have created an ID for the group, so copy that property\n\t\t\t\t\t\toriginalGroup.record.Id = updatedGroup.record.Id;\n\t\t\t\t\t}\n\t\t\t\t\t// Copy the ID from the updated quote to the original quote.\n\t\t\t\t\toriginalQuote.record.Id = quoteChanges.record.Id;\n\t\t\t\t\t// Delete the lines and groups and record from the updated quote in order to avoid them interfering in copying.\n\t\t\t\t\tdelete quoteChanges.lineItems;\n\t\t\t\t\tdelete quoteChanges.lineItemGroups;\n\t\t\t\t\tdelete quoteChanges.record;\n\t\t\t\t\t// Copy the changes to the original quote\n\t\t\t\t\tcopyChanges(originalQuote, quoteChanges);\n\t\t\t\t\tthis.updateQuote(originalQuote);\n\t\t\t\t\t// Even though the quote was calculated before saving, and a JSQCNotifier was created and populated,\n\t\t\t\t\t// that notifier was never actually used to trigger the UI updates. It should still be floating around,\n\t\t\t\t\t// so use it now.\n\t\t\t\t\tif (this.$.customActionServices.notifier) {\n\t\t\t\t\t\tthis.updateAfterJSQC(this.$.customActionServices.notifier);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If the JSQC is NOT in use, then we need to completely replace the new model with the old one.\n\t\t\t\t\tthis.updateQuote(response.quote);\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.$.productAlertModal.cancelCB = cancelCB;\n\t\t\tthis.$.productAlertModal.displayContinueButton = true;\n\t\t\tthis.$.productAlertModal.cancelText = 'Cancel';\n\t\t\tthis.$.productAlertModal.continueCB = () => {\n\t\t\t\t// Pass true to ensure validation process is called in LECustomActionServices navigateToReturnUrl\n\t\t\t\tthis.$.customActionServices.navigateToReturnUrl(true);\n\t\t\t};\n\t\t} else {\n\t\t\tthis.$.productAlertModal.cancelCB = null;\n\t\t\tthis.$.productAlertModal.cancelText = 'Quick Save and Continue';\n\t\t}\n\t\tthis.$.productAlertModal.alerts = guidedMessages;\n\t}\n\n\t_groupModelsChanged(change) {\n\t\tif (this.editorModel.isMultiGroupViewEnabled) {\n\t\t\tconst pathArr = change.path.split('.');\n\t\t\tpathArr[0] = 'lineGroups';\n\t\t\tthis.editorModel.quoteModel.notifyUi(pathArr);\n\t\t}\n\t}\n\n\t_toggleEditors(ubpContainer, qleContainer, showUbpEditor) {\n\t\tif (showUbpEditor) {\n\t\t\t// Show ubp and hide qle\n\t\t\tubpContainer.classList.remove('hidden');\n\t\t\tqleContainer.classList.add('hidden');\n\t\t} else {\n\t\t\t// Show qle and hide ubp\n\t\t\tubpContainer.classList.add('hidden');\n\t\t\tqleContainer.classList.remove('hidden');\n\t\t}\n\t}\n\n\t// Delegate method for loadUbp\n\t_loadUbp(loadFieldEditability) {\n\t\treturn loadUbp(loadFieldEditability);\n\t}\n\t/**\n\t * Open/close UBP editor\n\t * @param evt\n\t * @private\n\t */\n\t_toggleUbpEditor(evt) {\n\t\tlet lineModel = evt.detail.lineModel;\n\t\tlet showUbpEditor = evt.detail.visible;\n\t\tlet qleContainer = this.$.qlEditorContainer;\n\t\tlet ubpContainer = this.$.ubpEditorContainer;\n\t\tlet ubpEditor = this.querySelector('sf-ubp-editor');\n\n\t\t// if showUbpEditor is false, it's coming from ubp-editor\n\t\tif (!showUbpEditor && ubpEditor) {\n\t\t\tthis._toggleEditors(ubpContainer, qleContainer, showUbpEditor);\n\t\t} else {\n\t\t\tthis.$.customActionServices.showSpinner = true;\n\t\t\tconst lineRecord = lineModel.lineVO.record;\n\t\t\tconst quoteLineOrProdId = lineRecord.Id || lineRecord[this.editorModel.constants.SOURCE_FIELD] || lineRecord[this.editorModel.constants.PRODUCT];\n\t\t\t// Dynamically set querylimit based on screen height and rowHeight(It's a rough number, assume row height is 30px. It's a judgement call here)\n\t\t\tconst queryLimit = Math.trunc(window.innerHeight / 30);// innerHeight is the height of the browser window's viewport\n\t\t\tput('UBPClientState', [ ], new UBPClientState(quoteLineOrProdId, lineModel.lineVO.key, queryLimit));\n\t\t\tput('UnsavedUbpChanges', [ ], lineModel.lineVO.ubpChanges || {});\n\t\t\tput('UbpInlineEditChanges', [ ], { rates: {}, categories: [] });\n\t\t\tput(quoteLineOrProdId, ['record', 'CurrencyIsoCode'], lineRecord.CurrencyIsoCode);\n\t\t\tthis._loadUbp(AppContext.isManualEditsForUBPEnabled).then(() => {\n\t\t\t\t// Create and/or show UBPEditor\n\t\t\t\tif (!ubpEditor) {\n\t\t\t\t\tubpEditor = document.createElement('sf-ubp-editor');\n\t\t\t\t\tPolymer.dom(ubpContainer).appendChild(ubpEditor);\n\t\t\t\t}\n\n\t\t\t\tconst fieldMD = get(quoteLineOrProdId, [ 'related', 'ubpFields' ]);\n\t\t\t\tconst fields = fieldMD.map((md) => md.fieldPath);\n\t\t\t\tconst fieldLabels = { };\n\t\t\t\tconst fieldsMap = { };\n\t\t\t\tfor (let md of fieldMD) {\n\t\t\t\t\tfieldLabels[md.fieldPath] = md.label;\n\t\t\t\t\tfieldsMap[md.fieldPath] = md;\n\t\t\t\t}\n\t\t\t\tubpEditor.lineRecord = lineRecord;\n\t\t\t\tubpEditor.uiData = UIDataManager.prepareSingleLineData(lineModel, 0, fields, fieldsMap);\n\t\t\t\tubpEditor.templateHTML = new ListItemTemplateGenerator((field) => fieldsMap[field]).generate(fields, fieldLabels);\n\n\t\t\t\tthis._toggleEditors(ubpContainer, qleContainer, showUbpEditor);\n\t\t\t\tthis.$.customActionServices.showSpinner = false;\n\t\t\t}).catch(this._setError.bind(this));\n\t\t}\n\t}\n\n\t/**\n\t * Toggle page loaded property used by loading spinner\n\t * @param evt\n\t * @private\n\t */\n\t_togglePageLoaded(evt) {\n\t\tif (evt && evt.detail) {\n\t\t\tthis.pageLoaded = !!evt.detail.pageLoaded;\n\t\t}\n\t}\n\n\t_redirectToLineEditor() {\n\t\tif(!this.ctx.params || !this.ctx.params.jspr)\n\t\t\treturn false;\n\t\tlet source = Navigator.getPreviousRoute();\n\t\treturn (source === 'product/pc' || source === 'product/lookup' || source === 'favorite/lookup' ||\n\t\t\tsource === 'asset/lookup' || source === 'subscription/lookup')\n\t}\n\n\thandleLinesAddedByProductRules() {\n\t\tthis.$.quoteLineAdder.addEventListener('lines-added-by-rules-changed', function(e) {\n\t\t\tlet newData = JSON.parse(JSON.stringify(this.data));\n\t\t\tnewData.quote.lineItems = newData.quote.lineItems.concat(e.detail.value);\n\t\t\tthis.updateQuote(newData.quote);\n\t\t\tthis._calculateImmediately({ detail: { showSpinner: false, setPageLoaded: true } });\n\t\t}.bind(this));\n\t}\n\n\ttoggleOptional(e) {\n\t\tconst groupKey = e.detail.groupKey,\n\t\t\t  optional = e.detail.toggleOptionalBoolean;\n\t\tthis.editorModel.quoteModel.toggleOptional(optional, groupKey);\n\t}\n\n\t_setCalculateCached(e) {\n\t\tif(this.pageLoaded) // if page loaded add the cacheHit to the array\n\t\t\tthis.calculateGetCacheArray.push(e.detail.cacheHit);\n\t}\n\n\ttest_isCalculateCached() {\n\t\t// if any cache misses in the array then calculate was not cached\n\t\t// used for Selenium automation to ensure calculate pre-caching is working\n\t\treturn this.calculateGetCacheArray.length > 0 && this.calculateGetCacheArray.indexOf(false) == -1;\n\t}\n\n\t/**\n\t * Opens the QLE Diagnostic Tool for viewing quote calculations.\n\t * @returns {Object} An object containing configuration for this specific instance of the tool\n\t * @private\n\t */\n\t_openDiagnosticTool() {\n\t\tconst name = 'QLEDiagnosticToolApp';\n\t\tconst opts = 'resizable=1,scrollbars=1';\n\n\t\t// Url of the form '/<namespace>/<app name>.app'. 'c' indicates current namespace\n\t\tconst url = `/c/${name}.app`;\n\t\tconst toolWindow = window.open(url, name, opts);\n\t\tconst subChannel = new WindowChannel(window);\n\t\tconst pubChannel = new WindowChannel(toolWindow);\n\n\t\t// Create a publish logger to use for calculator\n\t\tconst logger = new QuoteLogger(subChannel, pubChannel);\n\t\tlogger.initPublisher();\n\t\tQuoteLogger.setInstance(logger);\n\t}\n}\n\nPolymer( LineEditor );\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\nimport { TemplatizationBehavior } from 'common/behaviors/TemplatizationBehavior.js';\nimport { DataHandlerBehavior } from 'quotes/models/DataHandlerBehavior.js';\nimport { get, put } from 'quotes/models/ClientCache.js';\nimport { UBPClientState } from 'quotes/models/ClientModels.js';\nimport { loadRates } from 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js';\nimport { QuoteContext } from 'quotes/QuoteContext.js';\n/**\n * Usage Based Pricing Editor\n *\n * Display the usage rate cards and rates that are available for a product.\n * This overlay will contain all the components necessary for a user to view,\n * search, select, edit, and save a rate card and rates.\n *\n * @author thane.fenton\n * @since 216\n */\n\nexport class UBPEditor {\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.TemplatizationBehavior, DataHandlerBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-ubp-editor';\n\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlineRecord: Object,\n\n\t\t\terrorMsg: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: ['errorMsg'],\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tsuccessMsg: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: ['successMsg'],\n\t\t\t\t},\n\t\t\t},\n\n\t\t\trequestCount: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: [ 'requestCount' ]\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tcategoryIds: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserving: {\n\t\t\t\t\tidFunction: '_getLineId(lineRecord)',\n\t\t\t\t\tpath: [ 'related', 'categoryIds' ]\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tcategoryIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: [ 'categoryIndex' ]\n\t\t\t\t},\n\t\t\t\tvalue: 0\n\t\t\t},\n\n\t\t}, TemplatizationBehavior.properties);\n\n\t\tthis.listeners = {\n\t\t\t'selected-page-changed': '_onTabChanged',\n\t\t\t'sb-cancel-backToQuote': '_closeConfirmationDialog'\n\t\t};\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.quoteLine, true);\n\t\t\tthis.scopeSubtree(this.querySelector('.ubpTabContainer', true));\n\t\t}\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#getContentNode\n\t */\n\tgetContentNode() {\n\t\treturn Polymer.dom(this.$.quoteLine);\n\t}\n\n\t/**\n\t * @override overrides TemplatizationBehavior#isTemplatizeWithRootDivNode\n\t */\n\tisTemplatizeWithRootDivNode() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Used for Record Cache to find the data corresponding to the quote line Id and its path\n\t * specified in the properties\n\t * @param lineRecord\n\t * @returns {string}\n\t * @private\n\t */\n\t_getLineId(lineRecord) {\n\t\treturn lineRecord.Id || lineRecord[QuoteContext.constants.SOURCE_FIELD] || lineRecord[QuoteContext.constants.PRODUCT];\n\t}\n\n\t/**\n\t * Invoked in html template to pass the categoryId to ubp-rate-table\n\t * @param categoryIds\n\t * @param categoryIndex\n\t * @returns {*}\n\t * @private\n\t */\n\t_getCategoryId(categoryIds, categoryIndex) {\n\t\treturn categoryIds[categoryIndex];\n\t}\n\n\t/**\n\t * Check if any categories were found, so tabs can be shown/hidden accordingly\n\t * @param categoryIds\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_hasCategories(categoryIds) {\n\t\treturn !!categoryIds && categoryIds.length > 0;\n\t}\n\n\t/**\n\t * Invoked from html template to pass the category tabs\n\t * @param categoryIds\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getCategoryTabs(categoryIds) {\n\t\treturn categoryIds.map((categoryId) => ({ label: get(categoryId, [ 'label' ]) }));\n\t}\n\n\t/**\n\t * Event handling for clicking \"back to quote\" button\n\t * @private\n\t */\n\t_onBackToQLE() {\n\t\tthis.$.ubpRateTable.clearSearch();\n\t\tconst categories = get('UbpInlineEditChanges', ['categories']);\n\t\tif (categories != null && categories.length > 0) {\n\t\t\t// if the UBP page has any unapplied changes across the categories display the confirmation dialog\n\t\t\tthis.$.confirmationDialog.open();\n\t\t} else {\n\t\t\tthis.fire('toggle-ubp-editor', {visible: false});\n\t\t}\n\t}\n\n\t/**\n\t * Close the back to quote confirmation dialog\n\t * @private\n\t */\n\t_closeConfirmationDialog() {\n\t\tthis.$.confirmationDialog.close();\n\t}\n\n\t/**\n\t * Cancels out all unapplied changes and returns user back to quote\n\t * @private\n\t */\n\t_discardAllUnappliedChanges() {\n\t\tthis.$.ubpRateTable.discardUnappliedChanges();\n\t\tthis._closeConfirmationDialog();\n\t\tthis.fire('toggle-ubp-editor', {visible: false});\n\t}\n\n\t/**\n\t * Computed property for the product name.\n\t * Called when the lineRecord is set.\n\t * @private\n\t */\n\t_getProductName(lineRecord) {\n\t\treturn lineRecord[QuoteContext.constants.PRODUCT_NAME_FIELD];\n\t}\n\n\t_onTabChanged(e) {\n\t\t// do nothing if the selected tab is already active\n\t\tif (this.categoryIndex === e.detail) {\n\t\t\treturn;\n\t\t}\n\t\tput('UBPClientState', [ 'categoryIndex' ], e.detail);\n\t\tthis._loadRates(0);\n\t}\n\n\t_loading(requestCount) {\n\t\treturn requestCount > 0;\n\t}\n\n\t_loadRates(offset) {\n\t\tloadRates(offset);\n\t}\n}\n\nPolymer( UBPEditor );","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method to create an object capable of loading discount schedules and account summaries, and\n * posting those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, accountId) {\n\n\tfunction executeSequence() {\n\t\tvar scheduleMap = extractScheduleMapFromQuote();\n\t\tif (Object.keys(scheduleMap).length != 0) {\n\t\t\tvar context = {\n\t\t\t\t'schedules': scheduleMap,\n\t\t\t\t'overrides': {}, // If we're precaching, then obviously nothing can be overridden yet, so send empty object.\n\t\t\t\t'account': accountId\n\t\t\t};\n\t\t\treturn apex.load(prefix, 'DiscountAndAccountCallout', 'AllDiscountsAndAccounts', context)\n\t\t\t\t.then(function(results) {\n\t\t\t\t\tresultPoster({successful: true, provider: 'DiscountAndAccountCallout', uid: 'AllDiscountsAndAccounts', results: results});\n\t\t\t\t}, function(err) {\n\t\t\t\t\tself.postMessage({err: true, sequence: 'DiscountScheduleSequence', msg: err.message || err});\n\t\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\t\n\tfunction extractScheduleMapFromQuote() {\n\t\t// If the prefixed, it means we're in a managed install, and all Salesforce CPQ objects will have a\n\t\t// prefix.\n\t\tvar fieldPrefix = prefix ? prefix + '__' : '';\n\t\tvar scheduleMap = {};\n\t\tvar volumeDiscountField = fieldPrefix + 'DiscountSchedule__c';\n\t\tvar termDiscountField = fieldPrefix + 'TermDiscountSchedule__c';\n\t\tvar productField = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar vId = line.record[volumeDiscountField];\n\t\t\tvar tId = line.record[termDiscountField];\n\t\t\tvar cId = line.costScheduleId;\n\t\t\t\n\t\t\tif (vId != null) {\n\t\t\t\tif (scheduleMap[vId] == null) {\n\t\t\t\t\tscheduleMap[vId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[vId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (tId != null) {\n\t\t\t\tif (scheduleMap[tId] == null) {\n\t\t\t\t\tscheduleMap[tId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[tId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (cId != null) {\n\t\t\t\tif (scheduleMap[convertTo18(cId)] == null) {\n\t\t\t\t\tscheduleMap[convertTo18(cId)] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[convertTo18(cId)].push(line.record[productField]);\n\t\t\t}\n\t\t});\n\t\treturn scheduleMap;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n *\n * Exports a factory method to create an object capable of retrieving SFDC Field Metadata.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either an empty string or the appropriate org prefix.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} referencedFieldMap Which fields must be queried\n * @param {Object} settings object\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, referencedFieldMap, settings) {\n\n\tfunction executeSequence() {\n\t\tvar fullNames = determineMetadataFullNames();\n\t\tif (fullNames.length == 0) {\n\t\t\t// If there's no metadata to query, then just return;\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn apex.md('CustomField', fullNames, prefix)\n\t\t\t\t.then(function (mdResults) {\n\t\t\t\t\t// For field metadata, we create a Universal ID by concatenating all of the field names together using\n\t\t\t\t\t// ','.\n\t\t\t\t\tvar uid = fullNames.join(',');\n\t\t\t\t\tresultPoster({successful: true, provider: 'CustomField', uid: uid, results: mdResults});\n\t\t\t\t}, function(err) {\n\t\t\t\t\tself.postMessage({err: true, sequence: 'MetadataSequence', msg: err.msg || err});\n\t\t\t\t});\n\t\t}\n\t}\n\n\tfunction determineMetadataFullNames() {\n\t\tif (referencedFieldMap == null) {\n\t\t\treturn [];\n\t\t}\n\t\t// If the callout prefix we're given is non-null, then it means we're on a managed install, so all of the Salesforce CPQ\n\t\t// objects will have a prefix.\n\t\tvar objectPrefix = prefix ? prefix + '__' : '';\n\t\tvar fullNames = [];\n\t\tvar lineType = objectPrefix + 'QuoteLine__c';\n\t\tvar quoteType = objectPrefix + 'Quote__c';\n\t\tvar groupType = objectPrefix + 'QuoteLineGroup__c';\n\t\tvar linePricingGuidanceType = objectPrefix + \"QuoteLinePricingGuidance__c\";\n\t\t// For all field sets, create the field's full name by adding the object name to the beginning.\n\t\tfor (var key in referencedFieldMap) {\n\t\t\tvar typeName;\n\t\t\tif(key === 'Quote Line Pricing Guidance') {\n\t\t\t\tif(!settings || !settings.isPricingGuidanceEnabled) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttypeName = linePricingGuidanceType;\n\t\t\t} else if (key === 'Quote Line') {\n\t\t\t\ttypeName = lineType;\n\t\t\t} else if (key === 'Group') {\n\t\t\t\ttypeName = groupType;\n\t\t\t} else if (key === 'Quote') {\n\t\t\t\ttypeName = quoteType;\n\t\t\t} else {\n\t\t\t\ttypeName = key;\n\t\t\t}\n\t\t\tif (referencedFieldMap.hasOwnProperty(key)) {\n\t\t\t\treferencedFieldMap[key].forEach(function(fieldName) {\n\t\t\t\t\tfullNames.push(typeName + '.' + fieldName);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn fullNames;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either an empty string or the appropriate org prefix.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product Option fields that must be queried\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix ? prefix + '__' : '';\n\t\n\tfunction executeSequence() {\n\t\tvar optionIds = getOptionIdsFromLines();\n\t\tvar context = {\n\t\t\t'requiredIds': optionIds,\n\t\t\t'requiredFields': referencedFields || []\n\t\t};\n\t\tapex.setOptions({escape: false, timeout: 120000});\n\t\treturn apex.load(prefix, 'ProductOptionServiceProvider.ProductOptionLoader', 'AllOptions', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'ProductOptionServiceProvider.ProductOptionLoader', uid: 'AllOptions', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'OptionSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getOptionIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'ProductOption__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value && !uniquenessMap[value]) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for an object that can load information about price rules, summary variables,\n * assets, and subscriptions.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either an empty string or the appropriate org prefix.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, accountId) {\n\tfunction executeSequence() {\n\t\treturn loadPriceRules()\n\t\t\t.then(function(ruleRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'PriceRuleServiceProvider.PriceRuleReader', uid: 'PriceRules', results: ruleRecords});\n\t\t\t\treturn loadSummaryVariables(ruleRecords);\n\t\t\t})\n\t\t\t.then(function(svRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'SummaryVariableServiceProvider.SummaryVariableLoader', uid: 'SummaryVariables', results: svRecords});\n\t\t\t\treturn loadAssetsAndSubscriptions(svRecords);\n\t\t\t})\n\t\t\t.then(function(assetAndSubRecs) {\n\t\t\t\tresultPoster({successful: true, provider: 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', uid: 'AssetsAndSubs', results: assetAndSubRecs});\n\t\t\t})\n\t\t\t.catch(function(err) {\n\t\t\t\tself.postMessage({err: true, sequence: 'Price Rule Sequence', msg: err.msg || err});\n\t\t\t})\n\t}\n\n\t/**\n\t * Queries active Calculator-scoped price rules from the org.\n\t * @returns {Promise} Resolves to a list of records\n\t */\n\tfunction loadPriceRules() {\n\t\treturn apex.read(prefix, 'PriceRuleServiceProvider.PriceRuleReader', 'PriceRules');\n\t}\n\n\tfunction loadSummaryVariables(ruleRecords) {\n\t\tvar neededIds = getSummaryVariableIds(ruleRecords);\n\t\tvar svContext = {\n\t\t\t'svIds': neededIds\n\t\t};\n\t\treturn apex.load(prefix, 'SummaryVariableServiceProvider.SummaryVariableLoader', 'SummaryVariables', svContext);\n\t}\n\n\tfunction getSummaryVariableIds(ruleRecords) {\n\t\tvar recordPrefix = prefix ? prefix + '__' : '';\n\t\tvar filterVarField = recordPrefix + 'FilterVariable__c';\n\t\tvar testedVarField = recordPrefix + 'TestedVariable__c';\n\t\tvar sourceVarField = recordPrefix + 'SourceVariable__c';\n\t\tvar condRelationship = recordPrefix + 'PriceConditions__r';\n\t\tvar actionRelationship = recordPrefix + 'PriceActions__r';\n\t\tvar svIds = [];\n\t\tvar condIdCollector = function(condRecord) {\n\t\t\tif (condRecord[filterVarField]) {\n\t\t\t\tsvIds.push(condRecord[filterVarField]);\n\t\t\t}\n\t\t\tif (condRecord[testedVarField]) {\n\t\t\t\tsvIds.push(condRecord[testedVarField]);\n\t\t\t}\n\t\t};\n\t\tvar actionIdCollector = function(action) {\n\t\t\tif (action[sourceVarField]) {\n\t\t\t\tsvIds.push(action[sourceVarField]);\n\t\t\t}\n\t\t};\n\t\tif (ruleRecords.length > 0) {\n\t\t\truleRecords.forEach(function(rule) {\n\t\t\t\tif (rule[condRelationship] && rule[condRelationship].records.length > 0) {\n\t\t\t\t\trule[condRelationship].records.forEach(condIdCollector);\n\t\t\t\t}\n\t\t\t\tif (rule[actionRelationship] && rule[actionRelationship].records.length > 0) {\n\t\t\t\t\trule[actionRelationship].records.forEach(actionIdCollector);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn svIds;\n\t}\n\n\n\tfunction loadAssetsAndSubscriptions(svRecords) {\n\t\tif (!accountId) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t\tvar recordPrefix = prefix ? prefix + '__' : '';\n\t\tvar targetObjectField = recordPrefix + 'TargetObject__c';\n\t\tvar filterField = recordPrefix + 'FilterField__c';\n\t\tvar constraintField = recordPrefix + 'ConstraintField__c';\n\t\tvar aggregateField = recordPrefix + 'AggregateField__c';\n\n\t\tvar assetFields = [];\n\t\tvar subscriptionFields = [];\n\t\tfor (var svId in svRecords) {\n\t\t\tif (svRecords.hasOwnProperty(svId)) {\n\t\t\t\tvar svRec = svRecords[svId];\n\t\t\t\tif (svRec[targetObjectField] == 'Asset') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t} else if (svRec[targetObjectField] == 'Subscription') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar context = {\n\t\t\t'accountId': accountId,\n\t\t\t'assetFields': assetFields,\n\t\t\t'subscriptionFields': subscriptionFields\n\t\t};\n\n\t\treturn apex.load(prefix, 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', 'AssetsAndSubs', context);\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}\n","/**\n *\n * Exports a factory method to create an object capable of loading pricing guidance and account summaries, and\n * posting those results back to the main thread.\n */\nmodule.exports = runnerFactory;\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {String} accountId ID of the account on this quote\n * @param {Object} settings object\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, accountId, settings) {\n\n\tfunction executeSequence() {\n\t\tconst pricingGuidanceIds = extractPricingGuidanceIds();\n\t\tif (pricingGuidanceIds && pricingGuidanceIds.length != 0) {\n\t\t\tconst context = {\n\t\t\t\t'pricingGuidanceIds': pricingGuidanceIds,\n\t\t\t\t'accountId': accountId\n\t\t\t};\n\n\t\t\treturn apex.load(prefix, 'PricingGuidanceServiceProvider', null, context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'PricingGuidanceServiceProvider', results: {results: results, account: accountId, settings: settings}});\n\t\t\t}, function(err) {\n\t\t\t\tself.postMessage({err: true, sequence: 'PricingGuidanceSequence', msg: err.message || err});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tfunction extractPricingGuidanceIds() {\n\t\tlet pricingGuidanceIdSet = new Set();\n\t\tif(quote.lineItems) {\n\t\t\tquote.lineItems.forEach(function (line) {\n\t\t\t\tconst pgId = line.pricingGuidanceId;\n\t\t\t\tif (pgId) {\n\t\t\t\t\tpricingGuidanceIdSet.add(pgId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn Array.from(pricingGuidanceIdSet);\n\t}\n\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either an empty string or the appropriate org prefix.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product fields that must be included\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix ? prefix + '__' : '';\n\tfunction executeSequence() {\n\t\tvar productIds = getProductIdsFromLines();\n\t\tvar pricebookFilter = [];\n\t\tif (quote.record[fieldPrefix + 'PricebookId__c']) {\n\t\t\tpricebookFilter.push(quote.record[fieldPrefix + 'PricebookId__c']);\n\t\t}\n\t\tvar currencyFilter = [];\n\t\tif (quote.record['CurrencyIsoCode']) {\n\t\t\tcurrencyFilter.push(quote.record['CurrencyIsoCode']);\n\t\t}\n\t\tvar context = {\n\t\t\t'requiredIds': productIds,\n\t\t\t'productFields': referencedFields,\n\t\t\t'pricebookFilter': pricebookFilter,\n\t\t\t'currencyFilter': currencyFilter\n\t\t};\n\t\tapex.setOptions({escape: false, timeout: 120000});\n\t\treturn apex.load(prefix, 'ProductServiceProvider.ProductLoader', 'AllProducts', context)\n\t\t\t.then(function (results) {\n\t\t\t\tresultPoster({\n\t\t\t\t\tsuccessful: true,\n\t\t\t\t\tprovider: 'ProductServiceProvider.ProductLoader',\n\t\t\t\t\tuid: 'AllProducts',\n\t\t\t\t\tresults: results\n\t\t\t\t});\n\t\t\t}, function (err) {\n\t\t\t\tresultPoster({err: true, sequence: 'ProductSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getProductIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value != null && uniquenessMap[value] == null) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for creating an object that can query related records referenced by the quote, lines, or groups,\n * and post those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either an empty string or the appropriate managed package prefix.\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Object} lookupFieldMap A map from lookup field names to the objects targeted by those fields\n * @param {Object} referencedFieldMap A map from objects to the required fields on those objects\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, lookupFieldMap, referencedFieldMap) {\n\tfunction executeSequence() {\n\t\tvar context = {\n\t\t\t'queryInfo': {}\n\t\t};\n\t\t\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.quoteLookups, [quote], prefix);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.groupLookups, quote.lineItemGroups, prefix);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.lineLookups, quote.lineItems, prefix);\n\t\t\n\t\treturn apex.load(prefix, 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', 'AllAdditionalLookups', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', uid: 'AllAdditionalLookups', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'RelatedRecordSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction sweepModelsForLookupIds(context, lookupFields, models, prefix) {\n\t\t// If there are lookup relationships to test, and records to test them against...\n\t\tif (lookupFields && models && models.length > 0) {\n\t\t\t// For every lookup field on this object type...\n\t\t\tfor (var key in lookupFields) {\n\t\t\t\tif (lookupFields.hasOwnProperty(key)) {\n\t\t\t\t\t// Get the SObject type the field points to.\n\t\t\t\t\tvar targetType = lookupFields[key];\n\t\t\t\t\tvar aliasTargetType = getAliasTargetType(targetType, prefix);\n\t\t\t\t\t// Check that field on each record to see if it has a value\n\t\t\t\t\tmodels.forEach(function(model) {\n\t\t\t\t\t\tvar id = model.record[key];\n\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\tvar convertedId = convertTo18(id);\n\t\t\t\t\t\t\tif (!convertedId) {\n\t\t\t\t\t\t\t\t// If the ID didn't convert properly, we skip it\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else if (!context.queryInfo[targetType]) {\n\t\t\t\t\t\t\t\t// If the context doesn't contain query info for this object type yet, add it.\n\t\t\t\t\t\t\t\t// We need the Id and the referenced fields on this object.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType] = {\n\t\t\t\t\t\t\t\t\t'referencedFields': referencedFieldMap[aliasTargetType],\n\t\t\t\t\t\t\t\t\t'referencedIds': [convertedId]\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// If the context already has query info for this object type, we just add the ID to the\n\t\t\t\t\t\t\t\t// list of those we're querying for.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType]['referencedIds'].push(convertedId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Converts target types for custom lookups that reference Quote__c, QuoteLineGroup__c, or QuoteLine__c\n\t * into Quote, Quote Line Group, and Quote Line, so we can pull in their referenced fields\n\t * @param {String} targetType Represents the name of the custom object lookup\n\t * @returns {*}\n\t */\n\tfunction getAliasTargetType(targetType, prefix) {\n\t\tif(prefix !== ''){\n\t\t\tprefix = prefix + '__';\n\t\t}\n\t\tswitch(targetType) {\n\t\t\tcase prefix + 'Quote__c':\n\t\t\t\treturn 'Quote';\n\t\t\tcase prefix + 'QuoteLineGroup__c':\n\t\t\t\treturn 'Group';\n\t\t\tcase prefix + 'QuoteLine__c':\n\t\t\t\treturn 'Quote Line';\n\t\t\tdefault:\n\t\t\t\treturn targetType;\n\t\t}\n\t};\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 11/6/18.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex - Provides access to SFDC data via an Apex REST callout.\n * @param {String} prefix - The prefix used for callouts. Either the Namespace used by the installed Salesforce CPQ\n * package or the hardcoded prefix of the deployed scratch org.\n * @param {Function} resultPoster\n * @param {Object} quote - The Quote data.\n * @param {JSON} settings - A serialized QuoteEditorModel.EditorSettings instance.\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, settings) {\n\tconst fieldPrefix = prefix ? `${prefix}__` : '';\n\tconst lineItemsToLoad = [];\n\tconst provider = 'ConsumptionServiceProvider.UBPEditorLoader';\n\n\t// Every precache sequence runner needs to return an object containing an executeSequence() method that performs the\n\t// load and posts the results back to the main thread. So let's define that method.\n\tfunction executeSequence() {\n\t\tconst isManualEditEnabled = settings.isManualEditsForUBPEnabled || false;\n\t\t// If the settings don't reference a plugin and manual edit are not enabled, then the Consumption Schedules won't be manipulated during calculation,\n\t\t// and don't need to be loaded. Likewise, if the quote has no lines, then there aren't even any schedules to manipulate.\n\t\t// So if either of those things are true, we can just return a resolved Promise.\n\t\tif (!(settings.jsqcPlugin || isManualEditEnabled) || !quote.lineItems || quote.lineItems.length === 0) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// Create the context for the callout. If no context was created, no callout is needed and we can return a resolved\n\t\t// Promise.\n\t\tlet ctx = createCalloutContext();\n\t\tif (!ctx) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn performLoadAndFormatResults(ctx);\n\t}\n\n\t/**\n\t * Return List of Required Consumption Rate Fields\n\t * @param fieldPrefix - Field Prefix (SBQQ__)\n\t * @return {string[]}\n\t * @private\n\t */\n\tfunction _getRequiredConsumptionRateFields(fieldPrefix) {\n\t\treturn [\n\t\t\t`${fieldPrefix}ProcessingOrder__c`,\n\t\t\t`${fieldPrefix}LowerBound__c`,\n\t\t\t`${fieldPrefix}UpperBound__c`,\n\t\t\t`${fieldPrefix}Price__c`,\n\t\t];\n\t}\n\n\t/**\n\t * Return List of Required Consumption Schedule Fields\n\t * @param fieldPrefix - Field Prefix (SBQQ__)\n\t * @return {string[]}\n\t * @private\n\t */\n\tfunction _getRequiredConsumptionScheduleFields(fieldPrefix) {\n\t\treturn [`${fieldPrefix}Category__c`];\n\t}\n\n\tfunction createCalloutContext() {\n\t\t// Pull the consumption rate and consumption schedule fields from the ConsumptionRate and ConsumptionSchedule entries\n\t\t// in the ubpReferencedFieldMap, defaulting to an empty list.\n\t\tconst {ConsumptionRate: consumptionRateFields = [], ConsumptionSchedule: consumptionScheduleFields = []} = settings.ubpReferencedFieldMap;\n\t\tconst requiredConsumptionRateFieldsSet = new Set([...consumptionRateFields, ..._getRequiredConsumptionRateFields(fieldPrefix)]);\n\t\tconst requiredConsumptionScheduleFieldsSet = new Set([...consumptionScheduleFields, ..._getRequiredConsumptionScheduleFields(fieldPrefix)]);\n\n\t\tlet hasConsumptionField = fieldPrefix + 'HasConsumptionSchedule__c';\n\t\tlet lineIdSet = new Set();\n\t\tquote.lineItems.forEach((line) => {\n\t\t\t// For each line that has a consumption schedule associated with it\n\t\t\tif (line.record[hasConsumptionField]) {\n\t\t\t\t// The actual UBP DAO consults the Line ID, followed by the Product ID if there's no Line ID. However,\n\t\t\t\t// since this will only run on QLE loading, when all lines are guaranteed to exist, we'll just check the\n\t\t\t\t// Line IDs. Likewise, we don't have to do a check to see if the line is already cached.\n\t\t\t\tlineIdSet.add(line.record['Id']);\n\t\t\t\tlineItemsToLoad.push(line);\n\t\t\t}\n\t\t});\n\n\t\t// If there are no line items to load, then we can return null.\n\t\tif (lineItemsToLoad.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet lineIdArray = Array.from(lineIdSet);\n\t\treturn {\n\t\t\ttransactionIds: lineIdArray,\n\t\t\tscheduleFields: [...requiredConsumptionScheduleFieldsSet],\n\t\t\tfields: [...requiredConsumptionRateFieldsSet],\n\t\t};\n\t}\n\n\tfunction performLoadAndFormatResults(ctx) {\n\t\tapex.setOptions({escape: false, timeout: 120000});\n\t\treturn apex.load(prefix, provider, null, ctx)\n\t\t\t.then((results) => {\n\t\t\t\t// If we didn't get any results, just resolve.\n\t\t\t\tif (!results.transactionIdsToSObjects || !results.transactionIdsToSObjects.ConsumptionSchedules) {\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\t// Map each schedule list by the ID of the line that used it so we can send it into the precacher.\n\t\t\t\tlet resultsToPost = {};\n\t\t\t\tlineItemsToLoad.forEach((line) => {\n\t\t\t\t\tlet schedules = results.transactionIdsToSObjects.ConsumptionSchedules[line.record.Id];\n\t\t\t\t\tif (!schedules) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (results.transactionIdsToSObjects.ConsumptionRates) {\n\t\t\t\t\t\tschedules.forEach((schedule) => {\n\t\t\t\t\t\t\tschedule.consumptionRates = results.transactionIdsToSObjects.ConsumptionRates[schedule.Id];\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresultsToPost[line.record.Id] = schedules;\n\t\t\t\t});\n\t\t\t\t// Post the results to the main thread.\n\t\t\t\tresultPoster({\n\t\t\t\t\tsuccessful: true,\n\t\t\t\t\tprovider: provider,\n\t\t\t\t\tuid: null,\n\t\t\t\t\tresults: resultsToPost\n\t\t\t\t});\n\t\t\t}, (err) => {\n\t\t\t\tresultPoster({err: true, sequence: 'UbpSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\n\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","import {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {LETableHeaderTemplateGenerator} from \"../../layout/template-generator/LETableHeaderTemplateGenerator.js\";\nimport {QLESegmentedTableBehavior} from 'quotes/tables/QLESegmentedTableBehavior.js';\nimport {toFieldName} from 'common/Util.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class SFSegmentedTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.SFAbstractTable, window.CommonBehaviors.QLESegmentedTableBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.GROUP_PANEL_CREATED] = this.groupPanelCreated;\n\t\te[Events.GROUP_PANEL_TOGGLED] = this.groupPanelToggled;\n\t\te[Events.GROUP_TOGGLED] = this.groupToggled;\n\t\te[Events.TOGGLE_OPTIONAL_CLICKED] = this.toggleOptional;\n\t\te[Events.OPEN_LOOKUP_DIALOG] = this._openLookupDialog;\n\t\te[Events.CLOSE_LOOKUP_DIALOG] = this._closeLookupDialog;\n\t\te[Events.REFRESH_TABLE] = this._prepareUIData;\n\t\te[Events.RESET_ON_ACTION] = this._resetOnAction;\n\t\te[Events.LINE_SPLICE_COMPLETE] = this.postLineSplice;\n\t\te[Events.SORT_LINES_REQUIRED] = this.sortLinesRequired;\n\t\te[Events.COL_WIDTHS_CHANGED] = this.colWidthsChanged;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-segmented-table';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t},\n\t\t\tsecondaryRowTemplate: Object,\n\t\t\tuiData: Object,\n\t\t\t// original field values for dirty field tracking (post inline edit pre server save)\n\t\t\toriginalFieldValues: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\texpansionIconClass: {\n\t\t\t\ttype: String,\n\t\t\t},\n\t\t}, QLESegmentedTableBehavior.properties);\n\t\tthis.listeners = {\n\t\t\t// remove cell focus when action is performed (W-5715699)\n\t\t\t'le-action-tapped': 'unfocus'\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ '_modelReady(groupModel)' ];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tthis.addEventListener('line-toggled', (e) => {\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis._onUpdateSizeForItem(e);\n\t\t\t}\n\t\t});\n\t}\n\n\t_modelReady(groupModel) {\n\t\t// Pulled this code from ready so making sure it only runs once.\n\t\tif (!groupModel || this._initialized) {\n\t\t\treturn;\n\t\t}\n\t\tthis._initialized = true;\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t\t});\n\t\t}\n\n\t\t// populate QuoteContext.constants\n\t\tQuoteContext.constants = this.editorModel.constants;\n\n\t\tthis._resetHeaderTemplate();\n\n\t\t// prepare presentation data for row-level rendering\n\t\tthis._prepareUIData();\n\n\t\t// row template\n\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, groupModel, this.columnNames, this.dimension).generateRowNode(this._getFieldsForTemplate());\n\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t//secondary row template\n\t\t\tthis.secondaryRowTemplate = this.getTemplateGenerator(this.editorModel, groupModel, null, null, true).generateRowNode(this._getFields(), {'class': TemplateGenerator.classNames.SECONDARY + \" \" + TemplateGenerator.classNames.EXPANDED});\n\t\t}\n\t}\n\n\t/**\n\t * Prepare presentation-ready data for each line\n\t * This is invoked at ready, as well as when lines are spliced or rebuilt\n\t * @private\n\t */\n\t_prepareUIData() {\n\t\tlet fields = (AppContext.isMobile ? this._getAllFields() : this._getFields());\n\t\tthis.uiData = UIDataManager.prepareLineData(this.groupModel.segmentedLinesByDimension[this.dimension], fields, this.quoteLineFields);\n\t}\n\n\tgetUIData(index) {\n\t\treturn this.uiData[index];\n\t}\n\n\t/**\n\t * Additional cell-level css class, which is pre-calculated by UIDataManager\n\t * This function is invoked when rowTemplate is stamped (see TemplateGenerator#generateFieldSetTemplate)\n\t * This is on table level because Polymer templatization invokes the callback on rootHost (table), not host (row),\n\t * even though binding happens on host level\n\t * @param rowIndex 0-based row index\n\t * @param field name of field\n\t */\n\tcomputeCellClass(rowIndex, field) {\n\t\tlet lineModel = this.groupModel.segmentedLines[rowIndex];\n\t\tif (lineModel &&\n\t\t\tthis.uiData[rowIndex] &&\n\t\t\tthis.uiData[rowIndex]._cellClasses) {\n\t\t\treturn this.uiData[rowIndex]._cellClasses[field] || '';\n\t\t}\n\t}\n\n\t/**\n\t * Triggered by change to segmentedLinesByDimension map\n\t * @param e - the event that contains the dimensions that will get set and notified to lineModels\n\t * @private\n\t */\n\t_segmentedLinesByDimensionChanged(e) {\n\t\tlet parts,\n\t\t\tisCurrentDimension;\n\t\t// handles splices by setting the updated segmentedLinesByDimension array\n\t\tparts = e.path.split(`.`);\n\t\tisCurrentDimension = parts.indexOf(this.dimension) >= 0 ? true : false;\n\t\tthis.lineModels = this.groupModel.segmentedLinesByDimension[this.dimension];\n\t\tif (parts[parts.length - 1] == 'splices' && isCurrentDimension) {\n\t\t\tlet spliceChanges = e.value.indexSplices;\n\t\t\tif (spliceChanges[0].removed && spliceChanges[0].object.length === 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = false;\n\t\t\t} else if (spliceChanges[0].addedCount > 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = true;\n\t\t\t}\n\t\t\tthis._prepareUIData();\n\t\t}\n\t}\n\n\t/**\n\t * Dereference groupModel and editorModel to build MDQ rows\n\t * @private\n\t */\n\t_render() {\n\t\tif(!this.groupModel) return;\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.dimension = this.attributes.key.value;\n\t\tthis.hasVisibleSegmentedLines = this.groupModel.hasVisibleSegmentedLines[this.dimension];\n\t\tthis.fieldNames = this._getFields();\n\t\tthis.lineModels = this.groupModel.segmentedLinesByDimension[this.dimension];\n\t\tthis.linkPaths(`groupModel.segmentedLinesByDimension.${this.dimension}`, 'lineModels');\n\t\tlet fieldLabelsMap = {};\n\t\tfor (let label in this.editorModel.md.fieldLabelsMap) {\n\t\t\tfieldLabelsMap[toFieldName(label)] = this.editorModel.md.fieldLabelsMap[label];\n\t\t}\n\t\tthis.fieldLabelsMap = fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis.settings = this.editorModel.data.settings;\n\t\tthis.detailFieldNames = this.editorModel.fieldsetMap.multiSegmentLineFieldNames;\n\n\t\t// column names are either on the groupVO or on the quoteVO depending on the state of the quote\n\t\t// Columns, totals for subtotals and totals\n\t\tlet multiSegmentColumns = this.groupModel.groupVO.multiSegmentColumns;\n\t\tif (multiSegmentColumns && Object.keys(multiSegmentColumns).length > 0) {\n\t\t\tthis.columnNames = multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension];\n\t\t} else {\n\t\t\tthis.columnNames = this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension];\n\t\t}\n\n\t\tthis.netMultiSegmentTotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.expansionIconClass = 'sf-icon-right';\n\t}\n\n\t_getFieldsForTemplate() {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn this.editorModel.segmentedPrimaryMobileCols;\n\t\t} else {\n\t\t\treturn this._getFields();\n\t\t}\n\t}\n\n\t_getFieldSetName() {\n\t\treturn this.editorModel.fieldSetNames.multiSegmentLineSummaryFieldNames;\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}`, model.slice());\n\t\t\t// Still needed to update UI after sorting\n\t\t\tthis.notifyPath('lineModels', model.slice());\n\t\t\tthis._prepareUIData();\n\n\t\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, this.columnNames, this.dimension).generateRowNode(this._getFields());\n\t\t} else {\n\t\t\tthis.groupModel.segmentedLinesByDimension[this.dimension] = model;\n\t\t}\n\t}\n\n\t/**\n\t * Refresh table when column name is changed. This needs to be done for LQE only as non-LQE table is reloaded entirely\n\t * @override\n\t * @param newValue\n\t * @param oldValue\n\t */\n\tcolumnNamesChanged(newValue, oldValue) {\n\t\tif (!!oldValue && this.editorModel && this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis._prepareUIData();\n\t\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, this.columnNames, this.dimension).generateRowNode(this._getFields());\n\t\t\tthis._resetHeaderTemplate();\n\t\t}\n\t}\n\t\n\t_resetHeaderTemplate() {\n\t\tif(!this.editorModel.deviceContext.isMobile) {\n\t\t\t//segmentedTable so isSegmented param of the Template Generator is true\n\t\t\tvar headerTemplateGenerator = new LETableHeaderTemplateGenerator(this.editorModel, this.columnWidths, this.columnNames);\n\t\t\t//header template\n\t\t\tthis.headerTemplate = headerTemplateGenerator.generateHeaderNode(this._getFieldsForTemplate());\n\t\t}\n\t}\n\n\t/**\n\t * Get Standard Fields along with mobile primary fields\n\t * @param fields\n\t * @private\n\t */\n\t_getAllFields() {\n\t\tlet fields = this._getFields();\n\t\t// always add mobile primary columns because they may not be in the field set (W-5891338)\n\t\tif (this.editorModel.segmentedPrimaryMobileCols) {\n\t\t\tfields = fields.concat(this.editorModel.segmentedPrimaryMobileCols);\n\t\t}\n\t\treturn [...new Set(fields)]; // dedupe\n\t}\n}\n\nPolymer( SFSegmentedTable );\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {QLEStandardTableBehavior} from 'quotes/tables/QLEStandardTableBehavior.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsShareParent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsAreParentChild} from 'quotes/models/DragDropModel.js';\nimport {removeTableRowBorderClass} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LETableHeaderTemplateGenerator} from \"../../layout/template-generator/LETableHeaderTemplateGenerator.js\";\nimport { get as readFromCache, put as updateCache } from 'quotes/models/ClientCache.js';\nimport { Events } from 'common/core/Events.js';\n\nconst GHOST_X_OFFSET = 9;\nconst GHOST_Y_OFFSET = 147;\n\n/**\n * Table-level component for QuoteLineEditor\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFStandardTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.SFAbstractTable, window.CommonBehaviors.QLEStandardTableBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.GROUP_PANEL_CREATED] = this.groupPanelCreated;\n\t\te[Events.GROUP_PANEL_TOGGLED] = this.groupPanelToggled;\n\t\te[Events.GROUP_TOGGLED] = this.groupToggled;\n\t\te[Events.SORT_LINES_REQUIRED] = this.sortLinesRequired;\n\t\te[Events.TOGGLE_OPTIONAL_CLICKED] = this.toggleOptional;\n\t\te[Events.QUOTE_SAVED] = this.clearOriginalFieldValues;\n\t\te[Events.ROWS_RENUMBERED] = this.onRowsRenumbered;\n\t\te[Events.OPEN_LOOKUP_DIALOG] = this._openLookupDialog;\n\t\te[Events.CLOSE_LOOKUP_DIALOG] = this._closeLookupDialog;\n\t\te[Events.REFRESH_TABLE] = this._prepareUIData;\n\t\te[Events.LINE_SPLICE_COMPLETE] = this.postLineSplice;\n\t\te[Events.COL_WIDTHS_CHANGED] = this.colWidthsChanged;\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\t\n\tbeforeRegister() {\n\t\tthis.is = 'sf-standard-table';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\theaderTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t},\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t},\n\t\t\tsecondaryRowTemplate: Object,\n\t\t\tuiData: Object,\n\t\t\t// original field values for dirty field tracking (post inline edit pre server save)\n\t\t\toriginalFieldValues: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t}, QLEStandardTableBehavior.properties);\n\t\tthis.listeners = {\n\t\t\t// remove cell focus when action is performed (W-5715699)\n\t\t\t'le-action-tapped': 'unfocus'\n\t\t}\n\t}\n\n\tready() {\n\t\t// return if necessary data isn't available so it's test-friendly\n\t\tif (!this.groupModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.init();\n\t\tlet validTargets = new Set(['sb-droppable-standardRows', 'sb-droppable-emptyTable', 'sb-droppable-sidePanelGroups', 'emptyTableMessage']);\n\t\tif (!this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sf-le-table-row',\n\t\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t\t} else {\n\t\t\tthis.addEventListener('bundle-toggled', this._toggleBundleLines);\n\t\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\t\tthis._resizeIronList();\n\t\t}\n\t\t// prepare presentation data for row-level rendering\n\t\tthis._prepareUIData();\n\t\tthis._prepareTemplates(true);\n\t}\n\n\t/**\n\t * Prepare presentation-ready data for each line\n\t * This is invoked at ready, as well as when lines are spliced or rebuilt\n\t * @private\n\t */\n\t_prepareUIData() {\n\t\tlet fields = AppContext.isMobile ? this._getAllFields(true) : this._getFields();\n\t\tthis.uiData = UIDataManager.prepareLineData(this.groupModel.standardLines, fields, this.quoteLineFields);\n\t}\n\n\t/**\n\t * Generate and populate rowTemplate, secondaryRowTemplate (mobile only) and optionally table header template (desktop only)\n\t * @param includeHeader\n\t * @private\n\t */\n\t_prepareTemplates(includeHeader) {\n\t\t// row template\n\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null).generateRowNode(this._getFieldsForTemplate(), {'class': 'row'});\n\t\tif(AppContext.isMobile) {\n\t\t\t//secondary row template\n\t\t\tthis.secondaryRowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null, null, true).generateRowNode(this._getAllFields(false), {'class': TemplateGenerator.classNames.SECONDARY + \" \" + TemplateGenerator.classNames.EXPANDED});\n\t\t} else if (includeHeader) {\n\t\t\t// header template\n\t\t\t//standardTable so there are no segmented columns\n\t\t\tvar headerTemplateGenerator = new LETableHeaderTemplateGenerator(this.editorModel, this.columnWidths, null, true);\n\t\t\t//header template\n\t\t\tthis.headerTemplate = headerTemplateGenerator.generateHeaderNode(this._getFieldsForTemplate(), {'class': 'header'});\n\t\t}\n\t}\n\n\tgetUIData(index) {\n\t\treturn this.uiData[index];\n\t}\n\n\t/**\n\t * Additional cell-level css class, which is pre-calculated by UIDataManager\n\t * This function is invoked when rowTemplate is stamped (see TemplateGenerator#generateFieldSetTemplate)\n\t * This is on table level because Polymer templatization invokes the callback on rootHost (table), not host (row),\n\t * even though binding happens on host level\n\t * @param rowIndex 0-based row index\n\t * @param field name of field\n\t */\n\tcomputeCellClass(rowIndex, field) {\n\t\tlet lineModel = this.groupModel.standardLines[rowIndex];\n\t\tif (lineModel &&\n\t\t\tthis.uiData[rowIndex] &&\n\t\t\tthis.uiData[rowIndex]._cellClasses) {\n\t\t\treturn this.uiData[rowIndex]._cellClasses[field] || '';\n\t\t}\n\t}\n\n\t/**\n\t * Get Standard Fields along with Drawer Fields and optionally mobile primary fields\n\t * @param includePrimaryMobileCols Whether primary mobile fields should be included\n\t * @private\n\t */\n\t_getAllFields(includePrimaryMobileCols) {\n\t\tlet fields = this._getFields();\n\t\t// if there are drawer fields\n\t\tif (this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames) {\n\t\t\tfields = fields.concat(this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames);\n\t\t}\n\t\tif (includePrimaryMobileCols && this.editorModel.standardPrimaryMobileCols) {\n\t\t\t// add mobile primary columns when requested, so that it's in uiData when needed (W-5891338)\n\t\t\tfields = fields.concat(this.editorModel.standardPrimaryMobileCols);\n\t\t}\n\t\treturn [...new Set(fields)]; // dedupe\n\t}\n\n\t_getFieldSetName() {\n\t\tif (this.editorModel && this.editorModel.fieldSetNames) {\n\t\t\treturn this.editorModel.fieldSetNames.lineFieldNames;\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param dragElement\n\t * @param dropElement\n\t */\n\tpostDrop(dragElement, dropElement) {\n\t\t// post drop refreshing\n\t\tvar dragTable = dragElement.domHost;\n\t\tvar dropTable = dropElement.domHost;\n\t\tif (dragTable && dragTable.tagName === 'SF-STANDARD-TABLE') {\n\t\t\tdragTable._prepareUIData();\n\t\t}\n\t\tif (dropTable && dropTable.tagName === 'SF-STANDARD-TABLE' && dragTable !== dropTable) {\n\t\t\tdropTable._prepareUIData();\n\t\t}\n\t}\n\n\t_getFieldsForTemplate() {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn this.groupModel.editorModel.standardPrimaryMobileCols;\n\t\t} else {\n\t\t\treturn this._getFields();\n\t\t}\n\t}\n\n\t_onSortLinesByHeader(e) {\n\t\tthis.sortLines(this.groupModel.standardLines, e.detail.lineSortField, e.detail.order, this.settings.bundleKeptTogether, true)\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\");\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tif (this._hasNumberField()) {\n\t\t\tthis._preserveNumberValues(lines);\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set('groupModel.standardLines', model.slice());\n\t\t\tthis._prepareUIData();\n\t\t\tthis._prepareTemplates(false);\n\t\t} else {\n\t\t\tthis.groupModel.standardLines = model;\n\t\t}\n\t\tthis._resizeIronList();\n\t}\n\n\t/**\n\t * Notify iron list to resize\n\t * @private\n\t */\n\t_resizeIronList() {\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tif (this.$$('iron-list')) {\n\t\t\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when rows are renumbered as a result of clone or delete line\n\t */\n\tonRowsRenumbered() {\n\t\t// refresh UI data so row numbers are re-stamped\n\t\tthis._prepareUIData();\n\t\tthis._resizeIronList();\n\t}\n\n\t/**\n\t * Preserve the original number values of each line into originalFieldValues\n\t * @param lines\n\t */\n\t_preserveNumberValues(lines) {\n\t\tlines.forEach((line) => {\n\t\t\tlet record = line.lineVO.record;\n\t\t\tlet id = record.Id || record[this.editorModel.constants.SOURCE_FIELD];\n\t\t\tlet numberField = this.editorModel.constants.NUMBER_FIELD;\n\t\t\tif (!this.originalFieldValues[id]) {\n\t\t\t\tthis.originalFieldValues[id] = {};\n\t\t\t}\n\t\t\tif (!this.originalFieldValues[id].hasOwnProperty(numberField)) {\n\t\t\t\tthis.originalFieldValues[id][numberField] = record[numberField];\n\t\t\t}\n\t\t});\n\t}\n\n\t_hasNumberField() {\n\t\treturn this._getFields().indexOf(this.editorModel.constants.NUMBER_FIELD) > -1;\n\t}\n\n\t/**\n\t * Post line splice listening\n\t */\n\tpostLineSplice() {\n\t\tif (this._hasNumberField()) {\n\t\t\tthis._preserveNumberValues(this.groupModel.standardLines);\n\t\t}\n\t\tthis._prepareTemplates(false);\n\t}\n\n\t/**\n\t * Clear originalFieldValues (used when we need to clear originalFieldValues property, ex: QuickSave was invoked)\n\t */\n\tclearOriginalFieldValues() {\n\t\tif (this.originalFieldValues) {\n\t\t\tObject.keys(this.originalFieldValues).forEach((key) => {\n\t\t\t\tdelete this.originalFieldValues[key];\n\t\t\t})\n\t\t}\n\t}\n\n\tgetRowComponentName() {\n\t\treturn 'sf-le-table-row';\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpostBuildRowRefresh() {\n\t\t// re-generate ui data and template because the groupModel is updated\n\t\tif (this.uiData) {\n\t\t\tthis._prepareUIData();\n\t\t\tthis._prepareTemplates(true);\n\t\t}\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tif (!this._isMobile()) { // W-7516049 we have to skip handling for mobile\n\t\t\tthis._setColumnWidths(e);\n\t\t\tthis._prepareTemplates(false);\n\t\t}\n\t}\n\n\t/**\n\t * Event handling for bundle-toggle, this recursively toggle's the given line's children\n\t * @param e { key, expanded } key is the parent line's lineVO.key, expanded indicates whether children should be expanded or collapsed\n\t * @private\n\t */\n\t_toggleBundleLines(e) {\n\t\t// Just one line is being toggled\n\t\tif (e.detail.key) {\n\t\t\tlet parentLine = this.groupModel.standardLines.find((line) => {\n\t\t\t\treturn line.lineVO.key === e.detail.key\n\t\t\t});\n\t\t\tif (parentLine) {\n\t\t\t\tthis._innerToggleBundleLines(parentLine, e.detail.expanded);\n\t\t\t\tthis._resizeIronList();\n\t\t\t}\n\t\t} else {\n\t\t\t// all bundle lines are being toggled\n\t\t\tupdateCache('BundleCollapsed', 'h' + this.groupModel.groupVO.key, !e.detail.expanded);\n\t\t\tthis.groupModel.standardLines.forEach((line, index) => {\n\t\t\t\tif (line.isBundle) {\n\t\t\t\t\tthis.set(`groupModel.standardLines.${index}.bundleCollapsed`, !e.detail.expanded);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\t_innerToggleBundleLines(parentLine, expanded) {\n\t\tlet children = parentLine && parentLine.isBundle;\n\t\tif (children) {\n\t\t\t// do not expand child lines if this parent line's currently collapsed, so that we can maintain a subtree's state\n\t\t\tif (expanded && parentLine.bundleCollapsed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tchildren.forEach((line) => {\n\t\t\t\tlet index = this._getLineIndexFromKey(this.groupModel.standardLines, line.lineVO.key);\n\t\t\t\tthis.set(`groupModel.standardLines.${index}.bundleVisible`, expanded);\n\t\t\t\tthis._innerToggleBundleLines(line, expanded);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * A line is visible when both visible and bundleVisible is set to true\n\t * LineModel.visible is controlled by component visibility set in ProductOptions\n\t * LineModel.bundleVisible is controlled by bundle expand collapse\n\t * @param visible\n\t * @param bundleVisible\n\t * @returns {*}\n\t * @private\n\t */\n\t_isLineVisible(visible, bundleVisible) {\n\t\treturn visible && bundleVisible;\n\t}\n\n\t/**\n\t * Provide ui data for table header, starting with fieldLabelMap, then injecting extra data such as bundle tree _caretContent\n\t * @param fieldLabelsMap\n\t * @returns {any}\n\t * @private\n\t */\n\t_getHeaderUIData(fieldLabelsMap) {\n\t\tif (AppContext.isBundleCollapsible(this.editorModel)) {\n\t\t\t// compute the table header's caret state\n\t\t\t// first read from cache, then fall back to default setting if unavailable\n\t\t\tconst collapsed = readFromCache('BundleCollapsed', 'h' + this.groupModel.groupVO.key);\n\t\t\tconst collapsedContent = collapsed || AppContext.defaultBundleSetting === 'Collapsed' ?\n\t\t\t\tTemplateGenerator.classNames.CHEVRON_RIGHT_CONTENT :\n\t\t\t\tTemplateGenerator.classNames.CHEVRON_DOWN_CONTENT;\n\t\t\treturn Object.assign({'_caretContent': collapsedContent}, this.fieldLabelsMap);\n\t\t} else {\n\t\t\treturn this.fieldLabelsMap;\n\t\t}\n\t}\n}\n\nPolymer( SFStandardTable );\n\n\n","/**\n * Copyright, 1999-2018, salesforce.com All Rights Reserved Company Confidential\n */\nimport { localizeContent } from 'common/core/AppContext.js';\nimport { Html } from 'common/layout/sb-html/Html.js';\nimport { pathGet, pathMutate, Util } from 'common/Util.js';\nimport { TemplateGenerator } from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport { TableRowTemplateGenerator } from 'quotes/layout/template-generator/TableRowTemplateGenerator.js';\nimport { get, put } from 'quotes/models/ClientCache.js';\nimport { DataHandlerBehavior } from 'quotes/models/DataHandlerBehavior.js';\nimport { loadRates, search, overrideRecValues } from 'quotes/usage-based-pricing-dao/UsageBasedPricingDao.js';\nimport { QuoteContext } from 'quotes/QuoteContext.js';\nimport { ConsumptionRateValidator } from 'quotes/consumption-rate-validator/ConsumptionRateValidator.js';\nimport { AppContext } from 'common/core/AppContext.js';\nimport { SFAbstractTable } from 'quotes/tables/SFAbstractTable.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\n/**\n * UBP Usage Rate Table Component\n *\n * The Usage Rate Table is a table that contains rate data that is displayed inside of the UBPE.\n * This rate data could be coming from many rate cards that are associated to a product and is\n * filtered by which tab is selected.\n *\n * @author hongda.li\n * @since 216\n */\n\n// Description fields are not sortable\nconst UNSORTABLE_FIELDS = ['Description', 'ConsumptionSchedule.Description'];\n\nexport class UBPRateTable {\n\tget behaviors() {\n\t\treturn [ DataHandlerBehavior, window.CommonBehaviors.TemplatizationBehavior, Polymer.IronResizableBehavior, window.CommonBehaviors.SFAbstractTable ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'ubp-rate-table';\n\n\t\tthis.properties = {\n\t\t\tclientCacheSearchInput: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: ['searchKeyword']\n\t\t\t\t},\n\t\t\t},\n\t\t\tuserSearchInput: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_getRowTemplate(fields)'\n\t\t\t},\n\n\t\t\t// rate card category\n\t\t\tcategoryId: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: '_categoryIdChanged'\n\t\t\t},\n\n\t\t\trateIds: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'categoryId',\n\t\t\t\t\tpath: ['orderedRates'],\n\t\t\t\t},\n\t\t\t\tobserver: '_rateIdsChanged'\n\t\t\t},\n\n\t\t\tfields: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'categoryId',\n\t\t\t\t\tpath: ['fields'],\n\t\t\t\t},\n\t\t\t},\n\n\t\t\ttotalRateCount: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'categoryId',\n\t\t\t\t\tpath: ['rateCount'],\n\t\t\t\t},\n\t\t\t\tvalue: 0\n\t\t\t},\n\n\t\t\tsortField: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'categoryId',\n\t\t\t\t\tpath: ['sortField']\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsortOrder: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tidProperty: 'categoryId',\n\t\t\t\t\tpath: ['sortOrder']\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tquoteLineOrProdId: {\n\t\t\t\ttype: String,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: ['quoteLineOrProdId']\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UBPClientState',\n\t\t\t\t\tpath: ['lineKey']\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thasInlineEditChanges: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\n\t\t\tinlineEditedCategories: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserving: {\n\t\t\t\t\tid: 'UbpInlineEditChanges',\n\t\t\t\t\tpath: [ 'categories' ]\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// the quote line that owns the ubp rates\n\t\t\tlineModel: Object\n\t\t};\n\n\t\tthis.listeners = {\n\t\t\t'table-header-sort-clicked': '_onSort',\n\t\t\t'rate-row-rendered': '_resizeIronList',\n\t\t\t'toggle-tooltip': '_toggleTooltip',\n\t\t\t'iron-resize': '_checkThreshold',\n\t\t\t'inline-edit-commit': '_inlineEditCommitted'\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_updateHeaderStateObserver(sortField, sortOrder)',\n\t\t];\n\t}\n\n\t// check for undefined category id, which means there's no data to display\n\t_categoryIdChanged(newVal, oldVal) {\n\t\tif (newVal === undefined && !!oldVal) {\n\t\t\tthis.rateIds = [];\n\t\t\tthis.totalRateCount = 0;\n\t\t\tthis.fields = [];\n\t\t}\n\t\tthis.hasInlineEditChanges = this.inlineEditedCategories && this.inlineEditedCategories.indexOf(this.categoryId) > -1;\n\t}\n\n\t/**\n\t * Toggle rate card tooltip\n\t * @param e\n\t * @private\n\t */\n\t_toggleTooltip(e) {\n\t\tlet tooltip = this.querySelector('.rateCardPreview');\n\t\t// since the tooltip is reused for all rows, we need to reset its content every time\n\t\twhile (tooltip.firstChild) {\n\t\t\ttooltip.removeChild(tooltip.firstChild);\n\t\t}\n\t\tif (e.detail.show) {\n\t\t\ttooltip._target = e.detail.target;\n\t\t\ttooltip.appendChild(e.detail.content);\n\t\t\ttooltip.updatePosition();\n\t\t\ttooltip.show();\n\t\t} else {\n\t\t\ttooltip.hide();\n\t\t}\n\t}\n\n\t_checkThreshold() {\n\t\t// This is in place so that we do not fire UBPDao#loadRates after every trigger from checkThresholds.\n\t\t// We check if there is a new batch of rates which has loaded (_previousRenderLength != rateIds) before\n\t\t// we call clearTriggers and checkScrollThresholds, which will trigger to load more rates.\n\t\t// We also make sure that if we are at the end of the table (this.rateIds.length != this.totalRateCount ),\n\t\t// not to call clearTriggers and checkScrollThresholds\n\t\tif (this.rateIds && this.rateIds.length != this.totalRateCount && this._previousRenderLength !== this.rateIds.length) {\n\t\t\tthis._previousRenderLength = this.rateIds.length;\n\t\t\tthis.$.threshold.clearTriggers();\n\t\t\tthis.$.threshold.checkScrollThresholds();\n\t\t}\n\t}\n\n\t_resizeIronList() {\n\t\tthis.$$('iron-list').fire('iron-resize');\n\t}\n\n\t_rateIdsChanged(rateIds) {\n\t\tconst oldScroll = this.$.ironList._scrollPosition;\n\t\tthis.$.ironList.items = rateIds;\n\t\tthis.$.ironList._resetScrollPosition(oldScroll);\n\t}\n\n\t_getSortLabel(sortField, fields) {\n\t\tif (sortField && fields) {\n\t\t\tlet sourceField = fields.find((target) => target.fieldPath === sortField);\n\t\t\tif (sourceField) {\n\t\t\t\treturn sourceField.label;\n\t\t\t} else if (sortField === `${QuoteContext.constants.UBP_FIELDS.ConsumptionSchedule}.Name`) {\n\t\t\t\treturn localizeContent('Consumption Schedule Name');\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\t/**\n\t * Relay table-header-sort-clicked event to load-rates, so we reload the ubp rate table\n\t * @param e\n\t * @private\n\t */\n\t_onSort({ detail: { lineSortField, order } }) {\n\t\tput(this.categoryId, [ ], { ...get(this.categoryId, [ ]), sortField: lineSortField, sortOrder: order });\n\t\tthis._loadRates(0);\n\t}\n\n\t_getFieldLabels(fields) {\n\t\tlet fieldLabels = {};\n\t\tfor (let field of fields) {\n\t\t\tpathMutate(fieldLabels, field.fieldPath.split('.'), field.label);\n\t\t}\n\t\treturn fieldLabels;\n\t}\n\n\t_getFieldOptions(fields) {\n\t\tlet headerOptions = this._getWidthParameters(this._getFieldsFromMetadata(fields));\n\t\theaderOptions.isSortable = (field) => {\n\t\t\treturn field && UNSORTABLE_FIELDS.every((entry) => entry !== field);\n\t\t};\n\t\treturn headerOptions;\n\t}\n\n\t/**\n\t * Gets width parameters for table cells\n\t * @param fields\n\t * @returns {{}}\n\t * @private\n\t */\n\t_getWidthParameters(fields) {\n\t\treturn {\n\t\t\tcolumnWidths: this._calcColumnWidths(fields),\n\t\t\tcolumnWidthUnit: '%'\n\t\t};\n\t}\n\n\t/**\n\t * Gets field from metadata\n\t * @param metadata\n\t * @returns {{}}\n\t * @private\n\t */\n\t_getFieldsFromMetadata(metadata) {\n\t\treturn metadata.map((metadatum) => metadatum.fieldPath);\n\t}\n\n\t/**\n\t * Calculate column width in percentage, distribute width evenly for each column\n\t * @param fields\n\t * @returns {{}}\n\t * @private\n\t */\n\t_calcColumnWidths(fields) {\n\t\tlet colWidths = {};\n\t\tif (fields.length > 0) {\n\t\t\tfields.forEach((field) => {\n\t\t\t\tcolWidths[field] = Math.floor(100 / fields.length);\n\t\t\t});\n\t\t}\n\t\treturn colWidths;\n\t}\n\n\t/**\n\t * Get row template\n\t * @param metadata\n\t * @return a div node with generated template as innerHTML\n\t * @private\n\t */\n\t_getRowTemplate(metadata) {\n\t\tlet fields = this._getFieldsFromMetadata(metadata);\n\t\tlet options = this._getWidthParameters(fields);\n\t\toptions.attributes = `class$=\"container sf-ubp-table-cell td focusable ubp-rate-row {{computeCellClasses(rateId, '$field', unsavedEdits)}}\"`;\n\t\treturn new TableRowTemplateGenerator(metadata, options).generateRowNode(fields);\n\t}\n\n\t_search() {\n\t\tlet searchtext = !this.userSearchInput ? null : Html.sanitizeHtmlText(this.userSearchInput);\n\t\tput('UBPClientState', ['searchKeyword'], searchtext);\n\t\treturn this._loadRates(0);\n\t}\n\n\t_clear() {\n\t\tthis.set('userSearchInput', '');\n\t\tthis._search();\n\t}\n\n\t_onKeyPress(e) {\n\t\tif (e.keyCode == 13 && !this._shouldDisableSearch(this.userSearchInput)) {\n\t\t\tthis._search();\n\t\t\tthis.$.searchRateInput.blur(); // force input box loose focus\n\t\t}\n\t}\n\n\t_getSearchPlaceholder() {\n\t\treturn localizeContent('Search Consumption Schedule Name');\n\t}\n\n\t_loadMore() {\n\t\tthis._loadRates(this.rateIds ? this.rateIds.length : 0);\n\t}\n\n\t/**\n\t * Function delegates server call to UsageBasedPricingDao#loadRates\n\t * @private\n\t */\n\t_loadRates(offset) {\n\t\tloadRates(offset);\n\t}\n\n\t_updateHeaderStateObserver (sortField, sortOrder) {\n\t\tif (sortField === undefined || sortOrder === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.updateHeaderState(sortField, sortOrder);\n\t}\n\t\n\t/**\n\t * Updates header state to reflect current tab's sort order\n\t * @private\n\t */\n\tupdateHeaderState(sortField, sortOrder) {\n\t\tthis.$.tableHeader.setSort(sortField, sortOrder);\n\t}\n\n\t_noSearchResults(totalRateCount) {\n\t\treturn totalRateCount === 0;\n\t}\n\n\t/**\n\t * Check if search should be disabled\n\t * User search input needs to have at least 2 non-wildcard characters\n\t * Search is disabled if userSearchInput is\n\t * 1. Only one character\n\t * 2. Is a sequence of wildcard characters, ex **??\n\t * 3. is a combination of wildcard characters and one non-wildcard character\n\t * @param userSearchInput\n\t * @return Boolean\n\t * @private\n\t */\n\t_shouldDisableSearch(userSearchInput) {\n\t\treturn !!userSearchInput && !/(.*[^*?)( ]){2,}.*/g.test(userSearchInput);\n\t}\n\n\t_shouldShowSortMessage(sortOrder, totalRateCount) {\n\t\treturn sortOrder !== '' && totalRateCount > 0;\n\t}\n\n\t_shouldShowSearchAppliesMessage(clientCacheSearchInput) {\n\t\treturn !clientCacheSearchInput;\n\t}\n\n\t_getSortMessage(totalRateCount, sortField, fields) {\n\t\treturn localizeContent('Items_Sorted_by', [totalRateCount, this._getSortLabel(sortField, fields)]);\n\t}\n\n\tclearSearch() {\n\t\tthis.userSearchInput = null;\n\t\tput('UBPClientState', ['searchKeyword'], null);\n\t}\n\n\t/**\n\t * Compute cell level dynamic CSS classes, such as dirty or editable\n\t * This function is invoked when rowTemplate is stamped (see TableRowTemplateGenerator#generateRow)\n\t * This is on table level because Polymer templatization invokes the callback on rootHost (table), not host (row),\n\t * even though binding happens on host level\n\t * @param rowIndex\n\t * @param currentField\n\t * @param unsavedEdits\n\t * @return String, cell class\n\t */\n\tcomputeCellClasses(rateId, currentField, unsavedEdits) {\n\t\tlet result = '';\n\t\tif (unsavedEdits && unsavedEdits.hasOwnProperty(currentField)) {\n\t\t\tlet rateRecord = get(rateId, ['record']);\n\t\t\tconst appliedEdits = get(this.appliedChangeKey, ['rates']);\n\t\t\tif (appliedEdits && appliedEdits[rateId]) {\n\t\t\t\trateRecord = overrideRecValues(rateRecord, appliedEdits[rateId], [{fieldPath: currentField}]);\n\t\t\t}\n\t\t\tresult = Util.deepEquals(unsavedEdits[currentField], pathGet(rateRecord, currentField.split('.'))) ? '' : 'dirty ';\n\t\t}\n\t\t// fields are editable only when UBP manual edit is on\n\t\tif (AppContext.isManualEditsForUBPEnabled) {\n\t\t\tresult += QuoteContext.isUbpFieldInlineEditable(currentField, get('ConsumptionRateMetadata', ['rateEditable'])) ? TemplateGenerator.classNames.EDITABLE : '';\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Normalizes the data in the form that is expected by the validator and append any unsaved changes\n\t * @param consumptionSchedules - List of Consumption Schedules\n\t * @param unsavedChanges - Merged changes from inline edit and jsqc, with jsqc overriding inline edit\n\t * @return Normalized Data with all valid unsaved changes\n\t */\n\tnormalizeAndMergeUnsavedChanges(consumptionSchedules, unsavedChanges) {\n\t\tconst returnObject = {};\n\t\tconsumptionSchedules.forEach(cs => {\n\t\t\tconst { Id, consumptionRates } = cs;\n\t\t\treturnObject[Id] = consumptionRates.map((consumptionRate) => {\n\t\t\t\treturn overrideRecValues(consumptionRate, unsavedChanges[consumptionRate.Id], this.fields);\n\t\t\t});\n\t\t});\n\t\treturn returnObject;\n\t}\n\n\t_onUpdate() {\n\t\tthis.fire('calculate-immediately', { callback: this._updateAfterCalculate.bind(this) });\n\t}\n\n\t/**\n\t * Some complicated shit to apply inline changes\n\t * @private\n\t */\n\t_updateAfterCalculate(quote) {\n\t\t// lazy init applied UBP changes\n\t\tif (!get(this.appliedChangeKey)) {\n\t\t\tput(this.appliedChangeKey, [], { rates: {} });\n\t\t}\n\n\t\t// fetch all relevant data:\n\t\t// unsavedUbpChanges - changes resulting from JSQC calculation\n\t\t// inlineEditChanges - changes from manual inline edit\n\t\t// appliedChanges - merged changes from unsavedUbpChanges and inlineEditChanges since last user update\n\t\t// savedScheduleAndRates - original rates from server\n\t\tconst unsavedUbpChanges = this._getUnsavedUbpChanges(quote);\n\t\tconst inlineEditChanges = get('UbpInlineEditChanges', ['rates']) || {};\n\t\tconst appliedChanges = get(this.appliedChangeKey, ['rates']);\n\t\tconst savedScheduleAndRates = this._getSavedSchedulesAndRates();\n\n\t\t// find all rate IDs in this category\n\t\tconst rateIds = [];\n\t\tconst newValues = {};\n\t\tsavedScheduleAndRates.forEach((sch) => {\n\t\t\tsch.consumptionRates.forEach((rate) => {\n\t\t\t\trateIds.push(rate.Id);\n\t\t\t});\n\t\t});\n\t\t// to compute the new applicable changes,\n\t\t// first use existing appliedChanges as the base,\n\t\t// then overlay inlineEditChanges,\n\t\t// finally overlay unsavedUbpChanges\n\t\trateIds.forEach((id) => {\n\t\t\tif (inlineEditChanges[id] || unsavedUbpChanges[id] || appliedChanges[id]) {\n\t\t\t\tconst applied = overrideRecValues(appliedChanges[id] || {}, inlineEditChanges[id], this.fields);\n\t\t\t\tnewValues[id] = overrideRecValues(applied, unsavedUbpChanges[id], this.fields);\n\t\t\t}\n\t\t});\n\n\t\t// now do the validation against newly changed data\n\t\tconst mergedRates = this.normalizeAndMergeUnsavedChanges(savedScheduleAndRates, newValues);\n\t\tconst ubpLabels = get('ubpLabels', ['labels']);\n\t\tconst errors = this._validateRates(mergedRates, ubpLabels);\n\t\tconst success = errors.length === 0;\n\n\t\tif (success) {\n\t\t\t// finally commit the new changes into AppliedUbpChanges\n\t\t\tObject.keys(newValues).forEach((rateId) => {\n\t\t\t\tput(this.appliedChangeKey, ['rates', rateId], newValues[rateId]);\n\t\t\t});\n\t\t\t// invoke _onCancel to clear out the inline edit data now that the changes are applied\n\t\t\tthis._onCancel();\n\t\t} else {\n\t\t\tthis._overrideConflictingInlineEdits(rateIds, unsavedUbpChanges, inlineEditChanges);\n\t\t}\n\t\t// update toast messages\n\t\tput('UBPClientState', ['successMsg'], success ? [ubpLabels.msg_changes_applied] : null);\n\t\tput('UBPClientState', ['errorMsg'], success ? null : [errors[0].errorMsg]);\n\t}\n\n\t/**\n\t * For given set of rate ids, revert inline edit changes that are conflicting with plugin changes,\n\t * then inform the owner row to refresh its UI\n\t * This is invoked when validation has failed and we want to show the effective data sent for validation\n\t * @param rateIds The set of rates to be considered\n\t * @param unsavedUbpChanges Changes from JSQC plugin\n\t * @param inlineEditChanges Changes from inline edit\n\t * @private\n\t */\n\t_overrideConflictingInlineEdits(rateIds, unsavedUbpChanges, inlineEditChanges) {\n\t\t// validation failed, revert inline edit changes conflicting with jsqc (unsavedUbpChanges) W-6896465\n\t\trateIds.forEach((id) => {\n\t\t\tif (unsavedUbpChanges[id] && inlineEditChanges[id]) {\n\t\t\t\tlet needRefresh = false;\n\t\t\t\tObject.keys(unsavedUbpChanges[id]).forEach((field) => {\n\t\t\t\t\tif (field !== 'Id' && field !== 'attributes' && inlineEditChanges[id][field]) {\n\t\t\t\t\t\tdelete inlineEditChanges[id][field];\n\t\t\t\t\t\tneedRefresh = true;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (needRefresh) {\n\t\t\t\t\t// tell rows to refresh themselves\n\t\t\t\t\t// unfortunately there's no easy way to observe property deletion, so we opt for global event\n\t\t\t\t\tfireEvent(Events.UBP_ROW_REFRESH, {id: id});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Retrieve unsaved UBP changes from either the cache, or the calculated quote,\n\t * the latter is needed if a calculation hasn't been done until this point\n\t * @param quote updated quote from calculation\n\t * @returns {{}|*}\n\t * @private\n\t */\n\t_getUnsavedUbpChanges(quote) {\n\t\tlet result = get('UnsavedUbpChanges', ['rates']);\n\t\tif (result) {\n\t\t\t// cached data is available, just return that\n\t\t\treturn result;\n\t\t}\n\t\tif (quote && quote.lineItems) {\n\t\t\tconst lineVO = quote.lineItems.find((l) => {\n\t\t\t\treturn (l.record.Id === this.quoteLineOrProdId || l.record[QuoteContext.constants.PRODUCT] === this.quoteLineOrProdId) && l.key === this.lineKey;\n\t\t\t});\n\t\t\tif (lineVO && lineVO.ubpChanges) {\n\t\t\t\tresult = lineVO.ubpChanges;\n\t\t\t\tput('UnsavedUbpChanges', [], result);\n\t\t\t\treturn result.rates;\n\t\t\t}\n\t\t}\n\t\treturn {};\n\n\t}\n\n\t/**\n\t * Delegate method to validate rates before applying them\n\t * @param rates\n\t * @returns {*}\n\t * @private\n\t */\n\t_validateRates(rates, ubpLabels) {\n\t\treturn ConsumptionRateValidator(rates, QuoteContext.constants, ubpLabels)\n\t}\n\t/**\n\t * Retrieve persisted schedules and rates data from JSQC cache\n\t * @returns {T[]}\n\t * @private\n\t */\n\t_getSavedSchedulesAndRates() {\n\t\t// It's fine not to pass the UbpDAO anything in the constructor, because we're not actually going to use it for anything.\n\t\tconst dao = new window.SB.usageBasedPricingDAO(QuoteContext.constants.prefix, null, null);\n\t\tconst scheduleAndRatesForQuoteLineOrProduct = dao.getFromCache(this.quoteLineOrProdId) || [];\n\t\tconst categoryName = get(this.categoryId, ['name']);\n\t\tconst filteredSchedulesByCategory = scheduleAndRatesForQuoteLineOrProduct.filter((datum) => {\n\t\t\treturn datum[`${QuoteContext.constants.prefix}Category__c`] === categoryName ||\n\t\t\t\tdatum[`${QuoteContext.constants.prefix}Category__c`] === `${QuoteContext.constants.prefix}${categoryName}`;\n\t\t});\n\n\t\t// for multi-currency orgs, only return rates with the same currency as the product/quote line\n\t\tif(AppContext.org.isMultiCurrencyOrg) {\n\t\t\tconst currencyCode = get(this.quoteLineOrProdId, ['record', 'CurrencyIsoCode']);\n\t\t\tfor (let i = 0; i < filteredSchedulesByCategory.length; i++) {\n\t\t\t\tfilteredSchedulesByCategory[i].consumptionRates =\n\t\t\t\t\tfilteredSchedulesByCategory[i].consumptionRates.filter((cr) => cr['CurrencyIsoCode'] === currencyCode);\n\t\t\t}\n\t\t}\n\t\treturn filteredSchedulesByCategory;\n\t}\n\n\t/**\n\t * Cancel all pending inline edit\n\t * @private\n\t */\n\t_onCancel() {\n\t\tif (this.inlineEditedCategories) {\n\t\t\tconst index = this.inlineEditedCategories.indexOf(this.categoryId);\n\t\t\tif (index > -1) {\n\t\t\t\t// delete all inline edit rate changes for this category\n\t\t\t\tconst inlineEditedRates = get('UbpInlineEditChanges', ['rates']);\n\t\t\t\tif (inlineEditedRates) {\n\t\t\t\t\tObject.keys(inlineEditedRates).forEach((rateId) => {\n\t\t\t\t\t\tconst category = get(rateId, ['record', QuoteContext.constants.prefix + 'QuoteLineConsumptionSchedule__r', QuoteContext.constants.prefix + 'Category__c']);\n\t\t\t\t\t\tif (category && (this.quoteLineOrProdId + '_' + category) === this.categoryId) {\n\t\t\t\t\t\t\tdelete inlineEditedRates[rateId];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// delete the category from inline edited changes too\n\t\t\t\tthis.splice('inlineEditedCategories', index, 1);\n\t\t\t\tthis.hasInlineEditChanges = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t_shouldShowManualEditButtons() {\n\t\treturn AppContext.isManualEditsForUBPEnabled && this.hasInlineEditChanges;\n\t}\n\n\t/**\n\t * Add the current categoryId to the array of inlineEditedCategories,\n\t * so we can keep track of which category current contains inline edit\n\t * @private\n\t */\n\t_inlineEditCommitted() {\n\t\tthis.hasInlineEditChanges = true;\n\t\tif (this.inlineEditedCategories.indexOf(this.categoryId) === -1) {\n\t\t\tthis.inlineEditedCategories.push(this.categoryId);\n\t\t}\n\t}\n\n\tgetCellClass() {\n\t\treturn 'sf-ubp-table-cell';\n\t}\n\n\t/**\n\t * Cache key for applied ubp changes\n\t * @returns {string}\n\t */\n\tget appliedChangeKey() {\n\t\treturn `AppliedUbpChanges_${this.quoteLineOrProdId}_${this.lineKey}`;\n\t}\n\n\t/**\n\t * Assign a z-index to each ubp rate row so when edit box is open it doesn't show background text\n\t * @returns Number\n\t */\n\tgetZIndex(idx) {\n\t\treturn this.totalRateCount + 10 - idx;\n\t}\n\n\t/**\n\t * @implements SFAbstractTable._rowHasParentDiv\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_rowHasParentDiv() {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Discards all unapplied changes across all categories (called when going back to quote)\n\t */\n\tdiscardUnappliedChanges() {\n\t\tput('UbpInlineEditChanges', ['categories'], []);\n\t\tput('UbpInlineEditChanges', ['rates'], {});\n\t\tthis.hasInlineEditChanges = false;\n\t}\n}\n\nPolymer( UBPRateTable );\n","import {Page} from 'common/core/Page.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getGroupKey(ctx.params)'\n\t\t\t},\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.smLoadService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t}.bind(this));\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus() {\n\t\tthis.$.af.focusFirstField();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0)\n\t\t\treturn this.navigateToAssetUpgradeRoute();\n\n\t\tthis.onCancel();\n\t}\n\n\tnavigateToAssetUpgradeRoute(){\n\t\tlet queryParams = {\n\t\t\tqId: this.lineEditorModel.quote.record.Id,\n\t\t\tpIds: Object.keys(this.selectedProducts)\n\t\t};\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\n\t\tif(this.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.groupKey;\n\t\treturn this.nav('#', queryParams, ['asset', 'upgrade'], false);\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {qId: this.lineEditorModel.quote.record.Id};\n\t\tif (this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.af.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.af.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetLookupObjects = ['Asset'];\n\t}\n\n\tgetGroupKey() {\n\t\tif (this.ctx.params !== undefined)\n\t\t\treturn this.ctx.params.groupKey;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = formatError(this.errors);\n\t}\n}\n\nPolymer(AssetLookup);","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js'\nimport {Page} from 'common/core/Page.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetUpgrade{\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-upgrade';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tupgrades: Array,\n\t\t\tupgradeSourceMap: Object,\n\t\t\tupgradeTargetMap: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalidationMessages: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tassetHeaderSelectable: { //this property is used in the HTML binding to disable the header checkbox/radio button\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t},  Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_renderUpgradesObserver(upgrades, recordKeys)',\n\t\t\t'getUpgrades(ctx.params.pIds)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.initializeServiceSpinners();\n\t\tthis.initializeProperties();\n\t\tthis.preLoadObjects();\n\t\tthis.handleUpgradeSelected();\n\t\tthis.handleMetaDataResponse(); //metadata response\n\t\tthis.handleAddProductResponse(); //add products response\n\t\tthis.handleLineEditorModelResponse(); //line editor response\n\t\tthis.handleSelectionResponse(); //response with available upgrades\n\t}\n\n\t/**\n\t * W-3583510 (GUS) These properties were storing values set during previous navigation to this route.\n\t * We redefine them here as they should be initialized every time this component is used\n\t */\n\tinitializeProperties() {\n\t\tthis.upgradeSourceMap = {};\n\t\tthis.upgradeTargetMap = {};\n\t}\n\n\tinitializeServiceSpinners() {\n\t\tthis.$.addProducts.background = false;\n\t\tthis.$.smSelectService.background = false;\n\t}\n\n\tonSelect() {\n\t\tlet upgrades = this.getSelectedUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet quoteId = this.lineEditorModel ? this.lineEditorModel.quote.record.Id : this.ctx.params.qId;\n\t\tthis.nav('#', {'qId': quoteId}, ['quote', 'le'], false);\n\t}\n\n\t_renderUpgradesObserver (upgrades, recordKeys) {\n\t\tif (upgrades === undefined || recordKeys === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.renderUpgrades(upgrades, recordKeys);\n\t}\n\t\n\trenderUpgrades() {\n\t\tfor(let upgrade of this.upgrades){\n\t\t\tthis.upgradeSourceMap[upgrade.record.Product2Id] = this.upgradeSourceMap[upgrade.record.Product2Id] || [];\n\t\t\t//build a map with an array of the source upgrades, upgrade selected must be true for all source upgrades when clicking select\n\t\t\tthis.upgradeSourceMap[upgrade.record.Product2Id].push({\n\t\t\t\tupgradeSelected : false,\n\t\t\t\tId: upgrade.record.Id,\n\t\t\t\tname: upgrade.record.Name\n\t\t\t});\n\t\t\t// We need to keep track of the index of an upgrade since you can upgrade more than one asset at a time\n\t\t\tupgrade._transient_ = upgrade._transient_ || {};\n\t\t\tupgrade._transient_.index = this.upgradeSourceMap[upgrade.record.Product2Id].length - 1;\n\n\t\t\t//for each target upgrade we build a map of the source upgrades\n\t\t\tfor(let upgradeTarget of upgrade.availableUpgrades) {\n\t\t\t\tthis.setUpgradeTargetMap(upgrade, upgradeTarget);\n\t\t\t}\n\t\t}\n\t\tthis.upgradeResults = this.upgrades; //this creates the rows\n\t}\n\n\t/**\n\t * Populates the upgradeTargetMap with values of sourceProductId to an array. An array is necessary when a user wants to\n\t * upgrade the same asset more than once.\n\t * @param upgrade\n\t * @param upgradeTarget\n\t */\n\tsetUpgradeTargetMap(upgrade, upgradeTarget) {\n\t\tconst upgradeProduct2Id = upgrade.record.Product2Id;\n\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id] = this.upgradeTargetMap[upgradeTarget.record.Id] || {};\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id] = this.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id] || [];\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id].push({'upgradeSelected' : false});\n\t}\n\n\tgetUpgrades() {\n\t\tif (this.ctx.params.pIds === undefined)\n\t\t\tthis.navigateToLineEditor();\n\t\tthis.$.smSelectService.selectedProducts = this.ctx.params.pIds.split(',');\n\t}\n\n\t//returns data structured for use in the product configurator\n\tgetSelectedProducts() {\n\t\tlet selectedUpgrades = this.getSelectedUpgrades(),\n\t\t\tselectedProducts = {};\n\n\t\tfor(let upgrade of selectedUpgrades || [])\n\t\t\tselectedProducts[upgrade.record.Id] = {\n\t\t\t\trecord: upgrade.record,\n\t\t\t\tupgradedAssetId: upgrade.upgradedAssetId\n\t\t\t};\n\n\t\treturn selectedProducts;\n\t}\n\n\tapplyUpgrades() {\n\t\tlet upgrades = this.$.upgrades.getUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\t//builds up the data expected on the server for getting a new quote based on the upgrade selections\n\tgetSelectedUpgrades() {\n\t\tlet addProductsArray = [],\n\t\t\tvalidationMessages = [];\n\n\t\tfor (let upgrade of this.upgrades) {\n\t\t\tlet idx = upgrade._transient_.index;\n\t\t\tfor (let availableUpgrade of upgrade.availableUpgrades) {\n\t\t\t\tlet upgradeTargetId = availableUpgrade.record.Id,\n\t\t\t\t\tupgradeSourceId = upgrade.record.Product2Id,\n\t\t\t\t\ttargetProduct = this.upgradeTargetMap[upgradeTargetId][upgradeSourceId][idx],\n\t\t\t\t\tsourceProduct = this.upgradeSourceMap[upgradeSourceId][idx];\n\n\t\t\t\tif (sourceProduct.upgradeSelected === true)\n\t\t\t\t\tcontinue; //an upgrade has already been selected for the source product\n\n\t\t\t\tsourceProduct.upgradeSelected = targetProduct.upgradeSelected;\n\t\t\t\tsourceProduct.upgrade = targetProduct.rowData;\n\t\t\t\tsourceProduct.index = idx;\n\t\t\t}\n\t\t}\n\n\t\tfor(let i in this.upgradeSourceMap) {\n\t\t\tfor (let source of this.upgradeSourceMap[i]) {\n\t\t\t\tif (source.upgradeSelected === false) {\n\t\t\t\t\tvalidationMessages.push('You must select an upgrade for ' + source.name);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//array of selected upgrades that gets passed to addProducts on the server\n\t\t\t\taddProductsArray.push({\n\t\t\t\t\trecord: source.upgrade, //record is the selected record\n\t\t\t\t\tupgradedAssetId: source.Id, //upgradedAssetId is the Id of the upgrade record, not product record\n\t\t\t\t\tindex: source.index\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.validationMessages = validationMessages;\n\n\t\tif(validationMessages.length > 0)\n\t\t\treturn;\n\t\treturn addProductsArray;\n\t}\n\n\thandleUpgradeSelected() {\n\t\t//when an upgrade is selected, update the map to be used when clicking the select button\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e); //deselect all upgrades in a group of available upgrades\n\t\t\tconst selected = e.detail.selected,\n\t\t\t\tsourceProductId = e.detail.rowData._transient_.sourceProduct,\n\t\t\t\tupgradeTargetMap = this.upgradeTargetMap[e.detail.rowData.Id][sourceProductId][e.detail.index];\n\t\t\tupgradeTargetMap.upgradeSelected = selected;\n\t\t\tupgradeTargetMap.rowData = selected === true ? e.detail.rowData : undefined;\n\t\t}.bind(this));\n\t}\n\n\t//build the metadata required for the rows to render\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet recordKeys = [],\n\t\t\t\tfieldLabels = [],\n\t\t\t\tfieldLabelMap = {},\n\t\t\t\tmdMap = {},\n\t\t\t\tlabelTypeMap = {},\n\t\t\t\titemTypeMap = {},\n\t\t\t\tfields = e.detail.value.fields;\n\t\t\tfields.forEach(function(field) {\n\t\t\t\tlet key = field.name;\n\t\t\t\trecordKeys.push(key);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t\tfieldLabelMap[key] = field.label;\n\t\t\t\tmdMap[key] = field;\n\t\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\t\titemTypeMap[key] = field.type;\n\t\t\t}.bind(this));\n\t\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap, null, true).build();\n\t\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\t\tthis.mdMap = mdMap;\n\t\t\tthis.recordKeys = recordKeys;\n\t\t\tthis.fieldLabels = fieldLabels;\n\t\t\tthis.fieldLabelMap = fieldLabelMap;\n\t\t}.bind(this));\n\t}\n\n\n\thandleAddProductResponse() {\n\t\tthis.$.addProducts.addEventListener('psm-response-changed', function (e) {\n\t\t\tif(e.detail.value.quote === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.lineEditorModel.quote = e.detail.value.quote;\n\t\t\tif (e.detail.value.configuredProducts !== undefined && e.detail.value.configuredProducts.length > 0)\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\telse\n\t\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\t//when a target asset requires configuration we need to route to the configurator\n\thandleConfigurableProducts(e) {\n\t\tlet response = e.detail.value;\n\t\tlet queryParams = {};\n\t\tlet configProductIds = this.getConfigProductIds(response);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tqueryParams.pId = configProductIds;\n\t\tresponse.selectedProducts = this.getSelectedProducts();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfigProductIds(products) {\n\t\tlet productIds = [];\n\t\tfor (let product of products.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.addProducts.stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\t\tthis.$.addProducts.stripLinesMessage = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tthis.$.addProducts.quote = this.$.smSelectService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectionResponse() {\n\t\tthis.$.smSelectService.useCache = false; //we don't want this service to cache because it will cause the configurator to read the wrong cache data\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\t//if no upgrades are available return to the line editor\n\t\t\tif (e.detail.value[0] === undefined || Array.isArray(e.detail.value[0].availableUpgrades) === false)\n\t\t\t\treturn this.navigateToLineEditor();\n\t\t\tthis.upgrades = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetUpgradeObjects = ['Product2'];\n\t}\n\n\tget fieldPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selected === false || e.detail.selected === undefined)\n\t\t\treturn;\n\t\tlet root = Polymer.dom(e).rootTarget, //this is the current row\n\t\t\trows = Polymer.dom(root.parentElement).querySelectorAll('sb-table-row'); //this collects all the rows\n\n\t\tfor (let row of rows)\n\t\t\tif (row.selectionType === 'radio' && row !== root)\n\t\t\t\trow.selected = false;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = formatError(this.errors);\n\t}\n\n\t// build our own data to pass into table row\n\t// in case of upgrades to the same product so we have a handle of the source product it's upgrading from\n\tbuildRowDataArray(upgrade) {\n\t\tlet availableUpgrades = [];\n\t\tfor (let availableUpgrade of upgrade.availableUpgrades || []) {\n\t\t\tavailableUpgrade.record._transient_ = availableUpgrade.record._transient_ || {};\n\t\t\tObject.assign(availableUpgrade.record._transient_, { sourceProduct: upgrade.record.Product2Id, sourceProductIndex: upgrade._transient_.index});\n\t\t\tavailableUpgrades.push(availableUpgrade);\n\t\t}\n\n\t\treturn availableUpgrades;\n\t}\n}\n\nPolymer(AssetUpgrade);\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function checkboxFactory(value, disabled, hidden, tabIndex) {\n\tlet ff = new FormField('sb-checkbox');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('hide', 1, 'hide', hidden);\n\tff.addAttribute('tab-index', 1, 'tabIndex', tabIndex);\n\n\tff.formattedValue = { value, label: '' };\n\treturn ff;\n}\n","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function datePickerFactory(value, editable, disabled, i18n, renderReadOnly, type, factoryData = {range: false}, environment = PageContainer) {\n\tif(!editable)\n\t\treturn newFormattedDate(value, i18n);\n\n\tif(environment.isMobile())\n\t\treturn newMobileDatePicker(value, editable, disabled, type);\n\tif(factoryData.range === true)\n\t\treturn newDateRangePicker(value, disabled, renderReadOnly);\n\n\treturn newDatePicker(value, disabled, i18n);\n}\n\nfunction newMobileDatePicker(value, editable, disabled, type) {\n\treturn inputFactory(value, editable, disabled, 'dateInput', type);\n}\n\nfunction newDatePicker(value, disabled, i18n) {\n\tlet ff = new FormField('sb-datepicker');\n\tff.addAttribute('selected-date', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-date-esc';\n\tff.readOnlyBlurEvent = 'sb-date-blur';\n\tff.changeEvent = 'selected-date-changed';\n\n\tsetFormattedValue(value, ff, getFormattedValue(value, i18n));\n\treturn ff;\n}\n\nfunction newDateRangePicker(value, disabled, renderReadOnly) {\n\tlet ff = new FormField('sb-daterange');\n\t// Non-product search filters come with default value of null instead of '', so handle that here\n\tif (value === null)\n\t\tvalue = '';\n\n\tlet hasStart = value.start !== undefined;\n\tlet hasEnd = value.end !== undefined;\n\tff.addAttribute('formatted-value', 2, 'value', {\n\t\tstart: hasStart ? value.start : value,\n\t\tend: hasEnd ? value.end : value\n\t});\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('use-mask', 1, 'useMask', !renderReadOnly);\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-date-esc';\n\tff.readOnlyBlurEvent = 'sb-date-blur';\n\tff.changeEvent = 'selected-date-range-changed';\n\n\treturn ff;\n}\n\nfunction newFormattedDate(value, i18n) {\n\tlet formattedValue = getFormattedValue(value, i18n);\n\tlet ff = simpleFieldFactory(formattedValue);\n\tsetFormattedValue(value, ff, formattedValue);\n\treturn ff;\n}\n\nfunction getFormattedValue(value, i18n) {\n\treturn i18n.format(value, { date: true });\n}\n\nfunction setFormattedValue(value, ff, formattedDate) {\n\tff.formattedValue = { value, label: formattedDate };\n}\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {getUnitAndDisplayValue, setDiscountValue, updateUnitIfAmountInactive} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\n\nexport function discountFactory(model, disabled, renderReadOnly, inputType, pattern, numberFormatter, property) {\n\tupdateUnitIfAmountInactive(model, property);\n\tlet { units, unit, displayValue } = getUnitAndDisplayValue(model, property);\n\n\tsetDiscountValue(model, property, displayValue);\n\tconst value = model.lineVO.record[model.constants.ADDITIONAL_DISCOUNT_FIELD];\n\n\tlet ff = new FormField('sb-discount');\n\tff.addAttribute('model', 1, 'model', model);\n\tff.addAttribute('property', 1, 'property', property);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('input-type', 1, 'inputType', inputType);\n\tff.addAttribute('pattern', 1, 'pattern', pattern);\n\tff.addAttribute('formatter', 1, 'formatter', numberFormatter);\n\n\tff.readOnlyBlurEvent = 'sb-discount-blur';\n\tff.changeEvent = 'sb-discount-change';\n\tff.readOnlyKeyDownEvent = 'sb-discount-keydown';\n\n\tlet label = numberFormatter.format(displayValue);\n\tlet discountUnit = getDiscountUnit(units, unit, value);\n\tunit = label != null && label !== '' ? discountUnit.label : ''; // no unit if label is nil\n\tff.formattedValue = { value, label, unit, unitValue: discountUnit.value};\n\n\tff.addAttribute('display-value', 1, 'displayValue', label);\n\tff.addAttribute('original', 1, 'original', ff.formattedValue);\n\treturn ff;\n}\n\nfunction getDiscountUnit(units, unit, value) {\n\tif(!units || isNil(value))\n\t\treturn {label: '', value: ''};\n\n\tfor(let u of units) {\n\t\tif(u.value === unit)\n\t\t\treturn {label: u.label, value: u.value};\n\t}\n}\n\nfunction isNil(value) {\n\treturn value === undefined || value === null || value === '' || isNaN(value);\n}\n","import {checkboxFactory} from 'common/forms/sb-checkbox/factory/CheckboxFactory.js';\nimport {datePickerFactory} from 'common/forms/sb-datepicker/factory/DatePickerFactory.js';\nimport {numericFieldFactory} from 'common/forms/sb-field/factory/NumericFieldFactory.js';\nimport {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {lookupFactory} from 'common/forms/sb-lookup/factory/LookupFactory.js';\nimport {selectFactory} from 'common/forms/sb-select/factory/SelectFactory.js';\nimport {textFieldFactory} from 'common/forms/sb-field/factory/TextFieldFactory.js';\n\nexport function fieldFactory(type, model, value, editable, disabled, hidden, index, metadata, i18n, renderReadOnly, selectOptions, referenceDetails, tabIndex, factoryData) {\n\tswitch(type) {\n\t\tcase 'boolean':\n\t\tcase 'checkbox':\n\t\t\treturn checkboxFactory(value, disabled, hidden, tabIndex);\n\t\tcase 'date':\n\t\tcase 'datetime':\n\t\t\treturn datePickerFactory(value, editable, disabled, i18n, renderReadOnly, type, factoryData);\n\t\tcase 'discount':\n\t\tcase 'double':\n\t\tcase 'number':\n\t\tcase 'currency':\n\t\tcase 'percent':\n\t\t\treturn numericFieldFactory(model, value, editable, disabled, metadata, i18n, renderReadOnly,\n\t\t\t\tindex == 0 ? 'first numberInput' : 'numberInput', type); // keep double equals to allow coercion if index is a string\n\t\tcase 'id':\n\t\tcase 'reference':\n\t\t\treturn lookupFactory(value, editable, disabled, metadata, referenceDetails, renderReadOnly);\n\t\tcase 'picklist':\n\t\tcase 'multipicklist':\n\t\t\treturn selectFactory(value, editable, disabled, type, metadata, i18n, !renderReadOnly, selectOptions);\n\t\tcase 'string':\n\t\tcase 'textarea':\n\t\tcase 'phone':\n\t\tcase 'url':\n\t\tcase 'email':\n\t\t\treturn textFieldFactory(value, editable, disabled, metadata, renderReadOnly, type);\n\t\tcase 'time':\n\t\t\treturn textFieldFactory(i18n.formatTime(value), editable, disabled, metadata, renderReadOnly, type);\n\t\tdefault:\n\t\t\treturn simpleFieldFactory(value);\n\t}\n}\n","let FRONT_BINDING = { 0: '', 1: '[[', 2: '{{' };\nlet BACK_BINDING = { 0: '', 1: ']]', 2: '}}' };\n\nexport class FormField {\n\n\tconstructor(name) {\n\t\tthis.name = name;\n\t\tthis.attributes = [];\n\t\tthis.events = [];\n\t}\n\n\taddAttribute(name, binding, variable, value, equals) {\n\t\tthis.attributes.push( { name: name, binding: binding, variable: variable, value: value, equals: equals || '=' } );\n\t}\n\n\taddEvent(event, variable, handler) {\n\t\tthis.events.push( { event: event, variable: variable, handler: handler } );\n\t}\n\n\tsetInnerText(variable, binding, value) {\n\t\tthis.innerText =  { variable: variable, binding: binding, value: value };\n\t}\n\n\tget formattedValue() {\n\t\treturn this._formattedValue;\n\t}\n\n\tset formattedValue(formattedValue) {\n\t\tthis._formattedValue = formattedValue != null && Object.keys(formattedValue).indexOf('label') !== -1 ? formattedValue : { value: formattedValue, label: formattedValue };\n\t}\n\n\tget defaultValue() {\n\t\treturn this._defaultValue;\n\t}\n\n\tset defaultValue(defaultValue) {\n\t\tthis._defaultValue = defaultValue;\n\t}\n\n\tget readOnlyKeyEvent() {\n\t\treturn this._readOnlyKeyEvent || 'keyup';\n\t}\n\n\tset readOnlyKeyEvent(readOnlyKeyEvent) {\n\t\tthis._readOnlyKeyEvent = readOnlyKeyEvent;\n\t}\n\n\tget readOnlyKeyDownEvent() {\n\t\treturn this._readOnlyKeyDownEvent || 'keydown';\n\t}\n\n\tset readOnlyKeyDownEvent(readOnlyKeyDownEvent) {\n\t\tthis._readOnlyKeyDownEvent = readOnlyKeyDownEvent;\n\t}\n\n\tget readOnlyBlurEvent() {\n\t\treturn this._readOnlyBlurEvent || 'blur';\n\t}\n\n\tset readOnlyBlurEvent(readOnlyBlurEvent) {\n\t\tthis._readOnlyBlurEvent = readOnlyBlurEvent;\n\t}\n\n\tget changeEvent() {\n\t\treturn this._changeEvent || 'change';\n\t}\n\n\tset changeEvent(changeEvent) {\n\t\tthis._changeEvent = changeEvent;\n\t}\n\n\tget numeric() {\n\t\treturn !!(this._numeric);\n\t}\n\n\tset numeric(numeric) {\n\t\tthis._numeric = numeric;\n\t}\n\n\tget html() {\n\t\treturn this._html;\n\t}\n\n\tattachTo(template, readOnlyKeyHandler, readOnlyKeyDownHandler, readOnlyBlurHandler, changeHandler, hiddenField, focusOnAttached) {\n\t\tthis._html = `<${this.name}`;\n\n\t\t// add attributes\n\t\tthis.attributes.forEach((attribute) => {\n\t\t\tthis._html += ` ${attribute.name}${attribute.equals}\"${FRONT_BINDING[attribute.binding]}${attribute.variable}${BACK_BINDING[attribute.binding]}\"`;\n\t\t\ttemplate[attribute.variable] = attribute.value;\n\t\t});\n\n\t\t// add events\n\t\tthis.events.forEach((event) => {\n\t\t\tthis._html += ` on-${event.event}=\"${event.variable}\"`;\n\t\t\ttemplate[event.variable] = event.handler;\n\t\t});\n\n\t\t// add specific event handlers if provided\n\t\tif(readOnlyKeyHandler)\n\t\t\tthis._html += ` on-${this.readOnlyKeyEvent}=\"${readOnlyKeyHandler}\"`;\n\n\t\tif(readOnlyKeyDownHandler)\n\t\t\tthis._html += ` on-${this.readOnlyKeyDownEvent}=\"${readOnlyKeyDownHandler}\"`;\n\n\t\tif(readOnlyBlurHandler)\n\t\t\tthis._html += ` on-${this.readOnlyBlurEvent}=\"${readOnlyBlurHandler}\"`;\n\n\t\tif(changeHandler)\n\t\t\tthis._html += ` on-${this.changeEvent}=\"${changeHandler}\"`;\n\n\t\t// add other miscellaneous properties if provided\n\t\tif(hiddenField)\n\t\t\tthis._html += ` hidden$=\"[[${hiddenField}]]\"`;\n\n\t\tif(focusOnAttached)\n\t\t\tthis._html += ' focus-on-attached=\"true\"';\n\n\t\t// place holder for apply focus\n\t\tthis._html += ' apply-focus=\"[[applyFocus]]\"';\n\n\t\tthis._html += `>`;\n\n\t\tif(this.innerText) {\n\t\t\tthis._html  += `${FRONT_BINDING[this.innerText.binding]}${this.innerText.variable}${BACK_BINDING[this.innerText.binding]}`;\n\t\t\ttemplate[this.innerText.variable] = this.innerText.value;\n\t\t}\n\n\t\tthis._html += `</${this.name}>`;\n\t}\n}","import {discountFactory} from 'common/forms/sb-discount/factory/DiscountFactory.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport function numericFieldFactory(model, value, editable, disabled, metadata, i18n, renderReadOnly, inputClass, type, environment = PageContainer) {\n\tconst inputType = environment.isMobile() && !Locale.isCommaDecimal() ? 'number' : 'text';\n\tconst numberFormatter = new NumberFormatter(editable, metadata, i18n, type, environment.getViewport());\n\n\tif(model && (model.constants.ADDITIONAL_DISCOUNT_FIELD === metadata.name || model.constants.MARKUP_FIELD === metadata.name)) {\n\t\tlet ff = discountFactory(model, disabled, renderReadOnly, inputType, null, numberFormatter, metadata.name);\n\t\tff.numeric = true;\n\t\treturn ff;\n\t}\n\n\tlet formattedValueWithUnits = numberFormatter.format(value, true);\n\tlet formattedValue = !editable ? formattedValueWithUnits : numberFormatter.format(value, false);\n\tlet ff = inputFactory(formattedValue, editable, disabled, inputClass, inputType, renderReadOnly);\n\tff.formattedValue = { value, label: formattedValueWithUnits };\n\tff.numeric = true;\n\treturn ff;\n}\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function simpleFieldFactory(value, fieldClass) {\n\tlet ff = new FormField('sb-div');\n\tff.addAttribute('value', 1, 'value', value);\n\tif(fieldClass)\n\t\tff.addAttribute('class', 1, 'fieldClass', fieldClass, '$=');\n\n\treturn ff;\n}\n","import {textareaFactory} from 'common/forms/sb-textarea/factory/TextareaFactory.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {richTextEditorFactory} from 'common/forms/sb-rte/factory/RichTextEditorFactory.js';\nimport {Util} from 'common/Util.js';\n\nexport function textFieldFactory(value, editable, disabled, metadata, renderReadOnly, type) {\n\tif (metadata.extraTypeInfo === 'richtextarea')\n\t\treturn richTextEditorFactory(value, editable, renderReadOnly, metadata);\n\n\tvar ff;\n\tif(metadata.maxLength > 255 || metadata.format === 'multiline' || type === 'textarea')\n\t\tff = textareaFactory(value, editable, disabled, renderReadOnly);\n\telse\n\t\tff = inputFactory(value, editable, disabled, 'textInput', 'text', renderReadOnly);\n\n\tff.formattedValue = Util.toHTML(value);\n\n\treturn ff;\n}","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function inputFactory(value, editable, disabled, inputClass, inputType, renderReadOnly, pattern) {\n\tif(editable)\n\t\treturn newInput(value, disabled, inputClass, inputType || 'text', renderReadOnly, pattern);\n\n\treturn simpleFieldFactory(value);\n}\n\nfunction newInput(value, disabled, inputClass, inputType, renderReadOnly, pattern) {\n\tlet ff = new FormField('sb-input');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('input-class', 1, 'inputClass', inputClass);\n\tff.addAttribute('input-type', 1, 'inputType', inputType);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('pattern', 1, 'pattern', pattern);\n\n\tff.readOnlyKeyEvent = 'sb-input-key';\n\treturn ff;\n}\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport function lookupFactory(value, editable, disabled, metadata, referenceDetails, renderReadOnly) {\n\tif(!editable)\n\t\treturn newReferenceLink(value, metadata, referenceDetails);\n\n\treturn newLookup(value, disabled, metadata, referenceDetails, renderReadOnly);\n}\n\nfunction newLookup(value, disabled, metadata, referenceDetails, renderReadOnly) {\n\tlet ff = new FormField('sb-lookup');\n\tlet label =  getLabel(false, value, metadata, referenceDetails);\n\tff.formattedValue = { value, label };\n\n\tff.addAttribute('id', 0, 'lookup');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('label', 1, referenceDetails.refDisplayName, ff.formattedValue.label);\n\tff.addAttribute('label-name', 1, 'labelName', referenceDetails.refDisplayName);\n\tff.addAttribute('table-name', 1, 'refTable', referenceDetails.refTable);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('field-full-name', 1, 'fieldFullName', metadata.tableName + '.' + metadata.name);\n\tff.addAttribute('field-label', 1, 'fieldLabel', metadata.label);\n\tff.addAttribute('revert-on-escape', 1, 'revertOnEscape', renderReadOnly);\n\tff.addAttribute('calculate-list-position', 1, 'calculateListPosition', false);\n\tff.addAttribute('has-filter', 1, 'hasFilter', !!(metadata.filteredLookupInfo));\n\tff.addAttribute('record', 1, 'record', referenceDetails.record);\n\tif (metadata.filteredLookupInfo && metadata.filteredLookupInfo.controllingFields) {\n\t\tff.addAttribute('controlling-fields', 1, 'controllingFields', metadata.filteredLookupInfo.controllingFields);\n\t}\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-type-esc';\n\tff.readOnlyBlurEvent = 'sb-type-blur';\n\tff.changeEvent = 'lookup-value-changed';\n\n\treturn ff;\n}\n\nfunction newReferenceLink(value, metadata, referenceDetails) {\n\tlet ff = new FormField('span');\n\tlet label = getLabel(true, value, metadata, referenceDetails);\n\tff.addAttribute('value', 2, '_value_', value); // _value_ not a typo, so please leave it\n\tff.addAttribute('class', 1, 'link', 'link', '$=');\n\tff.setInnerText(referenceDetails.refDisplayName, 1, label);\n\tff.formattedValue = { value, label };\n\n\tff.addEvent('tap', 'refClick', function(e) {\n\t\twindow.open(window.location.origin + '/' + e.target.value);\n\t});\n\treturn ff;\n}\n\nfunction extractRefDisplay(metadata, referenceDetails) {\n\tlet property = referenceDetails.property;\n\tlet obj = referenceDetails.obj;\n\tlet refObjects = referenceDetails.refObjects;\n\n\tlet fieldName = property.Name ? property.Name : metadata.name;\n\tif(!fieldName)\n\t\treturn;\n\n\tlet pos = fieldName.lastIndexOf('Id');\n\tlet refObj = pos >= 0 ? fieldName.substring(0, pos) : (fieldName.lastIndexOf('__c') >= 0 ? fieldName.replace('__c', '__r') : null);\n\n\tlet refType = obj[refObj] ? obj[refObj].attributes.type : null;\n\n\tif (refObj && obj[refObj] && refObjects && refType && refObjects[refType]) {\n\t\tlet nameProp = refObjects[refType].nameField.fieldName;\n\t\tif (obj[refObj][nameProp])\n\t\t\treturn obj[refObj][nameProp];\n\n\t\treturn obj[refObj].Id;\n\t}\n}\n\nfunction getLabel(extractReferenceDisplay, value, metadata, referenceDetails) {\n\tlet label = referenceDetails[referenceDetails.refDisplayName];\n\tif(label) return label;\n\n\tif(extractReferenceDisplay)\n\t\tlabel = extractRefDisplay(metadata, referenceDetails);\n\n\t// attempt to retrieve label from a non-standard name field registered in LookupNameMapper, such as Contract -> ContractNumber\n\tif (!label && referenceDetails.refTable && metadata.relationshipName && referenceDetails.record) {\n\t\tlet nameField = new LookupNameMapper(referenceDetails.refTable).getNameField();\n\t\tlet relationshipRec = referenceDetails.record[metadata.relationshipName];\n\t\tif (relationshipRec) {\n\t\t\tlabel = relationshipRec[nameField];\n\t\t}\n\t}\n\treturn label || value || '';\n}\n","const NAME_MAP = {\n\tContract: 'ContractNumber',\n\tCase: 'CaseNumber'\n};\n\nexport class LookupNameMapper {\n\n\tconstructor(tableName) {\n\t\tthis.tableName = tableName;\n\t}\n\n\tgetNameField() {\n\t\treturn NAME_MAP[this.tableName] || 'Name';\n\t}\n}","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js'\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {DateParser} from 'common/forms/DateParser.js';\n\nexport class LookupQueryBuilder {\n\n\tconstructor(tableName, searchField, hasFilter, lookupFieldFullName, resultsLimit, currentRecordFields, currentRecord, applyMruOptimization, fields) {\n\t\tthis.tableName = tableName;\n\t\tthis.searchField = searchField;\n\t\tthis.hasFilter = hasFilter;\n\t\tthis.lookupFieldFullName = lookupFieldFullName;\n\t\tthis.resultsLimit = resultsLimit;\n\t\tthis.currentRecordFields = currentRecordFields;\n\t\tthis.currentRecord = currentRecord;\n\t\tthis.applyMruOptimization = applyMruOptimization;\n\t\tthis.fields = fields;\n\t\tthis.fieldTypeByName = fields && fields.fieldTypeObjByName ? fields.fieldTypeObjByName : null;\n\t\tthis.numberParser = new NumberParser();\n\t\tthis.dateParser = new DateParser(true);\n\t}\n\n\tbuild(searchValue = '', selectAllFields = false, searchAdditionalFields = false) {\n\t\tlet searchCriteria = '%';\n\t\tlet noWildcardSearchValue = '';\n\n\t\tif(searchValue != null && searchValue !== '') {\n\t\t\tsearchCriteria = searchValue.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/'/g, \"\\\\'\").replace(/%/g, '\\\\%').replace(/[*]+/g, '%');\n\t\t\tnoWildcardSearchValue = searchValue.replace(/\\*/g, '');\n\t\t\tif(!searchCriteria.endsWith('%')) {\n\t\t\t\tsearchCriteria += '%';\n\t\t\t}\n\t\t}\n\n\t\tlet scope = this.getScope(noWildcardSearchValue);\n\t\tlet scopeClause = '';\n\n\t\tif(this.hasFilter) {\n\t\t\tscopeClause = ` USING SCOPE ${scope}, LOOKUP ${this.lookupFieldFullName}`;\n\t\t}\n\t\telse if(scope === 'mru') {\n\t\t\tscopeClause = ' USING SCOPE mru';\n\t\t}\n\n\t\tlet selectClause = this.getSelectClause(selectAllFields);\n\t\tlet whereClause = this.getWhereClause(searchCriteria, searchValue, searchAdditionalFields);\n\t\tlet orderByClause = scope === 'mru' ? 'ORDER BY LastViewedDate DESC' : `ORDER BY ${this.searchField}`;\n\t\tlet query = `${selectClause} FROM ${this.tableName}${scopeClause} WHERE ${whereClause} ${orderByClause} LIMIT ${this.resultsLimit}`;\n\n\t\t// if has filter, has current record fields, and has a current record then lets add the bind clause to the query\n\t\tif(this.hasFilter && this.currentRecordFields && Object.keys(this.currentRecordFields).length > 0 && this.currentRecord) {\n\t\t\tlet index = 0;\n\t\t\tfor(let currentRecordField in this.currentRecordFields) {\n\t\t\t\tlet value = typeof this.currentRecord.getValue === 'function' ? this.currentRecord.getValue(currentRecordField) : this.currentRecord[currentRecordField];\n\t\t\t\tlet type = this.currentRecordFields[currentRecordField];\n\t\t\t\tif(this.omitField(value, type)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(index === 0) {\n\t\t\t\t\tquery += ' BIND ';\n\t\t\t\t}\n\t\t\t\tif(index++ > 0) {\n\t\t\t\t\tquery += ', ';\n\t\t\t\t}\n\t\t\t\tquery += `${currentRecordField} = ${this.getBindValue(value, type)}`;\n\t\t\t}\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tgetScope(searchValue) {\n\t\tif(!this.applyMruOptimization) {\n\t\t\treturn 'everything';\n\t\t}\n\n\t\tlet searchValueLength = searchValue == null ? 0 : searchValue.length;\n\t\tif(searchValueLength > 2) {\n\t\t\treturn 'everything';\n\t\t}\n\n\t\tlet lang = AppContext.user.lang;\n\t\t// if searchValue is at least one character and user's language is Chinese, Japanese, Korean or Thai then scope is everything\n\t\t// why?...see description for 'q' parameter at https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/resources_search_suggest_records.htm\n\t\t// see language codes at https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_translations.htm\n\t\tif(searchValueLength > 0 && (lang === 'zh_CN' || lang === 'zh_TW' || lang === 'ja' || lang === 'ko' || lang === 'th')) {\n\t\t\treturn 'everything';\n\t\t}\n\n\t\treturn 'mru';\n\t}\n\n\tomitField(value, type) {\n\t\treturn value == null && (this.isNumericType(type) || this.isLookupType(type) || this.isDateType(type));\n\t}\n\n\tgetBindValue(value, type) {\n\t\tif(value == null) {\n\t\t\treturn \"''\";\n\t\t}\n\n\t\tif(value === true || value === false) {\n\t\t\treturn value;\n\t\t}\n\n\t\tif(this.isNumericType(type) || this.isDateType(type)) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn `'${value}'`;\n\t}\n\n\tisNumericType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\tcase 'int':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisLookupType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'id':\n\t\t\tcase 'reference':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisDateType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetSelectClause(selectAllFields) {\n\t\tlet fields = selectAllFields && this.fields && this.fields.fieldNames ? LookupQueryBuilder._buildFields(this.fields) : [this.searchField];\n\t\t// remove Id and empty fields so that we don't end up with malformed query (W-6288459)\n\t\tfields = fields.filter((f) => f !== 'Id' && f !== '');\n\t\treturn `SELECT Id, ${fields.join(',')}`;\n\t}\n\n\tgetWhereClause(searchCriteria, searchValue, searchAdditionalFields) {\n\t\tlet whereConditions = [`${this.searchField} LIKE '${searchCriteria}'`];\n\n\t\t// if we are not searching against additional fields or we do not have the field types,\n\t\t// then we are done and just return the search field condition\n\t\tif(!searchAdditionalFields || !this.fields || !this.fields.additionalSearchFields || !this.fieldTypeByName) {\n\t\t\treturn whereConditions[0];\n\t\t}\n\n\t\tlet dateSearchValue = undefined, numberSearchValue = undefined;\n\t\tlet additionalSearchFields = LookupQueryBuilder._buildFields(this.fields, 'additionalSearchFields');\n\t\tfor(let field of additionalSearchFields) {\n\t\t\tlet type = this.fieldTypeByName[field];\n\t\t\tif(type != null && type.type != null){\n\t\t\t\ttype = type.type;\n\t\t\t}\n\n\t\t\t// nobody is going to search via a reference ID, so skip lookup fields\n\t\t\tif(this.isLookupType(type)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if a date type then do a greater then or equal to the date\n\t\t\tif(this.isDateType(type)) {\n\t\t\t\tif(searchValue == null || searchValue === \"\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif(dateSearchValue === undefined) {\n\t\t\t\t\tdateSearchValue = this.dateParser.parse(searchValue);\n\t\t\t\t}\n\n\t\t\t\tif(dateSearchValue == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet dateStr = dateSearchValue.toISOString().split('T')[0];\n\t\t\t\tif(type === 'datetime') {\n\t\t\t\t\tdateStr += 'T00:00:00.000+0000';\n\t\t\t\t}\n\n\t\t\t\twhereConditions.push(`${field} >= ${dateStr}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(this.isNumericType(type)) {\n\t\t\t\tif(searchValue == null || searchValue === \"\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif(numberSearchValue === undefined) {\n\t\t\t\t\tnumberSearchValue = this.numberParser.parse(searchValue, true);\n\t\t\t\t}\n\n\t\t\t\tif(isNaN(numberSearchValue)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet number = numberSearchValue;\n\t\t\t\tif(type === 'int') {\n\t\t\t\t\tnumber = parseInt(number);\n\t\t\t\t}\n\n\t\t\t\twhereConditions.push(`${field} >= ${number}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// for non number, non date, & non lookup types, simply do a LIKE against the search criteria\n\t\t\twhereConditions.push(`${field} LIKE '${searchCriteria}'`);\n\t\t}\n\n\t\t// join the where conditions with a logical OR to create the where clause\n\t\treturn whereConditions.join(' OR ');\n\t}\n\n\tstatic _buildFields(fields, fieldKey = 'fieldNames') {\n\t\tlet fieldNames = [].concat(fields[fieldKey]);\n\n\t\tlet relationships = [];\n\t\tfor(let lookupField of fields.fieldsOfTypeLookup) {\n\t\t\tif(fieldNames.indexOf(lookupField.name) !== -1) {\n\t\t\t\trelationships.push(RelationshipFieldManager.getRelationshipField(lookupField.name, lookupField.table));\n\t\t\t}\n\t\t}\n\t\tif(relationships.length > 0) {\n\t\t\tfieldNames = fieldNames.concat(relationships);\n\t\t}\n\n\t\treturn fieldNames;\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\n\nconst FONTS = \"//fonts.googleapis.com/css?family=Dosis|Droid+Sans|Droid+Serif|Merriweather|Montserrat|Open+Sans|Play|PT+Sans|PT+Serif|Roboto:300,400|Titillium+Web|Ubuntu\";\n\n// Quill Imports\nconst DELTA = Quill.import('delta');\nconst sizeStyle = Quill.import('attributors/style/size');\nconst fontStyle = Quill.import('attributors/style/font');\nconst alignStyle = Quill.import('attributors/style/align');\nconst directionStyle = Quill.import('attributors/style/direction');\nconst Inline = Quill.import('blots/inline');\nconst Parchment = Quill.import('parchment');\nconst BlockEmbed = Quill.import('blots/block/embed');\nconst Block = Quill.import('blots/block');\n\n// instead of wrapping <p> tag around each new line, wrap it with <div> tag\n// fix for W-5627628, see https://github.com/quilljs/quill/issues/861#issuecomment-239961806\nBlock.tagName = 'DIV';\n\n// Custom Quill Modules, Themes, and/or Formats\nsizeStyle.whitelist = ['11px', '13px', '16px', '19px', '24px', '32px', '48px'];\nfontStyle.whitelist = [\n\t'arial', 'courier', 'dosis', 'droid sans', 'droid serif', 'helvetica', 'montserrat', 'noto sans jp',\n\t'noto sans kr', 'noto sans sc', 'noto sans tc', 'open sans', 'play', 'pt sans', 'pt serif', 'roboto',\n\t'roboto light', 'times', 'titillium web', 'ubuntu'\n];\n\nclass SFDCTags extends Inline {}\nSFDCTags.blotName = 'SFDCTags';\nSFDCTags.tagName = ['address', 'big', 'br', 'blockquote', 'caption', 'col', 'colgroup', 'del', 'dfn', 'hr', 'ins', 'kbd', 'q', 'samp', 'small', 'strike', 'tfoot', 'tt', 'var', 'p'];\n\nclass Divider extends BlockEmbed { }\nDivider.blotName = 'divider';\nDivider.tagName = 'hr';\n\nclass HeaderLowercase extends Inline {}\nHeaderLowercase.blotName = 'HeaderLowercase';\nHeaderLowercase.tagName = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\nclass DescriptionList extends BlockEmbed {\n\tstatic create(value) {\n\t\treturn value;\n\t}\n\n\tstatic value(node) {\n\t\tvar value = '';\n\t\tif(node.tagName === 'DL') {\n\t\t\tvalue = node;\n\t\t}\n\t\treturn value;\n\t}\n}\nDescriptionList.blotName = 'DefinitionTag';\nDescriptionList.tagName = ['dl', 'dt', 'dd'];\n\nclass Abbr extends Inline {\n\tstatic create(value) {\n\t\tconst node = super.create();\n\t\tif (typeof value === 'string') {\n\t\t\tnode.setAttribute('title', value);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tstatic formats(node) {\n\t\tconst title = node.getAttribute('title');\n\t\tif (title) {\n\t\t\treturn title;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\n\t}\n\n}\nAbbr.blotName = 'abbr';\nAbbr.tagName = ['ABBR', 'acronym'];\n\nclass Bdo extends Inline {\n\tstatic create(value) {\n\t\tlet node = super.create();\n\t\tnode.setAttribute('dir', value);\n\t\treturn node;\n\t}\n\n\tstatic formats(node) {\n\t\treturn node.getAttribute('dir');\n\t}\n\n}\nBdo.blotName = 'bdo';\nBdo.tagName = 'BDO';\n/** Will Remove when Table is Implemented for Quill\n * https://github.com/quilljs/quill/issues/117  v1.3 */\nclass Table extends BlockEmbed {\n\tstatic create(value) {\n\t\tconst [rows, caption, colgroup] = value;\n\t\tlet node = super.create(value);\n\t\tlet tbody = document.createElement('TBODY');\n\t\trows.forEach(row => {\n\t\t\tvar tr = document.createElement('TR');\n\t\t\ttbody.appendChild(tr);\n\t\t\trow.forEach(cell => {\n\t\t\t\tlet td = document.createElement('TD');\n\t\t\t\tif(td.colSpan) {\n\t\t\t\t\ttd.setAttribute('colspan', td.colSpan);\n\t\t\t\t}\n\t\t\t\tif(td.rowSpan) {\n\t\t\t\t\ttd.setAttribute('rowspan', td.rowSpan);\n\t\t\t\t}\n\t\t\t\ttd.innerHTML = cell;\n\t\t\t\ttr.appendChild(td);\n\t\t\t})\n\t\t});\n\t\tif (caption) {\n\t\t\tnode.appendChild(caption);\n\t\t}\n\t\tif (colgroup) {\n\t\t\tnode.appendChild(colgroup);\n\t\t}\n\t\tnode.appendChild(tbody);\n\t\treturn node;\n\t}\n\n\tstatic value(node) {\n\t\tvar ret = [];\n\t\tvar caption;\n\t\tvar colgroup;\n\t\tif (node.tagName === 'TABLE') {\n\t\t\tcaption = node.caption ? node.caption : '';\n\t\t\tcolgroup = node.querySelector('colgroup') ? node.querySelector('colgroup') : '';\n\t\t\tlet rows = node.rows;\n\t\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\t\tret[i] = [];\n\t\t\t\tfor (let j = 0; j < rows[i].cells.length; j++) {\n\t\t\t\t\tret[i].push(rows[i].cells[j].innerHTML);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn [ret, caption, colgroup];\n\t}\n\n\n\toffset(parent) {\n\t\treturn( parent.domNode.innerText.length - this.domNode.innerText.length);\n\t}\n\n\tdeleteAt(index, length) {\n\t\tsuper.deleteAt(index, length);\n\t}\n\n\tindex(node, offset) {}\n}\nTable.blotName = 'table';\nTable.className = 'table';\nTable.tagName = 'TABLE';\n\nclass AnchorBlot extends Inline {\n\tstatic create(value) {\n\t\tlet node = super.create();\n\t\tnode.setAttribute('href', value.href);\n\t\tif(value.title) {\n\t\t\tnode.setAttribute('title', value.title);\n\t\t}\n\n\t\tif(value.target) {\n\t\t\tnode.setAttribute('target', value.target);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tstatic formats(node) {\n\t\treturn {href: node.href,\n\t\t\t\ttitle: node.title,\n\t\t\t\ttarget: node.target,\n\t\t\t\tinnerHTML: node.innerHTML};\n\t}\n\n}\nAnchorBlot.blotName = 'AnchorBlot';\nAnchorBlot.tagName = 'a';\n\nclass CiteBlot extends Inline {\n\tstatic create(value) {\n\t\tlet node = super.create(value);\n\t\treturn node;\n\t}\n\n\tstatic formats(node) {\n\t\treturn node.innerHTML;\n\t}\n\n}\nCiteBlot.blotName = 'CiteBlot';\nCiteBlot.tagName = 'cite';\n\nclass IndentAttributor extends Parchment.Attributor.Style {\n\tadd (node, value) {\n\t\tif (value === 0) {\n\t\t\tthis.remove(node);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn super.add(node, `${value}em`);\n\t\t}\n\t}\n}\nconst indentStyle = new IndentAttributor('indent', 'margin-left', {\n\tscope: Parchment.Scope.BLOCK,\n\twhitelist: ['1em', '2em', '3em', '4em', '5em', '6em', '7em', '8em', '9em']\n});\n\nconst TextDecorationStyle = new Parchment.Attributor.Style('text-decoration', 'text-decoration', {\n\tscope: Parchment.Scope.BLOCK,\n\twhitelist: ['underscore', 'line-through']\n});\n\n// Register the Module, Themes, and/or Formats\nQuill.register('formats/text-decoration', TextDecorationStyle, true);\nQuill.register(sizeStyle, true);\nQuill.register(fontStyle, true);\nQuill.register(alignStyle, true);\nQuill.register(directionStyle, true);\nQuill.register(indentStyle, true);\nQuill.register(Block, true);\nQuill.register(SFDCTags, true);\nQuill.register(Divider, true);\nQuill.register(HeaderLowercase, true);\nQuill.register(DescriptionList, true);\nQuill.register(Abbr, true);\nQuill.register(Bdo, true);\nQuill.register(Table, true);\nQuill.register(AnchorBlot, true);\nQuill.register(CiteBlot, true);\n\nexport class RichTextEditorDialog {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-rte-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver:  '_valueChanged',\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ttooltipTextMap: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\timageDialogOpened: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcurrentSelection: {\n\t\t\t\ttype: Number\n\t\t\t},\n\t\t\tsaving: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmessage: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t};\n\n\t\tthis.listeners = {\n\t\t\t'rte-image-saved': '_imageURLValueSaved',\n\t\t\t'rte-image-closed': '_imageDialogClosed',\n\t\t\t'rte-open-image-dialog': '_openImageDialog',\n\t\t};\n\t}\n\n\tready() {\n\t\t// We do not want subtree scoping because it'll scope the actual RTE payload, which will increase the content size unnecessarily\n\t\tthis._encapsulateStyle = false;\n\t\tlet sheets = document.querySelectorAll( 'head > link[rel=stylesheet]' ),\n\t\t\tlen = sheets ? sheets.length : 0;\n\n\t\t// add web fonts if not already in document\n\t\tfor( let i=0; i < len; i++ ) {\n\t\t\tif( sheets[i].getAttribute('href') == FONTS )\n\t\t\t\treturn;\n\t\t}\n\n\t\tlet link = document.createElement( 'link' );\n\t\tlink.setAttribute( 'rel', 'stylesheet' );\n\t\tlink.setAttribute( 'href', FONTS );\n\t\tdocument.head.appendChild( link );\n\t}\n\n\tattached() {\n\t\tthis.tooltipTextMap = this._getTooltipMap();\n\t}\n\n\t/**\n\t * First time the quill instance will be created\n\t * @private\n\t */\n\t_initialize() {\n\t\tlet indentText = function (quill, range, isOutdent = false) {\n\t\t\t// Get the current format in Delta format, range is current selection\n\t\t\tlet currFormat = quill.getFormat(range.index, range.length);\n\t\t\t// Get the current indent number is there is any\n\t\t\tlet currIndent = currFormat && currFormat.indent ? currFormat.indent : '0em';\n\t\t\t// Trim the 'em';\n\t\t\tlet indentNum = parseInt(currIndent.substring(0, currIndent.length - 2));\n\t\t\t// Do nothing if indentaion is already 0\n\t\t\tif (isOutdent && indentNum === 0) { return; }\n\t\t\t// There is an limit in Quill for indentation. If it is out of the range,\n\t\t\t// Quill will take care of it not allowing further indent\n\t\t\tlet targetIndentNum = isOutdent ? indentNum - 1 : indentNum + 1;\n\t\t\t// Indent/Outdent action\n\t\t\tquill.format('indent', targetIndentNum);\n\t\t}\n\t\tlet bindings = {\n\t\t\tindent: { // Only hit tab key\n\t\t\t\tkey: 9,\n\t\t\t\tformat: ['indent', 'list'],\n\t\t\t\thandler: function(range) {\n\t\t\t\t\tindentText(this.quill, range);\n\t\t\t\t}\n\t\t\t},\n\t\t\toutdent: { // Shift + Tab\n\t\t\t\tkey: 9,\n\t\t\t\tformat: ['indent', 'list'],\n\t\t\t\tshiftKey: true,\n\t\t\t\thandler: function(range) {\n\t\t\t\t\tindentText(this.quill, range, true);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'outdent backspace': { // Backspace with cursor on the beginning of the list\n\t\t\t\tkey: 8,\n\t\t\t\tformat: ['indent', 'list'],\n\t\t\t\toffset: 0,\n\t\t\t\thandler: function handler(range, context) {\n\t\t\t\t\tif (context.format.indent != null) {\n\t\t\t\t\t\tindentText(this.quill, range, true);\n\t\t\t\t\t} else if (context.format.list != null) {\n\t\t\t\t\t\tthis.quill.format('list', false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tlet opts = {\n\t\t\tmodules: {\n\t\t\t\ttoolbar: {\n\t\t\t\t\tcontainer: '#rteToolbar',\n\t\t\t\t\thandlers: {\n\t\t\t\t\t\t'image': function() {\n\t\t\t\t\t\t\t//Create/open the image dialog\n\t\t\t\t\t\t\tthis.container.dispatchEvent(\n\t\t\t\t\t\t\t\tnew Event('rte-open-image-dialog', {bubbles: true}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclipboard: {\n\t\t\t\t\tmatchVisual: false\n\t\t\t\t},\n\t\t\t\tkeyboard: {\n\t\t\t\t\tbindings: bindings\n\t\t\t\t},\n\t\t\t},\n\t\t\ttheme: 'snow'\n\t\t};\n\n\t\tthis.quillInstance = new Quill('#rteContainer', opts);\n\t\t// scope ql-editor with sb-rte-dialog class so we can apply css styling\n\t\tPolymer.dom(this.root).querySelector('#rteContainer .ql-editor').classList.add('style-scope', 'sb-rte-dialog');\n\t\tlet undoButton = Polymer.dom(this.root).querySelector(\".ql-undo\");\n\t\tundoButton.addEventListener('click', () => {\n\t\t\tthis.quillInstance.history.undo();\n\t\t});\n\t\tlet redoButton = Polymer.dom(this.root).querySelector(\".ql-redo\");\n\t\tredoButton.addEventListener('click', () => {\n\t\t\tthis.quillInstance.history.redo();\n\t\t});\n\t}\n\n\tonSave() {\n\t\tthis.saving = true;\n\t\tlet content = this.quillInstance.root.innerHTML;\n\t\tlet description = AppContext.properties.i18n.value().l('Click to edit description');\n\t\tthis.value = content !== description ? content : null;\n\t\tthis.rte.value = this.value;\n\t\tthis.rte.fire('rte-value-changed', {value: this.value});\n\t\tthis.rte.fire('rte-saved');\n\t\tthis.close();\n\t}\n\n\tonCancel() {\n\t\tif(!this.imageDialogOpened) {\n\t\t\tthis.rte.fire('rte-esc', {keyCode: 27});\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\topen() {\n\t\tlet description = AppContext.properties.i18n.value().l('Click to edit description');\n\t\tthis.$.dialog.open();\n\t\tif (this.value === description || this.value == undefined)\n\t\t\tthis.value = null;\n\t\tthis.$.rteContainer.focus();\n\t\tPolymer.dom(this.root).querySelector('.title').innerHTML = AppContext.properties.i18n.value().l(`Edit ${this.rte.label}`); // Needed for Safari and FF to update title correctly\n\t\t// In order to avoid initializing multiple quills when we don't want to, we check the value of this flag.\n\t\tif (!this.quillInstance) {\n\t\t\tthis._initialize(); // create Quill instance\n\t\t\tthis._valueChanged(); // For Firefox/Safari\n\t\t} else if (this.quillInstance.root.innerHTML !== this.value) {\n\t\t\tthis._valueChanged(); // Reset the value in ql-editor\n\t\t}\n\n\t\t// clear history stack every time RTE is opened to prevent undo/redo apply for multiple quote line.\n\t\tthis.quillInstance.history.clear();\n\t\tthis.addEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\tclose() {\n\t\tthis.saving = false;\n\t\tthis.message = [];\n\t\tlet description = AppContext.properties.i18n.value().l('Click to edit description');\n\t\tthis.rte.fire('rte-blur');\n\t\tthis.$.dialog.close();\n\t\tif (this.value === description)\n\t\t\tthis.value = null;\n\t\tthis.removeEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\t/**\n\t * If the user wants to import an image, after doing so\n\t * this listener gets called and inserts the img into the editor\n\t */\n\t_imageURLValueSaved(evt) {\n\t\tlet image = evt.detail;\n\t\t// create a new delta to editor and retain its location\n\t\tthis.quillInstance.updateContents(new DELTA()\n\t\t\t.retain(this.currentSelection)\n\t\t\t.insert({ 'image': image.src },\n\t\t\t\t{'width': image.width, 'height': image.height})\n\t\t);\n\t}\n\n\t/**\n\t * RTE Image Dialog has been closed.\n\t */\n\t_imageDialogClosed(evt) {\n\t\tthis.imageDialogOpened = false;\n\t\tPolymer.dom(this.$$('#rteContainer')).removeChild(this.$$('rte-image-dialog'));\n\t}\n\n\t_openImageDialog(evt) {\n\t\tlet selection = this.quillInstance.getSelection();\n\t\tthis.currentSelection = !selection ? 0 : selection.index;\n\t\tlet container = this.$$('#rteContainer');\n\t\tlet imageDialog = document.createElement('rte-image-dialog');\n\t\tPolymer.dom(container).appendChild(imageDialog);\n\t\t// Image Dialog is now opened\n\t\tthis.imageDialogOpened = true;\n\t}\n\n\t/**\n\t * When the quill instance has been created, we want to\n\t * reset the editor to have what's currently saved (this.value)\n\t * @private\n\t */\n\t_valueChanged() {\n\t\t// skip this if we're saving, as the content is already up to date\n\t\tif (this.saving) {\n\t\t\treturn;\n\t\t}\n\t\tlet qlEditorPath = this.$$('#rteContainer .ql-editor');\n\t\tif(qlEditorPath) {\n\t\t\tlet content = this.value;\n\t\t\tthis.setContentToQuill(content);\n\t\t\tthis.configureWarningMessage(content);\n\t\t}\n\t}\n\n\t/**\n\t *  If value has changed and Quill instance is available then set the content\n\t * @param content\n\t */\n\tsetContentToQuill(content) {\n\t\tthis.quillInstance.setText('');\n\t\tthis.quillInstance.clipboard.dangerouslyPasteHTML(0, content);\n\t\t// Remove the <p><br><p>\n\t\tconst delta = this.quillInstance.editor.delta;\n\t\tif(delta.ops.length >= 1 && delta.ops[delta.ops.length-1].insert.endsWith('\\n')) {\n\t\t\tconst deltaLength = delta.length();\n\t\t\tthis.quillInstance.updateContents(new DELTA().retain(deltaLength - 1).delete(1));\n\t\t}\n\t}\n\n\t/**\n\t * We need a timeout because Quill observes the change of innerHTML (presumably for parsing the content)\n\t * and the parsed content (quillInstance.root.innerHTML) doesn't become available immediately.\n\t * @param content\n\t */\n\tconfigureWarningMessage(content) {\n\t\tsetTimeout(() => {\n\t\t\tif (this.formatHtml(this.quillInstance.root.innerHTML) !== this.formatHtml(content) && !this.quillInstance.editor.isBlank()) {\n\t\t\t\tconsole.warn('Rich Text Editor Discrepancy Detected!');\n\t\t\t\tconsole.warn('Before: ', this.formatHtml(content));\n\t\t\t\tconsole.warn('After: ', this.formatHtml(this.quillInstance.root.innerHTML));\n\t\t\t\tif(!this.message) {\n\t\t\t\t\tthis.message = [AppContext.properties.i18n.value().l('This rich text field contains unsupported HTML tags from an earlier version of Salesforce CPQ. Save this field to update to the supported tags. To preserve the original formatting, cancel out of the rich text editor.')];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.message = [];\n\t\t\t}\n\t\t});\n\t}\n\n\tformatHtml(html) {\n\t\treturn this.removeEncoding(this._stripDivTag(html));\n\t}\n\n\tremoveEncoding(str){\n\t\tif (str) {\n\t\t\treturn str\n\t\t\t\t.replace(/&quot;/g, '\"')\n\t\t\t\t.replace(/&#39;/g, \"'\")\n\t\t\t\t.replace(/&lt;/g, '<')\n\t\t\t\t.replace(/&gt;/g, '>')\n\t\t\t\t.replace(/&amp;/g, '&')\n\t\t\t\t.replace(/&nbsp;/g, ' ')\n\t\t\t\t.trim();\n\t\t} else {\n\t\t\treturn str;\n\t\t}\n\t}\n\n\t_stripDivTag(content) {\n\t\tif (content) {\n\t\t\treturn content.replace(/(<div[^>]+?>|<div>|<\\/div>)/img, \"\");\n\t\t} else {\n\t\t\treturn content;\n\t\t}\n\n\t}\n\n\t_isContentEmpty(content) {\n\t\tif(content == null || content == undefined || content === \"\") {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t_getTooltipMap() {\n\t\treturn {\n\t\t\tbold: AppContext.properties.i18n.value().l('Bold'),\n\t\t\titalic: AppContext.properties.i18n.value().l('Italic'),\n\t\t\tunderline: AppContext.properties.i18n.value().l('Underline'),\n\t\t\tstrike: AppContext.properties.i18n.value().l('Strikethrough'),\n\t\t\tfontSize: AppContext.properties.i18n.value().l('Font size'),\n\t\t\theaderSize: AppContext.properties.i18n.value().l('Header size'),\n\t\t\tfontFamily: AppContext.properties.i18n.value().l('Font family'),\n\t\t\talignLeft: AppContext.properties.i18n.value().l('Align left'),\n\t\t\tcenter: AppContext.properties.i18n.value().l('Center'),\n\t\t\talignRight: AppContext.properties.i18n.value().l('Align right'),\n\t\t\ttextColor: AppContext.properties.i18n.value().l('Text color'),\n\t\t\tbackgroundColor: AppContext.properties.i18n.value().l('Background color'),\n\t\t\tsubscript: AppContext.properties.i18n.value().l('Subscript'),\n\t\t\tsuperscript: AppContext.properties.i18n.value().l('Superscript'),\n\t\t\tnumberedList: AppContext.properties.i18n.value().l('Numbered list'),\n\t\t\tbulletList: AppContext.properties.i18n.value().l('Bullet list'),\n\t\t\tdecreaseIndent: AppContext.properties.i18n.value().l('Decrease indent'),\n\t\t\tincreaseIndent: AppContext.properties.i18n.value().l('Increase indent'),\n\t\t\tblockQuote: AppContext.properties.i18n.value().l('Block quote'),\n\t\t\tlink: AppContext.properties.i18n.value().l('Insert or edit link'),\n\t\t\timage: AppContext.properties.i18n.value().l('Insert or edit image'),\n\t\t\tclearFormatting: AppContext.properties.i18n.value().l('Clear formatting'),\n\t\t\tundo: AppContext.properties.i18n.value().l('Undo'),\n\t\t\tredo: AppContext.properties.i18n.value().l('Redo')\n\t\t}\n\t}\n}\n\nPolymer ( RichTextEditorDialog );\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\n\nexport function richTextEditorFactory(value, editable, renderReadOnly, metadata, environment = PageContainer) {\n\tif (editable && !environment.isMobile()) {\n\t\treturn newRichTextEditor(value, renderReadOnly, metadata);\n\t}\n\n\t// In cases of mobile, not editable, etc.\n\treturn simpleFieldFactory(value);\n}\n\nfunction newRichTextEditor(value, renderReadOnly, metadata) {\n\t// prevent IE from display literal \"null\" when value is not set\n\tif (value === null) {\n\t\tvalue = '';\n\t}\n\tlet ff = new FormField('sb-rte');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('label', 1, 'label', metadata.label);\n\n\tff.readOnlyKeyEvent = 'rte-esc';\n\tff.readOnlyBlurEvent = 'rte-blur';\n\tff.changeEvent = 'rte-value-changed';\n\n\treturn ff;\n}\n","/**\n * Allowing users to import a image using a URL\n *\n * @author thane.fenton on 5/15/18.\n * @since 216\n */\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class RTEImageDialog {\n\tbeforeRegister() {\n\t\tthis.is = 'rte-image-dialog';\n\t\tthis.properties = {\n\t\t\timg: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\toriginalWidth: String,\n\t\t\toriginalHeight: String,\n\t\t\twidthDim: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\theightDim: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\timageSrc: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tobserver: '_setupNewImage',\n\t\t\t},\n\t\t\tisChecked: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_updateImageSizesObserver(widthDim, heightDim, img, isChecked)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.imageDialog.open();\n\t\tthis.addEventListener('rte-image-dialog-cancel', this.onCancel);\n\t}\n\n\tonSave() {\n\t\tlet image = this.img;\n\t\tif(this.imageSrc) {\n\t\t\t// Check if width/height are empty\n\t\t\tif(!image.width || !image.height) {\n\t\t\t\timage.width = this.originalWidth;\n\t\t\t\timage.height = this.originalHeight;\n\t\t\t}\n\t\t\tthis.fire('rte-image-saved', image);\n\t\t}\n\t\tthis.close();\n\t}\n\n\tonCancel() {\n\t\tthis.close();\n\t}\n\n\tclose() {\n\t\tthis.$.imageDialog.close();\n\t\tthis.fire('rte-image-closed');\n\t\tthis.removeEventListener('rte-image-dialog-cancel', this.onCancel);\n\t}\n\n\t/**\n\t * After a new url input comes in, add the source\n\t * set the width/height to the dimensions and save the original values\n\t *\n\t * @private\n\t */\n\t_setupNewImage() {\n\t\tif(!this.img) {\n\t\t\tthis.img = new Image();\n\t\t}\n\n\t\tthis.img.src = this.imageSrc;\n\t\tif(!this.imageSrc) {\n\t\t\t// Image Source is empty\n\t\t\tthis.originalWidth = 0;\n\t\t\tthis.originalHeight = 0;\n\t\t\tthis.widthDim = '';\n\t\t\tthis.heightDim = '';\n\t\t}else {\n\t\t\tthis.img.onload = () => {\n\t\t\t\tthis.originalWidth = this.img.width;\n\t\t\t\tthis.originalHeight = this.img.height;\n\t\t\t\tthis.widthDim = this.originalWidth;\n\t\t\t\tthis.heightDim = this.originalHeight;\n\t\t\t};\n\t\t}\n\t}\n\n\t_updateImageSizesObserver (widthDim, heightDim, img, isChecked) {\n\t\tif (widthDim === undefined || heightDim === undefined || img === undefined || isChecked === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateImageSizes(widthDim, heightDim, img, isChecked);\n\t}\n\t\n\t/**\n\t * Update the constrains and the this.img current width and height's\n\t * @private\n\t */\n\t_updateImageSizes(widthDim, heightDim, img, isChecked) {\n\t\tlet widthDimInput = parseInt(widthDim);\n\t\tlet heightDimInput = parseInt(heightDim);\n\t\tlet imgWidth = img.width;\n\t\tlet imgHeight = img.height;\n\n\t\tif((widthDimInput === imgWidth && heightDimInput === imgHeight)\n\t\t\t|| isNaN(widthDimInput) || isNaN(heightDimInput)\n\t\t\t|| widthDimInput === 0 || heightDimInput === 0) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(isChecked) {\n\t\t\t// if width changed, otherwise height was changed\n\t\t\tif(widthDimInput !== imgWidth) {\n\t\t\t\tlet value = this._conversion(widthDimInput, imgWidth, heightDimInput);\n\t\t\t\tthis.img.width = widthDimInput;\n\t\t\t\tthis.img.height = value;\n\t\t\t\tthis.heightDim = value;\n\t\t\t}else {\n\t\t\t\tlet value = this._conversion(heightDimInput, imgHeight, widthDimInput);\n\t\t\t\tthis.img.width = value;\n\t\t\t\tthis.img.height = heightDimInput;\n\t\t\t\tthis.widthDim = value;\n\t\t\t}\n\t\t}else { // constrains is unchecked\n\t\t\tthis.img.width = widthDimInput;\n\t\t\tthis.img.height = heightDimInput;\n\t\t}\n\t}\n\n\t/**\n\t * Formula eg.:\n\t *     New Width * original height / original width (or opposite for a new height)\n\t *\n\t * @param newValue: the new Width/Height\n\t * @param oldValue: the old Width/Height\n\t * @param oppositeValue: the opposite of the new/old values (ie. if width changed, height would be oppositeValue)\n\t * @private\n\t */\n\t_conversion(newValue, oldValue, oppositeValue) {\n\t\tlet value = Math.floor(newValue * oppositeValue / oldValue);\n\t\t// Check if the conversion came out with an invalid value, use old value if so\n\t\treturn (isNaN(value) || value === Infinity) ? oppositeValue : value;\n\n\t}\n}\n\nPolymer(RTEImageDialog);","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {Select} from 'common/forms/sb-select/Select.js';\n\nexport function selectFactory(value, editable, disabled, type, metadata, i18n, useNoneLabel, options) {\n\tlet multiSelect = type === 'multipicklist';\n\tif(editable)\n\t\treturn newSelectList(value, disabled, metadata, i18n, useNoneLabel, options, multiSelect);\n\n\treturn simpleFieldFactory(getLabel(value, options, multiSelect));\n}\n\nfunction newSelectList(value, disabled, metadata, i18n, useNoneLabel, options, multiSelect) {\n\tlet ff = new FormField('sb-select');\n\tif (metadata.defaultValue && (value === null || value === undefined) && !metadata.controllerName && !metadata.restrictedPicklist) {\n\t\tvalue = metadata.defaultValue;\n\t\tff.defaultValue = value;\n\t}\n\tff.addAttribute('id', 0, 'picklist');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('md', 1, 'md', metadata);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('options', 1, 'options', options);\n\tff.addAttribute('is-required', 1, 'isRequired', !!(metadata.required));\n\tff.addAttribute('multi-select', 1, 'multiSelect', multiSelect);\n\tif(useNoneLabel)\n\t\tff.addAttribute('none-label', 1, 'noneLabel', `--${i18n.l(\"None\")}--`);\n\tif(metadata.precision != null)\n\t\tff.addAttribute('size', 1, 'size', metadata.precision);\n\n\tff.formattedValue = { value, label: getLabel(value, options, multiSelect) };\n\treturn ff;\n}\n\nfunction getLabel(value, options, multiSelect) {\n\tif(!options)\n\t\treturn value;\n\n\tlet values = Select.getValues(value, multiSelect);\n\tif(values.length === 0)\n\t\treturn value;\n\n\tlet label = null;\n\tfor(let option of options) {\n\t\tif(values.indexOf(option.value) !== -1) {\n\t\t\tif(multiSelect && label != null)\n\t\t\t\tlabel += (';' + option.label);\n\t\t\telse\n\t\t\t\tlabel = option.label;\n\t\t}\n\t}\n\treturn label || value;\n}\n","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function textareaFactory(value, editable, disabled, renderReadOnly) {\n\tif(editable)\n\t\treturn newTextarea(value, disabled, renderReadOnly);\n\n\treturn simpleFieldFactory(value);\n}\n\nfunction newTextarea(value, disabled, renderReadOnly) {\n\t// prevent IE from display literal \"null\" when value is not set\n\tif (value === null) {\n\t\tvalue = '';\n\t}\n\tlet ff = new FormField('sb-textarea');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\n\tff.readOnlyKeyEvent = 'sb-textarea-key';\n\treturn ff;\n}\n","import {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {ContractLookupTable} from '../sf-contract-lookup-table/ContractLookupTable.js';\n\nconst EVERGREEN = 'evergreen';\nconst NON_EVERGREEN = 'nonevergreen';\n\nexport class ContractLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-contract-lookup';\n\n\t\tthis.listeners = {\n\t\t\t'contract-selected': 'handleContractSelected'\n\t\t};\n\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(app.org)'\n\t\t\t},\n\t\t\tcontractsByType: { // Sort the contract by type Evergreen and Non-Evergreen\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcontractLookupObjects: Array,\n\t\t\tcontracts: Array,\n\t\t\tcontractTabs: Array,           // tab information\n\t\t\tlineEditorModel: Object,\n\t\t\tselectedContractId: String,   // Non-evergreen Contract Id\n\t\t\tselectedEvergreenContractId: String, // Evergreen Contract Id\n\t\t\taction: String, //Value set only for Amend and Renew use case.  Null for Add-on use case,\n\t\t\taccountId: String,      // account from the quote\n\t\t\tselectedAssetIds: String,\n\t\t\tvalidationMessages: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tready() {\n\t\tthis.setAndPrefetchObject();\n\t\tthis.setPropertyFromUrl();\n\t\tthis.setSkipActionClass();\n\t\tthis.handleLineEditorModelResponse();\n\t\tthis.handleContractModelLoadResponse();\n\t\tthis.handleContractModelSaveResponse();\n\n\t\t// handles Amend and Renew asset from Account use case\n\t\tif(this.action) {\n\t\t\tthis.handleContractModelLoadRequest({'uid' : this.accountId, 'action' : this.action});\n\t\t}\n\t}\n\n\t/**\n\t * Set what object should be prefetched. Either Contract or ServiceContract\n\t */\n\tsetAndPrefetchObject() {\n\t\tthis.contractLookupObjects = this.isServiceCloudEnabled() ? ['ServiceContract'] : ['Contract'];\n\t}\n\n\tisServiceCloudEnabled() {\n\t\treturn this.app.org.isServiceCloudEnabled;\n\t}\n\n\t/**\n\t * Get the CPQ Prefix\n\t */\n\tgetPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\t/**\n\t * Get service cloud prefix\n\t */\n\tget scPrefix() {\n\t\treturn this.app.org.scPrefix ? this.app.org.scPrefix  : '';\n\t}\n\n\tsetPropertyFromUrl() {\n\t\tthis.action = this.ctx.params.action;\n\t\tthis.accountId = this.ctx.params.accId;\n\t\tthis.selectedAssetIds = this.ctx.params.selectedAssetIds;\n\t}\n\n\tsetSkipActionClass() {\n\t\tlet skipAction = Polymer.dom(this.$.skip).node;\n\t\tlet skipActionClass;\n\n\t\tif (!this.action) {\n\t\t\tskipActionClass = 'skipActionAddOn';\n\t\t} else if (this.action === 'Amend') {\n\t\t\tskipActionClass = 'skipActionAmend';\n\t\t}\n\n\t\tthis.toggleClass(skipActionClass, true, skipAction);\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\t// handles add-on use case\n\t\t\tthis.handleContractModelLoadRequest({'uid' : this.lineEditorModel.quote.record.Id});\n\t\t}.bind(this));\n\t}\n\n\thandleContractModelLoadRequest(context) {\n\t\tthis.$.contractModelLoadService.uid = null;\n\t\tthis.$.contractModelLoadService.context = context;\n\t}\n\n\t/**\n\t * Restructure data and put contracts list into the map. contractsByType[evergreen] and contractsByType[nonevergreen]\n\t * This will be used for the sb-tabs to display the sf-contract-lookup-table\n\t *\n\t */\n\thandleContractModelLoadResponse() {\n\t\tthis.$.contractModelLoadService.addEventListener('response-changed', function(e) {\n\t\t\tthis.contracts = e.detail.value;\n\t\t\tif (this.contracts.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contractsByType[EVERGREEN] = [];\n\t\t\tthis.contractsByType[NON_EVERGREEN] = [];\n\n\t\t\tlet contractFieldPrefix = (!this.isServiceCloudEnabled()) ? this.prefix : this.scPrefix;\n\n\t\t\tlet evergreenField = contractFieldPrefix + 'Evergreen__c';\n\t\t\tfor (let contract of this.contracts) {\n\t\t\t\tif (contract.record[evergreenField]) {\n\t\t\t\t\tthis.contractsByType[EVERGREEN].push(contract);\n\t\t\t\t} else {\n\t\t\t\t\tthis.contractsByType[NON_EVERGREEN].push(contract);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.buildContractsTabs();\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Handle the response from the sf-contract-lookup-table which with updated contract selection to update the model\n\t */\n\thandleContractSelected(e) {\n\t\tif (e.detail.contractType == NON_EVERGREEN) {\n\t\t\tthis.selectedContractId = e.detail.selectedContractId;\n\t\t} else {\n\t\t\tthis.selectedEvergreenContractId = e.detail.selectedContractId;\n\t\t}\n\t}\n\n\thandleContractModelSaveResponse() {\n\t\tthis.$.contractModelSaveService.addEventListener('response-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\t// Amend or Renew Assets returns a Quote record\n\t\t\t\tif (e.detail.value.Id) {\n\t\t\t\t\tthis.quoteId = e.detail.value.Id;\n\t\t\t\t// Co-terminated Quote with Contracts returns a Quote Line Editor Model so cache it\n\t\t\t\t} else if (e.detail.value.quote && e.detail.value.quote.record) {\n\t\t\t\t\tthis.quoteId = e.detail.value.quote.record.Id;\n\t\t\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\t\t\tthis.$.qo.cache(this.quoteId, this.lineEditorModel);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Build the Contract Tabs\n\t */\n\tbuildContractsTabs() {\n\t\tlet tabs = [];\n\t\tlet tabsInfo = [[NON_EVERGREEN, this.i18n.l(\"Active Contracts\")],\n\t\t\t\t\t\t[EVERGREEN, this.i18n.l(\"Evergreen Contracts\")]];\n\n\t\tfor (let [key, value] of tabsInfo) {\n\t\t\tif (this.contractsByType[key].length > 0) {\n\t\t\t\tlet tab = {\n\t\t\t\t\tname: key,\n\t\t\t\t\tlabel: value\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.contractTabs = tabs;\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet quoteId = this.lineEditorModel ? this.lineEditorModel.quote.record.Id : this.quoteId;\n\t\tthis.nav('#', {'qId': quoteId}, ['quote', 'le'], false);\n\t}\n\n\tonSkip() {\n\t\tif (!this.action) {\n\t\t\tthis.navigateToLineEditor();\n\t\t} else {\n\t\t\tthis.$.contractModelSaveService.model = this.buildModel(null, null, null);\n\t\t}\n\t}\n\n\tonSelect() {\n\t\tthis.validationMessages = [];\n\n\t\tif (!this.selectedContractId && !this.selectedEvergreenContractId) {\n\t\t\tthis.validationMessages = [this.i18n.l('Select a record or Skip to continue')];\n\t\t\treturn;\n\t\t}\n\n\t\t// Find the non-evergreen contract for the end date validation\n\t\tif (this.selectedContractId) {\n\t\t\tfor (let contract of this.contractsByType[NON_EVERGREEN]) {\n\t\t\t\tif (this.selectedContractId == contract.record.Id) {\n\t\t\t\t\tif (this.lineEditorModel.quote.record[this.prefix + 'StartDate__c'] > contract.record.EndDate) {\n\t\t\t\t\t\tthis.validationMessages = [this.i18n.l('Can\\'t select the contract because its end date is before the quote\\'s start date')];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet model;\n\n\t\tif (this.action) {  //Value set only for Amend and Renew use case.  Null for Add-on use case,\n\t\t\tmodel = this.buildModel(null, this.selectedContractId, this.selectedEvergreenContractId);\n\t\t} else {\n\t\t\tlet dataBuilder = new DataBuilder().addObject('quote', this.lineEditorModel.quote.record);\n\t\t\tdataBuilder.add('selectedContractId', this.selectedContractId);\n\t\t\tdataBuilder.add('selectedEvergreenContractId', this.selectedEvergreenContractId);\n\t\t\tmodel = dataBuilder.build();\n\t\t}\n\n\t\tthis.$.contractModelSaveService.model = model;\n\t}\n\n\t/**\n\t * Build the return model to the SaveService to process.\n\t * @param quote\n\t * @param selectedContractId\n\t * @param selectedEvergreenContractId\n\t * @returns {{quote: *, selectedContractId: *, selectedEvergreenContractId: *, action: *, accountId: *, selectedAssetIds: (*|String)}}\n\t */\n\tbuildModel(quote, selectedContractId, selectedEvergreenContractId) {\n\t\tlet model = {   'quote': quote || null,\n\t\t\t\t\t\t'selectedContractId' : selectedContractId,\n\t\t\t\t\t\t'selectedEvergreenContractId' : selectedEvergreenContractId,\n\t\t\t\t\t\t'action' : this.action,\n\t\t\t\t\t\t'accountId' : this.accountId,\n\t\t\t\t\t\t'selectedAssetIds' : this.selectedAssetIds};\n\t\treturn model;\n\t}\n\n\tonCancel() {\n\t\tthis.showSpinner = true;\n\t\tthis.navigateToDetailPage();\n\t}\n\n\tnavigateToDetailPage() {\n\t\tlet objectId;\n\n\t\tif (this.action) {\n\t\t\tobjectId = this.accountId;\n\t\t} else {\n\t\t\tobjectId = this.lineEditorModel.quote.record.Id\n\t\t}\n\n\t\tif (this.isLightningExperience()) {\n\t\t\t//W-014658: mobile does not have a way to exit the Visualforce page besides the back button\n\t\t\tif (PageContainer.getViewport().isMobile() === true)\n\t\t\t\tthis.navigateToURL('#/sObject/' + this.prefix + 'Quote__c/home');\n\t\t\telse\n\t\t\t\tsforce.one.navigateToSObject(objectId);\n\t\t\treturn;\n\t\t}\n\n\t\tlet returnUrl = '/' + objectId;\n\n\t\tif (window.parent) {\n\t\t\t// For org\n\t\t\twindow.parent.location.href = returnUrl;\n\t\t} else {\n\t\t\t// For localhost\n\t\t\twindow.location.href = returnUrl;\n\t\t}\n\t}\n\n\tisLightningExperience() {\n\t\treturn (typeof sforce != 'undefined') && sforce && (!!sforce.one);\n\t}\n\n\tnavigateToURL(url) {\n\t\tsforce.one.navigateToURL(url);\n\t}\n}\n\nPolymer(ContractLookup);\n","import {AppContext} from 'common/core/AppContext.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\n\nexport class ContractLookupTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-contract-lookup-table';\n\t\tthis.properties = {\n\t\t\tname: String,       // tab name: evergreen or nonevergreen\n\t\t\tcontractsByType: Object\n\t\t},\n\n\t\tthis.listeners = {  // To listen if there's any selection changes\n\t\t\t'selection-changed' : 'handleContractSelected'\n\t\t};\n\t}\n\n\t/**\n\t * Obsevers: execute those methods when all the params are ready\n\t *\n\t * @returns {[string]}\n\t */\n\tget observers() {\n\t\treturn [\n\t\t\t'_handleContractLoadResponseObserver(contractsByType, name)'\n\t\t];\n\t}\n\n\t/**\n\t * To determine what contract object should be used (ServiceContract or Contract)\n\t *\n\t * @returns {string}\n\t */\n\tget contractObject() {\n\t\treturn (AppContext.org.isServiceCloudEnabled) ? 'ServiceContract' : 'Contract';\n\t}\n\n\tready() {\n\t\tthis.$.header.selectable = false;\n\t\tthis.handleMetaDataResponse();\n\t}\n\n\t/**\n\t * build the metadata required for the rows to render\n\t */\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet recordKeys = [],\n\t\t\t\tfieldLabels = [],\n\t\t\t\tfieldLabelMap = {},\n\t\t\t\tmdMap = {},\n\t\t\t\tlabelTypeMap = {},\n\t\t\t\titemTypeMap = {},\n\t\t\t\tfields = e.detail.value.fields;\n\t\t\tfields.forEach(function(field) {\n\t\t\t\tlet key = field.name;\n\t\t\t\trecordKeys.push(key);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t\tfieldLabelMap[key] = field.label;\n\t\t\t\tmdMap[key] = field;\n\t\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\t\titemTypeMap[key] = field.type;\n\t\t\t}.bind(this));\n\t\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap, null, true).build();\n\t\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\t\tthis.mdMap = mdMap;\n\t\t\tthis.recordKeys = recordKeys;\n\t\t\tthis.fieldLabels = fieldLabels;\n\t\t\tthis.fieldLabelMap = fieldLabelMap;\n\n\t\t}.bind(this));\n\t}\n\n\n\t/**\n\t * Get the field set and update the md\n\t */\n\tsetFieldSet() {\n\t\tlet fields = [];\n\t\tfor (let field of this.contracts[0].activeContractFieldSets) {\n\t\t\tfields.push(this.contractObject + '.' + field);\n\t\t}\n\t\tthis.$.md.fields = fields;\n\t}\n\n\t_handleContractLoadResponseObserver (contractsByType, name) {\n\t\tif (contractsByType === undefined || name === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.handleContractLoadResponse(contractsByType, name);\n\t}\n\t\n\t/**\n\t * Handle the contract load response to set the field set\n\t *\n\t */\n\thandleContractLoadResponse() {\n\t\tthis.contracts = this.contractsByType[this.name];\n\t\tif (this.contracts.length > 0) {\n\t\t\tthis.setFieldSet();\n\t\t}\n\t}\n\n\t/**\n\t * When the contract is selected, it will fire an event to send the selected contract id and contract type\n\t *\n\t * @param e - event detail\n\t */\n\thandleContractSelected(e) {\n\t\tif (e.detail.selected) {\n\t\t\tthis.selectedId = e.detail.Id;\n\t\t} else {\n\t\t\tthis.selectedId = null;\n\t\t}\n\n\t\t// Information to be sent up\n\t\tlet model = {\n\t\t\tcontractType: this.name,\n\t\t\tselectedContractId: this.selectedId\n\t\t};\n\n\t\t// Deselect all available contracts\n\t\tif (e.detail.selected) {\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e);\n\t\t}\n\n\t\t// Fire an event so that it will update the sb-contract-lookup\n\t\tthis.fire('contract-selected', model);\n\t}\n\n\t/**\n\t * Clear all other selection in the table\n\t *\n\t * @param e - event detail\n\t */\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selected === false || e.detail.selected === undefined) {\n\t\t\treturn;\n\t\t}\n\t\t// This is the current row\n\t\tlet root = Polymer.dom(e).rootTarget;\n\t\t//this collects all the rows\n\t\tlet rows = Polymer.dom(root.parentElement).querySelectorAll('sb-table-row');\n\n\t\t// Unselect all other rows in the table\n\t\tfor (let row of rows) {\n\t\t\tif (row !== root) {\n\t\t\t\trow.selected = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer(ContractLookupTable);","import {Util} from 'common/Util.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {PageHeader} from 'common/core/sb-page-header/PageHeader.js';\nimport {ProductMessenger} from 'products/config/message/ProductMessenger.js';\n\nimport { Events } from 'common/core/Events.js';\n\n// We ship the api name for Product Code as 'Product Code' for Field picklist on Custom Action Condition\n// However, the api name for Product Code in Product is 'ProductCode'\n// TODO: Will need to use MetaDataUtils.js to grab the correct API Name instead of hard coding it as a map\nconst API_FIELD_NAME_MAP = {'Product Code' : 'ProductCode'};\n\nexport class CustomActions {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-actions';\n\t\tthis.properties = {\n\t\t\tcustomActions: Array,\n\t\t\tproducts: Array,\n\t\t\tisClassic: Boolean,\n\t\t\tproductIndex: Number,\n\t\t\tfirstItem: Object,\n\t\t\tremainingItems: Array,\n\t\t\tcustomActionsExist: Boolean,\n\t\t\tmoreThanOneCustomActionsExist: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmenuClosed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttonsCollapsed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t\t,\n\t\t\tmessenger: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_newMessenger(quote, products, productIndex)'\n\t\t\t},\n\t\t\tquote: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpopupResponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_updateQuoteFromPopupResponse'\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tget observers() {\n\t\treturn ['_initObserver(customActions, products, productIndex, isClassic, menuClosed)']\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\t_initObserver (customActions, products, productIndex, isClassic, menuClosed) {\n\t\tif (customActions === undefined || products === undefined || productIndex === undefined || isClassic === undefined || menuClosed === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.init(customActions, products, productIndex, isClassic, menuClosed);\n\t}\n\t\n\tinit() {\n\t\t// This check removes all custom actions when bundles have multiple products in classic view.\n\t\tif (this.isClassic && this.products.length > 1) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet urlKey = this.prefix + \"URL__c\";\n\t\tlet labelKey = this.prefix + \"Label__c\";\n\t\tlet page = this.prefix + \"Page__c\";\n\t\tlet targetKey = this.prefix + \"URLTarget__c\";\n\t\tlet actionKey = this.prefix + \"Action__c\";\n\t\tlet brandButtonKey = this.prefix + \"BrandButton__c\";\n\t\tlet labelUrlMap = [];\n\t\tthis.customActions.forEach(customAction => {\n\t\t\tif (customAction[page] === 'Product Configurator' && this.checkCustomActionsConditionsMet(customAction)) {\n\t\t\t\tlet brandButtonClass = '';\n\n\t\t\t\tif(customAction[brandButtonKey] === true) {\n\t\t\t\t\tbrandButtonClass = 'primary';\n\t\t\t\t}\n\n\t\t\t\tlabelUrlMap.push({\n\t\t\t\t\tlabel: customAction[labelKey],\n\t\t\t\t\turl: customAction[urlKey],\n\t\t\t\t\ttarget: customAction[targetKey],\n\t\t\t\t\taction: customAction[actionKey],\n\t\t\t\t\tbrandButtonClass: brandButtonClass\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (labelUrlMap.length === 0) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\t\tthis.firstItem = labelUrlMap[0];\n\t\tif (labelUrlMap.length > 1) {\n\t\t\tthis.remainingItems = labelUrlMap.slice(1);\n\t\t\tthis.moreThanOneCustomActionsExist = true;\n\t\t}\n\t\tthis.customActionsExist = true;\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tthis.classList.remove(\"hide\");\n\t}\n\n\t_itemSelected(e) {\n\t\tconst id = e.target.id;\n\t\tconst targetItem = (id === \"firstItem\") ? this.firstItem : this.remainingItems[id];\n\t\tconst applyRules = \"Apply Edit Rules\";\n\t\tif (targetItem.url !== undefined) { // handle URL actions\n\t\t\tthis.handleURLAction(targetItem);\n\t\t} else if (targetItem.action === applyRules) { // handle 'Apply Rules' action\n\t\t\tthis.applyRules();\n\t\t}\n\t}\n\n\thandleURLAction(targetItem) {\n\t\tif (targetItem.target === 'Popup')\n\t\t\tthis.handlePopup(targetItem.url);\n\t\telse\n\t\t\tthis.handleNav(targetItem.url);\n\t}\n\n\thandlePopup(url, autoLaunched = false, redirectOnCancelOrClose = false) {\n\t\tthis.$.popup.url = url;\n\t\tthis.$.popup.autoLaunched = autoLaunched;\n\t\tthis.$.popup.redirectOnCancelOrClose = redirectOnCancelOrClose;\n\t\tthis.$.popup.messenger = this.messenger;\n\t\tthis.$.popup.open();\n\t}\n\n\thandleNav(url) {\n\t\tif (this._isLightningExperience()) {\n\t\t\tsforce.one.navigateToURL(url);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\tapplyRules() {\n\t\tthis.fire('sb-apply-edit-rules', {\n\t\t\tbundleId: this.products[this.productIndex].record.Id,\n\t\t});\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce !== 'undefined') && sforce && (!!sforce.one);\n\t}\n\n\tcheckCustomActionsConditionsMet(customAction) {\n\t\tlet conditionsKey = this.prefix + \"Custom_Action_Conditions__r\";\n\t\tlet fieldKey = this.prefix + \"Field__c\";\n\t\tlet operatorKey = this.prefix + \"Operator__c\";\n\t\tlet filterValueKey = this.prefix + \"FilterValue__c\";\n\t\tlet targetObjectKey = this.prefix + \"TargetObject__c\";\n\n\t\tif (this._checkPackagedCustomActionConditionMet(customAction) === false)\n\t\t\treturn false;\n\n\t\treturn (customAction[conditionsKey] === undefined) || customAction[conditionsKey].records.some(val => {\n\t\t\t\tif (val[fieldKey] === undefined || val[filterValueKey] === undefined || val[operatorKey] === undefined)\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet targetObject = 'Product';\n\t\t\t\tif(val[targetObjectKey])\n\t\t\t\t\ttargetObject = val[targetObjectKey];\n\n\t\t\t\t// Get the correct api name if necessary\n\t\t\t\tlet fieldName = API_FIELD_NAME_MAP[val[fieldKey]] || val[fieldKey];\n\t\t\t\t//the target object can be Quote or Product\n\t\t\t\tlet record = targetObject === 'Quote' ? this.quote.record : this.products[this.productIndex].record;\n\t\t\t\treturn Util.arithmeticOperatorConversion(record[fieldName],\n\t\t\t\t\tval[filterValueKey], val[operatorKey])\n\t\t\t});\n\t}\n\n\t_checkPackagedCustomActionConditionMet(customAction) {\n\t\tconst launchExternal = \"Launch External\";\n\t\t// check if Launch External action should display\n\t\tif (customAction.Name === launchExternal)\n\t\t\treturn customAction[this.prefix + \"URL__c\"] !== undefined &&\n\t\t\t\t!!this.products[this.productIndex].record[this.prefix + 'ExternallyConfigurable__c'];\n\n\t\treturn true;\n\t}\n\n\t_changeMenu(e) {\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed, this.$$('#remainingItems'), 'open', this);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_viewportChanged() {\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t}\n\n\t_newMessenger() {\n\t\treturn new ProductMessenger(this.quote, this.products[this.productIndex], this.prefix, this.currencyIsoCode, Polymer.Base);\n\t}\n\n\t_updateQuoteFromPopupResponse() {\n\t\tthis.quote = this.popupResponse.quote;\n\t}\n}\n\nPolymer(CustomActions);\n","export class AttributeItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_notifyAttributeChanged'\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setAttributeMDObserver(item, model, targetField)',\n\t\t\t'_setTargetFieldObserver(item, model)',\n\t\t\t'_setRequiredObserver(value, model, attributeMD)',\n\t\t\t'setLabel(md)'\n\t\t];\n\t}\n\n\t_setRequiredObserver (value, model, attributeMD) {\n\t\tif (value === undefined || model === undefined || attributeMD === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setRequired(value, model, attributeMD);\n\t}\n\t\n\tsetRequired() {\n\t\t//because autoSelect disables the attribute, it doesn't make sense for it to be required\n\t\tif (this.attributeMD.required === false || this.attributeMD.autoSelect === true)\n\t\t\treturn;\n\t\tthis.toggleClass('mandatory-no-value', this.isValidValue() === false, this.$.attributeField);\n\t}\n\n\tisValidValue() {\n\t\treturn !!(this.value !== undefined && this.value !== null && this.value !== '');\n\t}\n\n\t_setAttributeMDObserver (item, model, targetField) {\n\t\tif (item === undefined || model === undefined || targetField === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setAttributeMD(item, model, targetField);\n\t}\n\t\n\tsetAttributeMD() {\n\t\tif (!this.model.fields) {\n\t\t\treturn;\n\t\t}\n\t\tthis.attributeMD = this.model.attributeMD[this.item];\n\t\tthis.$.field.disabled = this.attributeMD.autoSelect; //autoSelect set to true disabled the attribute\n\t\tthis.hidden = this.attributeMD.hidden; //a configuration attribute can be hidden which means don't show on the UI\n\t\tlet md = JSON.parse(JSON.stringify(this.model.fields[this.targetField])); //don't reflect changes back to cache\n\t\tif(md.type === 'picklist') {\n\t\t\tmd.picklistValues = this.getPicklistValues(md.picklistValues);\n\t\t\tmd.required = this.attributeMD.required;\n\t\t}\n\n\t\tthis.md = md;\n\t}\n\n\t_setTargetFieldObserver (item, model) {\n\t\tif (item === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setTargetField(item, model);\n\t}\n\t\n\tsetTargetField() {\n\t\tthis.$.field.record = this;\n\t\tthis.targetField = this.model.attributeMD[this.item].targetFieldName;\n\t}\n\n\tsetLabel() {\n\t\tthis.label = this.md.label;\n\t}\n\n\tgetPicklistValues(defaultValues) {\n\t\tif(this.attributeMD === undefined)\n\t\t\treturn defaultValues;\n\n\t\tif(!this.attributeMD.shownValues && !this.attributeMD.hiddenValues)\n\t\t\treturn defaultValues;\n\n\t\tlet shownValues = this.attributeMD.shownValues || [];\n\t\tif(!this.attributeMD.shownValues) {\n\t\t\tfor (let item of defaultValues)\n\t\t\t\tshownValues.push(item.value);\n\t\t}\n\n\t\tlet hiddenValues = this.attributeMD.hiddenValues || [];\n\t\treturn defaultValues.filter(function(item) {\n\t\t\treturn shownValues.indexOf(item.value) !== -1 && hiddenValues.indexOf(item.value) === -1;\n\t\t});\n\t}\n\n\t_notifyAttributeChanged(e) {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tthis.fire('sb-config-attribute-changed', {\n\t\t\tId: this.item,\n\t\t\tbundleId: this.model.attributeMD[this.item].bundleId,\n\t\t\tchanged: true,\n\t\t\tpath: true //this should always be set to true because any change to a value even if falsey should be considered a change\n\t\t});\n\t}\n\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tlet ids = this.model.attributeFieldMD[name];\n\t\tif(ids && ids.length > 0)\n\t\t\treturn this.data[ids[0]];\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(attributeItem) {\n\t\treturn this.data === attributeItem.data;\n\t}\n}\n\nPolymer(AttributeItem);\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class AttributeTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tposition: String,\n\t\t\tmodel: Object,\n\t\t\tconfigAttributes: Object,\n\t\t\taddedClass: String,\n\t\t\tmd: Object,\n\t\t\tshowTable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_generateColumnsObserver(featureId, model, configAttributes, md)',\n\t\t\t'_getMDObserver(configAttributes, model)',\n\t\t\t'bindDataToModel(configAttributes.*)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.optionFieldMetadata.addEventListener('md-changed', function (e) {\n\t\t\tthis.setMD(e);\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t\tthis.addEventListener('lookup-value-changed', this._setReferencedData.bind(this));\n\t}\n\n\t_getMDObserver (configAttributes, model) {\n\t\tif (configAttributes === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getMD(configAttributes, model);\n\t}\n\t\n\tgetMD() {\n\t\tthis.spinner = true;\n\t\tlet attributeFields = {},\n\t\t\tattributeModelData = this.model.configurationAttributeModelMap;\n\t\tfor (let i in attributeModelData)\n\t\t\tattributeFields[attributeModelData[i].targetFieldName] = null;\n\n\t\tthis.$.optionFieldMetadata.fields = Object.keys(attributeFields);\n\t}\n\n\tsetMD(e) {\n\t\tthis.md = {\n\t\t\tfields: e.detail.value.fieldsByObject[this.model.prefix + 'ProductOption__c'],\n\t\t\tattributeMD: this.model.configurationAttributeModelMap,\n\t\t\tattributeFieldMD: this.model.configurationAttributeTargetFieldMap\n\t\t};\n\t}\n\n\t_generateColumnsObserver (featureId, model, configAttributes, md) {\n\t\tif (featureId === undefined || model === undefined || configAttributes === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.generateColumns(featureId, model, configAttributes, md);\n\t}\n\n\t// Prepare column list which will be used to generate the components in each column group\n\tprepareColumns(flsFeatureAttributes, position) {\n\t\tconst column1Group = [], column2Group = [], column3Group = [];\n\n\t\tconst numAttributes = flsFeatureAttributes.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tconst targetAttribute = flsFeatureAttributes[i].myId;\n\n\t\t\tif (flsFeatureAttributes[i].position == position || !position) {\n\t\t\t\tif (flsFeatureAttributes[i].columnOrder == 1)\n\t\t\t\t\tcolumn1Group.push(targetAttribute);\n\t\t\t\telse if (flsFeatureAttributes[i].columnOrder == 2)\n\t\t\t\t\tcolumn2Group.push(targetAttribute);\n\t\t\t\telse\n\t\t\t\t\tcolumn3Group.push(targetAttribute);\n\t\t\t}\n\t\t}\n\n\t\treturn [column1Group, column2Group, column3Group];\n\t}\n\n\t// Create featureAttributesByFieldName map which will be used in the `normalizeData` function\n\tcreateFeatureAttributesByFieldName(flsFeatureAttributes, md) {\n\t\tlet featureAttributesByFieldName = {};\n\t\tconst numAttributes = flsFeatureAttributes.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tconst targetAttribute = flsFeatureAttributes[i].myId;\n\t\t\tmd.attributeMD[targetAttribute].processed = true;\n\t\t\tconst targetFieldName = flsFeatureAttributes[i].targetFieldName;\n\n\t\t\tlet featureAttributeIds = featureAttributesByFieldName[targetFieldName] || [];\n\t\t\tfeatureAttributeIds.push(targetAttribute);\n\t\t\tfeatureAttributesByFieldName[targetFieldName] = featureAttributeIds;\n\t\t}\n\n\t\treturn featureAttributesByFieldName;\n\t}\n\n\tgenerateColumns(featureId, model, configAttributes, md) {\n\t\tconst featureAttributes = model.configAttributesByFeatureId[featureId] || [];\n\t\t\n\t\t// Filter the config attribute to respect field-level security. Skip generating the config attribute if the profile doesn't have access to the the field.\n\t\tconst flsFeatureAttributes = featureAttributes.filter((featureAttribute) => {\n\t\t\treturn md.fields && md.fields.hasOwnProperty(featureAttribute.targetFieldName);\n\t\t});\n\t\tconst [column1Group, column2Group, column3Group] = this.prepareColumns(flsFeatureAttributes, this.position);\n\n\t\tthis.normalizeData(this.createFeatureAttributesByFieldName(flsFeatureAttributes, md));\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\t/**\n\t * Its possible that other configuration attributes for this product\n\t * have been changed before these attributes have been stamped in since in mobile feature details are\n\t * stamped in only when the feature is expanded and not when the configurator page is rendered.\n\t * Also tabs don't stamp the content in until the tab has been clicked\n\t * Thus, we need to see if there exists any processed configuration attributes with the same target field\n\t * and update this feature's equivalent configuration attribute with that value to simulate the two-way\n\t * binding of those attributes that did not take place because the attributes were not yet stamped in.\n\t */\n\tnormalizeData(featureAttributesByFieldName) {\n\t\t// loop through all the configuration attributes in this feature by the target field of the attribute\n\t\tfor(let targetFieldName in featureAttributesByFieldName) {\n\t\t\tlet featureAttributes = featureAttributesByFieldName[targetFieldName];\n\t\t\tlet bundleAttributes = this.md.attributeFieldMD[targetFieldName];\n\n\t\t\t// return early if there are not more bundle attributes for a given target field\n\t\t\t// then there are feature attributes for the same target field\n\t\t\tif(bundleAttributes.length <= featureAttributes.length)\n\t\t\t\treturn;\n\n\t\t\t// loop through bundle attributes to find any that are not in this feature\n\t\t\t// and any that have already been processed\n\t\t\tfor (let bundleAttribute of bundleAttributes) {\n\n\t\t\t\t// if this bundle attribute is in this feature, then continue\n\t\t\t\tif (featureAttributes.indexOf(bundleAttribute) !== -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if this bundle attribute has not yet been processed (i.e. its feature has not yet been expanded)\n\t\t\t\t// then simply continue as the user could have yet changed its value\n\t\t\t\tif(!this.md.attributeMD[bundleAttribute].processed)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// we have found a bundle attribute for the same target field that is not in this feature\n\t\t\t\t// and has been processed, so lets sync its value with this features attribute value\n\t\t\t\tfor(let featureAttribute of featureAttributes)\n\t\t\t\t\tthis.configAttributes[featureAttribute] = this.configAttributes[bundleAttribute];\n\n\t\t\t\t// since the syncing is complete, we can move on to the next target field\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif (column1Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.firstColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.firstColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif (column2Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.secondColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.secondColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif (column3Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.thirdColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n\n\t//The purpose of this code is to bypass groups propagateFromParentToChild handler\n\t//We have a unique case for updating the elements for a given group\n\tcaptureCallBack(e) {\n\t\tlet elements = this.elements,\n\t\t\tattributeId = e.path.split('.')[1];\n\t\tif (attributeId === undefined)\n\t\t\treturn;\n\n\t\tlet targetField = this.model.attributeMD[attributeId].targetFieldName;\n\t\tfor (let i = 0, l = elements.length; i < l; i++) {\n\t\t\tlet elementId = elements[i].item.split('.')[0];\n\t\t\tif (elementId === attributeId)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.model.attributeMD[elements[i].item].targetFieldName === targetField)\n\t\t\t\telements[i].value = e.value;\n\t\t}\n\t}\n\n\tbindDataToModel(e) {\n\t\tif (e.path === undefined || e.path === 'configAttributes')\n\t\t\treturn;\n\n\t\t//update the product view model with the data change\n\t\tlet targetField = this._getTargetFieldNameFromModel(e.path.split('.')[1]);\n\t\tthis.model.product.configuration.configurationData[targetField] = e.value;\n\t}\n\n\t// Reference Field metadata needs to be supplied on the configuration model to render correctly after a reconfigure\n\t_setReferencedData(e) {\n\t\tif (!e || !e.detail || !e.detail.obj || !e.detail.item)\n\t\t\treturn;\n\n\t\tconst targetField = this._getTargetFieldNameFromModel(e.detail.item);\n\t\tconst referencedField = this.md.fields[targetField].relationshipName;\n\t\tif (referencedField === null) return;\n\t\tconst attributeData = e.detail.value === null ? null : {\n\t\t\t'attributes': e.detail.obj.attributes,\n\t\t\t'Id': e.detail.obj.Id,\n\t\t\t'Name': e.detail.obj.Name\n\t\t};\n\n\t\tthis.model.product.configuration.configurationData[referencedField] = attributeData;\n\t}\n\n\t_getTargetFieldNameFromModel(attributeID) {\n\t\treturn this.model.configurationAttributeModelMap[attributeID].targetFieldName;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\nPolymer(AttributeTable);\n","import { Events } from 'common/core/Events.js';\n\nexport class ProductBundlesFilterItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tlabel: String\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.CLEAR_PRODUCT_FILTER] = this.clear;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn ['setFieldData(model)'];\n\t}\n\n\tsetFieldData() {\n\t\tlet md;\n\t\tfor (let i = 0, numFields = this.model.length; i < numFields; i++) {\n\t\t\tif (this.model[i].name === this.item) {\n\t\t\t\tthis.label = this.model[i].label;\n\t\t\t\t// allow pick list types, but convert all other to string types\n\t\t\t\tmd = this.model[i].type === 'picklist' || this.model[i].type === 'multipicklist' ? this.model[i] : { type: 'string' };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = md;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n}\n\nPolymer(ProductBundlesFilterItem);\n","import {ConfiguratorSearch} from '../../search/ConfiguratorSearch.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nexport class ProductBundlesLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-layout';\n\t\tthis.properties = {\n\t\t\tproductIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tconfiguredProducts: Array,\n\t\t\tsetToSections: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tisClassic: Boolean,\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'formatBundlesLayout'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tqId: String,\n\t\t\tsearchFilters: Array, //array of fields for md\n\t\t\tsearchValuesByFilter: Object, //keymap of filter fields vs inputs\n\t\t\tsearchFieldMD: Object,\n\t\t\tsearchFilterTypeMap: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setMD(searchFilters)',\n\t\t\t'initSearchFilter(searchFieldMD)',\n\t\t\t'_updateProductFromPopupResponseObserver(popupResponse, configuredProducts)',\n\t\t\t'_resize(configuredProducts.*)',\n\t\t\t'_selectBundleObserver(isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex)'\n\t\t];\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\t_resize() {\n\t\tthis.resize();\n\t}\n\n\tinitSearchFilter() {\n\t\tthis.$.group.group = this.searchFilters;\n\t\tthis.$.group.model = this.searchFieldMD;\n\t\tthis.$.group.data = this.searchValuesByFilter;\n\t\tlet searchFilterTypeMap = {};\n\t\tfor (let md of this.searchFieldMD)\n\t\t\tsearchFilterTypeMap[md.name] = md.type;\n\t\tthis.searchFilterTypeMap = searchFilterTypeMap;\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t\tthis.handlePanelSlide();\n\t\tthis.handlePanelEvents();\n\t\tthis.handleMD();\n\t}\n\n\thandlePanelEvents() {\n\t\tthis.addEventListener('side-toggle-clicked', function () {\n\t\t\tthis.toggle();\n\t\t}.bind(this));\n\t\tthis.addEventListener('iron-select', function () {\n\t\t\tif (this.$.drawer.selected == 'drawer')\n\t\t\t\tthis.drawerState = 'open';\n\t\t\telse\n\t\t\t\tthis.drawerState = 'closed';\n\t\t}.bind(this));\n\t\tthis.addEventListener('x-clicked', function () {\n\t\t\tthis.$.search.closeDrawer();\n\t\t}.bind(this));\n\t\tthis.addEventListener('enter-keypress', function() {\n\t\t\tif (this.searchFilters)\n\t\t\t\tthis.applyFilters();\n\t\t}.bind(this));\n\t}\n\n\thandleMD() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.searchFieldMD = e.detail.value.fields;\n\t\t}.bind(this));\n\t}\n\n\tnavTo(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\tlet numBundles = this.configuredProducts.length;\n\t\tlet index = this.productIndex;\n\t\tfor (let i = 0; i < numBundles; i++) {\n\t\t\tif (this.getProductId(i) === target)\n\t\t\t\tindex = i;\n\t\t}\n\t\t// enable the selection of the tapped item\n\t\tthis.setSelected(target);\n\n\t\tif (!this.isMobile && this.isClassic)\n\t\t\tthis.$$('#Bundle' + target).scrollIntoView();\n\t\telse\n\t\t\tthis.fire('bundle-panel-clicked', index);\n\t}\n\n\ttoggle() {\n\t\tthis.toggleTransition(true);\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tclassicOrSelectedIndex(item, configuredProductIndex) {\n\t\treturn ((this.isClassic && !this.isMobile) ||\n\t\t(this.configuredProducts[this.productIndex] === item) ||\n\t\t(!this.productIndex && configuredProductIndex === 0) ||\n\t\t((this.productIndex >= this.configuredProducts.length) && configuredProductIndex === 0));\n\t}\n\n\thandleResize() {\n\t\tlet sfSidebar = document.querySelector('#sidebarCell');\n\t\tif (sfSidebar) {\n\t\t\tsfSidebar.addEventListener('click', this.resize.bind(this));\n\t\t}\n\t\twindow.addEventListener('resize', this.resize.bind(this));\n\t}\n\n\tresize() {\n\t\tthis.toggleTransition(false);\n\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\thandlePanelSlide() {\n\t\tif (!this.isMobile) {\n\t\t\t//check for which drawers are open\n\t\t\tthis.addEventListener('iron-select', function () {\n\t\t\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\t\t\tthis._setBundleContainerWidth(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._setBundleContainerWidth(true);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tif (this.isMobile) {\n\t\t\tthis.addEventListener('iron-deselect', function (e) {\n\t\t\t\tif (e.detail.item.id === 'drawer') {\n\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\t_selectBundleObserver (isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex) {\n\t\tif (isMobile === undefined || configuredProducts === undefined || isClassic === undefined || \n\t\t\thasMultipleBundles === undefined || productIndex === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.selectBundle(isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex);\n\t}\n\t\n\tselectBundle() {\n\t\t//add scrim to search panel\n\t\tthis.$.search.$$('#scrim').style.width = '100%';\n\n\t\tif (this.isMobile) {\n\t\t\tthis.navWidth = 0;\n\t\t\t//add scrim to bundle list in mobile\n\t\t\tthis.$.drawer.$$('#scrim').style.width = '100%';\n\t\t}\n\t\tif (this.configuredProducts.length === 1)\n\t\t\tthis.navWidth = 0;\n\n\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\n\t\tif (!this.isClassic || this.isMobile) {\n\t\t\tlet targetId = this.getProductId(this.productIndex);\n\n\t\t\tthis.fire('bundle-name-changed', {name: this.configuredProducts[this.productIndex].record.Name});\n\t\t\tPolymer.dom(this.$.panel).observeNodes(function () {\n\t\t\t\tthis.setSelected(targetId);\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.resize();\n\t}\n\n\tbuildPanelIfMultipleBundesAndNotMobile() {\n\t\tif (this.configuredProducts.length  === 1 || this.isMobile)\n\t\t\treturn;\n\n\t\tthis.panelWidth = 256;\n\t\tthis.navWidth = 24;\n\t\tthis.$.panel.rightSideButton = true;\n\t\tthis.toggleTransition(false);\n\t\tif (this.isOpen === \"1\") {\n\t\t\tthis.$.drawer.selected = 'drawer';\n\t\t\tthis.drawerState = 'open';\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis.$.drawer.selected = 'main';\n\t\t\tthis.drawerState = 'closed';\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\t_setBundleContainerWidth(isDrawerOpen) {\n\t\tif (this.configuredProducts && this.configuredProducts.length < 2) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('open', !isDrawerOpen, this.$.bundleContainer);\n\t\tthis.toggleClass('close', isDrawerOpen, this.$.bundleContainer);\n\t}\n\n\ttoggleTransition(enable) {\n\t\t// enables/disables the transition for the drawer\n\t\tthis.$.drawer._transition = enable;\n\t\t// enables/disables the transition for the content\n\t\tthis.toggleClass('transition', enable, this.$.bundleContainer);\n\t}\n\n\tdefaultState() {\n\t\tif (this.isOpen === \"1\")\n\t\t\treturn 'drawer';\n\t\treturn 'main';\n\t}\n\n\ttoggleSearch() {\n\t\tthis.$.search.togglePanel();\n\t}\n\n\trefocus() {\n\t\tthis.$.search.querySelector('#searchPanel').querySelector('sb-group').$$('sb-product-bundles-filter-item').$$('sb-field').$$('div#f').firstChild.focus();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clear.focus();\n\t}\n\n\tsetMD() {\n\t\tthis.$.md.object = 'ProductOption__c';\n\t\tthis.$.md.fields = this.searchFilters;\n\t}\n\n\tapplyFilters() {\n\t\tthis.$.clear.focus();\n\t\tthis.$.search.closeDrawer();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tclearFields() {\n\t\tfireEvent(Events.CLEAR_PRODUCT_FILTER);\n\t\tthis.blur();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tgetProductId(productIndex, underscorePrefix) {\n\t\tlet product = this.configuredProducts[productIndex];\n\t\t// product key is the unique identifier of a product if a cloned product\n\t\tlet id = product.productKey || product.record.Id;\n\t\tlet prefix = underscorePrefix ? '_' : '';\n\t\treturn prefix + id;\n\t}\n\n\tsetSelected(targetId) {\n\t\tthis.removeAllSelected();\n\t\tthis.toggleClass('selected-tab', true, this.$$('#_' + targetId));\n\t}\n\n\tremoveAllSelected() {\n\t\tlet navItems = Polymer.dom(this.root).querySelectorAll('div.nav-item');\n\t\tfor (let navItem of navItems)\n\t\t\tthis.toggleClass('selected-tab', false, navItem);\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_updateProductFromPopupResponseObserver (popupResponse, configuredProducts) {\n\t\tif (popupResponse === undefined || configuredProducts === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateProductFromPopupResponse(popupResponse, configuredProducts);\n\t}\n\t\n\t_updateProductFromPopupResponse() {\n\t\tlet products = this.popupResponse.products;\n\t\tif(!products || products.length === 0)\n\t\t\treturn;\n\n\t\tlet numConfiguredProducts = this.configuredProducts.length;\n\t\tfor(let product of products)\n\t\t\tthis.push('configuredProducts', product);\n\n\t\tif(numConfiguredProducts === 1)\n\t\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\t}\n\n\tformatBundlesLayout() {\n\t\tthis.toggleClass('multiple-bundles', this.hasMultipleBundles, this.$.bundleContainer);\n\t}\n}\n\nPolymer(ProductBundlesLayout);","import {FieldSetHandler} from '../../../../common/layout/fields/FieldSetHandler.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class ProductFeature {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = \"sb-product-feature\";\n\n\t\tthis.listeners = {\n\t\t\t'selection-changed': 'handleSelectionCounter'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tmaxOptions: Object,\n\t\t\tfeature: Object,\n\t\t\tfieldSetKey: String,\n\t\t\tfieldSetHandler: Object,\n\t\t\ttabNames: {\n\t\t\t\ttype: Array,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: [\"options\", \"attributes\"]\n\t\t\t},\n\t\t\ttabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobile(viewport)\"\n\t\t\t},\n\t\t\thasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setHasConfigAttributes(model, featureId)\"\n\t\t\t},\n\t\t\thasTopConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasTopConfigAttributes(model, featureId)'\n\t\t\t},\n\t\t\thasBottomConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasBottomConfigAttributes(model, featureId)'\n\t\t\t},\n\t\t\tmobileHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: \"_setHasOptions(model, featureId)\"\n\t\t\t},\n\t\t\tmobileHasOptions: Boolean,\n\t\t\thasOptionsAndConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions)'\n\t\t\t},\n\t\t\tmobileHasOptionsAndConfigAttributes: Boolean,\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasInstructions(feature)'\n\t\t\t},\n\t\t\tmobileHasInstructions: Boolean,\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectedOptions: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\thasSelectedOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_hasSelectedOptions(selectedOptions)'\n\t\t\t},\n\t\t\tfeatureIndex: Number,\n\t\t\tconfigAttributes:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasUpgradedOptions(feature)'\n\t\t\t},\n\t\t\tmobileRendering: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobileExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() {\n\t\treturn [\n\t\t\t'_renderObserver(featureId, model)',\n\t\t\t'_buildTabsObserver(viewport, model, featureId)',\n\t\t\t'featureChanged(feature)',\n\t\t\t'_initFieldSetObserver(model, fieldSetKey, fieldSetHandler)'\n\t\t];\n\t}\n\n\t_setHasUpgradedOptions() {\n\t\treturn this.model.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_hasSelectedOptions(selectedOptions) {\n\t\treturn !selectedOptions;\n\t}\n\n\t_renderObserver (featureId, model) {\n\t\tif (featureId === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.render(featureId, model);\n\t}\n\t\n\trender() {\n\t\tif (!this.model.featureIdsWithOptionsOrConfigAttr[this.featureId])\n\t\t\treturn;\n\t\tthis.setFeatureAndOptionSelectionMethod();\n\t\tthis.setOptionsDetails();\n\t\tthis.setFieldSetHandler();\n\t\tthis.renderFeatureInDesktopOrMobileView();\n\t\tthis.initSelectedOptions();\n\t\tthis.handleDeleteOptions();\n\t\tthis.handleOptionChangedByRule();\n\t}\n\n\t_buildTabsObserver (viewport, model, featureId) {\n\t\tif (viewport === undefined || model === undefined || featureId === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildTabs(viewport, model, featureId);\n\t}\n\t\n\tbuildTabs() {\n\t\tif (!this.isMobile)\n\t\t\treturn;\n\n\t\tlet i18n = AppContext.properties.i18n.value();\n\t\tlet optionsTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: i18n.l(\"Options\"),\n\t\t\tpageComponent: \"sb-product-option-table\",\n\t\t\tattributes: [ { name: 'id', value: 'ot' } ],\n\t\t\tbind: [ \"model\", \"featureId\", \"fieldSet\", \"fieldSetName\", \"routeSource\", \"isClickSelection\",\n\t\t\t\t\"disabledStateMap\", \"configSearch\", \"hasUpgradeOptions\"]\n\t\t};\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'configAttributesTop' }, { name: 'added-class', value: 'header-attributes' } ],\n\t\t\tbind: [ \"featureId\", \"model\", \"configAttributes\"]\n\t\t};\n\t\tthis.tabs = [optionsTab, attributesTab];\n\t}\n\n\tsetFieldSetHandler() {\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.model.product.optionFieldSets, 'OptionConfiguration',\n\t\t\t'OptionConfigurationTablet', 'OptionConfigurationPhone');\n\t}\n\n\tsetFeatureAndOptionSelectionMethod() {\n\t\tthis.feature = this.model.getFeature(this.featureId);\n\t}\n\n\tsetOptionsDetails() {\n\t\tthis.isClickSelection = this.feature.optionSelectionMethod === 'Click';\n\t\tthis.routeSource = 'Configurator';\n\t}\n\n\tfeatureChanged() {\n\t\tlet configurationFieldSet = this.feature.record[this.model.prefix + 'ConfigurationFieldSet__c'];\n\t\tthis.fieldSetKey = configurationFieldSet === undefined ? null : configurationFieldSet;\n\t}\n\n\tsetFieldSetFromViewport() {\n\t\tlet fs = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tthis.fieldSet = fs.fields;\n\t\tthis.fieldSetName = fs.name;\n\t}\n\n\t_initFieldSetObserver (model, fieldSetKey, fieldSetHandler) {\n\t\tif (model === undefined || fieldSetKey === undefined || fieldSetHandler === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.initFieldSet(model, fieldSetKey, fieldSetHandler);\n\t}\n\t\n\tinitFieldSet() {\n\t\tif(this.fieldSetKey) {\n\t\t\tthis.fieldSet = this.model.product.optionFieldSets[this.fieldSetKey];\n\t\t\tthis.fieldSetName = this.fieldSetKey;\n\t\t} else {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_setHasConfigAttributes(model, featureId) {\n\t\tlet configAttributes = this.model.configAttributesByFeatureId[featureId];\n\n\t\tif(!configAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < configAttributes.length; i++) {\n\t\t\tif(!configAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasTopConfigAttributes(model, featureId) {\n\t\treturn this._hasTopOrBottomConfigAttributes('Top', featureId);\n\t}\n\n\t_setHasBottomConfigAttributes(model, featureId) {\n\t\treturn this._hasTopOrBottomConfigAttributes('Bottom', featureId);\n\t}\n\n\t_hasTopOrBottomConfigAttributes(position, featureId) {\n\t\tlet configAttributes = this.model.configAttributesByFeatureId[featureId];\n\n\t\tif (!configAttributes)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId[featureId]) {\n\t\t\tif (attribute.position === position && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasOptions() {\n\t\treturn !!this.model.optionsByFeatureId[this.featureId] || this.model.featureIdsWIthSelectionMethodDynamic[this.featureId];\n\t}\n\n\t_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions) {\n\t\treturn hasConfigAttributes && hasOptions;\n\t}\n\n\t_setHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\n\t\tif(!this.fieldSetKey) {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\trenderFeatureInDesktopOrMobileView() {\n\t\tthis.toggleClass(\"group\", !this.isMobile, this.$.feature);\n\t}\n\n\tapplyFilters() {\n\t\tlet featureOptions = this.model.getOptionsByFeatureId(this.featureId);\n\t\tlet configSearch = new ConfiguratorSearch(this.searchFilters, featureOptions, {});\n\t\tthis.filtered = !configSearch.hasOptions || !configSearch.containsFeature(this.feature);\n\t}\n\n\tmobileExpand(e) {\n\t\tif(this.mobileExpanded) {\n\t\t\tthis.expand(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.mobileRendering)\n\t\t\treturn; // already tapped on it and its still rendering so nothing more to do here\n\n\t\t// setting this to true displays the loading spinner\n\t\tthis.mobileRendering = true;\n\n\t\t// removing the 'first' class removes the chevron\n\t\tthis.toggleClass('first', false, this.$$('header'));\n\n\t\t// Wait for the spinner to render before proceeding\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t// set all the boolean properties that drives the mobile dom-if rendering\n\t\t\tthis.mobileHasInstructions = this.hasInstructions;\n\t\t\tthis.mobileHasOptionsAndConfigAttributes = this.hasOptionsAndConfigAttributes;\n\t\t\tthis.mobileHasConfigAttributes = this.hasConfigAttributes;\n\t\t\tthis.mobileHasOptions = this.hasOptions;\n\t\t\tPolymer.dom(this.$.feature).observeNodes(function () {\n\t\t\t\t// nodes have been stamped in, so lets finish the expanding process\n\t\t\t\tthis.mobileExpanded = true;\n\t\t\t\tthis.mobileRendering = false;\n\t\t\t\t// adding the 'first' class back re-adds the chevron\n\t\t\t\tthis.toggleClass('first', true, this.$$('header'));\n\t\t\t\tthis.expand(e);\n\t\t\t}.bind(this));\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tthis.expanded = !this.expanded;\n\t\tthis.fire('feature-expanded', {expanded: this.expanded, path: Polymer.dom(e).path});\n\t}\n\n\tinitSelectedOptions() {\n\t\tlet prefix = AppContext.org.prefix !== '' ? AppContext.org.prefix + '__' : '';\n\t\tvar options = this.model.getOptionsByFeatureId(this.featureId);\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].selected)\n\t\t\t\tthis.selectedOptions++;\n\n\t\t\tif(options[i].record[prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\tconsole.warn('Option is missing entry in selected pricebook => ' + options[i].record[prefix + 'ProductCode__c'] + ': ' + options[i].record[prefix + 'ProductName__c']);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSelectionCounter(e) {\n\t\tif(!e.detail.changed)\n\t\t\treturn;\n\n\t\tif (e.detail.selectionType === 'radio') {\n\t\t\t// When selected, a radio can have either one option or no options\n\t\t\tthis.selectedOptions = e.detail.selected ? 1 : 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.selectedOptions && !e.detail.selected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectedOptions += (e.detail.selected ? 1 : -1);\n\t}\n\n\thandleDeleteOptions(e) {\n\t\tthis.addEventListener('delete-tapped', function(e) {\n\t\t\tif (this.selectedOptions > 0)\n\t\t\t\tthis.selectedOptions--;\n\t\t});\n\t}\n\n\thandleOptionChangedByRule(e) {\n\t\tthis.addEventListener('option-changed-by-rule', function(e) {\n\t\t\te.detail.added ? this.selectedOptions++ : this.selectedOptions--;\n\t\t});\n\t}\n}\n\nPolymer(ProductFeature);","export class ProductFeatureCategoryList {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-category-list';\n\t\tthis.properties = {\n\t\t\tcategoryNamesOrFeatures: Array,\n\t\t\thasCategories: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setHasCategories(model)',\n\t\t\t'_setCategoryNamesOrFeaturesObserver(model, hasCategories)'\n\t\t];\n\t}\n\n\tsetHasCategories(model) {\n\t\tthis.hasCategories = model.checkAtLeastOneFeatureHasCategory();\n\t}\n\n\t_setCategoryNamesOrFeaturesObserver (model, hasCategories) {\n\t\tif (model === undefined || hasCategories === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setCategoryNamesOrFeatures(model, hasCategories);\n\t}\n\t\n\tsetCategoryNamesOrFeatures(model, hasCategories) {\n\t\tif (hasCategories) {\n\t\t\tthis.categoryNamesOrFeatures = Object.keys(model.getTabFeaturesMap());\n\t\t} else {\n\t\t\tthis.categoryNamesOrFeatures = model.featuresWithOptionsOrConfigAttr;\n\t\t}\n\t}\n\n\tgetFeaturesByCategory(categoryName) {\n\t\tvar map = this.model.getTabFeaturesMap();\n\n\t\treturn map[categoryName];\n\t}\n}\n\nPolymer(ProductFeatureCategoryList);","import {Page} from '../../../../common/core/Page.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class ProductFeatureLayout extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tqId: String, // quoteId needed for building PVM\n\t\t\tproduct: Object,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tconfigAttributes: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfeatures: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: '_setFeatures(model)'\n\t\t\t},\n\t\t\tvp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(vp)'\n\t\t\t},\n\t\t\thasTopConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasTopConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\thasBottomConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasBottomConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\thasFeaturelessConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasFeaturelessConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\tisMobileAndHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes)'\n\t\t\t},\n\t\t\tisSectionLayout: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisPaginationRequired: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabsForFeatureLayout: Object,\n\t\t\ttabsForTabsAndWizardLayout: Object,\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConstraintsHandler: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: 'setOptionConstraintsHandler(model)'\n\t\t\t},\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tlistenersAttached: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setConfigAttributes(model)', // Must be ran before render, thus it must be ordered in the array before render (W-3837959)\n\t\t\t'_renderObserver(model, isSectionLayout)',\n\t\t\t'_buildModelObserver(product, qId, currencyIsoCode)',\n\t\t\t'_handleProductRulesResponseObserver(model, disabledStateMap, product.configuration.*)',\n\t\t\t'_setOptionDataObserver(model, product.configuration.optionDataByOptionIdAndIndex)',\n\t\t\t'_updateProductFromPopupResponseObserver(popupResponse, model)',\n\t\t\t'_createConstraintsHoverMessagesObserver(model, optionConstraintsHandler)',\n\t\t\t'_setSelectedForConstraintsObserver(optionConstraintsHandler.optionConstraints, disabledStateMap)'\n\t\t];\n\t}\n\n\t_buildModelObserver (product, qId, currencyIsoCode) {\n\t\tif (product === undefined || qId === undefined || currencyIsoCode === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildModel(product, qId, currencyIsoCode);\n\t}\n\t\n\tbuildModel() {\n\t\tthis.model = new ProductViewModel(this.qId, this.product, this.app.org.prefix, this.currencyIsoCode);\n\t}\n\n\t_setConfigAttributes() {\n\t\tthis.configAttributes = this.model.configurationAttributeValueMap;\n\t}\n\n\t_setHasFeaturelessConfigAttributes() {\n\t\tlet featurelessConfigAttributes = this.model.configAttributesByFeatureId['featureless'];\n\n\t\tif(!featurelessConfigAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < featurelessConfigAttributes.length; i++) {\n\t\t\tif(!featurelessConfigAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setFeatures(model) {\n\t\treturn model.featuresWithOptionsOrConfigAttr;\n\t}\n\n\t_setIsMobile(vp) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (vp) {\n\t\t\treturn vp.isMobile();\n\t\t}\n\t}\n\n\t_setHasTopConfigAttributes(configAttributes) {\n\t\tif (!this.model || !this.model.configAttributesByFeatureId.featureless)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId.featureless) {\n\t\t\tif (attribute.position === 'Top' && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasBottomConfigAttributes(configAttributes) {\n\t\tif (!this.model || !this.model.configAttributesByFeatureId.featureless)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId.featureless) {\n\t\t\tif (attribute.position === 'Bottom' && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes) {\n\t\treturn isMobile && hasFeaturelessConfigAttributes;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.vp = e.detail.viewport;\n\t}\n\n\t_renderObserver (model, isSectionLayout) {\n\t\tif (model === undefined || isSectionLayout === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.render(model, isSectionLayout);\n\t}\n\t\n\trender() {\n\t\tlet optionLayout = this.model.getOptionLayout();\n\t\tif (this.isMobile) {\n\t\t\toptionLayout = 'Sections';\n\n\t\t\tif (this.hasFeaturelessConfigAttributes) {\n\t\t\t\tthis.buildFeatureLayoutTabs();\n\t\t\t\tthis.handleOptionSelectionChanged();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isSectionLayout) {\n\t\t\toptionLayout = 'Sections';\n\t\t}\n\n\t\tif ( !this.isMobile && (optionLayout === 'Tabs' || this.model.checkAtLeastOneFeatureHasCategory()) ) {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = false;\n\t\t} else if (optionLayout === 'Wizard') {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = true;\n\t\t} else if (optionLayout === 'Sections' || optionLayout === 'None') {\n\t\t\tthis.isSectionLayout = true;\n\t\t}\n\t\tthis.handleOptionSelectionChanged();\n\t\tthis.listenersAttached = true;\n\t}\n\n\tbuildFeatureLayoutTabs() {\n\t\tlet featuresTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: this.i18n.l(\"Features\"),\n\t\t\tpageComponent: \"sb-product-feature-category-list\",\n\t\t\tbind: [ \"model\", \"configAttributes\", \"disabledStateMap\", \"configSearch\"]\n\t\t};\n\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: this.i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'globalConfigAttributes' }, { name: 'added-class', value: 'header-attributes' }, { name: 'feature-id', value: 'featureless' } ],\n\t\t\tbind: [\"model\", \"configAttributes\"]\n\t\t};\n\n\t\tthis.tabsForFeatureLayout = [featuresTab, attributesTab];\n\t}\n\n\tbuildTabsAndWizardLayoutTabs() {\n\t\tlet tabFeaturesMap = this.model.getTabFeaturesMap(),\n\t\t\tfeatureKeys = Object.keys(tabFeaturesMap),\n\t\t\ttabs = [];\n\t\tfor (let i = 0, l = featureKeys.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i;\n\t\t\ttabs.push({name: tId, label: featureKeys[i]});\n\t\t}\n\t\tthis.isSectionLayout = false;\n\t\tthis.tabsForTabsAndWizardLayout = tabs;\n\t}\n\n\tsetOptionConstraintsHandler() {\n\t\treturn new OptionConstraintsHandler(this.model.product, this.model.prefix);\n\t}\n\n\thandleOptionSelectionChanged() {\n\t\tif (this.listenersAttached)\n\t\t\treturn;\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tif (e && e.detail) {\n\t\t\t\tif (e.detail.selected === false && this.model.getOption(e.detail.Id).added) {\n\t\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\t\toption.added = false;\n\t\t\t\t\toption.removed = true;\n\t\t\t\t}\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, e.detail.selected);\n\t\t\t}\n\t\t});\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tif (e && e.detail && !this.hasSameOptionAdded(e.detail.Id)) {\n\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\toption.added = false;\n\t\t\t\toption.removed = true;\n\t\t\t\tif(option._transient_) option._transient_.rendered = false;\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, false);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thasSameOptionAdded(optionId) {\n\t\tlet fId = this.model.getOption(optionId).record[this.model.prefix + 'Feature__c'],\n\t\t\tfeature = this.model.getFeature(fId),\n\t\t\toptions = feature ? feature._transient_.optionConfigurations : [];\n\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].record.Id === optionId)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thandleOptionConstraints(optionId, selected) {\n\t\tlet disabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected);\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\t_handleProductRulesResponseObserver (model, disabledStateMap) {\n\t\tif (model === undefined || disabledStateMap === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.handleProductRulesResponse(model, disabledStateMap);\n\t}\n\t\n\thandleProductRulesResponse() {\n\t\tif (!this.domHost || !this.product.configuration.productRulesActions)\n\t\t\treturn;\n\t\tthis.setOptionsDisabledByRules(Object.keys(this.product.configuration.productRulesActions.enableOptions), false);\n\t\tthis.setOptionsDisabledByRules(Object.keys(this.product.configuration.productRulesActions.disableOptions), true);\n\t\tthis.setOptionsHiddenByRules(Object.keys(this.product.configuration.productRulesActions.hideOptions), true);\n\t\tthis.setOptionsHiddenByRules(Object.keys(this.product.configuration.productRulesActions.showOptions), false);\n\t\tthis.setOptionsSelectedByRules(Object.keys(this.product.configuration.productRulesActions.selectOptions), true);\n\t\tthis.setOptionsSelectedByRules(Object.keys(this.product.configuration.productRulesActions.deselectOptions), false);\n\n\t\tthis.set('model.productRulesActions', this.product.configuration.productRulesActions);\n\t\tdelete this.product.configuration.productRulesActions;\n\t}\n\n\t/**\n\t * Sets the disabled data for all the options affected by product selection rules\n\t * @param optionIds Array of options that are either disabled or enabled\n\t * @param disabled Boolean that indicates if the action enables or disables the options\n\t */\n\tsetOptionsDisabledByRules(optionIds, disabled) {\n\t\tconst ruleAction = disabled ? 'disableOptions' : 'enableOptions';\n\t\tfor (let id of optionIds) {\n\t\t\tif (this.model.optionSystemOrRequired(id)) {\n\t\t\t\tdelete this.product.configuration.productRulesActions[ruleAction][id];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet shouldBeConstrained = disabled ? this.optionConstraintsHandler.optionShouldBeDisabled(id) : !this.optionConstraintsHandler.optionShouldBeDisabled(id);\n\t\t\tthis.product.configuration.productRulesActions[ruleAction][id] = shouldBeConstrained;\n\t\t\tlet constrained = (disabled && shouldBeConstrained || !disabled && !shouldBeConstrained) ? true : false;\n\n\t\t\tlet option = this.model.getOption(id);\n\t\t\toption.disabledData = {'disabled': disabled, 'constrained': constrained};\n\t\t}\n\t}\n\n\t/**\n\t * Sets the visibility for all the options affected by product selection rules\n\t * @param optionIds Array of options that are either hidden or shown\n\t * @param hidden Boolean that indicates if the action hides or shows the options\n\t */\n\tsetOptionsHiddenByRules(optionIds, hidden) {\n\t\tfor (let id of optionIds) {\n\t\t\tlet option = this.model.getOption(id);\n\t\t\toption.hidden = hidden;\n\t\t\toption.hiddenByRule = hidden;\n\t\t\tthis.handleFeatureVisibility(this.model.featureIdByOptionId[id])\n\t\t}\n\t}\n\n\t/**\n\t * Sets the selection for all the options affected by product selection rules\n\t * @param optionIds Array of options that are either deselected or selected\n\t * @param hidden Boolean that indicates if the action deselects or selects the options\n\t */\n\tsetOptionsSelectedByRules(optionIds, selected) {\n\t\tfor (let id of optionIds) {\n\t\t\tlet option = this.model.getOption(id);\n\t\t\toption.selected = selected;\n\t\t\toption.selectedByRule = selected;\n\t\t}\n\t}\n\n\t/**\n\t * Sets selected property of the referenced options to the passed in Boolean value\n\t * @param pvm ProductViewModel\n\t * @param optionsById Map of option Ids to 'true'\n\t * @param value Boolean to indicate selected status of the option\n\t * @private\n\t */\n\t_setOptionSelections(pvm, optionsById, value) {\n\t\tif (!optionsById) {return;}\n\n\t\tObject.keys(optionsById).forEach(optionId => {\n\t\t\tlet option = pvm.getOption(optionId);\n\t\t\tif (option && option.selected !== value) {\n\t\t\t\toption.selected = value;\n\t\t\t}\n\t\t});\n\t}\n\n\thandleFeatureVisibility(featureId) {\n\t\tconst hideFeature = this.checkFeatureHasVisibleOptions(featureId),\n\t\t\tindex = this.features.findIndex(feature => { return feature.record.Id === featureId; });\n\t\tthis.set(['features', index, 'hidden'], hideFeature);\n\t}\n\n\tcheckFeatureHasVisibleOptions(id) {\n\t\tfor (let option of this.model.optionsByFeatureId[id]) {\n\t\t\tif (!option.hidden)\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t_setOptionDataObserver (model, optionDataByOptionIdAndIndex) {\n\t\tif (model === undefined || optionDataByOptionIdAndIndex === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setOptionData(model, optionDataByOptionIdAndIndex);\n\t}\n\t\n\t_setOptionData() {\n\t\tif (!this.domHost)\n\t\t\treturn;\n\t\tthis.set('model.optionDataByOptionIdAndIndex', this.product.configuration.optionDataByOptionIdAndIndex);\n\t\tdelete this.product.configuration.optionDataByOptionIdAndIndex;\n\t}\n\n\t_updateProductFromPopupResponseObserver (popupResponse, model) {\n\t\tif (popupResponse === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._updateProductFromPopupResponse(popupResponse, model);\n\t}\n\t\n\t_updateProductFromPopupResponse() {\n\t\tif (this.popupResponse.dynamicOptions && this.popupResponse.dynamicOptions.length > 0)\n\t\t\treturn; // if response contains dynamic options, we delegate to product configurator to handle the response\n\t\tthis._bindResponseChangesToUI();\n\t}\n\n\t_bindResponseChangesToUI() {\n\t\tthis.model.init(this.popupResponse.product);\n\t\tthis._setConfigAttributes();\n\t\tthis.set('model.optionNotifications', this.popupResponse.optionNotifications);\n\t}\n\n\thandleDynamicOptionsAdded(results) {\n\t\t// called by productConfig after response of dynamic option loader is received\n\t\tfor (let key in results) {\n\t\t\tlet dynamicOption = this._getDynamicOption(key, results[key].record[this.model.prefix + 'Feature__c']);\n\t\t\tvar option = this._extendDataToOption(results[key], dynamicOption);\n\t\t\tlet feature = this.model.getFeature(dynamicOption.featureId);\n\t\t\tthis.popupResponse.product.options.push(option);\n\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\tfeature._transient_.changedExternally = true;\n\t\t}\n\t\t//the last option will apply its record values to any configuration attributes for the original bundle\n\t\tthis.syncConfigurationAttributesToProduct(option);\n\t\tthis._bindResponseChangesToUI();\n\t}\n\n\t_getDynamicOption(productId, featureId) {\n\t\treturn this.popupResponse.dynamicOptions.find( dynamicOption => {\n\t\t\treturn dynamicOption.productId.substring(0,15) === productId.substring(0,15) &&\n\t\t\t\tdynamicOption.featureId.substring(0,15) === featureId.substring(0,15);\n\t\t});\n\t}\n\n\t_extendDataToOption(option, sourceOption) {\n\t\tif (sourceOption.configurationData && typeof(sourceOption.configurationData) === 'object') {\n\t\t\tfor (let property in sourceOption.configurationData)\n\t\t\t\toption.record[property] = sourceOption.configurationData[property];\n\t\t}\n\t\toption.record[this.model.prefix + 'Quantity__c'] = sourceOption.Quantity;\n\t\toption.index = sourceOption.index;\n\t\toption.isDynamicOption = true;\n\t\toption.selected = true;\n\t\toption.added = true;\n\t\tif (option.record[this.model.prefix + 'UnitPrice__c'] === undefined)\n\t\t\toption.record[this.model.prefix + 'UnitPrice__c'] = 0;\n\t\treturn option;\n\t}\n\n\tsyncConfigurationAttributesToProduct(product) {\n\t\t// 1: build a key map for any configuration attribute that has auto select set to true\n\t\t// 2: loop through those attributes and set the value to the value of the product record field value\n\t\tif(this.autoSelectAttributes === undefined) {\n\t\t\tthis.autoSelectAttributes = {};\n\t\t\tfor (let attribute of this.popupResponse.product.configurationAttributes)\n\t\t\t\tif (attribute.autoSelect === true && this.autoSelectAttributes[attribute.targetFieldName] === undefined)\n\t\t\t\t\tthis.autoSelectAttributes[attribute.targetFieldName] = true; //just storing keys\n\t\t}\n\n\t\tfor(let attribute in this.autoSelectAttributes)\n\t\t\tthis.popupResponse.product.configuration.configurationData[attribute] = product.record[attribute];\n\t}\n\n\t_createConstraintsHoverMessagesObserver (model, optionConstraintsHandler) {\n\t\tif (model === undefined || optionConstraintsHandler === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._createConstraintsHoverMessages(model, optionConstraintsHandler);\n\t}\n\t\n\t_createConstraintsHoverMessages() {\n\t\tif (this.model.optionConstraintsByConstrained)\n\t\t\treturn;\n\n\t\tthis.model.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n\n\t_setSelectedForConstraintsObserver (optionConstraints, disabledStateMap) {\n\t\tif (optionConstraints === undefined || disabledStateMap === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setSelectedForConstraints(optionConstraints, disabledStateMap);\n\t}\n\t\n\tsetSelectedForConstraints() {\n\t\tlet constrainedArrays = this.optionConstraintsHandler.getConstrainingByConstrained();\n\t\tfor (let constrainedArray of constrainedArrays) {\n\t\t\tfor (let constraint of constrainedArray) {\n\t\t\t\tlet selected = constraint.selected && !this.disabledStateMap[constraint.record.Id]; // if disabled then treat as unselected\n\t\t\t\tthis.handleOptionConstraints(constraint.record.Id, selected);\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer(ProductFeatureLayout);\n","import {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class ProductFeatureList{\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-list';\n\t\tthis.properties = {\n\t\t\tfeatures: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tmodel: Object,\n\t\t\tlabel: String,\n\t\t\tspinner: { //a loading spinner for when we are stamping in the content\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshow: { //used to show/hide the component.  needs to default to false for FF to get the perf benefits\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t_initLazyTabRenderingObserver (tabIndex, viewport) {\n\t\tif (tabIndex === undefined || viewport === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.initLazyTabRendering(tabIndex, viewport);\n\t}\n\t\n\t/**\n\t * For tabs we don't need to load the content until the tab is clicked\n\t * This gets setup here\n\t */\n\tinitLazyTabRendering(tabIndex, viewport) {\n\t\tthis.show = this.isMobile() === true || tabIndex === null;\n\t\tif (this.show === false)\n\t\t\tthis.addEventListener('sb-tab-selected', this.handleTabSelected.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_initFeaturesObserver(label, model)',\n\t\t\t'_filterFeaturesObserver(configSearch, features, model)',\n\t\t\t'filterFeaturesFromRules(model.productRulesActions)',\n\t\t\t'handleFeatureExpandEvent(features)',\n\t\t\t'_setFeatureOptionsAsRenderedObserver(show, features, model)',\n\t\t\t'_initLazyTabRenderingObserver(tabIndex, viewport)'\n\t\t];\n\t}\n\n\t_initFeaturesObserver (label, model) {\n\t\tif (label === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.initFeatures(label, model);\n\t}\n\t\n\tinitFeatures() {\n\t\tthis.features = this.features || this.model.getTabFeaturesMap()[this.label];\n\t}\n\n\tfilterFeaturesFromRules(rules) {\n\t\tif(this.configSearch && this.features && rules && Object.keys(rules).length > 0)\n\t\t\tthis.filterFeatures(this.configSearch, this.features, this.model, rules);\n\t}\n\n\t_filterFeaturesObserver (configSearch, features, model) {\n\t\tif (configSearch === undefined || features === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.filterFeatures(configSearch, features, model);\n\t}\n\t\n\tfilterFeatures(configSearch, features, model, rules) {\n\t\tif(this.domHost) {\n\t\t\tthis._filterFeatures(configSearch, features, model, rules);\n\t\t\treturn;\n\t\t}\n\n\t\t// if already queued up for next render, then nothing more to do here\n\t\tif(this._filterQueuedForNextRender)\n\t\t\treturn;\n\n\t\t// when applying filter on page load in FF and Safari, domHost is not yet available so defer a rendering cycle\n\t\tPolymer.RenderStatus.afterNextRender(this, this._filterFeatures.bind(this, configSearch, features, model, rules));\n\t\tthis._filterQueuedForNextRender = true;\n\t}\n\n\t_filterFeatures(configSearch, features, model, rules) {\n\t\tlet allFeaturesHidden = true;\n\t\tfor (let i = 0, numFeatures = this.features.length; i < numFeatures; i++)\n\t\t\tallFeaturesHidden = this._filterFeatureByIndex(configSearch, features, model, rules, i) && allFeaturesHidden;\n\n\t\tthis._parentHandleContentFiltered(!allFeaturesHidden);\n\t\tthis._filterQueuedForNextRender = false;\n\t}\n\n\t_parentHandleContentFiltered(visibleContent) {\n\t\tif(this.label == null)\n\t\t\treturn; // we need a label to move on so we are done if no label (which means not rendered in tabs)\n\n\t\t// call function on host component directly instead of broadcasting an event, as event approach did not work in FF or Safari\n\t\tif(this.domHost && typeof this.domHost.contentFilteredHandler === 'function')\n\t\t\tthis.domHost.contentFilteredHandler(this.label, visibleContent);\n\t}\n\n\t_filterFeatureByIndex(configSearch, features, model, rules, featureIndex) {\n\t\t// consider the rules' showOptions when determining if a feature has visible options below\n\t\tlet showOptions = rules ? rules.showOptions : null;\n\t\tlet featureOptions = model.optionsByFeatureId[features[featureIndex].record.Id] || [];\n\n\t\tfeatureOptions = configSearch.setOptionVisibility(featureOptions);\n\t\tlet isHidden = this._hideFeature(configSearch, features[featureIndex], model, featureOptions, showOptions);\n\t\tthis.set('features.' + featureIndex + '.hidden', isHidden);\n\t\treturn isHidden;\n\t}\n\n\t_hideFeature(configSearch, feature, model, featureOptions, showOptions) {\n\t\tlet hasRequiredConfigAttributes = configSearch.hasRequiredConfigAttributes(feature, model);\n\t\tif (hasRequiredConfigAttributes) // never hide a feature if it has required config attributes\n\t\t\treturn false;\n\n\t\tlet hasFeature = configSearch.containsFeature(feature);\n\t\tif (!hasFeature) // if your filter does not contain your feature, always hide the feature\n\t\t\treturn true;\n\n\t\tlet filterHasVisibleInlineOptions = configSearch.hasVisibleOptions(featureOptions, showOptions);\n\t\tif (filterHasVisibleInlineOptions) // if feature matches, then never hide feature if it has visible options\n\t\t\treturn false;\n\n\t\tlet allOptionsHiddenByRule = configSearch.allOptionsHiddenByRule(featureOptions);\n\t\tlet hasAnyConfigAttr = configSearch.hasConfigAttributes(feature, model);\n\t\tif (allOptionsHiddenByRule && hasAnyConfigAttr) // even if no visible options, never hide feature if all hidden by rule and any config attribute\n\t\t\treturn false;\n\n\t\tlet selectionMethod = feature.optionSelectionMethod;\n\t\tif (selectionMethod === 'Click') // we have no visible options, so at this point always hide a \"Click\" feature\n\t\t\treturn true;\n\n\t\tlet maxOptionsMet = model.maxOptionsMet(feature);\n\t\tif (maxOptionsMet) // we have no visible options, so at this point always hide an \"Add\" or \"Dynamic\" feature if you can't add any more options\n\t\t\treturn true;\n\n\t\tif (selectionMethod === 'Dynamic')\n\t\t\treturn false; // even with no visible options, never hide a \"Dynamic\" feature as you can add more options\n\n\t\tlet hasNoSelectableOptions = !configSearch.hasVisibleOptions(feature._transient_.optionConfigurations, showOptions);\n\t\treturn hasNoSelectableOptions; // even with no visible options, only hide an \"Add\" feature if you have no visible options to select\n\t}\n\n\thandleFeatureExpandEvent() {\n\t\t//if (!this.model.optionsByFeatureId[this.features[0].record.Id])\n\t\t//\treturn;\n\t\tthis.addEventListener('feature-expanded', function(e) {\n\t\t\tlet nodes = e.detail.path;\n\n\t\t\tnodes.forEach(function(node) {\n\n\t\t\t\tif (node.id === 'feature-header') {\n\t\t\t\t\twhile (node.nextElementSibling) {\n\t\t\t\t\t\tnode.classList.toggle('expanded', e.detail.expanded);\n\t\t\t\t\t\tnode = node.nextElementSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Listens for sb-tab-selected which is fired when the tab for the feature list is clicked\n\t * We then render this component/enable the content inside the dom-if by setting show to true (W-3597046)\n\t */\n\thandleTabSelected() {\n\t\tif (this.show === true)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.async(this.renderComponent.bind(this), 0); //async ensures the spinner is up\n\t}\n\n\t/**\n\t * Toggles the dom-if on\n\t */\n\trenderComponent() {\n\t\tif(this.renderingComponent)\n\t\t\treturn;\n\n\t\tthis.renderingComponent = true;\n\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\tthis.show = true;\n\t\t\tthis.spinner = false;\n\t\t\tthis.renderingComponent = false;\n\t\t}.bind(this));\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\t/**\n\t * @returns {Boolean} is the device mobile?\n\t */\n\tisMobile() {\n\t\treturn !!(this.viewport && this.viewport.isMobile());\n\t}\n\n\t_setFeatureOptionsAsRenderedObserver (show, features, model) {\n\t\tif (show === undefined || features === undefined || model === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setFeatureOptionsAsRendered(show, features, model);\n\t}\n\t\n\tsetFeatureOptionsAsRendered() {\n\t\tif(this.show === false)\n\t\t\treturn;\n\t\tthis.features.forEach(feature => {\n\t\t\tthis.model.getOptionsByFeatureId(feature.record.Id).forEach(option => {\n\t\t\t\tif(feature.optionSelectionMethod == 'Add')\n\t\t\t\t\toption = this.model.product.options.find(o => o.record.Id === option.record.Id);\n\t\t\t\toption._transient_ = option._transient_ || {};\n\t\t\t\toption._transient_.rendered = true;\n\t\t\t});\n\t\t});\n\t}\n}\n\nPolymer(ProductFeatureList);","import {AppContext} from 'common/core/AppContext.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class OptionCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\titemLabel: String,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: Object,\n\t\t\tdata: Object,\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () { return AppContext.org.prefix ? AppContext.org.prefix + '__' : ''; }\n\t\t\t},\n\t\t\tselected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return PageContainer.getViewport(); }\n\t\t\t},\n\t\t\toptionDrawer: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return this.classList.contains('drawerCell') }\n\t\t\t},\n\t\t\trenderReadOnly: { // Will not render in read only mode if OptionCell is placed inside an option drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getRenderReadOnly(optionDrawer)'\n\t\t\t},\n\t\t\tisDisabled: { // Fields will always be editable if placed inside an option drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getDisabled(optionDrawer, selected)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildCellObserver(itemLabel, model, data, prefix)',\n\t\t\t'setItemLabel(item)',\n\t\t\t'_displayChangedObserver(value, display, item, data, field)'\n\t\t];\n\t}\n\n\t_buildCellObserver (itemLabel, model, data, prefix) {\n\t\tif (itemLabel === undefined || model === undefined || data === undefined || prefix === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.buildCell(itemLabel, model, data, prefix);\n\t}\n\t\n\tbuildCell() {\n\t\tthis.field = this.getField();\n\t\tif (this.itemLabel === this.prefix + 'Quantity__c')\n\t\t\tthis.initQuantityCell();\n\t\telse if (this.itemLabel === this.prefix + 'UnitPrice__c')\n\t\t\tthis.initUnitPriceCell();\n\t\telse\n\t\t\tthis.initCell();\n\t}\n\n\tgetQuantityEditable() {\n\t\treturn this.getFieldRecordValue('QuantityEditable__c') || this.data.recordHasQuantity === false;\n\t}\n\n\tgetPriceEditable() {\n\t\treturn this.getFieldRecordValue('PriceEditable__c') === 'Yes' && this.getFieldRecordValue('Bundled__c') === false;\n\t}\n\n\tgetField() {\n\t\treturn this.model.fieldDetails[this.item];\n\t}\n\n\tinitQuantityCell() {\n\t\t//if this is an MDQ option that has already been selected on a previous configuration, we don't create a field, but instead show a warning icon\n\t\tif(this.data.hasDimension === true && this.data.isSegmented === true && this.data.configured === true)\n\t\t\treturn this.mdqWarningIcon = true;\n\t\tthis.editable = this.getQuantityEditable();\n\t\tif (this.getFieldRecordValue('ProductQuantityScale__c') != undefined) {\n\t\t\t// If the option for this quantity cell has a specified Product Quantity Scale, then we need to copy the field\n\t\t\t// metadata and modify the copy's scale instead. Otherwise, each quantity cell is overriding the metadata\n\t\t\t// for all the others, and every quantity cell will use the same quantity scale as the last option.\n\t\t\tthis.field = JSON.parse(JSON.stringify(this.field));\n\t\t\tthis.field.scale = this.getFieldRecordValue('ProductQuantityScale__c');\n\t\t} else if (AppContext.org.quantityScale !== undefined) {\n\t\t\tthis.field.scale = AppContext.org.quantityScale;\n\t\t}\n\t\tthis.$.field.preventNumericAlignment = true;\n\t\tthis.attachQuantityChangeCallback();\n\t\tthis.initCell();\n\t}\n\n\tinitUnitPriceCell() {\n\t\tthis.editable = this.getPriceEditable();\n\t\tif( AppContext.org.currencyDecimalScale != undefined ) {\n\t\t\tthis.field.scale = AppContext.org.currencyDecimalScale;  // set on field md for sb-field to use when displaying in UI\n\t\t}\n\t\tthis.initCell();\n\t}\n\n\tinitCell() {\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\tthis.editable = false;\n\n\t\tif (this.editable === undefined && this.optionDrawer)\n\t\t\tthis.editable = true;\n\n\t\tif (this.editable === undefined)\n\t\t\tthis.editable = this.field.updateable && this.quoteLineHasField(this.itemLabel);\n\n\t\tif (this.value === undefined)\n\t\t\tthis.value = '';\n\n\t\tthis.setDisplayIfRelationshipItem();\n\t\tthis.attachValueChangedCallback();\n\t\tthis.handleOriginalValues();\n\t\tthis.$.field.record = this;\n\t\tthis.$.field.md = this.field;\n\t}\n\n\tattachQuantityChangeCallback() {\n\t\tthis.addEventListener('value-changed', function (e) {\n\t\t\tthis.fire('sb-quantity-changed', {\n\t\t\t\tId: this.data.record.Id,\n\t\t\t\tbundleId: this.getBundleId(),\n\t\t\t\tchanged: true,\n\t\t\t\tinvalidQuantity: this.data.invalidQuantity,\n\t\t\t\tvalidQuantity: this.data.validQuantity,\n\t\t\t\tpath: e.composedPath ? e.composedPath() : [e.target.parentNode]\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tattachValueChangedCallback() {\n\t\tthis.addEventListener('value-changed', this.syncValueChangeWithOptionConfiguration.bind(this));\n\t}\n\n\tgetBundleId() {\n\t\t// the option's parentProductKey is the unique identifier of its product if it's a cloned product\n\t\treturn this.data.parentProductKey || this.getFieldRecordValue('ConfiguredSKU__c');\n\t}\n\n\tgetFieldRecordValue(field) {\n\t\treturn this.data.record[this.prefix + field];\n\t}\n\n\tquoteLineHasField(field) {\n\t\treturn !!(this.model.quoteLineFields[field]);\n\t}\n\n\tsetItemLabel() {\n\t\tif (this.item.startsWith('record.'))\n\t\t\tthis.itemLabel = this.item.split('.')[1];\n\t\telse\n\t\t\tthis.itemLabel = this.item;\n\t}\n\n\tsyncValueChangeWithOptionConfiguration() {\n\t\t// sync the value change into the option's configuration.optionData if it exists\n\t\t// this is to handle toggling between products in a reconfigure scenario with a cloned product\n\t\tif(!this.data.configuration || this.data.configuration.length == 0)\n\t\t\treturn;\n\n\t\t// Do not support option configuration sync if the same option is selected more than once,\n\t\t// which is possible for options in an option selection method 'Add' feature (or dynamic feature).\n\t\t// Do not support because we cannot determine which of the duplicate selected options is being changed here.\n\t\t// For now it is OK we don't support as this is only needed for reconfigure with cloned products via a custom popup action,\n\t\t// which currently does not support option selection method 'Add' features (or dynamic features)\n\t\tif(this.data.configuration.length > 1)\n\t\t\treturn;\n\n\t\tlet optionData = this.data.configuration[0].optionData;\n\t\tif(!optionData)\n\t\t\treturn;\n\n\t\tlet parts = this.item.split('.');\n\t\tlet key = parts[parts.length -1];\n\t\tif(optionData[key] === undefined)\n\t\t\treturn;\n\n\t\toptionData[key] = this.value;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data._transient_.original && this.data.record) {\n\t\t\tthis.data._transient_.original = {};\n\t\t\tthis.data._transient_.original.record = JSON.parse(JSON.stringify(this.data.record));\n\t\t}\n\n\t\tif(this.data._transient_.original) {\n\t\t\tif(!this.data._transient_.original.record.hasOwnProperty(this.item.split('.')[1]))\n\t\t\t\tthis.set('data._transient_.original.' + this.item, this.value);\n\t\t\tthis.$.field.originalValue = this.get('data._transient_.original.' + this.item);\n\t\t}\n\t}\n\n\tsetDisplayIfRelationshipItem() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, null, (field) => {\n\t\t\treturn this.get('data.' + field);\n\t\t}, this.setValue.bind(this));\n\t\tif (rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_displayChangedObserver (value, display, item, data, field) {\n\t\tif (value === undefined || display === undefined || item === undefined || data === undefined || field === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._displayChanged(value, display, item, data, field);\n\t}\n\t\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, null, (field) => {\n\t\t\treturn this.get('data.' + field);\n\t\t}, this.setValue.bind(this));\n\t\trfm.addRelationshipName(this.value, this.display, this.field.referenceTo[0]);\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\t getValue(name) { \n\t\treturn this.data.record[name];\n \t} \n\n\tsetValue(path, value) { \n\t\tthis.set('data.' + path, value); \n\t}\n\n\t  equals(optionCell) { \n\t\treturn this.data === optionCell.data; \n\t}\n\n\tgetRenderReadOnly() {\n\t\treturn !this.optionDrawer;\n\t}\n\n\tgetDisabled() {\n\t\treturn this.optionDrawer ? true : this.selected;\n\t}\n}\n\nPolymer(OptionCell);\n","export class OptionDrawer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-drawer';\n\t\tthis.properties = {\n\t\t\toption: Object,\n\t\t\tmd: Object,\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [ '_setFieldNamesAndRichTextFieldsObserver(option, md)' ];\n\t}\n\n\t_setFieldNamesAndRichTextFieldsObserver (option, md) {\n\t\tif (option === undefined || md === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setFieldNamesAndRichTextFields(option, md);\n\t}\n\t\n\tsetFieldNamesAndRichTextFields() {\n\t\tlet fieldNames = [];\n\t\tlet richTextFields = [];\n\t\tfor (let field in this.option._transient_.attributeItems) {\n\t\t\tfieldNames.push('record.' + field);\n\n\t\t\tif (this.md.fieldDetails['record.' + field] && this.md.fieldDetails['record.' + field].extraTypeInfo === 'richtextarea')\n\t\t\t\trichTextFields.push('record.' + field);\n\t\t}\n\t\tthis.fieldNames = fieldNames;\n\t\tthis.richTextFields = richTextFields;\n\t}\n\n}\nPolymer(OptionDrawer);","import {AppContext} from '../../../../common/core/AppContext.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class ProductOptionTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\t\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-option-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tisClickSelection: Boolean,\n\t\t\tindex: String,\n\t\t\trouteSource: String,\n\t\t\toptions: Array,\n\t\t\tshowAddOptionsButton: Boolean,\n\t\t\tmd: Object,\n\t\t\tfieldSet: Array,\n\t\t\tfeatureless: Boolean,\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(model)'\n\t\t\t},\n\t\t\tprimaryMobileCol: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: \"_getPrimaryMobileColumns(prefix, fieldSet, fieldSetName)\"\n\t\t\t},\n\t\t\tparentIdDataPath: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setParentIdDataPath(model, prefix)'\n\t\t\t},\n\t\t\tdisabledStateMap: Object,\n\t\t\tdisableAllFields: Boolean,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tupgradeOptionButtonText: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Show Available Upgrades'\n\t\t\t},\n\t\t\thasUpgradeOptions: Boolean,\n\t\t\theaderActions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tattributeItemFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tproductHasAttributeSet: Boolean,\n\t\t\tdisplayStyle: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_getDisplayStyle(productHasAttributeSet)'\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.NAVIGATION_CHANGED] = this.navigationChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() { //TODO: Refactor these observers so that they can take advantage of looping through options once!\n\t\treturn [\n\t\t\t'_setMetadataRequestObserver(model, fieldSet, prefix, options)',\n\t\t\t'_initOptionsObserver(model, featureId, isClickSelection, fieldSet)',\n\t\t\t'disabledStateMapChanged(disabledStateMap.*)',\n\t\t\t'_setOptionsDisabledDataObserver(disabledStateMap, options)',\n\t\t\t'setUpgradeOptionClass(options)',\n\t\t\t'_filterOptionsObserver(configSearch, options)',\n\t\t\t'setProductRulesActions(options, model.productRulesActions.*)',\n\t\t\t'_firePriceRules(options, model.optionDataByOptionIdAndIndex.*)',\n\t\t\t'_notifyObserver(model.optionNotifications, options)',\n\t\t\t'_showOrHideAddOptionsButtonObserver(model, featureId, isClickSelection)',\n\t\t\t'_setHasUpgradeOptionsObserver(hasUpgradeOptions, showAddOptionsButton)',\n\t\t\t'_setHeaderActions(options)',\n\t\t\t'_showUpgradeOptionIfSelectionMethodAddObserver(options, isClickSelection)',\n\t\t\t'setOptionIndex(options)',\n\t\t\t'isFeatureOptionless(options)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.header.selectable = false;\n\t\tthis.handleSelectionChanged();\n\t\tthis.handleMetadataChanged();\n\t\tthis.handleDeleteOption();\n\t\tthis.handleConfigureOption();\n\t\tif(!this.viewport || !this.viewport.isMobile())\n\t\t\tthis.editFirstWhenSelected = 'sb-field';\n\t}\n\n\thandleSelectionChanged() {\n\t\tthis.addEventListener('selection-changed', this._selectionChanged.bind(this));\n\t\tthis.addEventListener('sb-quantity-changed', this._handleOptionUpgrades.bind(this));\n\t}\n\n\t_selectionChanged(e) {\n\t\tthis.model.setOptionSelected(e.detail.Id, e.detail.selected);\n\t\tthis.ifRadioSelectedClearOtherRadioSelections(e);\n\n\t\tlet optionIndex = e.detail.index != undefined ? e.detail.index : this.getOptionIndex(e.detail.Id);\n\n\t\tif(optionIndex < 0)\n\t\t\treturn;\n\n\t\tif(e.detail.selected === true && this.routeSource === 'Configurator') {\n\t\t\tthis._displayAvailableRowActions(optionIndex, false);\n\t\t\tthis.set(['options', optionIndex, 'selected'], e.detail.selected);\n\t\t} else {\n\t\t\tthis._displayAvailableRowActions(optionIndex, true);\n\t\t}\n\n\t\t//Undo Price Rules when Product Option is de-selected\n\t\tif(!e.detail.selected && e.detail.changed) {\n\t\t\tlet changedOption = this.model.originalDataByOptionIds[e.detail.Id];\n\n\t\t\tif(changedOption.priceRule) {\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Discount__c'], changedOption.discountRate);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'DiscountAmount__c'], changedOption.discountAmount);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'UnitPrice__c'], changedOption.unitPrice);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Quantity__c'], changedOption.quantity);\n\t\t\t}\n\t\t}\n\n\t\t// Only on user change, not on load.  e.detail.path gets defined on user selection\n\t\tif(this.routeSource === 'Configurator' && e.detail.path && this.options.length > optionIndex && (!!this.options[optionIndex].upgradedAssetId || !!this.options[optionIndex].sourceProductIds))\n\t\t\tthis._handleOptionUpgrades(e, optionIndex);\n\t}\n\n\t_displayAvailableRowActions(index, actionsHidden) {\n\t\tif(this.options.length <= index)\n\t\t\treturn;\n\n\t\tfor(let i = 0; i < this.options[index]._transient_.rowActions.length; i++) {\n\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], actionsHidden);\n\n\t\t\tif(this.routeSource === 'OptionLookup')\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'hidden'], actionsHidden);\n\n\t\t\tif(this.options[index]._transient_.rowActions[i].title === 'Configure' && this.options[index].configurable !== true)\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], true);\n\t\t}\n\t}\n\n\thandleMetadataChanged() {\n\t\tthis.$.fieldMetaData.addEventListener('md-changed', function (e) {\n\t\t\tlet md = this.initFieldMetadata(e.detail.value.fieldsByObject);\n\t\t\tthis.rowClassMap = md.fieldSetMd.rowClassMap; // have to assign this to own property before md because of FireFox\n\t\t\tthis.md = md.fieldSetMd; // Option Rows\n\t\t\tthis.attributeItemMd = md.attributeItemMd; // Option Drawer\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t}\n\n\t_handleOptionUpgrades(e, optionIndex) {\n\t\tif(this.model.product.quoteType !== 'Amendment') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet option = this.options[optionIndex || this.getOptionIndex(e.detail.Id)];\n\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, this.options, option);\n\t\tlet assetUpgradeQauntityCalculator = new AssetUpgradeQuantityCalculator(optionUpgradeHandler);\n\n\t\tassetUpgradeQauntityCalculator.setQuantitiesByRatio();\n\n\t\tif(!optionUpgradeHandler.getSourceOption() && !optionUpgradeHandler.getUpgradeOption()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceOptionIndex = this.getOptionIndex(optionUpgradeHandler.getSourceOption().record.Id);\n\t\tlet upgradeOptionIndex = this.getOptionIndex(optionUpgradeHandler.getUpgradeOption().record.Id);\n\n\t\t// Debounce used to avoid race condition in field.js (this.set was being invoked while onChange event is still running)\n\t\tthis.debounce('Wait for function to finish', () => {\n\t\t\tlet sourceOption = optionUpgradeHandler.getSourceOption();\n\t\t\tlet upgradeOption = optionUpgradeHandler.getUpgradeOption();\n\n\t\t\tif(sourceOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex, sourceOption, true);\n\t\t\t} else if(upgradeOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(upgradeOptionIndex, sourceOptionIndex, upgradeOption, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex);\n\t\t\t}\n\n\t\t\tsourceOption.invalidQuantity = null;\n\t\t\tupgradeOption.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t_notifyQuantityChange(index1, index2, option, invalidQuantity) {\n\t\tif(invalidQuantity) {\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.invalidQuantity;\n\t\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(['options', index2, 'record', this.prefix + 'Quantity__c']);\n\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t}\n\n\t_getPrimaryMobileColumns() {\n\t\tlet primaryMobileCols = [\"record.\" + this.prefix + \"ProductName__c\"];\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSetName.endsWith('Phone'))\n\t\t\tprimaryMobileCols = [\"record.\" + this.fieldSet[0]];\n\n\t\treturn primaryMobileCols;\n\t}\n\n\t_setMetadataRequestObserver (model, fieldSet, prefix, options) {\n\t\tif (model === undefined || fieldSet === undefined || prefix === undefined || options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setMetadataRequest(model, fieldSet, prefix, options);\n\t}\n\t\n\tsetMetadataRequest() {\n\t\tthis.spinner = true;\n\t\tlet mdFieldSet = new Set(),\n\t\t\tmdFields = [];\n\t\tfor (let fieldName of this.fieldSet) // Add fields from fieldSet\n\t\t\tmdFieldSet.add(fieldName)\n\t\tmdFieldSet = this.setAttributeItemMetaData(mdFieldSet);\n\t\tfor (let names of mdFieldSet.values()) { // Request fields from both Product Option and Quote Line objects\n\t\t\tmdFields.push('ProductOption__c.' + names);\n\t\t\tmdFields.push('QuoteLine__c.' + names);\n\t\t}\n\n\t\t//checking if the array values are a match and returning\n\t\t//tabs will cause this code to be run twice when a flush is done, reproducible on the mobile configurator\n\t\tif(JSON.stringify(this.$.fieldMetaData.fields) === JSON.stringify(mdFields))\n\t\t\treturn;\n\t\tthis.$.fieldMetaData.fields = mdFields;\n\t}\n\n\tsetAttributeItemMetaData(mdFieldSet) {\n\t\tlet attributeItemFields = new Set();\n\t\tfor (let option of this.options) {// Add additional fields from Attribute Items\n\t\t\tif (!this.hasAttributeItems(option))\n\t\t\t\tcontinue;\n\n\t\t\tfor (let field in option._transient_.attributeItems) {\n\t\t\t\tmdFieldSet.add(field);\n\t\t\t\tattributeItemFields.add(field);\n\t\t\t}\n\t\t}\n\t\tfor (let field of attributeItemFields.values())\n\t\t\tthis.attributeItemFields.push(field);\n\n\t\treturn mdFieldSet;\n\t}\n\n\tinitFieldMetadata(md) {\n\t\t//Handle the response from field metadata\n\t\tlet fieldSetMd = { fieldLabelMap: {}, recordKeys: [], fieldLabels: [], fieldDetails: {}, labelTypeMap: {}, itemTypeMap: {}, fields: this.fieldSet },\n\t\t\tattributeItemMd = { fieldLabelMap: {}, recordKeys: [], fieldLabels: [], fieldDetails: {}, labelTypeMap: {}, itemTypeMap: {}, fields: this.attributeItemFields };\n\t\tfor (let i in md[this.prefix + 'ProductOption__c']) {\n\t\t\tlet mdItem = md[this.prefix + 'ProductOption__c'][i];\n\t\t\tif (mdItem.type.toLowerCase() === 'currency')\n\t\t\t\tmdItem.CurrencyIsoCode = this.model.currencyIsoCode;\n\t\t\tthis.addMetaDataProperties(fieldSetMd, mdItem);\n\t\t\tif (this.attributeItemFields.length > 0)\n\t\t\t\tthis.addMetaDataProperties(attributeItemMd, mdItem);\n\t\t}\n\n\t\tthis.addAdditionalMetaDataProperties(fieldSetMd, md);\n\t\tthis.addAdditionalMetaDataProperties(attributeItemMd, md);\n\t\treturn { fieldSetMd: fieldSetMd, attributeItemMd: attributeItemMd };\n\t}\n\n\taddMetaDataProperties(obj, mdItem) {\n\t\tlet name = mdItem.name;\n\t\tif (obj.fields.indexOf(name) == -1)\n\t\t\treturn;\n\n\t\tobj.fieldLabels.push(mdItem.label);\n\t\tobj.recordKeys.push('record.' + name);\n\t\tobj.fieldLabelMap[name] = mdItem.label;\n\t\tobj.fieldDetails['record.' + name] = mdItem;\n\n\t\tlet type = mdItem.type;\n\t\tif (!this._isMobile()) {\n\t\t\t// if the quantity field then lets treat as string for the purposes of table formatting\n\t\t\tlet isQuantity = name === (this.prefix + 'Quantity__c');\n\t\t\tif (isQuantity) type = 'string';\n\n\t\t\t// returns undefined if cell is not an image\n\t\t\tlet imageWidth = new ImageCellSizer(mdItem).getImageWidth(20);\n\t\t\t// append the image width to the type if defined as TableClassBuilder knows what to do with a type of format type:width\n\t\t\tif (imageWidth) type += ':' + imageWidth;\n\t\t}\n\n\t\tobj.labelTypeMap[mdItem.label.replace(/\\W/g, '')] = type;\n\t\tobj.itemTypeMap['record.' + name] = type;\n\t}\n\n\taddAdditionalMetaDataProperties(obj, md) {\n\t\tobj.quoteLineFields = md[this.prefix + 'QuoteLine__c'];\n\t\tobj.headerClassMap = new TableClassBuilder(Object.keys(obj.labelTypeMap), 'Th', obj.labelTypeMap, null, true).build();\n\t\tobj.rowClassMap = new TableClassBuilder(obj.recordKeys, 'Td', obj.itemTypeMap, ['initial']).build();\n\t\tdelete obj.fields;\n\t}\n\n\t_initOptionsObserver (model, featureId, isClickSelection, fieldSet) {\n\t\tif (model === undefined || featureId === undefined || isClickSelection === undefined || fieldSet === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.initOptions(model, featureId, isClickSelection, fieldSet);\n\t}\n\t\n\tinitOptions() {\n\t\tthis.productHasAttributeSet = !this._isMobile() && this.model.product._transient_ && this.model.product._transient_.hasAttributeItems;\n\n\t\tthis.options = this.model.getOptionsByFeatureId(this.featureId);\n\t}\n\n\t_notifyObserver (optionNotifications, options) {\n\t\tif (optionNotifications === undefined || options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.notify(optionNotifications, options);\n\t}\n\t\n\tnotify(paths) { // only gets used for external configuration changes\n\t\tif (this.isClickSelection) {\n\t\t\tfor(let i = 0, l = this.options.length; i < l; i++ ) {\n\t\t\t\tfor(let path of paths)\n\t\t\t\t\tthis.notifyPath(`options.${i}.${path}`);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.model.getFeature(this.featureId)._transient_.changedExternally)\n\t\t\t\tthis._optionsExternallyChanged();\n\t\t\t// added rows notification pattern is different to allow for duplicate options\n\t\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\t\tif (rows.length) {\n\t\t\t\trows.forEach(tableRow => {\n\t\t\t\t\ttableRow.notify(paths);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_optionsExternallyChanged() {\n\t\t/* Step 1: Render the template to stamp rows in via dom-repeat */\n\t\tPolymer.dom(this.$.tbody).querySelector('template[is=\"dom-repeat\"]').render();\n\t\t/* Step 2: Bind in rowData and fire change handlers for respective option changes */\n\t\tthis._renderChangedRows();\n\t\t/* Step 3: Render the option-table header and set margin appropriately */\n\t\tthis.isFeatureOptionless();\n\t\tthis._setHeaderActions();\n\n\t}\n\n\t_renderChangedRows() {\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tfor(let i = this.options.length - 1; i >= 0; i--) {\n\t\t\tthis.options[i].selected ? this._addSelectedOption(this.options[i], rows[i], i) : this.deleteOption(this.options[i].record.Id, i);\n\t\t}\n\t}\n\n\t_addSelectedOption(option, row, optionIndex) { // only used for externally configured product\n\t\tif (row.rowData) //if row has already been added, don't try to re-add it\n\t\t\treturn;\n\n\t\t// reset row actions\n\t\toption._transient_.rowActions = this.model.getOption(option.record.Id)._transient_.rowActions;\n\t\t// set row data\n\t\trow.rowData = option;\n\t\t// render row as selected\n\t\trow.$.row.selected = true;\n\t\t// set row actions correctly\n\t\tthis._displayAvailableRowActions(optionIndex, false);\n\t}\n\n\tdeselectOptionsOnOptionLookup() {\n\t\tfor (let [index, option] of this.options.entries())\n\t\t\tthis.set(`options.${index}.selected`, false);\n\t}\n\n\tgetOptionIndex(optionId) {\n\t\tlet index = -1,\n\t\t\ti = 0,\n\t\t\tlength = this.options.length;\n\t\twhile(index < 0 && i < length) {\n\t\t\tif (this.options[i].record.Id === optionId)\n\t\t\t\tindex = i;\n\t\t\ti++\n\t\t}\n\t\treturn index;\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selectionType !== 'radio' || !e.detail.selected)\n\t\t\treturn;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (!rows || rows.length == 0)\n\t\t\treturn;\n\n\t\tlet root = Polymer.dom(e).rootTarget;\n\t\tfor (let row of rows) {\n\t\t\tif (row.selectionType == 'radio' && row !== root) {\n\t\t\t\trow.$.row.fire('group-selected', {selected: false});\n\t\t\t\trow.selected = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetParentIdDataPath() {\n\t\treturn 'record.' + this.prefix + 'ConfiguredSKU__c';\n\t}\n\n\tnavigationChanged() {\n\t\tif (this.model.getFeature(this.featureId)._transient_.changedExternally)\n\t\t\treturn;\n\t\tthis.reset();\n\t}\n\n\t_setOptionsDisabledDataObserver (disabledStateMap, options) {\n\t\tif (disabledStateMap === undefined || options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setOptionsDisabledData(disabledStateMap, options);\n\t}\n\t\n\tsetOptionsDisabledData() {\n\t\tif(!this.options.length || !this.disabledStateMap || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tthis.options.forEach(function (option, idx) {\n\t\t\tif (this.optionShouldChange(option))\n\t\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}.bind(this));\n\t}\n\n\tdisabledStateMapChanged(newVal) {\n\t\tif(!this.options || !this.options.length || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tlet optionId = newVal.path.split('.')[1],\n\t\t\toption = this.model.optionsById[optionId],\n\t\t\tidx = this.options.findIndex(opt => { return opt.record.Id === optionId} );\n\n\t\tif (idx >= 0 && this.optionShouldChange(option)) {\n\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}\n\t}\n\n\toptionShouldChange(option) {\n\t\treturn option.disabledData && this.disabledStateMap[option.record.Id] !== option.disabledData.constrained;\n\t}\n\n\tchangeOptionDisabled(option, idx) {\n\t\tlet constrained = !!this.disabledStateMap[option.record.Id],\n\t\t\tdisabled = option.disabledData.disabled;\n\t\tthis.set(`options.${idx}.disabledData`, {'disabled': disabled, 'constrained': constrained});\n\t\tif (!this.isClickSelection && this.disabledStateMap[option.record.Id] == true)\n\t\t\tthis.deleteOption(option.record.Id, idx, true);\n\t}\n\n\treset() {\n\t\tPolymer._collections.delete(this.options);\n\t}\n\n\trouteToLookup() {\n\t\tlet queryParams = {\n\t\t\tqId: this.model.qId,\n\t\t\tpId: this.model.product.record.Id,\n\t\t\tfId: this.featureId\n\t\t};\n\t\tif (this.model.getFeature(this.featureId).optionSelectionMethod === 'Dynamic')\n\t\t\tqueryParams.path = ['product', 'dl'];\n\t\tthis.fire('add-option-clicked', queryParams);\n\t}\n\n\tisFeatureOptionless() {\n\t\tif (!this.options)\n\t\t\treturn;\n\t\tthis.featureless = this.options.length === 0 ? 'featureless' : null;\n\t}\n\n\tisOptionSelected(option) {\n\t\tif (this.routeSource === 'OptionLookup')\n\t\t\treturn false;\n\t\treturn !!option.selected;\n\t}\n\n\thandleDeleteOption() {\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tthis.deleteOption(e.detail.Id, e.detail.index);\n\t\t}.bind(this));\n\t}\n\n\tdeleteOption(id, index, deleteMultiple) {\n\t\t// We want to pass in the option's `index` value, not the actual index of the option in the array\n\t\tlet copy = this.sameOptionAdded(id, this.options[index].index, true);\n\t\tif (!copy)\n\t\t\tthis.model.optionsById[id].selected = false;\n\n\t\tthis.fire('sb-option-deleted', this.options[index]);\n\t\tthis.splice('options', index, 1);\n\t\tthis.showOrHideAddOptionsButton();\n\t\tif(deleteMultiple && copy) this.deleteOption(copy.id, copy.index, true);\n\t}\n\n\tsameOptionAdded(optionId, index) {\n\t\tlet sameOption = null;\n\t\tfor (let [idx, option] of this.options.entries()) {\n\t\t\tif (option.record.Id === optionId) {\n\t\t\t\tif (option.index === index)\n\t\t\t\t\tcontinue;\n\t\t\t\t// return the optionId and options array index of duplicate option if one is found\n\t\t\t\tsameOption = {'id': optionId, 'index': idx};\n\t\t\t\t// decrement duplicate option indices that are greater that the one being deleted\n\t\t\t\tif (option.index > index)\n\t\t\t\t\toption.index--;\n\t\t\t}\n\t\t}\n\t\treturn sameOption;\n\t}\n\n\thandleConfigureOption() {\n\t\tthis.addEventListener('configure-tapped', function (e) {\n\t\t\tlet index = this.isClickSelection ? null : e.detail.index;\n\t\t\t//When in an 'Add' feature, feature._transient_.optionConfigurations may contain distinct clones. For this reason, access optionConfigurations directly rather that this.options\n\t\t\tlet option = this.isClickSelection ? this.model.optionsById[e.detail.Id] : this.model.getFeature(this.featureId)._transient_.optionConfigurations[e.detail.index];\n\t\t\tthis.fire('configure-option-tapped', {\n\t\t\t\taddedIndex: option.index || 0,\n\t\t\t\tindex: index,\n\t\t\t\toptionId: option.record.Id,\n\t\t\t\toptionalSKU: option.record[this.prefix + 'OptionalSKU__c'],\n\t\t\t\tproductId: this.model.product.record.Id,\n\t\t\t\ttabIndex: this.tabIndex,\n\t\t\t\toptionData: option.record,\n\t\t\t\tisDynamicOption: option.isDynamicOption\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\t_filterOptionsObserver (configSearch, options) {\n\t\tif (configSearch === undefined || options === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.filterOptions(configSearch, options);\n\t}\n\t\n\tfilterOptions() {\n\t\tlet _options = this.configSearch.setOptionVisibility(this.options);\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!this.options[i].hiddenByRule)\n\t\t\t\tthis.set('options.' + i + '.hidden', _options[i].hidden);\n\t\t}\n\t}\n\n\tsetOptionIndex() { // TODO: This can easily be combined with filterOptions, just need a big refactor. Setting property values will not hinder performance\n\t\tlet optionCount = {};\n\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!optionCount[this.options[i].record.Id])\n\t\t\t\toptionCount[this.options[i].record.Id] = 0;\n\t\t\tif (this.options[i].index === undefined) //index should never be undefined as it's set in the PVM. W-4908037\n\t\t\t\tthis.set('options.' + i + '.index', optionCount[this.options[i].record.Id]);\n\n\t\t\tlet nodeId = '_' + this.options[i].record.Id + '_' + this.options[i].index;\n\t\t\tlet configured = this.model.product.configuration.configuredOptions && this.model.product.configuration.configuredOptions[nodeId];\n\t\t\tthis.set('options.' + i + '.configured', configured);\n\t\t\toptionCount[this.options[i].record.Id]++;\n\t\t}\n\t}\n\n\tsetProductRulesActions() {\n\t\tif (Object.keys(this.model.productRulesActions).length == 0 || !this.model.optionsByFeatureId[this.featureId])\n\t\t\treturn;\n\n\t\tif (this.isClickSelection == false)\n\t\t\tthis.setUnaddedOptionsRulesActions();\n\t\tif (this.options[0] !== undefined)\n\t\t\tthis.setDisplayedOptionsRulesActions();\n\t}\n\n\tsetUnaddedOptionsRulesActions() {\n\t\tlet addedOptions = this.model.optionsByFeatureId[this.featureId];\n\t\tfor (let h = 0; h < addedOptions.length; h++) {\n\t\t\tlet option = addedOptions[h];\n\t\t\tif (this.model.productRulesActions.selectOptions[option.record.Id] && !this.sameOptionAdded(option.record.Id, h)) {\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t\tthis.push('options', option);\n\t\t\t\tthis.showOrHideAddOptionsButton();\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[option.record.Id]) {\n\t\t\t\toption.hidden = false;\n\t\t\t\toption.hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.hideOptions[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': true};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': true};\n\t\t\t}\n\t\t}\n\t}\n\n\tsetDisplayedOptionsRulesActions() {\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif (this.model.productRulesActions.hideOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, true);\n\t\t\t\tthis.options[i].hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t\tthis.options[i].hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': true});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': true});\n\t\t\t}\n\t\t\tif (this.isClickSelection && this.model.productRulesActions.selectOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.selected`, true);\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\t// remove items from array list, as with 'Add' features we are mutating the array during iteration\n\t\t\tif (this.model.productRulesActions.deselectOptions[this.options[i].record.Id]) {\n\t\t\t\tif (this.isClickSelection) {\n\t\t\t\t\tthis.set(`options.${i}.selected`, false);\n\t\t\t\t\tthis.fireOptionChangedByRule(false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteOption(this.options[i].record.Id, i);\n\t\t\t\t\tif (this.options[i] === undefined) return;\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfireOptionChangedByRule(added) {\n\t\tif (this.viewport && !this.viewport.isMobile())\n\t\t\treturn;\n\n\t\tthis.fire('option-changed-by-rule', {\n\t\t\tadded: added\n\t\t});\n\t}\n\n\t_firePriceRules() {\n\t\tlet optionDataByOptionIdAndIndex = this.model.optionDataByOptionIdAndIndex;\n\t\tlet options = this.options;\n\n\t\tif (options != null) {\n\t\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\t\tlet optionId = options[i].optionId || options[i].record.Id;\n\t\t\t\tlet index = options[i].index;\n\n\t\t\t\tif(optionDataByOptionIdAndIndex[optionId] && optionDataByOptionIdAndIndex[optionId][index] != null) {\n\t\t\t\t\tlet priceActions = this._getPriceActions(options[i], optionId, index);\n\n\t\t\t\t\tfor(let priceAction in priceActions) {\n\t\t\t\t\t\tif(priceActions.hasOwnProperty(priceAction)) {\n\t\t\t\t\t\t\tthis.set(['options', i, 'record', priceAction], priceActions[priceAction]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_getPriceActions(option, optionId, index) {\n\t\tlet priceActions = {};\n\t\tlet optionData = this.model.optionDataByOptionIdAndIndex[optionId][index].optionData;\n\n\t\tfor(let priceAction in optionData) {\n\t\t\tif(optionData.hasOwnProperty(priceAction) && priceAction != 'attributes') {\n\t\t\t\tif(option.record[priceAction] != optionData[priceAction]) {\n\t\t\t\t\tpriceActions[priceAction] = optionData[priceAction];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._calculateUnitPrice(priceActions, optionData);\n\n\t\treturn priceActions;\n\t}\n\n\t/**\n\t * We trust the optionData.unitPrice from ProductConfigurationVO.calculate\n\t * @param priceActions\n\t * @param optionData\n\t * @returns {*}\n\t * @private\n\t */\n\t_calculateUnitPrice(priceActions, optionData) {\n\t\tlet prefix = this.getPrefix();\n\t\tconst unitPriceField = prefix + 'UnitPrice__c';\n\t\tif (optionData[unitPriceField] === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn priceActions[unitPriceField] = optionData[unitPriceField];\n\t}\n\n\tsetUpgradeOptionClass() {\n\t\tPolymer.dom(this.$.tbody).observeNodes(function () {\n\t\t\tlet upgradeOptions = Polymer.dom(this.$.tbody).node.querySelectorAll('#row[hidden]');\n\n\t\t\tfor(let i = 0; i < upgradeOptions.length; i++) {\n\t\t\t\tif (upgradeOptions[i].rowData.isUpgrade)\n\t\t\t\t\tthis.toggleClass('upgradeOption', true, upgradeOptions[i]);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\ttoggleUpgradeOptions() {\n\t\tlet options = this.options;\n\t\tthis.showUpgradeOptions = !this.showUpgradeOptions;\n\n\t\tif(this.showUpgradeOptions) {\n\t\t\tthis.upgradeOptionButtonText = 'Hide Available Upgrades';\n\t\t} else {\n\t\t\tthis.upgradeOptionButtonText = 'Show Available Upgrades';\n\t\t}\n\n\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\tif (options[i].isUpgrade === true) {\n\t\t\t\tif(this.showUpgradeOptions) {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_showOrHideAddOptionsButtonObserver (model, featureId, isClickSelection) {\n\t\tif (model === undefined || featureId === undefined || isClickSelection === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.showOrHideAddOptionsButton(model, featureId, isClickSelection);\n\t}\n\t\n\tshowOrHideAddOptionsButton() {\n\t\tthis.showAddOptionsButton = !this.isClickSelection && !this.model.maxOptionsMet(this.model.getFeature(this.featureId));\n\t}\n\n\tgetPrefix() {\n\t\treturn this.model.prefix;\n\t}\n\n\t_setHasUpgradeOptionsObserver (hasUpgradeOptions, showAddOptionsButton) {\n\t\tif (hasUpgradeOptions === undefined || showAddOptionsButton === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.setHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton);\n\t}\n\t\n\tsetHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton) {\n\t\tthis.hasUpgradeOptions = hasUpgradeOptions && !showAddOptionsButton;\n\t}\n\n\t_setHeaderActions() {\n\t\tif(this.routeSource === 'OptionLookup' || this.options.length === 0 || !this.options[0]._transient_.rowActions) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.headerActions = JSON.parse(JSON.stringify(this.options[0]._transient_.rowActions));\n\n\t\t\tfor(let i = this.headerActions.length -1; i >= 0; i--) {\n\t\t\t\tthis.headerActions[i].invisible = true;\n\t\t\t}\n\n\t\t\tif(!this.isClickSelection) {\n\t\t\t\tthis.headerActions[0].hidden = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getDisplayStyle() {\n\t\t// We should make this in the Global Space, but Scott was too risk averse to making this global right at release freeze. This was a Safari specific bug\n\t\treturn this.productHasAttributeSet ? 'table-row' : 'table-row-group';\n\t}\n\n\t_showUpgradeOptionIfSelectionMethodAddObserver (options, isClickSelection) {\n\t\tif (options === undefined || isClickSelection === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._showUpgradeOptionIfSelectionMethodAdd(options, isClickSelection);\n\t}\n\t\n\t// Method needed since upgrade options are hidden on load by default\n\t_showUpgradeOptionIfSelectionMethodAdd() {\n\t\tif(this.isClickSelection) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif(this.options[i].isUpgrade) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\thasAttributeItems(option) {\n\t\treturn (!this._isMobile() && this.model.getFeature(this.featureId).optionSelectionMethod !== 'Add' && option &&\n\t\t\toption._transient_ && option._transient_.attributeItems && Object.keys(option._transient_.attributeItems).length > 0) || false;\n\t}\n}\n\nPolymer(ProductOptionTable);\n","import {Page} from 'common/core/Page.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\n\nexport class DynamicLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dynamic-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tquote: Object,\n\t\t\tmodel: Object,\n\t\t\tfeature: Object,\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\tdefaultFilters: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\t// errors for services\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t// errors for sb-toast\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasInstructions(feature)'\n\t\t\t},\n\t\t\tvalidationMessages: Array\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelChanged(searchModel)'\n\t\t];\n\t}\n\n\tsearchModelChanged() {\n\t\tthis.deSelectAll();\n\t}\n\n\tready() {\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t\tthis.handleOptionConfiguratorResponse();\n\t}\n\n\tcancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tadd() {\n\t\tif (Object.keys(this.selectedProducts).length === 0) {\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tlet featureOptionIds = [];\n\t\tfor (let key in this.selectedProducts) {\n\t\t\tfeatureOptionIds.push(this.ctx.params.fId + ':' + key);\n\t\t}\n\t\tconst exceededNumber = this.validateMaximumOptionsNotExceeded(featureOptionIds.length);\n\t\tthis.validationMessages = [];\n\t\tif (exceededNumber > 0) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.\", [exceededNumber, this.feature.record[this.prefix + 'MaxOptionCount__c']])];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$.productLoader.featureOptionIds = featureOptionIds;\n\t\tthis.$.productLoader.ignoreCache = true;\n\t}\n\n\tconvertProductsToOptions (results) {\n\t\tfor (let key in results) {\n\t\t\tvar option = results[key];\n\t\t\toption.record[this.prefix + 'UnitPrice__c'] = this.selectedProducts[key].record.UnitPrice;\n\t\t\toption.isDynamicOption = true;\n\t\t\tthis.push('product.options', option);\n\t\t\tthis.push('feature._transient_.optionConfigurations', option);\n\t\t}\n\t\t//the last option will apply it's record values to any configuration attributes for the original bundle\n\t\tthis.syncConfigurationAttributesToProduct(option);\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tsyncConfigurationAttributesToProduct(product) {\n\t\t// 1: build a key map for any configuration attribute that has auto select set to true\n\t\t// 2: loop through those attributes and set the value to the value of the product record field value\n\t\tif(this.autoSelectAttributes === undefined) {\n\t\t\tthis.autoSelectAttributes = {};\n\t\t\tfor (let attribute of this.product.configurationAttributes)\n\t\t\t\tif (attribute.autoSelect === true && this.autoSelectAttributes[attribute.targetFieldName] === undefined)\n\t\t\t\t\tthis.autoSelectAttributes[attribute.targetFieldName] = true; //just storing keys\n\t\t}\n\n\t\tfor(let attribute in this.autoSelectAttributes)\n\t\t\tthis.product.configuration.configurationData[attribute] = product.record[attribute];\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.model.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'dl'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.$.productLoader.productIds = this.productIds;\n\t\t\tthis.$.productLoader.quote = this.$.optionConfigure.quote = this.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\n\t\tthis.$.productLoader.addEventListener('product-load-model-changed', function (e) {\n\t\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\t\treturn this.convertProductsToOptions(e.detail.value);\n\t\t\tlet product = this.ctx.params.productIdx ? e.detail.value.configuredProducts[this.ctx.params.productIdx] : e.detail.value.configuredProducts[0];\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.$.optionConfigure.product = product;\n\n\t\t\tthis.setCurrentProductModel(product);\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\t\t\tlet layoutFieldSet = this.product.productFieldSets[this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c']];\n\t\t\tif (layoutFieldSet)\n\t\t\t\tsearchModel.resultFieldNames = layoutFieldSet;\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.';\n\t\t\tthis.searchModel = searchModel;\n\t\t\tthis.buildDelegator();\n\t\t}.bind(this));\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) { //possibly just listen to service change\n\t\t\tthis.setCurrentProductModel(e.detail.value.configuredProducts[0]);\n\t\t}.bind(this));\n\t}\n\n\tsetCurrentProductModel(product) {\n\t\tthis.product = product;\n\t\tthis.model = new ProductViewModel(this.quote.record.Id, product, this.app.org.prefix, this.isoCode, this.ctx.params.fId);\n\t\tthis.feature = this.model.getFeature(this.ctx.params.fId);\n\t\tif (this.feature === undefined) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Attempted to access a feature not associated with this bundle.\")];\n\t\t\treturn;\n\t\t}\n\t\tlet filters = [];\n\t\tlet filtersLoaded = false;\n\t\tif (this.feature.searchFilters) {\n\t\t\tif (this.defaultFilters[this.feature.record.Id] != null)\n\t\t\t\tfiltersLoaded = true;\n\t\t\telse\n\t\t\t\tthis.defaultFilters[this.feature.record.Id] = [];\n\t\t\tfor (let searchFilter of this.feature.searchFilters) {\n\t\t\t\tif (searchFilter.valueObject != null)\n\t\t\t\t\tsearchFilter.stringValue = this.getStringValue(searchFilter);\n\t\t\t\tfilters.push(JSON.stringify(searchFilter));\n\t\t\t\tif (!filtersLoaded)\n\t\t\t\t\tthis.defaultFilters[this.feature.record.Id].push(searchFilter);\n\t\t\t}\n\t\t}\n\t\tthis.$.smLoadService.filters = filters;\n\t\tthis.$.smLoadService.fieldSet = this.feature.record[this.prefix + 'DynamicProductFilterFieldSet__c'];\n\t\tthis.$.smLoadService.quote = this.quote;\n\t}\n\n\tbuildDelegator() {\n\t\tlet searcher = new Searcher(this.searchModel);\n\t\tsearcher.dynamicSearchFilters = this.defaultFilters[this.feature.record.Id] ? this.defaultFilters[this.feature.record.Id] : [];\n\t\tsearcher.fieldSet = this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c'];\n\t\tthis.searcher = searcher;\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.panelHeader = 'Product Filter';\n\t\tthis.$.drawer.togglePanel();\n\t\tthis.refocus();\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus() {\n\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clearfilter.focus();\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blurred so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let selectedProductId of orderedSelectedProductIds)\n\t\t\torderedSelectedProducts.push(this.selectedProducts[selectedProductId]);\n\t\treturn orderedSelectedProducts;\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.selected === 'main') {\n\t\t\tfireEvent(Events.PANEL_CLOSED);\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tgetStringValue(filter) {\n\t\tif (filter.valueObject === 'Product')\n\t\t\treturn this.product.record[filter.valueField];\n\t\telse if (filter.valueObject === 'Quote')\n\t\t\treturn this.quote.record[filter.valueField];\n\t\telse if (filter.valueObject === 'Configuration Attributes')\n\t\t\treturn this.product.configuration.configurationData[filter.valueField];\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = formatError(this.errors);\n\t\tthis.spinner = false;\n\t}\n\n\tsetHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n\n\tvalidateMaximumOptionsNotExceeded(optionsSelected) {\n\t\treturn this.feature._transient_.optionConfigurations.length + optionsSelected - this.feature.record[this.prefix + 'MaxOptionCount__c'];\n\t}\n}\n\nPolymer(DynamicLookup);\n","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\n\nexport class OptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\ttopLevelBundle: Object, // ConfiguredProduct\n\t\t\tcurrentProductModel: Object, //ProductViewModel\n\t\t\tfeature: Object,\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\toptionConstraintsHandler: Object, //OptionConstraintsHandler\n\t\t\theaderSubtitle: String,\n\t\t\tselectedOptions: Object,\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasUpgradeOptions(feature)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tvalidationMessages: Array,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis._handleLineEditorModelResponse();\n\t\tthis._handleProductLoadResponse();\n\t\tthis.handleOptionConfiguratorResponse();\n\t\tthis.addEventListener('selection-changed', this._handleOptionSelection);\n\t}\n\n\t/**\n\t * Select options and go to next page, either productConfig or stay on optionLookup\n\t */\n\t_selectAndAdd() {\n\t\tthis.validationMessages = [];\n\t\tconst exceededNumber = this._validateMaximumOptionsNotExceeded();\n\t\tif (exceededNumber > 0) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.\", [exceededNumber, this.feature.record[this.prefix + 'MaxOptionCount__c']])];\n\t\t\treturn;\n\t\t}\n\t\tthis._addSelected();\n\t}\n\n\tadd() {\n\t\tthis._selectAndAdd( false );\n\t\tthis._routeToConfig();\n\t}\n\n\t/** Button handler for \"Select & Add More\" */\n\taddMore() {\n\t\tthis._selectAndAdd();\n\t\tthis._resetPage();\n\t}\n\n\tcancel() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tthis.currentProductModel.optionsById[key].added = false;\n\t\t\tthis.currentProductModel.optionsById[key].selected = false;\n\t\t}\n\t\tthis._routeToConfig();\n\t}\n\n\t_handleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.$.productLoad.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\t}\n\n\t_handleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tlet products = e.detail && e.detail.value ? e.detail.value.configuredProducts : null,\n\t\t\t\tidx = this.ctx.params && this.ctx.params.productIdx ? this.ctx.params.productIdx : 0,\n\t\t\t\tproduct = products ? products[idx] : e.detail.value;\n\t\t\tif (!product.rulesProcessed) {\n\t\t\t\tlet processor = new RuleProcessor(product.configuration, product);\n\t\t\t\tprocessor.initProductRulesActions(this.optionId === '' ? 'load' : 'reconfigure');\n\t\t\t}\n\t\t\tthis.topLevelBundle = product;\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.$.optionConfigure.product = product;\n\t\t\t// pass in fId and ONLY render map for fID;\n\t\t\tthis.setCurrentProductModel(product);\n\t\t}.bind(this));\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) { //possibly just listen to service change\n\t\t\tthis.setCurrentProductModel(e.detail.value.configuredProducts[0]);\n\t\t}.bind(this));\n\t}\n\n\tsetCurrentProductModel(product) {\n\t\tconst currencyIsoCode = product.currencyCode || null;\n\t\t// pass in fId and ONLY render map for fID;\n\t\tthis.currentProductModel = new ProductViewModel(this.$.productLoad.quote.record.Id, product, this.app.org.prefix, currencyIsoCode, this.ctx.params.fId);\n\t\tthis.feature = this.currentProductModel.getFeature(this.ctx.params.fId);\n\t\tif (this.feature === undefined) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Attempted to access a feature not associated with this bundle.\")];\n\t\t\treturn;\n\t\t}\n\t\tthis.selectedOptions = {};\n\t\tthis.optionConstraintsHandler = new OptionConstraintsHandler(this.currentProductModel.product, this.currentProductModel.prefix);\n\t\tthis.$.optionTable.fieldSetName = \"OptionLookup\";\n\t\tthis.$.optionTable.fieldSet = this.currentProductModel.product.optionFieldSets[this.$.optionTable.fieldSetName];\n\t\tthis.$.optionTable.displayDelete = false;\n\t\tthis._createConstraintsHoverMessages();\n\t\tthis._fireSelectionStatesForOtherFeatures();\n\t}\n\n\t_handleOptionSelection(e) {\n\t\tif (e && e.detail) {\n\t\t\tthis._toggleOptionSelection(e.detail.Id, e.detail.selected);\n\t\t\tthis._handleOptionConstraints(e.detail.Id, e.detail.selected);\n\t\t}\n\t}\n\n\t_fireSelectionStatesForOtherFeatures() {\n\t\tfor (let featureId of Object.keys(this.currentProductModel.featureIdsWithSelectionMethodClick)) {\n\t\t\tfor (let option of this.currentProductModel.optionsByFeatureId[featureId])\n\t\t\t\tthis._handleOptionConstraints(option.record.Id, option.selected);\n\t\t}\n\t}\n\n\t/**\n\t * Resets the page to start over\n\t * @private\n\t */\n\t_resetPage() {\n\t\tthis.selectedOptions = {};\n\t\tthis.$.optionTable.deselectOptionsOnOptionLookup();\n\t\tthis._fireSelectionStatesForOtherFeatures();\n\t}\n\n\t_toggleOptionSelection(optionId, selected) {\n\t\tif (!selected && this.selectedOptions[optionId]) {\n\t\t\tdelete this.selectedOptions[optionId];\n\t\t} else if (selected && !this.selectedOptions[optionId]) {\n\t\t\tthis.selectedOptions[optionId] = this.currentProductModel.getOption(optionId);\n\t\t}\n\t}\n\n\t_handleOptionConstraints(optionId, selected) {\n\t\tlet addedOption = this.feature._transient_.optionConfigurations.find(function(option) { return option.record.Id === optionId }),\n\t\t\tpreviouslySelected = addedOption && addedOption.selected,\n\t\t\tdisabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected || previouslySelected);\n\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\t_addSelected() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tlet clonedOption = JSON.parse(JSON.stringify(this.currentProductModel.optionsById[key]));\n\t\t\tthis.currentProductModel.initOptionActions(clonedOption, true);\n\t\t\tclonedOption.addedManually = true; //differentiates copies of required options from originally added options\n\t\t\tclonedOption.index = this.feature._transient_.optionConfigurations.filter( option => { return option.record.Id === key; }).length;\n\t\t\tclonedOption.configured = false;\n\t\t\tthis.currentProductModel.setOptionDisabledData(clonedOption);\n\t\t\tthis.push('feature._transient_.optionConfigurations', clonedOption);\n\t\t\tthis.currentProductModel.optionsById[key].added = true;\n\t\t\tthis.currentProductModel.optionsById[key].selected = true;\n\t\t}\n\t}\n\n\t_validateMaximumOptionsNotExceeded() {\n\t\treturn (this.feature._transient_.optionConfigurations.length + Object.keys(this.selectedOptions).length) - this.feature.record[this.prefix + 'MaxOptionCount__c'];\n\t}\n\n\t/**\n\t * Navigate to the Configurator page in the UI workflow (either productConfig or optionLookup)\n\t */\n\t_routeToConfig() {\n\t\tthis.selectedOptions = {};\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.currentProductModel ? this.currentProductModel.qId : this.ctx.params.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'ol'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif(params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.optionLookupObjects = [this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tsetHasUpgradeOptions() {\n\t\treturn this.currentProductModel.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_createConstraintsHoverMessages() {\n\t\tthis.currentProductModel.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = formatError(this.errors);\n\t\tthis.spinner = false;\n\t}\n}\n\nPolymer(OptionLookup);\n","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductReconfigurer} from 'products/resources/reconfigure/ProductReconfigurer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {NestedOptionsModel} from '../../../resources/model/nestedOptions/NestedOptionsModel.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {AppContext} from 'common/core/AppContext.js';\nconst CONFIGURATION_ERROR = 'ConfigurationError';\n\nexport class ProductConfig extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-config';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlineEditorModel: Object,\n\t\t\tproductSelectionModel: Object,\n\t\t\ttopLevelBundle: Object,\n\t\t\tcurrentTarget: Object,\n\t\t\tproductIndex: Number,\n\t\t\theaderSubtitle: String, // from LineEditorModel, should be Quote Number\n\t\t\thasMultipleBundles: Boolean,\n\t\t\tisClassic: Boolean,\n\t\t\tsearchValuesByFilter: Object,\n\t\t\tsearchFilters: Array,\n\t\t\tvalidationMessages: Array,\n\t\t\theaderTitle: String,\n\t\t\tisMobileAndHasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles)\"\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getGroupKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpreventPreLoadObjects: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\n\n\tready() {\n\t\tthis.handleLineEditorModelResponse();\n\t\tthis.handleProductLoadResponse();\n\t\tthis.handleOptionSaveResponse();\n\t\tthis.handleProductRulesInvokerResponse();\n\t\tthis.handleCustomActionsCollapsed();\n\t\tthis.handleOnAddOptionClick();\n\t\tthis.handleBundlePanelClick();\n\t\tthis.handleChangeEvents();\n\t\tthis.handleApplyEditRulesAction();\n\t\tthis.handleBundleNameChange();\n\t\tthis.handleExternalConfiguration();\n\t\tthis.handleConfigureOptionEvent();\n\t\tthis.handleOptionConfiguratorResponse();\n\t}\n\n\tattached() {\n\t\tif(!this.preventPreLoadObjects)\n\t\t\tthis.preLoadObjects();\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.$.optionSave.stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\t\tthis.$.optionSave.stripLinesMessage = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tthis.$.productLoad.quote = this.$.optionSave.quote = this.$.productRulesInvoke.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\t}\n\n\thandleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tif (e.detail.value && !e.detail.value.returnToQuote && e.detail.value.configuredProducts === undefined) {\n\t\t\t\t// if we aren't loading a productLoadModel, we are handling the response of dynamic option loader as a result of an external configuration\n\t\t\t\tthis._handleExternalDynamicOptionsResponse(e.detail.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet model = this.handleProductConfigurationInitializer(e.detail.value);\n\t\t\t// If a user enters the Configurator by reconfiguring a quote line, and that line has not been saved in a quote, we have to return the\n\t\t\t// user to the QLE. We do not cache the unsaved quote line, so it would error out.\n\t\t\tif (model.returnToQuote) {\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', {qId: this.lineEditorModel.quote.record.Id }, ['quote', 'le'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [model.returnToQuote];\n\t\t\t}\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.setOptionConfigurationDetails(model);\n\t\t\tif (this.loadedModelIsReconfigure(model)) {\n\t\t\t\tconst product = model.configuredProducts[0];\n\t\t\t\tproduct.quoteType = this.lineEditorModel.quote.record[this.prefix + 'Type__c'];\n\t\t\t\tnew ProductReconfigurer().reconfigure(product);\n\t\t\t\tthis.addAttributeSetFromServerProductVO(model.configuredProducts[0]);\n\t\t\t}\n\t\t\tfor (let prod of model.configuredProducts) {\n\t\t\t\tif (!prod.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(prod.configuration, prod);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\t\t\t\tif (model.attributeSet != null && Object.keys(model.attributeSet.attributeItemIdsByOptionId).length > 0) {\n\t\t\t\t\tprod._transient_ = prod._transient_ || {};\n\t\t\t\t\tprod._transient_.attributeSet = model.attributeSet;\n\t\t\t\t}\n\t\t\t\tif (prod.configuration != null && prod.nestedOptionModel == null) {\n\t\t\t\t\tprod.nestedOptionModel = new NestedOptionsModel(prod.configuration);\n\t\t\t\t}\n\t\t\t\tprod.configuration.configuredOptions = prod.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t}\n\t\t\tthis.productSelectionModel = undefined;\n\t\t\tthis.productSelectionModel = model;\n\t\t\tthis.hasMultipleBundles = (this.productSelectionModel.configuredProducts.length > 1);\n\t\t\tthis.isClassic = (this.hasMultipleBundles && this.lineEditorModel.settings.multipleBundlesView === 'Classic');\n\t\t\tthis.currentTarget = this.productSelectionModel;\n\t\t\t//initialize option configurations for all products\n\t\t\tfor (let i = 0; i < this.productSelectionModel.configuredProducts.length; i++)\n\t\t\t\tthis.productIndex = i;\n\t\t\tthis.productIndex = this.getProductIndex();\n\t\t\t//remove invalid fields from the search filter field set\n\t\t\tthis.searchFilters = this.productSelectionModel.configuredProducts[0].optionFieldSets.SearchFilters;\n\t\t\tlet filterMap = {};\n\t\t\tif (this.searchFilters && !this.productSelectionModel.searchValuesByFilter) {\n\t\t\t\tfor (let i = 0, numFilters = this.searchFilters.length; i < numFilters; i++) {\n\t\t\t\t\tfilterMap[this.searchFilters[i]] = null;\n\t\t\t\t}\n\t\t\t\t//filter keymap added to PSM to persist across bundles\n\t\t\t\tthis.productSelectionModel.searchValuesByFilter = filterMap;\n\t\t\t}\n\t\t\tthis.$.bundles.searchValuesByFilter = this.productSelectionModel.searchValuesByFilter;\n\t\t\tthis.$.bundles.searchFilters = this.searchFilters;\n\t\t\t//must do this after all data is set\n\t\t\tthis.checkForExternalConfiguration();\n\t\t}.bind(this));\n\t}\n\n\thandleOptionSaveResponse() {\n\t\tthis.$.optionSave.addEventListener('psm-response-changed', function (e) {\n\t\t\tthis.validationMessages = null;\n\t\t\tlet response = e.detail.value;\n\t\t\tlet ruleProcessor = new RuleProcessor(response, this.topLevelBundle);\n\t\t\truleProcessor.initValidationMessages();\n\t\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\t\t\tif (this.validationMessages.length > 0) {\n\t\t\t\tthis.spinner = false;\n\t\t\t\tif (this.optionId !== '')\n\t\t\t\t\tthis.topLevelBundle.nestedOptionModel.removeClonedConfiguration();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//check for product alert rules\n\t\t\tif (response.guidedMessages && response.guidedMessages.length > 0) {\n\t\t\t\tthis.$.productAlerts.cancelCB = () => {\n\t\t\t\t\tif (this.optionId !== '')\n\t\t\t\t\t\tthis.topLevelBundle.nestedOptionModel.removeClonedConfiguration();\n\t\t\t\t};\n\t\t\t\tthis.$.productAlerts.displayContinueButton = true;\n\t\t\t\tthis.$.productAlerts.continueCB = () => {\n\t\t\t\t\tif (this.optionId !== '')\n\t\t\t\t\t\tthis.topLevelBundle.nestedOptionModel.swapConfiguration(response);\n\t\t\t\t\tthis.afterSaveNavigate(response, ruleProcessor);\n\t\t\t\t};\n\t\t\t\tthis.spinner = false;\n\t\t\t\tthis.$.productAlerts.alerts = response.guidedMessages;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\tthis.topLevelBundle.nestedOptionModel.swapConfiguration(response);\n\n\t\t\t// no validation or alert rules encountered, so lets complete our after save navigation\n\t\t\tthis.afterSaveNavigate(response, ruleProcessor);\n\t\t}.bind(this));\n\t}\n\n\tafterSaveNavigate(response, ruleProcessor) {\n\t\tlet optionId = 'none',\n\t\t\ttabIndex;\n\t\tif (this.optionId !== '') {\n\t\t\tlet latestData = this.topLevelBundle.nestedOptionModel.getLastFromPath();\n\t\t\ttabIndex = latestData.tabIndex;\n\t\t\toptionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU() || 'none';\n\t\t\truleProcessor.initDescendantTree();\n\t\t}\n\t\tlet redirectUrl = this.ctx.params ? this.ctx.params.redirectUrl : null,\n\t\t\tpathParams = this.createPathParams(redirectUrl),\n\t\t\tqueryParams;\n\n\t\tif(this.optionId !== '')\n\t\t\tqueryParams = this.createQueryParams({ oId: optionId, ignoreCache: false, jspr: true }, tabIndex);\n\t\telse {\n\t\t\tqueryParams = {qId: response.quote.record.Id};\n\t\t\tif(this.ctx.params.groupKey != null)\n\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\tif(this.ctx.params.aId && pathParams[0] !== 'quote')\n\t\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\t}\n\n\t\tif (response.quote)\n\t\t\tthis.lineEditorModel.quote = response.quote;\n\t\tthis.nav('#', queryParams, pathParams, false);\n\t}\n\n\thandleProductRulesInvokerResponse() {\n\t\tthis.$.productRulesInvoke.addEventListener('config-response-changed', this._processProductRulesInvokerResponse.bind(this));\n\t}\n\n\t/**\n\t * Given an event object, this method processes a server response from the\n\t * ProductRulesInvoker endpoint and changes client state based on the results\n\t *\n\t * @param {HTMLEvent} e - the event object fired from the productRulesInvoke\n\t * service.\n\t */\n\t_processProductRulesInvokerResponse(e) {\n\t\tlet response = e.detail.value;\n\t\tlet productIndex = this.currentTarget.configuredProducts.findIndex( product => {\n\t\t\t// in case of cloned object use the productKey instead of id\n\t\t\t// (unless no key then use the id)\n\t\t\tlet productKey = product.productKey || product.record.Id;\n\t\t\treturn productKey === response.configuredProductKey;\n\t\t});\n\t\tlet currentProduct = this.currentTarget.configuredProducts[productIndex];\n\t\tlet ruleProcessor = new RuleProcessor(response, currentProduct);\n\t\truleProcessor.init(this.topLevelBundle !== undefined ? this.topLevelBundle.nestedOptionModel : currentProduct.nestedOptionModel);\n\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\n\t\t// W-3652536: response from the server does not have the updated\n\t\t// configuration attribute values always using the\n\t\t// configuration.configurationData values from the client\n\t\tif(currentProduct.configuration !== undefined && currentProduct.configuration.configurationData !== undefined)\n\t\t\tresponse.configurationData = currentProduct.configuration.configurationData;\n\n\t\tcurrentProduct.configuration = this._setHiddenAndDisabledOptionIds(currentProduct.configuration, response.hiddenOptionIds, response.disabledOptionIds);\n\n\t\tthis.$.bundles.set(`configuredProducts.${productIndex}.configuration.productRulesActions`, ruleProcessor.getProductRulesActions()); //apply product rules\n\t\tthis.$.bundles.set(`configuredProducts.${productIndex}.configuration.optionDataByOptionIdAndIndex`, ruleProcessor.getOptionDataByOptionIdAndIndex()); //apply price rules\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.spinner = false;\n\t\t});\n\t}\n\n\t/**\n\t * W-5908780 - We sync the hidden/disabled option IDs returned from the\n\t * server with the client-side product configuration object to maintain\n\t * hide/show and enabled/disabled state upon entering configuration.\n\t *\n\t * @param {Object} configuration - the Product's configuration object.\n\t * @param {Array} hiddenOptionIds - an array of hidden product option IDs\n\t * returned from the server product rules.\n\t * @param {Array} disabledOptionIds - an array of disabled product option IDs\n\t * returned from the server product rules.\n\t *\n\t * @returns a configuration object with the hidden and disabled option ID\n\t * arrays updated.\n\t */\n\t_setHiddenAndDisabledOptionIds(configuration, hiddenOptionIds, disabledOptionIds) {\n\t\tconfiguration.hiddenOptionIds = hiddenOptionIds;\n\t\tconfiguration.disabledOptionIds = disabledOptionIds;\n\t\treturn configuration;\n\t}\n\n\thandleCustomActionsCollapsed() {\n\t\tthis.changeAllActions(this.$.customActions.buttonsCollapsed);\n\t\tthis.$.customActions.addEventListener('buttons-collapsed-changed', function (e) {\n\t\t\tlet val = e.detail.value;\n\t\t\tthis.changeAllActions(val);\n\t\t}.bind(this));\n\t}\n\n\thandleOnAddOptionClick() {\n\t\tlet tabIndex;\n\t\t// Must have the most up to date tabIndex so the proper feature gets updated.\n\t\tthis.addEventListener('selected-page-changed', function (e) {\n\t\t\ttabIndex = e.detail;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('add-option-clicked', function (e) {\n\t\t\tlet query = this.optionId === '' ? e.detail : Object.assign({}, e.detail, { oId: this.optionId });\n\t\t\tlet index;\n\t\t\t// Whenever we drill into a nested bundle, we only focus on the single product we drill into. We do not need the product selection model\n\t\t\t// context anymore, which represents the multiple bundles that were selected from Product Lookup.\n\t\t\tif (this.optionId === '')\n\t\t\t\tindex = this.getProductIndex(e.detail.pId);\n\t\t\tlet queryParams = this.createQueryParams(query, tabIndex),\n\t\t\t\tpath = query.path != null ? query.path : ['product', 'ol'];\n\t\t\tif (index !== undefined)\n\t\t\t\tqueryParams.productIdx = index;\n\t\t\tthis.nav('#', queryParams, path, false);\n\t\t}.bind(this));\n\t}\n\n\thandleBundlePanelClick() {\n\t\tthis.addEventListener('bundle-panel-clicked', this.navToBundle);\n\t}\n\n\tnavToBundle(e) {\n\t\tlet queryParams = (this.createQueryParams(this.ctx.params));\n\t\tqueryParams.productIdx = e.detail;\n\t\tqueryParams.open = 1;\n\t\tif (queryParams.tab)\n\t\t\tdelete queryParams.tab;\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\thandleChangeEvents() {\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Selection');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-quantity-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Quantity Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-config-attribute-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Attribute Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-option-deleted', function(e) {\n\t\t\tlet prod = this.topLevelBundle || this.productSelectionModel.configuredProducts[this.productIndex];\n\t\t\tif (prod.nestedOptionModel)\n\t\t\t\tprod.nestedOptionModel.removeAddedOption(e.detail);\n\t\t}.bind(this));\n\t}\n\n\thandleApplyEditRulesAction() {\n\t\tthis.addEventListener('sb-apply-edit-rules', function(e) {\n\t\t\tlet product = this.getProductById(e.detail.bundleId);\n\t\t\tthis.handleApplyImmediatelyProductRules(product, e.detail, 'On Apply Rules');\n\t\t});\n\t}\n\n\thandleBundleNameChange() {\n\t\tif (!this.isMobileViewport()) {\n\t\t\tthis.headerTitle = this.i18n.l('Configure Products');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addEventListener('bundle-name-changed', function(e) {\n\t\t\tthis.headerTitle = e.detail.name;\n\t\t}.bind(this));\n\t}\n\n\thandleExternalConfiguration() {\n\t\tthis.addEventListener('sb-close-popup', function(e) {\n\t\t\tif (e.detail.dynamicOptions && e.detail.dynamicOptions.length > 0 && e.detail.featureOptionIds) {\n\t\t\t\tthis._handleExternalDynamicOptions(e.detail);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!e.detail.redirect)\n\t\t\t\treturn null;\n\n\t\t\tif (this.productSelectionModel.configuredProducts.length === 1) { // If only configuring one bundle...\n\t\t\t\tif (!e.detail.redirect.auto) // ...and auto-launch is false...\n\t\t\t\t\treturn null; // drop the popup and show the configurator.\n\t\t\t\telse if (e.detail.redirect.save) // ...and we are saving either an auto-launched page\n\t\t\t\t\tthis.save(); // save the bundle to the QLE\n\t\t\t\telse // ...and we are not saving the configuration\n\t\t\t\t\tthis.cancel(); // route back to previous page\n\t\t\t} else { // If configuring multiple bundles...\n\t\t\t\tconst thirdPartyConfigurator = this.lineEditorModel.settings.thirdPartyConfigurator;\n\t\t\t\tif (thirdPartyConfigurator && e.detail.redirect.save) { // ...and we are saving a back-on-close configuration...\n\t\t\t\t\tif (this.productIndex === this.productSelectionModel.configuredProducts.length - 1)  // ...and this bundle is the last bundle...\n\t\t\t\t\t\tthis.save(); // ...save the bundles to the QLE\n\t\t\t\t\telse // ...and this bundle is not the last bundle...\n\t\t\t\t\t\tthis.navToBundle({detail: this.productIndex + 1}); // ...iterate to the next bundle\n\t\t\t\t} else if (thirdPartyConfigurator) { // ...and we are not saving a back-on-close configuration...\n\t\t\t\t\tthis.cancel(); // ...navigate to the previous page\n\t\t\t\t} else { // ...and we do not have a back-on-close configuration...\n\t\t\t\t\treturn null; // drop the popup and show the configurator\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Given a ProductSearchModel object, this method applies default and pre-set\n\t * product configurations set by a Product Configuration Initializer XML file\n\t * in a Quote Process to the client-side product option state. If the default\n\t * configuration values differ from the current Product Options, the default\n\t * values overwrite the current option configurations. This will only\n\t * initialize Product Options once on load of the configurator.\n\t *\n\t * @param {Object} model - the ProductSearchModel object containing product\n\t * options and configuration values.\n\t *\n\t * @returns the ProductSearchModel with initial configuration values copied\n\t * over to the product options.\n\t */\n\thandleProductConfigurationInitializer(model) {\n\t\tif (this.isReconfigure(model))\n\t\t\treturn model;\n\n\t\tif (model.hasInitializedProductConfiguration)\n\t\t\treturn model;\n\n\t\t// Applies changes made to the data model from Quote Process record's Product Configuration Initializer\n\t\tfor (let c_product of model.configuredProducts) {\n\t\t\tlet configuration = c_product.configuration; //PCI changes are reflect in this object\n\t\t\tfor (let o_config of configuration.optionConfigurations) {\n\t\t\t\tlet optionId = o_config.optionData.Id; //option ID of an option that has been affected by PCI\n\t\t\t\tfor (let option of c_product.options) {\n\t\t\t\t\tif (option.record.Id === optionId)\n\t\t\t\t\t\tfor (let data in o_config.optionData)\n\t\t\t\t\t\t\tif (option.record[data] !== undefined && option.record[data] != o_config.optionData[data])\n\t\t\t\t\t\t\t\toption.record[data] = o_config.optionData[data];\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tmodel.hasInitializedProductConfiguration = true;\n\t\treturn model;\n\t}\n\n\tsave() {\n\t\tif (this.configurationAttributesValid() === false) {\n\t\t\tthis.validationMessages = [this.i18n.l(this.lineEditorModel.customLabels.Configuration_Attribute_Error) + this.getConfigurationAttributeMissingFeaturesMessage()];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validationMessages = null;\n\t\tif (this.optionId !== '') {\n\t\t\tlet configuredProduct = this.prepareProductForServer(this.currentTarget.configuredProducts[0]);\n\t\t\tif (this.validationMessages)\n\t\t\t\treturn;\n\t\t\tthis.spinner = true;\n\t\t\tthis.$.optionSave.configuration = undefined; //makes certain the observer fires\n\t\t\treturn this.$.optionSave.configuration = configuredProduct.configuration;\n\t\t}\n\t\t// Two use cases here.\n\t\t// 1. \tIf reconfigure then selectedProducts map is nil and all products to save are configured products.\n\t\t// 2. \tIf initial configuration then the selectedProducts map is not empty, contains both configured products\n\t\t//\t\t& selected standard products, and its object values contain an index whose order needs to be maintained upon save.\n\t\tlet addedProducts = this.isReconfigure(this.productSelectionModel) ? this.getConfiguredProductsToSave() : this.getSelectedProductsToSave();\n\t\t// Do not return early when you call the addProducts function and find a validation message\n\t\t// it will mess up the product and give you an error when you configure an option\n\t\tif (this.validationMessages)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.$.optionSave.products = undefined; //makes certain the observer fires\n\t\tthis.$.optionSave.products = addedProducts;\n\t}\n\n\tcancel() {\n\t\tthis.spinner = true;\n\t\tif (this.optionId === '') {\n\t\t\tlet queryParams = {qId: this.lineEditorModel.quote.record.Id};\n\t\t\tif (this.ctx.params.groupKey != null)\n\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\treturn Navigator.back(this, queryParams, ['quote', 'le']);\n\t\t}\n\n\t\tthis.topLevelBundle.nestedOptionModel.cancel();\n\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfiguredProductsToSave() {\n\t\tlet productsToSave = [];\n\t\tthis.productSelectionModel.configuredProducts.forEach( product => {\n\t\t\tproductsToSave.push(this.prepareProductForServer(product))\n\t\t});\n\t\treturn productsToSave;\n\t}\n\n\tgetSelectedProductsToSave() {\n\t\tlet configuredProducts = this.productSelectionModel.configuredProducts;\n\t\tlet configuredProductsById = {};\n\n\t\t// create map of configured products by product Id taking into account that we could have more then one\n\t\t// reconfigured product per product Id if the product was cloned by a popup custom action\n\t\tfor(let configuredProduct of configuredProducts) {\n\t\t\tlet productToSave = this.prepareProductForServer(configuredProduct);\n\t\t\tlet productId = configuredProduct.record.Id;\n\t\t\tlet configuredProducts = configuredProductsById[productId];\n\t\t\tif (!configuredProducts)\n\t\t\t\tconfiguredProducts = [];\n\t\t\tconfiguredProducts.push(productToSave);\n\t\t\tconfiguredProductsById[productId] = configuredProducts;\n\t\t}\n\n\t\t// to preserve order, build an ordered selected product id array from the object using the values' index\n\t\tlet selectedProducts = this.productSelectionModel.selectedProducts;\n\t\tlet orderedSelectedProductIds = Object.keys(selectedProducts).sort(function(id1, id2) {\n\t\t\treturn selectedProducts[id1].index - selectedProducts[id2].index;\n\t\t});\n\n\t\t//loop through the ordered selectedProductIds array to build the ordered productToSave array\n\t\tlet productsToSave = [];\n\t\tfor(let selectedProductId of orderedSelectedProductIds) {\n\t\t\tlet selectedProduct = selectedProducts[selectedProductId];\n\t\t\tlet configuredProducts = configuredProductsById[selectedProductId];\n\t\t\tif(configuredProducts)\n\t\t\t\tproductsToSave = productsToSave.concat(configuredProducts);\n\t\t\telse if(!selectedProduct.invalid)\n\t\t\t\tproductsToSave.push(selectedProduct);\n\t\t}\n\t\treturn productsToSave;\n\t}\n\n\tcheckForExternalConfiguration() {\n\t\tlet product = this.productSelectionModel.configuredProducts[this.productIndex],\n\t\t\texternalKey = this.prefix + 'ExternallyConfigurable__c',\n\t\t\texternalURL = this.lineEditorModel.settings.externalConfiguratorUrl,\n\t\t\tthirdPartyConfigurator = this.lineEditorModel.settings.thirdPartyConfigurator;\n\n\t\tif (product.record[externalKey] && (!product.visitedExternal || thirdPartyConfigurator) && !this.isClassic && externalURL !== null) {\n\t\t\tproduct.visitedExternal = true;\n\t\t\tthis.$.customActions.handlePopup(externalURL, true, thirdPartyConfigurator);\n\t\t}\n\t}\n\n\t_handleExternalDynamicOptions(detail) {\n\t\tthis.$.productLoad.featureOptionIds = detail.featureOptionIds;\n\t\tthis.$.productLoad.ignoreCache = undefined;\n\t\tthis.$.productLoad.ignoreCache = true; // fires the listener on productLoad to load dynamicOptions\n\t\tif (!detail.redirect || !detail.redirect.auto)\n\t\t\treturn;\n\n\t\t// set properties that allow response handler to know to auto-redirect\n\t\tif (detail.redirect.save) this.redirectAfterOptionsAdded = 'save';\n\t\telse this.redirectAfterOptionsAdded = 'cancel';\n\t}\n\n\t_handleExternalDynamicOptionsResponse(response) {\n\t\tlet featureLayout = this.$.bundles.$$('#features');\n\t\t// delegate to featureLayout for handling response of external configurator\n\t\tfeatureLayout.handleDynamicOptionsAdded(response);\n\t\tif (this.redirectAfterOptionsAdded === undefined)\n\t\t\treturn;\n\n\t\tif (this.redirectAfterOptionsAdded === 'save') this.save();\n\t\telse this.cancel();\n\t}\n\n\thandleChangeEvent(e, eventContext) {\n\t\tif (e && e.detail && e.detail.bundleId && e.detail.changed && e.detail.path) {\n\t\t\tlet product = this.getProductById(e.detail.bundleId);\n\t\t\tthis.handleApplyImmediatelyProductRules(product, e.detail, eventContext);\n\t\t}\n\n\t\tif(eventContext === 'On Quantity Change') {\n\t\t\tthis.validationMessages = null;\n\t\t\tif(e.detail.invalidQuantity > 0) {\n\t\t\t\tlet errorMessage = this.i18n.l(this.lineEditorModel.customLabels.Maximum_Quantity_Error, [e.detail.validQuantity]);\n\t\t\t\tthis.validationMessages = [{\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\tmsg: errorMessage\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\thandleApplyImmediatelyProductRules(product, detail, eventContext) {\n\t\tif (!product || !this.isAppliedImmediately(product, detail, eventContext))\n\t\t\treturn;\n\n\t\tthis.spinner = true;\n\t\tthis.debounce('ApplyImmediatelyProductRules', function () {\n\t\t\tthis.$.productRulesInvoke.product = undefined;\n\t\t\tproduct = this.prepareProductForServer(product, true);\n\t\t\tthis.$.productRulesInvoke.upgradeAssetId = product.upgradedAssetId || null;\n\t\t\tthis.$.productRulesInvoke.product = product;\n\t\t}, 250);\n\t}\n\n\tisAppliedImmediately(product, detail, eventContext) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c',\n\t\t\tcontext = this.prefix + 'AppliedImmediatelyContext__c',\n\t\t\titem, applyImmediatelyContext;\n\n\t\tif (eventContext === 'On Apply Rules') {\n\t\t\treturn true;\n\t\t} else if (eventContext === 'On Attribute Change') {\n\t\t\titem = product.configurationAttributes.find( attribute => { return attribute.myId === detail.Id; });\n\t\t\treturn item.appliedImmediately;\n\t\t} else {\n\t\t\titem = product.options.find( option => { return option.record.Id === detail.Id; });\n\t\t\tapplyImmediatelyContext = item.record[context];\n\t\t\tif (applyImmediatelyContext === 'Always' || applyImmediatelyContext === eventContext || (applyImmediatelyContext === undefined && eventContext === 'On Selection'))\n\t\t\t\treturn item.record[appliedImmediately];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleConfigureOptionEvent() {\n\t\tthis.addEventListener('configure-option-tapped', function(e) {\n\t\t\tlet product = this.prepareProductForNestedConfigure(e.detail);\n\t\t\tlet queryParams = (this.createQueryParams({ oId: product.nestedOptionModel.getLastFromPath().optionalSKU, ignoreCache: false }, 0));\n\t\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t\t}.bind(this));\n\t}\n\n\tprepareProductForNestedConfigure(nested) {\n\t\tlet product;\n\t\tif (this.optionId === '') {\n\t\t\tlet index = this.productSelectionModel.currentIndex = this.getProductIndex(nested.productId);\n\t\t\tproduct = this.productSelectionModel.configuredProducts[index];\n\t\t} else {\n\t\t\tproduct = this.topLevelBundle;\n\t\t}\n\t\tproduct.nestedOptionModel = product.nestedOptionModel || new NestedOptionsModel();\n\t\tproduct.nestedOptionModel.addToPath(nested.optionId, nested.optionalSKU, nested.addedIndex, nested.tabIndex);\n\t\tproduct.nestedOptionModel.stagedOption = {\n\t\t\toptionData: nested.optionData,\n\t\t\tisDynamicOption: nested.isDynamicOption\n\t\t};\n\t\treturn product\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) {\n\t\t\tthis.currentTarget = e.detail.value;\n\t\t\tlet nestedProduct = this.currentTarget.configuredProducts[0];\n\n\t\t\tif (this.ctx.params.oId && nestedProduct.options.length == 0 && nestedProduct.configurationAttributes.length == 0 && !this.hasDynamicFeature(nestedProduct)) {\n\t\t\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\t\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\t\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', queryParams, ['product', 'pc'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [this.i18n.l(this.lineEditorModel.customLabels.msg_has_no_options_config)];\n\t\t\t} else {\n\t\t\t\tif (this.topLevelBundle.nestedOptionModel) {\n\t\t\t\t\tif (this.topLevelBundle.nestedOptionModel.descendLevel) {\n\t\t\t\t\t\tnestedProduct.configuration = this.topLevelBundle.nestedOptionModel.configure(nestedProduct.configuration);\n\t\t\t\t\t\tnestedProduct.quoteType = this.lineEditorModel.quote.record[this.prefix + 'Type__c'];\n\t\t\t\t\t\tnew ProductReconfigurer().reconfigure(nestedProduct, nestedProduct.configuration);\n\t\t\t\t\t\tif (this.ctx.params.tab)\n\t\t\t\t\t\t\tthis.ctx.params.tab = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnestedProduct.configuration = this.topLevelBundle.nestedOptionModel.getCurrentConfiguration();\n\t\t\t\t\t\tnestedProduct.configuration.configuredOptions = this.topLevelBundle.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!nestedProduct.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(nestedProduct.configuration, nestedProduct);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\n\t\t\t\tthis.addAttributeSetFromServerProductVO(nestedProduct); // Add attributeSet reference to nestedProduct._transient_\n\n\t\t\t\tlet filters = this.topLevelBundle.optionFieldSets.SearchFilters;\n\t\t\t\tlet searchValuesByFilter = {};\n\t\t\t\tfor (let filter of filters) {\n\t\t\t\t\tsearchValuesByFilter[filter] = null;\n\t\t\t\t}\n\t\t\t\tthis.productIndex = 0;\n\t\t\t\tthis.$.bundles.searchValuesByFilter = searchValuesByFilter;\n\t\t\t\tthis.$.bundles.searchFilters = filters;\n\t\t\t\tthis.$.bundles.set(`configuredProducts`, this.currentTarget.configuredProducts);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetProductById(id) {\n\t\treturn this.currentTarget.configuredProducts.find( product => {\n\t\t\t// product key is the unique identifier of a product if a cloned product\n\t\t\tlet productId = product.productKey || product.record.Id;\n\t\t\treturn productId === id;\n\t\t});\n\t}\n\n\tgetProductIndex(id) {\n\t\t// Get product index is only used at the top level, where we have access to multiple bundles. In a nested bundle, there is always only 1 bundle\n\t\tif (this.optionId !== '')\n\t\t\treturn;\n\n\t\tif (id) {\n\t\t\tfor (var i=0;i<this.productSelectionModel.configuredProducts.length;i++) {\n\t\t\t\tif (this.productSelectionModel.configuredProducts[i].record.Id === id)\n\t\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.ctx.params || !this.ctx.params.productIdx)\n\t\t\treturn 0;\n\n\t\tlet productIdx = +this.ctx.params.productIdx;\n\t\tif (Number.isNaN(productIdx) || productIdx < 0 || productIdx >= this.currentTarget.configuredProducts.length)\n\t\t\treturn 0;\n\n\t\treturn productIdx;\n\t}\n\n\thasDynamicFeature(product) {\n\t\tfor (let feature of product.features)\n\t\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] === 'Dynamic')\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\taddAttributeSetFromServerProductVO(product) {\n\t\tif (product.attributeSet && Object.keys(product.attributeSet.attributeItemIdsByOptionId).length === 0)\n\t\t\treturn;\n\t\tproduct._transient_ = product._transient_ || {};\n\t\tproduct._transient_.attributeSet = product.attributeSet;\n\t}\n\n\tchangeAllActions(buttonsCollapsed) {\n\t\tif (buttonsCollapsed)\n\t\t\tthis.$$('#allActions').classList.add(\"actionsCollapsed\");\n\t\telse\n\t\t\tthis.$$('#allActions').classList.remove(\"actionsCollapsed\");\n\t}\n\n\tprepareProductForServer(configuredProduct, applyImmediately) {\n\t\tlet minimalProduct = { record:{}},\n\t\t\tnestedOptionModel = this.topLevelBundle ? this.topLevelBundle.nestedOptionModel : configuredProduct.nestedOptionModel;\n\t\tminimalProduct.upgradedAssetId = configuredProduct.upgradedAssetId; //the asset being upgraded when configuring from asset upgrade\n\t\tlet selectedAndRemovedOptions;\n\t\ttry {\n\t\t\tselectedAndRemovedOptions = this.getSelectedAndRemovedOptions(configuredProduct, applyImmediately);\n\t\t} catch (e) {\n\t\t\tif (e.name === CONFIGURATION_ERROR) { //Configuration error thrown, return.\n\t\t\t\tthis.validationMessages = [e.message];\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthrow e; //Other error thrown, rethrow\n\t\t\t}\n\t\t}\n\t\tminimalProduct.configuration = nestedOptionModel.save(selectedAndRemovedOptions, applyImmediately);\n\t\tminimalProduct.configuration.configurationData = configuredProduct.configuration.configurationData;\n\t\tminimalProduct.configuration.configuredProductId = minimalProduct.record.Id = configuredProduct.record.Id;\n\t\treturn minimalProduct;\n\t}\n\n\tgetSelectedAndRemovedOptions(configuredProduct, skipValidations) {\n\t\tlet selectedAndRemovedOptions = { selectedOptions: [], removedOptions: [] };\n\t\tfor (let feature of configuredProduct.features) {\n\t\t\tfor (let  option of feature._transient_.optionConfigurations) {\n\t\t\t\tif (option.selected) {\n\t\t\t\t\tif (!skipValidations && option.configurationRequired && option.configured !== true) {\n\t\t\t\t\t\tconst missingConfigurationError = this.i18n.l(this.lineEditorModel.customLabels.msg_options_missing_config);\n\t\t\t\t\t\tthrow new ConfigurationError(missingConfigurationError); // Missing configuration, throw error\n\t\t\t\t\t}\n\t\t\t\t\tif (option.isUpgrade) {\n\t\t\t\t\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, configuredProduct.options, option);\n\t\t\t\t\t\toptionUpgradeHandler.setUpgradedAssetId();\n\t\t\t\t\t}\n\t\t\t\t\tlet clonedOption = JSON.parse(JSON.stringify(option));\n\t\t\t\t\tthis.buildOptionForLineEditor(clonedOption, selectedAndRemovedOptions.selectedOptions);\n\t\t\t\t} else {\n\t\t\t\t\tselectedAndRemovedOptions.removedOptions.push(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selectedAndRemovedOptions;\n\t}\n\n\tbuildOptionForLineEditor(clonedOption, array) {\n\t\t// Ascending/Descending Product Rules requires building the nested configurations whenever you save at each level\n\t\tclonedOption.optionConfigurations = clonedOption.optionConfigurations || [];\n\t\tclonedOption.optionId = clonedOption.record.Id;\n\t\tclonedOption.optionData = clonedOption.record;\n\t\tif(clonedOption.configurationData === undefined)\n\t\t\tclonedOption.configurationData = {};\n\t\tclonedOption.isDynamicOption = clonedOption.isDynamicOption || clonedOption.isUpgrade;\n\t\tdelete clonedOption.record;\n\t\tarray.push(clonedOption);\n\t}\n\n\tcreateQueryParams(queryParams, tabIndex) {\n\t\tlet params = this.ctx.params;\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\telse\n\t\t\tqueryParams.pId = this.getAllProductIds();\n\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\n\t\tif (queryParams.oId) {\n\t\t\tqueryParams.qId = params.qId;\n\t\t\tif (queryParams.oId === 'none')\n\t\t\t\tdelete queryParams.oId;\n\t\t}\n\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\telse if (params.pId != null && typeof params.pId !== 'string' && params.pId.length > 1)\n\t\t\tqueryParams.productIdx = 0;\n\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\n\t\tif (queryParams.ignoreCache == null && params.ignoreCache)\n\t\t\tqueryParams.ignoreCache = false;\n\n\t\tif (tabIndex || tabIndex == 0)\n\t\t\tqueryParams.tab = tabIndex;\n\t\telse if (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\tgetAllProductIds() {\n\t\tlet ids = [];\n\t\tfor(let product of this.currentTarget.configuredProducts)\n\t\t\tids.push(product.record.Id);\n\t\treturn ids.join();\n\t}\n\n\tcreatePathParams(redirectUrl) {\n\t\tif (this.optionId !== '')\n\t\t\treturn ['product', 'pc'];\n\t\treturn redirectUrl === 'ProductLookup' ? ['product', 'lookup'] : ['quote', 'le'];\n\t}\n\n\ttoggle() {\n\t\tif (this.viewport.isMobile() && this.hasMultipleBundles)\n\t\t\tthis.$.bundles.toggle();\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles) {\n\t\treturn viewport.isMobile() && hasMultipleBundles;\n\t}\n\n\tgetRequiredConfigurationAttributes() {\n\t\tif (this.requiredConfigAttributes)\n\t\t\treturn this.requiredConfigAttributes;\n\n\t\tlet configuredProducts = this.currentTarget.configuredProducts,\n\t\t\trequiredConfigAttributes = {};\n\n\t\t// loop through each product being configured and store by the product index\n\t\t// an array of unique target fields that map to the product's required configuration attributes\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigAttributes = configuredProducts[i].configurationAttributes;\n\t\t\tlet requiredProductConfigAttributes = {};\n\t\t\t// loop through all configuration attributes for this product to store unique target fields for any required configuration attributes\n\t\t\tfor (let j = 0, ll = productConfigAttributes.length; j < ll; j++) {\n\t\t\t\tlet productConfigAttribute = productConfigAttributes[j];\n\t\t\t\t// ensure configuration attribute is required, and the required attribute's target field has not already been set\n\t\t\t\tif (productConfigAttribute.required === true && Object.keys(requiredProductConfigAttributes).indexOf(productConfigAttribute.targetFieldName) === -1)\n\t\t\t\t\trequiredProductConfigAttributes[productConfigAttribute.targetFieldName] = productConfigAttribute;\n\t\t\t}\n\t\t\trequiredConfigAttributes[i] = requiredProductConfigAttributes;\n\t\t}\n\t\tthis.requiredConfigAttributes = requiredConfigAttributes;\n\t\treturn this.requiredConfigAttributes;\n\t}\n\n\tconfigurationAttributesValid() {\n\t\t// required configurations is a map by product index\n\t\t// whose value is an array of unique target fields that map to that product's required configuration attributes\n\t\tlet requiredConfigurations = this.getRequiredConfigurationAttributes();\n\t\tlet missingAttributes = {};\n\t\t// loop through each product being configured and check if its configuration data\n\t\t// has a non nil value for all of its required configuration attributes' target fields\n\t\tlet configuredProducts = this.currentTarget.configuredProducts;\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigData = configuredProducts[i].configuration.configurationData;\n\t\t\tlet productRequiredConfigAttributes = requiredConfigurations[i];\n\t\t\t// loop through all the target fields that map to this product's required configuration attributes to check if the value has been set\n\t\t\tfor (let attr in productRequiredConfigAttributes) {\n\t\t\t\t// if the required configuration attribute does not have a non nil value on the product's configuration data, then we are not valid\n\t\t\t\tif(!this.requiredConfigurationAttributeValid(productConfigData[attr]))\n\t\t\t\t\tmissingAttributes[attr] = true;\n\t\t\t}\n\t\t}\n\t\tthis.requiredAttributeMissingValue = missingAttributes;\n\t\treturn Object.keys(missingAttributes).length === 0; // no keys means no missing required attributes\n\t}\n\n\t/**\n\t * @returns {string} return a string of comma separated feature names\n\t */\n\tgetConfigurationAttributeMissingFeaturesMessage() {\n\t\tlet featuresWithRequiredMissingAttributes = {};\n\t\tif (this.requiredAttributeMissingValue === undefined)\n\t\t\tthis.getRequiredConfigurationAttributes();\n\n\t\tfor(let attrs in this.requiredConfigAttributes) {\n\t\t\tfor (let attr in this.requiredConfigAttributes[attrs]) {\n\t\t\t\tif(this.requiredAttributeMissingValue[attr] !== true)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet featureName = this.getFeatureNameFromId(this.requiredConfigAttributes[attrs][attr].featureId);\n\t\t\t\tif(featureName === undefined)\n\t\t\t\t\tcontinue;\n\t\t\t\tfeaturesWithRequiredMissingAttributes[featureName] = undefined; //storing as an object so we don't have duplicate feature names\n\t\t\t}\n\t\t}\n\t\tlet featureNames = Object.keys(featuresWithRequiredMissingAttributes);\n\t\tif(featureNames.length === 0)\n\t\t\treturn ''; //no feature config attributes\n\n\t\treturn ' in the following features: ' + featureNames; //TODO: localize?\n\t}\n\n\t/**\n\t * Returns the name of a feature given it's ID\n\t * @param id a feature id\n\t * @returns {string} return a string of the feature name\n\t */\n\tgetFeatureNameFromId(id) {\n\t\tif(id === undefined)\n\t\t\treturn;\n\n\t\tfor(let prod of this.currentTarget.configuredProducts)\n\t\t\tfor(let feat of prod.features)\n\t\t\t\tif(feat.record.Id === id)\n\t\t\t\t\treturn feat.record.Name;\n\t}\n\n\trequiredConfigurationAttributeValid(value) {\n\t\treturn !this.isNil(value);\n\t}\n\n\tsearch() {\n\t\tthis.$.bundles.toggleSearch();\n\t}\n\n\tsetOptionConfigurationDetails(model) {\n\t\tthis.topLevelBundle = model.currentIndex ? model.configuredProducts[model.currentIndex] : model.configuredProducts[0];\n\t\tif (this.topLevelBundle.nestedOptionModel == null) { // if you accessed this page directly without going through the topLevelBundle, sends you to topLevel if you bypassed\n\t\t\tdelete this.ctx.params.oId;\n\t\t\treturn this.nav('#', this.ctx.params, ['product', 'pc'], false);\n\t\t}\n\n\t\tlet config = this.topLevelBundle.nestedOptionModel.getExistingConfiguration();\n\t\tif (this.topLevelBundle.nestedOptionModel && config && (config.configured || config.changedByProductActions || !!config.optionConfigurations.length)) {\n\t\t\tthis.$.optionConfigure.featureOptionalSKUs = this.buildDynamicConfigurations(config);\n\t\t\tthis.$.optionConfigure.configuration = config;\n\t\t}\n\t\tif (this.topLevelBundle.nestedOptionModel)\n\t\t\tthis.$.optionConfigure.ignoreCache = this.ctx.params.origin === 'ol' ? false : this.topLevelBundle.nestedOptionModel.descendLevel;\n\t\telse\n\t\t\tthis.$.optionConfigure.ignoreCache = true;\n\t\tthis.$.optionConfigure.product = undefined; //makes certain the observer fires\n\t\tthis.$.optionConfigure.product = this.topLevelBundle;\n\t}\n\n\tbuildDynamicConfigurations(config) {\n\t\t// Build up a featureId:productId list to use in case any of these options are dynamically created\n\t\tlet featureOptionalSKUs = [];\n\n\t\tfor (let optionConfig of config.optionConfigurations) {\n\t\t\tif (!optionConfig.isDynamicOption)\n\t\t\t\tcontinue;\n\n\t\t\tlet optionData = optionConfig.optionData;\n\t\t\tif (optionData.Id && optionData[this.prefix + 'Feature__c'] && optionData[this.prefix + 'OptionalSKU__c'])\n\t\t\t\tfeatureOptionalSKUs.push(optionData[this.prefix + 'Feature__c'] + ':' + optionData[this.prefix + 'OptionalSKU__c'] + ':' + optionData.Id);\n\t\t}\n\t\treturn featureOptionalSKUs;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.configuratorObjects = [this.prefix + 'DiscountSchedule__c', this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.groupKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tisNil(value) {\n\t\treturn value == null || value === '';\n\t}\n\n\tloadedModelIsReconfigure(model) {\n\t\treturn !model.quote && model.configuredProducts.length == 1;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = formatError(this.errors);\n\t\tthis.spinner = false;\n\t}\n\n\tisReconfigure(model) {\n\t\treturn !(model.selectedProducts);\n\t}\n}\n\nclass ConfigurationError extends Error {\n\n\tconstructor(message) {\n\t\tsuper();\n\t\tthis.name = CONFIGURATION_ERROR;\n\t\tthis.message = message;\n\t}\n}\nPolymer(ProductConfig);\n","import {ConfigTree} from 'products/resources/tree/ConfigTree.js';\n\nexport class NestedOptionsModel {\n\tconstructor(configuration, isReconfigure) {\n\t\tthis.init(configuration, isReconfigure);\n\t}\n\n\tinit(configuration, isReconfigure) {\n\t\tthis.path = [];\n\t\tthis.descendLevel = false; // Boolean: Identifies if the user is moving into or out of a nested configuration\n\t\tthis.configTree = new ConfigTree(configuration); //manages nested configuration\n\t\tthis._setConfiguredOptionsObject(isReconfigure); // Map of Path to configured nodeIds\n\t\tthis.CONFIG_TAG = 'config';\n\t\tthis.SAVE_TAG = 'save';\n\t}\n\n\tconfigure(configuration) {\n\t\tlet data = this.getLastFromPath(),\n\t\t\tparent = this._getParentConfiguration();\n\t\tconfiguration.index = configuration.index || data.index;\n\t\tconfiguration.optionId = configuration.optionId || data.optionId;\n\t\tif (this.stagedOption !== undefined) {\n\t\t\tconfiguration.optionData = this.stagedOption.optionData || configuration.optionData;\n\t\t\t//It is important to track isDynamicOption here or it can become lost in navigation during initial configuration\n\t\t\tconfiguration.isDynamicOption = this.stagedOption.isDynamicOption || configuration.isDynamicOption || false;\n\t\t}\n\t\t// must clone at each level, so that changes are not reflected on the final branch until a successful save occurs\n\t\tconst clonedConfiguration = this._setAndReturnConfiguration(configuration, parent, this.CONFIG_TAG);\n\t\tclonedConfiguration.configuredOptions = this.getConfiguredOptionsFromPath();\n\t\tthis.descendLevel = false;\n\t\treturn clonedConfiguration;\n\t}\n\n\t/**\n\t * Prepares and returns the configuration of nested bundles\n\t * @param selectedAndRemovedOptions {Object} Stores the current selected and unselected options\n\t * @param applyImmediately {Boolean} True when triggered by a rule with applyImmediately\n\t */\n\tsave(selectedAndRemovedOptions, applyImmediately) {\n\t\tconst configuration = this._setAndGetConfiguration(applyImmediately),\n\t\t\ttag = this._getTagForSave(applyImmediately);\n\t\tthis._removeDeselectedOptions(selectedAndRemovedOptions.removedOptions, tag, null);\n\t\tthis._addSelectedOptions(selectedAndRemovedOptions.selectedOptions, tag);\n\t\t// Assume options passed in are in desired order. Ensure here that order is maintained.\n\t\tthis._sortOptionConfigurations(configuration, selectedAndRemovedOptions.selectedOptions);\n\n\t\tif (!applyImmediately)\n\t\t\tthis._setConfigured(configuration);\n\t\treturn configuration;\n\t}\n\n\t_getTagForSave(applyImmediately) {\n\t\tif (this.path.length === 0)\n\t\t\treturn null;\n\t\telse if (applyImmediately)\n\t\t\treturn this.CONFIG_TAG;\n\t\telse\n\t\t\treturn this.SAVE_TAG;\n\t}\n\n\tcancel() {\n\t\tconst configuration = this.getCurrentConfiguration(),\n\t\t\tparent = this._getParentConfiguration();\n\t\tthis._removeSubtree(configuration, parent, this.CONFIG_TAG, true);\n\t}\n\n\t/**\n\t * Removes an option\n\t * @param option {Object} Option that needs to be removed\n\t * @param parentTag {String} Additional tag added to the node id to locate the parent configuration\n\t * @param optionTag {String} Additional tag added to the node id to locate the option configuration\n\t */\n\tremove(option, parentTag, optionTag) {\n\t\tlet parent = this._getConfiguration(parentTag);\n\t\tif (!parent.getChildren || parent.getChildren().length < 1)\n\t\t\treturn;\n\t\toption.optionId = option.record ? option.record.Id : option.optionId;\n\t\toption.index = option.index || 0;\n\t\tthis._removeSubtree(option, parent, optionTag);\n\t}\n\n\t/**\n\t * Removes the option added via Option Lookup\n\t * @param option {Object} \n\t */\n\tremoveAddedOption(option) {\n\t\tconst tag = this.path.length === 0 ? null : this.CONFIG_TAG;\n\t\tthis.remove(option, tag, null);\n\t}\n\n\t/**\n\t * Upon a successful save, replace the existing configuration with the cloned configuration\n\t * @param serverConfiguration {Object} ProductConfigurationVO from a successful save\n\t */\n\tswapConfiguration(serverConfiguration) {\n\t\tconst parent = this._getParentConfiguration(),\n\t\t\tsaveConfiguration = this.getSaveConfiguration();\n\t\tserverConfiguration.index = saveConfiguration.index;\n\n\t\t// After a valid save, we can safely remove the two configurations\n\t\tthis._removePreviousConfigurations(parent);\n\t\tthis._addToConfigTree(parent, serverConfiguration);\n\t\tthis._setConfigured(serverConfiguration);\n\t\tserverConfiguration.tag = 'saved';\n\t}\n\n\t/**\n\t * Removes the cloned configuration that was created from the Save Event\n\t */\n\tremoveClonedConfiguration() {\n\t\tconst saveConfig = this.getSaveConfiguration(),\n\t\t\tparent = this._getParentConfiguration();\n\t\tthis._removeSubtree(saveConfig, parent, this.SAVE_TAG, true);\n\t}\n\n\t/**\n\t * Configurations returned from the rules engine added/merged into the config tree\n\t * @param configPath\n\t * @param configsToAdd\n\t * @param hiddenOptionIds\n\t * @param disabledOptionIds\n\t * @param changedByProductActions\n\t */\n\thandleDescendantRules(configPath, configsToAdd, hiddenOptionIds, disabledOptionIds, changedByProductActions) {\n\t\tlet level = this.configTree.getFromPath(this.path.concat(configPath)),\n\t\t\texistingConfigs;\n\t\tif (!level)\n\t\t\treturn;\n\n\t\tlevel.changedByProductActions = changedByProductActions;\n\t\tlet indices = {};\n\t\texistingConfigs = level.getChildren();\n\t\t// add all specified nested configurations\n\t\tconfigsToAdd.forEach( config => {\n\t\t\tindices[config.optionId] = indices[config.optionId] === undefined ? 0 : (indices[config.optionId] + 1);\n\t\t\tconfig.index = indices[config.optionId];\n\t\t\tlet existingConfig = existingConfigs.find( existing => {\n\t\t\t\treturn this._buildId(config) === existing.nodeId;\n\t\t\t});\n\t\t\tif (existingConfig === undefined) {\n\t\t\t\tthis.configTree.buildSubtree(config);\n\t\t\t\texistingConfigs.push(config);\n\t\t\t}\n\t\t});\n\t\t// remove all unspecified nested configurations\n\t\texistingConfigs.forEach( config => {\n\t\t\tlet configToAdd = configsToAdd.find( configToAdd => {\n\t\t\t\treturn config.nodeId === this._buildId(configToAdd);\n\t\t\t});\n\t\t\tif (configToAdd === undefined)\n\t\t\t\tthis._removeSubtree(config, level); //TODO: Fix this\n\t\t});\n\t\tlevel.disabledOptionIds = disabledOptionIds;\n\t\tlevel.hiddenOptionIds = hiddenOptionIds;\n\t}\n\n\t/**\n\t * Gets the non-cloned existing configuration\n\t * @returns {Object} ProductConfigurationVO of the product that a user is configuring\n\t */\n\tgetExistingConfiguration() {\n\t\treturn this._getConfiguration();\n\t}\n\n\t/**\n\t * Gets the cloned configuration that was created on the configure action\n\t * @returns {Object} ProductConfigurationVO of the product that a user is configuring\n\t */\n\tgetCurrentConfiguration() {\n\t\treturn this._getConfiguration(this.CONFIG_TAG);\n\t}\n\n\t/**\n\t * Gets the cloned configuration that was created on the save action\n\t * @returns {Object} ProductConfigurationVO of the product that a user is configuring\n\t */\n\tgetSaveConfiguration() {\n\t\treturn this._getConfiguration(this.SAVE_TAG);\n\t}\n\n\t/**\n\t * Gets the product that is being configured\n\t * @param tag {String} Additional tag that is added to the node id of the ConfigTree node\n\t * @returns {Object} ProductConfigurationVO of the product that a user is configuring\n\t * @private\n\t */\n\t_getConfiguration(tag = null) {\n\t\tconst searchPath = this._createPath(tag);\n\t\treturn this.configTree.getFromPath(searchPath);\n\t}\n\n\taddToPath(id, sku, index, tabIndex) {\n\t\tthis.path.push({optionId: id, optionalSKU: sku, index: index, tabIndex: tabIndex });\n\t\tthis.descendLevel = true;\n\t}\n\n\tpopFromPathAndGetNextSKU() {\n\t\tthis.path.pop();\n\t\tthis.descendLevel = false;\n\t\tlet optionInfo = this.getLastFromPath();\n\t\treturn optionInfo ? optionInfo.optionalSKU : optionInfo;\n\t}\n\n\tgetLastFromPath() {\n\t\treturn this.path[this.path.length-1];\n\t}\n\n\tgetConfiguredOptionsFromPath() {\n\t\treturn this.configuredOptions[this._buildPathString(true)] || {};\n\t}\n\n\t_getParentConfiguration() {\n\t\tconst tag = this.path.length > 0 ? this.CONFIG_TAG : null,\n\t\t\tsearchPath = this.path.slice(0, this.path.length -1),\n\t\t\tpath = this._createPath(tag, searchPath);\n\t\treturn this.configTree.getFromPath(path);\n\t}\n\n\t_setConfiguredOptionsObject(isReconfigure) {\n\t\tthis.configuredOptions = {};\n\t\tif (!isReconfigure)\n\t\t\treturn;\n\t\tthis._addConfigsToConfigurationObject(this.configTree.root, []); // on reconfigure, flag every configuration in tree as configured\n\t\tthis.configTree.root.configuredOptions = this.getConfiguredOptionsFromPath();\n\t}\n\n\t_addConfigsToConfigurationObject(configuration, path) {\n\t\tconfiguration.getChildren().forEach( nestedConfig => {\n\t\t\tlet obj = {'optionId': nestedConfig.optionId, 'index': nestedConfig.index};\n\t\t\tthis._addConfigsToConfigurationObject(nestedConfig, path.concat([obj]));\n\t\t});\n\t\tthis._setConfigured(configuration, path);\n\t}\n\n\t_setConfigured(configuration, path) {\n\t\tlet key = this._buildPathString(false, path);\n\t\tconfiguration.configured = true;\n\t\tconfiguration.configurationEntered = true;\n\t\tif (key) {\n\t\t\tthis.configuredOptions[key] = this.configuredOptions[key] || {};\n\t\t\tthis.configuredOptions[key][configuration.nodeId] = true;\n\t\t}\n\t}\n\n\t_updateThenGetSubtree(obj, parent, onSave, index) {\n\t\tconst id = this._buildId(obj);\n\t\tlet existingObj = this._findInConfiguration(id, parent); //Check if this does the job\n\t\tif (!existingObj) {\n\t\t\tthis._appendSubtree(obj, parent, index);\n\t\t\t// Must stage the configuration since it has never been successfully saved\n\t\t\tobj.staged = true;\n\t\t\treturn obj;\n\t\t} else {\n\t\t\tthis._updateSubtree(existingObj, obj, onSave);\n\t\t\treturn existingObj;\n\t\t}\n\t}\n\n\t/**\n\t * Sets properties on client configuration object from updated configuration\n\t * @param existingObj {Object} - Client-side configuration object already present in configuration tree\n\t * @param obj {Object} - Configuration object returned from server on a configuration event or updated from client by user or product rules\n\t * @param onSave {Boolean} - True when saving, false when not saving\n\t * @private\n\t */\n\t_updateSubtree(existingObj, obj, onSave) {\n\t\tif (onSave) {\n\t\t\tdelete existingObj.staged;\n\t\t\texistingObj.optionData = obj.optionData;\n\t\t\texistingObj.externalConfigurationData = obj.externalConfigurationData;\n\t\t}\n\t\tthis._propagateRuleData(existingObj, obj.disabledOptionIds, obj.hiddenOptionIds);\n\t\tthis._propagateAttributes(existingObj.configurationData, obj.configurationData);\n\t\tthis._mergeNestedConfigurations(obj, existingObj);\n\t}\n\n\t/**\n\t * Recursively sets properties on nested configurations present in the configuration tree\n\t * @param obj {Object} - Client-side configuration object already present in configuration tree\n\t * @param existingObj {Object} - Configuration object returned from server on a configuration event or updated from client by user or product rules\n\t * @private\n\t */\n\t_mergeNestedConfigurations(obj, existingObj) {\n\t\tif (obj.optionConfigurations.length > 0) {\n\t\t\tlet indices = {};\n\t\t\tobj.optionConfigurations.forEach( nestedConfig => {\n\t\t\t\tindices[nestedConfig.optionId] = indices[nestedConfig.optionId] === undefined ? 0: indices[nestedConfig.optionId] + 1;\n\t\t\t\tnestedConfig.index = indices[nestedConfig.optionId];\n\t\t\t\tnestedConfig.selected = true;\n\t\t\t\tthis._updateThenGetSubtree(nestedConfig, existingObj, false);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Product Configuration might already have disabled or hidden optionIds if it has been pre-selected and loaded\n\t * with the initial Product Model. Don't override those values, otherwise use the current product configuration.\n\t * @param productConfiguration {Object} - Client-side configuration object already present in configuration tree\n\t * @param disabledOptionIds {Array|Id} - Array of product Ids to disable\n\t * @param hiddenOptionIds {Array|Id} - Array of product Ids to hide\n\t * @private\n\t */\n\t_propagateRuleData(productConfiguration, disabledOptionIds, hiddenOptionIds) {\n\t\tproductConfiguration.disabledOptionIds = productConfiguration.disabledOptionIds || disabledOptionIds;\n\t\tproductConfiguration.hiddenOptionIds = productConfiguration.hiddenOptionIds || hiddenOptionIds;\n\t}\n\n\t/**\n\t * Sets default configuration attribute values from server configuration if they were not previously defined on the client configuration\n\t * @param productConfigurationData {Object} - Attributes of client-side configuration object already present in configuration tree\n\t * @param configurationData {Object} - Map of configuration attribute field APIs to attribute values\n\t * @private\n\t */\n\t_propagateAttributes(productConfigurationData, configurationData) {\n\t\tObject.keys(configurationData).forEach( attribute => {\n\t\t\tproductConfigurationData[attribute] = productConfigurationData[attribute] || configurationData[attribute];\n\t\t});\n\t}\n\n\t/**\n\t * Creates a new cloned configuration based on the current configuration\n\t * @param obj {Object} Product option you want to create a configuration from\n\t * @param parent {Object} Parent configuration you want to create a configuration from\n\t * @param tag {String}\n\t * @returns {Object} The new option configuration\n\t * @private\n\t */\n\t_setAndReturnConfiguration(obj, parent, tag) {\n\t\tlet addedOption = tag === this.SAVE_TAG ? this._cloneConfiguration(obj, parent) : obj;\n\t\taddedOption.tag = tag;\n\t\taddedOption.staged = true;\n\t\treturn this._addToConfigTree(parent, addedOption);\n\t}\n\n\t/**\n\t * Creates a new configuration for save\n\t * @param obj {Object} Product option you want to create a configuration from\n\t * @param parent {Object} Parent configuration you want to create a configuration from\n\t * @returns {Object} The new option configuration\n\t * @private\n\t */\n\t_cloneConfiguration(obj, parent) {\n\t\tconst id = this._buildId(obj, this.CONFIG_TAG),\n\t\t\texistingConfig = this._findInConfiguration(id, parent);\n\t\treturn JSON.parse(JSON.stringify(existingConfig));\n\t}\n\n\t/**\n\t * Creates a clone of the configuration of the current product bundle\n\t * @param parent {Object} Parent configuration you want to create a configuration from\n\t * @param config {Object} ProductConfigurationVO of the current level product\n\t * @returns {Object} ProductConfigurationVO of the cloned current configuration\n\t * @private\n\t */\n\t_addToConfigTree(parent, config) {\n\t\tthis.configTree.buildSubtree(config);\n\t\tparent.getChildren().push(config);\n\t\treturn config;\n\t}\n\n\t/**\n\t * Builds hierarchical tree with product configurations below the current configuration.\n\t * Adds current configuration to the parent's list of children.\n\t * @param obj\n\t * @param parent\n\t * @param index\n\t * @private\n\t */\n\t_appendSubtree(obj, parent, index) {\n\t\tthis._addIndexProperty(obj, parent);\n\t\tthis.configTree.buildSubtree(obj);\n\t\tif (index != undefined) {\n\t\t\tparent.getChildren().splice(index, 0, obj);\n\t\t} else {\n\t\t\tparent.getChildren().push(obj);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the subtree of the option\n\t * @param child {Object} Option that we want to remove\n\t * @param parent {Object} Parent of the option\n\t * @param tag {String} Additional tag that is added to the node id of the ConfigTree node\n\t * @param doNotAdjustIndices {Boolean} override to not adjust indices of other configs when removing one of the same ID\n\t */\n\t_removeSubtree(child, parent, tag, doNotAdjustIndices = false) {\n\t\tlet childIndex = this._getChildIndexAndAdjustIndices(child.optionId, child.index, parent.getChildren(), tag, doNotAdjustIndices);\n\t\tif (childIndex >= 0) {\n\t\t\tthis._removeConfiguration(parent, childIndex, this._buildId(child, tag)); //TODO: check here\n\t\t}\n\t}\n\n\t_removeConfiguration(parent, index, childId) {\n\t\tlet key = this._buildPathString(true);\n\t\tparent.getChildren().splice(index, 1);\n\t\tif (key && this.configuredOptions[key] && this.configuredOptions[key][childId] && !this._findInConfiguration(childId, parent)) {\n\t\t\tdelete this.configuredOptions[key][childId];\n\t\t}\n\t}\n\n\t_findInConfiguration(idProperties, parent) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\treturn parent.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n\n\t_addIndexProperty(obj, parent) {\n\t\tlet i = obj.index || 0;\n\t\twhile (this._findInConfiguration(this._buildId({'optionId': obj.optionId, 'index': i}), parent)) {\n\t\t\ti++;\n\t\t}\n\t\tobj.index = i;\n\t}\n\n\t/**\n\t * Get the index of the option you'd like to remove\n\t * @param optionId {Id} Unique Id of the option\n\t * @param index {Integer} Index that keeps track of options added via Option Lookup\n\t * @param children {Array} The options selected from the parent bundle\n\t * @param tag {String} Additional tag that is added to the node id of the ConfigTree node\n\t * @param doNotAdjustIndices {Boolean} override control to specify NOT to adjust indices\n\t * @returns {Integer} The index of the option for the parent bundle's children\n\t * @private\n\t */\n\t_getChildIndexAndAdjustIndices(optionId, index, children, tag, doNotAdjustIndices) {\n\t\tlet i = 0,\n\t\t\tchildIndex = -1,\n\t\t\tid = this._buildId({'optionId': optionId, 'index': index}, tag === this.SAVE_TAG ? '' : tag);\n\t\tfor (let child of children) {\n\t\t\tif (child.nodeId === id || (tag === this.SAVE_TAG && child.nodeId.indexOf(id) !== -1))\n\t\t\t\tchildIndex = i;\n\t\t\t// W-5355431: do not adjust indices when specified, i.e. swapping configurations or removing a tagged config\n\t\t\telse if (!doNotAdjustIndices && child.optionId === optionId && child.index > index)\n\t\t\t\tthis._alterIndexPropertyAndNodeId(child);\n\t\t\ti++;\n\t\t}\n\t\treturn childIndex;\n\t}\n\n\t_alterIndexPropertyAndNodeId(obj) {\n\t\tlet prevId = obj.nodeId;\n\t\tobj.index--;\n\t\tobj.nodeId = this._buildId(obj);\n\n\t\tlet key = this._buildPathString(true);\n\t\tif (key && this.configuredOptions[key]) {\n\t\t\tthis.configuredOptions[key][obj.nodeId] = true;\n\t\t\tdelete this.configuredOptions[key][prevId];\n\t\t}\n\t}\n\n\t/**\n\t * Builds a unique node id\n\t * @param obj {Object} Product option information\n\t * @param tag {String} Additional tag that is added to the node id of the ConfigTree node\n\t * @returns {String} A unique node Id 'optionId_index_tag'\n\t * @private\n\t */\n\t_buildId(obj, tag = null) {\n\t\treturn '_' + obj.optionId + '_' + obj.index + (tag ? '_' + tag : '');\n\t}\n\n\t_buildPathString(includeLast, path = this.path) {\n\t\tlet string = this.configTree.root.nodeId,\n\t\t\tn = includeLast ? 0 : 1;\n\t\tfor (let i = 0; i < path.length - n; i++) {\n\t\t\tstring += ('-' + this._buildId(path[i]));\n\t\t}\n\t\treturn string;\n\t}\n\n\t/**\n\t * Creates a path array with the proper tags added\n\t * @param path {Array} Ordered list of configurations\n\t * @param tag {String} Additional tag that is added to the node id of the ConfigTree node\n\t * @returns {Array} Path of configurations\n\t * @private\n\t */\n\t_createPath(tag, path = this.path) {\n\t\tlet alteredPath = [];\n\t\tfor (let [index, step] of path.entries()) {\n\t\t\t// Every level of the path will be the cloned on configure with the exception of the last step\n\t\t\tif (index === path.length - 1)\n\t\t\t\tstep.tag = tag;\n\t\t\telse\n\t\t\t\tstep.tag = this.CONFIG_TAG;\n\t\t\talteredPath.push(step);\n\t\t}\n\t\treturn alteredPath;\n\t}\n\n\t/**\n\t * Retrieves current configuration that will be used for the save function\n\t * @ param {Boolean} applyImmediately Flag of event\n\t * @returns {Object} Current configuration\n\t * @private\n\t */\n\t_setAndGetConfiguration(applyImmediately) {\n\t\tif (this.path.length === 0)\n\t\t\treturn this.getExistingConfiguration();\n\t\telse if (applyImmediately)\n\t\t\treturn this.getCurrentConfiguration();\n\t\telse\n\t\t\treturn this._setAndReturnConfiguration(this.getCurrentConfiguration(), this._getParentConfiguration(), this.SAVE_TAG);\n\t}\n\n\t/**\n\t * Removes unselected options from the configuration\n\t * @param options {Array} Options that were deselected\n\t * @param parentTag {String} Additional tag added to the node id to locate the parent configuration\n\t * @param optionTag {String} Additional tag added to the node id to locate the option configuration\n\t * @private\n\t */\n\t_removeDeselectedOptions(options, parentTag, optionTag) {\n\t\tfor (let opt of options)\n\t\t\tthis.remove(opt, parentTag, optionTag);\n\t}\n\n\t/**\n\t * Adds selected options to a configuration\n\t * @param options {Object} Options that were selected when a user clicks 'Save'\n\t * @param tag {String} Additional tag added to the node id to locate the option configuration\n\t * @private\n\t */\n\t_addSelectedOptions(options, tag) {\n\t\tlet configuration = this._getConfiguration(tag);\n\t\tfor (let [index, option] of options.entries()) {\n\t\t\tthis._updateThenGetSubtree(option, configuration, true, index);\n\t\t}\n\t}\n\n\t/**\n\t * Ensures existing configurations are in the same order as specified selected options\n\t * @param configuration {Object} the configuration level whose optionConfigurations are being sorted\n\t * @param orderedOptions {Array|Object} options in the order in which they should appear in configuration\n\t * @private\n\t */\n\t_sortOptionConfigurations(configuration, orderedOptions) {\n\t\tif (!orderedOptions || orderedOptions.length === 0 || orderedOptions.length !== configuration.getChildren().length)\n\t\t\treturn;\n\n\t\tconst sortedConfigs = [];\n\t\tfor (let [index, option] of orderedOptions.entries())\n\t\t\tsortedConfigs[index] = this._findInConfiguration(option, configuration);\n\n\t\tconfiguration.optionConfigurations = sortedConfigs;\n\t}\n\n\t/**\n\t * Removes all the configurations that represent different states of the configuration\n\t * @param parent {Object}\n\t * @private\n\t */\n\t_removePreviousConfigurations(parent) {\n\t\tconst previousConfig = this.getExistingConfiguration();\n\t\t// W-5355431: when this method is called, we do not want to adjust indices for configurations with the same ID\n\t\tif (previousConfig)\n\t\t\tthis._removeSubtree(previousConfig, parent, null, true);\n\t\tthis._removeSubtree(this.getCurrentConfiguration(), parent, this.CONFIG_TAG, true);\n\t\tthis._removeSubtree(this.getSaveConfiguration(), parent, this.SAVE_TAG, true);\n\t}\n}\n","import {Util} from '../../../../common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Suggester {\n\tconstructor(prefix, searchModel, quoteProcess) {\n\t\tthis.prefix = prefix;\n\t\tthis.searchModel = searchModel;\n\t\tthis.searchFilterData = {};\n\t\tthis.filterContext = quoteProcess;\n\t}\n\n\tbuildFields(fields) {\n\t\tlet gsfields = [];\n\t\tfor (let field of fields) {\n\t\t\tgsfields.push(field.replace('Product2','ProcessInput__c'));\n\t\t}\n\t\treturn gsfields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.prefix + 'ProcessInput__c';\n\t}\n\n\tgetGroupKey(filter) {\n\t\treturn filter.record.Id;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tfor (let id of group) {\n\t\t\tfor (let process of this.searchModel.quoteProcess.inputs) {\n\t\t\t\tif (process.record.Id === id) {\n\t\t\t\t\tif (!this.searchModel.processInputValues[id]) {\n\t\t\t\t\t\t//do nothing here; just skip code in following else if\n\t\t\t\t\t}\n\t\t\t\t\telse if (searchFilterModel && this.isLookupType(searchFilterModel[id].model.type) && this.searchModel.processInputValues[id][this.prefix + 'Value__c'])\n\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(this.searchModel.processInputValues[id][this.prefix + 'Value__c'], searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\tlet value = null;\n\t\t\t\t\tif (this.searchModel.processInputValues[id])\n\t\t\t\t\t\tvalue = this.searchModel.processInputValues[id][this.prefix + 'Value__c'] || null;\n\t\t\t\t\telse\n\t\t\t\t\t\tvalue = process.record[process.record[this.prefix + 'InputField__c']] || null;\n\t\t\t\t\tsearchFilterData[id] = {value: value, hidden: false, field: process.targetFieldName};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif (!searchFilter.value)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\t\tthis.evaluateProcessInputConditions();\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetFilterContext() {\n\t\tlet quoteProcess = JSON.parse(JSON.stringify(this.filterContext));\n\t\tfor (let input of quoteProcess.inputs) {\n\t\t\tif (this.searchFilterData[input.record.Id].hidden) {\n\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\tinput.hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.searchFilterData[input.record.Id]) {\n\t\t\t\tif (this.searchFilterData[input.record.Id].value === '')\n\t\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\telse\n\t\t\t\t\tinput.record[input.targetFieldName] = this.searchFilterData[input.record.Id].value;\n\t\t\t}\n\t\t}\n\n\t\tlet length = quoteProcess.inputs.length;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tif (quoteProcess.inputs[i].hidden)\n\t\t\t{\n\t\t\t\tquoteProcess.inputs.splice(i, 1);\n\t\t\t\tlength--;\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn quoteProcess;\n\t}\n\n\tgetAdditionalProperties() {\n\t\treturn null;\n\t}\n\n\tevaluateProcessInputConditions() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.searchFilterData));\n\t\tfor (let input of this.filterContext.inputs) {\n\t\t\tlet numPass = 0;\n\t\t\tif(input.conditions.length === 0) {\n\t\t\t\tsearchFilterData[input.record.Id].hidden = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (let condition of input.conditions) {\n\t\t\t\tlet masterProcessInput = condition[this.prefix + 'MasterProcessInput__c'];\n\t\t\t\tlet masterProcessInputValue = searchFilterData[masterProcessInput].value;\n\t\t\t\tif (Util.arithmeticOperatorConversion(masterProcessInputValue, condition[this.prefix + 'Value__c'], condition[this.prefix + 'Operator__c']))\n\t\t\t\t\tnumPass++;\n\t\t\t}\n\t\t\tif (input.record[this.prefix + 'ConditionsMet__c'] === 'All')\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass === input.conditions.length);\n\t\t\telse\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass > 0);\n\t\t}\n\t\tthis.searchFilterData = searchFilterData;\n\t\treturn searchFilterData;\n\t}\n\n\trunOnLoad() {\n\t\tlet Ids = [];\n\t\tfor (let input of this.searchModel.quoteProcess.inputs) {\n\t\t\tIds.push(input.record.Id);\n\t\t}\n\t\tthis.setDefaultFilterValues(Ids);\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n}","import {Page} from 'common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {Suggester} from 'products/selection/filter/sb-suggester/Suggester.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {RuleExecutor} from 'common/rules/RuleExecutor.js';\nimport {put} from 'quotes/models/SafeClientCache.js';\nimport { Events, fireEvent } from 'common/core/Events.js';\nconst PANELS = [ '#gslayout', '#pflayout' ];\n\nexport class ProductLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// errors for services\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t// error for sb-toast\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t},\n\t\t\tsearchContext: String, //the value in the searchBar\n\t\t\tsearchedValue: String, //the value last searched\n\t\t\tfilterContext: Object, //the filter panel filters\n\t\t\tsearcher: Object\n\t\t}, Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'handleAutoSelect(searchModel)',\n\t\t\t'_modalObserver(quote, modalActive)',\n\t\t\t'handleValueChanged(searchFilterData.*)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\t_modalObserver (quote, modalActive) {\n\t\tif (quote === undefined || modalActive === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.modal(quote, modalActive);\n\t}\n\t\n\tmodal() {\n\t\tif (!this.modalActive && this.hasQuoteProcess) {\n\t\t\tthis.$.selectionSaver.save({uid: this.quote.record.Id, model: {modalActive: true}});\n\t\t\tthis.toggleClass('modaloverflow', true, this);\n\t\t\tthis.$.modal.show = true;\n\t\t\tthis.refocus();\n\t\t} else {\n\t\t\tif (!this.hasQuoteProcess) {\n\t\t\t\tthis.setPanelDisplay('#pflayout');\n\t\t\t}\n\n\t\t\tif (this.lineEditorModel.settings.openSearchFilterByDefault === true)\n\t\t\t\tthis.toggleFilter();\n\n\t\t\tthis.panelSuggester = this.suggester;\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.setSpinnerMessage();\n\t\tthis.preLoadObjects();\n\t\tthis.handleClearSelected();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.modal.addEventListener('sb-gs-modal-close', this.closeDialog.bind(this));\n\t\tthis.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.$.modal.addEventListener('filter-item-value-changed', this.handleLabelChanged.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t\tthis.addEventListener('clear-filters', this.clearFilterFields);\n\t\tthis.addEventListener('sb-type-clear', this.resetSearchBar);\n\t\tthis.attachSearchBarEventListeners();\n\t\t//this.initMobileSearchBar();\n\t}\n\n\t/**\n\t * On load, the page sets the spinner message for async Large Bundle\n\t * Configuration operations. This message will appear below the spinner during\n\t * async operations.\n\t */\n\tsetSpinnerMessage() {\n\t\tconst message = 'Large bundle configuration enabled. It may take a minute to process your bundle.';\n\t\tput('RootState', 'spinnerMessage', message);\n\t}\n\n\thandleTransientCache() {\n\t\t//TODO: run the filter on initial searchModel retrieval, don't need 2 server requests for a searchModel on page load\n\t\t//this applies a previously cached filter when returning to the page\n\t\tthis.$.selectionReader.read({uid: this.quote.record.Id}).then(function (response) {\n\t\t\tthis.lastSubmit = response ? response.lastSubmit : null;\n\t\t\tthis.modalActive = response ? response.modalActive : false;\n\t\t\tif (this.lastSubmit === 'gs') {\n\t\t\t\tthis.suggester.runOnLoad();\n\t\t\t\tthis.runSuggester();\n\t\t\t}\n\t\t\telse if (this.lastSubmit === 'pf') {\n\t\t\t\tthis.searcher.runOnLoad(response.filterValues);\n\t\t\t\tthis.runSearcher();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.inputField = this.prefix + 'InputField__c'; //handle record property for guided selling inputs\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\t\tlet groupKey = parseInt(this.ctx.params.groupKey),\n\t\t\t\tquoteProcessId = this.getQuoteProcessId(this.quote, groupKey);\n\t\t\tthis.hasQuoteProcess = (quoteProcessId !== null);\n\t\t\t//this loads either the guided selling or product filter panel when the page loads\n\t\t\tif (this.hasQuoteProcess === true)\n\t\t\t\tthis.setPanelDisplay('#gslayout');\n\t\t\telse\n\t\t\t\tthis.setPanelDisplay('#pflayout');\n\t\t\tif (this.ctx.params.aId)\n\t\t\t\tthis.$.smLoadService.actionId = this.ctx.params.aId;\n\t\t\tthis.$.smLoadService.processId = quoteProcessId;\n\t\t\tthis.$.smLoadService.quote = this.$.smSelectService.quote = this.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\n\t\t\t// disable filter panel button if no visible filters or Guided Only selling is set to true\n\t\t\t// we set this as read-only since subsequent requests will be incorrect\n\t\t\tif((this.guidedOnly === undefined || this.guidedOnly === null) &&\n\t\t\t\tsearchModel.searchFiltersTabShown != undefined) {\n\t\t\t\t this.guidedOnly = !searchModel.searchFiltersTabShown;\n\t\t\t}\n\t\t\tif (!this.onLoadSearchModel)\n\t\t\t\tthis.onLoadSearchModel = Object.assign({}, searchModel); // save a version of the searchModel.  useful if we need to revert back to it\n\n\t\t\t// setting for allowing the product results to be grouped by a column\n\t\t\tthis.$.lookupLayout.groupByField = searchModel.productResultsGroupFieldName;\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.';\n\n\t\t\t// remove inactive process inputs\n\t\t\tsearchModel = this._removeInactiveQuoteProcessInputs(searchModel);\n\n\t\t\t// detach quoteProcess from the searchModel so it isn't overwritten by null when service returns\n\t\t\tthis.quoteProcess = searchModel.quoteProcess;\n\t\t\tthis.searchModel = searchModel;\n\n\t\t\tthis.buildDelegator();\n\t\t\tthis.handleTransientCache();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Sets a Quote Process ID by the following priority, based on the quoteVO:\n\t * Group -> Quote -> null (if neither has a Quote Process)\n\t * @param quote quoteVO that is passed in\n\t * @param groupKey key of a group, if the event originates from a group\n\t * @returns {*|null}\n\t */\n\tgetQuoteProcessId(quote, groupKey) {\n\t\tlet groupProcessId;\n\t\tfor (let group of quote.lineItemGroups) {\n\t\t\tif(group.key === groupKey) {\n\t\t\t\tgroupProcessId = group.record[this.prefix + 'QuoteProcess__c'];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn groupProcessId || quote.record[this.prefix + 'QuoteProcessId__c'] || null;\n\t}\n\n\t//initMobileSearchBar() {\n\t//\tif(this.isMobileViewport() === false)\n\t//\t\treturn;\n\t//\n\t//\tthis.$.headersearch.showResetButton = true;\n\t//\tthis.$.headersearch.hideCancelIcon = true;\n\t//\t//if mobile, add an event listener to the focus of the search bar\n\t//\t//then open a dialog\n\t//\tthis.$.headersearch.addEventListener('sb-type-focus', function(){\n\t//\t\tthis.fire('iron-signal', {name: 'sb-open-search-bar-dialog', data: {\n\t//\t\t\tvalue: this.searchContext,\n\t//\t\t\tquote: this.quote\n\t//\t\t}});\n\t//\t}.bind(this))\n\t//}\n\n\tattachSearchBarEventListeners() {\n\t\tthis.addEventListener('sb-search-invoked', this.searchBarResultsChanged.bind(this));\n\t\tthis.addEventListener('sb-search-item-selected', this.searchBarItemSelected.bind(this));\n\t\tthis.addEventListener('sb-search-reset-clicked', this.searchBarResetClicked.bind(this));\n\t\tthis.addEventListener('sb-search-nil-search-invoked', this.searchBarNilSearchInvoked.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tthis._updateQuote(e.detail.value.quote);\n\t\t\tif (e.detail.value.configuredProducts.length == 0) {\n\t\t\t\tthis.handleNonConfigurableProducts(e);\n\t\t\t}\n\t\t\tif (e.detail.value.configuredProducts.length > 0) {\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleNonConfigurableProducts(e) {\n\t\tif (this.redirectUrl === 'LineEditor') {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t\telse if (this.redirectUrl === 'ProductLookup') {\n\t\t\tthis.$.smSelectService.quote = e.detail.value.quote;\n\t\t\tthis.$.lookupLayout.deSelectAll();\n\t\t\tthis.navigateToSelf();\n\t\t\tthis.spinner = false;\n\t\t}\n\t}\n\n\thandleConfigurableProducts(e) {\n\t\tlet queryParams = {};\n\t\te.detail.value.selectedProducts = this.selectedProducts;\n\t\tlet configProductIds = this.getConfigProductIds(e);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tif(this.ctx.params.aId !== undefined)\n\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\tqueryParams.pId = configProductIds;\n\t\tqueryParams.redirectUrl = this.redirectUrl;\n\t\tqueryParams.open = 0;\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\t_updateQuote(responseQuote) {\n\t\tif (responseQuote.partialVO) {\n\t\t\t// If the response quote was a partial VO, then it means we need to compare the new VO with the old one,\n\t\t\t// and combine the data from both.\n\t\t\tvar originalLines = this.lineEditorModel.quote.lineItems;\n\t\t\t// Append the new line items onto the existing ones.\n\t\t\tresponseQuote.lineItems = originalLines.concat(responseQuote.lineItems);\n\t\t\t// Delete all of the temporary attributes we added to the partial VO, and stop marking it as a partial VO.\n\t\t\tdelete responseQuote.existingProductIds;\n\t\t\tdelete responseQuote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\t\tdelete responseQuote.emptyGroupKeys;\n\t\t\tresponseQuote.partialVO = false;\n\t\t}\n\t\tthis.lineEditorModel.quote = responseQuote;\n\t}\n\n\thandleLabelChanged(e) {\n\t\tif(this.searchFilterData) // only defined in a guided selling use case\n\t\t\tthis.searchFilterData[e.detail.item].label = e.detail.value;\n\t}\n\n\tbuildDelegator() {\n\t\tif (this.hasQuoteProcess) {\n\t\t\tthis.suggester = new Suggester(this.prefix, this.searchModel, this.quoteProcess);\n\t\t}\n\t\tif (!this.searcher)\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t}\n\n\t/**\n\t * Given the Search Model with a quote process, this method removes all inactive (Active__c = false)\n\t * process inputs from that quote process. Therefore, those inactive process inputs will not render\n\t * in the view and won't be utilized.\n\t *\n\t * @param searchModel The search model that is returned from the server, which contains a quote process if \n\t * there is one on the quote.\n\t *\n\t * @returns searchModel with a quote process that doesn't have process inputs\n\t */\n\t_removeInactiveQuoteProcessInputs(searchModel) {\n\t\tif (!this.hasQuoteProcess) return searchModel;\n\n\t\tlet inputs = searchModel.quoteProcess.inputs;\n\t\tif (inputs === undefined || inputs.length === 0) return searchModel;\n\n\t\tlet activeInputs = [];\n\t\tfor (let processInput of inputs) {\n\t\t\tlet isActive = processInput.record[this.prefix + 'Active__c'];\n\t\t\tif (isActive === false) continue;\n\t\t\tactiveInputs.push(processInput);\n\t\t}\n\n\t\tsearchModel.quoteProcess.inputs = activeInputs;\n\t\treturn searchModel;\n\t}\n\n\thandleValueChanged() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tthis.internal = true;\n\t\tthis.updateSearchFilterData();\n\t\tthis.internal = false;\n\t}\n\n\tupdateSearchFilterData() {\n\t\tthis.suggester.searchFilterData = this.searchFilterData;\n\t\tlet searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t\tthis.searchFilterData = searchFilterData;\n\t}\n\n\tsetPanelDisplay(visiblePanel) {\n\t\tPANELS.forEach((panel) => {\n\t\t\tconst isVisible = visiblePanel === panel;\n\t\t\tthis.toggleClass('hidden-panel', !isVisible, this.$$(panel));\n\t\t\tthis.toggleClass('visible-panel', isVisible, this.$$(panel));\n\t\t});\n\t}\n\n\ttoggleFilter() {\n\t\tthis.togglePanel('pflayout');\n\t}\n\n\ttoggleGuidedSelling() {\n\t\tthis.togglePanel('gslayout');\n\n\n\t}\n\n\ttogglePanel(panel) {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tif (this.$$('.visible-panel').id === panel || this.$.drawer.selected === 'main')\n\t\t\tthis.$.drawer.togglePanel();\n\t\tthis.setPanelDisplay('#' + panel);\n\t\tthis.refocus();\n\t}\n\n\tcloseDrawer() {\n\t\t// W-4820156: In Safari only, searching while the cursor is focused on any filter except the first one\n\t\t// will cause the lookup layout iron list to be moved to the side, cutting off columns including the selection\n\t\t// checkbox, making it impossible to proceed. Todo: implement a more robust fix\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus(event) {\n\t\tif (event && event.type === 'transitionend')\n\t\t\treturn;\n\t\tif (!this.$$('.visible-panel'))\n\t\t\treturn;\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.modalGroup.focusFirstField();\n\t\telse if (this.$$('.visible-panel').id === 'gslayout')\n\t\t\tthis.$.gs.focusFirstField();\n\t\telse if (this.$$('.visible-panel').id === 'pflayout')\n\t\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tif (!this.$$('.visible-panel'))\n\t\t\treturn;\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.suggest.focus();\n\t\telse if (this.$$('.visible-panel').id === 'gslayout')\n\t\t\tthis.$.cleargs.focus();\n\t\telse if (this.$$('.visible-panel').id === 'pflayout')\n\t\t\tthis.$.clearfilter.focus();\n\t}\n\n\tcloseDialog() {\n\t\tthis.toggleClass('modaloverflow', false, this);\n\t\t//build guided selling panel\n\t\t//todo: make this html property instead of object property\n\t\tthis.suggester.skipDefaults = true;\n\t\tthis.panelSuggester = this.suggester;\n\t\tif (!this.panelGroupItems)\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\tthis.$.modal.show = false;\n\t}\n\n\tsuggestClicked() {\n\t\tthis.suggest = true;\n\t\tthis.runSuggester();\n\t}\n\n\trunSuggester() {\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'gs';\n\t\tthis.closeDialog();\n\t\tthis.$.gs.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\t/**\n\t * Runs the search for the products.\n\t * @param  {Object} e the event detail object, if called as an event listener\n\t */\n\trunSearcher(e) {\n\t\t//this focus code makes sure the field is blured so that the filter value is available in the model\n\t\tthis.$$('#submit').focus();\n\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.actionId = this.ctx.params.aId;\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.filterContext = this.$.pf.filterDelegator.getFilterContext(); //store the filter values in a property\n\t\tthis.$.pf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tsaveCache() {\n\t\tthis.$.selectionSaver.save({\n\t\t\tuid: this.quote.record.Id, model: {\n\t\t\t\tmodalActive: true,\n\t\t\t\tlastSubmit: this.$$('.visible-panel').id.substring(0, 2),\n\t\t\t\tfilterValues: this.searcher.searchFilterData\n\t\t\t}\n\t\t});\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tonSelect() {\n\t\tthis.redirectUrl = 'LineEditor';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis._addAggregateDataIfThresholdExceeded();\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t}\n\n\tonSelectMore() {\n\t\tthis.redirectUrl = 'ProductLookup';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis._addAggregateDataIfThresholdExceeded();\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToSelf();\n\t\t}\n\t}\n\n\t_addAggregateDataIfThresholdExceeded() {\n\t\tlet stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\tif (stripLinesThreshold != null && this.quote.lineItems.length > stripLinesThreshold) {\n\t\t\tthis.$.smSelectService.stripQuoteLines = true;\n\t\t\tlet lineOmissionMsg = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tlineOmissionMsg = lineOmissionMsg\n\t\t\t\t.replace('{0}', this.lineEditorModel.quote.record.Id)\n\t\t\t\t.replace('{1}', stripLinesThreshold);\n\t\t\tconsole.log(lineOmissionMsg);\n\t\t\tlet qla = new QuoteLineAggregator(this.quote);\n\t\t\t// We need existing product IDs to handle upgrades\n\t\t\tthis.quote.existingProductIds = qla.getExistingProductIdsFromLines();\n\t\t\tlet groupKey = this.ctx.params.groupKey;\n\t\t\tlet mdqTemplatesByDimensionType = qla.getSegmentTemplatesByDimensionTypeForGroupKey(groupKey);\n\t\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\t\t// For adding MDQ lines, we will attempt to use existing lines as a template if there are any such lines.\n\t\t\t// This is important because it lets us know exactly how many segments we need to add, and what we need to label\n\t\t\t// them. It also lets us know how many custom segments we're supposed to add, since we're supposed to add\n\t\t\t// segments equal to the current number of custom segments.\n\t\t\t// Since you can only add products to one group at a time, we map it according to the target group key, or -1\n\t\t\t// if there is no target group.\n\t\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey[(groupKey || -1) + ''] = mdqTemplatesByDimensionType;\n\t\t\tthis.quote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\t\t}\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let orderedSelectedProductId of orderedSelectedProductIds) {\n\t\t\tlet selectedProduct = this.selectedProducts[orderedSelectedProductId];\n\n\t\t\t// do no save invalid products\n\t\t\tif(selectedProduct.invalid)\n\t\t\t\tcontinue;\n\n\t\t\t// UnitPrice is added to avoid looping through all the pricebook entries, but we do not need the information in the server.\n\t\t\tdelete selectedProduct.record.UnitPrice;\n\t\t\torderedSelectedProducts.push(selectedProduct);\n\t\t}\n\t\treturn orderedSelectedProducts;\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {'qId': this.quote.record.Id};\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet queryParams = {'qId': this.quote.record.Id };\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToSelf() {\n\t\tlet actionIdQueryString = this.ctx.params.aId ? ('&aId=' + this.ctx.params.aId) : '';\n\t\tfireEvent(Events.NAVIGATION_CHANGED, {\n\t\t\turl: '#', location: '#/product/lookup?qId=' + this.quote.record.Id + actionIdQueryString\n\t\t});\n\n\t\tthis.$.plSelectMore.blur();\n\t}\n\n\tnavToFavorites() {\n\t\tlet params = {qId: this.quote.record.Id};\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tparams.groupKey = this.ctx.params.groupKey;\n\t\tif (this.ctx.params.aId !== undefined)\n\t\t\tparams.aId = this.ctx.params.aId;\n\t\tthis.nav('#', params, ['favorite', 'lookup'], false);\n\t}\n\n\thandleAutoSelect() {\n\t\tif (this.suggest && this.quoteProcess && this.quoteProcess.record[this.prefix + 'ProductAutoSelected__c'] && this.searchModel.results.length === 1)\n\t\t{\n\t\t\tlet result = this.searchModel.results[0];\n\t\t\tthis.selectedProducts[result.record.Product2Id] = {\n\t\t\t\trecord: {Id: result.record.Product2Id, attributes: result.record.attributes, UnitPrice: result.record.UnitPrice},\n\t\t\t\tinvalid: false\n\t\t\t};\n\t\t\tthis.suggest = false;\n\t\t\tthis.onSelect();\n\t\t}\n\t}\n\n\thandleClearSelected() {\n\t\tthis.addEventListener('suggestion-loaded', function () {\n\t\t\tthis.$.lookupLayout.deSelectAll();\n\t\t}.bind(this));\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.selected === 'main') {\n\t\t\tfireEvent(Events.PANEL_CLOSED);\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearGSFields() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.suggester.searchFilterData));\n\t\tfor (let value in searchFilterData) {\n\t\t\tsearchFilterData[value].value = null;\n\t\t}\n\t\tthis.suggester.searchFilterData = searchFilterData;\n\t\tthis.searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t\tthis.$.gs.enterCallback = this.runSuggester.bind(this);\n\t\tthis.$.modalGroup.enterCallback = this.runSuggester.bind(this);\n\t}\n\n\t/**\n\t * this runs when a searchBar performs a search\n\t * this takes that searchModel with those results and applies them to the product lookup list\n\t * the value in the searchBar is also passed so that in mobile it can sync the value from the modal\n\t * @param e\n\t */\n\tsearchBarResultsChanged(e) {\n\t\tlet searchModel = e.detail.searchModel,\n\t\t\tsearchValue = e.detail.searchValue;\n\n\t\tthis.searchContext = searchValue;\n\t\tthis.searchedValue = searchValue;\n\t\tthis.$$('#headersearch').toggleResetButton(true);\n\t\tif(searchModel === undefined)\n\t\t\treturn;\n\n\t\tthis.searchModel = searchModel;\n\t}\n\n\t/**\n\t * this runs when an item is selected from the search drop down\n\t * it takes the result selected and updates the searchModel showing that 1 result\n\t * the value in the searchBar is also passed so that in mobile it can sync the value from the modal\n\t * @param e\n\t */\n\tsearchBarItemSelected(e) {\n\t\tlet item = e.detail.item,\n\t\t\tsearchModel = Object.assign({}, this.searchModel),\n\t\t\tsearchValue = e.detail.searchValue;\n\n\t\tthis.searchContext = searchValue;\n\t\tthis.searchedValue = searchValue; //this is to support keeping the search value there on filter\n\n\t\tif(item === undefined)\n\t\t\treturn;\n\n\t\tthis.$$('#headersearch').toggleResetButton(true);\n\n\t\tsearchModel.results = [item];\n\t\tsearchModel.totalCount = 1;\n\t\tthis.searchModel = searchModel;\n\t}\n\n\tsearchBarResetClicked() {\n\t\tthis.searchContext = ''; //clear the searchBar value\n\t\tthis.searchedValue = '';\n\t\tthis.$$('#headersearch').toggleResetButton(false); //disable the reset button\n\t\tthis.searchModel = Object.assign({}, this.onLoadSearchModel); //set the searchModel back to the model we first got when the page loaded\n\t}\n\n\tsearchBarNilSearchInvoked() {\n\t\tif (this.searcher.hasSearchFilterValues())\n\t\t\tthis.runSearcher();\n\t\telse\n\t\t\tthis.searchBarResetClicked();\n\t}\n\n\tresetSearchBar() {\n\t\tthis.searchContext = ''; //clear the searchBar value\n\t\tthis.searchedValue = '';\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.lookupObjects = ['Product2', 'PricebookEntry', this.prefix + 'ProcessInput__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\thideFilters(guidedOnly, searchFilters) {\n\t\treturn guidedOnly || searchFilters.every((filter) => filter.hidden);\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = formatError(this.errors);\n\t\tthis.spinner = false;\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n}\n\nPolymer(ProductLookup);\n","/**\n * A table cell meant for displaying summary data.\n */\nexport class LESummaryCell {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-cell';\n\t\tthis.properties = {\n\t\t\t// The model where all the data *should* belong.\n\t\t\tmodel: Object,\n\n\t\t\t// The field name of the summary for this field.\n\t\t\titem: String,\n\n\t\t\t// The summaries for the table.\n\t\t\tsummaries: Object,\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_setWidthStyleObserver(model.colWidth, item)'];\n\t}\n\n\t_getMD(editorModel, item) {\n\t\tconst md = editorModel.md.fieldsMap[editorModel.data.quoteLineObjectName][item];\n\t\tmd.CurrencyIsoCode = this.model.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\treturn md;\n\t}\n\n\t_getValue(summaries, item) {\n\t\treturn summaries[item.toLowerCase()];\n\t}\n\n\t_setWidthStyleObserver (colWidth, item) {\n\t\tif (colWidth === undefined || item === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._setWidthStyle(colWidth, item);\n\t}\n\n\t_setWidthStyle(colWidth, item) {\n\t\tthis.style.minWidth = `${colWidth.Standard[item]}px`;\n\t\tthis.style.maxWidth = this.style.minWidth;\n\t}\n}\n\nPolymer( LESummaryCell );\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class GroupTabs {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group-tabs';\n\n\t\tthis.properties = {\n\t\t\tisGroupFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupFieldPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPage(pageType)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildPage(groupModel)'];\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModel) {return;}\n\t\tthis.pageType = this.attributes.label.value;\n\t\tthis.pageComponent = 'sf-segmented-table';\n\t\tthis.groupObjectName = this.groupModel.groupObjectName;\n\t\tif (this.groupModel.groupMDQTabs) {\n\t\t\tthis.tabs = this.groupModel.groupMDQTabs;\n\t\t}\n\t\tthis.hideTabs = this.tabs ? this.tabs.length == 1 && this.tabs[0].key != 'Custom' : false;\n\n\t\tthis.containerClass = this.groupModel.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\n\t}\n\n\t_setIsGroupFieldPage(pageType) {\n\t\treturn pageType === \"details\";\n\t}\n\n\t_setIsStandardLinesPage(pageType) {\n\t\treturn pageType === \"standard\";\n\t}\n\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === \"segmented\";\n\t}\n}\n\nPolymer(GroupTabs);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport { Events } from 'common/core/Events.js';\n\nexport class QuoteTabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.EventBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-quote-tabs';\n\n\t\tthis.properties = {\n\t\t\tisQuoteFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsQuoteFieldPage(pageType)'\n\t\t\t},\n\t\t\tisGroupsPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupsPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPage(pageType, groupModel)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tgroupModels: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsegmentedCompName: String\n\t\t};\n\t}\n\n\t/** All global events this class will listen for */\n\tget events() {\n\t\tlet e = {};\n\t\te[Events.VIEWPORT_CHANGED] = this.viewportChanged;\n\t\treturn e;\n\t}\n\t\n\tget observers() {\n\t\treturn ['buildPage(groupModels)', '_groupModelsChanged(groupModels.*)'];\n\t}\n\n\t_groupModelsChanged(e) {\n\t\tif (this.groupModels.length == 1 && e.path != 'groupModels' && !this.groupModels[0].quoteModel.grouped) {\n\t\t\t// Remove first two parts of path which are usually groupsModels and then the index\n\t\t\t// Convert groupModels.#0 to groupModel for ungrouped quote\n\t\t\tlet parts = e.path.split('.');\n\t\t\tlet path = parts.splice(2, parts.length).join('.');\n\t\t\tthis.set('groupModel.' + path, e.value);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t\tthis.segmentedCompName = 'sf-segmented-table';\n\t}\n\n\tattached() {\n\t\tthis.resize();\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModels)\n\t\t\treturn;\n\n\t\tthis.pageType = this.attributes.label.value;\n\t\tif (this.pageType != 'details' && this.pageType != 'groups') {\n\t\t\tthis.groupModel = this.groupModels[0];\n\t\t\tthis.quoteModel = this.groupModel.quoteModel;\n\t\t}\n\t\tif (this.pageType == 'segmented' && this.groupModel.quoteMDQTabs) {\n\t\t\tthis.segmentedTabs = this.groupModel.quoteMDQTabs;\n\t\t}\n\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t// If it meets the above criteria, do not render the tab\n\t\tthis.hideTabs = this.segmentedTabs ? this.segmentedTabs.length == 1 && this.segmentedTabs[0].key != 'Custom' : false;\n\t\tthis.resize();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\thandleResize() {\n\t\twindow.addEventListener('resize', function(e) {\n\t\t\tthis.resize();\n\t\t}.bind(this));\n\t}\n\n\tresize() {\n\t\tif (this.domHost) {\n\t\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t\t// If it meets the above criteria, do not render the tab\n\t\t\tlet tabHeight = this.domHost.tabs.length == 1 && this.domHost.tabs[0].key != 'Custom'  ? 0 : 43;\n\t\t\tthis.layoutHeight = this.domHost.getBoundingClientRect().height - tabHeight + 'px';\n\t\t\tPolymer.dom(this).parentNode.style.height = this.layoutHeight;\n\t\t}\n\t}\n\n\t_setIsQuoteFieldPage(pageType) {\n\t\treturn pageType === 'details';\n\t}\n\n\t_setIsGroupsPage(pageType) {\n\t\treturn pageType === 'groups';\n\t}\n\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === 'segmented';\n\t}\n\n\t_setIsStandardLinesPage(pageType, groupModel) {\n\t\treturn pageType === 'standard' && groupModel;\n\t}\n}\n\nPolymer(QuoteTabs);","import {Page} from '../../../../common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {formatError} from 'common/data/format/ErrorFormatter.js';\nimport {ConnectionClient} from '../../../../common/data/client/ConnectionClient.js';\n\nexport class SubscriptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-subscription-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: String,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = this.$.smLoadService.quote = this.$.smSelectService.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t\tthis.maxSelectAll = (this.lineEditorModel.settings.usesClientAmendRenew) ? 500 : 100;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tlet existingLines = this.lineEditorModel.quote.lineItems;\n\t\t\tthis.lineEditorModel.quote = e.detail.value;\n\t\t\t// If using the JSQC, the Quote was sent without Lines, so we need to add them back here by joining them with the new Lines that were added\n\t\t\tif (this.lineEditorModel.settings.usesClientCalculator) {\n\t\t\t\tthis.lineEditorModel.quote.lineItems = existingLines.concat(this.lineEditorModel.quote.lineItems);\n\t\t\t}\n\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\trefocus() {\n\t\tthis.$.sf.focusFirstField();\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tthis.spinner = true;\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tif (this.lineEditorModel.settings.usesClientAmendRenew) {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\t// First, check that all of the window has everything we need.\n\t\t\t\t\tif (SB && SB.JSARSettings && SB.JSARServices && SB.JSARLineGenManager) {\n\t\t\t\t\t\t// Initialize our Settings object\n\t\t\t\t\t\tlet settings = new SB.JSARSettings(this.app.orgPrefix, this.lineEditorModel.amendRenewSettings);\n\t\t\t\t\t\t// Get a JSForce connection\n\t\t\t\t\t\tlet client = new ConnectionClient(this.app.orgPrefix);\n\t\t\t\t\t\tclient.getConnection()\n\t\t\t\t\t\t\t.then((conn) => {\n\t\t\t\t\t\t\t\t// Use the connection to create a Services object and a LineGenerationManager.\n\t\t\t\t\t\t\t\tlet services = SB.JSARServices.constructFromJsarSettings(conn, settings);\n\t\t\t\t\t\t\t\tlet lineGenManager = new SB.JSARLineGenManager(conn, settings, services);\n\n\t\t\t\t\t\t\t\t// Get the Quote and determine its Type.\n\t\t\t\t\t\t\t\tlet quote = this.lineEditorModel.quote;\n\t\t\t\t\t\t\t\tlet isRenewal = quote.record[this.prefix + 'Type__c'] === 'Renewal';\n\n\t\t\t\t\t\t\t\t// Get the Subscription IDs that we need to process.\n\t\t\t\t\t\t\t\tlet subIds = Object.keys(this.selectedProducts);\n\n\t\t\t\t\t\t\t\t// Invoke the line generation manager.\n\t\t\t\t\t\t\t\tlet invocationPromise = isRenewal\n\t\t\t\t\t\t\t\t\t? lineGenManager.renewSubscriptionsToQuote(subIds, quote, this.ctx.params.groupKey)\n\t\t\t\t\t\t\t\t\t: lineGenManager.amendSubscriptionsToQuote(subIds, quote, this.ctx.params.groupKey);\n\t\t\t\t\t\t\t\tinvocationPromise\n\t\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\t\tres(result);\n\t\t\t\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\t\t\t\trej(err.message || err);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\t\trej(err.message || err);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\trej('ERROR: Could not find Client-Side Amend/Renew');\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t\t\t.then((quote) => {\n\t\t\t\t\t\tquote.calculationRequired = true;\n\t\t\t\t\t\tthis.lineEditorModel.quote = quote;\n\t\t\t\t\t\tthis.navigateToLineEditor();\n\t\t\t\t\t}, (error) => {\n\t\t\t\t\t\tthis.errors = [error];\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$.smSelectService.selectedProducts = this.selectedProducts;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tthis.navigateToLineEditor();\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {'qId': this.lineEditorModel.quote.record.Id};\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet queryParams = {'qId': this.lineEditorModel.quote.record.Id };\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.sf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\t////we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.subscriptionLookupObjects = [this.prefix + 'Subscription__c', 'Contract'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.sf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = formatError(this.errors);\n\t\tthis.spinner = false;\n\t}\n\n}\n\nPolymer(SubscriptionLookup);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class OptionConfigurator {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-configure';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\toptionId: String,\n\t\t\tfeatureOptionalSKUs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tconfiguration: Object,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConfiguratorResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_loadObserver(quote, product, optionId, ignoreCache)'];\n\t}\n\n\tready() {\n\t\tlet service = this.$.service;\n\t\tservice.addEventListener('response-changed', function(e) {\n\t\t\tthis.optionConfiguratorResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tservice.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t_loadObserver (quote, product, optionId, ignoreCache) {\n\t\tif (quote === undefined || product === undefined || optionId === undefined || ignoreCache === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.load(quote, product, optionId, ignoreCache);\n\t}\n\t\n\tload() {\n\t\tthis.$.service.uid = this.optionId;\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\t\t// Since the service provider doesn't require quote lines, we can remove the lines from the model that gets sent\n\t\t// to the server.\n\t\tlet lineItems = this.quote.lineItems;\n\t\tthis.quote.lineItems = [];\n\t\tlet dataModel = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.add('optionId', this.optionId)\n\t\t\t.add('featureOptionalSKUs', this.featureOptionalSKUs)\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.addObject('parentProduct', this.serverProduct)\n\t\t\t.addObject('stagedOption', this.stagedOption);\n\t\t// Now that we've created a context that will be sent to the server, we mustn't forget to add the lines back to\n\t\t// the quote.\n\t\tthis.quote.lineItems = lineItems;\n\t\tthis.$.service.context = dataModel.build();\n\t}\n\n\t/**\n\t * Returns a simplified ProductVO to overcome the input too long error\n\t * @returns {Object}\n\t */\n\tget serverProduct() {\n\t\tlet serverProduct = {};\n\t\tserverProduct.configurationAttributes = this.product.configurationAttributes;\n\t\tserverProduct.inheritedConfigurationAttributes = this.product.inheritedConfigurationAttributes;\n\t\tif(this.product.configuration === undefined)\n\t\t\treturn serverProduct;\n\n\t\tserverProduct.configuration = {\n\t\t\tconfigurationData: this.product.configuration.configurationData,\n\t\t\tinheritedConfigurationData: this.product.configuration.inheritedConfigurationData\n\t\t};\n\n\t\treturn serverProduct;\n\t}\n\n\tget stagedOption() {\n\t\tif (this.product.nestedOptionModel == null || this.product.nestedOptionModel.stagedOption == null || this.product.nestedOptionModel.stagedOption.isDynamicOption)\n\t\t\treturn null;\n\t\treturn this.product.nestedOptionModel.stagedOption.optionData;\n\t}\n}\nPolymer(OptionConfigurator);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {QuoteMinimizer} from 'common/data/minimize/QuoteMinimizer.js';\nimport {QuoteAggregator} from 'common/aggregate/quote-aggregator/QuoteAggregator.js';\nimport {put} from 'quotes/models/SafeClientCache.js';\n\nexport class OptionSaver {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-save';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproducts: Array,\n\t\t\tconfiguration : Object,\n\t\t\tupgradeAssetId: String, //TODO: support UpgradeAssetId\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpsmResponse: { // is either a ProductSelectionModel or a ConfigurationVO depending on which method is called\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tstripLinesThreshold: Number,\n\t\t\tstripLinesMessage: String,\n\t\t\tcache: String //provides the ability to cache to response\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_topLevelSaveObserver(quote, products)', \n\t\t'_nestedConfigurationSaveObserver(quote, configuration)'];\n\t}\n\n\tready() {\n\t\tthis.setSpinnerMessage();\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tlet serverQuote = e.detail.value.quote;\n\t\t\t// The existence of serverQuote isn't guaranteed. If we're saving a nested bundle, we received a ProductConfigurationVO,\n\t\t\t// not a ProductSelectionModel. Only the latter will have a quote property.\n\t\t\tif (serverQuote && serverQuote.partialVO) {\n\t\t\t\tlet qa = new QuoteAggregator(this.quote, serverQuote, this.requiredKeys);\n\t\t\t\te.detail.value.quote = qa.reconcileServerQuoteWithUIQuote();\n\t\t\t}\n\t\t\tthis.psmResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * On load, the page sets the spinner message for async Large Bundle\n\t * Configuration operations. This message will appear below the spinner during\n\t * async operations.\n\t */\n\tsetSpinnerMessage() {\n\t\tconst message = 'Large bundle configuration enabled. It may take a minute to process your bundle.';\n\t\tput('RootState', 'spinnerMessage', message);\n\t}\n\n\t_topLevelSaveObserver (quote, products) {\n\t\tif (quote === undefined || products === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.topLevelSave(quote, products);\n\t}\n\t\n\ttopLevelSave() {\n\t\tif (this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\n\t\tlet builder = new DataBuilder();\n\t\tbuilder.addObject('products', this.products);\n\t\tif (this.groupKey != null && this.groupKey >= 0) {\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\t\t}\n\n\t\tif (this.stripLinesThreshold == null || this.quote.lineItems.length <= this.stripLinesThreshold) {\n\t\t\t// If no large quote threshold has been declared, or the quote's size is below that threshold, we can just\n\t\t\t// add the quote to the builder and be done.\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.$.service.model = builder.build();\n\t\t} else {\n\t\t\t// If the quote size exceeds the admin-declared large quote threshold, then we need to remove all non-essential\n\t\t\t// lines from the quote, and capture necessary data about the omitted lines.\n\t\t\tlet minimizer = new QuoteMinimizer(this.quote, this.products, this.groupkey, this.stripLinesThreshold, this.stripLinesMessage);\n\t\t\tthis.quote = minimizer.reduceQuote();\n\t\t\tthis.requiredKeys = minimizer.getRequiredKeys();\n\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.$.service.model = builder.build();\n\t\t\t// Now that we've sent the quote, we should remove all of the temporary attributes we added to it.\n\t\t\tthis.quote = minimizer.revertQuote();\n\t\t}\n\t}\n\n\t_nestedConfigurationSaveObserver (quote, configuration) {\n\t\tif (quote === undefined || configuration === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.nestedConfigurationSave(quote, configuration);\n\t}\n\t\n\tnestedConfigurationSave() {\n\t\tif(this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\t\t// The only line-level information required for saving nested configurations is the prior bundled quantity, which is\n\t\t// used to validate asset quantities. In order to avoid the massive scalability cost of sending all lines to the server,\n\t\t// we store the lines in a variable, remove them from the quote,a nd replace them with a map from line keys\n\t\t// to the prior bundled quantity.\n\t\tthis.quote.priorBundledQuantityByLineKey = new QuoteLineAggregator(this.quote).mapPriorBundledQuantityByLineKey();\n\t\tlet lines = this.quote.lineItems;\n\t\tthis.quote.lineItems = null;\n\t\tlet dataModel = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.add('upgradeAssetId', null);\n\t\t// After creating the model, we can reassign the lines and remove the map.\n\t\tthis.quote.lineItems = lines;\n\t\tdelete this.quote.priorBundledQuantityByLineKey;\n\t\t// Now we assign the model to the service to trigger the call.\n\t\tthis.$.service.model = dataModel.build();\n\t}\n}\nPolymer(OptionSaver);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {put} from 'quotes/models/SafeClientCache.js';\n\nexport class ProductLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-product-load';\n\t\tthis.properties = {\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfeatureOptionIds: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquote: Object,\n\t\t\tproduct: { //primarily used for test, may look to remove this in the future\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tproductLoadModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_loadObserver(quote, productIds, lineKey, ignoreCache)']\n\t}\n\n\tready() {\n\t\tthis.setSpinnerMessage();\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.featureOptionIds = null;\n\t\t\tthis.productLoadModel = e.detail && e.detail.value ? e.detail.value : null;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * On load, the page sets the spinner message for async Large Bundle\n\t * Configuration operations. This message will appear below the spinner during\n\t * async operations.\n\t */\n\tsetSpinnerMessage() {\n\t\tconst message = 'Large bundle configuration enabled. It may take a minute to process your bundle.';\n\t\tput('RootState', 'spinnerMessage', message);\n\t}\n\n\t_loadObserver (quote, productIds, lineKey, ignoreCache) {\n\t\tif (quote === undefined || productIds === undefined || lineKey === undefined || ignoreCache === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.load(quote, productIds, lineKey, ignoreCache);\n\t}\n\t\n\tload() {\n\t\tif (this.lineKey != null && this.lineKey >= 0 && this.lineKey > this.quote.nextKey)\n\t\t\treturn this.productLoadModel = { returnToQuote: 'The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it.' };\n\n\t\tvar products = [];\n\t\tvar pIds = this.productIds.split(',');\n\t\tpIds.forEach(function (pId) {\n\t\t\tproducts.push({record: {Id: pId}});\n\t\t});\n\t\tthis.$.service.context = undefined;\n\t\tthis.$.service.uid = this.featureOptionIds ? 'dynamic' : this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\n\t\tlet builder = new DataBuilder();\n\t\tif (this.featureOptionIds != null) {\n\t\t\tbuilder.add('featureOptionIds', this.featureOptionIds)\n\t\t\t\t.add('fieldSet', this.fieldSet);\n\t\t\t// If the feature option ID list isn't null, it's because we're loading dynamic options for a bundle.\n\t\t\t// In that case, we don't need any lines, and can just send the quote record.\n\t\t\tbuilder.addObject('quoteRecord', this.quote.record);\n\t\t} else if (this.lineKey != null && this.lineKey >= 0) {\n\t\t\tbuilder.add('lineKey', this.lineKey);\n\t\t\t// If the line key isn't null, it's because we're reconfiguring an existing bundle. So we should filter out\n\t\t\t// lines that aren't essential to that process.\n\t\t\tlet relevantLines = this._getLinesRelevantToParentKey(this.lineKey);\n\t\t\tlet allLines = this.quote.lineItems;\n\t\t\tthis.quote.lineItems = relevantLines;\n\t\t\t// On reconfigure, we need to pass in all null values as they may be meaningful when mapping to a product configuration\n\t\t\tbuilder.addObject('quote', this.quote, false, false, false);\n\t\t\tthis.quote.lineItems = allLines;\n\t\t} else {\n\t\t\tbuilder.addObject('products', products);\n\t\t\t// If there's no line key or feature option Ids, it means we're configuring a bundle that hasn't been actually\n\t\t\t// added to the quote yet. In that case, there's nothing that requires the lines, unless we decide we want to\n\t\t\t// support complete bundle upgrades outside of the 'Upgrade Assets' button. So we can just remove the lines from\n\t\t\t// the VO and send that.\n\t\t\tlet lineItems = this.quote.lineItems;\n\t\t\tthis.quote.lineItems = [];\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.quote.lineItems = lineItems;\n\t\t}\n\t\tif (this.groupKey != null && this.groupKey >= 0) {\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\t\t}\n\t\tthis.$.service.context = builder.build();\n\t}\n\n\t/**\n\t * Returns all lines related to the provided key, including the line itself, all of its descendants, source lines for\n\t * the aforementioned, and any of their descendents.\n\t * @param {Integer} key A top level key\n\t * @returns {Array} An array of all relevant quote lines\n\t * @private\n\t */\n\t_getLinesRelevantToParentKey(key) {\n\t\tlet prefix = this.quote.record.attributes.type == 'Quote__c' ? '' : this.quote.record.attributes.type.slice(0, -8);\n\t\tlet relevantLineKeys = new Set();\n\t\tlet addKeysRelevantTo = (lineKey) => {\n\t\t\t// Add the provided key to the set.\n\t\t\trelevantLineKeys.add(lineKey);\n\t\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\t\t// For each line whose parent item key is the provided key, add that line's key to the set.\n\t\t\t\tif (line.parentItemKey === lineKey) {\n\t\t\t\t\trelevantLineKeys.add(line.key);\n\t\t\t\t\t// If the child line has components, we make a recursive call to get those components.\n\t\t\t\t\tif (line.record[prefix + 'Bundle__c']) {\n\t\t\t\t\t\taddKeysRelevantTo(line.key);\n\t\t\t\t\t}\n\t\t\t\t\t// If the child line has a source line key, we make a recursive call to get all keys relevant to the source.\n\t\t\t\t\tif (line.sourceLineKey != null) {\n\t\t\t\t\t\taddKeysRelevantTo(line.sourceLineKey);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\taddKeysRelevantTo(key);\n\n\t\t// Now we have a set of all line keys that are in any way relevant to the top-level parent key. So get all lines\n\t\t// whose key is in that set.\n\t\tlet relevantLines = [];\n\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\tif (relevantLineKeys.has(line.key)) {\n\t\t\t\trelevantLines.push(line);\n\t\t\t}\n\t\t});\n\t\treturn relevantLines;\n\t}\n}\nPolymer(ProductLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {put} from 'quotes/models/SafeClientCache.js';\n\nexport class ProductRulesInvoker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-rules-invoke';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\tupgradeAssetId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tconfigResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_updateObserver(quote, product)'];\n\t}\n\n\tready() {\n\t\tthis.setSpinnerMessage();\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\n\t\t\tthis.configResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * On load, the page sets the spinner message for async Large Bundle\n\t * Configuration operations. This message will appear below the spinner during\n\t * async operations.\n\t */\n\tsetSpinnerMessage() {\n\t\tconst message = 'Large bundle configuration enabled. It may take a minute to process your bundle.';\n\t\tput('RootState', 'spinnerMessage', message);\n\t}\n\n\t_updateObserver (quote, product) {\n\t\tif (quote === undefined || product === undefined ) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.update(quote, product);\n\t}\n\t\n\tupdate() {\n\t\t// in case this product is a cloned product, set the configuration key to product's key (or if not set simply set to the configuredProductId)\n\t\tthis.product.configuration.configuredProductKey = this.product.productKey || this.product.configuration.configuredProductId;\n\t\t// The only line-level information required for product configuration rules is the prior bundled quantity, which is used\n\t\t// to validate asset quantities. In order to avoid the massive scalability cost of sending all quote lines to the server,\n\t\t// we store the lines in a variable, remove them from the quote, and replace them with a map from line keys\n\t\t// to the prior bundled quantity.\n\t\tthis.quote.priorBundledQuantityByLineKey = new QuoteLineAggregator(this.quote).mapPriorBundledQuantityByLineKey();\n\t\tlet lines = this.quote.lineItems;\n\t\tthis.quote.lineItems = null;\n\t\tthis.$.service.model = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote, true)\n\t\t\t.addObject('configuration', this.product.configuration)\n\t\t\t.add('upgradeAssetId', this.upgradeAssetId)\n\t\t\t.build();\n\t\t// After making the service call, reassign the lines back to the quote.\n\t\tthis.quote.lineItems = lines;\n\t\tdelete this.quote.priorBundledQuantityByLineKey;\n\t}\n}\nPolymer(ProductRulesInvoker);"]}