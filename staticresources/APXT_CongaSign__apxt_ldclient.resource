!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.LDClient={})}(this,function(e){"use strict";var t,n=(function(e,t){!function(){var e=t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var t,o,i=String(e),a=0,u=n,s="";i.charAt(0|a)||(u="=",a%1);s+=u.charAt(63&t>>8-a%1*8)){if((o=i.charCodeAt(a+=.75))>255)throw new r("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|o}return s}),e.atob||(e.atob=function(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,u=0,s="";i=t.charAt(u++);~i&&(o=a%4?64*o+i:i,a++%4)?s+=String.fromCharCode(255&o>>(-2*a&6)):0)i=n.indexOf(i);return s})}()}(t={exports:{}},t.exports),t.exports),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function o(e){return n.btoa(unescape(encodeURIComponent(e)))}function i(e){return o(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(e){return JSON.parse(JSON.stringify(e))}function u(e){setTimeout(e,0)}function s(e,t){var n=e.then(function(e){return t&&setTimeout(function(){t(null,e)},0),e},function(e){if(!t)return Promise.reject(e);setTimeout(function(){t(e,null)},0)});return t?void 0:n}function c(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]={value:e[n],version:0});return t}function l(e){e.setRequestHeader("X-LaunchDarkly-User-Agent","JSClient/2.4.0")}function v(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return r({},e,t)},{})}var f=2e3;function d(e,t,n,r){var o=void 0,a=e+"/events/bulk/"+t,u=e+"/a/"+t+".gif",s={};function c(e,t){var n=new Image;t&&n.addEventListener("load",t),n.src=e}function v(e,t,n){var o=r||c,s=function(r){if(t){var s=new XMLHttpRequest;s.open("POST",a,!n),l(s),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-LaunchDarkly-Event-Schema","3"),n||s.addEventListener("load",function(){r(function(e){var t={status:e.status},n=e.getResponseHeader("Date");if(n){var r=Date.parse(n);r&&(t.serverTime=r)}return t}(s))}),s.send(JSON.stringify(e))}else{var c=u+"?d="+i(JSON.stringify(e));o(c,n?null:r)}};if(!n)return new Promise(function(e){s(e)});s()}return s.sendEvents=function(t,r){void 0===o&&(o=void 0===n?"withCredentials"in new XMLHttpRequest:n);var a=void 0!==r&&r,u=void 0;u=o?[t]:function(e,t){for(var n=t.slice(0),r=[],o=e,a=void 0;n.length>0;){for(a=[];o>0;){var u=n.shift();if(!u)break;(o-=i(JSON.stringify(u)).length)<0&&a.length>0?n.unshift(u):a.push(u)}o=e,r.push(a)}return r}(f-e.length,t);for(var s=[],c=0;c<u.length;c++)s.push(v(u[c],o,a));return r?Promise.resolve():Promise.all(s)},s}var p=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",g=function(){return"localStorage is unavailable"},y=function(e){return'Custom event "'+e+'" does not exist'},h=function(){return"environment not found."+p},m=function(){return"No environment specified."+p},k=function(e){return"Error fetching flag settings: "+(e.message||e)},w=function(){return"No user specified."+p},b=function(){return"Invalid user specified."+p},E=function(e,t){return'[LaunchDarkly] "'+e+'" is deprecated, please use "'+t+'"'},S=function(e,t,n){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+t+" - "+(errors.isHttpErrorRecoverable(e)?n:"giving up permanently")};function D(e){var t={},n=void 0!==e.allAttributesPrivate?e.allAttributesPrivate:e.all_attributes_private,r=(void 0!==e.privateAttributeNames?e.privateAttributeNames:e.private_attribute_names)||[],o={key:!0,custom:!0,anonymous:!0},i={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return void 0!==e.all_attributes_private&&console&&console.warn&&console.warn(E("all_attributes_private","allAttributesPrivate")),void 0!==e.private_attribute_names&&console&&console.warn&&console.warn(E("private_attribute_names","privateAttributeNames")),t.filterUser=function(e){if(!e)return null;var t=e.privateAttributeNames||[],a=function(e,i){return Object.keys(e).reduce(function(a,u){var s=a;return i(u)&&(!function(e){return!o[e]&&(n||-1!==t.indexOf(e)||-1!==r.indexOf(e))}(u)?s[0][u]=e[u]:s[1][u]=!0),s},[{},{}])},u=a(e,function(e){return i[e]}),s=u[0],c=u[1];if(e.custom){var l=a(e.custom,function(){return!0});s.custom=l[0],c=v({},c,l[1])}var f=Object.keys(c);return f.length&&(f.sort(),s.privateAttrs=f),s},t}function N(e){function t(e,t){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=t}return t.prototype=new Error,t.prototype.name=e,t.prototype.constructor=t,t}var O=N("LaunchDarklyUnexpectedResponseError"),R=N("LaunchDarklyInvalidEnvironmentIdError"),U=N("LaunchDarklyInvalidUserError"),T=N("LaunchDarklyInvalidEventKeyError"),L=N("LaunchDarklyInvalidArgumentError"),x=N("LaunchDarklyFlagFetchError");function P(e,t){var n,r,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c={},l=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:null)||d(e,t),f=(r=0,o=0,i={},(n={}).summarizeEvent=function(e){if("feature"===e.kind){var t=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),n=i[t];n?n.count=n.count+1:i[t]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===r||e.creationDate<r)&&(r=e.creationDate),e.creationDate>o&&(o=e.creationDate)}},n.getSummary=function(){var e={},t=!0;for(var n in i){var a=i[n],u=e[a.key];u||(u={default:a.default,counters:[]},e[a.key]=u);var s={value:a.value,count:a.count};void 0!==a.variation&&null!==a.variation&&(s.variation=a.variation),a.version?s.version=a.version:s.unknown=!0,u.counters.push(s),t=!1}return t?null:{startDate:r,endDate:o,features:e}},n.clearSummary=function(){r=0,o=0,i={}},n),p=D(a),g=!!a.inlineUsersInEvents,y=[],h=void 0,m=void 0,k=0,w=!1,b=void 0;function E(e){u(function(){s&&s.maybeReportError(new L(e))})}function N(){return 0===m||0===Math.floor(Math.random()*m)}return void 0!==a.samplingInterval&&(isNaN(a.samplingInterval)||a.samplingInterval<0)?(m=0,E("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")):m=a.samplingInterval||0,void 0!==a.flushInterval&&(isNan(a.flushInterval)||a.flushInterval<2e3)?(h=2e3,E("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")):h=a.flushInterval||2e3,c.enqueue=function(e){if(!w){var t,n=!1,r=!1;if(f.summarizeEvent(e),"feature"===e.kind?N()&&(n=!!e.trackEvents,r=!!(t=e).debugEventsUntilDate&&t.debugEventsUntilDate>k&&t.debugEventsUntilDate>(new Date).getTime()):n=N(),n&&y.push(function(e){var t=v({},e);return g||"identify"===e.kind?t.user=p.filterUser(e.user):(t.userKey=e.user.key,delete t.user),"feature"===e.kind&&(delete t.trackEvents,delete t.debugEventsUntilDate),t}(e)),r){var o=v({},e,{kind:"debug"});delete o.trackEvents,delete o.debugEventsUntilDate,delete o.variation,y.push(o)}}},c.flush=function(e){if(w)return Promise.resolve();var t=y,n=f.getSummary();return f.clearSummary(),n&&(n.kind="summary",t.push(n)),0===t.length?Promise.resolve():(y=[],l.sendEvents(t,e).then(function(e){var t;e&&(e.serverTime&&(k=e.serverTime),(t=e.status)>=400&&t<500&&408!==t&&429!==t&&(w=!0),e.status>=400&&u(function(){s.maybeReportError(new O(S(e.status,"event posting","some events were dropped")))}))}))},c.start=function(){b=setTimeout(function e(){c.flush(),b=setTimeout(e,h)},h)},c.stop=function(){clearTimeout(b)},c}function I(){var e={},t={};return e.on=function(e,n,r){t[e]=t[e]||[],t[e]=t[e].concat({handler:n,context:r})},e.off=function(e,n,r){if(t[e])for(var o=0;o<t[e].length;o++)t[e][o].handler===n&&t[e][o].context===r&&(t[e]=t[e].slice(0,o).concat(t[e].slice(o+1)))},e.emit=function(e){if(t[e])for(var n=0;n<t[e].length;n++)t[e][n].handler.apply(t[e][n].context,Array.prototype.slice.call(arguments,1))},e.maybeReportError=function(e){e&&(t["error"]?this.emit("error",e):console.error(e.message))},e}var C=/[|\\{}()[\]^$+*?.]/g,A=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(C,"\\$&")};function F(e,t,n,r){var o=t.replace(n,"").replace(r,""),i=void 0,a=void 0;switch(e.kind){case"exact":a=t,i=new RegExp("^"+A(e.url)+"/?$");break;case"canonical":a=o,i=new RegExp("^"+A(e.url)+"/?$");break;case"substring":a=o,i=new RegExp(".*"+A(e.substring)+".*$");break;case"regex":a=o,i=new RegExp(e.pattern);break;default:return!1}return i.test(a)}function j(e,t){for(var n={},r=null,o=[],i=0;i<e.length;i++)for(var a=e[i],u=a.urls||[],s=0;s<u.length;s++)if(F(u[s],location.href,location.search,location.hash)){"pageview"===a.kind?t("pageview",a):(o.push(a),t("click_pageview",a));break}return o.length>0&&(r=function(e){for(var n=function(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=e.target,i=t[r],a=i.selector,u=document.querySelectorAll(a);o&&u.length>0;){for(var s=0;s<u.length;s++)o===u[s]&&n.push(i);o=o.parentNode}return n}(e,o),r=0;r<n.length;r++)t("click",n[r])},document.addEventListener("click",r)),n.dispose=function(){document.removeEventListener("click",r)},n}var J="application/json";function _(e,t,n){var r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&r.getResponseHeader("Content-type")&&0===r.getResponseHeader("Content-Type").lastIndexOf(J)?n(null,JSON.parse(r.responseText)):n(q(r))}),r.addEventListener("error",function(){n(q(r))}),t?(r.open("REPORT",e),r.setRequestHeader("Content-Type","application/json"),l(r),r.send(JSON.stringify(t))):(r.open("GET",e),l(r),r.send()),r}function q(e){return 404===e.status?new R(h()):e.statusText}function H(e,t){var n={},r=void 0;return n.setUser=function(e){r=function(e){var t=a(e);return t.key&&(t.key=t.key.toString()),t}(e),t(a(r))},n.getUser=function(){return r?a(r):null},e&&n.setUser(e),n}var M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$="ready",z="change",G="goalsReady",X=300;function B(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.baseUrl||"https://app.launchdarkly.com",a=n.eventsUrl||"https://events.launchdarkly.com",l=n.streamUrl||"https://clientstream.launchdarkly.com",f=n.hash,d=void 0===n.sendEvents||n.sendEvents,p=!!n.allowFrequentDuplicateEvents,h=!!n.sendEventsOnlyForVariation,E=e,S=I(),D=function(e,t,n,r){var o={},a=e+"/eval/"+t+"/",u=null;return o.connect=function(o,s){if("undefined"!=typeof EventSource){var c=void 0;for(var l in r?c=e+"/ping/"+t:(c=a+i(JSON.stringify(o)),null!==n&&void 0!==n&&(c=c+"?h="+n)),u=new window.EventSource(c),s)s.hasOwnProperty(l)&&u.addEventListener(l,s[l])}},o.disconnect=function(){u&&u.close()},o.isConnected=function(){return u&&(u.readyState===EventSource.OPEN||u.readyState===EventSource.CONNECTING)},o}(l,E,f,n.useReport),N=n.eventProcessor||P(a,E,n,S),L=function(e,t,n){var r=void 0,o=void 0,a={fetchFlagSettings:function(a,u,s){var c=void 0,l=void 0,v=void 0,f=void 0;n?(l=[e,"/sdk/evalx/",t,"/user",u?"?h="+u:""].join(""),v=a):(c=i(JSON.stringify(a)),l=[e,"/sdk/evalx/",t,"/users/",c,u?"?h="+u:""].join(""));var d,p,g=(d=s,function(e,t){d(e,t),r=null,o=null});r?(r.abort(),p=o,f=function(){p&&p.apply(null,arguments),g.apply(null,arguments)}):f=g,o=f,r=_(l,v,f)},fetchGoals:function(n){_([e,"/sdk/goals/",t].join(""),null,n)}};return a}(r,E,n.useReport),C={},A="object"===M(n.bootstrap)?c(n.bootstrap):{},F=void 0,J=void 0,q=void 0,B=void 0,K=!0;function V(){return d&&!function(){var e=void 0;e=navigator&&void 0!==navigator.doNotTrack?navigator.doNotTrack:navigator&&void 0!==navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack;return"1"===e||"yes"===e}()}function Y(e){e.user?(K=!1,V()&&N.enqueue(e)):K&&(console&&console.warn&&console.warn("Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"),K=!1)}var Q=H(t,function(e){e&&Y({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}),W=function(e,t,n){var r={};function i(){var r="",i=n.getUser();return i&&(r=t||o(JSON.stringify(i))),"ld:"+e+":"+r}return r.loadFlags=function(){var e=i(),t=void 0,n=void 0;try{t=localStorage.getItem(e)}catch(e){return console.warn(g()),null}try{n=JSON.parse(t)}catch(e){return r.clearFlags(),null}if(n){var o=n.$schema;(void 0===o||o<1)&&(n=c(n))}return n},r.saveFlags=function(e){var t=i(),n=v({},e,{$schema:1});try{localStorage.setItem(t,JSON.stringify(n))}catch(e){console.warn(g())}},r.clearFlags=function(){var e=i();try{localStorage.removeItem(e)}catch(e){}},r}(E,f,Q);function Z(e,t,n){var r=Q.getUser(),o=new Date;if(!p){var i=JSON.stringify(t)+(r&&r.key?r.key:"")+e,a=C[i];if(a&&o-a<3e5)return;C[i]=o}var u={kind:"feature",key:e,user:r,value:t,default:n,creationDate:o.getTime()},s=A[e];s&&(u.version=s.flagVersion?s.flagVersion:s.version,u.variation=s.variation,u.trackEvents=s.trackEvents,u.debugEventsUntilDate=s.debugEventsUntilDate),Y(u)}function ee(e,t){var n={kind:e,key:t.key,data:null,url:window.location.href,user:Q.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(n.selector=t.selector),Y(n)}function te(e,t,n){var r=void 0;return r=A&&A.hasOwnProperty(e)&&A[e]&&!A[e].deleted?null===A[e].value?t:A[e].value:t,n&&Z(e,r,t),r}function ne(){Q.getUser()&&(D.disconnect(),D.connect(Q.getUser(),{ping:function(){L.fetchFlagSettings(Q.getUser(),f,function(e,t){e&&S.maybeReportError(new x(k(e))),re(t)})},put:function(e){re(JSON.parse(e.data))},patch:function(e){var t=JSON.parse(e.data),n=A[t.key];if(!n||!n.version||!t.version||n.version<t.version){var r={},o=v({},t);delete o.key,A[t.key]=o,r[t.key]=n?{previous:n.value,current:t.value}:{current:t.value},oe(r)}},delete:function(e){var t=JSON.parse(e.data);if(!A[t.key]||A[t.key].version<t.version){var n={};A[t.key]&&!A[t.key].deleted&&(n[t.key]={previous:A[t.key].value}),A[t.key]={version:t.version,deleted:!0},oe(n)}}}))}function re(e){var t={};if(e){for(var n in A)A.hasOwnProperty(n)&&A[n]&&(e[n]&&e[n].value!==A[n].value?t[n]={previous:A[n].value,current:e[n].value}:e[n]&&!e[n].deleted||(t[n]={previous:A[n].value}));for(var r in e)e.hasOwnProperty(r)&&e[r]&&(!A[r]||A[r].deleted)&&(t[r]={current:e[r].value});A=e,oe(t)}}function oe(e){var t=Object.keys(e);J&&W.saveFlags(A),t.length>0&&(t.forEach(function(t){S.emit(z+":"+t,e[t].current,e[t].previous)}),S.emit(z,e),h||t.forEach(function(t){Z(t,e[t].current)}))}function ie(){F&&F.dispose(),q&&q.length&&(F=j(q,ee))}function ae(){d&&N.start()}e||u(function(){S.maybeReportError(new R(m()))}),t?t.key||u(function(){S.maybeReportError(new U(b()))}):u(function(){S.maybeReportError(new U(w()))}),"object"===M(n.bootstrap)?u(function(){S.emit($)}):"string"==typeof n.bootstrap&&"LOCALSTORAGE"===n.bootstrap.toUpperCase()&&localStorage?(J=!0,null===(A=W.loadFlags())?(A={},L.fetchFlagSettings(Q.getUser(),f,function(e,t){e&&S.maybeReportError(new x(k(e))),t?(A=t,W.saveFlags(A)):A={},S.emit($)})):(u(function(){S.emit($)}),L.fetchFlagSettings(Q.getUser(),f,function(e,t){e&&S.maybeReportError(new x(k(e))),t&&W.saveFlags(t)}))):L.fetchFlagSettings(Q.getUser(),f,function(e,t){e&&S.maybeReportError(new x(k(e))),A=t||{},S.emit($)}),L.fetchGoals(function(e,t){e&&S.maybeReportError(new O((e.message,e.message))),t&&t.length>0&&(F=j(q=t,ee),function(e,t){var n=location.href,r=void 0;function o(){(r=location.href)!==n&&(n=r,t())}!function e(t,n){t(),setTimeout(function(){e(t,n)},n)}(o,e),window.history&&history.pushState?window.addEventListener("popstate",o):window.addEventListener("hashchange",o)}(X,ie)),S.emit(G)}),"complete"!==document.readyState?window.addEventListener("load",ae):ae(),window.addEventListener("beforeunload",function(){d&&(N.stop(),N.flush(!0))}),window.addEventListener("message",function(e){if(e.origin===r&&"SYN"===e.data.type){window.editorClientBaseUrl=r;var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=r+e.data.editorClientUrl;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}});var ue=new Promise(function(e){var t=S.on($,function(){S.off($,t),e()})}),se=new Promise(function(e){var t=S.on(G,function(){S.off(G,t),e()})});return{waitUntilReady:function(){return ue},waitUntilGoalsReady:function(){return se},identify:function(e,t,n){return J&&W.clearFlags(),s(new Promise(function(n,r){if(e&&null!==e.key&&void 0!==e.key)Q.setUser(e),L.fetchFlagSettings(Q.getUser(),t,function(e,t){if(e)return S.maybeReportError(new x(k(e))),r(e);t&&re(t),n(t),B&&ne()});else{var o=new U(e?b():w());S.maybeReportError(o),r(o)}}),n)},variation:function(e,t){return te(e,t,!0)},track:function(e,t){"string"==typeof e?(q&&!function(e){if(!q||0===q.length)return!1;for(var t=0;t<q.length;t++)if("custom"===q[t].kind&&q[t].key===e)return!0;return!1}(e)&&console.warn(y(e)),Y({kind:"custom",key:e,data:t,user:Q.getUser(),url:window.location.href,creationDate:(new Date).getTime()})):S.maybeReportError(new T(y(e)))},on:function(e,t,n){e.substr(0,z.length)===z?(B=!0,D.isConnected()||ne(),S.on.apply(S,[e,t,n])):S.on.apply(S,Array.prototype.slice.call(arguments))},off:function(e){e===z&&(B=!0)&&(B=!1,D.disconnect()),S.off.apply(S,Array.prototype.slice.call(arguments))},flush:function(e){return s(new Promise(function(e){return d?e(N.flush()):e()},e))},allFlags:function(){var e={};if(!A)return e;for(var t in A)A.hasOwnProperty(t)&&(e[t]=te(t,null,!h));return e}}}var K={initialize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return console&&console.warn&&console.warn(E("default export","named LDClient export")),B(e,t,n)},version:"2.4.0"};e.initialize=B,e.version="2.4.0",e.default=K,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ldclient.min.js.map
