<apex:page tabStyle="kugo2p__AdditionalProductDetail__c" standardcontroller="kugo2p__AdditionalProductDetail__c" extensions="kugo2p.SelectProductKitBundleExt" id="selectProductPageId" sidebar="true">

<apex:stylesheet value="{!URLFOR($Resource.kugo2p__SLDS, 'assets/styles/salesforce-lightning-design-system-vf.min.css')}" />
<style>
    .alignCenter {
        text-align: center;
    }
    .alignRight {
        text-align: right;
    }
    .selectButtons {
        text-align:center;
        margin-bottom: 1em;
    }
    
    .inputTitle {
        font-weight:bold;
    }   
    
    .searchFilterFields .keywordElement {
        border-right:3px solid #EEEEEE;
        white-space:normal;
    }   
    
    .searchFilterFields .searchFilterSelectionElement, .searchFilterFields .productButtons {
        text-align:left;
    }   
    
    .searchFilterFields .productButtons {
        margin-top:-11px;
        padding-bottom:5px;
    }   

    body .bRelatedList .bPageBlock .pbTitle{
        padding: 0 5px;
    }   
    
     #statusBox {
        // for Modzilla
        -moz-background-clip:border;
        -moz-background-inline-policy:continuous;
        -moz-background-origin:padding;
        -moz-border-radius-bottomleft:5px;
        -moz-border-radius-bottomright:5px;
        -moz-border-radius-topleft:5px;
        -moz-border-radius-topright:5px;
        -moz-box-shadow:1px 6px 5px #888888;
        
        -webkit-border-bottom-left-radius:5px;
        -webkit-border-bottom-right-radius:5px;
        -webkit-border-top-left-radius:5px;
        -webkit-border-top-right-radius:5px;
        -webkit-box-shadow:1px 6px 5px #888888;
        
        box-shadow: 1px 6px 5px #888888;
        
        background:#FFFFFF none repeat scroll 0 0;
        height:42px;
        width:150px;
        left:45%; //570px;
        top:265px;
        padding-left:15px;
        padding-top:11px;
        position:absolute;
        vertical-align:middle;
    }
    #textBox {
        margin-left:40px;
        margin-top:-20px;
    }    
</style> 

    <!-- 
    <apex:sectionHeader title="{!kugo2p__AdditionalProductDetail__c.Name}" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}"
        subtitle="Kit/Bundle Member Selection" help="/help/doc/user_ed.jsp?loc=help&target=products_add.htm&section=Products"/>
    -->
    
    <apex:outputPanel rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}" >
        <c:PageHeader title="{!kugo2p__AdditionalProductDetail__c.Name}" subtitle="Add Kit/Bundle Members" pathname="custom" icon="custom94" 
                    description="Enter your keyword and filter criteria, then click Search to begin your search. Click More filters to use more than one filter. Search results include all records that match both your keyword and filter entries." />
    </apex:outputPanel>

    <apex:form id="selectionProductFormId" onkeypress="onEnter(event);">

        <!-- 
        <apex:outputPanel id="Title" layout="block" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}" >
        <div class="bOverviewSearch">
            <div class="view">
            Enter your keyword and filter criteria, then click Search to begin your search. Click More filters to use more than one filter. Search results include all records that match both your keyword and filter entries. 
            </div>
            <div class="messages">  </div>
        </div>
        </apex:outputPanel>
        --> 

        <script>
            var intGlobalPageCounter = 0; 
            var intMoreFiletersExpanded = 0;
            var intSelectedItemsCount = 0;
            var intCurrentPageSelectedItemsCount = 0;
        </script>   
    
     <apex:outputPanel id="pageMessages2">        
        <apex:pageMessages id="msg" />
    
        <!-- Display error message -->
        <apex:pagemessage id="pageMessages" strength="2" title="Error:" severity="error" detail="You must select at least a Product to proceed" rendered="{!ShowError}"/>
        <!-- End of error message -->   
         
     </apex:outputPanel>
   
            
    <!-- &nbsp; 
      -- Comment/Uncomment one of the following two lines to enable debugging in page controller.
      --    DEGUGTRUE = Show SOQL statement and results of query
      -->
    <!-- <apex:inputHidden id="DebugSetting" value="{!SetDebugModeTRUE}"/>    -->
    <apex:inputHidden id="DebugSetting" value="{!SetDebugModeFALSE}"/>
        
    <apex:actionStatus id="counterStatus" onstart="document.body.style.cursor = 'wait'; " onstop="document.body.style.cursor = 'default'; setHeaderCheckBox(1); " />
            
    <apex:actionStatus id="sortStatus">
        <apex:facet name="start">
            <div id="salesforceSource_blurybackground" style="position:absolute; left:0px; top:0px; width:100%; height:200%; text-align:center; vertical-align: middle; background-color: #dcdcdc; opacity:0.6;filter:alpha(opacity=60)">
            </div>

             <div id="statusBox">
                <img src="/img/loading32.gif" />
                <div id="textBox">Processing...</div>
            </div>

        </apex:facet>
    </apex:actionStatus>    

    <apex:actionStatus startText=""  id="busyStatus" 
              onStart="document.body.style.cursor = 'wait';return true;" 
               onStop="document.body.style.cursor = 'default';setHeaderCheckBox(1);return true;" >
    </apex:actionStatus>
        
    <apex:actionFunction name="setSearchOperatorList" action="{!ResetSearchOperator}" reRender="o331" status="busyStatus"/>
    <apex:actionfunction name="afdoSearch" action="{!doSearch}" status="counterStatus"/>
    
    <apex:actionfunction name="previousCall" action="{!PreviousBtnClick}" rerender="Results,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext"  status="busyStatus"/>
    <apex:actionfunction name="nextCall" action="{!NextBtnClick}" rerender="Results,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext" status="busyStatus"/>
                  
    <div class="selectButtons kugamon">
        <apex:commandButton id="AddId" value="Add & Close" action="{!Add}" styleClass="slds-button slds-button--brand" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}"/>       
        <apex:commandButton value="Add & More" action="{!AddMoreProducts}" styleClass="slds-button slds-button--neutral" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}" />
        <apex:commandButton value="Cancel" action="{!cancel}" styleClass="slds-button slds-button--neutral" />
    </div>

    <apex:outputPanel id="Header" layout="block" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}" >
    <div id="PricebookEntry" class="bRelatedList">        
    <div class="listRelatedObject pricebookentryBlock">        
    <div class="bPageBlock secondaryPalette" id="pgBlock"> 
        <div class="pbHeader" id="pnlsearch">
            <table >
                <tbody>
                    <tr>
                        <td class="pbTitle">
                            <img height="1" width="1" title="" class="minWidth" alt="" src="/s.gif"/>
                            <img title="" class="relatedListIcon" alt="" src="/s.gif"/>
                            <h3>
                                &nbsp;<span >Find Products [<apex:outputpanel id="itemGrid">{!searchResultsSize}</apex:outputpanel>]</span>
                            </h3>
                        </td>
                        
                        <td class="pbButton">&nbsp;</td>
                        
                        <td class="pbHelp">
                           
                           <span >
                           <div>        
                               <b>Records Per Page</b> &nbsp;
                               <apex:actionFunction name="changePagesize" action="{!changePagesize}" rerender="Results" status="sortStatus"/>
                               <apex:selectList id="chooseSize" value="{!pageSize}" size="1" onchange="changePagesize();" style="font-size:8pt">
                                    <apex:selectOption itemValue="10" itemLabel="10"/>
                                    <apex:selectOption itemValue="25" itemLabel="25"/>
                                    <apex:selectOption itemValue="50" itemLabel="50"/>
                                    <apex:selectOption itemValue="100" itemLabel="100"/>
                                    <apex:selectOption itemValue="200" itemLabel="200"/>
                                    <apex:selectOption itemValue="300" itemLabel="300"/>
                                    <apex:selectOption itemValue="400" itemLabel="400"/>
                               </apex:selectList>                          
                           </div>                                              
                           </span>
                        </td>
                                                            
                    </tr>
                    
                    <tr>
    
                        <td colspan="3">
                            <div class="searchFilterFieldsHolder searchFilterFieldsHolderFirst">
                            
                            <table  class="searchFilterFields" id="idsearchFilterFields" >
                            
                            <tbody>
    
                            <!-- First Line  -->
                            <tr>
                                
                                <td class="keywordElement" style="width: 5%;">
                                    
                                    <br/>
                                    <span class="inputTitle">By Keyword</span>
                                    
                                    
                                      <span id="bySearchKeyWord">   
                                        <apex:inputText id="SearchKeyWord" value="{!searchKeyWord}" style="width:150px;font-size:8pt" onblur="javascript:CheckLength(this)"></apex:inputText>                                            
                                      </span>
                                        
                                    &nbsp;
                                </td>           
                
                    
                                <!-- Search Filters  -->
                                <td >   
                                            
                                    <div class="searchFilterSelectionElement" >
                                    
                                    <table  class="searchFilterSelectionElement" id="tableFilrerId">    <!-- cellspacing="0" cellpadding="0"  border="0"  -->
                             

                                        <tr>
                                             <td ><b>By Field Filter</b></td>   <!-- style="text-align:left;padding-right:0;font-size:8pt;" -->
                                             <td style="text-align:left;font-size:8pt"></td>
                                             <td style="text-align:left;font-size:8pt"></td>
                                         </tr>                                      

                                         
                                         <apex:repeat value="{!searchCriteria}" var="criteria" id="theRepeat">
                                         <tr id="TR1" style="{!criteria.style}">
                                              <td valign="top" style="text-align:left" width="106px"> 
                                              
                                                  <apex:selectList value="{!criteria.searchField}" size="1" onchange="updateOperator();" style="width:150px;font-size:8pt">
                                                      <apex:selectOptions value="{!searchFields}"></apex:selectOptions>
                                                  </apex:selectList>
                                              </td> 
                                                                        
                                              <td valign="top" style="text-align:left" width="106px">
                                              <apex:selectList id="o331" value="{!criteria.searchOperator}" size="1" style="font-size:8pt;width:120px">
                                              <apex:selectOptions value="{!criteria.SearchOperatorList}"></apex:selectOptions>
                                              </apex:selectList>                       
                                              </td>
                                              <td id="tdtxt" style="text-align:left" width="106px" >
                                                 <apex:inputText id="displayid" value="{!criteria.searchValue}" style="display:none"></apex:inputText>
                                                 <apex:inputText id="o341" value="{!criteria.searchValue}" style="width:150px;font-size:8pt"></apex:inputText>  
                                              </td>
                                                                                              
                                              <td style="font-size:12px;font-family:Arial;vertical-align:middle;text-align:left;font-size:8pt;" >   
                                                <a href="javascript:void(0)" id="showMoreFilters" onclick="showMoreFilters(this);" style="white-space: nowrap;">More Filters >></a> 
                                              </td>
                                          </tr>
                                          </apex:repeat>   
                                          
                                      </table>  
                                      </div>    
                                              
                                          
                                </td>
                    
                              </tr>
                              
                              <!-- Second Line  -->
                            <tr>
                                <td colspan="3">
                                <div class="searchFilterButtons productButtons">
                                    <apex:outputPanel styleClass="kugamon">
                                        <apex:commandButton value="Search" onclick="checkProductSelection();" id="go" styleClass="slds-button slds-button--neutral" reRender="Results,pnlsearch,itemGrid,pageMessages2,pageMessages" status="busyStatus"/>
                                    </apex:outputPanel>     
                                        &nbsp;
                                     <apex:commandLink value="Clear Filters" style="font-family:Arial;vertical-align:middle;text-align:left;font-size:8pt;" onclick="clearFilters();" id="clearFilter" reRender="Results,itemGrid,pnlsearch,pageMessages2" status="busyStatus"/>
                                </div>
                                </td>                           
                            </tr>        
                            
                            </tbody>    
                            </table>                        
                            
                            
                            </div>
                        </td>
                        
                    </tr>               
                </tbody>
                            
            </table>
                    
     
        </div>    
        
        <div id="noGrid2" style="display:none">No records were found based on your criteria</div>       
        
        <apex:outputPanel id="Results" layout="block" style="{!JSINHTMLENCODE(ShowBlockIfResults)}">

<!--  
        <span id="selectedItemsId" style="display:none"> 
            <apex:inputHidden value="{!currentPageSelectedCount}"/>
            <apex:outputText value="{!SearchResultsCurrentPageSize}"  style="display:none"/>
        </span>
-->                
                
        <div class="pbBody" >
            
            <div class="relatedListsearchHeader">   
                <div class="pSearchShowMore">
                  <apex:outputPanel id="opPrevNextup">          
                  
        <span id="selectedItemsId" style="display:none"> 
            <apex:inputHidden value="{!currentPageSelectedCount}"/>
            <apex:outputText value="{!SearchResultsCurrentPageSize}"  style="display:none"/>
        </span>               
                        
                      <table width="100%" id="tablePrevNextup" >
                          <tr >
                             <td width="50%" align="center" >
                                  
                                  <font >   
                                  <apex:image url="/img/search_prevarrow.gif" styleClass="prevArrow" rendered="{!If(PreviousButtonEnabled,false,true)}" alt="Previous Page" title="Previous Page" />
                                  <apex:image url="/img/search_prevarrow_disabled.gif" styleClass="prevArrow" rendered="{!If(PreviousButtonEnabled,true,false)}" alt="No Previous Page" title="No Previous Page" />
                                  <apex:outputlink onclick="javascript: return fillCurrentPage('prev');" disabled="{!PreviousButtonEnabled}" title="Previous Page" style="color:{!If(PreviousButtonEnabled,'#999999','#000000')}">Previous Page</apex:outputlink>&nbsp;&nbsp;({!PageStartIndex}-{!PageStopIndex})&nbsp;&nbsp;<apex:outputlink onclick="javascript:return fillCurrentPage('next');" disabled="{!NextButtonDisabled}" title="Next Page" style="color:{!If(NextButtonDisabled,'#999999','#000000')}">Next Page</apex:outputlink>
                                  <apex:image url="/img/search_nextarrow_disabled.gif" styleClass="nextArrow" rendered="{!If(NextButtonDisabled,true,false)}" alt="No Next Page" title="No Next Page"/>
                                  <apex:image url="/img/search_nextarrow.gif" styleClass="nextArrow" rendered="{!If(NextButtonDisabled,false,true)}" alt="Next Page" title="Next Page"/>
                                  </font>
                                  
                              </td> 
                          </tr>
                      </table>                        
                  </apex:outputpanel>
                 </div>         
            </div>          

            <!-- style="border:1px solid #D4DADC;" -->
            <apex:dataTable width="100%" value="{!searchResults}" var="Results" id="resultsDataTable" cellspacing="0" cellpadding="0" border="0" styleClass="list" rowClasses="dataRow even, dataRow odd" headerClass="headerRow" style="border:0px " 
                onrowmouseout="if (window.hiOff){hiOff(this);}" 
                onrowmouseover="if (window.hiOn){hiOn(this);}">
            
                    <apex:column styleClass="actionColumn" >
                        <apex:facet name="header"><apex:inputCheckbox id="selectall" selected="false" 
                            onclick="javascript:customSelectAllOrNoneByCheckbox(document.forms['selectProductPageId:selectionProductFormId'],'selectProductPageId:selectionProductFormId:resultsBlock:resultsDataTable:', this);"/></apex:facet>
                        <apex:inputCheckbox value="{!Results.selected}" id="selected" onclick="javascript:CheckUncheckFacet(this, this.parentNode.parentNode)"/>                        
                    </apex:column>

                    <apex:column >
                        <apex:facet name="header">                        
                          <apex:commandLink action="{!sortResults}" value="Product Name" rerender="resultsDataTable,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext,itemGrid" status="sortStatus" oncomplete="setHeaderCheckBox(1);return true;">
                            <apex:image url="/img/sort_desc_arrow.gif" rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='ProductName',true,false))}" width="21" height="12" title="Sorted Descending" alt="Sorted Descending"/>
                            <apex:image url="/img/sort_asc_arrow.gif"  rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='ProductName',true,false))}" width="21" height="12" title="Sorted Ascending" alt="Sorted Ascending"/>
                            <apex:image url="/s.gif" rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='ProductName',true,false))}" styleClass="sortDesc" title="Sorted Descending" alt="Sorted Descending" />
                            <apex:image url="/s.gif"  rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='ProductName',true,false))}" styleClass="sortAsc" title="Sorted Ascending" alt="Sorted Ascending" />
                          <apex:param value="ProductName" name="column" assignTo="{!sortExpression}" ></apex:param>
                          </apex:commandLink>
                        </apex:facet>
                        
                        <!-- <apex:outputLink id="productName" target="_blank" value="{!URLFOR($Action.Product2.View, Results.additionalProductDetail.ReferenceProduct__r.Id)}" >{!Results.additionalProductDetail.ReferenceProduct__r.Name}</apex:outputLink> -->
                        <apex:outputLink id="productName" target="_blank" value="{!URLFOR($Action.kugo2p__AdditionalProductDetail__c.View, Results.additionalProductDetail.Id)}" >{!Results.additionalProductDetail.Name}</apex:outputLink>
                    </apex:column>
                                                            
                    <apex:column >
                        <apex:facet name="header">                        
                          <apex:commandLink action="{!sortResults}" value="Product Code" rerender="resultsDataTable,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext,itemGrid" status="sortStatus" oncomplete="setHeaderCheckBox(1);return true;">
                            <apex:image url="/img/sort_desc_arrow.gif" rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='ProductCode',true,false))}" width="21" height="12" title="Sorted Descending" alt="Sorted Descending"/>
                            <apex:image url="/img/sort_asc_arrow.gif"  rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='ProductCode',true,false))}" width="21" height="12" title="Sorted Ascending" alt="Sorted Ascending"/>
                            <apex:image url="/s.gif" rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='ProductCode',true,false))}" styleClass="sortDesc" title="Sorted Descending" alt="Sorted Descending" />
                            <apex:image url="/s.gif"  rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='ProductCode',true,false))}" styleClass="sortAsc" title="Sorted Ascending" alt="Sorted Ascending" />                            
                          <apex:param value="ProductCode" name="column" assignTo="{!sortExpression}" ></apex:param>
                          </apex:commandLink>
                        </apex:facet>
                        
                        <apex:outputLink target="_blank" value="{!URLFOR($Action.Product2.View, Results.additionalProductDetail.ReferenceProduct__r.Id)}" >{!Results.additionalProductDetail.ReferenceProduct__r.ProductCode}</apex:outputLink>
                    </apex:column>
                                         
                     <apex:column width="50px" style="text-align:center;" >
                        <apex:facet name="header">
                          <apex:commandLink action="{!sortResults}" value="Service" rerender="resultsDataTable,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext,itemGrid" status="sortStatus" oncomplete="setHeaderCheckBox(1);return true;">
                            <apex:image url="/img/sort_desc_arrow.gif" rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='service',true,false))}" width="21" height="12" title="Sorted Descending" alt="Sorted Descending"/>
                            <apex:image url="/img/sort_asc_arrow.gif"  rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='service',true,false))}" width="21" height="12" title="Sorted Ascending" alt="Sorted Ascending"/>
                            <apex:image url="/s.gif" rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='service',true,false))}" styleClass="sortDesc" title="Sorted Descending" alt="Sorted Descending" />
                            <apex:image url="/s.gif"  rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='service',true,false))}" styleClass="sortAsc" title="Sorted Ascending" alt="Sorted Ascending" />                                                        
                            <apex:param value="service" name="column" assignTo="{!sortExpression}" ></apex:param>
                          </apex:commandLink>
                        </apex:facet>
                        
                        <apex:outputField value="{!Results.additionalProductDetail.kugo2p__Service__c}" />
                    </apex:column>                    
                                                                                
                    <apex:column >                          
                        <apex:facet name="header">
                          <apex:commandLink action="{!sortResults}" value="Product Description"  rerender="resultsDataTable,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext,itemGrid" status="sortStatus" oncomplete="setHeaderCheckBox(1);return true;">
                            <apex:image url="/img/sort_desc_arrow.gif" rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='Description',true,false))}" width="21" height="12" title="Sorted Descending" alt="Sorted Descending"/>
                            <apex:image url="/img/sort_asc_arrow.gif"  rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='Description',true,false))}" width="21" height="12" title="Sorted Ascending" alt="Sorted Ascending"/>
                            <apex:image url="/s.gif" rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='Description',true,false))}" styleClass="sortDesc" title="Sorted Descending" alt="Sorted Descending" />
                            <apex:image url="/s.gif"  rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='Description',true,false))}" styleClass="sortAsc" title="Sorted Ascending" alt="Sorted Ascending" />
                          <apex:param value="Description" name="column" assignTo="{!sortExpression}" ></apex:param>
                          </apex:commandLink>
                        </apex:facet>                                                                       
                        <apex:outputField value="{!Results.additionalProductDetail.ReferenceProduct__r.Description}"/>
                    </apex:column>
                                                             
                    <apex:column >
                        <apex:facet name="header">
                          <apex:commandLink action="{!sortResults}" value="Product Family"  rerender="resultsDataTable,opPrevNextup,opPrevNext,tablePrevNextup,tablePrevNext,itemGrid" status="sortStatus" oncomplete="setHeaderCheckBox(1);return true;">
                            <apex:image url="/img/sort_desc_arrow.gif" rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='Family',true,false))}" width="21" height="12" title="Sorted Descending" alt="Sorted Descending"/>
                            <apex:image url="/img/sort_asc_arrow.gif"  rendered="{!AND(IF($User.UIThemeDisplayed != 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='Family',true,false))}" width="21" height="12" title="Sorted Ascending" alt="Sorted Ascending"/>
                            <apex:image url="/s.gif" rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection=='desc',true,false),IF(sortExpression=='Family',true,false))}" styleClass="sortDesc" title="Sorted Descending" alt="Sorted Descending" />
                            <apex:image url="/s.gif"  rendered="{!AND(IF($User.UIThemeDisplayed == 'Theme3',true,false),IF(sortDirection!='desc',true,false),IF(sortExpression=='Family',true,false))}" styleClass="sortAsc" title="Sorted Ascending" alt="Sorted Ascending" />
                          <apex:param value="Family" name="column" assignTo="{!sortExpression}" ></apex:param>
                          </apex:commandLink>
                        </apex:facet>                                                                       
                        <apex:outputField value="{!Results.additionalProductDetail.ReferenceProduct__r.Family}"/>
                    </apex:column>

                    <apex:column headerValue="Edit Quantity" headerClass="alignCenter" styleClass="alignCenter">
                        <apex:inputField value="{!Results.kitBundleMember.kugo2p__AllowQuantityChange__c}" />
                    </apex:column>

                    <apex:column headerValue="Required" headerClass="alignCenter" styleClass="alignCenter">
                        <apex:inputField value="{!Results.kitBundleMember.kugo2p__Required__c}" />
                    </apex:column>

                    <apex:column width="30px" headerValue="Default Quantity" headerClass="alignRight" styleClass="alignRight" >
                        <!-- <apex:inputText value="{!Results.kitBundleMember.Quantity__c}" style="width:45pt" onchange="selectProduct(this, this.parentNode.parentNode);"/> -->    <!-- rendered="{!IF(Results.numRepeats>1,true,false)}" -->
                        <apex:inputText value="{!Results.Quantity}" style="width:45pt" styleClass="alignRight" onchange="selectProduct(this, this.parentNode.parentNode);"/>
                    </apex:column>
            
            </apex:dataTable>

            <div class="pbInnerFooter">                 
               <div class="relatedListsearchFooter"> 
               <div class="pSearchShowMore">
                <apex:outputPanel id="opPrevNext">
                                    
                    <table width="100%" id="tablePrevNext" style="font-family:Arial;vertical-align:middle;text-align:left;font-size:8pt;" >
                        <tr >
                           <td width="50%" align="center" >                                                                
                                  <font >
                                  <apex:image url="/img/search_prevarrow.gif" styleClass="prevArrow" rendered="{!If(PreviousButtonEnabled,false,true)}" alt="Previous Page" title="Previous Page" />
                                  <apex:image url="/img/search_prevarrow_disabled.gif" styleClass="prevArrow" rendered="{!If(PreviousButtonEnabled,true,false)}" alt="No Previous Page" title="No Previous Page" />
                                  <apex:outputlink onclick="javascript: return fillCurrentPage('prev');" disabled="{!PreviousButtonEnabled}" title="Previous Page" style="color:{!If(PreviousButtonEnabled,'#999999','#000000')}">Previous Page</apex:outputlink>&nbsp;&nbsp;({!PageStartIndex}-{!PageStopIndex})&nbsp;&nbsp;<apex:outputlink onclick="javascript:return fillCurrentPage('next');" disabled="{!NextButtonDisabled}" title="Next Page" style="color:{!If(NextButtonDisabled,'#999999','#000000')}">Next Page</apex:outputlink>
                                  <apex:image url="/img/search_nextarrow_disabled.gif" styleClass="nextArrow" rendered="{!If(NextButtonDisabled,true,false)}" alt="No Next Page" title="No Next Page"/>
                                  <apex:image url="/img/search_nextarrow.gif" styleClass="nextArrow" rendered="{!If(NextButtonDisabled,false,true)}" alt="Next Page" title="Next Page"/>                                  
                                  </font>                                
                            </td> 
                        </tr>
                    </table>
                    
                </apex:outputpanel>
            </div>     
               </div> 
               </div> 
            
            
        </div>
        </apex:outputPanel>
        
    </div>    
    </div>    
    </div>
              
      <div class="selectButtons kugamon">         
        <apex:commandButton id="AddId_Bottom" value="Add & Close" action="{!Add}" styleClass="slds-button slds-button--brand" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}"/>       
        <apex:commandButton value="Add & More" action="{!AddMoreProducts}" styleClass="slds-button slds-button--neutral" rendered="{!(apd.kugo2p__KitBundle__c || apd.kugo2p__ConfigurationMethod__c == 'Kit/Bundle')}" />
        <apex:commandButton value="Cancel" action="{!cancel}" styleClass="slds-button slds-button--neutral" />
      </div>
      
    </apex:outputpanel>  

    </apex:form>
    
            
    <!-- ********* JAVASCRIPT USED TO TOGGLE SELECTION OF SEARCH RESULTS ************ -->
    <script  type="text/javascript">
        
        //enter pressed
        function onEnter(ev)
        {
            if(window.event)
            {
                if(event.keyCode == 13)  //enter pressed
                {
                   
                  window.event.cancelBubble = true;
                  window.event.returnValue = false;
                  
                  document.getElementById("{!$Component.selectProductPageId:selectionProductFormId:AddId}").blur();
                  document.getElementById("{!$Component.selectProductPageId:selectionProductFormId:SearchKeyWord}").focus();
                  document.getElementById("{!$Component.selectProductPageId:selectionProductFormId:AddId}").click();
                }
            }
            else
            {
                if(ev.keyCode == 13)  //enter pressed
                {
                ev.preventDefault(); 
                document.getElementById("{!$Component.selectProductPageId:selectionProductFormId:AddId}").click();
                }
            }
        }   

        function customSelectChecked(form, element_name, value)
        {   
            var i = 0;
            for (i = 0; i < form.elements.length; i++) {
                if (form.elements[i].name.search('selected') > 0 && form.elements[i].disabled == false) {
                    if (form.elements[i].checked != value){
                        if (value) {
                            intSelectedItemsCount = intSelectedItemsCount + 1;
                            intCurrentPageSelectedItemsCount = intCurrentPageSelectedItemsCount + 1;
                            form.elements[i].parentNode.parentNode.cells[8].getElementsByTagName("input")[0].value = 1;
                        }
                        else {
                            intSelectedItemsCount = intSelectedItemsCount - 1;
                            intCurrentPageSelectedItemsCount = intCurrentPageSelectedItemsCount - 1;
                            form.elements[i].parentNode.parentNode.cells[8].getElementsByTagName("input")[0].value = '';
                        }
                    }                                               
                    form.elements[i].checked = value;
                }                
            }
                        
            var restable = document.getElementById(element_name);            
        }

        function customSelectAllOrNoneByCheckbox(form, element_name, control)
        {           
            //debugger;             
            customSelectChecked(form, element_name, control.checked); 
        }
        
/*        
        function sortResults(form) {
            setHeaderCheckBox();
        }
        
        function setSelectedItemsCount(value) {
            intSelectedItemsCount = value;
            intCurrentPageSelectedItemsCount = value;
        }      
*/              
                
        function selectunSelectHeaderCheckbox(value) {
        
            //document.getElementById("{!$Component.selectionProductFormId.pgBlock.go}")
            //document.getElementById("{!$Component.selectionProductFormId.pgBlock.resultsDataTable.selectAll}").checked
            //document.getElementById("{!$Component.selectionProductFormId.pgBlock.}")
            //selectProductPageId:selectionProductFormId:resultsDataTable:
                        
            document.getElementById("selectProductPageId:selectionProductFormId:resultsDataTable:selectall").checked = value;
        
            return;
        
            var form = document.forms['selectProductPageId:selectionProductFormId'];
            var i = 0;
            
            for (i = 0; i < form.elements.length; i++) {
                if (form.elements[i].name.search('selectall') > 0 && form.elements[i].disabled == false) {
                    form.elements[i].checked = value;
                    break;
                }
            }           
        }
        
        function setHeaderCheckBox(setCurrentPageCount) {
        
            if (setCurrentPageCount == 1) {
                intCurrentPageSelectedItemsCount = parseFloat(document.getElementById("selectedItemsId").getElementsByTagName('input')[0].value);
                //alert(' in setHeaderCheckBox in setCurrentPageCount intCurrentPageSelectedItemsCount ' + intCurrentPageSelectedItemsCount); 
            }
            //alert(' in setHeaderCheckBox before SearchResultsCurrentPageSize intCurrentPageSelectedItemsCount ' + intCurrentPageSelectedItemsCount);
            var SearchResultsCurrentPageSize = parseFloat(document.getElementById("selectedItemsId").getElementsByTagName('span')[0].innerHTML);
            //alert(' in setHeaderCheckBox after SearchResultsCurrentPageSize ' + SearchResultsCurrentPageSize);
            
            if (intCurrentPageSelectedItemsCount == SearchResultsCurrentPageSize)
                selectunSelectHeaderCheckbox(true);
            else
                selectunSelectHeaderCheckbox(false);
                
            return;

        
            var form = document.forms['selectProductPageId:selectionProductFormId'];
            var foundUnchecked = false;
                        
            if (intSelectedItemsCount > 0) {
            
                    var i = 0;
                    for (i = 0; i < form.elements.length; i++) {
                        if (form.elements[i].name.search('selected') > 0 && form.elements[i].disabled == false) {
                            if (form.elements[i].checked == false){
                                foundUnchecked = true;
                            }
                        }                
                    }
                    
                    selectunSelectHeaderCheckbox(!foundUnchecked);
            }           
            return true;
        }               

        function checkProductSelection() {
            if (intSelectedItemsCount > 0) {
                if (confirm('Your selections on all pages will be lost. Do you want to continue?')){
                    selectunSelectHeaderCheckbox(false);
                    intSelectedItemsCount=0;
                    afdoSearch();
                }
                return true;
            }           
            afdoSearch();
        }
        
        function fillCurrentPage(btnClicked)
        {                   
            if(btnClicked == 'prev' )
            {   
                intGlobalPageCounter--;
                previousCall();
                //setHeaderCheckBox();
                return false;
            }
            else 
            {
                intGlobalPageCounter++;
                nextCall();
                //setHeaderCheckBox();
                return false;
            }
            return false;
        }
                        
                     
    function clearFilters()
    {        
        //debugger;
        document.getElementById("bySearchKeyWord").getElementsByTagName('input')[0].value='';
        var a = document.getElementById("tableFilrerId");
        for(i=1 ; i < a.rows.length ; i++)
        {
            a.rows[i].getElementsByTagName('select')[0].options[0].selected = true;
            a.rows[i].getElementsByTagName('select')[1].options[0].selected = true;
            a.rows[i].getElementsByTagName('input')[1].value="";
        }
        if(a.rows[1].style.display == '')
        {
            for(i=2 ; i < a.rows.length ; i++)
            {
                a.rows[i].style.display='none';
                a.rows[i].getElementsByTagName('input')[0].value='display:none';
            }
           a.rows[1].getElementsByTagName('a')[0].innerHTML = "More Filters &gt;&gt;";
           a.rows[1].getElementsByTagName('a')[0].style.textDecoration="underline";
        }

        //selectunSelectHeaderCheckbox(false);
    }
     
    function showMoreFilters(obj)
    {
        //debugger;
        
        intMoreFiletersExpanded=0;
        if(obj.innerHTML!="AND")
        {
            var a = document.getElementById("tableFilrerId");
            if(a.rows[2].style.display == 'none')       //a.rows[2]
            {
                intMoreFiletersExpanded = 1;
                
                var i;
                for(i=1 ; i < (a.rows.length) ; i++)
                {
                    a.rows[i].style.display='';
                    a.rows[i].getElementsByTagName('input')[0].value='';
                    a.rows[i].getElementsByTagName('a')[0].innerHTML  = "AND";                  
                    a.rows[i].getElementsByTagName('a')[0].style.textDecoration="none";
                    if (i < (a.rows.length-1)) a.rows[i].getElementsByTagName('a')[0].style.color = "#333333";  
                }
                a.rows[i-1].getElementsByTagName('a')[0].innerHTML = "Fewer Filters &lt;&lt;";    
        
                a.rows[i-1].getElementsByTagName('a')[0].style.textDecoration="underline";
            }
               else
               {
                  intMoreFiletersExpanded = 0;
                  for(i=2 ; i < a.rows.length ; i++)
                  {
                    a.rows[i].style.display='none';
            
                    a.rows[i].getElementsByTagName('input')[0].value='display:none';
                  }
                  a.rows[1].getElementsByTagName('a')[0].innerHTML = "More Filters &gt;&gt;";
        
                 a.rows[1].getElementsByTagName('a')[0].style.textDecoration="underline";
                 a.rows[1].getElementsByTagName('a')[0].style.color = "#015BA7";
               }
        }
    }
        
    function CheckUncheckFacet(obj, row)
    {
        //debugger;        
        if(!obj.checked)
        {
            intSelectedItemsCount = intSelectedItemsCount - 1;
            intCurrentPageSelectedItemsCount = intCurrentPageSelectedItemsCount - 1;
            selectunSelectHeaderCheckbox(false);
            row.cells[8].getElementsByTagName("input")[0].value = '';
        } else {
            intSelectedItemsCount = intSelectedItemsCount + 1;
            intCurrentPageSelectedItemsCount = intCurrentPageSelectedItemsCount + 1;
            setHeaderCheckBox(0);
                        
            var number = parseFloat(row.cells[8].getElementsByTagName("input")[0].value);
            if ( isNaN(number) || number <= 0) {
            //if (row.cells[8].getElementsByTagName("input")[0].value == '') {
                row.cells[8].getElementsByTagName("input")[0].value = 1;
            }
        }
    }
    
    function CheckLength(obj)
    {
        //debugger;
        val = obj.value;
        if(val.length > 0 && val.length < 2)
        {
            alert('Search string must be of 2 or more characters.');
            obj.focus();
        }
    } 
        
    function updateOperator()
    {                  
        setSearchOperatorList();
    }
    
    function selectProduct(control, row) {
        //debugger;
        
        var number = parseFloat(control.value.replace(',',''));
        console.log('number ' + number);
        
        // TO DO - replace number check with regular expression     
        //var numPattern = ^([0-9]*,?)*$;       
        
        if (isNaN(number) || number <= 0) {
            if (control.value != "") {
                alert('Number must be greater than zero.');
                control.value = "";
                control.focus();
            }   
            row.cells[0].getElementsByTagName("input")[0].checked = false;          
        } else if (number > 0) {
            if (row.cells[0].getElementsByTagName("input")[0].checked == false) {
                row.cells[0].getElementsByTagName("input")[0].checked = true;
                CheckUncheckFacet(row.cells[0].getElementsByTagName("input")[0], row);
            }
        }
    }
        
            
    </script>           

</apex:page>