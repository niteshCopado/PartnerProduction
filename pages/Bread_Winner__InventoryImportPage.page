<apex:page sidebar="false" controller="Bread_Winner.InventoryImportPageController" tabStyle="Product2" title="Inventory Import by Breadwinner" action="{!fetchInventoryItems}" >
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        
        <head>
            <apex:slds />
            <script src="{!URLFOR($Resource.Breadwinner_Xero, 'Breadwinner_Xero/JS/jquery-1.11.3.js')}"></script>
            <script>
                if(document.getElementsByTagName("title") && document.getElementsByTagName("title")[0]){
                    document.getElementsByTagName("title")[0].innerHTML="Inventory Import by Breadwinner";
                }
               var j$ = jQuery.noConflict();
                
                function HideStyleSheet() {
                    j$("link.user[href$='elements.css']").each(function() {
                        j$(this).removeAttr("href");
                    });
            }
            
            function message()
            {
                j$(".infoM6, .infoM4, .infoM3, .infoM2, .infoS1").addClass("slds-notify slds-notify_alert slds-theme_info slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px","Justify-content":"left"} );
                j$(".errorM6, .errorM4, .errorM3, .errorM2, .errorS1").addClass("slds-notify slds-notify_alert slds-theme_error slds-text-align_left slds-text-heading_small slds-m-bottom_small").css({"font-weight":"500","line-height":"1.4","word-spacing":"1px","Justify-content":"left"});
                j$(".warningM6, .warningM4, .warningM3, .warningM2, .warningS1").addClass("slds-notify slds-notify_alert slds-theme_warning slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px","Justify-content":"left"} ) ;
                j$(".confirmM6, .confirmM4, .confirmM3, .confirmM2, .confirmS1").addClass("slds-notify slds-notify_alert slds-theme_success slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} ) ;
                
                j$("div .messageText h4").css( "color", "white" );
                j$("div[class*='warning'] div.messageText h4").css( "color", "black" );
                j$("table.messageTable td").css({"color" : "white"});
                j$("div[class*='warning'] table.messageTable td").css( "color", "black" );
                
            }
            function addallfuncs(){
                HideStyleSheet();
                message();
            }
            j$(function(){
                addallfuncs();
                massCheckUncheck('');
            });
            
            
            function massCheckUncheck(element){
                
                if(element.id=='Checkall'){
                    
                    var AllCheckboxElements=j$("input[type*='checkbox']");
                    
                    for(x in AllCheckboxElements ){
                        if(AllCheckboxElements[x].type=='checkbox'){
                            AllCheckboxElements[x].checked=element.checked;
                        }
                    }  
                }
                // following is used to uncheck 
                var AllCheckboxElementsCopy=j$("input[type*='checkbox']");
                var checkboxtotalcount=AllCheckboxElementsCopy.length;
                var checkedcount=0;
                for(xw in AllCheckboxElementsCopy ){
                    if(AllCheckboxElementsCopy[xw].checked){
                        checkedcount+=1;}
                }
                
                if(document.getElementById("Checkall").checked){
                    if(checkedcount<checkboxtotalcount)
                        document.getElementById("Checkall").checked='';
                }
                else {
                    if(checkedcount==(checkboxtotalcount-1))
                        document.getElementById("Checkall").checked='checked';
                    else
                        document.getElementById("Checkall").checked='';
                }
                
                
            }
            </script>
            
            <style>
                body .bPageBlock, body #bodyCell .bResource .secondaryPalette, body .secondaryPalette.bPageBlock, body .individualPalette .secondaryPalette.bPageBlock, body .bodyDiv .genericTable, body .genericPageBlockTable, body .bodyDiv .bSubBlock, body .bComponentBlock .bPageBlock, body .bMyDashboard .bPageBlock, body.rlHoverFrame .bPageBlock, body.subjectSelectionPopup div.choicesBox, body.lookupTab .secondaryPalette.bPageBlock, body.popupTab .secondaryPalette.bPageBlock, body.UserTagStatsPage .secondaryPalette.bPageBlock {
                background-color: white;
                -moz-border-radius: 4px;
                border: 0px;
                -webkit-border-radius: 4px;
                border-radius: 4px;
                }
                .tableheder{
                background-color: white !important;
                font-weight: normal !important;
                padding: 4px 2px 4px 5px !important;
                }
                .msgIcon{
                     display:none;
                }
                .message .messageText {
                     margin: 0px;
                }
                .message .messageText h4 {
                     font-weight: inherit;
                     display: initial;
                }
                
            </style>
        </head>
        <body>
            <div class="slds-scope">
                <apex:form >
                    <div class="slds-page-header" role="banner">
                        <div class="slds-media slds-media_center">
                            <div class="slds-media__figure">
                                <svg class="slds-icon slds-icon-standard-product" aria-hidden="true">
                                    <use xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/standard-sprite/svg/symbols.svg#product')}"></use>
                                </svg>
                            </div>
                            <div class="slds-media__body">
                                <p class="slds-page-header__title slds-truncate"><apex:outputText >Breadwinner Xero Inventory Import </apex:outputText> <apex:outputLabel rendered="{!isMultiOrgEnabled}" value="from {!xeroOrgName}"/></p>
                                <p class="slds-text-body_small">Breadwinner • Xero </p>
                            </div>
                        </div>
                    </div>
                    <div class="slds-m-top_small slds-m-horizontal_small">
                        <apex:pagemessages ></apex:pagemessages>
                    </div>
                    <!-- -----------------------------header END ---------------------------->
                    <apex:outputPanel layout="block" rendered="{!initialized}" styleClass="slds-m-horizontal_small">
                        <div class="warningM3" style="border-radius: 4px">
                            Due to Salesforce limitations, Breadwinner can only import products if you have less than 1000 Xero Inventory Items.
                        </div>
                        <div class="slds-m-top_medium slds-m-left_medium">                            
                            <div class="slds-text-longform" style="color: #5876a3;">
                                <ul>
                                    <li>
                                        <p>
                                            We will import all of your Xero Inventory Items as Salesforce Products. You have a chance to
                                            edit them below before importing. You can change the price, and give the Product a name.  
                                        </p>
                                    </li>
                                    <li> 
                                        <p>We will create these products and attach them to the standard Salesforce Price Book, with the
                                            Price Point shown below. Salesforce Requires all Products to have a price, so if your Xero
                                            Inventory item does not have a price, we will import it as 0.00
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            We have designed Breadwinner so that you only have to import your Inventory Items as SF
                                            Products once. After this initial import, we recommend you create SF Products. When you
                                            create a Xero Invoice in Breadwinner that contacts an Opportunity Product, we’ll create it as an
                                            Inventory Item on the fly, at the moment of Invoice Creation.
                                        </p>
                                    </li>
                                    <li> <p>Matching between Salesforce Products and Xero Inventory is based on a perfect text-match between the Xero Inventory Code and the Salesforce Product Code. </p> </li>
                                    <li> <p>Please change any values you wish to, then click Import. </p> </li>
                                </ul>
                                
                            </div>
                            
                            
                            <h3 class="slds-section-title_divider">Products Breadwinner will import</h3>
                            <div class="slds-m-top_small">
                                <apex:pageMessage rendered="{!NOT(productsFetchedList.size > 0)}" severity="INFO" strength="3" summary="{!IF(existingProductList.size > 0, 'All Inventory is imported', 'No Inventory Present in Xero')}"/>
                                <apex:pageMessage rendered="{!NOT(canImportInventoryToSalesforce)}" severity="WARNING" strength="3" summary=" You do not have required access to import Products, so please ask your Administrator to provide you the required access."/>
                            </div>
                            <apex:pageBlock mode="main-detail" >
                                <apex:pageBlockTable value="{!productsFetchedList}" var="i" rendered="{!AND(canImportInventoryToSalesforce, productsFetchedList.size > 0)}" styleClass="slds-table slds-table_bordered slds-max-medium-table_stacked-horizontal">
                                    <apex:column html-data-label="Import?" style="text-align:center;" headerClass="tableheder slds-text-title_caps">
                                        <apex:facet name="header">
                                            <div align="center" style="margin-right: 5px;">
                                                <label class="slds-checkbox">
                                                    <input type="checkbox" id="Checkall" onchange="massCheckUncheck(this);" /> 
                                                    <span class="slds-checkbox_faux"></span>
                                                </label>
                                            </div>
                                        </apex:facet>
                                        
                                        <span class="slds-checkbox">
                                            <apex:inputcheckbox id="Checkboxid" value="{!i.Checked}" onchange="massCheckUncheck(this);" /> 
                                            <apex:outputLabel styleclass="slds-checkbox__label" for="Checkboxid">
                                                <span class="slds-checkbox_faux"></span>
                                            </apex:outputLabel>
                                        </span>
                                        
                                    </apex:column>
                                    <apex:column headerValue="SF Product Name" html-data-label="SF Product Name" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.Name.createable}">
                                        <abbr class="slds-required" title="required">*</abbr>
                                        <apex:inputField value="{!i.p.Name}"  styleClass="slds-input" required="false" />
                                    </apex:column>
                                    <apex:column headerValue="Product Price" html-data-label="Product Price" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.PriceBookEntry.fields.UnitPrice.Createable}">
                                        <abbr class="slds-required" title="required">*</abbr>
                                        <apex:inputField value="{!i.pe.UnitPrice}"  styleClass="slds-input" required="false" />
                                    </apex:column>
                                    <apex:column headerValue="SF Product Description" html-data-label="SF Product Description" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.Description.createable}">
                                        <apex:inputTextarea value="{!i.p.Description}" rows="1"  onfocus="this.rows=3;"  onblur="this.rows=1;" styleClass="slds-input" rendered="{!$ObjectType.Product2.Fields.Description.Updateable}" />
                                    </apex:column>
                                    <apex:column headerValue="SF Product Code" html-data-label="SF Product Code" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.ProductCode.createable}">
                                        <apex:inputField value="{!i.p.ProductCode}"   styleClass="slds-input" />
                                    </apex:column>
                                    <apex:column headerValue="SF Product Family" html-data-label="SF Product Family" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.Family.createable}">
                                        <div class="slds-select_container">
                                            <apex:inputField value="{!i.p.Family}"  styleClass="slds-select" />
                                        </div>
                                    </apex:column>
                                    
                                </apex:pageBlockTable>
                            </apex:pageBlock>
                            <div align="right" class="slds-m-top_medium">
                                <apex:commandButton value="Import Xero Inventory as Salesforce Products" action="{!importInventoryItems}" disabled="{!NOT(AND(canImportInventoryToSalesforce,productsFetchedList.size > 0))}" status="assign-action-status" styleClass="slds-button slds-button_brand"/>
                            </div>
                            <h3 class="slds-section-title_divider slds-m-top_medium">Products which were imported</h3>
                            <div class="slds-text-body_small slds-m-top_medium slds-m-bottom_medium slds-m-left_small"> These Xero Inventory Items have already been matched to Salesforce Opportunity Products as
                                they share the same Product Code / Inventory Item Code. There is no action need or possible
                                here, but we list them so you can confirm they have already been imported.
                            </div>
                            
                            <apex:pageBlock mode="main-detail" rendered="{!AND(canReadExistedProducts, existingProductList.size > 0)}">
                                <apex:pageBlockTable value="{!existingProductList}" var="pw" styleClass="slds-table slds-table_bordered slds-max-medium-table_stacked-horizontal">
                                    <apex:column headerValue="SF Product Name"   html-data-label="SF Product Name"  headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.Name.Accessible}">
                                        <a href="/{!pw.pe.Product2Id}" target="_blank">{!pw.pe.name}</a>
                                    </apex:column>   
                                    <apex:column headerValue="Product Price"     html-data-label="Product Price" value="{!pw.pe.UnitPrice}" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.PriceBookEntry.fields.UnitPrice.Accessible}"/>
                                    <apex:column headerValue="SF Product Code"   html-data-label="SF Product Code" value="{!pw.p.ProductCode}" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.ProductCode.Accessible}"/>
                                    <apex:column headerValue="SF Product Family" html-data-label="SF Product Family" value="{!pw.p.Family}" headerClass="tableheder slds-text-title_caps" rendered="{!$ObjectType.Product2.fields.Family.Accessible}"/>
                                </apex:pageBlockTable>
                            </apex:pageBlock>
                        </div>
                    </apex:outputPanel>
                </apex:form>
                
            </div>            
        </body>
    </html>
</apex:page>